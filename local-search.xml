<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ— é™å¹³é“ºçª—å£ç®¡ç†å™¨â€”â€”niriåœ¨ ArchLinux ä¸Šçš„å®‰è£…ä¸é…ç½®</title>
    <link href="/2025/09/18/niri%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/09/18/niri%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>æ— é™å¹³é“ºçª—å£ç®¡ç†å™¨â€”â€”niriåœ¨ ArchLinux ä¸Šçš„å®‰è£…ä¸é…ç½®</p><span id="more"></span><h2 id="å‰è¨€">å‰è¨€</h2><p>ä¹‹å‰æˆ‘çš„ Arch ç”¨çš„ä¸€ç›´æ˜¯ KDE Plasmaï¼Œä¹Ÿåœ¨ Debian ä¸Šç”¨è¿‡ xfceï¼Œä½†æ˜¯KDE é‡‡ç”¨çš„æ˜¯ä»¿ Windowsçš„è‰ºæœ¯é£æ ¼ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥æŠ˜è…¾å¾—å¾ˆç¾è§‚ï¼Œä½†æ˜¯å†…å­˜å ç”¨å¾ˆå¤§ï¼Œå¼€æœºå ç”¨åŸºæœ¬ä¿æŒåœ¨3G å·¦å³ï¼›xfceä½œä¸ºä¸€ä¸ªæœ€å°å¯ç”¨çš„æ¡Œé¢ç¯å¢ƒï¼Œæ„Ÿè§‰æœ‰äº›è¿‡äºç²¾ç®€äº†ï¼Œç³»ç»Ÿè®¾ç½®çš„å›¾å½¢ç•Œé¢ä¹Ÿä¸å¤ªå¥½ç”¨ã€‚</p><p>å‰ä¸¤å¤©å†²æµªçš„æ—¶å€™å¶ç„¶çœ‹åˆ°æœ‰äººå±•ç¤ºè‡ªå·±çš„ <strong>niri</strong>æ¡Œé¢ç¯å¢ƒï¼Œè¿˜æœ‰äººè¯´è‡ªå·±å…¥äº† niri çš„å‘ä¹‹åé©¬ä¸ŠæŠ›å¼ƒ Hyprland äº†ï¼Œç†ç”±æ˜¯niri åœ¨ç¾è§‚ç¨‹åº¦ä¸è¾“ Hyprlandçš„åŒæ—¶ï¼Œæä¾›äº†å¾ˆå¤šã€å¼€ç®±å³ç”¨ã€‘çš„ä½“éªŒï¼Œç”¨æˆ·éœ€è¦è‡ªä¸»é…ç½®çš„éš¾åº¦å¤§å¤§é™ä½ã€‚äºæ˜¯æˆ‘èŠ±äº†ä¸€æ•´å¤©çš„æ—¶é—´åœ¨VMware è™šæ‹Ÿæœºé‡ŒæŠ˜è…¾niriï¼Œæœ€åé…ç½®å‡ºæ¥äº†æ¯”è¾ƒå®Œæ•´çš„æ¡Œé¢ç¯å¢ƒï¼Œç­‰ä»¥åå®ä¹ æ”’å¤Ÿé’±ç»„äº†å°å¼æœºä¹‹åå°±æŒ‰ç…§è¿™ä¸ªæµç¨‹è£…æ¡Œé¢ç¯å¢ƒå¥½äº†ã€‚</p><p>é…ç½®å®Œæ¯•çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><figure><img src="https://s21.ax1x.com/2025/09/18/pVhfYLD.png" alt="æœ€ç»ˆæ•ˆæœ" /><figcaption aria-hidden="true">æœ€ç»ˆæ•ˆæœ</figcaption></figure><p>æ—¢æ¯” KDE è½»é‡ï¼Œä¹Ÿè¦ç¾è§‚å¾—å¤šã€‚å¼€æœºä¹‹åçš„å†…å­˜å ç”¨åŸºæœ¬ä¸Šä¸ä¼šè¶…è¿‡1Gï¼Œè¿™å¤§æ¦‚æ˜¯å¾—ç›Šäº Rust çš„é«˜æ•ˆç‡ï¼Ÿï¼ˆé¡ºä¾¿ä¸€æï¼ŒHyperland æ˜¯åŸºäº C++å†™çš„ï¼Œç°åœ¨å¤§æ‰¹ç”¨æˆ·æ¶Œå…¥ niri é—´æ¥è®© Rust åˆå°èµ¢äº†ä¸€æ³¢ğŸ˜‹ï¼‰</p><p>niri çš„å®˜ç½‘åœ¨<ahref="https://yalter.github.io/niri/Getting-Started.html">è¿™é‡Œ</a>ï¼Œè¿˜æ˜¯æŒ‚åœ¨ä½œè€…çš„Github Pagesä¸Šçš„ä¸€ä¸ªå°ç½‘é¡µï¼Œä½†æ˜¯åŸºæœ¬ä¸ŠæŠŠè¯¥è®²çš„ä¸œè¥¿éƒ½è®²æ¸…æ¥šäº†ï¼Œå»ºè®®å¥½å¥½è¯»ä¸€ä¸‹ã€‚</p><h2 id="åŸºæœ¬å®‰è£…">åŸºæœ¬å®‰è£…</h2><p>å…ˆå®‰è£…ä¸€ä¸ªArchLinuxç³»ç»Ÿï¼Œå¯ä»¥å‚è€ƒArchlinuxç®€æ˜æŒ‡å—ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>å¦‚æœæ˜¯åœ¨ VMware å®‰è£… Archlinuxï¼Œå‚è€ƒï¼š<ahref="https://www.cnblogs.com/Thato/p/18311683">https://www.cnblogs.com/Thato/p/18311683</a>ï¼Œå…³é”®ç‚¹åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯åœ¨å¼€å§‹å®‰è£…ä¹‹å‰éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿å¯åŠ¨æ–¹å¼æ˜¯UEFIã€‚å‰©ä¸‹çš„å‚è€ƒArchLinuxå®‰è£…æŒ‡å—å³å¯ã€‚</p><p>ç³»ç»Ÿå®‰è£…å®Œæ¯•åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…å¿…è¦çš„åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S --needed niri alacritty fuzzel swaylock swayidle waybar swaybg xwayland-satellite gdm mako<br></code></pre></td></tr></table></figure><ul><li>niriï¼šå¹³é“ºå¼çª—å£ç®¡ç†å™¨</li><li>alacrittyï¼šGPUåŠ é€Ÿçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨</li><li>fuzzelï¼šç”¨äºå¿«é€Ÿæœç´¢åº”ç”¨</li><li>swaylockï¼šæ­é…swayidleï¼Œå®ç°é—²ç½®ä¸€æ®µæ—¶é—´åé”å±</li><li>swayidleï¼šé—²ç½®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶åæ‰§è¡Œçš„åŠ¨ä½œ</li><li>waybarï¼šé«˜åº¦å¯è‡ªå®šä¹‰çš„ Wayland çŠ¶æ€æ </li><li>swaybgï¼šWayland çš„æ¡Œé¢å£çº¸ç®¡ç†å·¥å…·</li><li>xwayland-satelliteï¼šç”¨äºè¿è¡Œ x11 åº”ç”¨çš„ Wayland æ¡¥æ¥å·¥å…·</li><li>gdmï¼šç™»å½•ç®¡ç†å™¨</li><li>makoï¼šé€šçŸ¥ç®¡ç†å™¨</li></ul><p>ç„¶åå¯ç”¨gdmï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> gdm<br></code></pre></td></tr></table></figure><p>ä¹‹åé‡å¯ï¼Œå¼€æœºä¹‹åå°±ä¼šè¿›å…¥gdmç•Œé¢ã€‚</p><hr /><p><strong>vmwareå®‰è£…archlinuxä¹‹åï¼Œç”»é¢çš„å¤§å°å›ºå®šä¸º1200x800ï¼Œæ€ä¹ˆè§£å†³?</strong></p><p>åœ¨ç®€ä¸­äº’è”ç½‘ç¿»äº†åŠå¤©ï¼Œå…¨æ˜¯äº’ç›¸å¤åˆ¶ç²˜è´´çš„æ–‡ç« ï¼Œæ²¡æ‰¾åˆ°ä¸€ä¸ªé è°±çš„æ–¹æ³•ï¼Œæœ€åè¿˜æ˜¯é—®AI è§£å†³çš„ğŸ¤£</p><p>å…ˆå®‰è£…<strong>vmtools</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -Syu open-vm-tools<br></code></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨å¯¹åº”æœåŠ¡ã€‚ç¬¬ä¸€ä¸ªä¸»è¦ç”¨æ¥åˆ†è¾¨ç‡è‡ªåŠ¨è°ƒæ•´ã€å‰ªè´´æ¿å…±äº«ä¹‹ç±»çš„é—®é¢˜ï¼Œå¯åŠ¨ä¹‹åè™šæ‹Ÿæœºçª—å£å¤§å°å³å¯ä¸å±å¹•è‡ªåŠ¨é€‚åº”ï¼›ç¬¬äºŒä¸ªè´Ÿè´£å®ç°æ‹–æ”¾å’Œå¤åˆ¶ç²˜è´´æ–‡ä»¶çš„åŠŸèƒ½ï¼ˆä¸è¿‡å¯ç”¨ä¹‹åè¿˜æ˜¯æ²¡åŠæ³•å…±äº«ç²˜è´´æ¿ï¼ŒåŸå› æˆ‘æ²¡å»æ·±ç©¶ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now vmtoolsd.service<br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now vmware-vmblock-fuse.service<br></code></pre></td></tr></table></figure><p>æå®šã€‚</p><h2 id="å¦‚ä½•ä¿®æ”¹ç³»ç»Ÿé…ç½®">å¦‚ä½•ä¿®æ”¹ç³»ç»Ÿé…ç½®</h2><p>å¦‚æœå¸Œæœ›åªä¿®æ”¹å½“å‰ç”¨æˆ·çš„é…ç½®ï¼Œåº”è¯¥ä¿®æ”¹<code>~/.config/niri/config.kdl</code>ã€‚<code>/etc/niri/config.kdl</code>çš„ä¿®æ”¹é€‚ç”¨äºæ‰€æœ‰ç”¨æˆ·ã€‚</p><p><strong>é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ä¼šåœ¨ä¿å­˜ä¹‹åç«‹åˆ»ç”Ÿæ•ˆ</strong>ã€‚å¦‚æœé…ç½®æœ‰è¯¯ï¼Œå¯ä»¥è°ƒç”¨<code>niri validate</code>æŸ¥çœ‹è¯¦æƒ…ã€‚</p><h2 id="è™šæ‹Ÿæœºçª—å£çš„ç¼©æ”¾æ¯”ä¾‹">è™šæ‹Ÿæœºçª—å£çš„ç¼©æ”¾æ¯”ä¾‹</h2><p>é»˜è®¤æƒ…å†µä¸‹è™šæ‹Ÿæœºçª—å£å­—ä½“éå¸¸å°ï¼Œéœ€è¦å¢å¤§ç¼©æ”¾æ¯”ä¾‹ã€‚</p><p>niriçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä¸ºæ¯ä¸€ä¸ªæ˜¾ç¤ºå™¨éƒ½ç¼–å†™ä¸€ä¸ª<code>output</code>è§„åˆ™ï¼Œè¿™æ ·çš„é…ç½®è§„åˆ™åªå¯¹æŒ‡å®šåç§°çš„æ˜¾ç¤ºå™¨æœ‰æ•ˆï¼Œæ¯å¢åŠ ä¸€ä¸ªæ˜¾ç¤ºå™¨å°±è¦å¢åŠ ä¸€ä¸ªé…ç½®è§„åˆ™ã€‚</p><p>outputè§„åˆ™æ˜¯æ ¹æ®æ˜¾ç¤ºå™¨çš„åå­—è¿›è¡ŒåŒ¹é…çš„ï¼Œå› æ­¤ï¼Œé¦–å…ˆåº”è¯¥ç¡®è®¤è‡ªå·±çš„å½“å‰ä½¿ç”¨çš„æ˜¾ç¤ºå™¨outputçš„åå­—ï¼Œä½¿ç”¨<code>wlr-randr</code>å¯ä»¥æŸ¥çœ‹ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥<code>fastfetch</code>ï¼‰ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">myarch% wlr-randr<br>Virtual-1 <span class="hljs-string">&quot;Unknown - Unknown - Virtual-1&quot;</span><br>  Make: Unknown<br>  Model: Unknown<br>  Enabled: <span class="hljs-built_in">yes</span><br>  Modes:<br>    2878x1482 px, 59.999001 Hz (preferred, current)<br>    4096x2160 px, 60.000000 Hz<br>    4096x2160 px, 59.939999 Hz<br>    2560x1600 px, 59.987000 Hz<br>    2560x1600 px, 59.972000 Hz<br>    1920x1440 px, 60.000000 Hz<br>    1856x1392 px, 59.994999 Hz<br>    1792x1344 px, 60.000000 Hz<br>    2048x1152 px, 60.000000 Hz<br>    1920x1200 px, 59.884998 Hz<br>    1920x1200 px, 59.950001 Hz<br>    1920x1080 px, 60.000000 Hz<br>    1600x1200 px, 60.000000 Hz<br>    1680x1050 px, 59.953999 Hz<br>    1680x1050 px, 59.882999 Hz<br>    1400x1050 px, 59.978001 Hz<br>    1400x1050 px, 59.948002 Hz<br>    1600x900 px, 60.000000 Hz<br>    1280x1024 px, 60.020000 Hz<br>    1440x900 px, 59.887001 Hz<br>    1440x900 px, 59.901001 Hz<br>    1280x960 px, 60.000000 Hz<br>    1366x768 px, 59.790001 Hz<br>    1366x768 px, 60.000000 Hz<br>    1360x768 px, 60.014999 Hz<br>    1280x800 px, 59.810001 Hz<br>    1280x800 px, 59.910000 Hz<br>    1280x768 px, 59.869999 Hz<br>    1280x768 px, 59.994999 Hz<br>    1280x720 px, 60.000000 Hz<br>    1024x768 px, 60.004002 Hz<br>    800x600 px, 60.317001 Hz<br>    800x600 px, 56.250000 Hz<br>    848x480 px, 60.000000 Hz<br>    640x480 px, 59.939999 Hz<br>  Position: 0,0<br>  Transform: normal<br>  Scale: 1.500000<br>  Adaptive Sync: disabled<br></code></pre></td></tr></table></figure><p>å¯¹äºVMwareè™šæ‹Ÿæœºæ¥è¯´ï¼Œå®ƒçš„æ˜¾ç¤ºå™¨å«åš<code>Virtual1</code>ï¼Œæ·»åŠ å¯¹åº”çš„outputè§„åˆ™å³å¯ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">output</span> <span class="hljs-string">&quot;Virtual1&quot;</span> &#123;<br>    <span class="hljs-attribute">scale</span> <span class="hljs-number">1</span>.<span class="hljs-number">5</span><br>    mode <span class="hljs-string">&quot;2560x1440@60&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°†ç¼©æ”¾æ¯”ä¾‹æ”¹æˆ1.5ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š(è¿™é‡Œå·²ç»è°ƒæ•´è¿‡äº†ç»ˆç«¯çš„å¤–è§‚ï¼Œå…·ä½“çœ‹ã€ç»ˆç«¯é…ç½®ã€‘çš„å†…å®¹)</p><p><img src="https://s21.ax1x.com/2025/09/17/pVhM42D.png" /></p><h2 id="å®‰è£…å­—ä½“">å®‰è£…å­—ä½“</h2><p>å®‰è£…å­—ä½“ï¼Œç”¨äºwaybarï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S  noto-fonts-emoji  otf-font-awesome<br><br><span class="hljs-comment"># æœç´¢å¯ç”¨çš„ CaskaydiaCove ç›¸å…³åŒ…ï¼Œè¿™æ˜¯waybaré…ç½®æ–‡ä»¶ä¸­çš„é¦–é€‰å­—ä½“</span><br>yay -Ss caskaydia<br>yay -Ss cascadia<br><br><span class="hljs-comment"># å®‰è£…æ‰¾åˆ°çš„åŒ…</span><br>yay -S ttf-cascadia-code-nerd<br></code></pre></td></tr></table></figure><p>ç»ˆç«¯å­—ä½“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S  ttf-fira-code<br></code></pre></td></tr></table></figure><p>æ›´æ–°å­—ä½“ç¼“å­˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fc-cache -fv<br></code></pre></td></tr></table></figure><h2 id="swaybgmakowaybarswayidle">swaybgã€makoã€waybarã€swayidle</h2><p>å…ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠmakoå’Œwaybarä½œä¸ºsystemdæœåŠ¡è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl --user add-wants niri.service mako.service<br>systemctl --user add-wants niri.service waybar.service<br></code></pre></td></tr></table></figure><hr /><p>waybarç¾åŒ–å‚è€ƒï¼šhttps://github.com/woioeow/hyprland-dotfiles</p><p>æŠŠè¯¥é¡¹ç›®<code>hypr_style1/waybar</code>ä¸‹çš„å››ä¸ªæ–‡ä»¶æ”¾åˆ°è‡ªå·±çš„<code>~/.config/waybar/</code>ä¸‹å³å¯ã€‚makoä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚</p><hr /><p><code>swaybg</code>è´Ÿè´£ç®¡ç†<strong>å£çº¸</strong>ï¼Œè¿™ä¸ªéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ~/.config/systemd/user/swaybg.service<br></code></pre></td></tr></table></figure><p>åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">PartOf</span>=graphical-session.target<br><span class="hljs-attr">After</span>=graphical-session.target<br><span class="hljs-attr">Requisite</span>=graphical-session.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">ExecStart</span>=/usr/bin/swaybg -m fill -i <span class="hljs-string">&quot;%h/Pictures/LakeSide.png&quot;</span><br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„é…ç½®çš„ä½œç”¨æ˜¯è®©è¿™ä¸ªæœåŠ¡åªæœ‰åœ¨å›¾å½¢ä¼šè¯å¯åŠ¨æ—¶æ‰è¿è¡Œï¼Œå¹¶ä¸”éšç€ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚<code>%h</code>ä¼šè¢«è‡ªåŠ¨æ›¿æ¢ä¸º<code>/home/ç”¨æˆ·å</code>ï¼Œè€Œä¸”å¦‚æœswaybgå´©æºƒäº†ï¼Œé‚£ä¹ˆsystemdä¼šè‡ªåŠ¨é‡å¯å®ƒã€‚</p><p>ç¼–è¾‘<code>swaybg.service</code>åï¼Œå¯ä»¥è¿è¡Œ<code>systemctl --user daemon-reload</code>ä»¥ä¾¿systemd è·å–æ–‡ä»¶ä¸­çš„æ›´æ”¹ã€‚</p><p>æœ€åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠä¿®æ”¹æ·»åŠ åˆ° niriï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl --user add-wants niri.service swaybg.service<br></code></pre></td></tr></table></figure><hr /><p><code>swayidle</code>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ~/.config/systemd/user/swayidle.service<br></code></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶åŠ å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">PartOf</span>=graphical-session.target<br><span class="hljs-attr">After</span>=graphical-session.target<br><span class="hljs-attr">Requisite</span>=graphical-session.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">ExecStart</span>=/usr/bin/swayidle -w timeout <span class="hljs-number">601</span> <span class="hljs-string">&#x27;niri msg action power-off-monitors&#x27;</span> timeout <span class="hljs-number">600</span> <span class="hljs-string">&#x27;swaylock -f&#x27;</span> before-sleep <span class="hljs-string">&#x27;swaylock -f&#x27;</span><br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure<br></code></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼šåœ¨è™šæ‹Ÿæœºä¸­ï¼Œæ²¡æœ‰çœŸå®æ˜¾ç¤ºå™¨ï¼Œ<code>niri msg action power-off-monitors</code>å‘½ä»¤ä¼šå¯¼è‡´è™šæ‹Ÿæœºæ˜¾å¡è¾“å‡ºå½»åº•æŒ‚æ‰ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™ä¸€ä¸ªå‘½ä»¤å»æ‰ï¼Œæ”¹æˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ExecStart=/usr/bin/swayidle -w \<br>   <span class="hljs-built_in">timeout</span> 600 <span class="hljs-string">&#x27;swaylock -f&#x27;</span> \<br>   before-sleep <span class="hljs-string">&#x27;swaylock -f&#x27;</span><br><br></code></pre></td></tr></table></figure></blockquote><p>æœ€åæ·»åŠ åˆ°æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŠŠswayidleæ·»åŠ åˆ°niri</span><br>systemctl --user add-wants niri.service swayidle.service<br><span class="hljs-comment"># é‡æ–°å¯åŠ¨æŸä¸ªæœåŠ¡</span><br>systemctl --user restart waybar.service<br></code></pre></td></tr></table></figure><h2 id="alacrittyç»ˆç«¯é…ç½®">Alacrittyç»ˆç«¯é…ç½®</h2><h3 id="å­—ä½“å’Œé—´è·">å­—ä½“å’Œé—´è·</h3><p>æ–°å»ºæ–‡ä»¶<code>~/.config/alacritty/alacritty.toml</code>ï¼ŒåŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-section">[font]</span><br><span class="hljs-attr">size</span> = <span class="hljs-number">12.0</span><br><br><span class="hljs-section">[font.normal]</span><br><span class="hljs-attr">family</span> = <span class="hljs-string">&quot;FiraCode&quot;</span><br><span class="hljs-attr">style</span> = <span class="hljs-string">&quot;Regular&quot;</span><br><br><span class="hljs-section">[font.bold]</span><br><span class="hljs-attr">family</span> = <span class="hljs-string">&quot;FiraCode&quot;</span><br><span class="hljs-attr">style</span> = <span class="hljs-string">&quot;Bold&quot;</span><br><br><span class="hljs-section">[font.italic]</span><br><span class="hljs-attr">family</span> = <span class="hljs-string">&quot;FiraCode&quot;</span><br><span class="hljs-attr">style</span> = <span class="hljs-string">&quot;Italic&quot;</span><br><br><span class="hljs-section">[font.bold_italic]</span><br><span class="hljs-attr">family</span> = <span class="hljs-string">&quot;FiraCode&quot;</span><br><span class="hljs-attr">style</span> = <span class="hljs-string">&quot;Bold Italic&quot;</span><br><br><span class="hljs-section">[window.padding]</span><br><span class="hljs-attr">x</span> = <span class="hljs-number">15</span><br><span class="hljs-attr">y</span> = <span class="hljs-number">15</span><br><br><span class="hljs-section">[selection]</span><br><span class="hljs-attr">save_to_clipboard</span> = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="å¤–è§‚è®¾ç½®">å¤–è§‚è®¾ç½®</h3><p>å¯ä»¥é€šè¿‡é…ç½®çª—å£è§„åˆ™æ¥ä¿®æ”¹é€æ˜åº¦ï¼Œè¿™é‡ŒåªåŒ¹é…äº†ç»ˆç«¯çª—å£ï¼Œä½¿å¾—ç»ˆç«¯çª—å£å…·æœ‰é€æ˜æ•ˆæœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kdl">window-rule &#123;<br>    match app-id=&quot;Alacritty&quot;<br>    opacity 0.9<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹é€‰ä¸­çª—å£æ—¶å‘ˆç°çš„æ•ˆæœã€‚niriå®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·è¯´çš„ï¼š</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>ç„¦ç‚¹ç¯</strong>å’Œ<strong>è¾¹æ¡†</strong>ä¼šæ¸²æŸ“ä¸ºçª—å£åé¢çš„å®å¿ƒçŸ©å½¢èƒŒæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¼šé€è¿‡åŠé€æ˜çª—å£æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨å®¢æˆ·ç«¯è£…é¥°çš„çª—å£å¯ä»¥å…·æœ‰ä»»æ„å½¢çŠ¶ã€‚</p><p>å¦‚æœæ‚¨ä¸å–œæ¬¢è¿™æ ·ï¼Œæ‚¨åº”è¯¥å–æ¶ˆæ³¨é‡Šé…ç½®é¡¶å±‚çš„<strong>prefer-no-csd</strong> è®¾ç½®ã€‚Niriå°†åœ¨åŒæ„çœç•¥å®¢æˆ·ç«¯è£…é¥°çš„çª—å£å‘¨å›´ç»˜åˆ¶ç„¦ç‚¹ç¯å’Œè¾¹æ¡†ã€‚</p></blockquote><p>æŒ‰ç…§æè¿°å–æ¶ˆæ³¨é‡Š<code>prefer-no-csd</code>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/09/17/pVhKD0I.png" /></p><p>é€‰ä¸­çš„çª—å£å››å‘¨ä¼šå‡ºç°ä¸€å±‚è“è‰²æ–¹æ¡†ã€‚</p><h2 id="é”å±è®¾ç½®">é”å±è®¾ç½®</h2><p>swaylockçš„ç›¸å…³å‘½ä»¤è§<ahref="https://man.archlinux.org/man/extra/swaylock/swaylock.1.en">å®˜æ–¹æ–‡æ¡£</a></p><p>swaylockä¸ä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯å…ˆå»æŒ‰ç…§ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼š</p><ol type="1"><li><code>$HOME/.swaylock/config</code></li><li><code>$XDG_CONFIG_HOME/swaylock/config</code>ï¼ˆé€šå¸¸æ˜¯<code>$HOME/.config/swaylock/config</code>ï¼‰</li><li><code>Â·SYSCONFDIR/swaylock/config</code>ï¼ˆåœ¨ Arch ä¸Šå°±æ˜¯<code>/etc/swaylock/config</code>ï¼‰</li></ol><p>è€Œä¸”ï¼ŒåŸç‰ˆ swaylock æ”¯æŒçš„æ•ˆæœæ˜¯éå¸¸å°‘çš„ï¼Œæƒ³è¦ä½¿ç”¨ clockã€blurä¹‹ç±»çš„ç‰¹æ•ˆçš„è¯éœ€è¦å®‰è£…æ’ä»¶ï¼š<ahref="https://github.com/mortie/swaylock-effects">https://github.com/mortie/swaylock-effects</a>ï¼Œä½†æ˜¯è¿™ä¸ªé¡¹ç›®å·²ç»4å¹´æ²¡æœ‰æ›´æ–°äº†ï¼ŒåŸºæœ¬æ²¡æ³•ç”¨ï¼Œæ‰€ä»¥å…ˆç”¨ç€åŸç‰ˆå§ï¼Œè™½ç„¶ç®€é™‹ä¸€ç‚¹ã€‚</p><p>è¿™é‡Œä½¿ç”¨<code>~/.config/swaylock/config</code>ä½œä¸ºé…ç½®æ–‡ä»¶ï¼ˆéœ€è¦è‡ªå·±åˆ›å»ºè¯¥æ–‡ä»¶ï¼‰ã€‚æ–‡æ¡£ä¸­æä¾›çš„å‘½ä»¤è¡Œå‚æ•°éƒ½å¯ä»¥å†™å…¥é…ç½®æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚å¯¹äºä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">swaylock --color=000000 --ignore-empty-password<br></code></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å†™æ³•ä¸º</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">color</span><span class="hljs-operator">=</span><span class="hljs-number">000000</span><br>ignore-empty-password<br></code></pre></td></tr></table></figure><p>å…·ä½“çš„é…ç½®å‚æ•°å‚è€ƒ<ahref="https://www.youtube.com/watch?v=ptmiPG_V4u8">è¿™ä¸ªè§†é¢‘</a>ã€‚</p><p>é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># èƒŒæ™¯è®¾ç½®</span><br><span class="hljs-attr">color</span>=<span class="hljs-number">000000</span><br><span class="hljs-attr">image</span>=~/Pictures/wallpaper.jpg<br><span class="hljs-attr">scaling</span>=fill<br><br><span class="hljs-comment"># æˆ–è€…ä½¿ç”¨çº¯è‰²èƒŒæ™¯</span><br><span class="hljs-comment"># color=1e1e2e</span><br><br><span class="hljs-comment"># æŒ‡ç¤ºå™¨è®¾ç½®</span><br><span class="hljs-attr">indicator-radius</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">indicator-thickness</span>=<span class="hljs-number">7</span><br>indicator-caps-lock<br><br><span class="hljs-comment"># ç¯å½¢æŒ‡ç¤ºå™¨é¢œè‰²</span><br><span class="hljs-attr">ring-color</span>=<span class="hljs-number">313244</span><br><span class="hljs-attr">ring-clear-color</span>=f5e0dc<br><span class="hljs-attr">ring-caps-lock-color</span>=fab387<br><span class="hljs-attr">ring-ver-color</span>=<span class="hljs-number">89</span>b4fa<br><span class="hljs-attr">ring-wrong-color</span>=f38ba8<br><br><span class="hljs-comment"># å†…éƒ¨åœ†åœˆé¢œè‰²</span><br><span class="hljs-attr">inside-color</span>=<span class="hljs-number">1</span>e1e2e<br><span class="hljs-attr">inside-clear-color</span>=<span class="hljs-number">1</span>e1e2e<br><span class="hljs-attr">inside-caps-lock-color</span>=<span class="hljs-number">1</span>e1e2e<br><span class="hljs-attr">inside-ver-color</span>=<span class="hljs-number">1</span>e1e2e<br><span class="hljs-attr">inside-wrong-color</span>=<span class="hljs-number">1</span>e1e2e<br><br><span class="hljs-comment"># åˆ†éš”çº¿é¢œè‰²</span><br><span class="hljs-attr">separator-color</span>=<span class="hljs-number">00000000</span><br><br><span class="hljs-comment"># æ–‡æœ¬é¢œè‰²</span><br><span class="hljs-attr">text-color</span>=cdd6f4<br><span class="hljs-attr">text-clear-color</span>=f5e0dc<br><span class="hljs-attr">text-caps-lock-color</span>=fab387<br><span class="hljs-attr">text-ver-color</span>=<span class="hljs-number">89</span>b4fa<br><span class="hljs-attr">text-wrong-color</span>=f38ba8<br><br><span class="hljs-comment"># æŒ‰é”®åé¦ˆ</span><br><span class="hljs-attr">bs-hl-color</span>=f38ba8<br><span class="hljs-attr">key-hl-color</span>=a6e3a1<br><br><span class="hljs-comment"># å¸ƒå±€</span><br><span class="hljs-attr">layout-text-color</span>=cdd6f4<br><span class="hljs-attr">layout-bg-color</span>=<span class="hljs-number">00000000</span><br><br><span class="hljs-comment"># å…¶ä»–è®¾ç½®</span><br><span class="hljs-attr">font</span>=CaskaydiaCove Nerd Font<br><span class="hljs-attr">font-size</span>=<span class="hljs-number">24</span><br>line-uses-ring<br>disable-caps-lock-text<br>show-failed-attempts<br></code></pre></td></tr></table></figure><p>å¦ä¸€ç§æ›´ç®€æ´çš„é£æ ¼ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">key-hl-color</span>=<span class="hljs-number">00000066</span><br><span class="hljs-attr">separator-color</span>=<span class="hljs-number">00000000</span><br><br><span class="hljs-attr">inside-color</span>=<span class="hljs-number">00000033</span><br><span class="hljs-attr">inside-clear-color</span>=ffffff00<br><span class="hljs-attr">inside-caps-lock-color</span>=ffffff00<br><span class="hljs-attr">inside-ver-color</span>=ffffff00<br><span class="hljs-attr">inside-wrong-color</span>=ffffff00<br><br><span class="hljs-attr">ring-color</span>=ffffff<br><span class="hljs-attr">ring-clear-color</span>=ffffff<br><span class="hljs-attr">ring-caps-lock-color</span>=ffffff<br><span class="hljs-attr">ring-ver-color</span>=ffffff<br><span class="hljs-attr">ring-wrong-color</span>=ffffff<br><br><span class="hljs-attr">line-color</span>=<span class="hljs-number">00000000</span><br><span class="hljs-attr">line-clear-color</span>=ffffffff<br><span class="hljs-attr">line-caps-lock-color</span>=ffffffff<br><span class="hljs-attr">line-ver-color</span>=ffffffff<br><span class="hljs-attr">line-wrong-color</span>=ffffffff<br><br><span class="hljs-attr">text-color</span>=ffffff<br><span class="hljs-attr">text-clear-color</span>=ffffff<br><span class="hljs-attr">text-ver-color</span>=ffffff<br><span class="hljs-attr">text-wrong-color</span>=ffffff<br><br><span class="hljs-attr">bs-hl-color</span>=ffffff<br><span class="hljs-attr">caps-lock-key-hl-color</span>=ffffffff<br><span class="hljs-attr">caps-lock-bs-hl-color</span>=ffffffff<br>disable-caps-lock-text<br><span class="hljs-attr">text-caps-lock-color</span>=ffffff<br></code></pre></td></tr></table></figure><p>å¤šæ˜¾ç¤ºå™¨é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># æ‰€æœ‰æ˜¾ç¤ºå™¨æ˜¾ç¤ºåŒæ ·å†…å®¹</span><br><span class="hljs-attr">image</span>=~/Pictures/wallpaper.jpg<br><br><span class="hljs-comment"># æˆ–è€…ä¸ºä¸åŒæ˜¾ç¤ºå™¨è®¾ç½®ä¸åŒå£çº¸</span><br><span class="hljs-comment"># image=DP-1:~/Pictures/monitor1.jpg</span><br><span class="hljs-comment"># image=HDMI-A-1:~/Pictures/monitor2.jpg</span><br></code></pre></td></tr></table></figure><h2 id="çª—å£åœ†è§’">çª—å£åœ†è§’</h2><p><ahref="https://yalter.github.io/niri/Configuration%3A-Window-Rules.html#geometry-corner-radius">geometry-corner-radius</a></p><p>æ·»åŠ ä¸‹é¢çš„çª—å£è§„åˆ™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kdl">window-rule &#123;<br>    geometry-corner-radius 12<br>    clip-to-geometry true<br>&#125;<br></code></pre></td></tr></table></figure><ol type="1"><li><code>geometry-corner-radius</code>ï¼šæŠŠè¾¹æ¡†å’Œå¯¹ç„¦ç¯è®¾ç½®ä¸ºåœ†è§’ï¼Œä½†æ˜¯ä¸å½±å“å†…éƒ¨çš„çª—å£</li><li><code>clip-to-geometry</code>ï¼šæŠŠçª—å£çš„è§’è£å‰ªåˆ°å‡ ä½•å½¢çŠ¶è¾¹ç•Œå†…ï¼Œç¡®ä¿çª—å£çš„å†…å®¹ä¸ä¼šè¶…å‡ºåœ†è§’è¾¹ç•Œ</li></ol><p>æœ€ç»ˆæ•ˆæœï¼š</p><p><img src="https://s21.ax1x.com/2025/09/18/pVhfYLD.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å€ŸåŠ© Redis Hash å®ç°ç”¨æˆ·ç²’åº¦çš„ä»¤ç‰Œæ¡¶é™æµ</title>
    <link href="/2025/09/13/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%94%A8%E6%88%B7%E7%B2%92%E5%BA%A6%E7%9A%84%E9%99%90%E6%B5%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/"/>
    <url>/2025/09/13/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%94%A8%E6%88%B7%E7%B2%92%E5%BA%A6%E7%9A%84%E9%99%90%E6%B5%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>å¤ç›˜ä¸€ä¸‹é¢è¯•ä¸­é‡åˆ°çš„åœºæ™¯é¢˜ï¼Œç»™å‡ºä»æ–¹æ¡ˆè®¾è®¡åˆ°å‹æµ‹çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚</p><span id="more"></span><h2 id="å‰è¨€">å‰è¨€</h2><p>æ˜¨å¤©é¢è¯•é‡åˆ°åœºæ™¯é¢˜ï¼š</p><blockquote><p>Qï¼šç”¨æˆ·ä¸­å¯èƒ½æ··å…¥å¾ˆå¤šæœºå™¨äººï¼Œå‘æœåŠ¡å™¨å‘é€å¤§é‡è¯·æ±‚ã€‚æ€ä¹ˆåœ¨ç”¨æˆ·å±‚é¢è¿›è¡Œé™æµï¼Ÿ</p></blockquote><blockquote><p>Aï¼šä¸ºæ¯ä¸ªç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªä»¤ç‰Œæ¡¶å¯ä»¥å®ç°ç”¨æˆ·å±‚é¢çš„é™æµï¼Œæ¯”å¦‚æ¯ç§’åªå‘æ”¾10ä¸ªä»¤ç‰Œã€‚</p></blockquote><blockquote><p>Qï¼šå…·ä½“æ€ä¹ˆå®ç°è¿™æ ·çš„ä»¤ç‰Œæ¡¶ï¼Ÿè¯¦ç»†è¯´ä¸€ä¸‹ã€‚</p></blockquote><p>å½“æ—¶æ²¡ç­”ä¸Šæ¥ï¼Œç°åœ¨å¤ç›˜ä¸€ä¸‹ï¼Œç»™å‡ºä¸€ä¸ªä»è®¾è®¡åˆ°æµ‹è¯•çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="ä»¤ç‰Œæ¡¶çš„çŠ¶æ€">ä»¤ç‰Œæ¡¶çš„çŠ¶æ€</h2><ul><li><code>capacity</code><strong>æ¡¶çš„æœ€å¤§å®¹é‡</strong>ï¼šç”¨æ¥é™åˆ¶ä»¤ç‰Œæ¡¶å¯¹å¹¶å‘çš„å®¹å¿åº¦ï¼Œå®¹é‡è¶Šå¤§ä»£è¡¨å…è®¸çš„å¹¶å‘è¶Šå¤§ã€‚</li><li><code>rate</code><strong>ä»¤ç‰Œç”Ÿæˆé€Ÿç‡</strong>ï¼šæ¯æ¯«ç§’ç”Ÿæˆå¤šå°‘ä¸ªä»¤ç‰Œï¼Œåé¢ç»“åˆæ—¶é—´æˆ³å¯ä»¥å®ç°è®¿é—®æ—¶æ–°å¢ä»¤ç‰Œçš„ç›®çš„ã€‚</li><li><code>tokens</code><strong>å½“å‰ä»¤ç‰Œæ•°</strong>ï¼šå½“å‰ä»¤ç‰Œæ¡¶ä¸­è¿˜å‰©ä¸‹å¤šå°‘ä»¤ç‰Œã€‚</li><li><code>last_refill_timestamp</code><strong>ä¸Šæ¬¡åˆ·æ–°æ—¶é—´</strong>ï¼šä¸Šä¸€æ¬¡ä¸ºæ¡¶é‡Œæ·»åŠ ä»¤ç‰Œæ—¶çš„æ—¶é—´æˆ³ï¼Œéå¸¸é‡è¦ï¼Œå€ŸåŠ©è¿™ä¸ªå‚æ•°å°±å¯ä»¥å®ç°è‡ªåŠ¨è¡¥å……ä»¤ç‰Œã€‚</li></ul><h2 id="æ€è·¯">æ€è·¯</h2><h3 id="ä»¤ç‰Œæ¡¶">ä»¤ç‰Œæ¡¶ï¼Ÿ</h3><p>ä¸€èˆ¬æ¥è¯´å¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥æè¿°ä»¤ç‰Œæ¡¶ï¼š</p><p><img src="https://s21.ax1x.com/2025/09/13/pVWR10A.png" /></p><p>è¿™å¼ å›¾ç¡®å®å¾ˆå½¢è±¡ï¼Œä»¤ç‰Œæ’å®šæµå…¥ä»¤ç‰Œæ¡¶ï¼Œè€Œè¾“å…¥è¯·æ±‚åªæœ‰æ‹¿åˆ°ä»¤ç‰Œä¹‹åæ‰èƒ½è¾“å‡ºï¼Œå¦åˆ™ä¸¢å¼ƒï¼Œä½†æ˜¯å®¹æ˜“è®©äººäº§ç”Ÿè¯¯è§£ï¼šä»¤ç‰Œå¿…é¡»ç”±ç¬¬ä¸‰æ–¹è¾“å…¥å—ï¼Ÿå¦‚æœæ˜¯é’ˆå¯¹å…¨ç³»ç»Ÿæ‰€æœ‰è¯·æ±‚çš„é™æµçš„è¯ï¼Œé‚£å¾ˆç®€å•ï¼Œç³»ç»Ÿå¼€ä¸€ä¸ªåå°çº¿ç¨‹åªç®¡è¾“å…¥å°±è¡Œäº†ã€‚ä½†æ˜¯å¦‚æœç²¾ç¡®åˆ°<strong>ç”¨æˆ·å±‚é¢</strong>å‘¢ï¼Ÿæœ‰ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯ä¸ºæ¯ä¸ªç”¨æˆ·éƒ½ç»´æŠ¤ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œè€Œè¿™ä¸ªä»¤ç‰Œæ¡¶å†…çš„ä»¤ç‰Œæ•°é‡çš„æ›´æ–°é‡‡ç”¨äº†ç±»ä¼¼æ»‘åŠ¨çª—å£çš„å¤„ç†æ€è·¯ï¼šæ¯æ¬¡ç”¨æˆ·è¯·æ±‚åˆ°è¾¾æ—¶è‡ªè¡Œåˆ·æ–°ä»¤ç‰Œæ•°ï¼Œç„¶åå†åˆ¤æ–­å¤Ÿä¸å¤Ÿç”¨ï¼Œè€Œ<strong>ä¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹æ¥åˆ·æ–°ä»¤ç‰Œæ•°é‡</strong>ã€‚</p><h3 id="ç»†èŠ‚">ç»†èŠ‚</h3><p>ä¸€æ–¹é¢ï¼Œä½¿ç”¨Redisçš„<strong>Hash</strong>ç»“æ„ç»´æŠ¤ç”¨æˆ·çš„ä»¤ç‰Œæ¡¶çš„çŠ¶æ€ï¼š</p><ul><li>Keyï¼šåŒ…å«ç”¨æˆ·IDçš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚<code>rate_limit:&#123;userId&#125;</code></li><li>å­—æ®µï¼š<ul><li><code>tokens</code>ï¼šå½“å‰ä»¤ç‰Œæ•°</li><li><code>last_refill_timestamp</code>ï¼šä¸Šæ¬¡åˆ·æ–°çš„æ—¶é—´</li></ul></li></ul><p>å½“æœåŠ¡å™¨æ¥å—åˆ°è¯·æ±‚æ—¶ï¼Œå…ˆå»redisæ£€æŸ¥è¯¥ç”¨æˆ·ä»¤ç‰Œæ¡¶ï¼Œæ ¹æ®è¿™æ¬¡è®¿é—®å’Œä¸Šä¸€æ¬¡è®¿é—®çš„æ—¶é—´é—´éš”è®¡ç®—å‡ºæ¥æ–°å¢çš„ä»¤ç‰Œæ•°é‡ï¼Œç„¶åå†åˆ¤æ–­æ›´æ–°åçš„ä»¤ç‰Œæ•°é‡å¤Ÿä¸å¤Ÿç”¨ï¼Œå¦‚æœå¤Ÿç”¨ï¼Œå°±è¿”å›1ï¼Œå¦‚æœä¸å¤Ÿç”¨å°±è¿”å›0ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œã€è¯»-åˆ¤æ–­-åˆ·æ–°ã€‘è¿™ä¸‰ä¸ªæ“ä½œä¸æ˜¯åŸå­çš„ï¼Œåº”è¯¥ä½¿ç”¨<strong>Luaè„šæœ¬</strong>ï¼Œè®©ä»¤ç‰Œæ¡¶çš„åˆ·æ–°é€»è¾‘åœ¨è„šæœ¬ä¸­åŸå­æ€§å®Œæˆã€‚Luaè„šæœ¬ä¸­ç”¨åˆ°çš„å‡ ä¸ªå‘½ä»¤ï¼š</p><ul><li><code>HGETALL key</code><ul><li>è¿”å›ä¸€ä¸ªhashçš„æ‰€æœ‰å­—æ®µåŠé”®å€¼</li></ul></li><li><code>HSET key field value [ field value ... ]</code><ul><li>åˆ›å»º/ä¿®æ”¹Hashçš„å†…å®¹</li></ul></li><li><code>expire</code><ul><li>è®¾ç½®è¿‡æœŸæ—¶é—´</li></ul></li></ul><p>Luaè„šæœ¬æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><pre><code class="mermaid" >   graph TD    A["å¼€å§‹æ‰§è¡ŒLuaè„šæœ¬"] --> B["HGETALLè·å–ç”¨æˆ·ä»¤ç‰Œæ¡¶"]    B --> C{"ä»¤ç‰Œæ¡¶æ˜¯å¦å­˜åœ¨?"}    C -->|"ä¸å­˜åœ¨"| D["åˆå§‹åŒ–æ–°ä»¤ç‰Œæ¡¶æ»¡å®¹é‡"]    C -->|"å­˜åœ¨"| E["è§£æå½“å‰ä»¤ç‰Œå’Œæ—¶é—´æˆ³"]    D --> F["è®¡ç®—å¹¶è¡¥å……æ–°ä»¤ç‰Œ"]    E --> F    F --> G{"å½“å‰ä»¤ç‰Œæ˜¯å¦è¶³å¤Ÿ?"}    G -->|"è¶³å¤Ÿ"| H["æ‰£å‡ä»¤ç‰Œå¹¶æ›´æ–°çŠ¶æ€ï¼Œè¿”å›1å…è®¸"]    G -->|"ä¸è¶³"| I["åªæ›´æ–°çŠ¶æ€ï¼Œä¸æ‰£å‡ï¼Œè¿”å›0æ‹’ç»"]    H --> J["ç»“æŸ"]    I --> J</code></pre><p>æ ¹æ®æµç¨‹å›¾ç¼–ç ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- TokenBucket.lua</span><br><br><span class="hljs-comment">-- KEYS[1]: ä»¤ç‰Œæ¡¶çš„key, ä¾‹å¦‚ &quot;rate_limit:user123&quot;</span><br><span class="hljs-comment">-- ARGV[1]: ä»¤ç‰Œæ¡¶å®¹é‡ (capacity)</span><br><span class="hljs-comment">-- ARGV[2]: ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ (rate, ä¸ª/æ¯«ç§’)</span><br><span class="hljs-comment">-- ARGV[3]: å½“å‰æ—¶é—´æˆ³ (now, æ¯«ç§’)</span><br><span class="hljs-comment">-- ARGV[4]: æœ¬æ¬¡è¯·æ±‚éœ€è¦æ¶ˆè´¹çš„ä»¤ç‰Œæ•° (é€šå¸¸æ˜¯1)</span><br><br><span class="hljs-keyword">local</span> capacity = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>])<br><span class="hljs-keyword">local</span> rate = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">2</span>])<br><span class="hljs-keyword">local</span> now = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">3</span>])<br><span class="hljs-keyword">local</span> requested = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">4</span>])<br><br><span class="hljs-keyword">local</span> bucket = redis.call(<span class="hljs-string">&#x27;hgetall&#x27;</span>, KEYS[<span class="hljs-number">1</span>])<br><span class="hljs-keyword">local</span> last_tokens<br><span class="hljs-keyword">local</span> last_refill_timestamp<br><br><span class="hljs-comment">-- å¦‚æœæ¡¶ä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–ã€‚#ç”¨äºè¯»å–é•¿åº¦</span><br><span class="hljs-keyword">if</span> #bucket == <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>    last_tokens = capacity<br>    last_refill_timestamp = now<br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment">-- Redisè¿”å›çš„hgetallæ˜¯[key1, val1, key2, val2...]</span><br>    <span class="hljs-comment">-- éœ€è¦æ‰‹åŠ¨è§£æ</span><br>    <span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, #bucket, <span class="hljs-number">2</span> <span class="hljs-keyword">do</span><br>        <span class="hljs-keyword">if</span> bucket[i] == <span class="hljs-string">&#x27;tokens&#x27;</span> <span class="hljs-keyword">then</span><br>            last_tokens = <span class="hljs-built_in">tonumber</span>(bucket[i+<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">elseif</span> bucket[i] == <span class="hljs-string">&#x27;timestamp&#x27;</span> <span class="hljs-keyword">then</span><br>            last_refill_timestamp = <span class="hljs-built_in">tonumber</span>(bucket[i+<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- è®¡ç®—éœ€è¦è¡¥å……çš„ä»¤ç‰Œ</span><br><span class="hljs-keyword">local</span> delta_time = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, now - last_refill_timestamp)<br><span class="hljs-keyword">local</span> new_tokens = delta_time * rate<br><span class="hljs-keyword">local</span> current_tokens = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">min</span>(capacity, last_tokens + new_tokens)<br><br><span class="hljs-comment">-- åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å……è¶³</span><br><span class="hljs-keyword">if</span> current_tokens &gt;= requested <span class="hljs-keyword">then</span><br>    current_tokens = current_tokens - requested<br>    <span class="hljs-comment">-- æ›´æ–°æ¡¶çš„çŠ¶æ€</span><br>    redis.call(<span class="hljs-string">&#x27;hset&#x27;</span>, KEYS[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;tokens&#x27;</span>, current_tokens, <span class="hljs-string">&#x27;timestamp&#x27;</span>, now)<br>    <span class="hljs-comment">-- è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨æ¸…ç†ä¸æ´»è·ƒç”¨æˆ·çš„key</span><br>    redis.call(<span class="hljs-string">&#x27;expire&#x27;</span>, KEYS[<span class="hljs-number">1</span>], <span class="hljs-number">120</span>) <span class="hljs-comment">-- ä¾‹å¦‚2åˆ†é’Ÿåè¿‡æœŸ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> <span class="hljs-comment">-- 1è¡¨ç¤ºæˆåŠŸ</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment">-- å³ä½¿ä»¤ç‰Œä¸è¶³ï¼Œä¹Ÿè¦æ›´æ–°çŠ¶æ€ï¼Œå¦åˆ™ä»¤ç‰Œä¼šä¸€ç›´ä¸åˆ·æ–°</span><br>    redis.call(<span class="hljs-string">&#x27;hset&#x27;</span>, KEYS[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;tokens&#x27;</span>, current_tokens, <span class="hljs-string">&#x27;timestamp&#x27;</span>, now)<br>    redis.call(<span class="hljs-string">&#x27;expire&#x27;</span>, KEYS[<span class="hljs-number">1</span>], <span class="hljs-number">120</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> <span class="hljs-comment">-- 0è¡¨ç¤ºå¤±è´¥</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h2 id="javaä»£ç å®ç°">Javaä»£ç å®ç°</h2><p>å…ˆåœ¨è™šæ‹Ÿæœºå¯åŠ¨ä¸€ä¸ªdocker valkeyå®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>--name valkey \<br>--network leaf \<br>-p 6379:6379 \<br>valkey/valkey valkey-server --save 60 1 --loglevel warning<br></code></pre></td></tr></table></figure><p>å‘springbootå·¥ç¨‹å¼•å…¥redisä¾èµ–ï¼šï¼ˆvalkeyä¹Ÿå¯ä»¥ç”¨redisçš„ä¾èµ–ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.199.131:3306/hm-cart?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.199</span><span class="hljs-number">.131</span><br></code></pre></td></tr></table></figure><p>ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç¡®è®¤valkeyè¿æ¥æ— è¯¯ã€‚ç„¶åå°†Luaè„šæœ¬åŠ è½½è¿›å·¥ç¨‹ï¼Œè€ƒè™‘åˆ°ä»£ç çš„å¤ç”¨æ€§ï¼Œå¯ä»¥æŠŠè¿™ä¸€éƒ¨åˆ†æŠ½å–æˆä¸€ä¸ªBeanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenBucketConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DefaultRedisScript&lt;Long&gt; <span class="hljs-title function_">tokenBucketLuaScript</span><span class="hljs-params">()</span> &#123;<br>        DefaultRedisScript&lt;Long&gt; luaScript = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();<br>        luaScript.setLocation(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;TokenBucket.lua&quot;</span>));<br>        luaScript.setResultType(Long.class);<br>        <span class="hljs-keyword">return</span> luaScript;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">bucketPrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rate_limit:&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">capacity</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ratePerMillisecond</span> <span class="hljs-operator">=</span> <span class="hljs-number">10.0</span> / (<span class="hljs-number">1000.0</span>); <span class="hljs-comment">// æ¯ç§’é’Ÿåæ¬¡è¯·æ±‚</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨Controlleræ³¨å…¥è¯¥beanï¼Œè°ƒç”¨<code>stringRedisTemplate</code>æ‰§è¡Œå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/web&quot;)</span><br><span class="hljs-meta">@RequiredArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserMapper userMapper;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DefaultRedisScript&lt;Long&gt; tokenBucketLuaScript;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/token/&#123;userId&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">isAllowed</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(name = &quot;userId&quot;)</span> String userId)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis(); <span class="hljs-comment">// å½“å‰æ—¶é—´æˆ³</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stringRedisTemplate.execute(<br>                tokenBucketLuaScript,<br>                List.of(bucketPrefix + userId), <span class="hljs-comment">// KEYS</span><br>                String.valueOf(capacity),       <span class="hljs-comment">// å®¹é‡</span><br>                String.valueOf(ratePerMillisecond), <span class="hljs-comment">// ä»¤ç‰Œå¢é•¿é€Ÿç‡</span><br>                String.valueOf(now),               <span class="hljs-comment">// å½“å‰æ—¶é—´æˆ³</span><br>                String.valueOf(<span class="hljs-number">1</span>)                  <span class="hljs-comment">// è¯·æ±‚æ•°é‡</span><br>        );<br><br>        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">200</span>).body(<span class="hljs-string">&quot;OK&quot;</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">429</span>).body(<span class="hljs-string">&quot;é”™è¯¯&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‹æµ‹">å‹æµ‹</h2><p>è®¾å®šä»¤ç‰Œç”Ÿæˆé€Ÿç‡ä¸º10ä¸ª/ç§’ï¼›</p><p>jmeteré…ç½®ï¼š</p><ul><li>Thread Group çº¿ç¨‹æ•°è®¾ç½®ä¸º 40ï¼Œé¢„çƒ­æ—¶é—´ 1sï¼›</li><li>Constant Throught Timerå°†ç›®æ ‡ååé‡è®¾ç½®ä¸º<code>1200.0</code>æ¯åˆ†é’Ÿï¼ˆä¹Ÿå°±æ˜¯20/secï¼‰ï¼Œæ‰€ä»¥æœ‰ä¸€åŠçš„è¯·æ±‚ä¼šè¢«é™æµæœåŠ¡æ‹’ç»ï¼›</li><li>HTTP ä¸º GET è¯·æ±‚ï¼Œå‘å¾€ 8080 ç«¯å£ï¼›</li></ul><p>å…±å‘é€ä¸€ä¸‡æ¬¡è¯·æ±‚ï¼Œç»“æœå¦‚ä¸‹ï¼Œå…¨ç¨‹ååé‡ç¨³å®šåœ¨20/secï¼Œé”™è¯¯ç‡ä¸º50%ï¼Œç¬¦åˆé¢„æœŸã€‚</p><p><img src="https://s21.ax1x.com/2025/09/13/pVWhU1K.png" /></p><p>å¦‚æœåœ¨è¿è¡ŒæœŸé—´æŸ¥çœ‹hashçš„å­—æ®µå€¼ï¼Œä¼šçœ‹åˆ°ï¼š</p><p><img src="https://s21.ax1x.com/2025/09/13/pVWhjuF.png" /></p><p>ä»¤ç‰Œæ•°ä¸€ç›´å¤„äºè¢«æ¦¨å¹²çš„çŠ¶æ€...</p>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Valkey/Redis å¦‚ä½•é€šè¿‡å¤šçº¿ç¨‹è¾¾åˆ°å•ç‚¹ 1M RPS?</title>
    <link href="/2025/09/04/Redis%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <url>/2025/09/04/Redis%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>Redis çš„æ ¸å¿ƒæ˜¯å•çº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„ SET/GETè¯·æ±‚ï¼Œä½†ç°åœ¨å¤§å¤šæ•°æœºå™¨éƒ½æ˜¯<strong>å¤šæ ¸</strong>çš„ã€‚ä¸ºäº†åˆ©ç”¨åˆ°å¤šæ ¸ï¼Œå‡å°‘å•çº¿ç¨‹æˆä¸ºç“¶é¢ˆï¼ŒAWSä¸ºè‡ªå·±çš„ ElasticCache åšäº†å¾ˆå¤šæ”¹è¿›ï¼ŒåŒ…æ‹¬ï¼šï¼ˆå‡å·²åˆå¹¶åˆ°Valkey 8.0ï¼‰</p><ul><li>2019å¹´æ¨å‡ºIOçº¿ç¨‹ï¼Œæ‰¿æ‹…ä¸€éƒ¨åˆ†ä¸»çº¿ç¨‹çš„å·¥ä½œ</li><li>2021å¹´è¿›ä¸€æ­¥ä¼˜åŒ–IOçº¿ç¨‹ï¼Œå°†å¼€å¯ TLSçš„é›†ç¾¤åŠ è§£å¯†å’Œè¿æ¥å¤„ç†æ“ä½œä»ä¸»çº¿ç¨‹ç§»åˆ° IO çº¿ç¨‹</li><li>2023å¹´æ¨å‡ºå¢å¼ºçš„IOå¤šè·¯å¤ç”¨</li><li>2023å¹´æå‡ºè¡¨ç¤ºå±‚å¸è½½å’Œå†…å­˜è®¿é—®æ‘Šé”€æŠ€æœ¯ï¼Œå®ç°å•èŠ‚ç‚¹å¤„ç†è¶…è¿‡100ä¸‡RPSã€‚</li></ul><h2 id="å¢å¼ºioå¤„ç†">å¢å¼ºI/Oå¤„ç†</h2><p>å¢å¼ºçš„ I/Oå¤šè·¯å¤ç”¨å¯æ˜¾è‘—æ”¹å–„å¤§è§„æ¨¡ååé‡å’Œå»¶è¿Ÿã€‚å…ˆçœ‹çœ‹ä»¥å‰çš„IOå¤šè·¯å¤ç”¨æ˜¯æ€ä¹ˆåšçš„ï¼š</p><p><img src="https://s21.ax1x.com/2025/08/22/pVDDBVI.png" /></p><p>æ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¸å•çº¿ç¨‹çš„å¤„ç†å¼•æ“å»ºç«‹ä¸€ä¸ªè¿æ¥é€šé“ï¼Œå› æ­¤å¼•æ“è¦å•ç‹¬ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„å»ºç«‹ç½‘ç»œè¿æ¥ã€è§£æå‘æ¥çš„è¯·æ±‚ã€è¿è¡Œè§£æå‡ºæ¥çš„å‘½ä»¤ã€‚è¿™æ ·çš„æ¶æ„æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol type="1"><li><strong>å¤„ç†å¼•æ“å¿…é¡»äº²è‡ªå¤„ç†ç½‘ç»œè¿æ¥ï¼Œå¿…é¡»äº²è‡ªè§£æå‘½ä»¤ï¼Œä¸èƒ½ä¸“æ³¨äºè¿è¡Œå‘½ä»¤</strong></li><li><strong>å¤šä½™çš„CPUæ ¸å¿ƒæ²¡æœ‰å¾—åˆ°åˆ©ç”¨</strong></li></ol><p>ä¸ºäº†è§£å†³è¿™å‡ ä¸ªé—®é¢˜ï¼Œå¢å¼ºå‹çš„IOå¤šè·¯å¤ç”¨ä½¿ç”¨ä»¥ä¸‹æ¶æ„ï¼š</p><p><img src="https://s21.ax1x.com/2025/08/22/pVDDgxg.png" /></p><p>å…¶ä½™å¯ç”¨çš„ CPUæ ¸å¿ƒç”¨æ¥åˆ†æ‹…ä¸»çº¿ç¨‹çš„å‹åŠ›ï¼Œ<strong>æŠŠå¤„ç†ç½‘ç»œIOçš„å·¥ä½œè½¬ç§»åˆ° IOçº¿ç¨‹ä¸Š</strong>ï¼Œä¸»çº¿ç¨‹è´Ÿè´£ç»™IOçº¿ç¨‹åˆ†é…ä»»åŠ¡ã€‚ä½¿ç”¨å¤šè·¯å¤ç”¨æ—¶ï¼Œæ¯ä¸ªå¢å¼ºå‹I/Oçº¿ç¨‹ä¸ä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªé€šé“ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ï¼Œè€Œæ˜¯<strong>å¤šä¸ªå®¢æˆ·ç«¯å…±ç”¨ä¸€ä¸ªIOçº¿ç¨‹</strong>ï¼Œç”±IOçº¿ç¨‹æŠŠæ”¶é›†åˆ°çš„å‘½ä»¤é€šè¿‡å•ä¸ªé€šé“å‘é€ç»™ä¸»çº¿ç¨‹å¤„ç†ã€‚</p><p>è¿™æ ·åšå¸¦æ¥äº†å“ªäº›å¥½å¤„ï¼Ÿå…·ä½“æ¥è¯´ï¼š</p><ol type="1"><li>å¢å¼ºå‹ I/Oå¤šè·¯å¤ç”¨å°†æºè‡ªå¤šä¸ªå®¢æˆ·ç«¯ï¼ˆæœ‰æ—¶æ˜¯æ•°åƒä¸ªï¼‰çš„å‘½ä»¤ç»„åˆåˆ°å°‘é‡é€šé“ä¸­ï¼Œåœ¨ç›¸åŒè¿æ¥æ•°ä¸‹é€šé“çš„æ•°é‡æ›´å°‘ï¼Œæé«˜äº†ååé‡ã€‚</li><li>é€šé“æ•°é‡çš„å‡å°‘å¢åŠ äº†<strong>è®¿é—®å±€éƒ¨æ€§</strong>ï¼Œä»è€Œæé«˜äº†å†…å­˜ç¼“å­˜çš„ä½¿ç”¨ç‡ã€‚</li><li>ç¼“å­˜çš„å‘½ä¸­ç‡æé«˜ï¼Œäºæ˜¯å‘½ä»¤çš„å¹³å‡æ‰§è¡Œæ—¶é—´å‡å°‘ï¼Œé™ä½äº†å»¶è¿Ÿã€‚</li></ol><h2 id="è¡¨ç¤ºå±‚å¸è½½">è¡¨ç¤ºå±‚å¸è½½</h2><p>7.1 ç‰ˆæœ¬å¼•å…¥è¡¨ç¤ºå±‚å¸è½½ï¼ˆRedis presentation layeroffloadingï¼‰ï¼ŒæŒ‡çš„æ˜¯å®¢æˆ·ç«¯å‘½ä»¤çš„è§£ææ“ä½œã€‚å¢å¼ºå‹ IOå¤šè·¯å¤ç”¨æŠŠç½‘ç»œIOçš„å¤„ç†äº¤ç»™äº†å•ç‹¬çš„IOçº¿ç¨‹ï¼Œè€Œ<strong>è¡¨ç¤ºå±‚å¸è½½åœ¨æ­¤åŸºç¡€ä¸Šæ›´è¿›ä¸€æ­¥ï¼Œè®©IO çº¿ç¨‹é¡ºä¾¿æŠŠå®¢æˆ·ç«¯çš„å‘½ä»¤è§£æä¸º RedisäºŒè¿›åˆ¶å‘½ä»¤çš„æ ¼å¼ï¼Œç„¶åè½¬å‘åˆ°ä¸»çº¿ç¨‹è¿›è¡Œ</strong>ã€‚è¿™æ ·æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ol type="1"><li>å¤šä¸ªCPU<strong>å¹¶è¡Œ</strong>å¤„ç†ç½‘ç»œ IOå’Œè§£æå‘½ä»¤çš„å·¥ä½œï¼Œå……åˆ†åˆ©ç”¨åˆ°æ¯ä¸€ä¸ªCPUæ ¸å¿ƒï¼Œå¤§å¤§æå‡æ‰§è¡Œæ•ˆç‡</li><li>ä¸»çº¿ç¨‹åªéœ€è¦ä¸“æ³¨äºè¿è¡Œå‘½ä»¤ï¼Œæé«˜äº†å‘½ä»¤çš„æ‰§è¡Œæ•ˆç‡</li></ol><figure><img src="https://s21.ax1x.com/2025/08/22/pVDDTiV.png"alt="è¡¨ç¤ºå±‚å¸è½½" /><figcaption aria-hidden="true">è¡¨ç¤ºå±‚å¸è½½</figcaption></figure><h2 id="å†…å­˜è®¿é—®æ‘Šé”€">å†…å­˜è®¿é—®æ‘Šé”€</h2><p>å†…å­˜è®¿é—®æ‘Šé”€ï¼ˆMemory accessamortizationï¼‰æ˜¯ä¸ºäº†è§£å†³éšæœºå†…å­˜è®¿é—®å¼€é”€è¿‡å¤§çš„é—®é¢˜ï¼Œæ—¨åœ¨é™ä½å†…å­˜è®¿é—®æˆæœ¬ï¼Œé™ä½å»¶è¿Ÿã€‚åœ¨7.1ç‰ˆæœ¬å¼•å…¥ã€‚</p><p>Redisæ‰§è¡Œå‘½ä»¤æ—¶ç»å¸¸éœ€è¦é€šè¿‡å­—å…¸å»å¯»æ‰¾keyï¼Œå¯¹äºéœ€è¦æŸ¥æ‰¾å¤šä¸ªkeyçš„æƒ…å†µï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰¾ï¼Œæ‰¾å®Œä¸€ä¸ªå†é‡æ–°è®¿é—®å†…å­˜å¯»æ‰¾ä¸‹ä¸€ä¸ªï¼Œæ¢å¥è¯è¯´<strong>å“ˆå¸Œè¡¨éå†å°†ä¸²è¡Œè¿è¡Œ</strong>ã€‚è€Œå†…å­˜è®¿é—®æ‘Šé”€é‡‡ç”¨çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/08/22/pVDrv6g.png" /></p><p>åˆ†æï¼š</p><ul><li><strong>å¹¶è¡Œè®¿é—®å†…å­˜</strong>ï¼Œé€šè¿‡ <strong>dictPrefetch</strong>æœºåˆ¶ï¼Œå°†å¤šä¸ª IO çº¿ç¨‹çš„è¯»å–è¯·æ±‚åˆå¹¶åˆ°ä¸€èµ·å¹¶è¡Œå¤„ç†ï¼Œå¹¶æŠŠç»“æœæ”¾åˆ°ä¸»çº¿ç¨‹å¯¹åº”CPU æ ¸çš„ L1/L2 ç§æœ‰ç¼“å­˜ä¸­ï¼Œå‡å°‘äº† Redisä¸»çº¿ç¨‹é’ˆå¯¹æ¯ä¸ªå‘½ä»¤éƒ½è¦è¿›è¡Œå†…å­˜è°ƒç”¨çš„æ¶ˆè€—ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li></ul><h2 id="ä¸»ä»å¤åˆ¶ä¼˜åŒ–">ä¸»ä»å¤åˆ¶ä¼˜åŒ–</h2><p>åœ¨ Valkey/Redisè¿›è¡Œä¸»ã€ä»èŠ‚ç‚¹åŒæ­¥çš„æ—¶å€™ï¼Œæœ‰æ—¶éœ€è¦è¿›è¡Œå…¨é‡åŒæ­¥æ“ä½œã€‚æ¯”å¦‚æœ‰æ–°çš„ä»èŠ‚ç‚¹åŠ å…¥ï¼Œæˆ–è€…ä»èŠ‚ç‚¹å’Œä¸»èŠ‚ç‚¹å¤åˆ¶å»¶è¿Ÿè¿‡å¤§è€Œä¸»èŠ‚ç‚¹è®°å½•å˜æ›´buffer æ²¡æœ‰å…¨éƒ¨æ›´æ–°æ•°æ®æ—¶ï¼Œéƒ½ä¼šè§¦å‘æ–°çš„å…¨é‡åŒæ­¥æ“ä½œã€‚Valkey 8.0é€šè¿‡<strong>åŒé€šé“ä¼ è¾“</strong>çš„æœºåˆ¶ï¼Œä¼˜åŒ–äº†å…¨é‡åŒæ­¥ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹èƒ½é™ä½50% å…¨é‡åŒæ­¥çš„æ—¶é—´ï¼Œå¹¶å‡å°‘ 60% çš„å¤åˆ¶æ•°æ®å†…å­˜ã€‚</p><p>å…¨é‡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šç”Ÿæˆ RDB æ–‡ä»¶ï¼ŒåŒæ—¶ä¼šå°†ç”Ÿæˆ RDBè¿‡ç¨‹ä¸­çš„ã€å¢é‡æ›´æ”¹ä¿¡æ¯ã€‘å­˜å‚¨åœ¨ä¸“é—¨çš„ <strong>client outputbuffer</strong> ä¸­ã€‚RDB ç”Ÿæˆå®Œæ¯•åï¼Œä¸»èŠ‚ç‚¹ä¼šå°† RDBæ–‡ä»¶ä¼ è¾“ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ‹¿åˆ° RDB æ–‡ä»¶å¹¶ apply åï¼Œä¼šç»§ç»­ä»ä¸»èŠ‚ç‚¹è¯»å–client output buffer ä¸­çš„<strong>å¢é‡æ—¥å¿—</strong>ã€‚Valkey 7.2/Redisåœ¨ç”Ÿæˆ RDB æ–‡ä»¶è¿‡ç¨‹ä¸­é‡‡ç”¨çš„ Copy-on-Write çš„æœºåˆ¶ï¼Œå³å…ˆ forkä¸€ä¸ªè¿›ç¨‹ï¼ŒæŒ‡å‘ç›¸åŒçš„å†…å­˜ç©ºé—´ã€‚åœ¨ç”Ÿæˆ RDBæ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‰ç«¯åº”ç”¨ä¿®æ”¹äº†éƒ¨åˆ†æ•°æ®ï¼ŒValkey/Redisä¼šå¯¹ä¿®æ”¹çš„æ•°æ®é¡µè¿›è¡Œä¸€ä¸ªæ‹·è´ï¼Œå¹¶åœ¨æ‹·è´ä¸Šè¿›è¡Œä¿®æ”¹ã€‚å› æ­¤ï¼Œå…¨é‡åŒæ­¥çš„æ—¶é—´ä¼šå½±å“Redis ä¸»èŠ‚ç‚¹çš„æ€§èƒ½ã€‚</p><p>Valkey 8.0 æå‡ºäº†<strong>åŒé€šé“å¤åˆ¶æœºåˆ¶</strong>æ¥åˆ†åˆ«å¤åˆ¶ RDBå’Œå¢é‡æ—¥å¿—ï¼ŒåŒæ—¶å°† client output bufferæ”¾åˆ°ä»èŠ‚ç‚¹ã€‚è¿™æ ·çš„æ”¹è¿›ä½¿å¾—ä¸»èŠ‚ç‚¹åœ¨è¿›è¡Œ RDBæ–‡ä»¶ç”Ÿæˆçš„è¿‡ç¨‹ä¸­ï¼Œå°±å¯ä»¥å°†å¢é‡æ—¥å¿—å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œ<strong>å°†é¡ºåºä¼ è¾“çš„æ–¹å¼æ”¹æˆäº†å¹¶è¡Œä¼ è¾“</strong>ï¼ŒåŠ å¿«äº†åŒæ­¥é€Ÿåº¦ã€‚æ­¤å¤–ï¼Œä»èŠ‚ç‚¹å­˜æ”¾client output bufferï¼Œèƒ½å¤Ÿé‡Šæ”¾å†™èŠ‚ç‚¹çš„èµ„æºï¼Œé¿å… bufferè¿‡è½½ï¼Œå¹¶ä½¿ä¸»èŠ‚ç‚¹æ›´å¥½åœ°åº”å¯¹å‰ç«¯åº”ç”¨çš„è´Ÿè½½ã€‚å¦å¤–ï¼ŒåŒæ­¥é€Ÿåº¦åŠ å¿«ï¼Œä¹Ÿèƒ½å‡å°‘buffer è‡ªèº«çš„å¤§å°ï¼ŒåŒæ—¶å‡å°‘ä¸»èŠ‚ç‚¹ COW çš„æ—¶é—´ï¼Œé™ä½å¯¹å‰ç«¯åº”ç”¨çš„å½±å“ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºLinuxçš„swapåˆ†åŒºçš„å¹¿æ³›è¯¯è§£-swappinesså‚æ•°</title>
    <link href="/2025/08/28/Linux-swappiness/"/>
    <url>/2025/08/28/Linux-swappiness/</url>
    
    <content type="html"><![CDATA[<p><code>swappiness</code>æ˜¯ä¸€ä¸ªå’ŒLinuxç³»ç»Ÿäº¤æ¢åˆ†åŒºçš„è¡Œä¸ºæœ‰å…³çš„å‡½æ•°ã€‚é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥å‚æ•°çš„å€¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/sys/vm/swappiness<br></code></pre></td></tr></table></figure><p><code>sudo nano /etc/sysctl.conf</code>å¯æ°¸ä¹…ä¿®æ”¹æ­¤å‚æ•°ã€‚é»˜è®¤å€¼æ˜¯60.å¾ˆå¤šäººè®¤ä¸ºè¿™ä¸ªå‚æ•°ç»™ç‰©ç†å†…å­˜è®¾å®šäº†ä¸€ä¸ªé˜ˆå€¼ï¼Œå½“ä½¿ç”¨çš„å†…å­˜è¶…è¿‡(100-60)%æ—¶ï¼Œå°±ä¼šå¼€å§‹å†…å­˜äº¤æ¢ï¼ŒæŠŠå†…å­˜ä¸­æœ€è¿œæœªä½¿ç”¨çš„æ•°æ®å†™å…¥swap åˆ†åŒºã€‚ç„¶è€Œè¿™æ ·çš„è¯´æ³•å…¶å®æ˜¯æœ‰å¾ˆå¤§é—®é¢˜çš„ã€‚</p><figure><img src="https://s21.ax1x.com/2025/08/28/pV60hm4.png"alt="é˜¿é‡Œäº‘ä¹Ÿå¹²äº†" /><figcaption aria-hidden="true"><ahref="https://www.alibabacloud.com/help/zh/ecs/support/how-do-i-configure-the-swap-partition-of-a-linux-instance">é˜¿é‡Œäº‘ä¹Ÿå¹²äº†</a></figcaption></figure><h2 id="é—®é¢˜å‘ç°">é—®é¢˜å‘ç°</h2><p>ä»Šå¤©åœ¨ Debian è™šæ‹Ÿæœºä¸Šæµ‹è¯• ElasticSearchï¼Œå› ä¸º esæœ¬èº«å†…å­˜å ç”¨è¾ƒå¤§ï¼Œè€Œæˆ‘åªç»™è™šæ‹Ÿæœºåˆ†äº† 6G å†…å­˜ï¼Œæ‰€ä»¥æ€»å†…å­˜å ç”¨ä¸€ç›´ç»´æŒåœ¨90% å·¦å³ã€‚åæ¥ä½¿ç”¨<code>btop</code>å‘½ä»¤å‘ç° swap åˆ†åŒºå·²ç»æ»¡äº†ï¼š</p><p><img src="https://s21.ax1x.com/2025/08/28/pV6wKVs.png" /></p><p>ç„¶åå» google äº†ä¸€ä¸‹ï¼Œæ’åé å‰çš„æœç´¢ç»“æœéƒ½è¯´ <code>swappiness</code>é»˜è®¤è®¾å®šå½“å†…å­˜å ç”¨è¶…è¿‡ 60% çš„æ—¶å€™å°±ä¼šå¼€å§‹æŠŠæ–‡ä»¶å†™å…¥ swapåˆ†åŒºã€‚ä½†æ˜¯åˆè¿‡äº†ä¸€æ®µæ—¶é—´ï¼ˆæœŸé—´åªæ‰§è¡Œè¿‡å‡ æ¡ esæŸ¥è¯¢å‘½ä»¤ï¼‰ï¼Œ<code>btop</code>æ˜¾ç¤ºï¼š</p><p><img src="https://s21.ax1x.com/2025/08/28/pV6wMan.png" /></p><p>æ€»å†…å­˜å ç”¨å‡ ä¹ä¿æŒä¸å˜ï¼Œä½†æ˜¯ swapåˆ†åŒºè¢«æ¸…ç©ºäº†ï¼ŸæŒ‰ç†æ¥è¯´ä¸åº”è¯¥æ˜¯å†…å­˜å ç”¨é™ä¸‹å»ä¹‹åæ‰æŠŠswapçš„æ•°æ®å†™å›å†…å­˜å—ã€‚è¿™è¯´æ˜è¿™ä¸ªè¯´æ³•å¤šå°‘æ˜¯æœ‰ç‚¹é—®é¢˜çš„ã€‚</p><h2 id="æ’æŸ¥">æ’æŸ¥</h2><p>åœ¨Googleä¸Šæœç´¢"Linuxå¦‚ä½•ä½¿ç”¨swapåˆ†åŒº"ï¼Œç„¶åæ‰¾åˆ°äº†<ahref="https://wiki.archlinuxcn.org/wiki/Swap">ArchWikiçš„æ¡ç›®</a>ï¼Œé‡Œé¢æåˆ°ï¼š</p><blockquote><p>æœ‰ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯<code>swappiness</code>ä¼šå½±å“å†…å­˜é˜ˆå€¼æˆ–é˜»æ­¢ä½¿ç”¨äº¤æ¢ç©ºé—´ï¼Œä½†å®ƒåªå½±å“é‡Šæ”¾æ–‡ä»¶é¡µé¢è€Œä¸æ˜¯äº¤æ¢çš„åå¥½ã€‚æœ‰å…³æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·å‚é˜…<ahref="https://www.howtogeek.com/449691/what-is-swapiness-on-linux-and-how-to-change-it/">è¿™ç¯‡æ–‡ç« </a>æˆ–<ahref="https://github.com/torvalds/linux/blob/v6.2/mm/vmscan.c#L3000-L3014">å†…æ ¸æºä»£ç </a>ä¸­å®ƒçš„ä½¿ç”¨ã€‚</p></blockquote><p>ä¸‹é¢ç®€å•æ€»ç»“ä¸€ä¸‹ã€‚</p><h2 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</h2><h3 id="linuxçš„å†…å­˜ç»“æ„">Linuxçš„å†…å­˜ç»“æ„</h3><p>Linuxç³»ç»Ÿå¹¶ä¸ä¼šæŠŠå†…å­˜çœ‹ä½œä¸€æ•´ä¸ªå·¨å¤§çš„å†…å­˜æ± ï¼Œè€Œæ˜¯æŠŠå†…å­˜åˆ’åˆ†æˆä¸åŒçš„<strong>åŒºåŸŸ</strong>ï¼ˆ<code>Zone</code>ï¼‰ã€‚x86æ¶æ„çš„ç®€åŒ–å†…å­˜åŒºåŸŸå¦‚ä¸‹ï¼š</p><ul><li>DMAï¼šç‰©ç†å†…å­˜çš„ä½16MBåŒºåŸŸ</li><li>DMA32ï¼š<strong>åªå­˜åœ¨äº64ä½ Linuxä¸­</strong>ï¼Œç›®çš„æ˜¯å…¼å®¹32ä½çš„DMAç¡¬ä»¶è®¾å¤‡ã€‚å¯¹åº”ç‰©ç†å†…å­˜çš„ä½4GBã€‚è¿™æ˜¯ä¸€ç§<strong>é€»è¾‘ä¸Šçš„åˆ†åŒº</strong>ï¼Œ64ä½DMAè®¾å¤‡å¯ä»¥è®¿é—®å…¨éƒ¨çš„å†…å­˜ï¼Œ32ä½DMAè®¾å¤‡åªèƒ½è®¿é—®ä½4GBçš„å†…å­˜ã€‚</li><li>Normalï¼šåœ¨ 64 ä½è®¡ç®—æœºä¸Šï¼ŒNormal åŒºæ˜¯æ‰€æœ‰ é«˜äº 4 GBçš„å†…å­˜ï¼ˆå¤§è‡´ä¸Šï¼‰ã€‚åœ¨ 32 ä½è®¡ç®—æœºä¸Šï¼Œå®ƒæ˜¯ 16 MB åˆ° 896 MB ä¹‹é—´çš„RAMã€‚</li><li>HighMemï¼šè¿™ä¸ªåŒºåŸŸ<strong>åªå­˜åœ¨äº 32 ä½ Linux ä¸­</strong>ã€‚å®ƒæŒ‡çš„æ˜¯æ‰€æœ‰é«˜äº 896 MB çš„å†…å­˜ï¼Œåœ¨æ‹¥æœ‰è¶³å¤Ÿå¤§å†…å­˜çš„æœºå™¨ä¸Šï¼Œè¿˜åŒ…æ‹¬é«˜äº 4 GBçš„éƒ¨åˆ†ã€‚</li></ul><h3 id="åŒºåŸŸzoneå’ŒèŠ‚ç‚¹node">åŒºåŸŸ(Zone)å’ŒèŠ‚ç‚¹(Node)</h3><p><strong>åŒºåŸŸï¼ˆZoneï¼‰ä¸èŠ‚ç‚¹ï¼ˆNodeï¼‰ç›¸å…³è”ï¼ŒèŠ‚ç‚¹åˆä¸CPUå…³è”ã€‚å†…æ ¸é€šè¿‡ä¸CPU å…³è”çš„èŠ‚ç‚¹ä¸ºè¿›ç¨‹åˆ†é…å†…å­˜ã€‚</strong></p><p>ä¸€èˆ¬çš„Linuxè®¡ç®—æœºåªæœ‰ä¸€ä¸ª<code>Node 0</code>èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„ Zoneéƒ½å±äºè¿™ä¸ªèŠ‚ç‚¹ã€‚è¦æŸ¥çœ‹è®¡ç®—æœºä¸­çš„èŠ‚ç‚¹å’ŒåŒºåŸŸï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">less /proc/buddyinfo<br></code></pre></td></tr></table></figure><p>6GBåŒæ ¸è™šæ‹Ÿæœºè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Node</span> <span class="hljs-number">0</span>, zone      DMA      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span>      <span class="hljs-number">1</span>      <span class="hljs-number">3</span> <br><span class="hljs-attribute">Node</span> <span class="hljs-number">0</span>, zone    DMA32    <span class="hljs-number">388</span>    <span class="hljs-number">213</span>    <span class="hljs-number">142</span>    <span class="hljs-number">143</span>     <span class="hljs-number">56</span>     <span class="hljs-number">20</span>      <span class="hljs-number">6</span>      <span class="hljs-number">7</span>      <span class="hljs-number">3</span>      <span class="hljs-number">1</span>      <span class="hljs-number">5</span> <br><span class="hljs-attribute">Node</span> <span class="hljs-number">0</span>, zone   Normal    <span class="hljs-number">195</span>   <span class="hljs-number">1297</span>    <span class="hljs-number">966</span>    <span class="hljs-number">279</span>    <span class="hljs-number">116</span>     <span class="hljs-number">55</span>     <span class="hljs-number">37</span>     <span class="hljs-number">13</span>      <span class="hljs-number">6</span>      <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <br></code></pre></td></tr></table></figure><p>ä»å·¦åˆ°å³ï¼Œæ¯ä¸€åˆ—åˆ†åˆ«è¡¨ç¤º4KB 8KB 16KBç­‰ç­‰ï¼ˆå› ä¸ºå†…å­˜æ˜¯ä»¥4KBä¸ºå•ä½è¿›è¡Œåˆ†é…çš„ï¼‰ï¼Œæ•°å­—è¡¨ç¤ºä¸åŒå—çš„æ•°é‡ã€‚</p><p>å¦‚æœæ€»ç‰©ç†å†…å­˜å°äº4GBï¼Œé‚£ä¹ˆå°†ä¸ä¼šæœ‰<code>Normal</code>åŒºåŸŸã€‚</p><h3 id="æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µ">æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µ</h3><p>é¡µè¡¨ä¸­çš„å†…å­˜æ˜ å°„å¯ä»¥æ˜¯ï¼š</p><ul><li><strong>æ–‡ä»¶é¡µ(File backed)</strong>:é¡µè¡¨é¡¹æ¥æºäºç£ç›˜ä¸­çš„æ–‡ä»¶ï¼Œè¿™ç§å†…å­˜æ˜ å°„åŒ…å«å·²ç»ä»ä»»æ„ç±»å‹æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®ã€‚å¦‚æœç³»ç»Ÿé‡Šæ”¾äº†è¿™å—å†…å­˜ï¼Œä¸‹æ¬¡è¯»å–è¯¥æ–‡ä»¶çš„æ—¶å€™å°±å¿…é¡»è®¿é—®ç£ç›˜ã€‚åœ¨é‡Šæ”¾å†…å­˜ä¹‹å‰ï¼Œå¦‚æœå†…å­˜ä¸­çš„æ•°æ®å·²è¢«ä¿®æ”¹ï¼Œéœ€è¦å…ˆåŒæ­¥åˆ°ç£ç›˜ï¼Œç„¶åæ‰èƒ½é‡Šæ”¾ï¼Œé˜²æ­¢ä¿®æ”¹ä¸¢å¤±ã€‚</li><li><strong>åŒ¿åé¡µ(Anonymous)</strong>ï¼šåŒ¿åå†…å­˜ä¸æ˜ å°„åˆ°ä»»ä½•æ–‡ä»¶å’Œè®¾å¤‡ï¼Œä¸€èˆ¬æ˜¯ç¨‹åºåŠ¨æ€è¯·æ±‚çš„å†…å­˜ã€å †æ ˆç­‰ã€‚è¿™ç§æ•°æ®å¹¶éæ¥è‡ªç£ç›˜æ–‡ä»¶æˆ–è®¾å¤‡ï¼Œè€Œæ˜¯åŠ¨æ€äº§ç”Ÿçš„ï¼Œæ‰€ä»¥å¿…é¡»åœ¨ç£ç›˜å•ç‹¬ç•™ä¸€ä¸ªä¸“é—¨çš„ç©ºé—´æ¥å­˜å‚¨å®ƒä»¬ï¼Œè¿™ä¸ªç©ºé—´å°±æ˜¯swap åˆ†åŒºæˆ–è€… swapæ–‡ä»¶ã€‚åœ¨åŒ¿åæ•°æ®é¡µè¢«å†…å­˜é‡Šæ”¾ä¹‹å‰ï¼Œå…¶ä¸­çš„æ•°æ®ä¼šè¢«å†™å…¥swapç©ºé—´ã€‚</li><li><strong>è®¾å¤‡é¡µ</strong>(Devicebacked)ï¼šLinuxç³»ç»Ÿé€šè¿‡å—è®¾å¤‡æ–‡ä»¶è®¿é—®è®¾å¤‡ï¼Œè¿™æ ·å¯ä»¥åƒå¤„ç†æ–‡ä»¶ä¸€æ ·ä»ä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚è®¾å¤‡æ”¯æŒçš„å†…å­˜æ˜ å°„ï¼ˆdevicebacked memorymappingï¼‰ï¼Œå°±æ˜¯æŒ‡æ˜ å°„çš„å†…å­˜åŒºåŸŸèƒŒåå®é™…å­˜æ”¾çš„æ˜¯æŸä¸ªè®¾å¤‡çš„æ•°æ®ã€‚</li><li><strong>å…±äº«é¡µ</strong>(Shared)ï¼šä¸åŒçš„é¡µè¡¨é¡¹å¯ä»¥æ˜ å°„åˆ°å†…å­˜çš„åŒä¸€åŒºåŸŸï¼Œè¿™æ ·ä¸åŒçš„è¿›ç¨‹å¯ä»¥éå¸¸é«˜æ•ˆåœ°é€šä¿¡ã€‚</li><li><strong>å†™æ—¶å¤åˆ¶</strong>ï¼šä¸€ç§æƒ°æ€§åˆ†é…æŠ€æœ¯ï¼Œå¦‚æœè¯·æ±‚å¤åˆ¶å†…å­˜ä¸­å·²æœ‰çš„èµ„æºï¼Œåˆ™è¿”å›æŒ‡å‘åŸå§‹èµ„æºçš„æ˜ å°„ã€‚å¦‚æœå…±äº«è¯¥èµ„æºçš„æŸä¸ªè¿›ç¨‹å°è¯•å†™å…¥è¯¥èµ„æºï¼Œæ‰ä¼šæŠŠèµ„æºçœŸæ­£å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ä¸­ï¼Œç„¶åæ‰èƒ½å…è®¸ä¿®æ”¹ã€‚å³ï¼Œå†™å…¥å‘½ä»¤åªåœ¨ç¬¬ä¸€ä¸ªå†™å…¥å‘½ä»¤æ—¶è¿›è¡Œã€‚</li></ul><p>ä¸ºäº†ç†è§£<code>swappiness</code>ï¼Œåªéœ€è¦å…³å¿ƒå‰ä¸¤é¡¹ã€‚</p><h2 id="swappiness">Swappiness</h2><p>Linuxå†…æ ¸æ–‡æ¡£æ˜¯è¿™æ ·æè¿° swappiness çš„ï¼š</p><blockquote><p>æ­¤å‚æ•°ç”¨äºå®šä¹‰å†…æ ¸äº¤æ¢å†…å­˜é¡µçš„ç§¯æç¨‹åº¦ï¼Œå€¼ä¸º 0è¡¨ç¤ºåœ¨ç©ºé—²é¡µé¢å’Œæ–‡ä»¶é¡µé¢çš„æ•°é‡ä½äºé«˜æ°´ä½çº¿ä¹‹å‰ï¼Œå†…æ ¸ä¸ä¼šå¯åŠ¨swapè¿‡ç¨‹ã€‚é»˜è®¤å€¼æ˜¯60.</p></blockquote><p>è¿™é‡ŒæŒ‡å‡ºï¼Œå°†<code>swappiness</code>è®¾ç½®ä¸º 0çš„è¯å¹¶ä¸ä¼šå…³é—­äº¤æ¢åŠŸèƒ½ï¼Œåªæ˜¯å‘Šè¯‰å†…æ ¸åœ¨æ»¡è¶³æŸäº›æ¡ä»¶ä¹‹å‰ï¼ˆâ€œé«˜æ°´ä½çº¿â€ï¼‰ä¸ä¼šå¯åŠ¨äº¤æ¢ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯ä¼šå‘ç”Ÿäº¤æ¢çš„ã€‚</p><p>åœ¨<ahref="https://github.com/torvalds/linux/blob/master/mm/vmscan.c#L176">å†…æ ¸æºæ–‡ä»¶</a>ä¸­åŒ…å«ä¸‹é¢å‡ è¡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * From 0 .. MAX_SWAPPINESS.  Higher means more swappy.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> vm_swappiness = <span class="hljs-number">60</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæåˆ°<code>swappiness</code>çš„å–å€¼èŒƒå›´æ˜¯ 0 ..MAX_SWAPPINESSã€‚åœ¨<code>linux/include/linux/swap.h</code>å¯ä»¥æ‰¾åˆ°è¿™ä¸ªå®å®šä¹‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_SWAPPINESS 200</span><br></code></pre></td></tr></table></figure><p><ahref="https://github.com/torvalds/linux/blob/master/include/linux/swap.h#L417">ä»£ç åœ°å€</a></p><blockquote><p>é¡ºä¾¿ä¸€æï¼Œ<code>MAX_SWAPPINESS</code>åœ¨æ›´æ—©çš„ç‰ˆæœ¬æ˜¯ç¡¬ç¼–ç åœ¨ä»£ç ä¸­çš„ï¼Œè€Œä¸”å–å€¼ä¸º100ï¼Œè€Œä¸æ˜¯200ã€‚è¿™ä¸€éƒ¨åˆ†çš„æºç åœ¨5.8ç‰ˆæœ¬åå‘ç”Ÿäº†æ¯”è¾ƒå¤§çš„ä¿®æ”¹ï¼Œä¸<ahref="https://www.howtogeek.com/449691/what-is-swapiness-on-linux-and-how-to-change-it/">è¿™ç¯‡æ–‡ç« </a>å±•ç¤ºçš„ä»£ç å·®åˆ«å¾ˆå¤§ã€‚</p></blockquote><p><strong>ä¹Ÿå°±æ˜¯è¯´<code>swappiness</code>çš„å–å€¼èŒƒå›´æ˜¯0åˆ°200</strong>ï¼Œæ‰€ä»¥ä¹‹å‰æ‰€è°“çš„<code>swappiness</code>æ˜¯ä¸ºå†…å­˜äº¤æ¢è®¾å®šäº†ä¸€ä¸ªé˜ˆå€¼çš„è¯´æ³•æ˜¯<strong>ä¸æˆç«‹çš„</strong>ï¼Œå¦‚æœæˆ‘æŠŠå®ƒè®¾ä¸ºå¤§äº100 ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè´Ÿæ•°é˜ˆå€¼å˜›ã€‚</p><p>ç»§ç»­æŒ–<code>vmscan.c</code>è¿™ä¸ªæºæ–‡ä»¶ï¼Œå¯ä»¥æ‰¾åˆ°ä¸‹é¢çš„<ahref="https://github.com/torvalds/linux/blob/master/mm/vmscan.c#L2448">ä»£ç </a>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title function_">calculate_pressure_balance</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> scan_control *sc,</span><br><span class="hljs-params"><span class="hljs-type">int</span> swappiness, u64 *fraction, u64 *denominator)</span><br>&#123;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> anon_cost, file_cost, total_cost;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ap, fp;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Calculate the pressure balance between anon and file pages.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * The amount of pressure we put on each LRU is inversely</span><br><span class="hljs-comment"> * proportional to the cost of reclaiming each list, as</span><br><span class="hljs-comment"> * determined by the share of pages that are refaulting, times</span><br><span class="hljs-comment"> * the relative IO cost of bringing back a swapped out</span><br><span class="hljs-comment"> * anonymous page vs reloading a filesystem page (swappiness).</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Although we limit that influence to ensure no list gets</span><br><span class="hljs-comment"> * left behind completely: at least a third of the pressure is</span><br><span class="hljs-comment"> * applied, before swappiness.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * With swappiness at 100, anon and file have equal IO cost.</span><br><span class="hljs-comment"> */</span><br>    <span class="hljs-comment">// è®¡ç®—æˆæœ¬</span><br>total_cost = sc-&gt;anon_cost + sc-&gt;file_cost;<br>anon_cost = total_cost + sc-&gt;anon_cost;<br>file_cost = total_cost + sc-&gt;file_cost;<br>total_cost = anon_cost + file_cost;<br><br>ap = swappiness * (total_cost + <span class="hljs-number">1</span>); <span class="hljs-comment">// åŒ¿åé¡µå‹åŠ›ï¼Œéšswappinesså¢å¤§è€Œå¢å¤§</span><br>ap /= anon_cost + <span class="hljs-number">1</span>;                <span class="hljs-comment">// æˆæœ¬è¶Šå¤§ï¼Œå‹åŠ›è¶Šå°</span><br><br>fp = (MAX_SWAPPINESS - swappiness) * (total_cost + <span class="hljs-number">1</span>);<span class="hljs-comment">//æ–‡ä»¶é¡µå‹åŠ›ï¼Œéšswappinesså¢å¤§è€Œå‡å°</span><br>fp /= file_cost + <span class="hljs-number">1</span>;<br><br>fraction[WORKINGSET_ANON] = ap; <span class="hljs-comment">// åŒ¿åé¡µå‹åŠ›æ¯”ä¾‹</span><br>fraction[WORKINGSET_FILE] = fp; <span class="hljs-comment">// æ–‡ä»¶é¡µå‹åŠ›æ¯”ä¾‹</span><br>*denominator = ap + fp;         <span class="hljs-comment">// æ€»å‹åŠ›</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å‹åŠ›æŒ‡çš„æ˜¯LRUåˆ—è¡¨è¢«æ‰«æå’Œå›æ”¶çš„å¼ºåº¦ï¼Œå‹åŠ›æœ€ç»ˆä¼šè¢«è½¬æ¢ä¸ºæ‰«æçš„é¡µæ•°ã€‚å‹åŠ›è¶Šå¤§ï¼Œ<strong>é‡Šæ”¾é¡µ</strong>çš„ä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚å¯¹äºæ–‡ä»¶é¡µï¼Œé‡Šæ”¾æ„å‘³ç€å†™å…¥ç£ç›˜ï¼›å¯¹äºåŒ¿åé¡µï¼Œé‡Šæ”¾æ„å‘³ç€å†™å…¥äº¤æ¢åŒºã€‚</p></blockquote><p>æœ€å…³é”®çš„æœ‰ä¸¤è¡Œï¼š</p><ul><li><code>ap = swappiness * (total_cost + 1)</code></li><li><code>fp = (MAX_SWAPPINESS - swappiness) * (total_cost + 1)</code></li></ul><p>å‹åŠ›ä»£è¡¨çš„æ˜¯å›æ”¶çš„ä¼˜å…ˆçº§ï¼Œå‹åŠ›è¶Šå¤§å°±æ„å‘³ç€IOæˆæœ¬è¶Šå°ï¼Œè¶Šä¼˜å…ˆè¿›è¡Œã€‚<strong>ä¸Šé¢ä¸¤è¡Œè¯´æ˜åŒ¿åé¡µå’Œæ–‡ä»¶é¡µçš„å‹åŠ›æ˜¯æ­¤æ¶ˆå½¼é•¿çš„å…³ç³»ï¼Œå¹¶ä¸”å½“swappiness=100æ—¶ï¼Œä¸¤è¾¹çš„å‹åŠ›ç›¸ç­‰ï¼Œå³åŒ¿åé¡µå’Œæ–‡ä»¶é¡µçš„é‡Šæ”¾æˆæœ¬ç›¸åŒ</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ³¨é‡Šçš„æœ€åä¸€è¡Œè¯´<em>With swappiness at 100, anon and file have equal IO cost.</em></p><h2 id="é»„é‡‘æ¯”ä¾‹">é»„é‡‘æ¯”ä¾‹</h2><p>å¯¹äºæ–‡ä»¶é¡µæ¥è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥é€šè¿‡ä»<strong>ç£ç›˜</strong>ä¸­è¯»å–æ–‡ä»¶æ¥å¡«å……å†…å­˜ä¸­çš„æ•°æ®é¡µï¼Œ<strong>æ‰€ä»¥æ–‡ä»¶é¡µæ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦å†™å…¥swapåŒºçš„</strong>ï¼Œé‡Šæ”¾æ–‡ä»¶é¡µçš„è¯ç›´æ¥å†™å…¥å®ƒåœ¨ç£ç›˜ä¸­çš„åŸæ¥ä½ç½®å°±è¡Œäº†ã€‚</p><p>å¯¹äºåŒ¿åé¡µï¼Œå†…å­˜ä¸­çš„æ•°æ®æ²¡æœ‰ä¸ç£ç›˜ç›¸å…³è”ï¼Œå› ä¸ºæ˜¯åŠ¨æ€è·å–çš„ã€‚ä¸ºäº†åœ¨é‡Šæ”¾ä»¥åèƒ½å¤ŸæŠŠåŒ¿åé¡µé¢æ¢å¤è¿‡æ¥ï¼Œéœ€è¦æŠŠå®ƒå­˜å‚¨åœ¨äº¤æ¢åŒºã€‚</p><p>æ— è®ºæ–‡ä»¶é¡µè¿˜æ˜¯åŒ¿åé¡µï¼Œé‡Šæ”¾å†…å­˜çš„æ—¶å€™éƒ½ä¼šå†™å…¥ç£ç›˜ï¼Œç”±æ–‡ä»¶ç³»ç»Ÿç®¡ç†ï¼Œè¯»æ•°æ®çš„è¯éƒ½è¦è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿreadï¼Œæ‰€ä»¥è¯´è¿™ä¸¤ç§é¡µé¢å›æ”¶æ“ä½œçš„æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä»å‰é¢ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæ–‡ä»¶é¡µå’ŒåŒ¿åé¡µçš„å›æ”¶å¼ºåº¦æ˜¯æ­¤æ¶ˆå½¼é•¿çš„ï¼Œè¯•å›¾é€šè¿‡æœ€å°åŒ–åŒ¿åé¡µçš„äº¤æ¢æ¥å‡å°‘ç£ç›˜IOåªä¼šå¢åŠ æ–‡ä»¶é¡µè¯»å†™çš„IOã€‚</p><p><code>swappiness</code>ä¸ä¼šè®¾ç½®ä»»ä½•é˜ˆå€¼æ¥å†³å®šä½•æ—¶ä½¿ç”¨äº¤æ¢ç©ºé—´ï¼Œå®ƒä¸»è¦æ˜¯å†³å®šäº†å†…æ ¸é‡Šæ”¾æ•°æ®é¡µçš„<strong>å€¾å‘</strong>ã€‚å½“éœ€è¦é‡Šæ”¾å†…å­˜æ—¶ï¼Œå›æ”¶å’Œäº¤æ¢ç®—æ³•ä¼šè€ƒè™‘<code>ap</code>å’Œ<code>fp</code>ä»¥åŠå®ƒä»¬ä¹‹é—´çš„æ¯”ç‡ï¼Œä»¥ç¡®å®šä¼˜å…ˆè€ƒè™‘é‡Šæ”¾å“ªäº›ç±»å‹çš„é¡µé¢ã€‚è¿™ç¡®å®šäº†ç¡¬ç›˜æ˜¯å…ˆå¤„ç†ç£ç›˜æ–‡ä»¶ï¼Œè¿˜æ˜¯å¤„ç†åŒ¿åé¡µçš„äº¤æ¢åˆ†åŒº/äº¤æ¢æ–‡ä»¶ã€‚</p><p>è‡³äºä»€ä¹ˆæ—¶å€™æ‰ä¼šçœŸæ­£å¯ç”¨äº¤æ¢ç©ºé—´ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ†ææš‚æ—¶ç¡®å®šçš„æ˜¯<code>swappiness</code>å†³å®šäº†Linuxå†…æ ¸ä¼šä¼˜å…ˆè€ƒè™‘é‡Šæ”¾å†…å­˜ä¸­çš„æ–‡ä»¶é¡µè¿˜æ˜¯åŒ¿åé¡µã€‚å®é™…ä¸Šå†³å®šäº¤æ¢ç©ºé—´ä½•æ—¶å¯ç”¨çš„æ˜¯<strong>æ°´ä½çº¿</strong>ã€‚æ¯ä¸ªå†…å­˜åŒºåŸŸéƒ½æœ‰ä¸€ä¸ªé«˜æ°´ä½çº¿å’Œä¸€ä¸ªä½æ°´ä½çº¿ã€‚è¿™äº›å€¼ç”±ç³»ç»Ÿäº§ç”Ÿï¼Œæ˜¯æ¯ä¸ªåŒºåŸŸRAMçš„ç™¾åˆ†æ¯”ï¼Œè¢«ç”¨ä½œäº¤æ¢ç©ºé—´çš„è§¦å‘é˜ˆå€¼ã€‚è¦æ£€æŸ¥é«˜æ°´ä½çº¿å’Œä½æ°´ä½çº¿ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹<code>less /proc/zoneinfo</code>æ¯ä¸ªåŒºåŸŸéƒ½æœ‰ä¸€ç»„ä»¥é¡µä¸ºå•ä½çš„å†…å­˜å€¼ï¼Œä¾‹å¦‚ä¸‹é¢æ˜¯DMA32åŒºåŸŸçš„æƒ…å†µï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Node</span> <span class="hljs-number">0</span>, zone    DMA32<br>  <span class="hljs-attribute">pages</span> free     <span class="hljs-number">17298</span><br>        <span class="hljs-attribute">boost</span>    <span class="hljs-number">0</span><br>        <span class="hljs-attribute">min</span>      <span class="hljs-number">8525</span><br>        <span class="hljs-attribute">low</span>      <span class="hljs-number">10656</span><br>        <span class="hljs-attribute">high</span>     <span class="hljs-number">12787</span><br>        <span class="hljs-attribute">spanned</span>  <span class="hljs-number">1044480</span><br>        <span class="hljs-attribute">present</span>  <span class="hljs-number">782304</span><br>        <span class="hljs-attribute">managed</span>  <span class="hljs-number">765920</span><br>        <span class="hljs-attribute">cma</span>      <span class="hljs-number">0</span><br>        <span class="hljs-attribute">protection</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2875</span>, <span class="hljs-number">2875</span>, <span class="hljs-number">2875</span>)<br>      <span class="hljs-attribute">nr_free_pages</span> <span class="hljs-number">17298</span><br>      <span class="hljs-attribute">nr_zone_inactive_anon</span> <span class="hljs-number">715717</span><br>      <span class="hljs-attribute">nr_zone_active_anon</span> <span class="hljs-number">1144</span><br>      <span class="hljs-attribute">nr_zone_inactive_file</span> <span class="hljs-number">9386</span><br>      <span class="hljs-attribute">nr_zone_active_file</span> <span class="hljs-number">11214</span><br>      <span class="hljs-attribute">nr_zone_unevictable</span> <span class="hljs-number">0</span><br>      <span class="hljs-attribute">nr_zone_write_pending</span> <span class="hljs-number">0</span><br>      <span class="hljs-attribute">nr_mlock</span>     <span class="hljs-number">0</span><br>      <span class="hljs-attribute">nr_bounce</span>    <span class="hljs-number">0</span><br>      <span class="hljs-attribute">nr_zspages</span>   <span class="hljs-number">0</span><br>      <span class="hljs-attribute">nr_free_cma</span>  <span class="hljs-number">0</span><br>      <span class="hljs-attribute">numa_hit</span>     <span class="hljs-number">1135816</span><br>      <span class="hljs-attribute">numa_miss</span>    <span class="hljs-number">0</span><br>      <span class="hljs-attribute">numa_foreign</span> <span class="hljs-number">0</span><br>      <span class="hljs-attribute">numa_interleave</span> <span class="hljs-number">2</span><br>      <span class="hljs-attribute">numa_local</span>   <span class="hljs-number">1135816</span><br>      <span class="hljs-attribute">numa_other</span>   <span class="hljs-number">0</span><br>  <span class="hljs-attribute">pagesets</span><br>    <span class="hljs-attribute">cpu</span>: <span class="hljs-number">0</span><br>              <span class="hljs-attribute">count</span>: <span class="hljs-number">591</span><br>              <span class="hljs-attribute">high</span>:  <span class="hljs-number">5328</span><br>              <span class="hljs-attribute">batch</span>: <span class="hljs-number">63</span><br>  <span class="hljs-attribute">vm</span> stats threshold: <span class="hljs-number">24</span><br>    <span class="hljs-attribute">cpu</span>: <span class="hljs-number">1</span><br>              <span class="hljs-attribute">count</span>: <span class="hljs-number">2495</span><br>              <span class="hljs-attribute">high</span>:  <span class="hljs-number">5328</span><br>              <span class="hljs-attribute">batch</span>: <span class="hljs-number">63</span><br>  <span class="hljs-attribute">vm</span> stats threshold: <span class="hljs-number">24</span><br>  <span class="hljs-attribute">node_unreclaimable</span>:  <span class="hljs-number">0</span><br>  <span class="hljs-attribute">start_pfn</span>:           <span class="hljs-number">4096</span><br><br></code></pre></td></tr></table></figure><blockquote><p>åœ¨æ­£å¸¸è¿è¡Œæ¡ä»¶ä¸‹ï¼Œå½“æŸä¸ªå†…å­˜åŒºåŸŸï¼ˆzoneï¼‰çš„å¯ç”¨å†…å­˜ä½äºè¯¥åŒºåŸŸçš„ä½æ°´ä½çº¿ï¼ˆlowwatermarkï¼‰æ—¶ï¼Œäº¤æ¢ï¼ˆswapï¼‰ç®—æ³•å°±ä¼šå¼€å§‹æ‰«æå†…å­˜é¡µï¼Œå¯»æ‰¾å¯ä»¥å›æ”¶çš„å†…å­˜ã€‚</p><p>å¦‚æœ Linux çš„ swappiness å€¼è¢«è®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆåªæœ‰å½“æ–‡ä»¶é¡µå’Œç©ºé—²é¡µä¸¤è€…çš„æ€»å’Œä½äºé«˜æ°´ä½çº¿ï¼ˆhigh water markï¼‰æ—¶ï¼Œæ‰ä¼šè§¦å‘ swapã€‚</p></blockquote><h2 id="æ€»ç»“">æ€»ç»“</h2><p><strong>äº¤æ¢åˆ†åŒºä¸ä»…ä»…æ˜¯å†…å­˜ç©ºé—´ä¸å¤Ÿç”¨æ—¶é‡Šæ”¾å†…å­˜çš„æœºåˆ¶ï¼Œè€Œæ˜¯ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„é‡è¦ç»„æˆéƒ¨åˆ†</strong>ï¼Œæ²¡æœ‰å®ƒã€‚Linuxå¾ˆéš¾å®ç°åˆç†çš„å†…å­˜ç®¡ç†ã€‚<code>swappniess</code>å¹¶ä¸ä¼šè®¾ç½®æ‰€è°“çš„äº¤æ¢é˜ˆå€¼ï¼Œ<code>swappniess</code>ä»£è¡¨äº†å†…æ ¸å¯¹äºå†™å…¥äº¤æ¢ç©ºé—´çš„åå¥½ï¼Œè¾ƒä½çš„å€¼ä¼šå¯¼è‡´å†…æ ¸æ›´å€¾å‘äºé‡Šæ”¾æ‰“å¼€çš„æ–‡ä»¶ï¼Œè¾ƒé«˜çš„å€¼ä¼šå¯¼è‡´å†…æ ¸å€¾å‘äºå°†åŒ¿åé¡µå†™å…¥äº¤æ¢ç©ºé—´ï¼Œè€Œå€¼100æ„å‘³ç€IOæˆæœ¬è¢«å‡å®šä¸ºç›¸ç­‰ã€‚ä¸å­˜åœ¨æœ€åˆé€‚çš„<code>swappniess</code>ï¼Œå› ä¸ºä¸åŒçš„è®¾å¤‡æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ã€‚å¯¹äºå¤§éƒ¨åˆ†çš„æ¡Œé¢ç”¨æˆ·ï¼Œä¸éœ€è¦æ”¹åŠ¨è¯¥å€¼ï¼Œ</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç»“åˆValkeyèŠèŠRedisçš„æŒä¹…åŒ–æœºåˆ¶</title>
    <link href="/2025/08/20/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6/"/>
    <url>/2025/08/20/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><p>Valkeyä¸Šå…³äºæŒä¹…åŒ–çš„å¾ˆå¥½çš„å‚è€ƒèµ„æ–™ï¼š<ahref="https://valkey.io/topics/persistence/">https://valkey.io/topics/persistence/</a></p><p>Valkeyçš„å…¨é¢ä»‹ç»ï¼š<ahref="https://aws.amazon.com/cn/blogs/china/introduction-and-analysis-of-the-in-memory-key-value-database-valkey/">æ¨é™ˆå‡ºæ–°â€“ å†…å­˜ key-value æ•°æ®åº“ Valkey ä»‹ç»å’Œå‰–æ</a></p><p>å…³äº<code>fork</code>ï¼šhttps://linux.die.net/man/2/fork</p><h2 id="å‰è¨€">å‰è¨€</h2><p>2024 å¹´ 3 æœˆ 20 æ—¥ï¼ŒRedis Labs å®£å¸ƒä» Redis 7.4 å¼€å§‹ï¼Œå°† BSD-3-clauseæºç ä½¿ç”¨åè®®ä¿®æ”¹ä¸º RSAv2 å’Œ SSPLv1 åè®®ã€‚è¯¥å˜åŒ–æ„å‘³ç€ Redis åœ¨OSIï¼ˆå¼€æ”¾æºä»£ç ä¿ƒè¿›ä¼šï¼‰å®šä¹‰ä¸‹ä¸å†æ˜¯ä¸¥æ ¼çš„å¼€æºäº§å“ã€‚å®é™…ä¸Šï¼ŒRedisé¡¹ç›®çš„è´¡çŒ®é™¤äº† Redis Labsçš„æˆå‘˜å¤–ï¼Œè¿˜æœ‰å¤šä½æ¥è‡ªäºå…¶ä»–å…¬å¸çš„æˆå‘˜ï¼Œè´¡çŒ®æ¯”ä¾‹é€å¹´ä¸Šå‡ï¼Œä»Šå¹´ç”šè‡³è¾¾åˆ°äº†50% å·¦å³ã€‚è¿™äº›æ ¸å¿ƒæˆå‘˜å¯¹ Redis Labs æ›´æ”¹ Redisåè®®çš„å˜åŠ¨å¹¶ä¸è®¤å¯ï¼Œæ‰€ä»¥ç”± Linux åŸºé‡‘ä¼šç»„ç»‡æˆç«‹äº† Valkeyå¼€æºé¡¹ç›®ã€‚Valkey é‡‡ç”¨ BSD æºç ä½¿ç”¨åè®®ï¼Œåœ¨ 2024 å¹´ 4 æœˆ 16 æ—¥æ¨å‡ºäº†7.2.5 ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä» Redis 7.2.4 forkè€Œæ¥ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ— ç¼å®Œæˆåˆ‡æ¢ã€‚</p><p>Arch Linuxäºä»Šå¹´ä¸ŠåŠå¹´æ­£å¼å°†å®˜æ–¹ä»“åº“ä¸­çš„ redis æ›¿æ¢ä¸º Valkeyã€‚</p><p>Arch Linuxå®‰è£… Valkey çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S redis<br></code></pre></td></tr></table></figure><p>è½¯ä»¶åŒ…åªæœ‰ä¸åˆ°10MBï¼Œéå¸¸éå¸¸ç²¾ç®€</p><p>(è™½ç„¶è½¯ä»¶åŒ…çš„åå­—è¿˜æ˜¯redisï¼Œä½†æ˜¯è½¯ä»¶åŒ…æœ¬èº«å·²ç»è¢«æ¢æˆValkeyäº†)</p><p>ç„¶åå¯ç”¨ValkeyæœåŠ¡å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl start valkey<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤<code>valkey-cli</code>å³å¯è¿›å…¥Valkeyå®¢æˆ·ç«¯å·¥å…·ã€‚</p><p>Valkeyå’ŒRedisçš„å‘½ä»¤æ˜¯å®Œå…¨å…¼å®¹çš„ï¼Œæ‰€ä»¥ä¸‹é¢æ¶‰åŠåˆ°Valkeyçš„éƒ¨åˆ†åŒæ ·ä¹Ÿé€‚ç”¨äºRedisã€‚</p><h2 id="æŒä¹…åŒ–æ–¹å¼ç®€ä»‹">æŒä¹…åŒ–æ–¹å¼ç®€ä»‹</h2><p>ä¸¤ç§æ–¹å¼ï¼šRDBå’ŒAOFã€‚RDBè®°å½•æ•°æ®æœ¬èº«ï¼ŒAOFè¿½åŠ è®°å½•æ–‡æœ¬å‘½ä»¤ã€‚é»˜è®¤åªå¯ç”¨äº†RDBï¼ŒAOFä¸å»ºè®®å•ç‹¬ä½¿ç”¨ã€‚</p><p>å¤„ç†è¿™ä¸¤ç§æŒä¹…åŒ–çš„è¿›ç¨‹ç»Ÿä¸€ç§°ä¸º<code>background saving process</code>ï¼Œç»†åˆ†ä¸º<code>background save</code>å’Œ<code>AOF log background rewriting</code>ï¼Œå‰è€…åœ¨åå°å‘ç£ç›˜å†™å…¥RDBæ–‡ä»¶ï¼Œåè€…åœ¨åå°é‡å†™AOFæ–‡ä»¶ã€‚</p><h2 id="rdb">RDB</h2><p>å…¨ç§°ï¼šRedis Database BackupFileï¼Œredosæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>å¿«ç…§</strong>ï¼Œä¹Ÿå°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®è®°å½•åˆ°ç£ç›˜ä¸­ï¼Œé»˜è®¤ä¿å­˜åˆ°<code>/var/lib/valkey/dump.rdb</code>ã€‚æœ‰ä¸¤ä¸ªå‘½ä»¤å¯ä»¥åˆ·ç›˜RDBï¼š</p><ul><li><code>save</code>ï¼šç”±<strong>ä¸»è¿›ç¨‹</strong>æ‰§è¡ŒRDBå†™å…¥ç£ç›˜ï¼ŒåŒæ­¥ä¿å­˜ï¼Œäº§ç”Ÿä¸€ä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§ã€‚</li><li><code>bgsave</code>ï¼šåˆ›å»ºå­è¿›ç¨‹<code>background saving child</code>è´Ÿè´£ä¿å­˜RDBï¼Œä¸»è¿›ç¨‹ä¸å—å½±å“ã€‚</li></ul><h3 id="bgsaveåˆ›å»ºå¿«ç…§æµç¨‹">bgsaveåˆ›å»ºå¿«ç…§æµç¨‹</h3><p>æŠ€æœ¯ï¼š<strong>å†™æ—¶å¤åˆ¶</strong></p><ul><li>åˆ›å»º RDBå¿«ç…§æ–‡ä»¶ï¼Œä½¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨<code>fork()</code>åˆ›å»ºå­è¿›ç¨‹ï¼ˆå¤åˆ¶äº†çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼ŒæŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜åŒºåŸŸï¼‰ï¼Œç„¶åå­è¿›ç¨‹æŠŠè¯»åˆ°çš„æ•°æ®å†™å…¥ç¡¬ç›˜ï¼Œæ›¿æ¢æ—§çš„rdbæ–‡ä»¶ã€‚è€Œä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ã€‚</li><li>ä»è¿™å—ç‰©ç†å†…å­˜çš„è§’åº¦æ¥çœ‹ï¼Œå­è¿›ç¨‹åªæœ‰è¯»æ“ä½œï¼Œä½†æ˜¯çˆ¶è¿›ç¨‹ä¸ä¸€å®šï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¿®æ”¹ã€‚</li><li>ä¸»è¿›ç¨‹å¦‚æœæœ‰æ–°çš„å†™æ“ä½œï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠè¯¥ç‰©ç†åŒºåŸŸå¤åˆ¶ä¸€ä»½ï¼Œä¸»è¿›ç¨‹çš„é¡µè¡¨æ”¹ä¸ºæŒ‡å‘æ–°çš„ç‰©ç†ç©ºé—´ï¼Œç„¶åä¸»è¿›ç¨‹å¯¹è¿™ä¸ªç‰©ç†é¡µè¿›è¡Œå†™æ“ä½œå’Œè¯»æ“ä½œã€‚</li><li>ç¼ºç‚¹ï¼šè‹¥å¿«ç…§æœŸé—´ä¸»è¿›ç¨‹æœ‰å¤§é‡å†™å…¥ï¼Œä¼šé¢‘ç¹å¤åˆ¶é¡µé¢ï¼Œå¯¼è‡´å†…å­˜å ç”¨ç¿»å€ã€‚</li></ul><p><img src="https://s21.ax1x.com/2025/07/20/pV8Q6Z4.png" /></p><p><strong>ç²¾ç®€ç‰ˆï¼š</strong></p><ul><li>Redis fork ä¸€ä¸ªå­è¿›ç¨‹ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå­è¿›ç¨‹å’Œä¸€ä¸ªçˆ¶è¿›ç¨‹ã€‚</li><li>å­è¿›ç¨‹å¼€å§‹å°†æ•°æ®é›†å†™å…¥ä¸´æ—¶ RDB æ–‡ä»¶ã€‚</li><li>å½“å­è¿›ç¨‹å®Œæˆå†™å…¥æ–°çš„ RDB æ–‡ä»¶æ—¶ï¼Œå®ƒå°†<strong>æ›¿æ¢æ—§çš„ RDBæ–‡ä»¶</strong>ã€‚</li></ul><p><strong>RDBçš„ç¼ºç‚¹</strong></p><ul><li>RDBçš„æ‰§è¡Œæ—¶é—´é—´éš”é•¿ã€‚ä¸¤æ¬¡RDBä¹‹é—´çš„å†™å…¥æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©</li><li>forå­è¿›ç¨‹ã€RDBæ–‡ä»¶çš„å‹ç¼©å’Œå†™å…¥éƒ½æ¯”è¾ƒè€—æ—¶</li></ul><h2 id="aof">AOF</h2><h3 id="åŸºç¡€">1.åŸºç¡€</h3><p>å¯ç”¨ AOFçš„å‘½ä»¤ï¼š<code>valkey-cli config set appendonly yes</code></p><p>å…¨ç§°ï¼šAppend OnlyFileï¼Œä»…è¿½åŠ æ–‡ä»¶ã€‚æ¯ä¸€ä¸ªå‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ï¼Œç±»ä¼¼äºé€»è¾‘æ—¥å¿—ã€‚é»˜è®¤é…ç½®ä¸‹ï¼Œæ¯ç§’ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡<code>fsync</code>ï¼Œå°†AOFæ–‡ä»¶åŒæ­¥åˆ°ç£ç›˜ã€‚</p><p>åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼ŒAOFä¸å•å•åªæœ‰ä¸€ä¸ªæ–‡ä»¶ã€‚Valkey å°† AOFæ‹†åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå§‹çš„å•ä¸ª AOFæ–‡ä»¶è¢«æ‹†åˆ†ä¸º<strong>åŸºæœ¬æ–‡ä»¶</strong>ï¼ˆæœ€å¤šåªæœ‰ä¸€ä¸ªï¼‰å’Œ<strong>å¢é‡æ–‡ä»¶</strong>ï¼ˆå¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼‰ã€‚åŸºæœ¬æ–‡ä»¶è¡¨ç¤ºAOF é‡å†™æ—¶æ•°æ®çš„åˆå§‹å¿«ç…§ï¼ˆRDB æˆ– AOF æ ¼å¼ï¼‰ã€‚å¢é‡æ–‡ä»¶åŒ…å«è‡ªä¸Šä¸€ä¸ªåŸºæœ¬AOFæ–‡ä»¶åˆ›å»ºä»¥æ¥çš„å¢é‡æ›´æ”¹ã€‚æ‰€æœ‰è¿™äº›æ–‡ä»¶éƒ½æ”¾åœ¨å•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶ç”±<strong>æ¸…å•æ–‡ä»¶</strong>è¿›è¡Œè·Ÿè¸ªã€‚</p><p>ç”±äºAOFä¼šä¸åŠ æ€è€ƒåœ°è®°å½•ç”¨æˆ·è¾“å…¥çš„æ¯ä¸€è°ƒå‘½ä»¤ï¼ŒAOFæ–‡ä»¶çš„ä½“ç§¯å¾€å¾€æ¯”è¾ƒå¤§ã€‚ä¸ºäº†å»æ‰å†—ä½™çš„å‘½ä»¤ï¼Œç²¾ç®€AOF å¤§å°ï¼Œå¼•å…¥äº† <strong>AOF é‡å†™æœºåˆ¶</strong>ï¼Œé‡æ–°ç”Ÿæˆä½“ç§¯æ›´å°çš„ AOFæ–‡ä»¶ï¼Œè¦†ç›–åŸæ¥çš„æ–‡ä»¶ã€‚<code>bgrewriteaof</code>å¯ä»¥æ‰‹åŠ¨å¼‚æ­¥æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œä¸è¿‡ä¹Ÿæœ‰è‡ªåŠ¨æ‰§è¡Œçš„æœºåˆ¶ã€‚è‡ªåŠ¨æœºåˆ¶è§é…ç½®æ–‡ä»¶ç« èŠ‚ã€‚</p><h3 id="é‡å†™åŸç†">2.é‡å†™åŸç†</h3><p>å’ŒRDBä¸€æ ·ï¼Œæ—¥å¿—é‡å†™ï¼ˆLogrewritingï¼‰ä¹Ÿä½¿ç”¨äº†ç›¸åŒçš„<strong>å†™æ—¶å¤åˆ¶</strong>æŠ€å·§ã€‚</p><ul><li>Valkey forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œäºæ˜¯ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹å’Œä¸€ä¸ªå­è¿›ç¨‹</li><li>å­è¿›ç¨‹å¼€å§‹å‘ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥æ–°çš„ base AOFæ–‡ä»¶</li><li>çˆ¶è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªæ–°çš„å¢é‡AOFæ–‡ä»¶ï¼Œå¾€è¿™é‡Œå†™å…¥æ›´æ–°ã€‚<strong>å¦‚æœå­è¿›ç¨‹çš„é‡å†™å¤±è´¥äº†</strong>ï¼Œé‚£ä¹ˆï¼šæ—§åŸºæœ¬æ–‡ä»¶ã€æ—§å¢é‡æ–‡ä»¶ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå†åŠ ä¸Šæ–°æ‰“å¼€çš„å¢é‡æ–‡ä»¶ï¼Œä¸‰è€…å½¢æˆäº†æ–°çš„å®Œæ•´çš„AOFæ–‡ä»¶ï¼Œæ‰€ä»¥æ²¡æœ‰å®‰å…¨é—®é¢˜</li><li><strong>å­è¿›ç¨‹é‡å†™æˆåŠŸä»¥å</strong>ï¼Œçˆ¶è¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªä¿¡å·ï¼Œç”¨<code>æ–°æ‰“å¼€çš„å¢é‡æ–‡ä»¶</code>å’Œ<code>å­è¿›ç¨‹ç”Ÿæˆçš„åŸºæœ¬æ–‡ä»¶</code>æ„å»ºä¸€ä¸ª<strong>ä¸´æ—¶æ¸…å•æ–‡ä»¶</strong>ï¼ˆtempmanifestï¼‰ï¼Œå¹¶å°†å…¶æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li><li>Valkeyå¯¹æ¸…å•æ–‡ä»¶è¿›è¡ŒåŸå­äº¤æ¢ï¼Œä½¿å¾— AOFé‡å†™çš„ç»“æœç”Ÿæ•ˆã€‚Valkeyè¿˜ä¼šæ¸…ç†æ—§çš„åŸºæœ¬æ–‡ä»¶å’Œæ‰€æœ‰æœªä½¿ç”¨çš„å¢é‡æ–‡ä»¶ã€‚</li></ul><h3 id="æŸ¥çœ‹aofæœ¬åœ°æ–‡ä»¶">3.æŸ¥çœ‹AOFæœ¬åœ°æ–‡ä»¶</h3><p>å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨Linuxç³»ç»Ÿä¸­æŸ¥çœ‹<code>/var/lib/valkey/appendonlydir/</code>ç›®å½•ä¸‹çš„AOFæ–‡ä»¶ã€‚</p><p><img src="https://s21.ax1x.com/2025/08/18/pVBmjeI.png" /></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Arch ~]# <span class="hljs-built_in">cd</span> /var/lib/valkey/<br>[root@Arch valkey]# <span class="hljs-built_in">ls</span><br>appendonlydir  dump.rdb<br>[root@Arch valkey]# <span class="hljs-built_in">cd</span> appendonlydir/<br>[root@Arch appendonlydir]# <span class="hljs-built_in">ls</span><br>appendonly.aof.1.base.rdb  appendonly.aof.1.incr.aof  appendonly.aof.manifest<br>[root@Arch appendonlydir]# <span class="hljs-built_in">cat</span> appendonly.aof.1.base.rdb <br>REDIS0011ï¿½<br>valkey-ver8.1.3ï¿½<br>[root@Arch appendonlydir]# <span class="hljs-built_in">cat</span> appendonly.aof.1.incr.aof <br>*2<br><span class="hljs-variable">$6</span><br>SELECT<br><span class="hljs-variable">$1</span><br>0<br>*3<br><span class="hljs-variable">$3</span><br><span class="hljs-built_in">set</span><br><span class="hljs-variable">$4</span><br>Aket<br><span class="hljs-variable">$3</span><br>111<br>[root@Arch appendonlydir]# <span class="hljs-built_in">cat</span> appendonly.aof.manifest <br>file appendonly.aof.1.base.rdb <span class="hljs-built_in">seq</span> 1 <span class="hljs-built_in">type</span> b<br>file appendonly.aof.1.incr.aof <span class="hljs-built_in">seq</span> 1 <span class="hljs-built_in">type</span> i<br></code></pre></td></tr></table></figure><p>å¦‚å‰æ–‡æ‰€è¿°ï¼ŒAOFä¸æ­¢ä¸€ä¸ªæ–‡ä»¶ï¼Œä½äºå•ç‹¬çš„ç›®å½•<code>/var/lib/valkey/appendonlydir/</code>ä¸‹ã€‚è¿™é‡Œç”Ÿæˆäº†ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>appendonly.aof.1.base.rdb åŸºæœ¬æ–‡ä»¶</li><li>appendonly.aof.1.incr.aof, appendonly.aof.2.incr.aof å¢é‡æ–‡ä»¶</li><li>appendonly.aof.manifest æ¸…å•æ–‡ä»¶</li></ul><p>æŸ¥çœ‹æ–‡ä»¶çš„å…·ä½“å†…å®¹ï¼Œå‘ç°ï¼š</p><ul><li>åŸºæœ¬æ–‡ä»¶çš„å†…å®¹å‡ºç°ä¹±ç ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ä»¥RDBæ ¼å¼å­˜å‚¨çš„ï¼Œ<code>REDIS0011</code>è¡¨ç¤ºRDBæ–‡ä»¶å¤´ï¼Œè™½ç„¶æ‰©å±•åæ˜¯<code>.aof</code>ï¼Œä½†å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªRDBæ–‡ä»¶ã€‚</li><li>å¢é‡æ–‡ä»¶ä¿å­˜çš„æ˜¯æ–‡æœ¬å‘½ä»¤ï¼Œé‡‡ç”¨<strong>RESPåè®®</strong>è®°å½•å‘½ä»¤</li><li>æè¿°AOFçš„ç»„æˆï¼ŒåŒ…æ‹¬ï¼š<ul><li><code>...base.rdb seq 1 type b</code>ï¼šæŒ‡æ˜baseæ–‡ä»¶ï¼ˆRDBæ ¼å¼ï¼‰ï¼Œåºå·ä¸º1</li><li><code>...incr.aof seq 1 type i</code>ï¼šæŒ‡æ˜å¢é‡æ–‡ä»¶ï¼Œåºå·1</li><li>valkeyå¯åŠ¨æ—¶ï¼Œä¼šå…ˆåŠ è½½<code>type b</code>çš„RDBæ–‡ä»¶ï¼Œå†å›æ”¾å¢é‡æ–‡ä»¶ã€‚</li></ul></li></ul><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œæ¸…å•æ–‡ä»¶çš„ç›®çš„å°±æ˜¯è®°å½•å“ªä¸ªæ–‡ä»¶æ˜¯åŸºæœ¬æ–‡ä»¶ï¼Œå“ªä¸ªæ–‡ä»¶æ˜¯å¢é‡æ–‡ä»¶ã€‚è¿™ä¸ºæˆ‘ä»¬å¸¦æ¥äº†æå¤§çš„çµæ´»æ€§â€”â€”â€”â€”å¦‚æœè¦æ›´æ”¹AOFåŸºæœ¬æ–‡ä»¶ï¼Œåªéœ€ä¿®æ”¹æ¸…å•æ–‡ä»¶å³å¯ã€‚</p><h3 id="è§¦å‘æœºåˆ¶">4.è§¦å‘æœºåˆ¶</h3><p>è§é…ç½®æ–‡ä»¶å‚æ•°ç« èŠ‚ã€‚</p><h2 id="rdbå’Œaofçš„æ¯”è¾ƒ">RDBå’ŒAOFçš„æ¯”è¾ƒ</h2><p><img src="https://s21.ax1x.com/2025/07/20/pV8l5hn.png" /></p><p>ç»“åˆValkeyæ‰‹å†Œå†è¡¥å……å‡ ç‚¹ï¼š</p><ul><li>RDBéå¸¸é€‚åˆå¤‡ä»½ï¼Œç›¸å½“äºå­˜æ¡£ï¼Œæ¯”å¦‚å¯ä»¥æ¯å¤©ä¿å­˜ä¸€ä¸ªå¿«ç…§ï¼Œå‡ºä»€ä¹ˆäº‹å°±ç›´æ¥å›æ¡£</li><li>RDBçš„é‡å¯é€Ÿåº¦æ›´å¿«</li><li>RDBæœ€å¤§åŒ–äº†Valkeyçš„æ€§èƒ½ï¼Œå› ä¸ºçˆ¶è¿›ç¨‹åªéœ€è¦ forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å®Œæˆæ‰€æœ‰çš„æŒä¹…åŒ–å·¥ä½œã€‚</li><li>AOFå¯ä»¥è®¾ç½®ä¸åŒçš„fsyncç­–ç•¥ï¼Œæ•°æ®ä¸€è‡´æ€§æ›´å¼º</li><li>AOFæ˜¯ä»…è¿½åŠ æ—¥å¿—ï¼Œä¸ä¼šå‡ºç°ç£ç›˜çš„<strong>å¯»é“</strong></li><li>å½“ AOF æ–‡ä»¶è¿‡å¤§æ—¶ï¼ŒValkeyèƒ½å¤Ÿåœ¨åå°<strong>è‡ªåŠ¨é‡å†™</strong>ã€‚é‡å†™è¿‡ç¨‹éå¸¸å®‰å…¨ï¼Œå› ä¸º Valkeyä¼šåœ¨ç»§ç»­å‘æ—§æ–‡ä»¶è¿½åŠ æ•°æ®çš„åŒæ—¶ï¼Œä½¿ç”¨åˆ›å»ºå½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°‘æ“ä½œç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„AOF æ–‡ä»¶ã€‚ä¸€æ—¦ç¬¬äºŒä¸ªæ–‡ä»¶å‡†å¤‡å°±ç»ªï¼ŒValkey å°±ä¼šåˆ‡æ¢ä¸¤ä¸ª AOFæ–‡ä»¶ï¼Œå¹¶å¼€å§‹å‘æ–°æ–‡ä»¶è¿½åŠ æ•°æ®ã€‚</li><li>ä¸æ¨èå•ç‹¬ä½¿ç”¨AOFï¼Œå› ä¸ºRDBçš„æ•°æ®åº“å¤‡ä»½ä½œç”¨è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚</li></ul><h2 id="é…ç½®æ–‡ä»¶çš„å‚æ•°">é…ç½®æ–‡ä»¶çš„å‚æ•°</h2><p>ä»¥ä¸‹å†…å®¹æ¥è‡ªValkey/Redisçš„é…ç½®æ–‡ä»¶åŠæ³¨é‡Šã€‚</p><h3 id="rdb-1">RDB</h3><p>é™¤éå¦æœ‰è§„å®šï¼ŒæœåŠ¡å™¨å°†ä¼šè‡ªåŠ¨ä¿å­˜DBï¼š</p><ul><li>æ‰§è¡Œäº†è‡³å°‘ä¸€æ¬¡ä¿®æ”¹çš„1hä»¥å</li><li>æ‰§è¡Œäº†è‡³å°‘100æ¬¡ä¿®æ”¹çš„5minå</li><li>10000ä¿®æ”¹çš„60så</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">save</span> <span class="hljs-number">3600</span> <span class="hljs-number">1</span> <span class="hljs-number">300</span> <span class="hljs-number">100</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure><p>å¦‚æœRDBæœ€è¿‘ä¸€æ¬¡çš„åå°ä¿å­˜ï¼ˆbackgroundsaveï¼‰å¤±è´¥äº†ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šåœæ­¢æ¥å—å†™å…¥ï¼Œä»¥æé†’ç”¨æˆ·æŒä¹…åŒ–å¤±è´¥ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">stop-<span class="hljs-built_in">write</span>-<span class="hljs-keyword">on</span>-bgsave-<span class="hljs-keyword">error</span> yes<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆ<code>.rdb</code>æ–‡ä»¶é‡‡ç”¨ LZFå‹ç¼©ï¼Œä»¥èŠ‚çœç©ºé—´ï¼Œä»£ä»·æ˜¯å¢é«˜äº†å­è¿›ç¨‹çš„CPUå ç”¨ç‡ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rdbcompression</span> <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤å¼€å¯æ ¡éªŒå’Œï¼Œrdbæ–‡ä»¶çš„æœ«å°¾åŒ…å«ä¸€ä¸ªæ ¡éªŒå’Œï¼Œè¿™æ ·åœ¨ä¿å­˜å’ŒåŠ è½½rdbæ–‡ä»¶çš„æ—¶å€™éƒ½ä¼šæ ¡éªŒè¿™ä¸ªæ ¡éªŒå’Œï¼Œé€ æˆå¤§çº¦10%çš„æ€§èƒ½æŸå¤±ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rebchecksum</span> <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure><h3 id="append-only-mode">APPEND ONLY MODE</h3><p>AOFæ˜¯ä¸€ç§æ›´å®‰å…¨çš„ç­–ç•¥ï¼Œé»˜è®¤æƒ…å†µä¸‹æœ€å¤šåªä¸¢å¤±1sçš„æ•°æ®ã€‚AOFå’ŒRDBå¯ä»¥åŒæ—¶å¯ç”¨ï¼Œè€ŒAOFæä¾›äº†æ›´å¥½çš„æŒä¹…æ€§ä¿éšœï¼Œæ‰€ä»¥<strong>æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ä¼šä¼˜å…ˆåŠ è½½AOF</strong>ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appendonly</span> <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><p>AOFæ–‡ä»¶çš„åå­—ã€‚AOFæ–‡ä»¶ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆï¼ŒåŒ…å«ä¸¤ç§åŸºæœ¬ç±»å‹ï¼š</p><ul><li><strong>Basefiles</strong>ï¼ŒåŸºæœ¬æ–‡ä»¶ï¼Œå°±æ˜¯ä»£è¡¨æ‰€æœ‰æ•°æ®é›†åœ¨è¯¥æ–‡ä»¶è¢«åˆ›å»ºçš„æ—¶åˆ»çš„å®Œæ•´çŠ¶æ€çš„ä¸€ä¸ªå¿«ç…§ã€‚ç»†åˆ†ä¸ºä¸¤ç§æ ¼å¼ï¼šRDBï¼ˆäºŒè¿›åˆ¶åºåˆ—åŒ–çš„ï¼‰æˆ–è€… AOFï¼ˆæ–‡æœ¬å‘½ä»¤ï¼‰</li><li><strong>Incrementalfiles</strong>ï¼Œå¢é‡æ–‡ä»¶ï¼ŒåŒ…å«äº†åº”ç”¨äºæ•°æ®é›†çš„é¢å¤–å‘½ä»¤</li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<strong>manifestfiles</strong>ï¼ˆæ¸…å•æ–‡ä»¶ï¼‰ç”¨æ¥è¿½è¸ªæ–‡ä»¶è¢«åˆ›å»ºã€åº”å½“è¢«ä½¿ç”¨çš„é¡ºåºã€‚</p><p>AOFæ–‡ä»¶æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å‘½åçš„ï¼Œå…¶ä¸­æ–‡ä»¶åçš„å‰ç¼€å°±æ˜¯ä¸‹é¢å®šä¹‰çš„<code>appendonly.aof</code>ï¼Œä¾‹å¦‚ä¸‹é¢å‡ ä¸ªæ–‡ä»¶å¯èƒ½ä¼šè¢«åˆ›å»ºï¼š</p><ul><li>appendonly.aof.1.base.rdb åŸºæœ¬æ–‡ä»¶</li><li>appendonly.aof.1.incr.aof, appendonly.aof.2.incr.aof å¢é‡æ–‡ä»¶</li><li>appendonly.aof.manifest æ¸…å•æ–‡ä»¶</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appendfilename</span> <span class="hljs-string">&quot;appendonly.aof&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æœŸé—´ï¼ŒæœåŠ¡å™¨ä¼šæŠŠæ‰€æœ‰çš„æŒä¹…åŒ–AOFæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªä¸“ç”¨çš„ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•çš„åå­—ç”±ä¸‹é¢çš„å‚æ•°å†³å®š:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appenddirname</span> <span class="hljs-string">&quot;appendonlydir&quot;</span><br></code></pre></td></tr></table></figure><p><code>fsync()</code>è°ƒç”¨å‘Šè¯‰æ“ä½œç³»ç»Ÿå°†æ•°æ®ç«‹å³å†™å…¥ç£ç›˜ï¼Œè€Œä¸æ˜¯å…ˆæ”¾åˆ°ç¼“å†²åŒºç§¯æ”’æ›´å¤šçš„æ•°æ®ã€‚Valkeyæ”¯æŒä»¥ä¸‹ä¸‰ç§åˆ·ç›˜æ¨¡å¼ï¼š</p><ul><li><code>no</code>ï¼šä¸ä¸»åŠ¨è°ƒç”¨<code>fsync()</code>ï¼Œè®©æ“ä½œç³»ç»Ÿè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™åˆ·ç›˜ã€‚æœ€å¿«ã€‚</li><li><code>always</code>ï¼šæ¯æ¬¡<code>write</code>éƒ½ä¼šè°ƒç”¨<code>fsync()</code>ï¼Œæœ€å®‰å…¨ï¼Œæœ€æ…¢ã€‚</li><li><code>everysec</code>ï¼šæ¯ç§’è°ƒç”¨ä¸€æ¬¡<code>fsync()</code>ã€‚æŠ˜ä¸­ã€‚</li></ul><p>é»˜è®¤æ˜¯ç¬¬ä¸‰ç§ï¼Œæ¯•ç«Ÿåœ¨é€Ÿåº¦å’Œå®‰å…¨æ€§ä¹‹é—´æŠ˜ä¸­å¾€å¾€æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># appendfsync always</span><br><span class="hljs-attribute">appendfsync</span> everysec<br><span class="hljs-comment"># appendfsync no</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ AOF é‡å†™ï¼ˆBGREWRITEAOFï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œç£ç›˜ I/Oå‹åŠ›å¾ˆå¤§ï¼Œå¦‚æœè¿™æ—¶è¿˜é¢‘ç¹æ‰§è¡Œfsyncï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚å¦‚æœå¯ç”¨ä¸‹é¢çš„å‚æ•°ï¼Œåœ¨æ‰§è¡ŒAOFé‡å†™æ—¶ï¼Œä¸æ‰§è¡Œ<code>fsync</code>ï¼Œè€Œæ˜¯åªå†™å…¥æ“ä½œç³»ç»Ÿç¼“å­˜ã€‚è¿™æ ·å¯ä»¥é¿å…IOé˜»å¡ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-literal">no</span>-appendfsync-<span class="hljs-literal">on</span>-rewrite <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><p><strong>AOFè‡ªåŠ¨é‡å†™æœºåˆ¶</strong>ï¼š</p><ul><li>å½“å‰ AOF æ–‡ä»¶å¤§å°æ¯”ä¸Šæ¬¡é‡å†™åçš„å¤§å°ç¿»å€ï¼ˆå¢åŠ 100%ï¼‰ï¼Œå°±ä¼šè§¦å‘è‡ªåŠ¨é‡å†™</li><li>å¤§å‰æï¼šå½“å‰AOFæ–‡ä»¶å¤§äº64MBã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è‡ªåŠ¨é‡å†™ AOF æ–‡ä»¶ã€‚</span><br><span class="hljs-comment"># Redis èƒ½å¤Ÿåœ¨ AOF æ—¥å¿—æ–‡ä»¶å¢å¤§åˆ°æŒ‡å®šç™¾åˆ†æ¯”åï¼Œè‡ªåŠ¨è°ƒç”¨ BGREWRITEAOF æ¥è¿›è¡Œé‡å†™ã€‚</span><br><br><span class="hljs-comment"># å·¥ä½œåŸç†å¦‚ä¸‹ï¼šRedis ä¼šè®°ä½æœ€è¿‘ä¸€æ¬¡é‡å†™åçš„ AOF æ–‡ä»¶å¤§å°ï¼ˆå¦‚æœé‡å†™è¿˜æœªå‘ç”Ÿè¿‡ï¼Œåˆ™ä½¿ç”¨å¯åŠ¨æ—¶ AOF æ–‡ä»¶çš„å¤§å°ï¼‰ã€‚</span><br><br><span class="hljs-comment"># è¿™ä¸ªåŸºå‡†å¤§å°ä¼šä¸å½“å‰ AOF æ–‡ä»¶å¤§å°è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå½“å‰å¤§å°è¶…è¿‡äº†æŒ‡å®šç™¾åˆ†æ¯”ï¼Œå°±ä¼šè§¦å‘é‡å†™æ“ä½œã€‚</span><br><span class="hljs-comment"># åŒæ—¶ä½ è¿˜éœ€è¦è®¾ç½®ä¸€ä¸ª AOF æ–‡ä»¶çš„æœ€å°å¤§å°ï¼Œä»¥é¿å…æ–‡ä»¶è™½ç„¶å¢é•¿äº†æŒ‡å®šç™¾åˆ†æ¯”ï¼Œä½†æ€»ä½“ä»ç„¶å¤ªå°å°±è¿›è¡Œé‡å†™ã€‚</span><br><br><span class="hljs-comment"># å¦‚æœå°†ç™¾åˆ†æ¯”è®¾ä¸º 0ï¼Œå°±ä¼šç¦ç”¨ AOF è‡ªåŠ¨é‡å†™åŠŸèƒ½ã€‚</span><br><br>auto-aof-rewrite-percentage 100<br>auto-aof-rewrite-min-size 64mb<br></code></pre></td></tr></table></figure><p><strong>AOF æ–‡ä»¶åŠ è½½ä¸é‡å†™æœºåˆ¶</strong>ï¼š</p><p>å¦‚æœå¯åŠ¨è¿‡ç¨‹ä¸­å‘ç°AOFæ–‡ä»¶æœ«å°¾è¢«æˆªæ–­ï¼Œå°±ä¼šç”¨åˆ°è¿™ä¸ªå‚æ•°ã€‚æœåŠ¡å™¨å°†å‘å‡ºä»¥ä¸‹æ—¥å¿—ï¼š</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">* Reading RDB preamble from AOF file...<br>* Reading the remaining AOF tail...<br># !!! Warning: short read while loading the AOF file !!!<br># !!! Truncating the AOF at offset <span class="hljs-number">439</span> !!!<br># AOF loaded anyway because aof-load-truncated is enabled<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹åªæ˜¯ä¼šä¸¢å¼ƒæœ€åä¸€æ¡ä¸æ­£ç¡®çš„å‘½ä»¤ï¼Œç»§ç»­åŠ è½½ï¼Œ</p><ul><li>aof-load-truncated æ§åˆ¶ Redis åœ¨ AOFæ–‡ä»¶æœ«å°¾æŸåæ—¶æ˜¯å¦ä»ç„¶åŠ è½½æœ‰æ•ˆæ•°æ®å¹¶å¯åŠ¨ï¼Œé»˜è®¤å¼€å¯å¢å¼ºå®¹é”™æ€§ï¼›</li><li>aof-use-rdb-preamble å…è®¸ Redis åœ¨ AOF é‡å†™æ—¶ä½¿ç”¨ RDBæ ¼å¼å¼€å¤´ï¼ŒåŠ é€Ÿæ•°æ®æ¢å¤ï¼Œæå‡æ€§èƒ½ã€‚ä¸¤è€…ç»“åˆä½¿ AOF æ›´å¯é å’Œé«˜æ•ˆã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Redis å¯åŠ¨è¿‡ç¨‹ä¸­åœ¨åŠ è½½ AOF æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‘ç° AOF æ–‡ä»¶æœ«å°¾è¢«æˆªæ–­ã€‚</span><br><span class="hljs-comment"># è¿™ç§æƒ…å†µé€šå¸¸å‡ºç°åœ¨ Redis æ‰€åœ¨çš„ç³»ç»Ÿå´©æºƒæ—¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ ext4 æ–‡ä»¶ç³»ç»Ÿæœªå¯ç”¨ data=ordered é€‰é¡¹çš„æƒ…å†µä¸‹ã€‚</span><br><span class="hljs-comment"># ä½†å¦‚æœåªæ˜¯ Redis è‡ªèº«å´©æºƒï¼Œè€Œæ“ä½œç³»ç»Ÿä»æ­£å¸¸ï¼Œè¿™ç§é—®é¢˜é€šå¸¸ä¸ä¼šå‘ç”Ÿã€‚</span><br><br><span class="hljs-comment"># å½“ Redis å‘ç° AOF æ–‡ä»¶æœ«å°¾è¢«æˆªæ–­æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸¤ç§è¡Œä¸ºï¼š</span><br><span class="hljs-comment"># 1. æŠ¥é”™å¹¶åœæ­¢å¯åŠ¨ï¼ˆé»˜è®¤ä¸æ˜¯è¿™æ ·ï¼‰</span><br><span class="hljs-comment"># 2. æˆ–è€…å°½å¯èƒ½åŠ è½½æœ‰æ•ˆæ•°æ®ï¼Œå¹¶ç»§ç»­å¯åŠ¨ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰</span><br><br><span class="hljs-comment"># è¿™ä¸ªé…ç½®é¡¹æ§åˆ¶ä¸Šé¢æåˆ°çš„è¡Œä¸ºï¼š</span><br><span class="hljs-comment"># å¦‚æœè®¾ç½®ä¸º yesï¼ŒRedis ä¼šåŠ è½½å°½å¯èƒ½å¤šçš„æœ‰æ•ˆæ•°æ®å¹¶å¯åŠ¨ï¼ŒåŒæ—¶è®°å½•æ—¥å¿—æé†’ç”¨æˆ·ã€‚</span><br><span class="hljs-comment"># å¦‚æœè®¾ç½®ä¸º noï¼ŒRedis ä¼šæŠ¥é”™å¹¶æ‹’ç»å¯åŠ¨ï¼Œè¦æ±‚ç”¨æˆ·ä½¿ç”¨ redis-check-aof å·¥å…·ä¿®å¤ AOF æ–‡ä»¶ã€‚</span><br><br><span class="hljs-comment"># æ³¨æ„ï¼šå¦‚æœ AOF æ–‡ä»¶ä¸­é—´éƒ¨åˆ†æŸåï¼Œæ— è®ºè¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸º yes æˆ– noï¼ŒRedis éƒ½ä¼šæ‹’ç»å¯åŠ¨ã€‚</span><br><span class="hljs-comment"># æ­¤é€‰é¡¹ä»…é€‚ç”¨äº AOF æ–‡ä»¶**æœ«å°¾**ä¸å®Œæ•´çš„æƒ…å†µã€‚</span><br><br>aof-load-truncated <span class="hljs-built_in">yes</span><br><br><span class="hljs-comment"># Redis åœ¨é‡å†™ AOF æ–‡ä»¶æ—¶ï¼Œå¯ä»¥åœ¨ AOF æ–‡ä»¶å¼€å¤´ä½¿ç”¨ RDB æ ¼å¼çš„æ•°æ®æ¥åŠ å¿«é‡å†™å’Œæ¢å¤è¿‡ç¨‹ã€‚</span><br><span class="hljs-comment"># å¯ç”¨è¿™ä¸ªé€‰é¡¹åï¼Œé‡å†™åçš„ AOF æ–‡ä»¶ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</span><br><br><span class="hljs-comment">#   [RDB æ•°æ®éƒ¨åˆ†][AOF å‘½ä»¤éƒ¨åˆ†]</span><br><br><span class="hljs-comment"># RDBæ ¼å¼å¾€å¾€æ›´å¿«æ›´é«˜æ•ˆï¼Œæ¨èå¼€å¯</span><br><br>aof-use-rdb-preamble <span class="hljs-built_in">yes</span><br><br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨æ”¯æŒæŠŠæ—¶é—´æˆ³æ³¨è§£è®°å½•åœ¨AOFæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¯ç”¨çš„è¯æ”¹å˜AOFçš„æ ¼å¼ï¼Œå¯èƒ½å’Œå…ˆå­˜åœ¨AOFè½¬æ¢å™¨ä¸å…¼å®¹ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">aof-<span class="hljs-type">timestamp</span>-<span class="hljs-keyword">enable</span><br></code></pre></td></tr></table></figure><p>valkeyé™„å¸¦çš„æœ‰å·¥å…·ä¿®å¤çš„åŸå§‹æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">valkey-check-aof --fix &lt;filename&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠMySQLæŠ€æœ¯å†…å¹•ã€‹è¯»ä¹¦ç¬”è®°3-InnoDB</title>
    <link href="/2025/08/17/MySQL%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B03-InnoDB/"/>
    <url>/2025/08/17/MySQL%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B03-InnoDB/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›®å½•">ç›®å½•</h2><ol type="1"><li><a href="#ä¸åŒå­˜å‚¨å¼•æ“çš„æ¯”è¾ƒ">ä¸åŒå­˜å‚¨å¼•æ“çš„æ¯”è¾ƒ</a></li><li><a href="#è¿æ¥mysql">è¿æ¥MySQL</a></li><li><a href="#innodbå­˜å‚¨å¼•æ“æ¶æ„">InnoDBå­˜å‚¨å¼•æ“æ¶æ„</a><ol type="1"><li><a href="#åå°çº¿ç¨‹">åå°çº¿ç¨‹</a></li><li><a href="#å†…å­˜">å†…å­˜</a><ol type="1"><li><a href="#ç¼“å†²æ± ">ç¼“å†²æ± </a></li><li><a href="#å¦‚ä½•ç®¡ç†å†…å­˜åŒºåŸŸ">å¦‚ä½•ç®¡ç†å†…å­˜åŒºåŸŸ</a></li><li><a href="#é‡åšæ—¥å¿—ç¼“å†²">é‡åšæ—¥å¿—ç¼“å†²</a></li></ol></li></ol></li><li><a href="#checkpoint">Checkpoint</a></li><li><a href="#æ—§ç‰ˆæœ¬master-thread">æ—§ç‰ˆæœ¬Master Thread</a><ol type="1"><li><a href="#loop">Loop</a></li><li><a href="#background-loop">background loop</a></li></ol></li><li><a href="#æ–°ç‰ˆæœ¬ä¸»çº¿ç¨‹çš„å˜åŒ–">æ–°ç‰ˆæœ¬ä¸»çº¿ç¨‹çš„å˜åŒ–</a></li><li><a href="#innodbå…³é”®ç‰¹æ€§">InnoDBå…³é”®ç‰¹æ€§</a><ol type="1"><li><a href="#æ’å…¥ç¼“å†²">æ’å…¥ç¼“å†²</a></li><li><a href="#doublewrite">doublewrite</a></li><li><a href="#è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•">è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</a></li><li><a href="#å¼‚æ­¥io">å¼‚æ­¥IO</a></li><li><a href="#åˆ·æ–°é‚»å±…é¡µ">åˆ·æ–°é‚»å±…é¡µ</a></li></ol></li></ol><h2 id="ä¸åŒå­˜å‚¨å¼•æ“çš„æ¯”è¾ƒ">ä¸åŒå­˜å‚¨å¼•æ“çš„æ¯”è¾ƒ</h2><ul><li>MyISAM:ä¸æ”¯æŒäº‹åŠ¡ã€è¡¨é”ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œç¼“å†²æ± åªç¼“å†²ç´¢å¼•æ–‡ä»¶è€Œä¸ä¼šç¼“å†²æ•°æ®æ–‡ä»¶</li></ul><p>é¢è¯•é¢˜å¯èƒ½ä¼šè®©æ¯”è¾ƒInnoDBå’ŒMyISAM</p><p><img src="https://s21.ax1x.com/2025/08/13/pVwN15d.png" /></p><p>MyISAMç›¸æ¯”äºInnoDBçš„ä¸»è¦ç¼ºé™·ï¼š</p><ul><li><strong>ä¸æ”¯æŒäº‹åŠ¡</strong>ï¼ˆæœ€å¤§çš„åŒºåˆ«ï¼‰</li><li>ä¸æ”¯æŒå“ˆå¸Œç´¢å¼•</li><li>ä¸æ”¯æŒæ•°æ®ç¼“å­˜</li><li>ä¸æ”¯æŒå¤–é”®</li><li>ä¸æ”¯æŒ MVCC/å¿«ç…§è¯»</li></ul><p>InnoDBå¼•æ“æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼š<strong>äº‹åŠ¡ï¼Œå¤–é”®ï¼Œè¡Œçº§é”</strong>ã€‚</p><h2 id="è¿æ¥mysql">è¿æ¥MySQL</h2><p><strong>æœ¬è´¨ä¸Šæ˜¯è¿›ç¨‹é—´é€šä¿¡</strong>ã€‚</p><p>å¤ä¹ å¸¸è§çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼š</p><ul><li><strong>ç®¡é“</strong>ï¼ˆPipeï¼‰ï¼šåŠåŒå·¥é€šä¿¡æ–¹å¼ï¼Œæ•°æ®åªèƒ½å•å‘æµåŠ¨ã€‚é€šå¸¸ç”¨äºçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ç®¡é“åˆ†ä¸ºæ— åç®¡é“å’Œæœ‰åç®¡é“ï¼Œæ— åç®¡é“åªèƒ½åœ¨å…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨ï¼Œæœ‰åç®¡é“å¯ä»¥åœ¨ä»»æ„è¿›ç¨‹é—´ä½¿ç”¨ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆMessageQueueï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§æ¶ˆæ¯çš„é“¾è¡¨ï¼Œå­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œå¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡ã€‚æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°å¼‚æ­¥é€šä¿¡ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¸éœ€è¦åŒæ—¶è¿è¡Œã€‚</li><li><strong>å…±äº«å†…å­˜</strong>ï¼ˆSharedMemoryï¼‰ï¼šå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ä¸€å—å†…å­˜åŒºåŸŸï¼Œç›´æ¥å¯¹å†…å­˜è¿›è¡Œè¯»å†™æ“ä½œï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚éœ€è¦ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰æ¥åè°ƒå¯¹å…±äº«å†…å­˜çš„è®¿é—®ï¼Œä»¥é¿å…ç«äº‰æ¡ä»¶ã€‚å¦å¤–ï¼Œå…±äº«å†…å­˜ç”±å†…æ ¸è´Ÿè´£ç®¡ç†ã€‚</li><li><strong>ä¿¡å·é‡</strong>ï¼ˆSemaphoreï¼‰ï¼šç”¨äºæ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚ä¿¡å·é‡æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œé€šè¿‡å¯¹å…¶è¿›è¡ŒåŠ 1 å’Œå‡ 1æ“ä½œæ¥å®ç°å¯¹èµ„æºçš„å ç”¨å’Œé‡Šæ”¾ã€‚å¯ä»¥ç”¨äºå®ç°è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥ã€‚</li><li><strong>å¥—æ¥å­—</strong>ï¼ˆSocketï¼‰ï¼šå¯ç”¨äºä¸åŒä¸»æœºä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ç”¨äºåŒä¸€ä¸»æœºä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ã€‚æ”¯æŒå¤šç§é€šä¿¡åè®®ï¼Œå¦‚TCPã€UDP ç­‰ã€‚</li></ul><h2 id="innodbå­˜å‚¨å¼•æ“æ¶æ„">InnoDBå­˜å‚¨å¼•æ“æ¶æ„</h2><p><img src="https://s21.ax1x.com/2025/08/13/pVwdUr6.png" /></p><p>åå°çº¿ç¨‹è´Ÿè´£åˆ·æ–°å†…å­˜æ± ä¸­çš„æ•°æ®ï¼ˆLRUï¼‰ï¼Œæ­¤å¤–æŠŠå·²ç»ä¿®æ”¹çš„æ•°æ®æ–‡ä»¶åˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ã€‚</p><h3 id="åå°çº¿ç¨‹">åå°çº¿ç¨‹</h3><p>InnoDBå­˜å‚¨å¼•æ“æ˜¯å¤šçº¿ç¨‹çš„æ¨¡å‹ï¼š</p><ul><li>Master Thread ä¸»è¦è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„æ•°æ®å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜</li><li>IO Threadï¼šè´Ÿè´£å¤„ç†å¼‚æ­¥ IO è¯·æ±‚çš„å›è°ƒï¼ŒåŒ…æ‹¬write, read, insertbuffer, log IO thread</li><li>Purge Threadï¼šå›æ”¶ä¸ç”¨çš„undolog</li><li>Page Cleaner Threadï¼šå•ç‹¬çš„çº¿ç¨‹ï¼Œä¸“é—¨ç”¨æ¥åˆ·æ–°è„é¡µ</li></ul><h3 id="å†…å­˜">å†…å­˜</h3><h4 id="ç¼“å†²æ± ">ç¼“å†²æ± </h4><ul><li>æ•°æ®åº“è¯»å–é¡µæ—¶ï¼Œå…ˆæŠŠä»ç£ç›˜è¯»åˆ°çš„é¡µç¼“å­˜åœ¨å†…å­˜ç¼“å†²æ± ä¸­ã€‚ä¸‹æ¬¡å†è¯»ç›¸åŒçš„é¡µæ—¶ï¼Œå…ˆçœ‹çœ‹ç¼“å†²æ± é‡Œé¢æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯ç›´æ¥è¯»å–ã€‚</li><li>ä¿®æ”¹æ“ä½œï¼Œå…ˆä¿®æ”¹ç¼“å†²æ± ä¸­çš„é¡µï¼Œç„¶åå†ä»¥ä¸€å®šçš„é¢‘ç‡åˆ·æ–°åˆ°ç£ç›˜ã€‚<strong>æ•°æ®é¡µé€šè¿‡Checkpoint æœºåˆ¶åˆ·æ–°åˆ°ç£ç›˜</strong>ã€‚</li></ul><p>ç¼“å†²æ± ç¼“å­˜çš„æ•°æ®é¡µæœ‰å„ç§ç±»å‹ï¼Œæ’å…¥ç¼“å†²ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ç­‰æ˜¯ä¸å—LRUç®—æ³•ç®¡ç†çš„ã€‚å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="https://s21.ax1x.com/2025/08/13/pVw0KNF.png"alt="InnoDBå¼•æ“å†…å­˜ç»“æ„" /><figcaption aria-hidden="true">InnoDBå¼•æ“å†…å­˜ç»“æ„</figcaption></figure><p>ç¼“å†²æ± ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼Œæ˜¯å¯ä»¥é…ç½®çš„ã€‚</p><h4 id="å¦‚ä½•ç®¡ç†å†…å­˜åŒºåŸŸ">å¦‚ä½•ç®¡ç†å†…å­˜åŒºåŸŸ</h4><p>æ¶‰åŠLRU list; Free list; Flush list.</p><p><strong>ä¸­ç‚¹æ’å…¥ç­–ç•¥</strong></p><p>ç¼“å†²æ± ä»¥é¡µä¸ºå•ä½è¿›è¡Œç®¡ç†ï¼Œä¸€é¡µæ˜¯16KBï¼Œä½¿ç”¨æ”¹è¿›çš„ LRUç®—æ³•å¯¹ç¼“å†²æ± è¿›è¡Œç®¡ç†ã€‚å…·ä½“æ¥è¯´ï¼ŒInnoDBå­˜å‚¨å¼•æ“å¼•å…¥äº† midpoint insertionstrategyï¼Œæœ€æ–°è®¿é—®çš„é¡µä¸ä¼šç›´æ¥ç§»åŠ¨åˆ°é“¾è¡¨çº¦å¤´éƒ¨ï¼Œè€Œæ˜¯å…ˆæ”¾åˆ°<code>midpoint</code>ã€‚è¯¥ä½ç½®å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;innodb_old_blocks_pct&#x27;</span>;<br></code></pre></td></tr></table></figure><p>é»˜è®¤å€¼ä¸º<code>37</code>ï¼Œè¡¨ç¤ºè·ç¦»å°¾éƒ¨37%çš„ä½ç½®ã€‚è¯¥ midpointå°†LRUé“¾è¡¨åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>youngåŒº å‰5/8ï¼Œå±äºçƒ­ç‚¹åŒº</li><li>oldåŒºï¼Œå3/8ï¼Œå±äºè€æ—§åŒº</li></ul><p><strong>å»¶è¿Ÿæå‡æœºåˆ¶</strong></p><p><code>innodb_old_blocks_time</code>ï¼Œé¡µç¬¬ä¸€æ¬¡è¢«æ’å…¥ä¸­ç‚¹åï¼Œå¦‚æœä¸‹æ¬¡è®¿é—®è·ç¦»ä¸Šæ¬¡è®¿é—®æ—¶é—´å°äºè¯¥æ•°å€¼ï¼ˆé»˜è®¤1000msï¼‰ï¼Œä¸ä¼šè¢«æå‡åˆ°çƒ­ç‚¹åŒºã€‚å¦‚æœé¡µæˆåŠŸç†¬è¿‡è¯¥æ—¶é—´è¢«æ™‹å‡åˆ°çƒ­ç‚¹åŒºï¼Œå°±ç§°ä¹‹ä¸º<code>page made young</code>ã€‚</p><p><strong>ç©ºé—²åˆ—è¡¨</strong></p><p>ç©ºé—²åˆ—è¡¨ Free listè®°å½•äº†å°šæœªè¢«ä½¿ç”¨çš„å†…å­˜é¡µã€‚<code>Free Buffers</code>å°±æ˜¯ç©ºé—²åˆ—è¡¨ä¸­é¡µçš„æ•°é‡ï¼Œ<code>Database pages</code>åˆ™æ˜¯LRUåˆ—è¡¨ä¸­é¡µçš„æ•°é‡ã€‚</p><ul><li>å¦‚æœLRUåˆ—è¡¨å°šæœªæ»¡ï¼Œå°±ä»ç©ºé—²åˆ—è¡¨ä¸­å¯»æ‰¾å¯ç”¨çš„å†…å­˜é¡µï¼Œæ‰¾åˆ°å°±åˆ é™¤ï¼Œæ”¾å…¥LRUåˆ—è¡¨ã€‚å¦‚æœ</li><li>Page Cleanerçº¿ç¨‹æ£€æŸ¥å‰©ä½™é¡µçš„æ•°é‡ï¼Œå¦‚æœLRUåˆ—è¡¨çš„ç©ºé—²é¡µä¸è¶³100ä¸ªï¼Œæ ¹æ®LRUç®—æ³•æ·˜æ±°å°¾éƒ¨çš„é¡µï¼ŒæŠŠé‡Šæ”¾çš„ç©ºé—´åˆ†é…ç»™æ–°çš„é¡µã€‚</li></ul><p>LRUé“¾è¡¨æ”¯æŒå‹ç¼©é¡µï¼Œé€šè¿‡unzip_LRUåˆ—è¡¨ç®¡ç†ï¼ŒåŸæ¥16KBçš„é¡µå¯ä»¥è¢«å‹ç¼©åˆ°8KBå’Œ4KBã€‚</p><p><strong>Flush List</strong></p><p>Flush Listç”¨äºç®¡ç†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ã€‚Flush Listå’ŒLRUListéƒ½è®°å½•äº†è„é¡µï¼Œåè€…ç”¨äºç®¡ç†é¡µçš„å¯ç”¨æ€§ï¼Œå‰è€…ç”¨äºåˆ·ç›˜ã€‚</p><h4 id="é‡åšæ—¥å¿—ç¼“å†²">é‡åšæ—¥å¿—ç¼“å†²</h4><p>é‡åšæ—¥å¿—é¦–å…ˆè¢«å†™å…¥è¿™ä¸ªç¼“å†²åŒºï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡åˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ã€‚<strong>é‡åšæ—¥å¿—æ–‡ä»¶çš„åˆ·ç›˜æ—¶æœº</strong>ï¼š</p><ul><li>Master Thread æ¯ç§’åˆ·ç›˜ä¸€æ¬¡</li><li>æ¯ä¸ªäº‹åŠ¡æäº¤æ—¶</li><li>redo log bufferå‰©ä½™ç©ºé—´å°äº1/2æ—¶</li></ul><p>æŸ¥çœ‹é‡åšæ—¥å¿—ç¼“å†²åŒºå¤§å°çš„å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> varaibles <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;innodb_log_buffer_size&#x27;</span>\G;<br></code></pre></td></tr></table></figure><p>æˆ‘æŸ¥å‡ºæ¥çš„æ˜¯16MBã€‚é‡åšæ—¥å¿—ç¼“å†²åŒºä¸ä¼šå¤ªå¤§ï¼Œå› ä¸ºåˆ·é¢‘æ—¶æœºè¶³å¤Ÿé¢‘ç¹ï¼Œç¼“å†²åŒºä¸ä¼šç§¯ç´¯è¿‡å¤šçš„æ—¥å¿—ã€‚</p><h2 id="checkpoint">Checkpoint</h2><blockquote><p><strong>WALç­–ç•¥</strong>ï¼š<strong>äº‹åŠ¡æäº¤æ—¶ï¼Œå…ˆå†™é‡åšæ—¥å¿—ï¼Œå†ä¿®æ”¹æ•°æ®é¡µ</strong>ã€‚å½“ç”±äºç³»ç»Ÿå´©æºƒå¯¼è‡´æ•°æ®ä¸¢å¤±æ—¶ï¼Œé€šè¿‡é‡åšæ—¥å¿—æ¥å®Œæˆæ•°æ®çš„æ¢å¤ã€‚</p></blockquote><p>æ£€æŸ¥ç‚¹æŠ€æœ¯çš„ç›®çš„ï¼š</p><ul><li>ç¼©çŸ­æ•°æ®åº“çš„æ¢å¤æ—¶é—´</li><li>ç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œå¼ºåˆ¶æ‰§è¡Œæ£€æŸ¥ç‚¹ï¼Œæ ¹æ®LRUç®—æ³•å°†æº¢å‡ºçš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜</li><li>é‡åšæ—¥å¿—ä¸å¯ç”¨æ—¶ï¼Œåˆ·æ–°è„é¡µã€‚é‡åšæ—¥å¿—æ˜¯å¾ªç¯å¯é‡ç”¨çš„ï¼Œä¸éœ€è¦çš„æ—¥å¿—ä¼šè¢«è¦†ç›–ã€‚å¦‚æœå³å°†è¢«è¦†ç›–çš„æ—¥å¿—è¿˜éœ€è¦ä½¿ç”¨ï¼Œå°±éœ€è¦æ‰§è¡Œæ£€æŸ¥ç‚¹ï¼Œå°†ç£ç›˜è‡³å°‘åŒæ­¥åˆ°å³å°†è¢«è¦†ç›–çš„æ—¥å¿—ä»¥åçš„çŠ¶æ€ï¼Œé˜²æ­¢çŠ¶æ€ä¸¢å¤±ã€‚</li></ul><p>InnoDBå­˜å‚¨å¼•æ“é€šè¿‡LSNæ¥æ ‡è®°ç‰ˆæœ¬ï¼Œæ—¥å¿—ã€é¡µã€æ£€æŸ¥ç‚¹éƒ½æœ‰è‡ªå·±çš„LSNã€‚æ•°æ®åº“å¯åŠ¨æ—¶ï¼Œä»checkpointçš„LSNå¼€å§‹å‘åè¯»å–é‡åšæ—¥å¿—ï¼Œæ¢å¤æ•°æ®åº“ã€‚</p><h2 id="æ—§ç‰ˆæœ¬master-thread">æ—§ç‰ˆæœ¬Master Thread</h2><p>Master Threadå†…éƒ¨åŒ…å«å¤šä¸ªå¾ªç¯ã€‚</p><h3 id="loop">Loop</h3><p><strong>Loop</strong>ç§°ä¸ºä¸»å¾ªç¯ï¼ŒåŒ…å«æ¯ç§’é’Ÿçš„æ“ä½œå’Œæ¯åç§’é’Ÿçš„æ“ä½œã€‚æ¯ç§’ä¸€æ¬¡çš„æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li><strong>æŠŠæ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ï¼Œå³ä½¿äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤</strong>ï¼ˆæ€»æ˜¯ï¼‰</li><li>ï¼ˆå¯èƒ½ï¼‰åˆå¹¶æ’å…¥ç¼“å†²ï¼Œå‰ææ˜¯IOå‹åŠ›å¾ˆå°</li><li>ï¼ˆå¯èƒ½ï¼‰æœ€å¤šåˆ·æ–°100ä¸ªç¼“å†²æ± ä¸­çš„è„é¡µåˆ°ç£ç›˜ï¼Œå‰ææ˜¯ç¼“å†²æ± è„é¡µçš„æ¯”ä¾‹è¶…è¿‡90%ï¼ˆåæ¥åˆ·æ–°è„é¡µè¢«åˆ†ç¦»ç»™äº†å•ç‹¬çš„çº¿ç¨‹ï¼‰</li><li>ï¼ˆå¯èƒ½ï¼‰å¦‚æœæ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°background loop</li></ul><p>æ¯åç§’çš„æ“ä½œåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>ï¼ˆå¯èƒ½ï¼‰åˆ·æ–°100ä¸ªè„é¡µåˆ°ç¡¬ç›˜</li><li>ï¼ˆæ€»æ˜¯ï¼‰åˆå¹¶æœ€å¤šäº”ä¸ªæ’å…¥ç¼“å†²</li><li>ï¼ˆæ€»æ˜¯ï¼‰å°†æ—¥è‡³ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜</li><li>ï¼ˆæ€»æ˜¯ï¼‰åˆ é™¤æ— ç”¨çš„undoé¡µã€‚å¯¹è¡¨è¿›è¡Œdeleteã€updateæ—¶ï¼ŒåŸå…ˆçš„è¡Œè¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œç‰ˆæœ¬ä¿¡æ¯è¢«ä¿ç•™ï¼Œç”±è¿™ä¸€æ­¥fullpergeåˆ é™¤ã€‚</li><li>ï¼ˆæ€»æ˜¯ï¼‰åˆ·æ–°100ä¸ªæˆ–è€…10ä¸ªè„é¡µåˆ°ç£ç›˜</li></ul><h3 id="background-loop">background loop</h3><p>æ•°æ®åº“ç©ºé—²æˆ–è€…å…³é—­æ—¶ï¼Œå°±ä¼šåˆ‡æ¢åˆ°è¿™ä¸ªå¾ªç¯ã€‚è¯¥å¾ªç¯è¿›è¡Œä»¥ä¸‹æ“ä½œ</p><ul><li>ï¼ˆæ€»æ˜¯ï¼‰åˆ é™¤æ— ç”¨çš„undoé¡µ</li><li>ï¼ˆæ€»æ˜¯ï¼‰åˆå¹¶20ä¸ªæ’å…¥ç¼“å†²</li><li>ï¼ˆæ€»æ˜¯ï¼‰å¦‚æœä¸ç©ºé—²ï¼Œå›åˆ°ä¸»å¾ªç¯</li><li>å¦åˆ™è·³è½¬åˆ°flush loopï¼Œåˆ·æ–°ç¼“å†²æ± 100ä¸ªè„é¡µ</li></ul><h2 id="æ–°ç‰ˆæœ¬ä¸»çº¿ç¨‹çš„å˜åŒ–">æ–°ç‰ˆæœ¬ä¸»çº¿ç¨‹çš„å˜åŒ–</h2><ul><li>åˆ·æ–°åˆ°ç£ç›˜çš„é¡µæ•°é‡ä¸å†é™åˆ¶ä¸º100ï¼Œå¯ä»¥é€šè¿‡<code>innodb_io_capacity</code>è®¾å®šï¼Œé»˜è®¤200ã€‚ä»ç¼“å†²åŒºåˆ·æ–°è„é¡µæ—¶ï¼Œåˆ·æ–°è„é¡µçš„æ•°é‡ä¸º<code>innodb_io_capacity</code>ï¼›åˆå¹¶æ’å…¥ç¼“å†²æ˜¯è¿™ä¸ªå€¼çš„5%ã€‚</li><li>åŸæ¥è„é¡µè¾¾åˆ°90%æ‰ä¼šå¼€å§‹åˆ·æ–°ï¼Œåæ¥æŠŠé»˜è®¤å€¼æ”¹æˆäº†75%ã€‚</li><li><code>innodb_adaptive_flushing</code>ï¼Œé€šè¿‡åˆ¤æ–­é‡åšæ—¥å¿—çš„äº§ç”Ÿé€Ÿåº¦å†³å®šåˆ·æ–°è„é¡µçš„æ•°é‡ã€‚</li><li>å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ full perge æ¯æ¬¡å›æ”¶çš„è„é¡µæ•°é‡ã€‚</li><li>æœ€åæŠŠåˆ·æ–°è„é¡µçš„æ“ä½œå•ç‹¬åˆ†äº†åˆ°äº†ä¸€ä¸ªçº¿ç¨‹ Page Cleanerã€‚</li></ul><h2 id="innodbå…³é”®ç‰¹æ€§">InnoDBå…³é”®ç‰¹æ€§</h2><p><img src="https://s21.ax1x.com/2025/08/14/pVwgttP.png" /></p><h3 id="æ’å…¥ç¼“å†²">æ’å…¥ç¼“å†²</h3><p><code>Insert Buffer</code></p><p>æ’å…¥ç¼“å†²ä¸æ˜¯ç¼“å­˜(cache)ï¼Œè€Œæ˜¯è¡¨ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºå¤„ç†éå”¯ä¸€ç´¢å¼•çš„æ’å…¥å’Œæ›´æ–°æ“ä½œã€‚</p><ul><li>è¡Œæ•°æ®çš„æ’å…¥é¡ºåºæ˜¯æŒ‰ç…§é€æ¸é€’å¢çš„é¡ºåºæ’å…¥ï¼Œé€Ÿåº¦éå¸¸å¿«</li><li>å­˜æ”¾é¡ºåºè¿˜æ˜¯ä¸»é”®ï¼Œå¯¼è‡´éèšé›†ç´¢å¼•é¡µçš„è®¿é—®æ˜¯ç¦»æ•£çš„ï¼Œæ’å…¥ä¹Ÿæ˜¯ç¦»æ•£çš„ï¼Œé€Ÿåº¦è¾ƒæ…¢</li></ul><p>å¦‚æœè¾…åŠ©ç´¢å¼•æ˜¯<strong>éå”¯ä¸€</strong>çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨<strong>æ’å…¥ç¼“å†²</strong>æ¥<strong>æé«˜è¾…åŠ©ç´¢å¼•çš„æ’å…¥æ€§èƒ½</strong>ï¼š</p><p>å¯¹äºéå”¯ä¸€ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•çš„ä¿®æ”¹æ“ä½œå¹¶éå®æ—¶æ›´æ–°ç´¢å¼•é¡µï¼Œè€Œæ˜¯æŠŠè‹¥å¹²å¯¹åŒä¸€é¡µé¢çš„æ›´æ–°ç¼“å­˜èµ·æ¥åšï¼Œåˆå¹¶ä¸ºä¸€æ¬¡æ€§æ›´æ–°æ“ä½œï¼Œå‡å°‘IOã€‚è€Œä¸”è½¬éšæœºIOä¸ºé¡ºåºIO,è¿™æ ·å¯ä»¥é¿å…éšæœºIOå¸¦æ¥æ€§èƒ½æŸè€—ï¼Œæé«˜æ•°æ®åº“çš„å†™æ€§èƒ½ã€‚</p><blockquote><p>æ’å…¥æˆ–è€…æ›´æ–°è¾…åŠ©ç´¢å¼•æ—¶ï¼Œå…ˆåˆ¤æ–­è¦æ’å…¥çš„é¡µæ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥æ’å…¥ï¼Œå¦åˆ™å…ˆæ”¾å…¥åˆ°ç¼“å†²æ± çš„æ’å…¥ç¼“å†²å¯¹è±¡ï¼Œåç»­å†åˆå¹¶ï¼Œè¿™æ ·ä¸€æ¬¡èƒ½æ‰§è¡Œå¤šä¸ªæ’å…¥ã€‚</p></blockquote><p><code>Change Buffer</code></p><p>æ’å…¥ç¼“å†²çš„å‡çº§ç‰ˆï¼Œé€‚ç”¨äºéå”¯ä¸€çš„è¾…åŠ©ç´¢å¼•ï¼Œæ¶µç›–äº†æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤ä¸‰ä¸ªæ“ä½œã€‚</p><p><strong>æ’å…¥ç¼“å†²å†…éƒ¨å®ç°</strong></p><p>æ•°æ®åº“å…¨å±€æ‹¥æœ‰ä¸€ä¸ªB+æ ‘ï¼Œè´Ÿè´£å¯¹æ‰€æœ‰è¡¨çš„è¾…åŠ©ç´¢å¼•è¿›è¡Œæ’å…¥ç¼“å†²ã€‚B+æ ‘å­˜æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ã€‚éå¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯searchkeyé”®å€¼ï¼Œå³ï¼š</p><p>åˆå¹¶æ’å…¥ç¼“å†²è§P65.åˆå¹¶çš„ç›®çš„ï¼Œæ˜¯æŠŠæ’å…¥ç¼“å†²è®°å½•çš„è¾…åŠ©ç´¢å¼•åˆå¹¶åˆ°çœŸæ­£çš„è¾…åŠ©ç´¢å¼•ä¸­ã€‚</p><p>å·¥ä½œæµç¨‹ï¼š</p><ol type="1"><li>Bufferingï¼šå½“éœ€è¦æ’å…¥æˆ–è€…æ›´æ–°è¾…åŠ©ç´¢å¼•æ—¶ï¼Œå¦‚æœç´¢å¼•é¡µåœ¨ç¼“å†²æ± åˆ™ç›´æ¥æ›´æ–°ï¼Œå¦‚æœç›¸åº”çš„ç´¢å¼•é¡µä¸åœ¨ç¼“å†²æ± ä¸­ï¼Œé‚£ä¹ˆå°±æŠŠä¿®æ”¹æ“ä½œç¼“å­˜åœ¨<code>æ’å…¥ç¼“å†²</code>ä¸­ã€‚</li><li>Bitmaptrackingï¼šç”¨ä¸€ä¸ªä½å›¾é¡µè·Ÿè¸ªç¼“å†²æ± ä¸­æ¯ä¸ªç´¢å¼•é¡µçš„ç©ºé—²ç©ºé—´ã€‚<br /></li><li>åˆå¹¶ï¼šè¢«ç¼“å†²çš„æ›´æ”¹ä¼šè¢«å®šæœŸåˆå¹¶å›çœŸæ­£çš„ç´¢å¼•é¡µã€‚</li></ol><p>åˆå¹¶å‘ç”Ÿçš„æ—¶æœºï¼š</p><blockquote><p>The buffered changes are periodically merged back into the actualindex pages. This can happen in several scenarios:</p><ul><li>On-demand merge: When a page containing buffered changes is accessed(read), the changes are merged before the page is returned.</li><li>Scheduled merge: The InnoDB master thread periodically checks formerge operations.</li><li>Bitmap-triggered merge: If the Insert Buffer Bitmap indicates thatan index page has little free space left, a merge operation istriggered.</li></ul></blockquote><h3 id="doublewrite">doublewrite</h3><p>åŒå†™ä¸»è¦ç”¨æ¥è§£å†³æ•°æ®é¡µåˆ·æ–°åˆ°ç£ç›˜æ—¶ï¼Œå› ä¸ºæ„å¤–å¯¼è‡´å†™äº†ä¸å®Œæ•´çš„æ•°æ®é¡µçš„é—®é¢˜ã€‚</p><p>å…³äºIOçš„æœ€å°å•ä½ï¼š</p><ol type="1"><li><p>æ•°æ®åº“IOçš„æœ€å°å•ä½æ˜¯16Kï¼ˆMySQLé»˜è®¤ï¼Œoracleæ˜¯8Kï¼‰</p></li><li><p>æ–‡ä»¶ç³»ç»ŸIOçš„æœ€å°å•ä½æ˜¯4Kï¼ˆä¹Ÿæœ‰1Kçš„ï¼‰</p></li><li><p>ç£ç›˜IOçš„æœ€å°å•ä½æ˜¯512å­—èŠ‚</p></li></ol><p>é‡åšæ—¥å¿—ä»¥é¡µä¸ºå•ä½è¿›è¡Œæ¢å¤ï¼Œä½†æ˜¯å¦‚æœåœ¨æ•°æ®é¡µåˆ·æ–°åˆ°ç£ç›˜çš„è¿‡ç¨‹ä¸­ï¼ˆæ¯æ¬¡4KBï¼Œä½†æ˜¯å®Œæ•´çš„ä¸€é¡µæ˜¯16KBï¼‰ï¼Œé¡µæœ¬èº«å‘ç”ŸæŸåï¼ˆæ¯”å¦‚å†™åˆ°ä¸€åŠçš„æ—¶å€™å®•æœºäº†ï¼‰ï¼Œé‚£redoä¹Ÿæ— åŠ›å›å¤©ã€‚</p><blockquote><p>é‡åšæ—¥å¿—æ˜¯ä»¥<strong>æ—¥å¿—å—</strong>ï¼ˆredo logblockï¼‰ä¸ºå•ä½è¿›è¡Œå­˜å‚¨çš„ï¼Œè€Œä¸€ä¸ªæ—¥å¿—å—çš„å¤§å°æ˜¯ï¼ˆ512å­—èŠ‚ï¼‰ï¼ŒåŸå› å°±åœ¨ä¸Šé¢ã€‚å¾—ç›Šäºæ­¤ï¼Œæ—¥å¿—å—512å­—èŠ‚çš„å†™å…¥ä¹Ÿéƒ½æ˜¯åŸå­çš„ï¼Œè€Œä¸”ä¸ç®¡æ˜¯ç¼“å­˜ä¸­è¿˜æ˜¯ç£ç›˜ä¸­ï¼Œé‡åšæ—¥å¿—éƒ½æ˜¯ä»¥å—çš„æ–¹å¼å­˜å‚¨çš„ã€‚æ‰€ä»¥å†™æ—¥å¿—åˆ°ç£ç›˜çš„è¿‡ç¨‹ä¸éœ€è¦æ‹…å¿ƒé¡µå†™ä¸å®Œæ•´çš„é—®é¢˜ã€‚</p></blockquote><p>doublewriteç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†ä¸ºå†…å­˜ä¸­çš„<code>doublewrite buffer</code>ï¼Œå…¶å¤§å°ä¸º2MBï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ç£ç›˜ä¸Šå…±äº«è¡¨ç©ºé—´(ibdatax)ä¸­<strong>è¿ç»­</strong>çš„128ä¸ªé¡µï¼Œå³2ä¸ªåŒº(extent)ï¼Œå¤§å°ä¹Ÿæ˜¯2Mã€‚åŒå†™çš„å·¥ä½œåŸç†ï¼š</p><blockquote><p>è§¦å‘è„é¡µåˆ·æ–°è¿‡ç¨‹æ—¶ï¼Œå…ˆæŠŠè„é¡µå¤åˆ¶åˆ°å†…å­˜ä¸­çš„<code>doublewrite buffer</code>ï¼Œç„¶åå†™å…¥ç£ç›˜å…±äº«è¡¨ç©ºé—´ä¸­çš„åŒºåŸŸï¼Œæœ€åé©¬ä¸Šè°ƒç”¨<code>fsync</code>ï¼ŒæŠŠç¼“å†²åŒºä¸­çš„è„é¡µå†™å…¥å®é™…çš„ç£ç›˜æ–‡ä»¶ï¼ˆç¦»æ•£å†™ï¼‰ã€‚</p></blockquote><p>å°½ç®¡åŒå†™æ“ä½œè¦æ±‚æ¯ä¸ªé¡µé¢å†™å…¥ä¸¤æ¬¡ï¼Œä½†å…¶å¼€é”€è¿œä½äºä¸€èˆ¬çš„ä¸¤æ¬¡å†™æ“ä½œã€‚ç£ç›˜ä¸­çš„å…±äº«è¡¨ç©ºé—´åŒºåŸŸéƒ½æ˜¯è¿ç»­çš„ï¼Œå› æ­¤å¼€é”€éå¸¸ä½ã€‚å®ƒè¿˜å…è®¸Innodb èŠ‚çœ <code>fsync()</code> æ“ä½œâ€”â€”Innodb æ— éœ€ä¸ºæ¯ä¸ªé¡µé¢å†™å…¥éƒ½è°ƒç”¨<code>fsync()</code>ï¼Œè€Œæ˜¯æäº¤å¤šä¸ªé¡µé¢å†™å…¥å¹¶è°ƒç”¨<code>fsync()</code>ï¼Œè¿™ä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿä¼˜åŒ–å†™å…¥çš„æ‰§è¡Œé¡ºåºï¼Œå¹¶å¹¶è¡Œä½¿ç”¨å¤šä¸ªè®¾å¤‡ã€‚è™½ç„¶è¿™ç§ä¼˜åŒ–å¯ä»¥åœ¨æ²¡æœ‰åŒå†™æ“ä½œçš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä½†å®ƒåªæ˜¯åŒæ—¶å®ç°çš„ã€‚å› æ­¤ï¼Œæ€»ä½“è€Œè¨€ï¼Œæˆ‘é¢„è®¡ä½¿ç”¨åŒå†™æ“ä½œçš„æ€§èƒ½æŸå¤±ä¸ä¼šè¶…è¿‡5-10%ã€‚</p><p><strong>å´©æºƒæ¢å¤</strong></p><p>å¦‚æœå°†é¡µå†™å…¥ç£ç›˜ä¸­å®é™…æ–‡ä»¶çš„è¿‡ç¨‹ä¸­å®•æœºï¼Œé‚£ä¹ˆinnoDBå¯ä»¥ä»ç£ç›˜å…±äº«è¡¨ç©ºé—´åŒºåŸŸæ‰¾åˆ°å‰¯æœ¬ï¼Œå¤åˆ¶åˆ°æ­£ç¡®çš„ä½ç½®å³å¯ï¼Œè¿™æ ·å°±æ¢å¤äº†é¡µï¼Œå†è¯»å–redologï¼Œå°±æ¢å¤äº†æ‰€æœ‰è®°å½•ã€‚</p><h3 id="è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•">è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</h3><p>InnoDBè‡ªåŠ¨å»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œä»B+æ ‘æ”¹é€ è€Œæ¥ï¼Œå°¤å…¶æ˜¯çƒ­ç‚¹æ•°æ®ã€‚</p><h3 id="å¼‚æ­¥io">å¼‚æ­¥IO</h3><p>å½“å‰æ•°æ®åº“éƒ½é‡‡ç”¨å¼‚æ­¥IOæ“ä½œã€‚è„é¡µçš„åˆ·æ–°ï¼ˆç£ç›˜çš„å†™å…¥ï¼‰å…¨éƒ¨ç”±å¼‚æ­¥IOå®Œæˆ.</p><h3 id="åˆ·æ–°é‚»å±…é¡µ">åˆ·æ–°é‚»å±…é¡µ</h3><p>å½“åˆ·æ–°ä¸€ä¸ªè„é¡µæ—¶ï¼Œæ£€æµ‹è¯¥é¡µæ‰€åœ¨åŒºçš„æ‰€æœ‰é¡µï¼Œå¦‚æœæ˜¯è„é¡µåˆ™ä¸€èµ·åˆ·æ–°ã€‚å¯ä»¥å…³é—­ï¼Œå¯¹äºå›ºæ€ç¡¬ç›˜ä¸éœ€è¦è¿™ä¸ªã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠMySQLæŠ€æœ¯å†…å¹•ã€‹è¯»ä¹¦ç¬”è®°2-äº‹åŠ¡</title>
    <link href="/2025/08/17/MySQL%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B02-%E4%BA%8B%E5%8A%A1/"/>
    <url>/2025/08/17/MySQL%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B02-%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›®å½•">ç›®å½•</h2><ol type="1"><li><a href="#äº‹åŠ¡çš„ç‰¹æ€§">äº‹åŠ¡çš„ç‰¹æ€§</a></li><li><a href="#äº‹åŠ¡çš„åˆ†ç±»">äº‹åŠ¡çš„åˆ†ç±»</a></li><li><a href="#redo">redo</a><ol type="1"><li><a href="#binlog">binlog</a></li><li><a href="#log-block-é‡åšæ—¥å¿—å­˜å‚¨æ ¼å¼">log blocké‡åšæ—¥å¿—å­˜å‚¨æ ¼å¼</a></li><li><a href="#log-group">log group</a></li><li><a href="#é‡åšæ—¥å¿—å†…å®¹æ ¼å¼">é‡åšæ—¥å¿—å†…å®¹æ ¼å¼</a></li><li><a href="#lsn">LSN</a></li></ol></li><li><a href="#undo">undo</a><ol type="1"><li><a href="#undologçš„æ ¼å¼">undologçš„æ ¼å¼</a></li><li><a href="#purge">purge</a></li></ol></li><li><a href="#group-commit">group commit</a></li><li><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</a></li><li><a href="#åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</a><ol type="1"><li><a href="#xaäº‹åŠ¡">XAäº‹åŠ¡</a></li><li><a href="#ä¸¤é˜¶æ®µæäº¤">ä¸¤é˜¶æ®µæäº¤</a></li></ol></li><li><a href="#é•¿äº‹åŠ¡">é•¿äº‹åŠ¡</a></li></ol><h2 id="äº‹åŠ¡çš„ç‰¹æ€§">äº‹åŠ¡çš„ç‰¹æ€§</h2><p>ACID</p><table><thead><tr><th>ç‰¹æ€§</th><th>è‹±æ–‡ç¼©å†™</th><th>å…³é”®ç‚¹</th><th>å®ç°æœºåˆ¶</th></tr></thead><tbody><tr><td>åŸå­æ€§</td><td>A</td><td>å…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥</td><td>undo log</td></tr><tr><td>ä¸€è‡´æ€§</td><td>C</td><td>æ•°æ®ä»ä¸€ç§ä¸€è‡´çŠ¶æ€åˆ°å¦ä¸€ç§ä¸€è‡´çŠ¶æ€</td><td>ä¾èµ– Aã€Iã€D</td></tr><tr><td>éš”ç¦»æ€§</td><td>I</td><td>å¹¶å‘äº‹åŠ¡äº’ä¸å¹²æ‰°</td><td>é”ã€MVCC</td></tr><tr><td>æŒä¹…æ€§</td><td>D</td><td>æäº¤çš„æ•°æ®ä¸ä¼šä¸¢</td><td>redo log</td></tr></tbody></table><h2 id="äº‹åŠ¡çš„åˆ†ç±»">äº‹åŠ¡çš„åˆ†ç±»</h2><ul><li>æ‰å¹³äº‹åŠ¡ Flat</li><li>å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ Savepoints</li><li>é“¾äº‹åŠ¡ Chained</li><li>åµŒå¥—äº‹åŠ¡ Nested</li><li>åˆ†å¸ƒå¼äº‹åŠ¡ Distributed</li></ul><p><strong>æ‰å¹³äº‹åŠ¡</strong>ï¼šæœ€ç®€å•çš„ä¸€ç§ï¼ŒBEGINå¼€å§‹ï¼ŒCOMMITç»“æŸï¼Œè¦ä¹ˆéƒ½æäº¤ï¼Œè¦ä¹ˆéƒ½ä¸æäº¤ã€‚</p><p>å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡å…è®¸éƒ¨åˆ†å›æ»šï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®ä¿å­˜ç‚¹æ¥å®ç°çš„ã€‚ç”¨æ³•ï¼š<code>SAVEPOINT ä¿ç•™ç‚¹çš„åç§°</code>ï¼Œå›æ»š<code>ROLLBACK TO ä¿ç•™ç‚¹çš„åå­—</code></p><p>æ‰å¹³äº‹åŠ¡çš„ä¿å­˜ç‚¹åœ¨ç³»ç»Ÿå´©æºƒåä¼šä¸¢å¤±ï¼Œè€Œ<strong>é“¾äº‹åŠ¡</strong>è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚å½“ä¸€ä¸ªäº‹åŠ¡æäº¤ï¼ˆCOMMITï¼‰æˆ–å›æ»šï¼ˆROLLBACKï¼‰åï¼Œæ•°æ®åº“ä¼š<strong>ç«‹å³è‡ªåŠ¨å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡</strong>ï¼Œæäº¤äº‹åŠ¡çš„æ“ä½œå’Œå¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„æ“ä½œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå°±å¥½åƒåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œçš„ä¸€æ ·ã€‚è€Œä¸”ï¼Œé“¾äº‹åŠ¡åªèƒ½å›æ»šåˆ°æœ€è¿‘çš„ä¸€ä¸ªä¿å­˜ç‚¹ã€‚</p><p><strong>åµŒå¥—äº‹åŠ¡</strong>ï¼šåµŒå¥—ç»“æ„ï¼Œé¡¶å±‚äº‹åŠ¡æ§åˆ¶ç€ä¸‹é¢çš„å­äº‹åŠ¡ï¼Œå­äº‹åŠ¡æ—¢å¯ä»¥æ˜¯æ‰å¹³çš„ä¹Ÿå¯ä»¥æ˜¯åµŒå¥—çš„ï¼Œå½¢æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://s21.ax1x.com/2025/08/11/pVdrlJe.png"alt="åµŒå¥—äº‹åŠ¡çš„å±‚æ¬¡ç»“æ„" /><figcaption aria-hidden="true">åµŒå¥—äº‹åŠ¡çš„å±‚æ¬¡ç»“æ„</figcaption></figure><p>ç±»ä¼¼æ•°æ®ç»“æ„ä¸­çš„æ ‘ï¼Œå¤„äºæ ¹èŠ‚ç‚¹çš„äº‹åŠ¡è¢«ç§°ä¸ºé¡¶å±‚äº‹åŠ¡ï¼Œå…¶ä»–äº‹åŠ¡è¢«ç§°ä¸ºå„¿å­äº‹åŠ¡ï¼›äº‹åŠ¡çš„å‰é©±è¢«ç§°ä¸ºçˆ¶äº‹åŠ¡ï¼Œä¸‹ä¸€å±‚è¢«ç§°ä¸ºå„¿å­äº‹åŠ¡ã€‚</p><p>ä»»ä½•å­äº‹åŠ¡åœ¨é¡¶å±‚äº‹åŠ¡æäº¤åæ‰ä¼šçœŸæ­£è¢«æäº¤ï¼›æ ‘ä¸­çš„ä»»æ„ä¸€ä¸ªäº‹åŠ¡çš„å›æ»šä¼šå¼•èµ·å®ƒçš„æ‰€æœ‰çš„å­äº‹åŠ¡ä¸€åŒå›æ»šã€‚</p><p><strong>InnoDBå¹¶ä¸åŸç”Ÿæ”¯æŒåµŒå¥—äº‹åŠ¡</strong></p><h2 id="redo">redo</h2><p>é‡åšæ—¥å¿—ç”¨æ¥å®ç°<strong>äº‹åŠ¡</strong>çš„<strong>æŒä¹…æ€§</strong>ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>å†…å­˜ä¸­çš„<strong>é‡åšæ—¥å¿—ç¼“å†²</strong></li><li>ç¡¬ç›˜ä¸­çš„<strong>é‡åšæ—¥å¿—æ–‡ä»¶</strong></li></ul><p><em>äº‹åŠ¡æäº¤æ—¶ï¼Œå¿…é¡»å°†æ‰€æœ‰çš„ç¼“å†²é‡åšæ—¥å¿—éƒ½å†™å…¥åˆ°ç£ç›˜ä¸­</em>ã€‚ä¸ºäº†ç¡®ä¿è¿™ä¸€ç‚¹ï¼ŒInnoDBå¼•æ“ä¼šè°ƒç”¨<code>fsync</code>ï¼Œç›®çš„æ˜¯å°†æ–‡ä»¶ç³»ç»Ÿå†™ç¼“å†²åŒºçš„æ•°æ®ç«‹å³å†™å…¥ç£ç›˜ã€‚</p><p><code>innodb_flush_log_at_trx_commit</code>æ§åˆ¶é‡åšæ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜çš„ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼ä¸º1ï¼Œäº‹åŠ¡æäº¤æ—¶å¿…é¡»è°ƒç”¨fsyncã€‚0è¡¨ç¤ºæŠŠå†™å…¥é‡åšæ—¥å¿—çš„æ“ä½œäº¤ç»™ä¸»çº¿ç¨‹ï¼Œæ¯éš”1ç§’æ‰§è¡Œä¸€æ¬¡ï¼›2è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶æŠŠé‡åšæ—¥å¿—å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„å†™ç¼“å†²ä¸­ï¼Œç”±æ–‡ä»¶ç³»ç»Ÿå†³å®šå»¶è¿Ÿå†™å…¥ã€‚</p><p>æ‰‹åŠ¨å…³é—­<code>fsync</code>ï¼ˆæŠŠå‚æ•°è®¾ç½®æˆ0æˆ–è€…2ï¼‰å¯ä»¥æ˜æ˜¾æé«˜æ•°æ®åº“çš„æ€§èƒ½ï¼Œä»£ä»·æ˜¯ä¸§å¤±äº†äº‹åŠ¡çš„ACIDç‰¹æ€§ã€‚</p><h3 id="binlog">binlog</h3><p>binlogï¼ŒäºŒè¿›åˆ¶æ—¥å¿—ï¼Œç”¨äº<strong>ä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤</strong>ã€‚binlogæœ‰ä¸‰ç§æ¨¡å¼ï¼š</p><ul><li>ROW: è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–</li><li>STATEMENTï¼šè®°å½•åŸå§‹SQLè¯­å¥</li><li>MIXEDï¼šé»˜è®¤è¯¥æ¨¡å¼ï¼Œä¼˜å…ˆä½¿ç”¨STATEMENTï¼Œå¦‚æœå¯èƒ½å¯¼è‡´ä¸»ä»ä¸ä¸€è‡´æ‰ä¼šä½¿ç”¨ROWã€‚</li></ul><p>å¦‚æœæ˜¯STATEMENTï¼Œbinlogçš„åŸç†å’Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—å·®ä¸å¤šï¼Œéƒ½å±äºé€»è¾‘æ—¥å¿—ï¼Œä¸ redoæ—¥å¿—çš„åŒºåˆ«ï¼š</p><ul><li>ç®¡è¾–èŒƒå›´ï¼šredoæ—¥å¿—ç”± InnoDBå­˜å‚¨å¼•æ“äº§ç”Ÿï¼Œä¸è®°å½•å­˜å‚¨å¼•æ“ä»¥å¤–çš„æ“ä½œï¼›binlogåœ¨MySQLæ•°æ®åº“çš„ä¸Šå±‚äº§ç”Ÿï¼Œä¸€ä¸ªæ•°æ®åº“å¯ä»¥ä½¿ç”¨å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œä»»ä½•å­˜å‚¨å¼•æ“å¯¹æ•°æ®åº“æ›´æ”¹éƒ½ä¼šäº§ç”ŸäºŒè¿›åˆ¶æ—¥å¿—ã€‚</li><li>binlogæ˜¯ä¸€ç§é€»è¾‘æ—¥å¿—ï¼Œè®°å½•SQLè¯­å¥ï¼›redoæ—¥å¿—æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•å…·ä½“çš„ä¿®æ”¹æ•°æ®ã€‚</li><li>äºŒè¿›åˆ¶æ—¥å¿—åªåœ¨äº‹åŠ¡æäº¤å®Œæˆåå†™å…¥ä¸€æ¬¡ï¼Œredoæ—¥å¿—åœ¨æ‰§è¡Œæ—¶å°±ä¸æ–­å†™å…¥ç¼“å†²åŒº</li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>binlog</th><th>redo log</th></tr></thead><tbody><tr><td>å†™å…¥æ—¶æœº</td><td>äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™å…¥</td><td>æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸æ–­å†™å…¥</td></tr><tr><td>è®°å½•å†…å®¹</td><td>é€»è¾‘æ“ä½œï¼ˆSQL æˆ–è¡Œå˜æ›´äº‹ä»¶ï¼‰</td><td>ç‰©ç†é¡µä¿®æ”¹</td></tr><tr><td>é¡ºåº</td><td>ä¸¥æ ¼æŒ‰äº‹åŠ¡æäº¤é¡ºåº</td><td>æŒ‰ç‰©ç†ä¿®æ”¹äº§ç”Ÿçš„å…ˆåé¡ºåºï¼ˆå¯èƒ½äº¤é”™ï¼‰</td></tr><tr><td>ä½œç”¨</td><td>å½’æ¡£ã€å¤åˆ¶</td><td>å´©æºƒæ¢å¤ï¼ˆä¿è¯æŒä¹…æ€§ï¼‰</td></tr></tbody></table><p>å…·ä½“è§£é‡Šä¸€ä¸‹ï¼Œå¯¹äº redoæ—¥å¿—æ¥è¯´ï¼Œäº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œæ¯æ¡ä¿®æ”¹è¯­å¥ç«‹å³æŠŠå¯¹åº”çš„ç‰©ç†é¡µä¿®æ”¹è®°å½•å†™å…¥ redolog bufferç¼“å†²åŒºä¸­ï¼Œè¿™é‡Œå€Ÿç”¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å†²åŒºï¼Œä¸€æ—¦å†™å…¥ï¼Œæ–‡ä»¶ç³»ç»Ÿå°±ä¼šæ ¹æ®è‡ªèº«çš„è§„åˆ™å»¶è¿Ÿå°†å…¶å†™å…¥ç£ç›˜ã€‚å› æ­¤äº‹åŠ¡æ²¡æäº¤æ—¶ï¼Œredologä¹Ÿå¯èƒ½<strong>å·²ç»éƒ¨åˆ†å†™å…¥ç£ç›˜</strong>ï¼Œæäº¤æ—¶è°ƒç”¨<code>fsync</code>æ˜¯ä¸ºäº†ç¡®ä¿æ‰€æœ‰å°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½èƒ½è¢«å†™å…¥å®Œæ¯•ã€‚</p><p>å¯¹äº binlog æ¥è¯´ï¼Œæ¯æ¡ä¼šäº§ç”Ÿ binlogçš„è¯­å¥ä¼šæŠŠå¯¹åº”çš„é€»è¾‘æ“ä½œè®°å½•å†™å…¥<code>binlog cache</code>ï¼Œ<strong>äº‹åŠ¡æäº¤å‰æ°¸è¿œä¹Ÿä¸ä¼šå†™å…¥ç£ç›˜</strong>ï¼Œäº‹åŠ¡æäº¤æ—¶æ‰å¼€å§‹å†™å…¥ï¼ˆç¼“å†²å†™ï¼‰ï¼Œé¿å…è®°å½•æœªæäº¤çš„äº‹åŠ¡ã€‚</p><h3 id="log-block-é‡åšæ—¥å¿—å­˜å‚¨æ ¼å¼">log block é‡åšæ—¥å¿—å­˜å‚¨æ ¼å¼</h3><blockquote><p>ç£ç›˜æä¾›çš„åŸå­æ€§ä¿è¯ï¼šç£ç›˜ä¿è¯ä»»ä½• 512å­—èŠ‚çš„å†™å…¥éƒ½ä¼šå‘ç”Ÿæˆ–ä¸å‘ç”Ÿã€‚</p></blockquote><p>é‡åšæ—¥å¿—æ˜¯ä»¥<strong>æ—¥å¿—å—</strong>ï¼ˆredo logblockï¼‰ä¸ºå•ä½è¿›è¡Œå­˜å‚¨çš„ï¼Œè€Œä¸€ä¸ªæ—¥å¿—å—çš„å¤§å°æ˜¯ï¼ˆ512å­—èŠ‚ï¼‰ï¼ŒåŸå› å°±åœ¨ä¸Šé¢ã€‚å¾—ç›Šäºæ­¤ï¼Œæ—¥å¿—å—512å­—èŠ‚çš„å†™å…¥ä¹Ÿéƒ½æ˜¯åŸå­çš„ï¼Œè€Œä¸”ä¸ç®¡æ˜¯ç¼“å­˜ä¸­è¿˜æ˜¯ç£ç›˜ä¸­ï¼Œé‡åšæ—¥å¿—éƒ½æ˜¯ä»¥å—çš„æ–¹å¼å­˜å‚¨çš„ã€‚æ‰€ä»¥é‡åšæ—¥å¿—ä¸éœ€è¦doublewriteæœºåˆ¶ç»´æŠ¤é¡µçš„å®Œæ•´æ€§ï¼Œå› ä¸ºç£ç›˜æœ¬èº«å·²ç»ä¿è¯äº†ã€‚</p><p><strong>redo bufferçš„ç»“æ„</strong>ï¼ˆç£ç›˜ä¸Šçš„ç»“æ„è·Ÿè¿™ä¸ªå·®ä¸å¤šï¼‰</p><p><img src="https://s21.ax1x.com/2025/08/11/pVd6kRg.png" /></p><ul><li>å—å¤´éƒ¨ï¼š12å­—èŠ‚</li><li>æ•°æ®å—ï¼š492å­—èŠ‚</li><li>å—å°¾éƒ¨ï¼š8å­—èŠ‚</li></ul><p><strong>æ—¥å¿—å—å¤´éƒ¨</strong>åˆç”±å››éƒ¨åˆ†ç»„æˆï¼Œä»ä¸Šåˆ°ä¸‹ä¸€æ¬¡å ç”¨4ã€2ã€2ã€4å­—èŠ‚ã€‚ä»ä¸Šåˆ°ä¸‹çš„ä½œç”¨ä¾æ¬¡ä¸ºï¼š</p><ol type="1"><li>æ ‡è®°è¯¥å—åœ¨ç¼“å†²åŒºä¸­çš„ä½ç½®ï¼Œå¾ªç¯ä½¿ç”¨</li><li>è¯¥å—å·²ç»è¢«ä½¿ç”¨çš„å¤§å°ï¼Œæœ€å¤§<code>0x200</code>å³512å­—èŠ‚</li><li>è¯¥æ—¥å¿—å—ä¸­ï¼Œç¬¬ä¸€ä¸ªæ–°æ—¥å¿—çš„åç§»é‡ã€‚å› ä¸ºä¸€ä¸ªæ•°æ®å—ä¸­å¯èƒ½åŒ…å«æŸä¸ªè¾ƒå¤§çš„é‡åšæ—¥å¿—çš„ååŠéƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸€ä¸ªåç§»é‡ç”¨æ¥æ ‡è®°ä¸‹ä¸€ä¸ªæ—¥å¿—çš„èµ·ç‚¹ä½ç½®ã€‚</li><li>æ£€æŸ¥ç‚¹çš„ç¼–å·ï¼Œæ£€æŸ¥ç‚¹çš„æ„æ€æ˜¯åœ¨æ¬¡ä¹‹å‰çš„æ•°æ®å’Œå…ƒæ•°æ®éƒ½å·²ç»å†™å…¥ç£ç›˜ï¼Œå…¨å±€é€’å¢</li></ol><p><strong>å°¾éƒ¨</strong>å­—æ®µå’Œå¤´éƒ¨çš„ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ç›¸åŒï¼Œå¯ç”¨äº<strong>å®Œæ•´æ€§æ ¡éªŒ</strong>ï¼Œå› ä¸ºå†™å…¥redoæ—¥å¿—æ—¶æ˜¯å…ˆå†™å¤´éƒ¨ã€æ•°æ®å—ï¼Œå†å†™å°¾éƒ¨ï¼Œå¦‚æœå°¾éƒ¨è¿˜æ²¡å†™å®Œï¼Œå°±èƒ½åˆ¤æ–­è¿™ä¸ªå—ä¸å®Œæ•´ã€‚</p><h3 id="log-group">log group</h3><p><strong>é‡åšæ—¥å¿—ç»„</strong>ï¼Œæ˜¯ç”±ä¸€ç»„ redoæ—¥å¿—æ–‡ä»¶æ„æˆçš„é›†åˆã€‚ç£ç›˜ä¸­çš„çš„ redo logå¹¶ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯<strong>ä¸€ç»„å¤§å°ç›¸ç­‰çš„æ—¥å¿—æ–‡ä»¶</strong>ï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—ç»„ã€‚æ—¥å¿—ç»„å’Œæ—¥å¿—æ–‡ä»¶ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="https://s21.ax1x.com/2025/08/11/pVd6ISg.png" /></p><p>æ—¥å¿—ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶è¿˜ä¿å­˜äº†2KBçš„å…ƒæ•°æ®ï¼Œç”¨äºæ¢å¤å­˜å‚¨å¼•æ“ã€‚å…¶ä½™æ—¥å¿—æ–‡ä»¶ä¿ç•™2KBçš„åŒºåŸŸï¼Œä½†æ˜¯ä¸å†™å…¥æ•°æ®ã€‚è¿™2KBåŒºåŸŸçš„ç»“æ„å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç§°</th><th>å¤§å°ï¼ˆå­—èŠ‚ï¼‰</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>log file header</td><td>512</td><td>è®°å½•æ—¥å¿—ç»„çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚groupIDã€LSN</td></tr><tr><td>æ£€æŸ¥ç‚¹1</td><td>512</td><td>ç¬¬ä¸€ä»½æ£€æŸ¥ç‚¹ä¿¡æ¯</td></tr><tr><td>ç©º</td><td>512</td><td>ä¿ç•™åŒº</td></tr><tr><td>æ£€æŸ¥ç‚¹2</td><td>512</td><td>ç¬¬äºŒä»½æ£€æŸ¥ç‚¹çš„ä¿¡æ¯</td></tr></tbody></table><p>å…¶ä¸­æ£€æŸ¥ç‚¹ä¿¡æ¯ç”¨äºå­˜å‚¨æœ€è¿‘ä¸€æ¬¡æ£€æŸ¥ç‚¹çš„ LSN ä½ç½®ï¼Œå³å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„redo æ—¥å¿—çš„ä½ç½®ã€‚</p><figure><img src="https://s21.ax1x.com/2025/08/11/pVdNdmD.png" alt="é€»è¾‘ç»“æ„" /><figcaption aria-hidden="true">é€»è¾‘ç»“æ„</figcaption></figure><h3 id="é‡åšæ—¥å¿—å†…å®¹æ ¼å¼">é‡åšæ—¥å¿—å†…å®¹æ ¼å¼</h3><p><strong>InnoDBåŸºäºé¡µè¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥é‡åšæ—¥å¿—çš„æ ¼å¼ä¹Ÿæ˜¯åŸºäºé¡µçš„</strong>ã€‚ä¸‹é¢è®¨è®ºé‡åšæ—¥å¿—çš„logblocké‡Œå­˜å‚¨çš„å†…å®¹æ˜¯æŒ‰ç…§ä»€ä¹ˆæ ¼å¼è¿›è¡Œçš„ã€‚</p><ul><li>é€šç”¨å¤´éƒ¨<ul><li>redo_log_typeï¼šé‡åšæ—¥å¿—çš„ç±»å‹</li><li>spaceï¼šè¡¨ç©ºé—´çš„id</li><li>page_noï¼šé¡µçš„åç§»é‡ã€‚</li></ul></li><li>redo log bodyï¼šå†…å®¹æ ¹æ®é‡åšæ—¥å¿—çš„ç±»å‹è€Œä¸åŒ</li></ul><p>log bufferæ ¹æ®ä¸€å®šçš„è§„åˆ™æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè€Œä¸”å±äº<strong>è¿½åŠ å†™å…¥</strong>ã€‚</p><h3 id="lsn">LSN</h3><p>å‰é¢æåˆ°ï¼Œæ—¥å¿—ç»„çš„ç¬¬ä¸€ä¸ªé‡åšæ—¥å¿—æ–‡ä»¶å­˜å‚¨çš„ log file headerå­˜å‚¨äº†LSNã€‚LSN çš„å…¨ç§°æ˜¯ Log SequenceNumberï¼Œ<strong>æ—¥å¿—åºåˆ—å·</strong>ï¼Œæ˜¯æ•°æ®åº“ä¸­ä¸ºæ¯æ¡æ—¥å¿—è®°å½•åˆ†é…çš„å”¯ä¸€ä¸”é€’å¢çš„ç¼–å·ï¼Œé€šå¸¸ä»¥å­—èŠ‚åç§»é‡è¡¨ç¤ºæ—¥å¿—åœ¨æ—¥å¿—æ–‡ä»¶ä¸­çš„ä½ç½®ã€‚<strong>åœ¨InnoDB é‡Œï¼ŒLSN è®°å½•äº†é‡åšæ—¥å¿—å†™å…¥çš„æ€»å­—èŠ‚æ•°ï¼Œä»æ•°æ®åº“å®ä¾‹å¯åŠ¨æ—¶å¼€å§‹ç´¯è®¡é€’å¢</strong>ã€‚</p><p>æ—¥å¿—ã€é¡µã€æ£€æŸ¥ç‚¹éƒ½æœ‰è‡ªå·±çš„LSNã€‚</p><p>LSNä¸ä»…ä½äºé‡åšæ—¥å¿—ï¼Œä¹Ÿä½äºæ¯ä¸ªé¡µçš„å¤´éƒ¨ï¼Œé¡µå¤´éƒ¨çš„LSNè¡¨ç¤ºè¯¥é¡µæœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶LSN çš„å¤§å°ï¼Œç”¨äºæ£€æµ‹æ˜¯å¦éœ€è¦æ¢å¤æ“ä½œã€‚å¦‚æœé¡µçš„ LSNå°äºé‡åšæ—¥å¿—ï¼Œè¯´æ˜éœ€è¦æ¢å¤ã€‚</p><p>ä½¿ç”¨<code>show engine innodb status</code>æŸ¥çœ‹LSNçš„æƒ…å†µï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-string">LOG</span><br><span class="hljs-meta">---</span><br><span class="hljs-string">Log</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-number">116339</span><br><span class="hljs-string">Log</span> <span class="hljs-string">flushed</span> <span class="hljs-string">up</span> <span class="hljs-string">to</span>   <span class="hljs-number">116339</span><br><span class="hljs-string">Pages</span> <span class="hljs-string">flushed</span> <span class="hljs-string">up</span> <span class="hljs-string">to</span> <span class="hljs-number">116339</span><br><span class="hljs-string">Last</span> <span class="hljs-string">checkpoint</span> <span class="hljs-string">at</span>  <span class="hljs-number">116323</span><br></code></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li>LSNåºåˆ—å·ï¼Œè¡¨ç¤ºé‡åšæ—¥å¿—çš„è¿›åº¦</li><li>åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶çš„LSNï¼Œè¿™é‡Œè¡¨ç¤ºæ—¥å¿—æ–‡ä»¶ä¸­å·²ç»åŒ…å«äº†æ‰€æœ‰çš„æœ€æ–°è®°å½•ã€‚</li><li>ç¼“å­˜åˆ° Buffer Poolä¸­çš„æ•°æ®é¡µå·²ç»å†™å…¥ç£ç›˜çš„è¿›åº¦ï¼Œå®æ—¶åˆ·æ–°ã€‚è¿™é‡Œè¡¨ç¤ºæ‰€æœ‰çš„æ•°æ®é¡µéƒ½å·²ç»åˆ·æ–°åˆ°ç£ç›˜ã€‚</li><li>æ£€æŸ¥ç‚¹æ˜¯å´©æºƒæ¢å¤çš„èµ·å§‹æ ‡è®°ï¼Œæ£€æŸ¥ç‚¹æŒ‰ç…§ä¸€å®šè§„åˆ™å®šæœŸåˆ·æ–°</li></ul><p>InnoDBå¼•æ“ä¼šè®°å½•æœ€åä¸€æ¬¡æ£€æŸ¥ç‚¹çš„ä½ç½®ï¼Œæ¯æ¬¡åœ¨å¯åŠ¨å¼•æ“æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œæ¢å¤æ“ä½œï¼Œ<strong>ä»ä¸Šä¸€æ¬¡æ£€æŸ¥ç‚¹å¼€å§‹è¯»å–é‡åšæ—¥å¿—</strong>è¿›è¡Œæ¢å¤ã€‚åˆå› ä¸ºé‡åšæ—¥å¿—æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯å…·ä½“çš„æ•°æ®ï¼Œæ‰€ä»¥æ¢å¤é€Ÿåº¦è¦å¿«å¾—å¤šã€‚è€Œä¸”é‡åšæ—¥å¿—æ˜¯å¯ä»¥å¤šçº¿ç¨‹<strong>å¹¶è¡Œ</strong>è¿›è¡Œçš„ï¼Œå…·ä½“çš„å®ç°æ–¹æ³•æ˜¯æŠŠæ—¥å¿—åˆ†æˆæ— å†²çªçš„ä¸åŒåˆ†åŒºï¼Œäº¤ç»™ä¸åŒçš„çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œè€Œæœ‰å†²çªçš„æ“ä½œå¿…é¡»é¡ºåºæ‰§è¡Œã€‚</p><h2 id="undo">undo</h2><p>redo ç”¨äºæ•°æ®åº“çš„æ¢å¤ï¼Œè€Œ undoç”¨äº<strong>å›æ»š</strong>ï¼Œå±äºé€»è¾‘æ—¥å¿—ã€‚å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ—¢ä¼šäº§ç”Ÿ redoæ—¥å¿—ï¼Œä¹Ÿä¼šäº§ç”Ÿ undoï¼ŒåŒæ—¶ undo æ—¥å¿—ä¹Ÿæœ‰å¯¹åº”çš„ redo æ—¥å¿—ï¼Œå› ä¸º undoä¹Ÿæ˜¯éœ€è¦æŒä¹…åŒ–ï¼Œä¿è¯æ–­ç”µæˆ–å´©æºƒåèƒ½æ­£ç¡®å›æ»šã€‚</p><p>uodoæ—¥å¿—ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li><strong>é€»è¾‘å›æ»š</strong>rollback</li><li><strong>MVCCå®ç°éé”å®šè¯»</strong>ã€‚å½“è¯»å–è®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•è¢«å…¶ä»–äº‹åŠ¡åŠ é”ï¼Œæˆ–å½“å‰ç‰ˆæœ¬å¯¹è¯¥äº‹åŠ¡ä¸å¯è§ï¼Œåˆ™å¯ä»¥é€šè¿‡undo log è¯»å–ä¹‹å‰çš„ç‰ˆæœ¬æ•°æ®ï¼Œä»¥æ­¤å®ç°éé”å®šè¯»ã€‚</li></ul><p>æ‰§è¡Œå›æ»šæ“ä½œæ—¶è¯»å– undoæ—¥å¿—ï¼Œå°†æ•°æ®åº“<strong>é€»è¾‘åœ°</strong>æ¢å¤åˆ°åŸæ¥çš„æ ·å­ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·æ’å…¥äº†10Wæ¡æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´è¡¨ç©ºé—´çš„å¢å¤§ï¼Œä½†æ˜¯undoæ—¥å¿—åªæ˜¯è®°å½•ç›¸åçš„æ“ä½œ<code>DELETE</code>ï¼Œå¹¶ä¸ä¼šæŠŠè¡¨ç©ºé—´çš„å¤§å°ä¹Ÿç¼©å°åˆ°åŸæ¥çš„çŠ¶æ€ã€‚</p><p><strong>å­˜å‚¨ä½ç½®ï¼š</strong>è¡¨ç©ºé—´çš„<code>undo segment</code>ã€‚<strong>ç®¡ç†æ–¹å¼</strong>ï¼š<code>rollback segment</code>ï¼Œä¸€ä¸ªrollbackæ®µåŒ…å«1024ä¸ªundo segmentã€‚ä»¥æ®µä¸ºå•ä½ç”³è¯·é¡µã€‚</p><p>äº‹åŠ¡æäº¤æ—¶ï¼Œundo logçš„å»å‘ï¼š</p><ul><li>å°† undo log æ”¾å…¥ä¸€ä¸ªé“¾è¡¨(History List)</li><li>åˆ¤æ–­ undo log æ‰€åœ¨çš„é¡µæ˜¯å¦å¯ä»¥é‡ç”¨ï¼Œå¯ä»¥å°±ç»§ç»­åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡</li></ul><p>ç”± purge çº¿ç¨‹è´Ÿè´£æœ€ç»ˆåˆ é™¤ undo logã€‚</p><h3 id="undologçš„æ ¼å¼">undologçš„æ ¼å¼</h3><p>åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é’ˆå¯¹ä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¸€ç§æ˜¯é’ˆå¯¹å·²ç»å­˜åœ¨çš„æ•°æ®</p><ul><li>insert undo logã€‚</li><li>update undo logï¼ŒåŒ…å« update å’Œ delete ä¸¤ä¸ªæ“ä½œ</li></ul><p>insertæ—¥å¿—å¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ï¼Œä½†æ˜¯updateä¸è¡Œï¼Œè¿˜è¦ç”¨äºMVCCæœºåˆ¶ï¼Œæ‰€ä»¥å…ˆæ”¾å…¥å†å²é“¾è¡¨ä¸­ï¼Œé“¾è¡¨å¤´éƒ¨æ˜¯æœ€æ–°çš„è®°å½•ã€‚</p><p>ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹äº‹åŠ¡çŠ¶æ€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.innodb_trx\G<br></code></pre></td></tr></table></figure><h3 id="purge">purge</h3><p>æ¸…ç†æ€è·¯ï¼šæ¸…ç†ä¹‹å‰çš„deleteå’Œupdateï¼Œä½¿å…¶æœ€ç»ˆå®Œæˆã€‚é€‚ç”¨äºå·²ç»ä¸è¢«ä»»ä½•äº‹åŠ¡å¼•ç”¨çš„æ“ä½œã€‚</p><p>å…ˆä»HistoryListæ‰¾åˆ°ç¬¬ä¸€ä¸ªéœ€è¦è¢«æ¸…ç†çš„æ—¥å¿—ï¼Œç„¶åä»è¯¥æ—¥å¿—æ‰€åœ¨çš„é¡µç»§ç»­æ‰¾åˆ«çš„éœ€è¦æ¸…ç†çš„æ—¥å¿—ï¼Œæ‰¾ä¸åˆ°å°±å›åˆ°é“¾è¡¨å¾€ä¸‹æ‰¾ã€‚</p><p><img src="https://s21.ax1x.com/2025/08/12/pVdoKGn.png" /></p><h2 id="group-commit">group commit</h2><ul><li>å¯¹äºåªè¯»äº‹åŠ¡ï¼Œä¸æ¶‰åŠç£ç›˜æ–‡ä»¶çš„æ›´æ”¹ï¼Œæ‰€ä»¥æäº¤æ—¶ä¸éœ€è¦fsync</li><li>å¯¹äºéåªè¯»äº‹åŠ¡ï¼Œå¿…é¡»åœ¨äº‹åŠ¡æäº¤æ—¶ç«‹å³æ‰§è¡Œfsyncï¼Œä¿è¯ redoæ—¥å¿—éƒ½å·²ç»å†™å…¥ç£ç›˜ã€‚</li></ul><p>ä¼ ç»Ÿå•äº‹åŠ¡æäº¤æ¯ä¸ªäº‹åŠ¡éƒ½è¦è°ƒç”¨ä¸€æ¬¡fsyncï¼Œgroupcommitæ˜¯ä¸ºäº†æé«˜fsyncçš„æ•ˆç‡ï¼Œä¸€æ¬¡æ€§å°†å¤šä¸ªé‡åšæ—¥å¿—å†™å…¥ç£ç›˜ã€‚<strong>å·¥ä½œåŸç†</strong>ï¼š</p><ul><li>å½“ç¬¬ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚æäº¤æ—¶ï¼Œä¼šå‘èµ·ç£ç›˜åŒæ­¥è¯·æ±‚ã€‚</li><li>åœ¨ç£ç›˜åŒæ­¥å®Œæˆå‰ï¼Œå¦‚æœæœ‰å…¶ä»–äº‹åŠ¡ä¹Ÿå‘èµ·æäº¤ï¼Œè¿™äº›äº‹åŠ¡ä¸ä¼šç«‹å³è°ƒç”¨fsyncï¼Œè€Œæ˜¯ç­‰å¾…ç¬¬ä¸€ä¸ªäº‹åŠ¡çš„åŒæ­¥ç»“æœã€‚</li><li>è¿™æ ·ï¼Œå¤šä¸ªäº‹åŠ¡çš„æ—¥å¿—å†™å…¥å¯ä»¥è¢«åˆå¹¶åˆ°ä¸€ä¸ªç£ç›˜å†™å…¥æ“ä½œä¸­ï¼Œä¸€æ¬¡ fsyncåŒæ—¶ä¿è¯äº†å¤šä¸ªäº‹åŠ¡çš„æŒä¹…åŒ–ã€‚</li><li>ç­‰å¾…çš„äº‹åŠ¡åœ¨ç£ç›˜åŒæ­¥å®Œæˆåï¼Œç»Ÿä¸€æ”¶åˆ°æäº¤æˆåŠŸçš„é€šçŸ¥ï¼Œå®Œæˆæäº¤æµç¨‹ã€‚</li></ul><p>åŒæ—¶æäº¤çš„äº‹åŠ¡è¶Šå¤šï¼Œgroupcommitçš„æ•ˆæœè¶Šæ˜æ˜¾ï¼Œæ•°æ®åº“æ€§èƒ½çš„æå‡å°±è¶Šå¤§ã€‚</p><hr /><p>InnoDB 1.2 ä¹‹å‰ï¼Œå¼€å¯ binlogä¼šè®©äº‹åŠ¡æäº¤æµç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œ<code>binlog fsync</code> å’Œ<code>redo log fsync</code> ä¸èƒ½å¹¶è¡Œæˆ–è€…åˆå¹¶æ‰§è¡Œï¼Œä»è€Œè®© group commitå¤±æ•ˆã€‚MySQL 5.6 å¼•å…¥ binlog group commit æ‰è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p><p><img src="https://s21.ax1x.com/2025/08/12/pVwPUxK.png" /></p><h2 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h2><p>æœ‰å››ç§äº‹åŠ¡éš”ç¦»çš„çº§åˆ«æ ‡å‡†ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰æ•°æ®å‚å•†éµå¾ªè¿™äº›æ ‡å‡†ï¼Œæ¯”å¦‚Oracleä¸æ”¯æŒRRéš”ç¦»çº§åˆ«ã€‚</p><ul><li>RUï¼šREAD UNCOMMITED</li><li>RC: READ COMMITED</li><li>RR: REPEATABLE READ</li><li>SERIALIZABLE</li></ul><p>InnoDBå­˜å‚¨å¼•æ“é»˜è®¤RRï¼Œä½†æ˜¯é™„å¸¦Next-keyç®—æ³•ï¼Œé¿å…äº†å¹»è¯»ã€‚é»˜è®¤RRæ²¡æœ‰å¹»è¯»ä¿æŠ¤ã€‚</p><h2 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>åˆ†å¸ƒå¼äº‹åŠ¡å…è®¸å¤šä¸ªä¸åŒçš„äº‹åŠ¡æ¥æºå‚ä¸åˆ°ä¸€ä¸ªå…¨å±€äº‹åŠ¡ä¸­ã€‚ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡å¿…é¡»æŠŠInnoDBå¼•æ“çš„äº‹åŠ¡éš”ç¦»ç­‰çº§æå‡ä¸ºSERIALIZABLEã€‚</p><h3 id="xaäº‹åŠ¡">XAäº‹åŠ¡</h3><p>XAäº‹åŠ¡æ˜¯ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡åè®®ï¼Œå®ƒæ‰«æå¤šä¸ªèµ„æºæ¥æºï¼Œæ¯”å¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥ç¡®ä¿ä¸åŒèµ„æºä¹‹é—´çš„ä¸€è‡´æ€§ã€‚XAäº‹åŠ¡ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤åè®®</strong>ï¼Œç”±å…¨å±€äº‹åŠ¡ç®¡ç†å™¨æ§åˆ¶ï¼Œå¯ä»¥ç¡®ä¿è¦ä¹ˆæ›´æ”¹å…¨éƒ¨è¢«æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æäº¤ã€‚</p><p>XAäº‹åŠ¡åˆ†ä¸º<strong>å¤–éƒ¨å’Œå†…éƒ¨ä¸¤ç§</strong>ï¼š</p><ul><li>å¤–éƒ¨XAäº‹åŠ¡ï¼š<strong>ç”±å¤–éƒ¨äº‹åŠ¡ç®¡ç†å™¨è´Ÿè´£åè°ƒ</strong>ï¼ŒMySQLä¹Ÿåªæ˜¯ä¸€ä¸ªå‚ä¸è€…ï¼ˆRMï¼‰ï¼ŒMySQLä¸è´Ÿè´£å…¨å±€äº‹åŠ¡çš„åè°ƒ</li><li>å†…éƒ¨XAäº‹åŠ¡ï¼š<strong>MySQLæœ¬èº«å°±æ˜¯åè°ƒå™¨</strong>ï¼Œä¸»è¦å‘ç”Ÿåœ¨ MySQLçš„å†…éƒ¨ï¼ŒInnoDBå­˜å‚¨å¼•æ“å’Œbinlogä¹‹é—´ï¼Œç”¨äºä¸»ä»å¤åˆ¶ã€‚</li></ul><p>XA çš„ç»„æˆï¼š</p><ul><li>APï¼ŒApplication Programï¼Œäº‹åŠ¡å‘èµ·æ–¹ï¼Œåº”ç”¨ç¨‹åº</li><li>TMï¼ŒTransactionManagerï¼Œäº‹åŠ¡ç®¡ç†å™¨ï¼Œä¹Ÿå«åè°ƒå™¨ï¼Œè´Ÿè´£è°ƒåº¦å¤šä¸ªèµ„æºçš„æäº¤å’Œå›æ»šï¼Œä¸æ‰€æœ‰å‚ä¸å…¨å±€äº‹åŠ¡çš„èµ„æºç®¡ç†å™¨è¿›è¡Œé€šä¿¡ã€‚</li><li>RMï¼ŒResourceManagerï¼Œèµ„æºç®¡ç†å™¨ï¼Œä¹Ÿå«å‚ä¸è€…ï¼Œæä¾›è®¿é—®äº‹åŠ¡èµ„æºçš„æ–¹æ³•ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼Œæ¶ˆæ¯é˜Ÿåˆ—</li></ul><h3 id="ä¸¤é˜¶æ®µæäº¤">ä¸¤é˜¶æ®µæäº¤</h3><p>å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/Two-phase_commit_protocol</p><p>Two-phase commit, 2PC</p><p>2PCæ˜¯ä¸€ç§<strong>åˆ†å¸ƒå¼ç®—æ³•</strong>ï¼Œç”¨äºåè°ƒå‚ä¸åˆ°åˆ†å¸ƒå¼åŸå­äº‹åŠ¡çš„è¿›ç¨‹æ˜¯å¦æäº¤æˆ–è€…ç»ˆæ­¢/å›æ»šäº‹åŠ¡ã€‚ä¸ºäº†ä»æ•…éšœä¸­æ¢æ¢å¤ï¼Œå‚ä¸è€…éœ€è¦è®°å½•æ—¥å¿—ã€‚</p><p><strong>å¤–éƒ¨XAï¼š</strong></p><ol type="1"><li>é¢„æäº¤è¯·æ±‚é˜¶æ®µï¼šåº”ç”¨ç¨‹åºå‘èµ·äº‹åŠ¡ï¼Œæ¯ä¸ªèµ„æºç®¡ç†å™¨æ‰§è¡Œäº‹åŠ¡ä½†ä¸çœŸæ­£æäº¤ï¼Œå¹¶è®°å½•è¶³å¤Ÿçš„æ—¥å¿—ä»¥ä¿è¯ä¹‹åå¯ä»¥å®‰å…¨æäº¤æˆ–å›æ»šã€‚æ‰€æœ‰å‚ä¸è€…å‘Šè¯‰äº‹åŠ¡ç®¡ç†å™¨å‡†å¤‡å°±ç»ªæˆ–è€…å¤±è´¥ã€‚</li><li>å¦‚æœæ‰€æœ‰çš„å‚ä¸è€…éƒ½è¿”å›å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨å°±å‘é€commitè¯·æ±‚ï¼Œæœ‰ä»»ä½•ä¸€ä¸ªå¤±è´¥åˆ™å‘é€ç»ˆæ­¢æˆ–å›æ»šè¯·æ±‚ã€‚</li></ol><p><strong>å†…éƒ¨XAï¼š</strong>ç”¨äºä¿è¯<strong>ä¸»ä»å¤åˆ¶çš„ä¸€è‡´æ€§</strong></p><p><img src="https://s21.ax1x.com/2025/08/12/pVwPIaj.png" /></p><ol type="1"><li>ä¸»åº“æŠŠäº‹åŠ¡çš„ä¿®æ”¹å†™å…¥ redo logbufferï¼Œè°ƒç”¨<code>fsync</code>ï¼Œç„¶åæ ‡è®°ä¸º<code>prepare</code>çŠ¶æ€ï¼Œ<strong>å…ˆä¸æäº¤äº‹åŠ¡</strong>ã€‚</li><li>MySQLæœåŠ¡å±‚å°†äº‹åŠ¡çš„SQLè¯­å¥å†™å…¥binlogcacheï¼Œç„¶å<code>fsync</code>æŒä¹…åŒ–åˆ°binlogæ–‡ä»¶ã€‚</li><li>ï¼ˆä»…é™ä¸»ä»å¤åˆ¶åŒæ­¥ï¼‰ä¸»åº“æŠŠbinlogæ–‡ä»¶å‘é€ç»™ä»åº“ï¼Œä»åº“IOçº¿ç¨‹å°†å…¶å†™å…¥<code>relay log</code>ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸ºäº†å¤åˆ¶åŒæ­¥</li><li>æœåŠ¡å±‚è°ƒç”¨commitï¼ŒInnoDB å°†ä¹‹å‰å‡†å¤‡çŠ¶æ€çš„redologæ”¹æˆcommitçŠ¶æ€ï¼Œæ­£å¼æäº¤äº‹åŠ¡ã€‚æ­¤æ—¶redo logå’Œ binlog éƒ½æŒä¹…åŒ–ã€‚</li></ol><blockquote><ul><li>redologç›®çš„æ˜¯æ¢å¤å·²ç»æäº¤ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å®Œå…¨å†™å…¥ç£ç›˜çš„äº‹åŠ¡ï¼Œå¾ªç¯å†™ï¼Œä¼šè¦†ç›–æ—§æ—¥å¿—ï¼Œåªèƒ½æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡å´©æºƒå‰çš„çŠ¶æ€ã€‚åªé™äºInnoDBå†…éƒ¨ä½¿ç”¨ã€‚ç›®çš„æ˜¯ä¿è¯äº‹åŠ¡æŒä¹…æ€§ã€‚</li><li>binlogè®°å½•MySQLçš„æ‰€æœ‰é€»è¾‘æ“ä½œï¼Œæ–‡ä»¶æ— é™è¿½åŠ ï¼Œå¯é•¿æœŸä¿å­˜ï¼Œæ‰€ä»¥å¯ä»¥æ¢å¤åˆ°ä»»æ„æ—¶é—´ç‚¹ã€‚ä¸»ä»å¤åˆ¶æ—¶ï¼Œä»åº“å¯ä»¥è¯»å–binlogç”¨äºå¤åˆ¶ã€‚èƒ½å¤Ÿè·¨å¼•æ“ä½¿ç”¨ã€‚è´Ÿè´£å¤åˆ¶å’Œå†å²æ¢å¤ï¼ˆå°¤å…¶æ˜¯ä»æœºï¼‰ã€‚åªèƒ½ä»å¤´é‡æ”¾ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œæ‰€ä»¥ä¸é€‚åˆç”¨æ¥å´©æºƒæ¢å¤ã€‚</li></ul></blockquote><p>é‡å¯æ¢å¤æ—¶ï¼ŒMySQLå…ˆæ£€æŸ¥binlogï¼Œå¦‚æœæ‰¾ä¸åˆ°äº‹åŠ¡çš„è®°å½•å°±ç›´æ¥å›æ»šåˆ°åŸæ¥çš„çŠ¶æ€ï¼›å¦‚æœèƒ½æ‰¾åˆ°ï¼Œè¯´æ˜ç¬¬äºŒæ­¥å·²ç»æ‰§è¡Œè¿‡äº†,ç»§ç»­çœ‹redo logçš„çŠ¶æ€ï¼šå¦‚æœæ˜¯<code>preapare</code>ï¼Œè¯´æ˜ä¸¤ä¸ªæ—¥å¿—éƒ½å·²ç»å†™å…¥ç£ç›˜ï¼Œå°±å·®æœ€åä¸€æ­¥æäº¤äº†ï¼Œé‚£å°±ç›´æ¥è¡¥ä¸€ä¸ª<code>commit</code>æŒ‡ä»¤å³å¯ã€‚</p><h2 id="é•¿äº‹åŠ¡">é•¿äº‹åŠ¡</h2><p>ä¾‹å¦‚ï¼šæ›´æ–°è¡¨ä¸­çš„ä¸€äº¿æ¡æ•°æ®ã€‚é‡‡ç”¨åˆ†æ‰¹å¤„ç†çš„æ€æƒ³æ¯”è¾ƒå¥½ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sql">void ComputeInterest(<span class="hljs-keyword">double</span> interest_rate) &#123;<br>    long last_account_done, max_account_no, log_size;<br>    <span class="hljs-type">int</span> batch_size <span class="hljs-operator">=</span> <span class="hljs-number">100000</span>;<br><br>    <span class="hljs-comment">-- æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸Šä¸‹æ–‡</span><br>    <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> log_size <span class="hljs-keyword">FROM</span> batchcontext;<br><br>    <span class="hljs-comment">-- é¦–æ¬¡æ‰§è¡Œçš„é€»è¾‘</span><br>    if (SQLCODE <span class="hljs-operator">!=</span> <span class="hljs-number">0</span> <span class="hljs-operator">||</span> log_size <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> batchcontext;<br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> batchcontext (last_account_done <span class="hljs-type">BIGINT</span>);<br><br>        last_account_done <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> batchcontext <span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">-- ä»ä¸Šä¸‹æ–‡è¡¨ä¸­è·å–ä¸Šæ¬¡å¤„ç†çš„ä½ç½®</span><br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> last_account_no<br>                 <span class="hljs-keyword">INTO</span> last_account_done<br>                 <span class="hljs-keyword">FROM</span> batchcontext;<br>    &#125;<br><br>    <br>    <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> max_account_no<br>             <span class="hljs-keyword">FROM</span> account LOCK <span class="hljs-keyword">IN</span> SHARE MODE;<br><br>    WHILE (last_account_no <span class="hljs-operator">&lt;</span> max_account_no) &#123;<br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">START</span> TRANSACTION;<br><br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">UPDATE</span> account<br>                 <span class="hljs-keyword">SET</span> account_total <span class="hljs-operator">=</span> account_total <span class="hljs-operator">*</span> (<span class="hljs-number">1</span> <span class="hljs-operator">+</span> interest_rate)<br>                 <span class="hljs-keyword">WHERE</span> account_no <span class="hljs-keyword">BETWEEN</span> last_account_no<br>                                       <span class="hljs-keyword">AND</span> last_account_no <span class="hljs-operator">+</span> batch_size;<br><br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">UPDATE</span> batchcontext<br>                 <span class="hljs-keyword">SET</span> last_account_done <span class="hljs-operator">=</span> last_account_done <span class="hljs-operator">+</span> batch_size;<br><br>        <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">COMMIT</span> WORK;<br><br>        last_account_done <span class="hljs-operator">=</span> last_account_done <span class="hljs-operator">+</span> batch_size;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼š</strong></p><ol type="1"><li>åˆ†æ‰¹å¤„ç†ç­–ç•¥ï¼šè®¾å®šä¸€ä¸ªå›ºå®šæ‰¹æ¬¡å¤§å°ï¼Œåˆ†æ‰¹å¤„ç†</li><li>æ–­ç‚¹ç»­ä¼ æœºåˆ¶ï¼šä½¿ç”¨<code>batchcontext</code>è¡¨<strong>è®°å½•å¤„ç†è¿›åº¦</strong>ï¼Œæ”¯æŒä¸­æ–­åä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠMySQLæŠ€æœ¯å†…å¹•ã€‹è¯»ä¹¦ç¬”è®°1-é”</title>
    <link href="/2025/08/12/MySQL%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/"/>
    <url>/2025/08/12/MySQL%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/</url>
    
    <content type="html"><![CDATA[<h2 id="é”çš„ç±»å‹">é”çš„ç±»å‹</h2><p>InnoDBå¼•æ“æœ‰ä¸¤ç§è¡Œçº§é”ï¼š</p><ul><li><strong>å…±äº«é”</strong> Sï¼šå…è®¸äº‹åŠ¡è¯»ä¸€è¡Œæ•°æ®</li><li><strong>æ’ä»–é”</strong> X: å…è®¸äº‹åŠ¡åˆ é™¤æˆ–è€…æ›´æ–°ä¸€è¡Œæ•°æ®ã€‚</li></ul><p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰æ„å‘é”ï¼Œæ„å‘é”æ˜¯ä¸ºäº†å‘Šè¯‰è¡¨åœ¨æ›´ç»†çš„ç²’åº¦ä¸ŠåŠ é”</p><ul><li><strong>æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æƒ³è¦è·å¾—æŸå‡ è¡Œçš„å…±äº«é”</strong></li><li><strong>æ„å‘æ’ä»–é”ï¼šäº‹åŠ¡æƒ³è¦è·å¾—æŸä¸€è¡Œçš„æ’ä»–é”</strong></li></ul><h3 id="è¯»æ“ä½œ">è¯»æ“ä½œ</h3><p><strong>ä¸€è‡´æ€§éé”å®šè¯»ï¼š</strong></p><blockquote><p>å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡Œåˆ é™¤æˆ–è€…æ›´æ–°æ“ä½œï¼Œè¿™æ—¶ä¸ä¼šå»ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯è¯»å–é”çš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚</p></blockquote><p><strong>ä¸€è‡´æ€§é”å®šè¯»ï¼š</strong></p><p>æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦æ˜¾å¼åŠ é”ï¼Œè¿™å°±éœ€è¦å¸¦é”çš„æŸ¥è¯¢è¯­å¥ï¼š</p><ul><li>select for update åŠ ä¸€ä¸ªXè¡Œé”</li><li>select in share mode åŠ ä¸€ä¸ªSè¡Œé”</li></ul><h3 id="è‡ªå¢é•¿åŠ é”">è‡ªå¢é•¿åŠ é”</h3><p>InnoDBè€ç‰ˆæœ¬é‡‡ç”¨çš„ç­–ç•¥æ˜¯å•ç‹¬è°ƒç”¨ä¸€ä¸ªè¯­å¥ï¼Œä¸ºæ•´å¼ è¡¨åŠ ä¸Šç‰¹æ®Šçš„è¡¨é”æ¥æ›´æ–°è‡ªå¢è®¡æ•°å™¨çš„å€¼ï¼Œå®Œæˆæ’å…¥åé©¬ä¸Šé‡Šæ”¾ï¼Œä½†æ˜¯è¿™æ ·ä»ç„¶ä¼šå¸¦æ¥è¾ƒå¤§çš„å¼€é”€ã€‚æ–°ç‰ˆæœ¬é‡‡ç”¨æ›´ç»†çš„æ–¹å¼ï¼Œæ ¹æ®ä¸åŒçš„è¯­å¥åŠ ä¸åŒçš„é”ï¼Œäº’æ–¥é‡ã€ä¼ ç»Ÿè¡¨é”éƒ½æœ‰ç”¨åˆ°ã€‚</p><h3 id="å¤–é”®å’Œé”">å¤–é”®å’Œé”</h3><p>InnoDBä¼šè‡ªåŠ¨ä¸ºå¤–é”®åŠ ä¸Šç´¢å¼•ã€‚</p><p>å¦‚æœçˆ¶è¡¨åœ¨æ“ä½œæ—¶å·²ç»ä¸ºå¤–é”®åŠ ä¸Šäº†Xé”ï¼Œé‚£ä¹ˆå­è¡¨ä¸èƒ½å†å¯¹å¤–é”®åŠ ä¸ŠSé”æˆ–è€…Xé”ï¼Œå¿…é¡»ç­‰å¾…çˆ¶è¡¨æ‰§è¡Œå®Œæ¯•ã€‚</p><h3 id="è¡¨çº§é”">è¡¨çº§é”</h3><h4 id="è¡¨é”">è¡¨é”</h4><p>ç²’åº¦æ˜¯æ•´å¼ è¡¨ï¼Œä¸»è¦æ˜¯é˜²æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¡¨æˆ–è€…ç»“æ„è¿›è¡Œå†²çªæ“ä½œã€‚é€‚ç”¨äºå…¨è¡¨å¤‡ä»½ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹åªæœ‰å½“ä½ æ˜¾å¼ä½¿ç”¨<code>LOCK TABLES ... READ/WRITE</code>æ‰ä¼šåŠ è¡¨é”ã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼ˆä¸ä½¿ç”¨ç´¢å¼•å¯¼è‡´çš„å…¨è¡¨æ‰«æï¼Œå´©æºƒæ¢å¤ï¼ŒDDLï¼‰ä¹Ÿä¼šè‡ªåŠ¨åŠ è¡¨é”ã€‚</p><h4 id="å…ƒæ•°æ®é”">å…ƒæ•°æ®é”</h4><p><strong>ä»»ä½•æ¶‰åŠåˆ°è®¿é—®è¡¨çš„è¯­å¥ï¼ˆæ— è®º DML è¿˜æ˜¯ DDLï¼‰éƒ½ä¼šè‡ªåŠ¨åŠ MDL</strong>ã€‚</p><p>ä½œç”¨æ˜¯ä¿æŠ¤è¡¨ç»“æ„çš„ä¸€è‡´æ€§ï¼Œé˜²æ­¢åœ¨è¯»/å†™è¡¨æ•°æ®æ—¶è¡¨ç»“æ„è¢«æ”¹æ‰ã€‚<strong>è‡ªåŠ¨åŠ é”</strong>ï¼Œ<strong>å¢åˆ æ”¹æŸ¥ä¼šç”³è¯·å…ƒæ•°æ®å…±äº«é”ï¼Œä¿®æ”¹è¡¨ä¼šç”³è¯·å…ƒæ•°æ®æ’ä»–é”</strong>ã€‚å…±äº«é”æ„å‘³ç€ï¼Œè¯»å†™æ˜¯å¯ä»¥å¹¶å‘çš„ï¼Œä½†æ˜¯å’Œæ’ä»–é”æ˜¯äº’æ–¥çš„ã€‚æ’ä»–é”æ„å‘³ç€ï¼Œè°ƒç”¨DDL åï¼Œå¿…é¡»ç­‰æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ DML/DQL å®Œæˆä¹‹åæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚</p><blockquote><ul><li><strong>å…¼å®¹</strong>ï¼šä¸¤ç§é”å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä¸ä¼šäº’ç›¸é˜»å¡</li><li><strong>äº’æ–¥</strong>ï¼šä¼šäº’ç›¸é˜»å¡ï¼Œå¿…é¡»ç­‰å¾…å¦ä¸€æ–¹é‡Šæ”¾é”</li></ul></blockquote><p>è§„åˆ™æ€»ç»“ï¼š</p><p>é¦–å…ˆï¼Œä» MySQL 5.5 å¼€å§‹ï¼Œ<strong>æ‰€æœ‰å¯¹è¡¨çš„æ“ä½œï¼ˆæŸ¥è¯¢ / å¢åˆ æ”¹ /DDLï¼‰éƒ½ä¼šè‡ªåŠ¨åŠ å…ƒæ•°æ®é”</strong>ï¼Œè‡ªåŠ¨åŠ çš„é”æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li>æ™®é€šæŸ¥è¯¢ (SELECT) â†’ <code>SHARED_READ</code><ul><li>å’ŒæŸ¥è¯¢ã€DML å…¼å®¹</li><li>å’Œ DDL äº’æ–¥</li></ul></li><li>å¢åˆ æ”¹ï¼šDML (INSERT / UPDATE / DELETE) â†’ <code>SHARED_WRITE</code><ul><li>å’ŒæŸ¥è¯¢ã€DML å…¼å®¹</li><li>å’Œ DDL äº’æ–¥</li></ul></li><li>ä¿®æ”¹è¡¨ç»“æ„ï¼šDDL (ALTER / DROP / RENAME TABLE) â†’<code>EXCLUSIVE</code><ul><li>å’Œä»»ä½•é”äº’æ–¥</li><li>å¿…é¡»ç­‰æ‰€æœ‰è¯»/å†™é”é‡Šæ”¾æ‰èƒ½æ‰§è¡Œ</li></ul></li></ul><p>å…¶æ¬¡ï¼Œå¦‚æœä¸»åŠ¨è°ƒç”¨<code>LOCK TABLES xxx READ / WRITE;</code>ï¼ŒMySQLä¼šç»™è¡¨åŠ æ›´å¼ºçš„<strong>æ‰‹åŠ¨é”</strong>ï¼Œå¯¹åº”çš„ MDLæ¨¡å¼å°±æ˜¯ä¸‹é¢çš„<code>SHARED_READ_ONLY</code>å’Œ<code>SHARED_NO_READ_WRITE</code>ã€‚è¿™ä¸¤ç§é”çš„ç‰¹ç‚¹ï¼š</p><ul><li><code>LOCK TABLES t READ</code>ï¼šå…¶ä»–ä¼šè¯åªèƒ½è¯»ï¼ˆå¯ä»¥åŠ <code>SHARED_READ</code>ï¼‰ï¼Œä¸èƒ½å†™ï¼Œä½†æ˜¯è‡ªå·±å¯ä»¥è¯»</li><li><code>LOCK TABLES t WRITE;</code>ï¼šå…¶ä»–å¯¹è¯æ—¢ä¸èƒ½è¯»ï¼Œä¹Ÿä¸èƒ½å†™ï¼Œä½†æ˜¯è‡ªå·±å¯ä»¥çš„è¯»å†™ã€‚å±äº<strong>ç‹¬å å¼ºé”</strong>ã€‚</li></ul><table><thead><tr><th>æ¨¡å¼</th><th>å¸¸è§è§¦å‘ SQL</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>SHARED_READ</strong></td><td>æ™®é€š <code>SELECT</code></td><td>å…è®¸å¹¶å‘è¯»å†™ï¼Œé˜»æ­¢ DDL</td></tr><tr><td><strong>SHARED_WRITE</strong></td><td><code>INSERT/UPDATE/DELETE</code></td><td>å…è®¸å¹¶å‘å†™ï¼Œé˜»æ­¢ DDL</td></tr><tr><td><strong>EXCLUSIVE</strong></td><td><code>ALTER TABLE</code></td><td>ç‹¬å è¡¨å…ƒæ•°æ®ï¼Œé˜»æ­¢æ‰€æœ‰è¯»å†™</td></tr><tr><td><strong>SHARED_READ_ONLY</strong></td><td><code>LOCK TABLES t READ</code></td><td>é™åˆ¶å…¶ä»–ä¼šè¯ä¸èƒ½å†™</td></tr><tr><td><strong>SHARED_NO_READ_WRITE</strong></td><td><code>LOCK TABLES t WRITE</code></td><td>é™åˆ¶å…¶ä»–ä¼šè¯ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™</td></tr></tbody></table><h4 id="æ„å‘é”">æ„å‘é”</h4><p>MySQL çš„<strong>æ„å‘é”</strong>ï¼ˆIntention Lockï¼‰æ˜¯ <strong>InnoDBå¼•æ“ç‰¹æœ‰</strong>çš„ä¸€ç§è¡¨çº§é”ï¼Œå®ƒæœ¬èº«ä¸ä¼šé˜»å¡æ™®é€šçš„è¯»å†™ï¼Œè€Œæ˜¯ç”¨æ¥è¡¨ç¤ºäº‹åŠ¡å³å°†åœ¨å“ªäº›è¡Œä¸ŠåŠ è¡Œé”ï¼Œä»è€Œ<strong>è®©è¡¨é”å’Œè¡Œé”èƒ½å¤Ÿå…±å­˜ã€åè°ƒ</strong>ã€‚</p><p>å¦‚æœä¸€å¼ è¡¨å·²ç»è¢«åŠ ä¸Šäº†è¡Œé”ï¼Œé‚£ä¹ˆåŠ è¡¨é”ä¹‹å‰å°±è¦<strong>æ‰«æå…¨è¡¨</strong>ï¼Œæ£€æŸ¥å“ªäº›è¡Œå·²ç»è¢«é”ä½äº†ï¼Œéå¸¸ä½æ•ˆã€‚æœ‰äº†æ„å‘é”ï¼Œäº‹åŠ¡åœ¨åŠ è¡Œé”ä¹‹å‰ï¼Œè¦å…ˆç»™è¡¨åŠ ä¸Šä¸€ä¸ªæ„å‘é”ï¼Œè¡¨æ˜è‡ªå·±ä¼šç»™å“ªäº›è¡ŒåŠ é”ï¼›è¿™æ ·ä»¥ååŠ è¡¨é”ä¹‹å‰åªè¦æ£€æŸ¥ä¸€ä¸‹æ„å‘é”å°±èƒ½å¿«é€Ÿå®šä½å·²ç»åŠ ä¸Šçš„è¡Œé”ï¼Œå¿«é€Ÿåˆ¤æ–­ä¼šä¸ä¼šå‘ç”Ÿå†²çªã€‚</p><blockquote><p>æ„å‘é”çš„å­˜åœ¨æ„ä¹‰å°±æ˜¯åŠ é€Ÿè¡¨é”ä¸è¡Œé”ä¹‹é—´çš„å†²çªæ£€æµ‹ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚</p></blockquote><p><strong>InnoDB æœ‰ä¸¤ç§æ„å‘é”ï¼ˆéƒ½æ˜¯è¡¨çº§é”ï¼‰</strong>ï¼š</p><ul><li>æ„å‘å…±äº«é”ï¼ˆIS, Intention SharedLockï¼‰è¡¨ç¤ºäº‹åŠ¡æ‰“ç®—åœ¨æŸäº›è¡Œä¸ŠåŠ å…±äº«é”ï¼ˆS é”ï¼Œè¯»é”ï¼‰ã€‚</li><li>æ„å‘æ’ä»–é”ï¼ˆIX, Intention ExclusiveLockï¼‰è¡¨ç¤ºäº‹åŠ¡æ‰“ç®—åœ¨æŸäº›è¡Œä¸ŠåŠ æ’ä»–é”ï¼ˆX é”ï¼Œå†™é”ï¼‰ã€‚</li></ul><p>è¡Œçº§æ“ä½œä¼šåŠ è¡Œçº§é”ï¼ŒåŒæ—¶ä¸ºæ•´å¼ è¡¨åŠ ä¸Šå¯¹åº”çš„è¡¨çº§æ„å‘é”ã€‚ä»¥åè¦åŠ åˆ«çš„è¡¨çº§é”ä¹‹å‰ï¼Œç›´æ¥æ£€æŸ¥æ„å‘é”å°±å¯ä»¥åˆ¤æ–­æ˜¯å¦å†²çªäº†ã€‚</p><h2 id="é”çš„ç®—æ³•">é”çš„ç®—æ³•</h2><h3 id="è¡Œé”çš„ä¸‰ç§ç®—æ³•">è¡Œé”çš„ä¸‰ç§ç®—æ³•</h3><p>è¡Œé”å¿…é¡»ä¾èµ–ç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§ã€‚æ— ç´¢å¼•æŸ¥è¯¢å¿…é¡»æ‰«æå…¨è¡¨ã€‚</p><ul><li>Record Lockï¼šå•ä¸ªè¡Œè®°å½•çš„é”ï¼ˆé”ä½ç´¢å¼•è®°å½•ï¼‰</li><li>GapLockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯ä¸åŒ…å«è®°å½•æœ¬èº«ã€‚é˜²æ­¢å¹»è¯»ï¼ˆé˜²æ­¢æ–°æ•°æ®æ’å…¥å½±å“å½“å‰äº‹åŠ¡çš„èŒƒå›´æŸ¥è¯¢ç»“æœï¼‰ï¼Œåªæœ‰åœ¨RR éš”ç¦»çº§åˆ«ä¸”é”å®šè¯»è¯­å¥æˆ–è€…èŒƒå›´æ›´æ–°ã€åˆ é™¤æ‰ä¼šå‡ºç°ã€‚</li><li>Next-KeyLockï¼šä¸Šé¢ä¸¤ç§é”çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚å¦‚æœæ˜¯pointç±»å‹ï¼ˆåªæ¶‰åŠåˆ°ä¸€ä¸ªè®°å½•ï¼‰ï¼Œé‚£ä¹ˆè¯¥è®°å½•å‰åçš„é—´éš™éƒ½ä¼šè¢«é”ä½ã€‚<strong>æ‰«æç´¢å¼•çš„æ—¶å€™ä¸ä»…ä¼šé”ä½ç´¢å¼•æœ¬èº«ï¼Œè¿˜ä¼šé”ä½è¿™äº›ç´¢å¼•è¦†ç›–çš„èŒƒå›´</strong>ï¼Œä¸»è¦ä½œç”¨æ˜¯é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¢«è¦†ç›–çš„åŒºé—´å†…è¿›è¡Œæ’å…¥æ“ä½œã€‚</li></ul><p>å¦‚æœ<code>Next_key</code>æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰<strong>å”¯ä¸€</strong>å±æ€§ï¼ˆæ¯”å¦‚æ˜¯ä¸»é”®ï¼‰ï¼Œé‚£ä¹ˆä¼šè¢«<strong>é™çº§</strong>ä¸º<code>Record Lock</code>ï¼Œæé«˜åº”ç”¨çš„å¹¶å‘æ€§ã€‚èšé›†ç´¢å¼•å¯ä»¥é™çº§ä¸º<code>Record Lock</code>ï¼Œè¾…åŠ©ç´¢å¼•ç”¨ä½œ<code>Next-Key Lock</code>ï¼Œé”ä½æ›´å¤§çš„åŒºé—´ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œçœ‹ä¸‹é¢è¿™å¼ è¡¨ï¼š</p><table><thead><tr><th>a</th><th>number</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>4</td></tr><tr><td>4</td><td>4</td></tr><tr><td>6</td><td>6</td></tr></tbody></table><p>å…¶ä¸­aæ˜¯ä¸»é”®ï¼ŒnumberåŠ äº†è¾…åŠ©ç´¢å¼•ã€‚å¦‚æœæ‰§è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> number <span class="hljs-operator">=</span> <span class="hljs-number">4</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">update</span>;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆnumberçš„<code>(1, 6)</code>çš„èŒƒå›´éƒ½ä¼šè¢« Next-keyé”ä½ï¼Œå¦‚æœæ’å…¥çš„æ•°æ®è½åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œæ— æ³•è¿›è¡Œæ’å…¥æ“ä½œã€‚ä¸€ä¸ªä¾‹å¤–æ˜¯å¦‚æœæŸ¥è¯¢çš„æ˜¯è¿™ä¸ªåŒºé—´å†…çš„ä¸å­˜åœ¨çš„numberï¼ˆæ¯”å¦‚<code>5</code>ï¼‰ï¼Œä¼šé©¬ä¸Šè¿”å›Emptysetï¼Œä¸ä¼šé˜»å¡ï¼Œè¿™æ˜¯å› ä¸ºæ ¹æ®ç´¢å¼•å¾ˆå®¹æ˜“å°±èƒ½å‘ç°ä¸å­˜åœ¨çš„è®°å½•ã€‚ï¼Œ</p><blockquote><p><strong>å¹»è¯»</strong>æŒ‡çš„æ˜¯åœ¨åŒä¸€äº‹åŠ¡ä¸‹ï¼Œè¿ç»­æ‰§è¡Œä¸¤æ¬¡åŒæ ·çš„ SQLè¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœï¼Œç¬¬äºŒæ¬¡çš„SQLè¯­å¥å¯èƒ½ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚</p></blockquote><p>InnoDBå­˜å‚¨å¼•æ“é€šè¿‡Next_keyç®—æ³•è§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚</p><p>å¯¹äºèŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚è¦æŸ¥è¯¢ä¸»é”®<code>a &gt; 2</code>çš„æ‰€æœ‰è®°å½•ï¼Œé‚£ä¹ˆä¼šé”ä½ä¸»é”®<code>[2, +â™¾ï¸)</code>çš„æ•´ä¸ªèŒƒå›´åŠ ä¸ŠXé”ã€‚</p><h2 id="é”çš„é—®é¢˜">é”çš„é—®é¢˜</h2><h3 id="è„è¯»">è„è¯»</h3><p>è„è¯»æŒ‡çš„æ˜¯åœ¨ä¸åŒçš„äº‹åŠ¡ä¸‹ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥è¯»åˆ°å¦å¤–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è„æ•°æ®ã€‚è¿™è¿åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚åœ¨<code>READ UNCOMMITED</code>éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰å¯èƒ½å‘ç”Ÿã€‚</p><h3 id="ä¸å¯é‡å¤è¯»">ä¸å¯é‡å¤è¯»</h3><p>å«ä¹‰ï¼šåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ã€‚(äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRC)</p><blockquote><p><strong>è„è¯»</strong>æ˜¯è¯»åˆ°æœªæäº¤çš„æ•°æ®ï¼Œä¸å¯é‡å¤è¯»è¯»åˆ°çš„æ˜¯å·²ç»æäº¤çš„æ•°æ®ï¼Œä½†æ˜¯è¿åäº†äº‹åŠ¡ä¸€è‡´æ€§çš„è¦æ±‚ã€‚</p></blockquote><p>ä¸å¯é‡å¤è¯»çš„åæœæ²¡æœ‰é‚£ä¹ˆä¸¥é‡ï¼Œåœ¨RCéš”ç¦»çº§åˆ«ä¸‹æ˜¯å…è®¸çš„ã€‚InnoDBå¼•æ“è§£å†³çš„æ–¹æ³•æ˜¯<code>Next-Key Lock</code>ç®—æ³•ï¼Œ<strong>æ‰«æç´¢å¼•çš„æ—¶å€™ä¸ä»…ä¼šé”ä½ç´¢å¼•æœ¬èº«ï¼Œè¿˜ä¼šé”ä½è¿™äº›ç´¢å¼•è¦†ç›–çš„èŒƒå›´</strong>ã€‚é¿å…äº†åœ¨å…³å¿ƒçš„èŒƒå›´å†…å…¶ä»–äº‹åŠ¡ä¿®æ”¹æ•°æ®é€ æˆçš„ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚</p><h3 id="ä¸¢å¤±æ›´æ–°">ä¸¢å¤±æ›´æ–°</h3><blockquote><p>ä¸¢å¤±æ›´æ–°æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°ä¼šè¢«å¦ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°æ‰€è¦†ç›–,ä»è€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´.</p></blockquote><p>åœ¨ä»»ä½•éš”ç¦»çº§åˆ«ä¸‹éƒ½ä¸ä¼šäº§ç”Ÿä¸¢å¤±æ›´æ–°é—®é¢˜.è™½ç„¶æ•°æ®åº“æœ¬èº«ä¸ä¼šå‡ºç°ä¸¢å¤±æ›´æ–°, ä½†æ˜¯å­˜åœ¨ä¸€ç§é€»è¾‘ä¸Šä¸¢å¤±æ›´æ–°çš„æƒ…å†µ:</p><ol type="1"><li>äº‹åŠ¡T1æŸ¥è¯¢ä¸€è¡Œæ•°æ®,æ˜¾ç¤ºç»™ç”¨æˆ·u1;</li><li>äº‹åŠ¡T2ä¹ŸæŸ¥è¯¢è¿™è¡Œæ•°æ®, å¹¶å°†å–å¾—çš„æ•°æ®æ˜¾ç¤ºç»™ç”¨æˆ·u2;</li><li>u1ä¿®æ”¹è¿™è¡Œè®°å½•, æ›´æ”¹æ•°æ®åº“å¹¶æäº¤;</li><li>u2ä¹Ÿä¿®æ”¹è¿™è¡Œè®°å½•, æ›´æ”¹æ•°æ®åº“å¹¶æäº¤.</li></ol><p>ç»“æœ: <strong>u1çš„ä¿®æ”¹æ“ä½œè¢«u2è¦†ç›–.</strong></p><p>è§£å†³æ–¹æ³•: æ¢ä½œ<code>select .. for update</code>æŸ¥è¯¢, åŠ ä¸Šä¸€ä¸ª<strong>X é”</strong>, è€Œä¸æ˜¯æ— é”æŸ¥è¯¢.è¿™æ ·, äº‹åŠ¡ T2 å¿…é¡»ç­‰å¾…äº‹åŠ¡ T1çš„æŸ¥è¯¢å’Œä¿®æ”¹åŠ¨ä½œéƒ½ç»“æŸä¹‹åæ‰èƒ½å¼€å§‹æŸ¥è¯¢å’Œä¿®æ”¹.</p><h2 id="é˜»å¡">é˜»å¡</h2><ul><li><code>innodb_lock_wait_timeout</code>: æ§åˆ¶è¶…æ—¶æ—¶é—´.é»˜è®¤50s,å¯ä»¥åŠ¨æ€è®¾ç½®</li><li><code>innodb_rollback_on_timeout</code>:ç”¨æ¥è®¾å®šæ˜¯å¦åœ¨è¶…æ—¶æ—¶è¿›è¡Œå›æ»š, é»˜è®¤OFF, é™æ€.</li></ul><p><strong>ä¸€èˆ¬æƒ…å†µä¸‹,äº‹åŠ¡åœ¨æŠ›å‡ºå¼‚å¸¸åæ—¢ä¸ä¼šè‡ªåŠ¨æäº¤,ä¹Ÿä¸ä¼šå›æ»š</strong>ï¼ˆæ­»é”é™¤å¤–ï¼Œè‡ªåŠ¨å›æ»šï¼‰,å¿…é¡»ç”±ç”¨æˆ·<strong>æ‰‹åŠ¨å†³å®š</strong>. å¼‚å¸¸ä¹‹å‰åšè¿‡çš„æ“ä½œä¼šè¢«ä¿ç•™.</p><h2 id="æ­»é”">æ­»é”</h2><blockquote><p><strong>æ­»é”</strong>æ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­,å› ä¸ºäº‰å¤ºé”èµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡.</p></blockquote><p>è§£å†³æ–¹å¼:</p><ul><li>è®¾ç½®è¶…æ—¶, è®©äº’ç›¸ç­‰å¾…çš„äº‹åŠ¡çš„å…¶ä¸­ä¸€æ–¹å›æ»š. ç¼ºç‚¹:å›æ»šäº‹åŠ¡ä¹Ÿè¦èŠ±è´¹æ—¶é—´, å¯èƒ½å›æ»šèŠ±è´¹çš„æ—¶é—´æ¯”æ‰§è¡Œå¦ä¸€ä¸ªäº‹åŠ¡çš„æ—¶é—´è¿˜é•¿.</li><li><code>wait-for graph</code>,è¯‘ä¸º"ç­‰å¾…å›¾",<strong>ä¸»åŠ¨æ£€æµ‹æ­»é”</strong>.</li></ul><p>ç­‰å¾…å›¾è¦æ±‚æ•°æ®åº“ä¿å­˜å¦‚ä¸‹ä¿¡æ¯:</p><ul><li>é”çš„ä¿¡æ¯é“¾è¡¨(å“ªä¸€è¡Œæœ‰å“ªäº›é”åœ¨ç­‰å¾…)</li><li>äº‹åŠ¡ç­‰å¾…é“¾è¡¨</li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://s21.ax1x.com/2025/08/10/pVdmK1A.png" /></p><p>è§„å®š:<code>t1 -&gt; t2</code>è¡¨ç¤ºäº‹åŠ¡ t1 åœ¨ç­‰å¾… t2æŒæœ‰çš„æŸäº›é”,æ¯”å¦‚ä¸Šå›¾ä¸­ t1 åœ¨ç­‰å¾… t2 å¯¹ row1 åŠ çš„Xé”.æ ¹æ®è¿™ä¸€è§„åˆ™ç”»å‡ºæ¥çš„å›¾å¦‚ä¸‹:</p><p><img src="https://s21.ax1x.com/2025/08/10/pVdmwXq.png" /></p><p>å®¹æ˜“å‘ç° t1 å’Œ t2 å­˜åœ¨æ­»é”.</p><blockquote><p>æ¯å½“æœ‰äº‹åŠ¡è¯·æ±‚é”å¹¶å‘ç”Ÿç­‰å¾…æ—¶, éƒ½ä¼šåˆ¤æ–­æ˜¯å¦æœ‰æ­»é”, å¦‚æœæœ‰å°±å›æ»š undoé‡æœ€å°çš„äº‹åŠ¡.</p></blockquote><p>æ­»é”çš„å¦ä¸€ä¸ªä¾‹å­:</p><ol type="1"><li>ä¼šè¯ A: <code>SELECT * FROM t WHERE a = 4 FOR UPDATE;</code>è·å– a=4è¿™ä¸€è¡Œè®°å½•çš„Xé”, <strong>è€Œä¸”è¿™ä¸ªé”ä¼šä¸€ç›´æŒç»­åˆ°äº‹åŠ¡ç»“æŸ</strong>.</li><li>ä¼šè¯ B:<code>SELECT * FROM t WHERE a &lt;= 4 LOCK IN SHARE MODE;</code>æƒ³è¦è·å–a&lt;=4 çš„Sé”,ä½†æ˜¯è·å–å¤±è´¥, é˜»å¡.</li><li>ä¼šè¯ A: <code>INSERT INTO t VALUES(3);</code>ä¼å›¾è·å– X é”,ä½†æ˜¯ä¼šè¯Bæ­£åœ¨ç­‰å¾…,æ‰€ä»¥ä¹Ÿé˜»å¡ç­‰å¾….</li></ol><p>åˆ†æï¼š</p><ul><li>ä¼šè¯ Aï¼šæŒæœ‰a=4çš„æ’ä»–é”ï¼Œç­‰å¾…æ’å…¥a=3ï¼ˆè¢«ä¼šè¯Bé˜»å¡ï¼‰</li><li>ä¼šè¯ Bï¼šç­‰å¾…a=4çš„å…±äº«é”ï¼ˆè¢«ä¼šè¯Aé˜»å¡ï¼‰ï¼ŒåŒæ—¶é˜»å¡äº†a=3ä½ç½®çš„æ“ä½œ</li></ul><p>ä¸¤ä¸ªä¼šè¯ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œå½¢æˆäº†å¾ªç¯ç­‰å¾…ï¼Œæ•°æ®åº“æ£€æµ‹åˆ°æ­»é”åé€‰æ‹©å›æ»šå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ï¼ˆä¼šè¯Aï¼‰ï¼Œå¹¶è¿”å›é”™è¯¯<code>1213</code>ã€‚</p><h2 id="é”å‡çº§">é”å‡çº§</h2><h3 id="innodbç®¡ç†é”çš„æ–¹å¼">InnoDBç®¡ç†é”çš„æ–¹å¼</h3><p>å…ˆè¯´è¯´InnoDBå­˜å‚¨å¼•æ“æ˜¯å¦‚ä½•ç®¡ç†é”ä¿¡æ¯çš„ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">é”ä¿¡æ¯å­˜å‚¨ç»“æ„ï¼šä»¥é¡µä¸ºå•ä½å­˜å‚¨é”çš„çŠ¶æ€<br><span class="hljs-bullet">- </span>æ¯ä¸ªæ•°æ®é¡µç»´æŠ¤ä¸€ä¸ªé”ä½å›¾<br><span class="hljs-bullet">- </span>ä½å›¾ä¸­æ¯ä¸€ä½å¯¹åº”é¡µä¸­çš„ä¸€æ¡è®°å½•<br><span class="hljs-bullet">- </span>1è¡¨ç¤ºè¯¥è®°å½•è¢«é”å®šï¼Œ0è¡¨ç¤ºæœªé”å®š<br></code></pre></td></tr></table></figure><p><strong>è¡Œçº§é”çš„ç®¡ç†æœºåˆ¶ï¼š</strong></p><ol type="1"><li><strong>ä»¥è¡Œä¸ºå•ä½åŠ é”</strong>ï¼Œé”å®šå…·ä½“çš„ä¸€è¡Œè®°å½•</li><li><strong>ä»¥é¡µä¸ºå•ä½ç®¡ç†é”ä¿¡æ¯</strong>ï¼Œæ¯ä¸€é¡µéƒ½è¦ç»´æŠ¤ä¸€ä¸ªè¯¥é¡µçš„é”çŠ¶æ€ä½å›¾</li><li><strong>ä½å›¾</strong>æ–¹å¼å­˜å‚¨ï¼šç”¨ä½å›¾é«˜æ•ˆè®°å½•å“ªäº›è¡Œæ˜¯è¢«åŠ é”äº†</li></ol><p>è¡¨é”é‡‡ç”¨äº†å¦ä¸€ç§ç‹¬ç«‹çš„é”æœºåˆ¶ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">è¡¨é”ä¿¡æ¯å­˜å‚¨åœ¨ï¼š<br><span class="hljs-bullet">- </span>æ•°æ®å­—å…¸ï¼ˆData Dictionaryï¼‰ä¸­<br><span class="hljs-bullet">- </span>è¡¨çš„å…ƒæ•°æ®ç»“æ„ä¸­<br><span class="hljs-bullet">- </span>ä¸ä¾èµ–é¡µå†…çš„ä½å›¾<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œæ„å‘é”ç”¨äºåè°ƒè¡¨é”å’Œè¡Œé”çš„å…³ç³»ï¼Œæ¯æ¬¡åŠ è¡Œé”ä¹‹å‰éƒ½ä¼šå…ˆåŠ ä¸Šæ„å‘é”ã€‚</p><h3 id="é”å‡çº§çš„æ¦‚å¿µ">é”å‡çº§çš„æ¦‚å¿µ</h3><p>é”å‡çº§æŒ‡çš„æ˜¯å°†é”ä»ç»†ç²’åº¦çš„é”å‡çº§æˆç²—ç»†ç²’åº¦çš„é”ï¼Œæ¯”å¦‚å°†è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚é”å‡çº§ä¸€èˆ¬ç”¨äºâ€œé”æ˜¯ä¸€ç§ç¨€ç¼ºèµ„æºâ€çš„æ•°æ®åº“ç§ï¼Œæ¯”å¦‚å¾®è½¯çš„SQLæœåŠ¡å™¨å°±è®¤ä¸ºé”æ˜¯ä¸€ç§ç¨€ç¼ºçš„å¯¹è±¡ï¼Œä¼šè‡ªåŠ¨å‡çº§ï¼Œå‡å°ç»´æŠ¤é”éœ€è¦çš„é¢å¤–å¼€é”€ã€‚é”å‡çº§æœ‰åˆ©æœ‰å¼Šï¼š</p><ul><li>å¥½å¤„ï¼šå‡å°äº†é”èµ„æºå ç”¨çš„å†…å­˜</li><li>åå¤„ï¼šé”ç²’åº¦åŠ å¤§ï¼Œå‡å°äº†å¹¶å‘æ€§èƒ½</li></ul><p>å¾®è½¯SQLä¸ºæ¯è¡Œè®°å½•éƒ½äº§ç”Ÿä¸€ä¸ªé”å¯¹è±¡ï¼Œèµ„æºå ç”¨å¾ˆå¤§ã€‚</p><p>InnoDBçš„è¡Œé”æ˜¯ä»¥æ•°æ®é¡µä¸ºå•ä½ã€ç”¨ä½å›¾ç®¡ç†é”çš„çŠ¶æ€çš„ï¼Œèµ„æºå¼€é”€ä¼šå°å¾—å¤šï¼Œæ‰€ä»¥ä¸å­˜åœ¨é”å‡çº§çš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IOå¤šè·¯å¤ç”¨-select, poll, epollçš„åŒºåˆ«</title>
    <link href="/2025/08/10/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%89%E4%B8%AA%E5%87%BD%E6%95%B0/"/>
    <url>/2025/08/10/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%89%E4%B8%AA%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›®å½•">ç›®å½•</h2><ol type="1"><li><a href="#select">select</a><ol type="1"><li><a href="#å‡½æ•°åŸå‹">å‡½æ•°åŸå‹</a></li><li><a href="#ä½œç”¨">ä½œç”¨</a></li><li><a href="#åº”ç”¨ç¤ºä¾‹">åº”ç”¨ç¤ºä¾‹</a></li></ol></li><li><a href="#poll">poll</a><ol type="1"><li><a href="#å‡½æ•°åŸå‹-1">å‡½æ•°åŸå‹</a></li><li><a href="#ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </a></li><li><a href="#ä¸selectçš„åŒºåˆ«">ä¸selectçš„åŒºåˆ«</a></li></ol></li><li><a href="#epoll">epoll</a><ol type="1"><li><a href="#ä¸‰ä¸ªæ ¸å¿ƒç³»ç»Ÿè°ƒç”¨">ä¸‰ä¸ªæ ¸å¿ƒç³»ç»Ÿè°ƒç”¨</a></li><li><a href="#ç¤ºä¾‹ä»£ç -1">ç¤ºä¾‹ä»£ç </a></li><li><ahref="#ä¸¤ç§è§¦å‘æ¨¡å¼-äº‹ä»¶é€šçŸ¥æœºåˆ¶">ä¸¤ç§è§¦å‘æ¨¡å¼-äº‹ä»¶é€šçŸ¥æœºåˆ¶</a></li><li><a href="#ä¸‰ä¸ªå‡½æ•°çš„åŒºåˆ«">ä¸‰ä¸ªå‡½æ•°çš„åŒºåˆ«</a></li></ol></li></ol><h2 id="select">select</h2><h3 id="å‡½æ•°åŸå‹">å‡½æ•°åŸå‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">select</span><span class="hljs-params">(<span class="hljs-type">int</span> nfds, </span><br><span class="hljs-params">           fd_set *<span class="hljs-keyword">restrict</span> readfds,  </span><br><span class="hljs-params">           fd_set *<span class="hljs-keyword">restrict</span> writefds,  </span><br><span class="hljs-params">           fd_set *<span class="hljs-keyword">restrict</span> errorfds, </span><br><span class="hljs-params">           <span class="hljs-keyword">struct</span> timeval *<span class="hljs-keyword">restrict</span> timeout)</span>;<br></code></pre></td></tr></table></figure><ul><li>åœ¨æ¯ä¸ªé›†åˆä¸­éƒ½ä¼šæ£€æŸ¥å‰<code>nfds</code>ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚<code>select()</code>å†…éƒ¨ä¼šéå†<code>0 ~ nfds-1</code>ä¹‹é—´çš„<strong>æ‰€æœ‰</strong>fdï¼ˆè‡³äºéœ€è¦é‡ç‚¹å…³æ³¨å“ªä¸ªï¼Œå–å†³äºåé¢ä¼ å…¥çš„fdsï¼‰ï¼Œæ‰€ä»¥ nfdså¿…é¡»æ˜¯<code>æ‰€æœ‰ç›‘å¬çš„ fd ä¸­æœ€å¤§å€¼ + 1</code>ã€‚</li><li><code>readfds</code>ï¼šæŒ‡å®šéœ€è¦ç›‘æ§çš„å¯è¯»äº‹ä»¶çš„fdã€‚å¸¸ç”¨æ–¹æ³•æœ‰ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">FD_ZERO(&amp;readfds);      <span class="hljs-comment">// æ¸…ç©ºé›†åˆ</span><br>FD_SET(fd, &amp;readfds);   <span class="hljs-comment">// æŠŠ fd åŠ å…¥é›†åˆ</span><br></code></pre></td></tr></table></figure><ul><li><code>writefds</code>ï¼šæŒ‡å®šéœ€è¦ç›‘æ§å¯å†™äº‹ä»¶çš„fd</li><li><code>errorfds</code>ï¼šæŒ‡å®šéœ€è¦ç›‘æ§çš„å¼‚å¸¸äº‹ä»¶çš„fd</li><li><code>timeout</code>ç»“æ„ä½“ï¼š<code>NULL</code>è¡¨ç¤ºæ— é™ç­‰å¾…ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> &#123;</span><br>    <span class="hljs-type">long</span> tv_sec;   <span class="hljs-comment">// ç§’</span><br>    <span class="hljs-type">long</span> tv_usec;  <span class="hljs-comment">// å¾®ç§’ï¼ˆç™¾ä¸‡åˆ†ä¹‹ä¸€ç§’ï¼‰</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>ç”¨äºåœ¨<strong>ä¸€ä¸ªçº¿ç¨‹</strong>ä¸­<strong>ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦</strong></li><li>è¿”å›å€¼ï¼šå¤§äºé›¶è¡¨ç¤ºå·²ç»å‡†å¤‡å¥½çš„ IOæ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼›ç­‰äºé›¶è¡¨ç¤ºè¶…æ—¶ï¼›-1è¡¨ç¤ºå‡ºé”™</li></ul><h3 id="ä½œç”¨">ä½œç”¨</h3><p><code>select</code><strong>ç”¨äºåŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¾“å…¥æºï¼›å½“ä»»ä½•ä¸€ä¸ªIOå‡†å¤‡å°±ç»ªçš„æ—¶å€™ï¼Œselectå°±ä¼šè¿”å›ï¼Œå¦åˆ™ä¸€ç›´é˜»å¡ï¼Œä¸ä¼šæµªè´¹CPUã€‚</strong></p><ul><li>ä¼˜ç‚¹ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ï¼›èµ„æºæ¶ˆè€—é‡ä½ï¼Œå› ä¸ºé¿å…äº†ä¸ºæ¯ä¸ªIOåˆ›å»ºå•çº¿ç¨‹çš„å¼€é”€ã€‚</li><li>ç¼ºç‚¹ï¼šå¯ä¼ å…¥æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡æœ‰é™åˆ¶ï¼›æ¯æ¬¡éœ€è¦éå†æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦ï¼›ä¸å…è®¸é˜»å¡è°ƒç”¨ï¼Œå¦åˆ™è¿™ä¸ªç³»ç»Ÿéƒ½ä¼šè¢«é˜»å¡ã€‚è€Œä¸”ã€‚æ¯æ¬¡è°ƒç”¨select éƒ½è¦é‡æ–°æŠŠ fd é›†åˆæ‹·è´åˆ°å†…æ ¸ä¸­ã€‚</li></ul><h3 id="åº”ç”¨ç¤ºä¾‹">åº”ç”¨ç¤ºä¾‹</h3><p>åº”ç”¨ç¤ºä¾‹ï¼šç›‘æ§ç»ˆç«¯çš„è¾“å…¥ï¼ˆä¸ºç®€å•èµ·è§åªæœ‰ä¸€ä¸ªIOæ“ä½œï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/select.h&gt;</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æœ€ç®€å•çš„selectä¾‹å­ï¼šåªç›‘æ§æ ‡å‡†è¾“å…¥</span><br><span class="hljs-comment"> * æ¼”ç¤ºselectå¦‚ä½•ç­‰å¾…è¾“å…¥äº‹ä»¶</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€äº›æ–‡å­—ï¼ˆè¾“å…¥quité€€å‡ºï¼‰ï¼š\n&quot;</span>);<br>    <br>    fd_set read_fds;<br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">100</span>];<br>    <br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// 1. æ¸…ç©ºå¹¶è®¾ç½®æ–‡ä»¶æè¿°ç¬¦é›†åˆ</span><br>        FD_ZERO(&amp;read_fds);<br>        FD_SET(STDIN_FILENO, &amp;read_fds);  <span class="hljs-comment">// åªç›‘æ§æ ‡å‡†è¾“å…¥</span><br>        <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç­‰å¾…è¾“å…¥...\n&quot;</span>);<br>        <br>        <span class="hljs-comment">// 2. selectç­‰å¾…è¾“å…¥äº‹ä»¶</span><br>        <span class="hljs-type">int</span> result = select(STDIN_FILENO + <span class="hljs-number">1</span>, &amp;read_fds, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br>        <br>        <span class="hljs-keyword">if</span> (result &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 3. æ£€æŸ¥æ ‡å‡†è¾“å…¥æ˜¯å¦æœ‰æ•°æ®</span><br>            <span class="hljs-keyword">if</span> (FD_ISSET(STDIN_FILENO, &amp;read_fds)) &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ£€æµ‹åˆ°è¾“å…¥ï¼\n&quot;</span>);<br>                <br>                <span class="hljs-keyword">if</span> (fgets(buffer, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-built_in">stdin</span>) != <span class="hljs-literal">NULL</span>) &#123;<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ä½ è¾“å…¥äº†: %s&quot;</span>, buffer);<br>                    <br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">&quot;quit&quot;</span>, <span class="hljs-number">4</span>) == <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç¨‹åºç»“æŸ\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">â•­â”€ ~<span class="hljs-string">/Desktop/c-dev</span>          <br>â•°â”€â¯ <span class="hljs-string">./main</span><br>è¯·è¾“å…¥ä¸€äº›æ–‡å­—ï¼ˆè¾“å…¥<span class="hljs-keyword">quit</span>é€€å‡ºï¼‰ï¼š<br>ç­‰å¾…è¾“å…¥<span class="hljs-string">...</span><br>æˆ‘è¾“å…¥äº†ä¸€æ®µæ–‡å­—ã€‚<br>ç­‰å¾…ç»“æŸï¼æ£€æµ‹åˆ°è¾“å…¥ï¼<br>ä½ è¾“å…¥äº†: æˆ‘è¾“å…¥äº†ä¸€æ®µæ–‡å­—ã€‚<br>ç­‰å¾…è¾“å…¥<span class="hljs-string">...</span><br>^C<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­è¯´æ˜ï¼š</p><ol type="1"><li><code>select(STDIN_FILENO + 1, &amp;read_fds, NULL, NULL, NULL)</code><ul><li>ç›‘æ§æ ‡å‡†è¾“å…¥ï¼ˆæ–‡ä»¶æè¿°ç¬¦0ï¼‰</li><li>ç¨‹åºä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥</li></ul></li><li>å½“ç”¨æˆ·æŒ‰ä¸‹å›è½¦é”®æ—¶ï¼š<ul><li><code>select</code>æ£€æµ‹åˆ°æœ‰è¾“å…¥æ•°æ®</li><li>è¿”å›å€¼ &gt; 0ï¼Œè¡¨ç¤ºæœ‰äº‹ä»¶å‘ç”Ÿ</li><li><code>FD_ISSET</code>æ£€æŸ¥ç¡®è®¤æ˜¯æ ‡å‡†è¾“å…¥æœ‰æ•°æ®</li><li>ç„¶åè¯»å–å¹¶å¤„ç†æ•°æ®</li></ul></li><li>å¦‚æœæ²¡æœ‰selectï¼š<ul><li><code>fgets</code>ä¼šç›´æ¥é˜»å¡åœ°ç­‰å¾…è¾“å…¥</li><li>æ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªè¾“å…¥æº</li><li>è¿™å°±æ˜¯<code>select</code>çš„ä»·å€¼æ‰€åœ¨</li></ul></li></ol><h2 id="poll">poll</h2><p>è·Ÿ<code>select</code>ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯<strong>æ²¡æœ‰ä¼ å…¥æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„é™åˆ¶</strong>ï¼Œ<code>select</code>æ”¶åˆ°<code>FD_SETSIZE</code>çš„å½±å“ï¼Œç›‘æ§çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼ˆé€šå¸¸æ˜¯1024ï¼‰ï¼›è€Œä¸”ç²¾ç®€äº†ä¼ å…¥å‚æ•°çš„æ•°é‡ï¼Œå°†åŸæ¥çš„è¯»æ–‡ä»¶æè¿°ç¬¦ã€å†™æ–‡ä»¶æè¿°ç¬¦ã€é”™è¯¯æ–‡ä»¶æè¿°ç¬¦ä¸€å¾‹ä½¿ç”¨<code>pollfd</code>ç»“æ„ä½“æ•°ç»„æ¥è¡¨ç¤ºã€‚</p><h3 id="å‡½æ•°åŸå‹-1">å‡½æ•°åŸå‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">poll</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> pollfd *fds, <span class="hljs-type">nfds_t</span> nfds, <span class="hljs-type">int</span> timeout)</span>;<br></code></pre></td></tr></table></figure><ul><li><code>fds</code>ï¼šä¸€ä¸ª<code>struct pollfd</code><strong>æ•°ç»„</strong>ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æè¿°ä¸€ä¸ªè¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åŠå…¶äº‹ä»¶ç±»å‹</li><li><code>nfds</code>ï¼šæ•°ç»„çš„å…ƒç´ ä¸ªæ•°</li><li><code>timeout</code>ï¼šç­‰å¾…æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œ<code>0</code>è¡¨ç¤ºç«‹å³è¿”å›ï¼Œ<code>-1</code>è¡¨ç¤ºä¸€ç›´é˜»å¡</li></ul><p><code>struct pollfd</code>ç»“æ„å¦‚ä¸‹ï¼Œåœ¨è°ƒç”¨<code>poll()</code>ä¹‹å‰åº”è¯¥èµ‹å€¼å®Œæ¯•ï¼Œè€Œä¸”å¯ä»¥æŒ‰éœ€ç›´æ¥ä¿®æ”¹æ•°ç»„ä¸­çš„<code>events</code>å±æ€§å€¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> &#123;</span><br>    <span class="hljs-type">int</span> fd;         <span class="hljs-comment">// æ–‡ä»¶æè¿°ç¬¦</span><br>    <span class="hljs-type">short</span> events;   <span class="hljs-comment">// å…³å¿ƒçš„äº‹ä»¶ï¼ˆè¾“å…¥äº‹ä»¶ï¼‰</span><br>    <span class="hljs-type">short</span> revents;  <span class="hljs-comment">// å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼ˆè¾“å‡ºäº‹ä»¶ï¼‰ï¼›è°ƒç”¨è¿”å›åç”±å†…æ ¸å†™å›è¯¥å€¼</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li><code>fd</code>åº”å½“ä¼ å…¥è¯¸å¦‚<code>STDIN_FILENO</code>çš„æ–‡ä»¶æè¿°ç¬¦</li><li><code>events</code>èµ‹å€¼ä¸ºè¾“å…¥çš„äº‹ä»¶ï¼Œè°ƒç”¨<code>poll()</code>åï¼Œ<strong>å†…æ ¸</strong>ä¼šç›‘è§†è¿™äº›fdï¼Œç›´åˆ°å‘ç”Ÿäº†äº‹ä»¶/è¶…æ—¶ï¼ˆ<code>timeout</code>ï¼‰/è¢«ä¿¡å·ä¸­æ–­</li><li><code>revents</code>ï¼šå½“<code>poll()</code>è¿”å›æ—¶ï¼Œ<strong>å†…æ ¸</strong>ä¼šæ¸…ç©º<code>fds[i].revents</code>çš„å€¼ï¼Œç„¶åæŠŠå®é™…å‘ç”Ÿäº‹ä»¶çš„å€¼å†™è¿›å»ï¼Œ<strong>è¯»å–æ—¶è¦ç”¨æŒ‰ä½ä¸</strong>ï¼šä¾‹å¦‚<code>fds[i].revent &amp; POLLIN</code>ã€‚</li></ul><p>å¸¸ç”¨äº‹ä»¶ï¼ˆ<code>events</code>/<code>revents</code>ï¼‰ï¼š</p><ul><li>POLLIN â†’ æ•°æ®å¯è¯»</li><li>POLLOUT â†’ å¯ä»¥å†™å…¥æ•°æ®</li><li>POLLERR â†’ å‘ç”Ÿé”™è¯¯</li><li>POLLHUP â†’ å¯¹ç«¯å…³é—­è¿æ¥</li><li>POLLNVAL â†’ æ— æ•ˆçš„ FD</li></ul><h3 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// æ”¹å†™åçš„pollç‰ˆæœ¬</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;=== POLL ç‰ˆæœ¬ ===\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€äº›æ–‡å­—ï¼ˆè¾“å…¥quité€€å‡ºï¼‰ï¼š\n&quot;</span>);<br><br>    <span class="hljs-comment">// å®šä¹‰pollfdç»“æ„ä½“æ•°ç»„ï¼Œåªç›‘æ§ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> <span class="hljs-title">fds</span>[1];</span><br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">100</span>];<br><br>    <span class="hljs-comment">// è®¾ç½®è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶</span><br>    fds[<span class="hljs-number">0</span>].fd = STDIN_FILENO; <span class="hljs-comment">// ç›‘æ§æ ‡å‡†è¾“å…¥</span><br>    fds[<span class="hljs-number">0</span>].events = POLLIN; <span class="hljs-comment">// ç›‘æ§å¯è¯»äº‹ä»¶</span><br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç­‰å¾…è¾“å…¥...\n&quot;</span>);<br><br>        <span class="hljs-comment">// pollç­‰å¾…è¾“å…¥äº‹ä»¶ï¼Œ-1è¡¨ç¤ºæ— é™ç­‰å¾…</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;revents at beginning: %d\n&quot;</span>, fds[<span class="hljs-number">0</span>].revents);<br>        <span class="hljs-type">int</span> result = poll(fds, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>);<br><br>        <span class="hljs-keyword">if</span> (result &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// æ£€æŸ¥æ ‡å‡†è¾“å…¥æ˜¯å¦æœ‰æ•°æ®å¯è¯»</span><br>            <span class="hljs-keyword">if</span> (fds[<span class="hljs-number">0</span>].revents &amp; POLLIN) &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ£€æµ‹åˆ°è¾“å…¥ï¼\n&quot;</span>);<br><br>                <span class="hljs-keyword">if</span> (fgets(buffer, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-built_in">stdin</span>) != <span class="hljs-literal">NULL</span>) &#123;<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ä½ è¾“å…¥äº†: %s&quot;</span>, buffer);<br><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">&quot;quit&quot;</span>, <span class="hljs-number">4</span>) == <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;revents at end: %d\n&quot;</span>, fds[<span class="hljs-number">0</span>].revents &amp; POLLIN);<br>            <span class="hljs-comment">// æ¸…é™¤äº‹ä»¶æ ‡å¿—ï¼ˆå¯é€‰ï¼Œå› ä¸ºä¸‹æ¬¡pollä¼šé‡æ–°è®¾ç½®reventsï¼‰</span><br>            fds[<span class="hljs-number">0</span>].revents = <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç¨‹åºç»“æŸ\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">â•­â”€ ~/Desktop/c-dev              <br>â•°â”€â¯ ./main                 <br><span class="hljs-section">=== POLL ç‰ˆæœ¬ ===</span><br>è¯·è¾“å…¥ä¸€äº›æ–‡å­—ï¼ˆè¾“å…¥quité€€å‡ºï¼‰ï¼š<br>ç­‰å¾…è¾“å…¥...  <br>æµ‹è¯•è¾“å…¥   <br>æ£€æµ‹åˆ°è¾“å…¥ï¼<br>ä½ è¾“å…¥äº†: æµ‹è¯•è¾“å…¥<br>revents at end: 1<br>ç­‰å¾…è¾“å…¥...<br>revents at beginning: 0<br>^C<br></code></pre></td></tr></table></figure><h3 id="ä¸selectçš„åŒºåˆ«">ä¸selectçš„åŒºåˆ«</h3><table><thead><tr><th>æ–¹é¢</th><th><code>select</code></th><th><code>poll</code></th></tr></thead><tbody><tr><td>ç›‘æ§å¯¹è±¡æ•°</td><td>å— <code>FD_SETSIZE</code> é™åˆ¶ï¼ˆé€šå¸¸1024ï¼‰</td><td>ç†è®ºæ— é™åˆ¶</td></tr><tr><td>æ•°æ®ç»“æ„</td><td><code>fd_set</code>ï¼ˆä½å›¾ï¼‰</td><td><code>struct pollfd</code> æ•°ç»„</td></tr><tr><td>ä¿®æ”¹æ–¹å¼</td><td>æ¯æ¬¡è°ƒç”¨å‰éƒ½è¦é‡ç½®é›†åˆ</td><td>å¯ä»¥ç›´æ¥æ”¹æ•°ç»„ä¸­çš„ events</td></tr><tr><td>å…¼å®¹æ€§</td><td>POSIX æ ‡å‡†</td><td>POSIX æ ‡å‡†</td></tr></tbody></table><h2 id="epoll">epoll</h2><p>epollï¼Œå®ƒç®—æ˜¯ <strong>Linux</strong> ä¸‹ I/O å¤šè·¯å¤ç”¨çš„â€œé«˜é…ç‰ˆâ€ï¼Œæ¯”select å’Œ poll æ›´é«˜æ•ˆï¼Œå°¤å…¶é€‚åˆåŒæ—¶ç›‘æ§å¤§é‡æ–‡ä»¶æè¿°ç¬¦çš„åœºæ™¯ã€‚</p><p><code>select</code>å’Œ<code>poll</code>æ¯æ¬¡è°ƒç”¨éƒ½è¦æ‰‹åŠ¨ä¼ å…¥æ‰€æœ‰ç”¨åˆ°çš„fdï¼ˆä¸è®°å½•çŠ¶æ€ï¼‰ï¼Œè€Œä¸”è¿”å›ååˆæ‰‹åŠ¨é€ä¸ªæ£€æŸ¥å…¨éƒ¨çš„fdæ‰çŸ¥é“å“ªä¸ªå°±ç»ªï¼ˆå‰è€…å¾ªç¯æ£€æŸ¥<code>if (FD_ISSET(æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦, &amp;read_fds))</code>ï¼Œåè€…å¾ªç¯æ£€æŸ¥<code>if (fds[i].revents &amp; POLLIN)</code>ï¼‰ã€‚<code>epoll</code>å¯¹è¿™ä¸¤ç‚¹éƒ½åšäº†æ”¹è¿›ï¼Œä½“ç°åœ¨ï¼š</p><ol type="1"><li>fdé›†åˆå¯ä»¥åªæ³¨å†Œä¸€æ¬¡ï¼Œåé¢å¯ä»¥<strong>åå¤è°ƒç”¨</strong>ï¼ˆç”±å†…æ ¸è®°ä½ï¼‰ï¼Œç›¸æ¯”ä¹‹ä¸‹æ¯æ¬¡è°ƒç”¨<code>select / poll</code>éƒ½å¿…é¡»é‡æ–°ä¼ å…¥æ•´ä¸ªFDé›†åˆã€‚</li><li>åªè¿”å›<strong>å·²ç»å°±ç»ªçš„fdåˆ—è¡¨</strong>ï¼Œä¸ç”¨æ‰‹åŠ¨éå†</li><li>æ”¯æŒæ°´å¹³è§¦å‘ï¼ˆLTï¼‰å’Œè¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰ä¸¤ç§æ¨¡å¼</li><li>ç†è®ºä¸ŠFDçš„æ•°é‡æ²¡æœ‰é™åˆ¶</li></ol><h3 id="ä¸‰ä¸ªæ ¸å¿ƒç³»ç»Ÿè°ƒç”¨">ä¸‰ä¸ªæ ¸å¿ƒç³»ç»Ÿè°ƒç”¨</h3><ol type="1"><li><strong>åˆ›å»º epoll å®ä¾‹</strong></li></ol><p>ä¸¤ç§æ–¹å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> epfd = epoll_create(<span class="hljs-type">int</span> __size); <span class="hljs-comment">// è¿”å›ä¸€ä¸ª epoll æ–‡ä»¶æè¿°ç¬¦</span><br><span class="hljs-type">int</span> epfd = epoll_create1(<span class="hljs-type">int</span> __flags);<br></code></pre></td></tr></table></figure><ul><li><code>epoll_create</code>è¿”å›æ–° epollå®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­<code>size</code>å·²ç»è¢«å¿½ç•¥ï¼Œä½†æ˜¯å¿…é¡»å¤§äº0ã€‚</li><li><code>epoll_create1</code>ä¸<code>epoll_create</code>ç›¸åŒï¼Œä¸è¿‡å¸¦æœ‰<code>FLAGS</code>å‚æ•°ï¼Œè€Œä¸”ç§»é™¤äº†ç”¨ä¸ä¸Šçš„<code>size</code>å‚æ•°ã€‚</li></ul><ol start="2" type="1"><li><strong>æ·»åŠ /ä¿®æ”¹/åˆ é™¤ ç›‘å¬çš„ FD</strong></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">epoll_ctl</span><span class="hljs-params">(<span class="hljs-type">int</span> epfd, <span class="hljs-type">int</span> op, <span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> epoll_event *event)</span>;<br></code></pre></td></tr></table></figure><ul><li><code>epfd</code>ï¼šåˆšæ‰åˆ›å»ºå®ä¾‹è¿”å›çš„epfd</li><li><code>op</code>ï¼šä¸‰ç§å–å€¼ï¼Œ<code>EPOLL_CTL_ADD</code><code>EPOLL_CTL_MOD</code> <code>EPOLL_CTL_DEL</code></li><li><code>fd</code>ï¼šè¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦</li><li><code>event</code>ï¼šäº‹ä»¶çš„ä¿¡æ¯</li></ul><ol start="3" type="1"><li><strong>ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿ</strong></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">epoll_wait</span><span class="hljs-params">(<span class="hljs-type">int</span> epfd, <span class="hljs-keyword">struct</span> epoll_event *events, <span class="hljs-type">int</span> maxevents, <span class="hljs-type">int</span> timeout)</span>;<br></code></pre></td></tr></table></figure><p>ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œè¿”å›<strong>å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡</strong>ã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸éœ€è¦ä¼ å…¥ç›‘å¬çš„äº‹ä»¶é›†åˆï¼Œå› ä¸ºå·²ç»ä¿å­˜åˆ°å†…æ ¸ä¸­äº†ï¼Œä¸éœ€è¦é‡æ–°ä¼ å…¥ã€‚</p><ul><li><code>epfd</code>: epollå®ä¾‹</li><li><code>events</code>: ç”¨äºæ¥æ”¶å°±ç»ªäº‹ä»¶çš„æ•°ç»„</li><li><code>maxevents</code>: æœ€å¤šè¿”å›çš„äº‹ä»¶æ•°</li><li><code>timeout</code>:è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ-1è¡¨ç¤ºé˜»å¡ç­‰å¾…æ‰€æœ‰äº‹ä»¶å®Œæˆ</li></ul><p><code>epoll_event</code>ç»“æ„ä½“ï¼šä½äº<code>sys/epoll.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">epoll_data</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-type">void</span> *ptr;<br>  <span class="hljs-type">int</span> fd;<br>  <span class="hljs-type">uint32_t</span> u32;<br>  <span class="hljs-type">uint64_t</span> u64;<br>&#125; <span class="hljs-type">epoll_data_t</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">epoll_event</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-type">uint32_t</span> events;<span class="hljs-comment">/* Epoll events */</span><br>  <span class="hljs-type">epoll_data_t</span> data;<span class="hljs-comment">/* User data variable ä¸€èˆ¬ç”¨æ¥å­˜fd*/</span> <br>&#125; __EPOLL_PACKED;<br></code></pre></td></tr></table></figure><p>æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ä¸¤ä¸ªï¼š<code>ev.events = EPOLLIN</code>ï¼Œ<code>ev.data.fd = æ–‡ä»¶æè¿°ç¬¦</code>ã€‚ç”¨äºæ¥æ”¶å°±ç»ªäº‹ä»¶çš„æ•°ç»„eventsçš„å­—æ®µ<code>events[i].data.fd</code>ç­‰äºæ³¨å†Œæ—¶<code>ev.data.fd</code>é‡Œæ”¾çš„å€¼ï¼Œå¸¸è§åšæ³•æ˜¯æ”¾FD æœ¬èº«ï¼Œä½†ä¹Ÿå¯ä»¥æ”¾åˆ«çš„ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -1">ç¤ºä¾‹ä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENTS 10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">simple_epoll_example</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;=== ç®€å•epollç¤ºä¾‹ï¼šç›‘æ§æ ‡å‡†è¾“å…¥ ===\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æ–‡å­—ï¼ˆè¾“å…¥quité€€å‡ºï¼‰ï¼š\n&quot;</span>);<br><br>    <span class="hljs-comment">// 1. åˆ›å»ºepollå®ä¾‹</span><br>    <span class="hljs-type">int</span> epfd = epoll_create(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> (epfd == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;epoll_createå¤±è´¥&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 2. å‡†å¤‡è¦ç›‘æ§çš„äº‹ä»¶</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">epoll_event</span> <span class="hljs-title">ev</span>;</span>                 <span class="hljs-comment">// ev ç”¨äºç›‘æ§å¯è¯»äº‹ä»¶</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">epoll_event</span> <span class="hljs-title">events</span>[<span class="hljs-title">MAX_EVENTS</span>];</span> <span class="hljs-comment">// events ç”¨äºæ¥æ”¶å°±ç»ªäº‹ä»¶</span><br><br>    <span class="hljs-comment">// è®¾ç½®è¦ç›‘æ§æ ‡å‡†è¾“å…¥çš„è¯»äº‹ä»¶</span><br>    ev.events = EPOLLIN;       <span class="hljs-comment">// ç›‘æ§å¯è¯»äº‹ä»¶</span><br>    ev.data.fd = STDIN_FILENO; <span class="hljs-comment">// å…³è”çš„æ–‡ä»¶æè¿°ç¬¦</span><br><br>    <span class="hljs-comment">// 3. å°†æ ‡å‡†è¾“å…¥æ·»åŠ åˆ°epollç›‘æ§ä¸­</span><br>    <span class="hljs-keyword">if</span> (epoll_ctl(epfd, EPOLL_CTL_ADD, STDIN_FILENO, &amp;ev) == <span class="hljs-number">-1</span>) &#123;<br>        perror(<span class="hljs-string">&quot;epoll_ctlå¤±è´¥&quot;</span>);<br>        close(epfd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-type">char</span> buffer[BUFFER_SIZE];<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;--------------\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç­‰å¾…è¾“å…¥...\n&quot;</span>);<br><br>        <span class="hljs-comment">// 4. ç­‰å¾…äº‹ä»¶å‘ç”Ÿ</span><br>        <span class="hljs-type">int</span> nfds = epoll_wait(epfd, events, MAX_EVENTS, <span class="hljs-number">-1</span>);<br><br>        <span class="hljs-keyword">if</span> (nfds == <span class="hljs-number">-1</span>) &#123;<br>            perror(<span class="hljs-string">&quot;epoll_waitå¤±è´¥&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;nfds: %d\n&quot;</span>, nfds);<br><br>        <span class="hljs-comment">// 5. å¤„ç†å°±ç»ªçš„äº‹ä»¶</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nfds; i++) &#123;<br>            <span class="hljs-keyword">if</span> (events[i].data.fd == STDIN_FILENO) &#123;<br>                <span class="hljs-keyword">if</span> (events[i].events &amp; EPOLLIN) &#123;<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ£€æµ‹åˆ°è¾“å…¥ï¼\n&quot;</span>);<br><br>                    <span class="hljs-keyword">if</span> (fgets(buffer, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-built_in">stdin</span>) != <span class="hljs-literal">NULL</span>) &#123;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ä½ è¾“å…¥äº†: %s&quot;</span>, buffer);<br><br>                        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strncmp</span>(buffer, <span class="hljs-string">&quot;quit&quot;</span>, <span class="hljs-number">4</span>) == <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">goto</span> cleanup;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>cleanup:<br>    close(epfd);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç¨‹åºç»“æŸ\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    simple_epoll_example();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">=== ç®€å•epollç¤ºä¾‹ï¼šç›‘æ§æ ‡å‡†è¾“å…¥ ===<br>è¯·è¾“å…¥æ–‡å­—ï¼ˆè¾“å…¥quité€€å‡ºï¼‰ï¼š<br>--------------<br>ç­‰å¾…è¾“å…¥...<br>è¿™æ˜¯ä¸€ä¸ªå¥å­<br>nfds: <span class="hljs-number">1</span><br>æ£€æµ‹åˆ°è¾“å…¥ï¼<br>ä½ è¾“å…¥äº†: è¿™æ˜¯ä¸€ä¸ªå¥å­<br>--------------<br>ç­‰å¾…è¾“å…¥...<br></code></pre></td></tr></table></figure><h3 id="ä¸¤ç§è§¦å‘æ¨¡å¼-äº‹ä»¶é€šçŸ¥æœºåˆ¶">ä¸¤ç§è§¦å‘æ¨¡å¼-äº‹ä»¶é€šçŸ¥æœºåˆ¶</h3><ul><li><p>æ°´å¹³è§¦å‘ï¼ˆLTï¼‰ï¼šåªè¦æœ‰æ•°æ®å°±é€šçŸ¥ã€‚å½“æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šé‡å¤å¤šæ¬¡é€šçŸ¥ï¼Œç›´åˆ°æ•°æ®å¤„ç†å®Œæˆã€‚</p></li><li><p>è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰ï¼šåªåœ¨çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ä¸€æ¬¡ï¼ˆæ¯”å¦‚å·²ç»è¯»å®Œ-æœ‰æœªè¯»æ¶ˆæ¯ï¼‰ï¼Œè¿™æ—¶åªè¦è¯»è¿‡ä¸€æ¬¡ï¼Œ<code>epoll_wait</code>å°±ä¸ä¼šæç¤ºè¿˜æœ‰äº‹ä»¶ï¼Œå³ä½¿è¿™ä¸€æ¬¡æ²¡æœ‰è¯»å®Œã€‚</p></li></ul><h3 id="ä¸‰ä¸ªå‡½æ•°çš„åŒºåˆ«">ä¸‰ä¸ªå‡½æ•°çš„åŒºåˆ«</h3><p>select æ¨¡å¼å­˜åœ¨çš„ä¸‰ä¸ªé—®é¢˜</p><ul><li>ç›‘å¬çš„ FD æœ€å¤§ä¸è¶…è¿‡ 1024<br /></li><li>æ¯æ¬¡ select éƒ½éœ€è¦æŠŠæ‰€æœ‰è¦ç›‘å¬çš„ FD éƒ½æ‹·è´åˆ°å†…æ ¸ç©ºé—´<br /></li><li>æ¯æ¬¡éƒ½è¦éå†æ‰€æœ‰ FD æ¥åˆ¤æ–­å°±ç»ªçŠ¶æ€</li></ul><p>poll æ¨¡å¼çš„é—®é¢˜</p><ul><li>poll åˆ©ç”¨é“¾è¡¨è§£å†³äº† select ä¸­ç›‘å¬ FD ä¸Šé™çš„é—®é¢˜ï¼Œä½†ä¾ç„¶è¦éå†æ‰€æœ‰FDï¼Œå¦‚æœç›‘å¬è¾ƒå¤šï¼Œæ€§èƒ½ä¼šä¸‹é™</li></ul><p>epoll æ¨¡å¼ä¸­å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ</p><ul><li>åŸºäº epoll å®ä¾‹ä¸­çš„<strong>çº¢é»‘æ ‘</strong>ä¿å­˜è¦ç›‘å¬çš„FDï¼Œç†è®ºä¸Šæ— ä¸Šé™ï¼Œè€Œä¸”å¢åˆ æ”¹æŸ¥æ•ˆç‡éƒ½éå¸¸é«˜ï¼Œæ€§èƒ½ä¸ä¼šéšç€ç›‘å¬çš„ FDæ•°é‡å¢å¤šè€Œä¸‹é™<br /></li><li>æ¯ä¸ª FD åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ <code>epoll_ctl</code> æ·»åŠ åˆ°çº¢é»‘æ ‘ï¼Œä»¥åæ¯æ¬¡<code>epoll_wait</code> æ— éœ€ä¼ é€’ä»»ä½•å‚æ•°ï¼Œæ— éœ€é‡å¤æ‹·è´ FDåˆ°å†…æ ¸ç©ºé—´<br /></li><li>å†…æ ¸ä¼šå°†å°±ç»ªçš„ FD ç›´æ¥æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„æŒ‡å®šä½ç½®ï¼Œç”¨æˆ·è¿›ç¨‹æ— éœ€éå†æ‰€æœ‰FD å°±èƒ½çŸ¥é“å°±ç»ªçš„æ˜¯è°</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿ-è™šæ‹ŸåŒ–CPUçŸ¥è¯†æ¢³ç†</title>
    <link href="/2025/08/07/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%99%9A%E6%8B%9F%E5%8C%96CPU%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/"/>
    <url>/2025/08/07/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%99%9A%E6%8B%9F%E5%8C%96CPU%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>ã€Šæ“ä½œç³»ç»Ÿå¯¼è®ºã€‹å®˜ç½‘ï¼šhttps://pages.cs.wisc.edu/~remzi/OSTEP/</p><p>ä½œä¸šä»£ç ä¸‹è½½åœ°å€ï¼šhttps://pages.cs.wisc.edu/~remzi/OSTEP/Homework/homework.html</p><p>å‚è€ƒè§£ç­”ï¼šhttps://github.com/xxyzz/ostep-hw</p><h1 id="ç›®å½•">ç›®å½•</h1><ol type="1"><li><a href="#å…¨ä¹¦ä¸»è¦å†…å®¹ä¸€è§ˆ">å…¨ä¹¦ä¸»è¦å†…å®¹ä¸€è§ˆ</a></li><li><a href="#ä¸€è™šæ‹ŸåŒ–çš„æ¦‚å¿µå’Œapi">ä¸€ã€è™šæ‹ŸåŒ–çš„æ¦‚å¿µå’ŒAPI</a><ol type="1"><li><a href="#æŠ½è±¡è¿›ç¨‹">æŠ½è±¡ï¼šè¿›ç¨‹</a></li><li><a href="#è¿›ç¨‹api">è¿›ç¨‹API</a><ol type="1"><li><a href="#fork">fork</a></li><li><a href="#wait">wait</a></li><li><a href="#exec">exec</a></li><li><a href="#åº”ç”¨shell">åº”ç”¨ï¼šshell</a></li></ol></li></ol></li><li><a href="#äºŒè™šæ‹ŸåŒ–cpu">äºŒã€è™šæ‹ŸåŒ–CPU</a><ol type="1"><li><ahref="#å—é™ç›´æ¥æ‰§è¡Œlimited-direct-execution">å—é™ç›´æ¥æ‰§è¡Œï¼ˆlimiteddirect executionï¼‰</a><ol type="1"><li><a href="#ç›´æ¥è¿è¡Œåè®®">ç›´æ¥è¿è¡Œåè®®</a></li><li><a href="#å—é™çš„æ§åˆ¶æƒ">å—é™çš„æ§åˆ¶æƒ</a></li><li><a href="#åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢">åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢</a><ol type="1"><li><a href="#åä½œæ–¹å¼">åä½œæ–¹å¼</a></li><li><a href="#éåä½œæ–¹å¼">éåä½œæ–¹å¼</a></li><li><a href="#ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡">ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡</a></li></ol></li></ol></li></ol></li><li><ahref="#ä¸‰è¿›ç¨‹è°ƒåº¦ä¸€å•å¤„ç†å™¨è¿›ç¨‹è°ƒåº¦">ä¸‰ã€è¿›ç¨‹è°ƒåº¦ï¼ˆä¸€ï¼‰å•å¤„ç†å™¨è¿›ç¨‹è°ƒåº¦</a><ol type="1"><li><a href="#æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆsjf">æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆSJF</a></li><li><a href="#æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆstcf">æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆSTCF</a></li><li><a href="#è½®è½¬rr">è½®è½¬(RR)</a></li><li><a href="#ioæ“ä½œ">IOæ“ä½œ</a></li><li><a href="#å¤šçº§åé¦ˆé˜Ÿåˆ—mlfqè°ƒåº¦">å¤šçº§åé¦ˆé˜Ÿåˆ—MLFQè°ƒåº¦</a><ol type="1"><li><a href="#åŸºæœ¬è§„åˆ™">åŸºæœ¬è§„åˆ™</a></li><li><a href="#ä¼˜å…ˆçº§è°ƒæ•´ç®—æ³•">ä¼˜å…ˆçº§è°ƒæ•´ç®—æ³•</a></li><li><ahref="#é¥¥é¥¿é—®é¢˜è‡ªåŠ¨æå‡ä¼˜å…ˆçº§">â€œé¥¥é¥¿â€é—®é¢˜â€”â€”è‡ªåŠ¨æå‡ä¼˜å…ˆçº§</a></li></ol></li><li><a href="#æ¯”ä¾‹ä»½é¢è°ƒåº¦">æ¯”ä¾‹ä»½é¢è°ƒåº¦</a><ol type="1"><li><a href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><li><a href="#å®ç°å½©ç¥¨è°ƒåº¦ç®—æ³•">å®ç°å½©ç¥¨è°ƒåº¦ç®—æ³•</a></li><li><a href="#æ­¥é•¿è°ƒåº¦ç®—æ³•">æ­¥é•¿è°ƒåº¦ç®—æ³•</a></li><li><a href="#ç•ªå¤–æŸ¥çœ‹cpuå…·ä½“ä¿¡æ¯">ç•ªå¤–ï¼šæŸ¥çœ‹CPUå…·ä½“ä¿¡æ¯</a></li></ol></li></ol></li><li><ahref="#å››è¿›ç¨‹è°ƒåº¦äºŒå¤šå¤„ç†å™¨è¿›ç¨‹è°ƒåº¦">å››ã€è¿›ç¨‹è°ƒåº¦ï¼ˆäºŒï¼‰å¤šå¤„ç†å™¨è¿›ç¨‹è°ƒåº¦</a><ol type="1"><li><a href="#å¤šå¤„ç†å™¨æ¶æ„">å¤šå¤„ç†å™¨æ¶æ„</a></li><li><a href="#å•é˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦sqms">å•é˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦SQMS</a></li><li><a href="#å¤šé˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦">å¤šé˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦</a></li><li><a href="#gnulinuxé‡‡ç”¨çš„ç­–ç•¥">GNU/Linuxé‡‡ç”¨çš„ç­–ç•¥</a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li></ol></li></ol><h1 id="å…¨ä¹¦ä¸»è¦å†…å®¹ä¸€è§ˆ">å…¨ä¹¦ä¸»è¦å†…å®¹ä¸€è§ˆ</h1><p><strong>è™šæ‹ŸåŒ–</strong>ï¼šæ“ä½œç³»ç»Ÿå°†ç‰©ç†èµ„æºï¼Œè½¬æ¢æˆæ›´é€šç”¨ã€æ›´å¼ºå¤§æ›´æ˜“äºä½¿ç”¨çš„å½¢å¼.</p><ul><li><strong>è™šæ‹ŸåŒ–CPU</strong>ï¼šå°±ç®—åªæœ‰ä¸€ä¸ªå¤„ç†å™¨ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿèƒ½åšåˆ°æœ‰å¾ˆå¤šCPUåœ¨åŒæ—¶è¿è¡Œçš„â€œ<strong>å‡è±¡</strong>â€(illusion)ï¼Œè®©å¾ˆå¤šç¨‹åºçœ‹ä¼¼åŒæ—¶è¿è¡Œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<strong>è™šæ‹ŸåŒ–CPU</strong>ï¼ˆvirtualizingthe CPUï¼‰</li><li><strong>è™šæ‹ŸåŒ–å†…å­˜</strong>ï¼š<ul><li>ç¨‹åºå°†æ‰€æœ‰æ•°æ®ç»“æ„ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤æ¯æ¬¡è¯»å–æŒ‡ä»¤éƒ½å¿…é¡»è®¿é—®å†…å­˜ï¼›</li><li><code>malloc()</code>åŠ¨æ€åˆ†é…ä¸€å—æŒ‡å®šå¤§å°çš„å†…å­˜ï¼Œå¹¶è¿”å›æŒ‡å‘è¿™å—å†…å­˜çš„æŒ‡é’ˆã€‚</li><li>å¥½åƒæ¯ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºéƒ½æœ‰è‡ªå·±çš„ç§æœ‰å†…å­˜ï¼Œè€Œä¸æ˜¯ä¸å…¶ä»–æ­£åœ¨è¿è¡Œçš„ç¨‹åºå…±äº«ç›¸åŒçš„ç‰©ç†å†…å­˜</li><li>æœ¬è´¨ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½åœ¨è®¿é—®è‡ªå·±çš„<strong>ç§æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´</strong>ï¼Œæ“ä½œç³»ç»Ÿä»¥æŸç§æ–¹å¼æ˜ å°„åˆ°æœºå™¨çš„ç‰©ç†å†…å­˜ä¸Šï¼Œä¸åŒè¿›ç¨‹çš„å†…å­˜å¼•ç”¨äº’ä¸å½±å“ã€‚]]</li></ul></li><li><strong>å¹¶å‘</strong>, ä¾‹å¦‚:</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span> <span class="hljs-comment">// å¯èƒ½åœ¨ common.h ä¸­å·²ç»åŒ…å«äº†</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// #include &quot;common.h&quot;  // å‡è®¾è¿™ä¸ªå¤´æ–‡ä»¶å®šä¹‰äº† Pthread_create å’Œ Pthread_join çš„åŒ…è£…å®</span><br><br><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> counter = <span class="hljs-number">0</span>; <span class="hljs-comment">// å…¨å±€å…±äº«å˜é‡ï¼Œä½¿ç”¨ volatile é¿å…ç¼–è¯‘å™¨ä¼˜åŒ–</span><br><span class="hljs-type">int</span> loops;<br><br><span class="hljs-comment">// çº¿ç¨‹æ‰§è¡Œå‡½æ•°</span><br><span class="hljs-type">void</span> *<span class="hljs-title function_">worker</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; loops; i++) &#123;<br>        counter++; <span class="hljs-comment">// æ³¨æ„ï¼šæ­¤å¤„å­˜åœ¨ç«æ€æ¡ä»¶ï¼ˆrace conditionï¼‰</span><br>        <span class="hljs-comment">// sleep(1);</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> &#123;<br>    <span class="hljs-comment">// ä¼ å…¥çš„å‚æ•°å³ counter å¢åŠ çš„æ¬¡æ•°</span><br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;usage: threads &lt;value&gt;\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    loops = atoi(argv[<span class="hljs-number">1</span>]); <span class="hljs-comment">// å°†å‚æ•°è½¬æ¢ä¸ºæ•´æ•°</span><br>    <span class="hljs-type">pthread_t</span> p1, p2, p3, p4;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Initial value : %d\n&quot;</span>, counter);<br><br>    pthread_create(&amp;p1, <span class="hljs-literal">NULL</span>, worker, <span class="hljs-literal">NULL</span>);<br>    pthread_create(&amp;p2, <span class="hljs-literal">NULL</span>, worker, <span class="hljs-literal">NULL</span>);<br>    pthread_create(&amp;p3, <span class="hljs-literal">NULL</span>, worker, <span class="hljs-literal">NULL</span>);<br>    pthread_create(&amp;p4, <span class="hljs-literal">NULL</span>, worker, <span class="hljs-literal">NULL</span>);<br><br>    pthread_join(p1, <span class="hljs-literal">NULL</span>);<br>    pthread_join(p2, <span class="hljs-literal">NULL</span>);<br>    pthread_join(p3, <span class="hljs-literal">NULL</span>);<br>    pthread_join(p4, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Final value   : %d\n&quot;</span>, counter);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç£ç›˜ï¼Œå¦å¤–æ²¡æœ‰è™šæ‹Ÿç£ç›˜ä¸€è¯´ï¼Œç£ç›˜ä¸­çš„ä¿¡æ¯å¯ä»¥éšæ—¶å…±äº«ã€‚è€ŒæŒä¹…åŒ–æŒ‡çš„æ˜¯å¦‚ä½•æŠŠå†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸Š</li></ul><h1 id="ä¸€è™šæ‹ŸåŒ–çš„æ¦‚å¿µå’Œapi">ä¸€ã€è™šæ‹ŸåŒ–çš„æ¦‚å¿µå’ŒAPI</h1><h2 id="æŠ½è±¡è¿›ç¨‹">æŠ½è±¡ï¼šè¿›ç¨‹</h2><ul><li><strong>è¿›ç¨‹</strong>ï¼ˆprocessï¼‰å°±æ˜¯æ“ä½œç³»ç»Ÿä¸ºæ­£åœ¨è¿è¡Œçš„ç¨‹åºæä¾›çš„æŠ½è±¡</li><li><strong>åœ°å€ç©ºé—´</strong>ï¼šè¿›ç¨‹å¯ä»¥è®¿é—®çš„ç§æœ‰å†…å­˜</li><li><strong>æ—¶é—´ç‰‡</strong>ï¼šæ“ä½œç³»ç»Ÿä¸ºçº¿ç¨‹æˆ–è€…è¿›ç¨‹<strong>åˆ†é…çš„CPUæ‰§è¡Œæ—¶é—´çš„æœ€å°å•ä½</strong><ul><li>æ—¶é—´ç‰‡å¤ªå°ï¼Œåˆ™ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€è¾ƒå¤§</li><li>æ—¶é—´ç‰‡å¤ªå¤§ï¼Œåˆ™ç›¸åº”å˜æ…¢ï¼Œå®æ—¶æ€§å·®</li><li>LinuxæŸ¥çœ‹æ—¶é—´ç‰‡å¤§å°ï¼š<code>cat /proc/sys/kernel/sched_latency_ns</code></li></ul></li><li><strong>æ—¶åˆ†å…±äº«</strong>ï¼ˆtimesharingï¼‰ï¼šæ“ä½œç³»ç»Ÿå…±äº«èµ„æºçš„æœ€åŸºæœ¬çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œèµ„æºç”±ä¸€ä¸ªè¿›ç¨‹è¿è¡Œä¸€å°æ®µæ—¶é—´ååˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨</li><li><strong>ç©ºåˆ†å…±äº«</strong>ï¼šæ¯”å¦‚ç£ç›˜ï¼ŒæŠŠèµ„æºä»ç©ºé—´ä¸Šåˆ’åˆ†ç»™éœ€è¦çš„æ•°æ®</li></ul><hr /><p><strong>è¿›ç¨‹API</strong></p><ul><li>åˆ›å»º create</li><li>é”€æ¯ destroy</li><li>ç­‰å¾… wait</li><li>å…¶ä»–æ§åˆ¶ miscellaneous controlï¼šä¾‹å¦‚æš‚åœçº¿ç¨‹ç„¶åæ¢å¤</li><li>çŠ¶æ€ statu</li></ul><p><strong>åˆ›å»ºè¿›ç¨‹çš„ç»†èŠ‚</strong></p><ul><li>æ“ä½œç³»ç»Ÿä»ç£ç›˜è¯»å–ä»£ç å’Œé™æ€æ•°æ®ï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</li></ul><p><img src="https://s21.ax1x.com/2025/07/22/pVGC8mV.png" /></p><ul><li>é‡‡ç”¨<strong>æƒ°æ€§åŠ è½½</strong>ï¼Œåªæœ‰ç¨‹åºæ‰§è¡ŒæœŸé—´ç”¨å¾—ä¸Šçš„çš„ä»£ç æˆ–æ•°æ®ç‰‡æ®µï¼Œæ‰ä¼šè¢«åŠ è½½</li><li>åŠ è½½åˆ°å†…å­˜åï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å…ˆä¸º<strong>è¿è¡Œæ—¶æ ˆ</strong>åˆ†é…å†…å­˜ï¼Œç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å’Œè¿”å›åœ°å€ã€‚</li><li>ä¸º<strong>å †</strong>åˆ†é…å†…å­˜ï¼Œæ˜¾å¼è¯·æ±‚å†…å­˜çš„æŒ‡ä»¤ï¼ˆå¦‚<code>malloc()</code>ï¼‰ä¼šç”³è¯·å †ä¸­çš„ç©ºé—´</li><li>è¿˜è¦æ‰§è¡Œä¸<strong>IOè®¾ç½®</strong>ç›¸å…³çš„ä»»åŠ¡</li></ul><p>æœ€åï¼Œå¯åŠ¨ç¨‹åºï¼Œä»<code>main()</code>å…¥å£å¼€å§‹æ‰§è¡Œï¼ŒOSå°†CPUçš„æ§åˆ¶æƒè½¬ç§»åˆ°æ–°åˆ›å»ºçš„è¿›ç¨‹ï¼Œç¨‹åºå¼€å§‹è¿è¡Œã€‚</p><p><strong>è¿›ç¨‹çŠ¶æ€</strong></p><ul><li>è¿è¡Œ runningï¼šæ­£åœ¨æ‰§è¡ŒæŒ‡ä»¤</li><li>å°±ç»ª ready</li><li>é˜»å¡ blockedï¼šä¸»åŠ¨ç­‰å¾…èµ„æºï¼Œ</li></ul><p>å°±ç»ª -&gt; è¿è¡Œ ç§°ä¹‹ä¸ºè¢«è°ƒåº¦ï¼ˆscheduledï¼‰;<br />è¿è¡Œ -&gt; å°±ç»ª ç§°ä¹‹ä¸ºå–æ¶ˆè°ƒåº¦ï¼ˆdescheduledï¼‰</p><p>ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡æ—¶ï¼ŒCPUæ§åˆ¶æƒå¯ä»¥äº¤ç»™å…¶ä»–çº¿ç¨‹ï¼Œä¾‹å¦‚</p><figure><img src="https://s21.ax1x.com/2025/07/22/pVGPtDP.png" alt="é˜»å¡" /><figcaption aria-hidden="true">é˜»å¡</figcaption></figure><p>ä»ç£ç›˜è¯»å–æ•°æ®å’Œç­‰å¾…ç½‘ç»œæ•°æ®åŒ…å°±æ˜¯å…¸å‹çš„IOé˜»å¡è¿‡ç¨‹ã€‚å…³äº<code>Process1</code>å®Œæˆåæ˜¯å¦ç«‹å³åˆ‡æ¢å›å»ï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–çš„é—®é¢˜ï¼Œè¿™é‡Œåªæ˜¯ä¸¾äº†ä¸€ä¸ªä¾‹å­ã€‚</p><p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong> (contextswitch)ï¼šä»»åŠ¡çš„æ‰§è¡Œä¸Šä¸‹æ–‡åŒ…æ‹¬å¯„å­˜å™¨å†…å®¹ã€ç¨‹åºè®¡æ•°å™¨ã€å †æ ˆæŒ‡é’ˆï¼Œä¸ºäº†èƒ½ä¹‹åæ¢å¤ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œç³»ç»Ÿå¿…é¡»ä¿å­˜å½“å‰ä»»åŠ¡çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå¯„å­˜å™¨å†…å®¹ã€ç¨‹åºè®¡æ•°å™¨ã€å †æ ˆæŒ‡é’ˆç­‰ï¼‰ï¼Œå†åŠ è½½å¦ä¸€ä¸ªä»»åŠ¡çš„ä¸Šä¸‹æ–‡ã€‚è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢æ›´å¿«ä¸€äº›ã€‚</p><h2 id="è¿›ç¨‹api">è¿›ç¨‹API</h2><h3 id="fork">fork</h3><p>forkï¼Œè‹±æ–‡åŠ¨è¯ï¼Œæ„ä¸ºæ´¾ç”Ÿã€‚åœ¨çˆ¶è¿›ç¨‹çš„åŸºç¡€ä¸Šæ´¾ç”Ÿå‡ºæ¥ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹çš„å†…ä»ç©ºé—´æŒ‡å‘å’Œçˆ¶è¿›ç¨‹åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œç›´åˆ°æŸä¸€æ–¹è¯•å›¾ä¿®æ”¹ç‰©ç†å†…å­˜çš„æ•°æ®æ‰ä¼šå¼€å§‹å¤åˆ¶ç‰©ç†å†…å­˜</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello world (pid:%d)\n&quot;</span>, (<span class="hljs-type">int</span>) getpid());<br><br>    <span class="hljs-type">int</span> rc = fork();  <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹</span><br><br>    <span class="hljs-keyword">if</span> (rc &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// fork å¤±è´¥</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fork failed\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rc == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å­è¿›ç¨‹æ‰§è¡Œè¿™é‡Œ</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, I am child (pid:%d)\n&quot;</span>, (<span class="hljs-type">int</span>) getpid());<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// çˆ¶è¿›ç¨‹æ‰§è¡Œè¿™é‡Œ</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, I am parent of %d (pid:%d)\n&quot;</span>, rc, (<span class="hljs-type">int</span>) getpid());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">hello</span> <span class="hljs-selector-tag">world</span> (<span class="hljs-attribute">pid</span>:<span class="hljs-number">29146</span>) <br><span class="hljs-selector-tag">hello</span>, <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">am</span> <span class="hljs-selector-tag">parent</span> <span class="hljs-selector-tag">of</span> <span class="hljs-number">29147</span> (<span class="hljs-attribute">pid</span>:<span class="hljs-number">29146</span>)  <br><span class="hljs-selector-tag">hello</span>, <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">am</span> <span class="hljs-selector-tag">child</span> (<span class="hljs-attribute">pid</span>:<span class="hljs-number">29147</span>) <br></code></pre></td></tr></table></figure><ul><li><code>int rc = fork();</code>è¿™ä¸€è¡Œ<code>fork</code>äº†ä¸€ä¸ª<strong>å­è¿›ç¨‹</strong>ï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å‡ ä¹å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯æœ‰åŒºåˆ«ï¼š<ul><li>å­è¿›ç¨‹æ˜¯ä»<code>fork()</code>æŒ‡ä»¤ä»¥åå¼€å§‹æ‰§è¡Œçš„</li><li>å­è¿›ç¨‹è·å¾—çš„<code>rc</code>ä¸º<code>0</code></li><li>çˆ¶è¿›ç¨‹è·å¾—çš„ <code>rc</code>ä¸ºå­è¿›ç¨‹çš„pid</li></ul></li></ul><h3 id="wait">wait</h3><p>å¯ç”¨äºçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹è¿è¡Œç»“æŸã€‚ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>      <span class="hljs-comment">// æ ‡å‡†è¾“å…¥è¾“å‡º</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span>     <span class="hljs-comment">// exit() å‡½æ•°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span>     <span class="hljs-comment">// fork()ã€getpid()</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span>   <span class="hljs-comment">// wait()</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> <br>&#123;<br>    <span class="hljs-comment">// æ‰“å°å½“å‰è¿›ç¨‹çš„ PID</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello world (pid:%d)\n&quot;</span>, (<span class="hljs-type">int</span>) getpid());<br><br>    <span class="hljs-comment">// åˆ›å»ºå­è¿›ç¨‹</span><br>    <span class="hljs-type">int</span> rc = fork();<br><br>    <span class="hljs-keyword">if</span> (rc &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// fork å¤±è´¥</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fork failed\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rc == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å­è¿›ç¨‹æ‰§è¡Œçš„ä»£ç </span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, I am child (pid:%d)\n&quot;</span>, (<span class="hljs-type">int</span>) getpid());<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// çˆ¶è¿›ç¨‹æ‰§è¡Œçš„ä»£ç </span><br>        <span class="hljs-type">int</span> wc = wait(<span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, I am parent of %d (wc:%d) (pid:%d)\n&quot;</span>, rc, wc, (<span class="hljs-type">int</span>) getpid());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="exec">exec</h3><p><code>exec</code>å‡½æ•°çš„ä½œç”¨æ˜¯ä¸ºforkçš„å­è¿›ç¨‹åˆ†é…ä¸åŒäºçˆ¶è¿›ç¨‹çš„ä»»åŠ¡ï¼Œå®ƒæœ‰å¤šä¸ªå®ç°ï¼Œä¸‹é¢ä»¥<code>execvp</code>ä¸ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>      <span class="hljs-comment">// æ ‡å‡†è¾“å…¥è¾“å‡ºå‡½æ•°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span>     <span class="hljs-comment">// exit() å‡½æ•°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span>     <span class="hljs-comment">// fork(), execvp(), getpid()</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span>     <span class="hljs-comment">// strdup()</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span>   <span class="hljs-comment">// wait()</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> <br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello world (pid:%d)\n&quot;</span>, (<span class="hljs-type">int</span>) getpid());<br><br>    <span class="hljs-type">int</span> rc = fork(); <span class="hljs-comment">// åˆ›å»ºå­è¿›ç¨‹</span><br><br>    <span class="hljs-keyword">if</span> (rc &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// fork å¤±è´¥</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fork failed\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rc == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å­è¿›ç¨‹ exec()</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, I am child (pid:%d)\n&quot;</span>, (<span class="hljs-type">int</span>) getpid());<br><br>        <span class="hljs-type">char</span> *myargs[<span class="hljs-number">3</span>];<br>        myargs[<span class="hljs-number">0</span>] = strdup(<span class="hljs-string">&quot;wc&quot;</span>);       <span class="hljs-comment">// å‘½ä»¤åï¼š&quot;wc&quot;ï¼ˆå•è¯è®¡æ•°ç¨‹åºï¼‰</span><br>        myargs[<span class="hljs-number">1</span>] = strdup(<span class="hljs-string">&quot;p3.c&quot;</span>);     <span class="hljs-comment">// å‚æ•°ï¼šæ–‡ä»¶å &quot;p3.c&quot;</span><br>        myargs[<span class="hljs-number">2</span>] = <span class="hljs-literal">NULL</span>;               <span class="hljs-comment">// å‚æ•°æ•°ç»„ç»“æŸæ ‡å¿—</span><br><br>        execvp(myargs[<span class="hljs-number">0</span>], myargs);      <span class="hljs-comment">// æ‰§è¡Œ wc å‘½ä»¤ï¼Œç»Ÿè®¡ p3.c æ–‡ä»¶çš„è¡Œ/è¯/å­—èŠ‚æ•°</span><br><br>        <span class="hljs-comment">// å¦‚æœ execvp æ‰§è¡Œå¤±è´¥ï¼Œæ‰ä¼šæ‰§è¡Œä¸‹é¢è¿™ä¸€è¡Œ</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;this shouldn&#x27;t print out\n&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// çˆ¶è¿›ç¨‹æ‰§è¡Œ</span><br>        <span class="hljs-type">int</span> wc = wait(<span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, I am parent of %d (wc:%d) (pid:%d)\n&quot;</span>, rc, wc, (<span class="hljs-type">int</span>) getpid());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»™å®šå‚æ•°<code>myargs[0], myargs</code>åï¼Œç›´æ¥å°†å½“å‰çš„å­è¿›ç¨‹æ›¿æ¢ä¸ºç»™å®šçš„è¿è¡Œç¨‹åºï¼Œåœ¨è¿™é‡Œæ˜¯<code>wc</code>ï¼›å­è¿›ç¨‹åœ¨æ‰§è¡Œè¯¥<code>exec()</code>ä¹‹åï¼Œä¸ä¼šè¿”å›ç»“æœã€‚</p><h3 id="åº”ç”¨shell">åº”ç”¨ï¼šshell</h3><p>shellæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç”¨æˆ·ç¨‹åºï¼Œå’Œä¸Šé¢å®ä¾‹ä¸­çš„çˆ¶è¿›ç¨‹ä¸€æ ·ã€‚å½“æˆ‘ä»¬å‘shellè¾“å…¥å‘½ä»¤çš„æ—¶å€™ï¼Œshellä¼šä»æ–‡ä»¶ä¸­æ‰¾åˆ°éœ€è¦çš„ç¨‹åºï¼Œå¹¶ä¸”<code>fork</code>ä¸€ä¸ªå­è¿›ç¨‹å‡ºæ¥ï¼Œå­è¿›ç¨‹è°ƒç”¨<code>exec()</code>æ¥å…·ä½“åœ°æ‰§è¡Œæˆ‘ä»¬ä¼ å…¥çš„å‘½ä»¤ï¼ŒåŒæ—¶shellä¹Ÿä¼šè°ƒç”¨<code>wait</code>ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæˆã€‚å­è¿›ç¨‹ç»“æŸä»¥åï¼Œshell ä¼šæ‰“å°è¿”å›å€¼å¹¶å†æ¬¡è¾“å‡ºæç¤ºç¬¦ï¼Œæç¤ºç”¨æˆ·ç»§ç»­è¾“å…¥ä¸‹ä¸€æ¡å‘½ä»¤ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æè¿°äº†<strong>è¾“å‡ºé‡å®šå‘çš„å®ç°åŸç†</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>      <span class="hljs-comment">// æ ‡å‡†è¾“å…¥è¾“å‡º</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span>     <span class="hljs-comment">// exit()</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span>     <span class="hljs-comment">// fork(), execvp(), close()</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span>     <span class="hljs-comment">// strdup()</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span>      <span class="hljs-comment">// open() çš„æ–‡ä»¶æ§åˆ¶é€‰é¡¹</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span>   <span class="hljs-comment">// wait()</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> <br>&#123;<br>    <span class="hljs-type">int</span> rc = fork(); <span class="hljs-comment">// åˆ›å»ºå­è¿›ç¨‹</span><br><br>    <span class="hljs-keyword">if</span> (rc &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// fork å¤±è´¥</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fork failed\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rc == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å­è¿›ç¨‹ï¼šå°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶</span><br>        close(STDOUT_FILENO); <span class="hljs-comment">// å…³é—­æ ‡å‡†è¾“å‡ºï¼ˆæ–‡ä»¶æè¿°ç¬¦1ï¼‰</span><br>        open(<span class="hljs-string">&quot;./p4.output&quot;</span>, O_CREAT | O_WRONLY | O_TRUNC, S_IRWXU);<br>        <span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶ä½œä¸ºæ–°çš„æ ‡å‡†è¾“å‡ºï¼ˆæ–‡ä»¶æè¿°ç¬¦å°†æ˜¯ 1ï¼‰</span><br><br>        <span class="hljs-comment">// æ‰§è¡Œ wc å‘½ä»¤ï¼Œç»Ÿè®¡ p4.c æ–‡ä»¶çš„è¡Œã€è¯ã€å­—èŠ‚æ•°</span><br>        <span class="hljs-type">char</span> *myargs[<span class="hljs-number">3</span>];<br>        myargs[<span class="hljs-number">0</span>] = strdup(<span class="hljs-string">&quot;wc&quot;</span>);     <span class="hljs-comment">// å‘½ä»¤å</span><br>        myargs[<span class="hljs-number">1</span>] = strdup(<span class="hljs-string">&quot;p4.c&quot;</span>);   <span class="hljs-comment">// å‚æ•°ï¼šæ–‡ä»¶å</span><br>        myargs[<span class="hljs-number">2</span>] = <span class="hljs-literal">NULL</span>;             <span class="hljs-comment">// å‚æ•°æ•°ç»„ç»“æŸæ ‡å¿—NULL</span><br><br>        execvp(myargs[<span class="hljs-number">0</span>], myargs);   <span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// çˆ¶è¿›ç¨‹ï¼šç­‰å¾…å­è¿›ç¨‹å®Œæˆ</span><br>        <span class="hljs-type">int</span> wc = wait(<span class="hljs-literal">NULL</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ç›¸å½“äºç›´æ¥åœ¨shellè¾“å…¥<code>wc p4.c &gt; ./p4.output</code>ï¼Œè§£é‡Šï¼š</p><ul><li><code>STDOUT_FILENO</code>æ˜¯åœ¨<code>&lt;unistd.h&gt;</code>ä¸­å®šä¹‰çš„å®å¸¸é‡ï¼Œæ•°å€¼ä¸º0ï¼Œä»£è¡¨<strong>æ ‡å‡†è¾“å‡º</strong>ï¼Œç±»ä¼¼çš„è¿˜æœ‰ï¼š<ul><li><code>STDIN_FILENO</code>ï¼šæ ‡å‡†è¾“å…¥ï¼Œæ•°å€¼ = 1</li><li><code>STDERR_FILENO</code>ï¼šæ ‡å‡†é”™è¯¯ï¼Œæ•°å€¼ = 2</li></ul></li><li>è¿è¡Œè¯¥ç¨‹åºåï¼Œæ§åˆ¶å°å¹¶æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œå®é™…ä¸Šçˆ¶è¿›ç¨‹å…ˆ forkäº†ä¸€ä¸ªå­è¿›ç¨‹æ¥è´Ÿè´£å°†è¿è¡Œç»“æœé‡æ–°å†™å…¥æŒ‡å®šçš„æ–‡ä»¶<code>./p4.output</code>ï¼Œå¹¶ä¸”å­è¿›ç¨‹ä¸€ä¸Šæ¥å°±å…³æ‰äº†æ ‡å‡†è¾“å‡ºï¼Œè€Œæ˜¯<code>open</code>ç›®æ ‡æ–‡ä»¶ä½œä¸ºæ–°çš„æ ‡å‡†è¾“å‡ºï¼Œæ‰€ä»¥shellä¸­çœ‹ä¸åˆ°ä»»ä½•æ‰“å°çš„ä¿¡æ¯ã€‚</li></ul><p>ç®¡é“ç¬¦<code>|</code>çš„å®ç°åŸç†ä¹Ÿç±»ä¼¼ï¼Œä½†æ˜¯è¿™æ—¶å€™ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºé€šè¿‡ä¸€ä¸ªç®¡é“ç›´æ¥è¿æ¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå®ç°æ— ç¼è¿æ¥ã€‚</p><h1 id="äºŒè™šæ‹ŸåŒ–cpu">äºŒã€è™šæ‹ŸåŒ–CPU</h1><p>è™šæ‹ŸåŒ–CPUå­˜åœ¨ä¸¤ä¸ªæŒ‘æˆ˜ï¼š</p><ul><li>æ€§èƒ½ï¼Œå°½å¯èƒ½åœ°æé«˜è¿è¡Œæ•ˆç‡</li><li>æ§åˆ¶æƒï¼Œé˜²æ­¢ç¨‹åºå±å®³ç³»ç»Ÿ</li></ul><h2 id="å—é™ç›´æ¥æ‰§è¡Œlimited-direct-execution">å—é™ç›´æ¥æ‰§è¡Œï¼ˆlimiteddirect executionï¼‰</h2><p>å—é™ç›´æ¥æ‰§è¡Œçš„ç›®çš„å°±æ˜¯é™åˆ¶ç¨‹åºçš„æƒé™ï¼Œå› ä¸ºæ¯ä¸ªç¨‹åºéƒ½ä¼šæœ‰éœ€è¦è°ƒç”¨å†…æ ¸æƒé™çš„æƒ…å†µï¼Œæ¯”å¦‚ç¡¬ç›˜IOæ“ä½œï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œå¾ˆå¯èƒ½ä¼šå±å®³ç³»ç»Ÿã€‚</p><h3 id="ç›´æ¥è¿è¡Œåè®®">ç›´æ¥è¿è¡Œåè®®</h3><p>å½“æ“ä½œç³»ç»Ÿå¸Œæœ›å¯åŠ¨ç¨‹åºæ—¶ï¼Œä¼šåšä»¥ä¸‹æ­¥éª¤ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/23/pVGWVzR.png"alt="ç®€å•ï¼Œä½†æ˜¯æœ‰é—®é¢˜" /><figcaption aria-hidden="true">ç®€å•ï¼Œä½†æ˜¯æœ‰é—®é¢˜</figcaption></figure><p>æœ‰ä¸¤ä¸ªä»å¾…è§£å†³çš„é—®é¢˜ï¼š</p><ol type="1"><li>å¦‚ä½•æ§åˆ¶ç¨‹åºçš„æƒé™</li><li>å¦‚ä½•åˆ‡æ¢è¿›ç¨‹ï¼Œä»¥å®ç°CPUè™šæ‹ŸåŒ–</li></ol><h3 id="å—é™çš„æ§åˆ¶æƒ">å—é™çš„æ§åˆ¶æƒ</h3><p>ç¡¬ä»¶å±‚é¢æä¾›äº†å¤šç§ä¸åŒçš„æ‰§è¡Œæ¨¡å¼ï¼Œå…·æœ‰ä¸åŒçš„æƒé™ï¼š</p><ul><li><strong>ç”¨æˆ·æ¨¡å¼</strong>(usermode)ï¼šç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œç¨‹åºä¸èƒ½å®Œå…¨è®¿é—®ç¡¬ä»¶èµ„æºï¼Œä¾‹å¦‚ä¸èƒ½å‘å‡ºIOè¯·æ±‚</li><li><strong>å†…æ ¸æ¨¡å¼</strong>(kernelmode)ï¼šæ“ä½œç³»ç»Ÿå°±è¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ï¼Œå…·æœ‰æœ€é«˜çš„æƒé™</li><li>å¦‚æœç”¨æˆ·ä¹Ÿéœ€è¦æ‰§è¡ŒæŸäº›ç‰¹æƒæ“ä½œï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰ï¼šç¨‹åºæ‰§è¡Œ<strong>é™·é˜±ï¼ˆtrapï¼‰æŒ‡ä»¤</strong>ï¼Œè¯¥æŒ‡ä»¤è¿›å…¥å†…æ ¸ï¼Œ<strong>è·å¾—å†…æ ¸æ¨¡å¼çš„æƒé™</strong>ï¼Œå®Œæˆæ“ä½œåæ“ä½œç³»ç»Ÿè°ƒç”¨<strong>ä»é™·é˜±è¿”å›ï¼ˆreturn-from-trapï¼‰æŒ‡ä»¤</strong>ï¼Œè¯¥æŒ‡ä»¤è¿”å›åˆ°ç”¨æˆ·ç¨‹åºï¼Œå›åˆ°ç”¨æˆ·æ¨¡å¼</li><li>å†…æ ¸åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè®¾ç½®ä¸€ä¸ªå«åš<strong>é™·é˜±è¡¨</strong>ï¼ˆtraptableï¼‰çš„ä¸œè¥¿ï¼Œå‘Šè¯‰ç¡¬ä»¶åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™éœ€è¦æ‰§è¡Œå“ªäº›ä»£ç ï¼Œç„¶åç¡¬ä»¶å°±ä¼šè®°ä½è¿™äº›ä½ç½®ï¼Œäºæ˜¯ç¡¬ä»¶å°±ä¼šçŸ¥é“å‘ç”Ÿç³»ç»Ÿè°ƒç”¨å’Œå¼‚å¸¸æ—¶éœ€è¦è·³è½¬åˆ°å“ªäº›ä½ç½®</li></ul><p><strong>ä¸ºä»€ä¹ˆå«â€œé™·é˜±â€æŒ‡ä»¤</strong>ï¼Ÿå› ä¸ºç¨‹åºéœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æ‰éƒ½éœ€è¦é™·å…¥å†…æ ¸ä¸­ï¼Œç”±å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œï¼Œç„¶åå†æµ®å‡ºæ¥ã€‚</p><p>å—é™çš„ç›´æ¥è¿è¡Œåè®®çš„å…¨è¿‡ç¨‹å¦‚å›¾ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/23/pVGWIfJ.png" alt="LDEåè®®" /><figcaption aria-hidden="true">LDEåè®®</figcaption></figure><h3 id="åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢">åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢</h3><p>å…³é”®ï¼šè¿›ç¨‹æ˜¯åœ¨CPUä¸Šè¿è¡Œçš„ï¼Œæ§åˆ¶æƒåœ¨è¿›ç¨‹æ‰‹é‡Œï¼Œæƒ³è¦åˆ‡æ¢è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»é‡æ–°æ‹¿åˆ°CPUçš„æ§åˆ¶æƒã€‚ä¸ºäº†å®ç°è¿›ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼šåä½œæ–¹å¼å’Œéåä½œæ–¹å¼ã€‚</p><h4 id="åä½œæ–¹å¼">åä½œæ–¹å¼</h4><p>è¿™æ˜¯ä¸€ç§ä¹è§‚çš„æ€è·¯ï¼Œå®ƒå‡å®šæ‰€æœ‰è¿›ç¨‹éƒ½ä¼šåˆç†åœ°<strong>ä¸»åŠ¨è®©å‡ºCPUåœ°æ§åˆ¶æƒ</strong>ã€‚</p><p>å”¯ä¸€çš„ä¾‹å¤–æ˜¯éæ³•æ“ä½œï¼Œå¦‚æœå‘ç”Ÿéæ³•æ“ä½œï¼Œè¿™æ—¶CPUçš„æ§åˆ¶æƒä¹Ÿä¼šè½¬ç§»ç»™æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œéæ³•æ´»åŠ¨çš„è¿›ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿç›´æ¥ç»ˆæ­¢ã€‚</p><p>ä½†æ˜¯åä½œæ–¹å¼å­˜åœ¨ä¸€ä¸ª<strong>ç¼ºé™·</strong>ï¼šå¦‚æœæŸä¸ªç¨‹åºå› ä¸ºè‡ªèº«åŸå› é™·å…¥äº†æ­»å¾ªç¯ï¼Œæ—¢æ²¡æœ‰æ‰§è¡Œéæ³•æ“ä½œä¹Ÿä¸ä¼šè®©å‡ºæ§åˆ¶æƒï¼Œæ€ä¹ˆåŠï¼Ÿæ‰€ä»¥æ›´ä¸ºé€šç”¨çš„æ˜¯éåä½œæ–¹å¼ï¼š</p><h4 id="éåä½œæ–¹å¼">éåä½œæ–¹å¼</h4><p><strong>æ—¶é’Ÿä¸­æ–­</strong></p><p>ç¡¬ä»¶åŠŸèƒ½â€”â€”æ—¶é’Ÿä¸­æ–­ï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹æ§åˆ¶æ—¶é’Ÿä¸­æ–­äº§ç”Ÿçš„å‘¨æœŸã€‚äº§ç”Ÿä¸­æ–­æ—¶ï¼Œ<strong>ä¸­æ–­å¤„ç†ç¨‹åº</strong>ï¼ˆinterrupthandlerï¼‰ä¼šè¢«è¿è¡Œï¼Œ<strong>æ§åˆ¶æƒè¿”è¿˜ç»™æ“ä½œç³»ç»Ÿ</strong>ã€‚ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œç¡¬ä»¶ä¹Ÿè¦æŠŠå„ç§å¯„å­˜å™¨ä¿å­˜åœ¨å†…æ ¸æ ˆï¼Œå’Œä¸»åŠ¨ç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µç±»ä¼¼ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œä¸€æ—¦æ—¶é’Ÿå¼€å§‹è¿è¡Œï¼Œæ“ä½œç³»ç»Ÿå°±ä¸ç”¨å†æ‹…å¿ƒæ§åˆ¶æƒå›ä¸åˆ°è‡ªå·±æ‰‹ä¸­äº†ã€‚</p><h4 id="ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡">ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡</h4><p><strong>è°ƒåº¦ç¨‹åºï¼šscheduler</strong>ï¼Œå®ƒå±äºæ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</p><p>è°ƒåº¦ç¨‹åºçš„ä½œç”¨ï¼šå†³å®šæ“ä½œç³»ç»Ÿæ‹¿åˆ°æ§åˆ¶æƒä»¥åæ˜¯ç»§ç»­è¿è¡Œå½“å‰è¿›ç¨‹è¿˜æ˜¯åˆ‡æ¢è¿›ç¨‹ã€‚</p><p>åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶éœ€è¦ä¿å­˜åŸçº¿ç¨‹çš„ï¼š</p><ul><li>é€šç”¨å¯„å­˜å™¨</li><li>ç¨‹åºè®¡æ•°å™¨</li><li>å½“å‰è¿›ç¨‹çš„å†…æ ¸æ ˆæŒ‡é’ˆ</li></ul><p>åŒæ—¶æ¢å¤æ–°è¿›ç¨‹çš„é€šç”¨å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€æ–°è¿›ç¨‹çš„å†…æ ¸æŒ‡é’ˆã€‚</p><hr /><p>Aè¿›ç¨‹åˆ‡æ¢åˆ°Bè¿›ç¨‹çš„å…·ä½“è¿‡ç¨‹ï¼š</p><ol type="1"><li>æ—¶é’Ÿä¸­æ–­ï¼ˆæˆ–è€…æ˜¯åˆ«çš„ï¼‰æ“ä½œç³»ç»Ÿè·å¾—CPUçš„æ§åˆ¶æƒ</li><li>å°†Aè¿›ç¨‹çš„å¯„å­˜å™¨ä¿å­˜åˆ°Açš„å†…æ ¸æ ˆ</li><li>å¯ç”¨å†…æ ¸æ¨¡å¼ï¼Œè·³åˆ°é™·é˜±å¤„ç†ç¨‹åº</li><li>å°†Açš„å¯„å­˜å™¨å€¼ä¿å­˜åˆ°Açš„è¿›ç¨‹ç»“æ„ï¼Œæ¢å¤Bçš„è¿›ç¨‹ç»“æ„</li><li>ä»é™·é˜±è¿”å›</li><li>ä»å†…æ ¸æ ˆæ¢å¤Bçš„å¯„å­˜å™¨ï¼Œè¿›å…¥ç”¨æˆ·æ¨¡å¼ï¼Œè·³åˆ°Bçš„ç¨‹åºè®¡æ•°å™¨</li><li>è¿›ç¨‹Bå¼€å§‹è¿è¡Œ</li></ol><h1id="ä¸‰è¿›ç¨‹è°ƒåº¦ä¸€å•å¤„ç†å™¨è¿›ç¨‹è°ƒåº¦">ä¸‰ã€è¿›ç¨‹è°ƒåº¦ï¼ˆä¸€ï¼‰å•å¤„ç†å™¨è¿›ç¨‹è°ƒåº¦</h1><h3 id="æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆsjf">æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆSJF</h3><p>Shortest Job First</p><p>è¿™æ˜¯ä¸€ç§éæŠ¢å å¼çš„ç­–ç•¥ï¼Œ<strong>å…ˆè¿è¡Œè€—æ—¶æœ€çŸ­çš„ä»»åŠ¡ï¼Œå†è¿è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡</strong></p><blockquote><p>è¡¥å……ä¸€ä¸ªæ¦‚å¿µï¼š<strong>æŠ¢å å¼</strong>ï¼ŒæŒ‡çš„æ˜¯æ“ä½œç³»ç»Ÿå¯ä»¥å¼ºåˆ¶ä¸­æ–­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œå¹¶æŠŠCPU åˆ†é…ç»™å¦ä¸€ä¸ªæ›´â€œåˆé€‚â€çš„è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚</p></blockquote><h3 id="æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆstcf">æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆSTCF</h3><p>æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆï¼ˆShortest Time-to-CompletionFirstï¼Œ<strong>STCF</strong>ï¼‰æˆ–æŠ¢å å¼æœ€çŸ­ä½œä¸šä¼˜å…ˆï¼ˆPreemptive ShortestJob First ï¼ŒPSJFï¼‰è°ƒåº¦ç¨‹åº</p><p>å«ä¹‰ï¼šæ¯å½“æ–°å·¥ä½œè¿›å…¥ç³»ç»Ÿæ—¶ï¼Œå®ƒå°±ä¼šç¡®å®šå‰©ä½™å·¥ä½œå’Œæ–°å·¥ä½œä¸­ï¼Œè°çš„å‰©ä½™æ—¶é—´<strong>æœ€å°‘</strong>ï¼Œç„¶åè°ƒåº¦è¯¥å·¥ä½œ</p><div class="note note-info">            <p><strong>å“åº”æ—¶é—´</strong>å®šä¹‰ä¸ºä»ä»»åŠ¡åˆ°è¾¾ç³»ç»Ÿåˆ°é¦–æ¬¡è¿è¡Œçš„æ—¶é—´ï¼Œä»¥STCFä¸ºä¾‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/24/pVG7pUx.png" /></p><p>Aå’ŒBçš„å“åº”æ—¶é—´éƒ½æ˜¯0ï¼ŒCçš„å“åº”æ—¶é—´æ˜¯10</p><p><strong>å‘¨è½¬æ—¶é—´</strong>åˆ™æŒ‡çš„æ˜¯ä»»åŠ¡ä»åˆ°è¾¾ï¼Œåˆ°å½»åº•å®Œæˆçš„æ—¶é—´ã€‚ä¸Šé¢è¿™ä¸ªä¾‹å­çš„æ€»å‘¨è½¬æ—¶é—´ä¸º120ã€‚STCFå¯ä»¥é™ä½å‘¨è½¬æ—¶é—´ï¼Œä½†æ˜¯ç‰ºç‰²äº†å“åº”æ—¶é—´ã€‚</p>          </div><p>STCFçš„å“åº”æ—¶é—´ä¸æ˜¯å¾ˆå¥½ï¼Œä¸ºäº†æ”¹å–„å“åº”æ—¶é—´ï¼Œæå‡ºäº†<strong>è½®è½¬</strong>ï¼ˆRound-Robinï¼‰è°ƒåº¦ã€‚</p><h3 id="è½®è½¬rr">è½®è½¬(RR)</h3><p>åŸºæœ¬å«ä¹‰ï¼š<strong>åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…è¿è¡Œä¸€ä¸ªä»»åŠ¡åé©¬ä¸Šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼ˆè€Œä¸ç”¨ç­‰å¾…ä»»åŠ¡ç»“æŸï¼‰ï¼Œè¿™æ ·äº¤æ›¿è¿›è¡Œ</strong>ã€‚äº¤æ›¿å‘¨æœŸæ˜¯æ—¶é’Ÿå‘¨æœŸçš„æ•´æ•°å€ã€‚</p><figure><img src="https://s21.ax1x.com/2025/07/24/pVG7kxe.png"alt="SJFå’Œè½®è½¬çš„å¯¹æ¯”ï¼Œæ—¶é—´ç‰‡ä¸º1s" /><figcaption aria-hidden="true">SJFå’Œè½®è½¬çš„å¯¹æ¯”ï¼Œæ—¶é—´ç‰‡ä¸º1s</figcaption></figure><p>æ—¶é—´ç‰‡çš„é€‰æ‹©ï¼šæŠ˜ä¸­ï¼Œå› ä¸º</p><ul><li>æ—¶é—´ç‰‡å¤ªçŸ­ä¼šå¯¼è‡´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬ä¸Šå‡</li><li>æ—¶é—´ç‰‡å¤ªé•¿ä¼šå¯¼è‡´å“åº”æ—¶é—´å˜æ…¢</li></ul><p>è½®è½¬è°ƒåº¦å¯¹äºå‘¨è½¬æ—¶é—´å¾ˆä¸å‹å¥½ï¼Œæ¯•ç«Ÿè½®è½¬çš„ç›®çš„æ­£æ˜¯<strong>å‡æ‘Š</strong>æ¯ä¸ªä»»åŠ¡çš„æ—¶é—´ã€‚è½®è½¬æ˜¯ä¸€ç§<strong>å…¬å¹³</strong>çš„æ”¿ç­–ï¼Œå…¬å¹³çš„æ”¿ç­–å¾€å¾€è¦ä»¥å‘¨è½¬æ—¶é—´ä¸ºä»£ä»·ï¼Œæ¢å–å“åº”æ—¶é—´ã€‚å‘¨è½¬æ—¶é—´å’Œå“åº”æ—¶é—´ä¸å¯å…¼å¾—ã€‚</p><hr /><p>ä»¥ä¸Šçš„æ‰€æœ‰è®¨è®ºéƒ½æ˜¯å»ºç«‹åœ¨<strong>ä»»åŠ¡æ²¡æœ‰IOæ“ä½œ</strong>ã€ä¸”<strong>æ¯ä¸ªä»»åŠ¡çš„è¿è¡Œæ—¶é—´éƒ½æ˜¯å·²çŸ¥çš„</strong>åŸºç¡€ä¸Šã€‚ä¸‹é¢ä¸“é—¨æ¥è®¨è®ºè¿™ä¸¤ä¸ªæ¡ä»¶ï¼š</p><h3 id="ioæ“ä½œ">IOæ“ä½œ</h3><ul><li>å‘èµ·IOæŒ‡ä»¤çš„ç¨‹åºï¼Œåœ¨ç»“æœè¿”å›ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œåªæ˜¯<strong>é˜»å¡</strong>åœ°ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚åœ¨æ­¤æœŸé—´CPUåº”å½“å»æ‰§è¡Œåˆ«çš„ä»»åŠ¡ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…ç©ºé—²ã€‚</li><li>IOå®Œæˆæ—¶ä¼šè§¦å‘<strong>ä¸­æ–­</strong>ï¼ŒCPUå¯ä»¥å°†é˜»å¡çš„è¿›ç¨‹è½¬ç§»åˆ°å°±ç»ªçŠ¶æ€ã€‚</li></ul><p>é«˜æ•ˆä½¿ç”¨CPUçš„ä¾‹å­ï¼šAä¸€å…±è¦æ‰§è¡Œ4ä¸ªIOæ“ä½œï¼ŒBæ˜¯çº¯ç²¹çš„CPUå¯†é›†å‹ä»»åŠ¡ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/24/pVG7ssJ.png" /></p><p>äº¤æ›¿æ‰§è¡Œå¯ä»¥æœ€å¤§åŒ–CPUçš„åˆ©ç”¨ã€‚</p><h2 id="å¤šçº§åé¦ˆé˜Ÿåˆ—mlfqè°ƒåº¦">å¤šçº§åé¦ˆé˜Ÿåˆ—MLFQè°ƒåº¦</h2><p>å¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆMulti-level Feedback Queueï¼ŒMLFQï¼‰</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼Œåœ¨ä¸çŸ¥é“è¿›ç¨‹çš„è¿è¡Œæ—¶é—´çš„æƒ…å†µä¸‹ï¼Œæ„å»ºå‡ºä¸€ä¸ªè‰¯å¥½çš„è°ƒåº¦ç¨‹åºï¼›è°ƒåº¦ç¨‹åºåœ¨è¿è¡Œæ—¶å¯ä»¥å­¦ä¹ è¿›ç¨‹çš„ç‰¹å¾ï¼Œä»è€Œåšå‡ºæ›´å¥½çš„å†³ç­–ã€‚<strong>ç”¨å†å²ç»éªŒé¢„æµ‹æœªæ¥</strong>ã€‚</p><h3 id="åŸºæœ¬è§„åˆ™">åŸºæœ¬è§„åˆ™</h3><ul><li>MLFQä¸­æœ‰å¾ˆå¤šé˜Ÿåˆ—ï¼Œ<strong>æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸åŒçš„ä¼˜å…ˆçº§</strong>ï¼ŒMLFQ1ä¼˜å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„å·¥ä½œ</li><li>åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å·¥ä½œé‡‡ç”¨è½®è½¬è°ƒåº¦å¤„ç†</li></ul><p>å¯¹CPUå ç”¨æ—¶é—´è¶ŠçŸ­çš„è¿›ç¨‹ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼›CPUå ç”¨æ—¶é—´è¶Šé•¿ï¼Œä¼˜å…ˆçº§è¶Šä½ã€‚MLFQæœ‰ä¸¤æ¡åŸºæœ¬è§„åˆ™ï¼š</p><blockquote><ol type="1"><li>å¦‚æœ A çš„ä¼˜å…ˆçº§ &gt; B çš„ä¼˜å…ˆçº§ï¼Œè¿è¡ŒA</li><li>å¦‚æœ A çš„ä¼˜å…ˆçº§ = B çš„ä¼˜å…ˆçº§ï¼Œè½®è½¬è¿è¡Œ A å’Œ B</li></ol></blockquote><h3 id="ä¼˜å…ˆçº§è°ƒæ•´ç®—æ³•">ä¼˜å…ˆçº§è°ƒæ•´ç®—æ³•</h3><p>ä¸åŒçš„å·¥ä½œä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ol type="1"><li>è¿è¡Œæ—¶é—´çŸ­ï¼Œé¢‘ç¹æ”¾å¼ƒCPUçš„äº¤äº’å‹å·¥ä½œï¼Œæ¯”å¦‚é”®ç›˜è¾“å…¥</li><li>è¿è¡Œæ—¶é—´é•¿ï¼Œå ç”¨CPUæ—¶é—´é•¿ï¼Œå“åº”æ—¶é—´ä¸é‡è¦çš„è®¡ç®—å¯†é›†å‹å·¥ä½œ</li></ol><p>ä¼˜å…ˆçº§è°ƒæ•´ç®—æ³•ï¼š</p><blockquote><p>å·¥ä½œåˆæ¬¡è¿›å…¥ç³»ç»Ÿï¼Œå…ˆæŠŠå®ƒæ”¾åˆ°æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼š -æ¯å½“åˆ†ç»™å·¥ä½œçš„æ•´ä¸ªæ—¶é—´ç‰‡è¢«ç”¨å®Œï¼Œå°±é™ä½å®ƒçš„ä¼˜å…ˆçº§ -æ¯å½“åœ¨æ—¶é—´ç‰‡å†…å°±é‡Šæ”¾äº†CPUï¼Œé‚£ä¹ˆä¿æŒå½“å‰ä¼˜å…ˆçº§ä¸å˜</p></blockquote><p>è¿™æ ·ä¸€æ¥ï¼ŒCPUè®¡ç®—å¯†é›†å‹å·¥ä½œçš„ä¼˜å…ˆçº§ä¼šé€æ¬¡é€’å‡ï¼Œç›´è‡³æœ€ä½ä¼˜å…ˆçº§ã€‚å¦‚æœæ­¤æ—¶æ¥äº†ä¸€ä¸ªäº¤äº’å‹å·¥ä½œï¼Œå› ä¸ºåˆå§‹ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œæ‰€ä»¥ä¼˜å…ˆæ‰§è¡Œäº¤äº’å‹å·¥ä½œï¼Œå¹¶ä¸”å¾ˆå¿«å°±æ‰§è¡Œå®Œæ¯•ã€‚å¯è§ï¼Œ<strong>MLFQå…·æœ‰SJF çš„ä¼˜ç‚¹</strong>ã€‚</p><p>æ··åˆIOå·¥ä½œä¹Ÿæ˜¯åŒç†ï¼ŒCPUå ç”¨æ—¶é—´è¾ƒçŸ­æ‰€ä»¥ä¸€ç›´ç»´æŒåœ¨é«˜ä¼˜å…ˆçº§ï¼Œä¸€æ—¦æ‰§è¡ŒIOè®©å‡ºCPUå°±ä¼šæŠŠæ§åˆ¶æƒäº¤ç»™ä½ä¼˜å…ˆçº§çš„è®¡ç®—å¯†é›†å‹å·¥ä½œï¼Œå¾ªç¯å¾€å¤ã€‚</p><p><img src="https://s21.ax1x.com/2025/07/24/pVGbu38.png" /></p><h3 id="é¥¥é¥¿é—®é¢˜è‡ªåŠ¨æå‡ä¼˜å…ˆçº§">â€œé¥¥é¥¿â€é—®é¢˜â€”â€”è‡ªåŠ¨æå‡ä¼˜å…ˆçº§</h3><p>äº¤äº’å‹å·¥ä½œå¤ªå¤šçš„æƒ…å†µä¸‹ï¼Œä¼šæŒç»­å ç”¨CPUï¼Œä¸ç»™ä½ä¼˜å…ˆçº§ä»»åŠ¡è¿è¡Œçš„æœºä¼šï¼Œç§°ä¹‹ä¸º<strong>é¥¥é¥¿</strong>ï¼›å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæŸäº›è¿›ç¨‹ä½¿ç‚¹å°èŠ±æ‹›ï¼Œæ¯”å¦‚åœ¨è‡ªå·±çš„æ—¶é—´ç‰‡å¿«ç”¨å®Œä¹‹å‰ä¸»åŠ¨è°ƒç”¨IOæ“ä½œï¼Œè¿™æ ·å°±èƒ½ä¸€ç›´ç»´æŒè‡ªå·±çš„é«˜ä¼˜å…ˆçº§ï¼Œå³ä½¿è‡ªå·±å…¶å®æ˜¯é•¿æ—¶é—´çš„ä»»åŠ¡ã€‚ä»¥ä¸Šç§ç§å‡è¡¨æ˜ï¼Œç›®å‰çš„MLFQ ç®—æ³•ä»ç„¶æ˜¯æœ‰ç¼ºé™·çš„ã€‚</p><p>é¦–å…ˆï¼Œä¸ºäº†é˜²æ­¢é¥¥é¥¿ç°è±¡ï¼š</p><blockquote><ul><li>æ¯ç»è¿‡ä¸€æ®µæ—¶é—´ Sï¼Œå°±æŠŠç³»ç»Ÿä¸­çš„æ‰€æœ‰å·¥ä½œé‡æ–°åŠ å…¥æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—</li></ul></blockquote><p>ç¼ºé™·ï¼šSçš„å€¼ä¸å¥½æŠŠæ§ã€‚</p><p>å…¶æ¬¡ï¼Œé˜²æ­¢ç¨‹åºè€èŠ±æ‹›çš„æ–¹å¼ï¼š</p><blockquote><p>ä¸€æ—¦ä»»åŠ¡ç”¨å®Œäº†åœ¨<strong>æŸä¸€å±‚</strong>ä¸­è¢«åˆ†é…çš„æ—¶é—´ï¼ˆä¸ç®¡ä¸­é€”æ”¾å¼ƒäº†å¤šå°‘æ¬¡æ§åˆ¶æƒï¼‰ï¼Œå°±é™ä½å®ƒçš„ä¼˜å…ˆçº§</p></blockquote><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°MLFQéƒ½æ”¯æŒä¸åŒé˜Ÿåˆ—å…·æœ‰ä¸åŒçš„æ—¶é—´ç‰‡é•¿åº¦ã€‚æœ‰çš„é‡‡ç”¨æ—¶åˆ†è°ƒåº¦ç¨‹åºï¼Œä¹Ÿæœ‰çš„é‡‡ç”¨æ•°å­¦å…¬å¼è°ƒæ•´ä¼˜å…ˆçº§ã€‚</p><h2 id="æ¯”ä¾‹ä»½é¢è°ƒåº¦">æ¯”ä¾‹ä»½é¢è°ƒåº¦</h2><p>æ¯”ä¾‹ä»½é¢ï¼ˆproportional-shareï¼‰æ˜¯ä¸€ç§ä¸åŒäºMLFQçš„è°ƒåº¦ç¨‹åºï¼Œä¹Ÿè¢«ç§°ä¸ºå…¬å¹³ä»½é¢ï¼ˆfair-shareï¼‰ã€‚ç›®æ ‡ï¼š<strong>ç¡®ä¿æ¯ä¸ªå·¥ä½œéƒ½èƒ½è·å¾—ä¸€å®šæ¯”ä¾‹çš„CPUæ—¶é—´</strong>ã€‚æ¯”ä¾‹ä»½é¢ç®—æ³•åœ¨å®¹æ˜“ç¡®å®šæ¯”ä¾‹çš„æƒ…å†µä¸‹æ¯”è¾ƒå®ç”¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3><p>æ¯ä¸ªè¿›ç¨‹æŒæœ‰ä¸€å®šæ•°é‡çš„â€œå½©ç¥¨(ticket)â€ï¼Œæ¯”å¦‚è¿›ç¨‹AæŒæœ‰1åˆ°75ï¼ŒBè¿›ç¨‹æŒæœ‰76åˆ°100ï¼Œé‚£ä¹ˆè°ƒåº¦ç¨‹åºä¸æ–­å®šæ—¶åœ°æŠ½å–æ•°å­—ï¼Œæ•°å­—ä½äºå“ªä¸ªèŒƒå›´å°±æ‰§è¡Œå“ªä¸ªè¿›ç¨‹ã€‚</p><h3 id="å®ç°å½©ç¥¨è°ƒåº¦ç®—æ³•">å®ç°å½©ç¥¨è°ƒåº¦ç®—æ³•</h3><p>åªéœ€è¦è¿™å‡ æ ·ä¸œè¥¿ï¼š</p><ul><li>éšæœºæ•°ç”Ÿæˆå™¨</li><li>å•å‘é“¾è¡¨ï¼Œç”¨äºè®°å½•æ‰€æœ‰çš„è¿›ç¨‹</li><li>ç¥¨çš„æ€»æ•°</li></ul><p>æ¯ä¸ªè¿›ç¨‹ï¼ˆæˆ–ç§°ä½œä»»åŠ¡/jobï¼‰éƒ½æœ‰ä¸€ä¸ª<code>tickets</code>å­—æ®µï¼Œä»£è¡¨å®ƒæ‹¥æœ‰çš„â€œå½©ç¥¨ç¥¨æ•°â€ã€‚ç³»ç»Ÿä¼šä»0åˆ°æ€»ç¥¨æ•°ä¹‹é—´éšæœºæŠ½å–ä¸€ä¸ªâ€œä¸­å¥–å·â€ã€‚ç„¶åéå†æ‰€æœ‰è¿›ç¨‹çš„ç¥¨æ•°ï¼Œç´¯è®¡ç¥¨æ•°ï¼Œå½“ç´¯è®¡å€¼è¶…è¿‡ä¸­å¥–å·æ—¶ï¼Œå½“å‰è¿›ç¨‹å³ä¸ºâ€œä¸­å¥–è€…â€ï¼Œè·å¾—CPU ä½¿ç”¨æƒã€‚</p><h3 id="æ­¥é•¿è°ƒåº¦ç®—æ³•">æ­¥é•¿è°ƒåº¦ç®—æ³•</h3><p>å‡å¦‚Aã€Bã€Cçš„ç¥¨æ•°åˆ†åˆ«ä¸º100ã€50ã€250ï¼Œç”¨ä¸€ä¸ªå¤§æ•°1000ä½œä¸ºæ€»è¡Œç¨‹ï¼Œä¸ºäº†ç¡®ä¿Aã€Bã€Cçš„è¿è¡Œæ—¶é—´ç»´æŒä¸º2:1:5ï¼Œå–æ­¥é•¿åˆ†åˆ«ä¸º10ï¼Œ20ï¼Œ4ã€‚æ¯ä¸ªè°ƒåº¦å‘¨æœŸï¼Œå¦‚æœå‘ç°æŸä¸ªè¿›ç¨‹çš„è¡Œç¨‹æ¯”è¾ƒå°ï¼Œä¸‹ä¸€æ¬¡å°±è¿è¡Œè¿™ä¸ªè¡Œç¨‹ï¼Œä½¿å¾—æ‰€æœ‰è¿›ç¨‹çš„è¡Œç¨‹å§‹ç»ˆç›¸åŒã€‚</p><p><strong>æ­¥é•¿è°ƒåº¦ç®—æ³•çš„ç›®çš„æ˜¯å°½å¯èƒ½æ˜¯çš„æ‰€æœ‰è¿›ç¨‹çš„è¿è¡Œæ—¶é—´è°ƒæ•´ä¸ºé¢„æœŸçš„æ¯”ä¾‹ã€‚æ­¥é•¿è°ƒåº¦ä¾èµ–äºå…¨å±€çŠ¶æ€ï¼Œä¸é€‚åˆå¤„ç†æ–°åŠ å…¥çš„è¿›ç¨‹ã€‚</strong></p><h3 id="ç•ªå¤–æŸ¥çœ‹cpuå…·ä½“ä¿¡æ¯">ç•ªå¤–ï¼šæŸ¥çœ‹CPUå…·ä½“ä¿¡æ¯</h3><p>è¿„ä»Šä¸ºæ­¢å·²ç»å­¦äº†ä¸€å †å…³äºCPUè™šæ‹ŸåŒ–å’Œå†…å­˜è™šæ‹ŸåŒ–çš„ç†è®ºï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹çœŸå®å­˜åœ¨çš„ä¾‹å­ã€‚</p><p>åœ¨ GNU/Linuxç³»ç»Ÿä¸­ä½¿ç”¨<code>lscpu</code>å‘½ä»¤å¯ä»¥ç›´æ¥æŸ¥çœ‹CPUçš„å…·ä½“ä¿¡æ¯ï¼Œä»¥æˆ‘è‡ªå·±çš„4æ ¸8çº¿ç¨‹R5 3500U ä¸ºä¾‹ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">â•°â”€â¯ lscpu<br>æ¶æ„ï¼š                       x86_64<br>  CPU è¿è¡Œæ¨¡å¼ï¼š             <span class="hljs-number">32</span>-<span class="hljs-keyword">bit, </span><span class="hljs-number">64</span>-<span class="hljs-keyword">bit</span><br><span class="hljs-keyword"></span>  <span class="hljs-keyword">Address </span>sizes:             <span class="hljs-number">43</span> <span class="hljs-keyword">bits </span>physical, <span class="hljs-number">48</span> <span class="hljs-keyword">bits </span>virtual<br>  å­—èŠ‚åºï¼š                   Little Endian<br><span class="hljs-symbol">CPU:</span>                         <span class="hljs-number">8</span><br>  åœ¨çº¿ CPU åˆ—è¡¨ï¼š            <span class="hljs-number">0</span><span class="hljs-number">-7</span><br>å‚å•† IDï¼š                    AuthenticAMD<br>  å‹å·åç§°ï¼š                 AMD Ryzen <span class="hljs-number">5</span> <span class="hljs-number">3500</span>U with Radeon Vega Mobile Gfx<br>    CPU ç³»åˆ—ï¼š               <span class="hljs-number">23</span><br>    å‹å·ï¼š                   <span class="hljs-number">24</span><br>    æ¯ä¸ªæ ¸çš„çº¿ç¨‹æ•°ï¼š          <span class="hljs-number">2</span><br>    æ¯ä¸ªåº§çš„æ ¸æ•°ï¼š            <span class="hljs-number">4</span><br>    åº§ï¼š                     <span class="hljs-number">1</span><br>    æ­¥è¿›ï¼š                   <span class="hljs-number">1</span><br>    Frequency <span class="hljs-keyword">boost: </span>       å¯ç”¨<br>    CPU(s) <span class="hljs-keyword">scaling </span>MHz:     <span class="hljs-number">80</span>%<br>    CPU æœ€å¤§ MHzï¼š           <span class="hljs-number">2100</span>.<span class="hljs-number">0000</span><br>    CPU æœ€å° MHzï¼š           <span class="hljs-number">1400</span>.<span class="hljs-number">0000</span><br>    <span class="hljs-keyword">BogoMIPSï¼š </span>              <span class="hljs-number">4192</span>.<span class="hljs-number">15</span><br>    æ ‡è®°ï¼š                   fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca c<br>                             mov pat pse36 clflush mmx fxsr sse sse2 ht <span class="hljs-keyword">syscall </span>nx mmxe<br>                             xt fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good <span class="hljs-keyword">nopl </span>n<br>                             onstop_tsc cpuid <span class="hljs-keyword">extd_apicid </span>aperfmperf rapl pni pclmulqdq<br>                              monitor ssse3 fma cx16 sse4_1 sse4_2 movbe popcnt aes xsa<br>                             ve avx f16c rdrand lahf_lm cmp_legacy svm <span class="hljs-keyword">extapic </span>cr8_lega<br>                             cy abm sse4a misalignsse <span class="hljs-number">3</span>dnowprefetch osvw skinit wdt tce<br>                              topoext perfctr_core perfctr_nb <span class="hljs-keyword">bpext </span>perfctr_llc mwaitx <br>                             cpb hw_pstate ssbd ibpb vmmcall fsgsbase <span class="hljs-keyword">bmi1 </span>avx2 smep <span class="hljs-keyword">bm</span><br><span class="hljs-keyword"></span>                             i2 rdseed adx smap clflushopt <span class="hljs-keyword">sha_ni </span>xsaveopt xsavec xgetb<br>                             <span class="hljs-built_in">v1</span> <span class="hljs-keyword">clzero </span>xsaveerptr arat npt <span class="hljs-keyword">lbrv </span>svm_lock nrip_save tsc_<br>                             <span class="hljs-keyword">scale </span>vmcb_clean flushbyasid decodeassists <span class="hljs-keyword">pausefilter </span>pft<br>                             hreshold avic v_vmsave_vmload vgif overflow_recov succor s<br>                             mca sev sev_es<br>Virtualization features:     <br>  è™šæ‹ŸåŒ–ï¼š                   AMD-V<br><span class="hljs-keyword">Caches </span>(sum of all):         <br><span class="hljs-symbol">  L1d:</span>                       <span class="hljs-number">128</span> KiB (<span class="hljs-number">4</span> <span class="hljs-keyword">instances)</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">  L1i:</span>                       <span class="hljs-number">256</span> KiB (<span class="hljs-number">4</span> <span class="hljs-keyword">instances)</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">  L2:</span>                        <span class="hljs-number">2</span> MiB (<span class="hljs-number">4</span> <span class="hljs-keyword">instances)</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">  L3:</span>                        <span class="hljs-number">4</span> MiB (<span class="hljs-number">1</span> <span class="hljs-keyword">instance)</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">NUMA:</span>                        <br>  NUMA èŠ‚ç‚¹ï¼š                <span class="hljs-number">1</span><br>  NUMA èŠ‚ç‚¹<span class="hljs-number">0</span> CPUï¼š           <span class="hljs-number">0</span><span class="hljs-number">-7</span><br><span class="hljs-symbol">Vulnerabilities:</span>             <br>  Gather data sampling:      Not affected<br><span class="hljs-symbol">  Ghostwrite:</span>                Not affected<br>  Indirect target selection: Not affected<br>  Itlb <span class="hljs-keyword">multihit: </span>            Not affected<br><span class="hljs-symbol">  L1tf:</span>                      Not affected<br><span class="hljs-symbol">  Mds:</span>                       Not affected<br><span class="hljs-symbol">  Meltdown:</span>                  Not affected<br>  Mmio stale data:           Not affected<br>  Reg file data sampling:    Not affected<br><span class="hljs-symbol">  Retbleed:</span>                  Mitigation<span class="hljs-comment">; untrained return thunk; SMT vulnerable</span><br>  Spec rstack overflow:      Mitigation<span class="hljs-comment">; Safe RET</span><br>  Spec store <span class="hljs-keyword">bypass: </span>        Mitigation<span class="hljs-comment">; Speculative Store Bypass disabled via prctl</span><br>  Spectre <span class="hljs-built_in">v1</span>:                Mitigation<span class="hljs-comment">; usercopy/swapgs barriers and __user pointer sa</span><br>                             nitization<br>  Spectre v2:                Mitigation<span class="hljs-comment">; Retpolines; IBPB conditional; STIBP disabled; </span><br>                             RSB filling<span class="hljs-comment">; PBRSB-eIBRS Not affected; BHI Not affected</span><br><span class="hljs-symbol">  Srbds:</span>                     Not affected<br><span class="hljs-symbol">  Tsa:</span>                       Not affected<br>  Tsx async abort:           Not affected<br></code></pre></td></tr></table></figure><ul><li><code>AMD-V</code>è¡¨ç¤ºè¿™é¢—CPUæ”¯æŒè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¯ä»¥è¿è¡Œè™šæ‹Ÿæœº</li><li><code>L1d</code>æ˜¯æ•°æ®ç¼“å­˜ï¼Œæ¯ä¸ªæ ¸å¿ƒ32KBï¼Œå…±128KBï¼Œæ¯ä¸ªæ ¸å¿ƒéƒ½æœ‰ç‹¬ç«‹çš„æ•°æ®ç¼“å­˜</li><li><code>L1i</code>æ˜¯æŒ‡ä»¤ç¼“å­˜ï¼ŒåŒæ ·æ¯ä¸ªæ ¸å¿ƒéƒ½æœ‰ç‹¬ç«‹çš„æŒ‡ä»¤ç¼“å­˜</li><li><code>L2</code>æ˜¯äºŒçº§ç¼“å­˜ï¼Œé€Ÿåº¦ç•¥æ…¢äºL1ï¼Œä½†æ˜¯æ›´å¤§ï¼Œæ¯ä¸ªæ ¸ç§æœ‰</li><li><code>L3</code>æ˜¯ä¸‰çº§ç¼“å­˜ï¼Œæ‰€æœ‰æ ¸å¿ƒå…±äº«</li></ul><h1id="å››è¿›ç¨‹è°ƒåº¦äºŒå¤šå¤„ç†å™¨è¿›ç¨‹è°ƒåº¦">å››ã€è¿›ç¨‹è°ƒåº¦ï¼ˆäºŒï¼‰å¤šå¤„ç†å™¨è¿›ç¨‹è°ƒåº¦</h1><h2 id="å¤šå¤„ç†å™¨æ¶æ„">å¤šå¤„ç†å™¨æ¶æ„</h2><p>å¤šCPUå’Œå•CPUçš„ä¸»è¦åŒºåˆ«åœ¨<strong>å¯¹ç¡¬ä»¶ç¼“å­˜çš„åº”ç”¨</strong>ã€‚</p><p>é¦–å…ˆï¼Œç¼“å­˜ä¹‹æ‰€ä»¥æœ‰ç”¨ï¼Œæ˜¯å› ä¸º<strong>å±€éƒ¨æ€§ï¼ˆlocalityï¼‰åŸç†</strong>ï¼š</p><ul><li><strong>æ—¶é—´å±€éƒ¨æ€§</strong>ï¼šå½“ä¸€ä¸ªæ•°æ®è¢«è®¿é—®åï¼Œå®ƒå¾ˆæœ‰å¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥å†æ¬¡è¢«è®¿é—®ã€‚</li><li><strong>ç©ºé—´å±€éƒ¨æ€§</strong>ï¼šå½“ç¨‹åºè®¿é—®åœ°å€ xçš„æ•°æ®åï¼Œå¾ˆå¯èƒ½ä¼šç´§æ¥ç€è®¿é—® x é™„è¿‘çš„æ•°æ®ã€‚ï¼ˆæ¯”å¦‚ï¼šéå†æ•°ç»„ï¼‰</li></ul><p><img src="https://s21.ax1x.com/2025/07/24/pVGXMin.png" /></p><p>åœ¨å•CPUçš„æ¶æ„ä¸‹ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåªéœ€è¦æŠŠä»å†…å­˜è¯»åˆ°çš„æ•°æ®å­˜å…¥CPUç¼“å­˜ï¼›ä½†æ˜¯åœ¨å¤šCPUæ¶æ„ä¸‹ï¼Œä¸åŒCPUçš„ç¼“å­˜å…±äº«ä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œä¼šå‘ç”Ÿ<strong>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</strong>ï¼ˆcachecoherenceï¼‰ï¼šä¸€ä¸ªCPUä¿®æ”¹å†…å­˜ä¸­çš„æŸä¸ªå€¼åï¼Œå¦ä¸€ä¸ªCPUå¹¶ä¸çŸ¥æƒ…ï¼Œä»ç„¶ä»è‡ªå·±çš„ç¼“å­˜ä¸­è¯»å–æ—§å€¼ã€‚ç¡¬ä»¶çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ä¸€æ¡<strong>æ€»çº¿</strong>è®©ç¼“å­˜ç›‘æ§å†…å­˜çš„è®¿é—®ï¼Œå¦‚æœå†…å­˜çš„å€¼è¢«ä¿®æ”¹ï¼Œé©¬ä¸Šæ›´æ–°è‡ªå·±ç¼“å­˜çš„æ•°æ®ã€‚</p><p>åœ¨å¤šä¸ªCPUå¹¶å‘è®¿é—®å…±äº«çš„æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨é”æ‰èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆæ— é”æ•°æ®ç»“æ„è¾ƒå°‘ä½¿ç”¨ï¼‰</p><p><strong>ç¼“å­˜äº²å’Œåº¦</strong>ï¼ˆcacheaffinityï¼‰ï¼šP88ï¼ŒæŒ‡çš„æ˜¯ä¸åŒCPUä¸Šå¦‚æœç¼“å­˜çš„æƒ…å†µä¸åŒï¼Œè¿è¡Œé€Ÿåº¦ä¹Ÿä¸ä¸€æ ·ï¼Œå·²ç»æœ‰å¯¹åº”ç¼“å­˜çš„CPUè¿è¡Œé€Ÿåº¦ä¼šå¿«å¾—å¤šã€‚</p><h2 id="å•é˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦sqms">å•é˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦SQMS</h2><figure><img src="https://s21.ax1x.com/2025/07/24/pVGj3tA.png"alt="SQMSç¤ºæ„å›¾" /><figcaption aria-hidden="true">SQMSç¤ºæ„å›¾</figcaption></figure><p><code>Single Queue Multiprocessor Schedulingï¼ŒSQMS</code></p><p>å°†æ‰€æœ‰éœ€è¦è°ƒåº¦çš„å·¥ä½œæ”¾å…¥ä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ä¸­ï¼Œæ¯æ¬¡ç”±ä¸€ä¸ªCPUå–å‡ºä¸€ä¸ªä»»åŠ¡ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šè´Ÿè½½å‡è¡¡è¾ƒå¥½ï¼Œå®¹æ˜“æ„å»º</li><li>ç¼ºç‚¹ï¼š1. åŠ é”çš„å¼€é”€è¾ƒå¤§ï¼Œæ‰©å±•æ€§å·®ï¼ŒCPUæ ¸è¶Šå¤šæ•ˆç‡è¶Šä½2.ä¸åŒçš„è¿›ç¨‹ä¸æ–­åœ¨ä¸åŒçš„CPUä¸Šè½¬ç§»ï¼Œç¼“å­˜çš„äº²å’Œæ€§è¾ƒå·®</li></ul><h2 id="å¤šé˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦">å¤šé˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦</h2><p><img src="https://s21.ax1x.com/2025/07/24/pVGj8fI.png" /></p><p>æ¯ä¸ªCPUéƒ½æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸åŒCPUçš„è°ƒåº¦ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé€šè¿‡è¿ç§»æŠ€æœ¯ï¼ŒæŠŠå·¥ä½œåˆ†é…ç»™ç©ºé—²çš„CPUï¼›æˆ–è€…é€šè¿‡å·¥ä½œçªƒå–ï¼Œè®©å·¥ä½œé‡è¾ƒå°‘çš„CPUå·çœ‹å…¶ä»–CPUçš„å·¥ä½œæƒ…å†µï¼Œæ‹¿åˆ°å·¥ä½œã€‚ä½†æ˜¯æ£€æŸ¥é—´éš”å¦‚ä½•é€‰å–åˆæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><h2 id="gnulinuxé‡‡ç”¨çš„ç­–ç•¥">GNU/Linuxé‡‡ç”¨çš„ç­–ç•¥</h2><ul><li><strong>O(1)è°ƒåº¦ç¨‹åº</strong>ï¼šå¤šé˜Ÿåˆ—ï¼ŒåŸºäºä¼˜å…ˆçº§ã€‚ç±»ä¼¼äºMLFQ</li><li><strong>å®Œå…¨å…¬å¹³è°ƒåº¦ç¨‹åºï¼ˆCFSï¼‰</strong>ï¼šå¤šé˜Ÿåˆ—ã€æ¯”ä¾‹è°ƒåº¦</li><li><strong>BFè°ƒåº¦ç¨‹åºï¼ˆBFSï¼‰</strong>ï¼šå•é˜Ÿåˆ—ã€æ¯”ä¾‹è°ƒåº¦</li></ul><p>è¿™é‡Œå¯ä»¥å‚è€ƒï¼š</p><p>[M11]â€œTowards Transparent CPU Schedulingâ€Joseph T. Meehean<br />Doctoral Dissertation at University of Wisconsinâ€”Madison, 2011</p><p>GNU/Linuxç³»ç»ŸæŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chrt -p &lt;pid&gt;<br></code></pre></td></tr></table></figure><p>è°ƒåº¦ç­–ç•¥ä¸€è§ˆï¼š</p><table><thead><tr><th>ç­–ç•¥å</th><th>å‚æ•°å€¼</th><th>ç®€ä»‹</th></tr></thead><tbody><tr><td>SCHED_OTHER</td><td>0</td><td>æ™®é€šæ—¶é—´å…±äº«ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td>SCHED_FIFO</td><td>1</td><td>å…ˆè¿›å…ˆå‡ºå®æ—¶ç­–ç•¥</td></tr><tr><td>SCHED_RR</td><td>2</td><td>å®æ—¶è½®è½¬è°ƒåº¦ç­–ç•¥</td></tr><tr><td>SCHED_BATCH</td><td>3</td><td>æ‰¹å¤„ç†ç­–ç•¥</td></tr><tr><td>SCHED_IDLE</td><td>5</td><td>ç©ºé—²ä»»åŠ¡è°ƒåº¦ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰</td></tr><tr><td>SCHED_DEADLINE</td><td>6</td><td>Deadline ç­–ç•¥ï¼ˆç”¨äºç¡®å®šæ€§éœ€æ±‚åœºæ™¯ï¼‰</td></tr></tbody></table><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/24/pVJp9Ig.png" /></p><h2 id="æ€»ç»“">æ€»ç»“</h2><ul><li>å•é˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦ï¼šè´Ÿè½½å‡è¡¡æ€§è¾ƒå¥½ï¼Œä½†æ˜¯å› ä¸ºåŠ é”ï¼Œæ‰©å±•æ€§å·®ï¼Œå› ä¸ºè¿›ç¨‹é¢‘ç¹åœ¨å¤šä¸ªCPUåˆ‡æ¢ï¼Œç¼“å­˜äº²å’Œåº¦å·®</li><li>å¤šé˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦ï¼šæ‰©å±•æ€§å’Œç¼“å­˜äº²å’Œåº¦å¥½ï¼Œä½†æ˜¯è´Ÿè½½å‡è¡¡æ€§è¾ƒå·®</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTPç¼“å­˜æœºåˆ¶æ¢³ç†</title>
    <link href="/2025/08/06/HTTP%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E6%A2%B3%E7%90%86/"/>
    <url>/2025/08/06/HTTP%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E6%A2%B3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="getå’Œpost">GETå’ŒPOST</h2><p><strong>GETï¼šä»æœåŠ¡å™¨è·å–æŒ‡å®šçš„èµ„æºï¼Œè¯·æ±‚çš„å‚æ•°ä¸€èˆ¬å†™åœ¨URLä¸­</strong>ã€‚</p><p><strong>POSTæ˜¯æ ¹æ®è¯·æ±‚ä½“çš„å†…å®¹å¯¹æŒ‡å®šçš„èµ„æºåšå‡ºå¤„ç†</strong>ã€‚POSTè¯·æ±‚æºå¸¦æ•°æ®çš„ä½ç½®ä¸€èˆ¬æ˜¯å†™åœ¨è¯·æ±‚ä½“ä¸­ï¼Œjsonæ ¼å¼æ¯”è¾ƒå¸¸è§ã€‚</p><p>HTTPåè®®ä¸­çš„<strong>å®‰å…¨</strong>å’Œ<strong>å¹‚ç­‰</strong>ï¼š</p><ul><li>å®‰å…¨ æŒ‡çš„æ˜¯è¯·æ±‚æ–¹æ³•ä¸ä¼šç ´åæœåŠ¡å™¨ä¸Šçš„èµ„æº</li><li>å¹‚ç­‰ æŒ‡çš„æ˜¯å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚</li></ul><p>ç»“è®ºï¼š</p><ol type="1"><li>GETè¯·æ±‚æ˜¯å®‰å…¨ä¸”å¹‚ç­‰çš„ï¼Œå› ä¸ºå®ƒä¸ä¼šå¯¹æœåŠ¡å™¨ä¸Šçš„æ•°æ®åŠ¨æ‰‹è„šï¼Œæ¯æ¬¡è¿”å›çš„ç»“æœéƒ½ç›¸åŒã€‚æ­£å› å¦‚æ­¤ï¼ŒGETè¯·æ±‚è¿”å›çš„å“åº”æ˜¯å¯ä»¥è¢«ç¼“å­˜çš„ï¼Œæµè§ˆå™¨åŸºæœ¬éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”æµè§ˆå™¨è¿˜å¯ä»¥å§GETè¯·æ±‚ä¿å­˜ä¸ºä¹¦ç­¾ã€‚</li><li>POSTå¯èƒ½ä¼šä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œæ‰€ä»¥ä¸å®‰å…¨ï¼›å¤šæ¬¡æäº¤å°±ä¼šå¤šæ¬¡ä¿®æ”¹èµ„æºï¼Œç»“æœä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸å¹‚ç­‰ã€‚æ‰€ä»¥æµè§ˆå™¨æ—¢ä¸ä¼šæŠŠPOSTè¯·æ±‚ç¼“å­˜ï¼Œä¹Ÿä¸ä¼šä¿å­˜ä¸ºä¹¦ç­¾ã€‚</li></ol><p>GETè¯·æ±‚ä¹Ÿæ˜¯å¯ä»¥å¸¦è¯·æ±‚ä½“çš„ã€‚RFCè§„èŒƒå®šä¹‰çš„GETè¯·æ±‚æ—¶è·å–èµ„æºï¼Œä»è¿™ä¸ªæ„æ€ä¸Šè®²å®ƒä¸éœ€è¦è¯·æ±‚ä½“ï¼Œä½†ä¹Ÿæ²¡æœ‰è§„å®šè¯´ç¦æ­¢ä½¿ç”¨è¯·æ±‚ä½“ã€‚</p><h2 id="etag">ETag</h2><p>HTTPé¦–éƒ¨å­—æ®µ ETagèƒ½å‘ŠçŸ¥å®¢æˆ·ç«¯å®ä½“æ ‡è¯†ï¼Œå®ƒæ˜¯ä¸€ç§å¯ä»¥å°†èµ„æºä»¥å­—ç¬¦ä¸²å½¢å¼å”¯ä¸€æ€§æ ‡è¯†çš„æ–¹å¼ã€‚æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸€ä»½èµ„æºåˆ†é…å¯¹åº”çš„ETag å€¼ã€‚å½“èµ„æºæ›´æ–°æ—¶ï¼ŒETag ä¹Ÿéœ€è¦æ›´æ–°ã€‚ç”ŸæˆETagæ—¶ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„ç®—æ³•è§„åˆ™ï¼Œè€Œä»…ä»…æ˜¯ç”±æœåŠ¡å™¨æ¥åˆ†é…ã€‚</p><h2 id="httpç¼“å­˜">HTTPç¼“å­˜</h2><p>HTTP ç¼“å­˜ä¼šå­˜å‚¨ä¸è¯·æ±‚å…³è”çš„å“åº”ï¼Œå¹¶å°†å­˜å‚¨çš„å“åº”å¤ç”¨äºåç»­è¯·æ±‚ã€‚</p><p>å½“å“åº”å¯å¤ç”¨æ—¶ï¼ŒæºæœåŠ¡å™¨ä¸éœ€è¦å¤„ç†è¯·æ±‚â€”â€”å› ä¸ºå®ƒä¸éœ€è¦è§£æå’Œè·¯ç”±è¯·æ±‚ã€æ ¹æ®cookieæ¢å¤ä¼šè¯ã€æŸ¥è¯¢æ•°æ®åº“ä»¥è·å–ç»“æœæˆ–æ¸²æŸ“æ¨¡æ¿å¼•æ“ã€‚<strong>è¿™å‡å°‘äº†æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½</strong>ã€‚</p><p>æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„ç¼“å­˜ï¼š<strong>ç§æœ‰ç¼“å­˜å’Œå…±äº«ç¼“å­˜</strong>ã€‚</p><h3 id="å¼ºåˆ¶ç¼“å­˜">å¼ºåˆ¶ç¼“å­˜</h3><blockquote><p>å¼ºåˆ¶ç¼“å­˜ï¼Œåªè¦æµè§ˆå™¨åˆ¤æ–­ç¼“å­˜æ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥ä½¿ç”¨æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„å†³å®šæƒåœ¨æµè§ˆå™¨èº«ä¸Šã€‚</p></blockquote><p>å¼ºåˆ¶ç¼“å­˜å¯ç”¨æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ç ä»ç„¶æ˜¯<code>200</code>ï¼Œä½†æ˜¯åé¢ä¼šåŠ ä¸ªæ‹¬å·ï¼Œä¾‹å¦‚<code>200 OK (ä»ç£ç›˜ç¼“å­˜)</code></p><h4 id="cache-control">Cache-Control</h4><p>æµè§ˆå™¨ç¼“å­˜çš„ä¸€ä¸ªä¾‹å­ï¼ˆæ¥è‡ªå¯¹æŸä¸ªèƒŒæ™¯å›¾ç‰‡çš„GETè¯·æ±‚çš„å“åº”æ ‡å¤´ï¼‰</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">Cache</span><span class="hljs-params">-Control</span>: <span class="hljs-keyword">max</span><span class="hljs-params">-age</span>=<span class="hljs-number">14400</span><br></code></pre></td></tr></table></figure><p>æ„æ€æ˜¯è¿™ä¸ªèµ„æºå¯ä»¥è¢«ç¼“å­˜ï¼Œå¹¶ä¸”æœ€å¤§å­˜æ´»æ—¶é—´æ˜¯14400ç§’ï¼Œå³å››ä¸ªå°æ—¶ã€‚å››ä¸ªå°æ—¶ä»¥å†…è®¿é—®è¿™ä¸ªèµ„æºï¼Œæµè§ˆå™¨éƒ½ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ï¼Œä¸ä¼šè®¿é—®æœåŠ¡å™¨ã€‚è¶…è¿‡4 å°æ—¶åï¼Œå†è®¿é—®è¿™ä¸ªèµ„æºï¼Œå°±ä¼šé‡æ–°è¯·æ±‚æœåŠ¡å™¨ä»¥ç¡®è®¤æ˜¯å¦æœ‰æ›´æ–°ã€‚</p><p><code>Cache-Control: max-age</code>çš„å€¼æ˜¯ç”±åç«¯å¼€å‘è€…æˆ–è¿ç»´æ ¹æ®èµ„æºçš„å˜åŒ–é¢‘ç‡å’Œä½¿ç”¨åœºæ™¯<strong>æ‰‹åŠ¨è®¾å®š</strong>çš„ï¼Œä¸åŒç±»å‹çš„èµ„æºè®¾å®šä¸åŒï¼Œç›®çš„æ˜¯åœ¨â€œèŠ‚çœå¸¦å®½â€ä¸â€œæ•°æ®æ–°é²œåº¦â€ä¹‹é—´å–å¾—å¹³è¡¡ã€‚<strong>æœåŠ¡å™¨æœ¬èº«å¹¶ä¸ä¼šâ€œè‡ªåŠ¨åˆ¤æ–­â€èµ„æºæ˜¯å¦åº”è¯¥ç¼“å­˜ï¼Œè¿™æ˜¯äººä¸ºé…ç½®å‡ºæ¥çš„è¡Œä¸º</strong>ã€‚å¼€å‘è€…å¯ä»¥åœ¨åç«¯ä»£ç é‡Œæ˜¾å¼æŒ‡å®šæœåŠ¡å™¨åº”å½“é‡‡å–çš„é…ç½®ã€‚</p><p>é™æ€èµ„æºå¦‚èƒŒæ™¯å›¾ç‰‡ã€CSSã€JSç­‰å˜åŒ–è¾ƒå°‘ï¼Œå¯ä»¥é•¿æ—¶é—´ç¼“å­˜ã€‚JSONåˆ™æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç¡®å®šã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤è€çš„å­—æ®µï¼š<code>Expire</code>ã€‚å®ƒæŒ‡å®šèµ„æºå¤±æ•ˆçš„<strong>ç»å¯¹æ—¶é—´</strong>ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼šåˆ°æœŸæ—¶é—´æ˜¯ç”±æœåŠ¡ç«¯ç”Ÿæˆçš„ï¼Œå¦‚æœå®¢æˆ·ç«¯æ—¶é—´è·ŸæœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´ï¼Œè¿™å°±ä¼šå¯¼è‡´ç¼“å­˜å‘½ä¸­çš„è¯¯å·®ã€‚<strong>åœ¨HTTP 1.1 çš„ç‰ˆæœ¬ï¼ŒExpires è¢« Cache-Control æ›¿ä»£</strong>ã€‚</p><blockquote><p>Q:è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæŸå¼ å›¾ç‰‡çš„å“åº”æ ‡å¤´çš„Cache-Controlçš„å€¼è®¾ç½®çš„æ˜¯4å°æ—¶ï¼Œä½†æ˜¯åœ¨å®ƒè¿‡æœŸä¹‹å‰ï¼ŒæœåŠ¡å™¨ä¿®æ”¹äº†è¿™å¼ èƒŒæ™¯å›¾ç‰‡ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¿…é¡»ç­‰åˆ°è¿‡æœŸæ—¶é—´åˆ°æ¥æ‰ä¼šå—åˆ°é€šçŸ¥å—ï¼Ÿ</p><p>A:æ˜¯è¿™æ ·çš„ï¼Œè®¾ç½®äº†<code>Cache-Control: max-age=14400</code>åï¼Œå®¢æˆ·ç«¯åœ¨ 4å°æ—¶å†…ä¼šç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œä¸ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¹Ÿå°±æ— æ³•æ„ŸçŸ¥åˆ°æœåŠ¡å™¨èµ„æºçš„å˜åŒ–ã€‚è¿™æ˜¯å¼ºç¼“å­˜çš„ä»£ä»·ä¹‹ä¸€ã€‚</p></blockquote><h4 id="cache-controlçš„æ‰§è¡Œæµç¨‹">Cache-Controlçš„æ‰§è¡Œæµç¨‹</h4><ol type="1"><li>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚è®¿é—®æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ŒæœåŠ¡å™¨æ ¹æ®é…ç½®ï¼Œåœ¨è¿”å›èµ„æºçš„åŒæ—¶åœ¨å“åº”æ ‡å¤´åŠ ä¸Š<code>Cache-Control</code>ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´çš„å¤§å°</li><li>æµè§ˆå™¨å†æ¬¡è®¿é—®è¿™ä¸ªèµ„æºï¼Œæµè§ˆå™¨ä¼šå…ˆæ ¹æ®è‡ªå·±ä¸Šæ¬¡è¯·æ±‚çš„æ—¶é—´å’Œè¿‡æœŸæ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè¿˜æ²¡è¿‡æœŸï¼Œå°±ä¸è¯·æ±‚äº†ã€‚</li><li>æœåŠ¡å™¨å†æ¬¡å—åˆ°è¯·æ±‚åï¼Œä¼šæ›´æ–°å“åº”æ ‡å¤´çš„å­—æ®µã€‚</li></ol><h3 id="å…±äº«ç¼“å­˜">å…±äº«ç¼“å­˜</h3><p>å…±äº«ç¼“å­˜ä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œå¯ä»¥å­˜å‚¨èƒ½åœ¨ç”¨æˆ·ä¹‹é—´å…±äº«çš„å“åº”ã€‚å…±äº«ç¼“å­˜å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºä»£ç†ç¼“å­˜å’Œæ‰˜ç®¡ç¼“å­˜ã€‚</p><p>å…±äº«cacheä¸»è¦ç”¨åœ¨ä¸€äº›<strong>webä»£ç†</strong>ä¸Šï¼Œæ¯”å¦‚webä»£ç†æœåŠ¡å™¨ï¼Œå› ä¸ºwebä»£ç†æœåŠ¡å™¨å¯èƒ½ä¼šä¸ºä¼—å¤šçš„ç”¨æˆ·æä¾›èµ„æºæœåŠ¡ï¼Œå¯¹äºè¿™äº›ç”¨æˆ·å…±åŒè®¿é—®çš„èµ„æºå°±ä¸å¿…è¦æ¯ä¸ªç”¨æˆ·ä¿å­˜ä¸€ä»½äº†ï¼Œåªéœ€è¦åœ¨webä»£ç†æœåŠ¡å™¨ä¸­ä¿å­˜ä¸€ä»½å³å¯ï¼Œè¿™æ ·å¯ä»¥å‡å°‘èµ„æºçš„æ— æ•ˆæ‹·è´ã€‚</p><h3 id="åå•†ç¼“å­˜">åå•†ç¼“å­˜</h3><p>çœæµï¼š</p><blockquote><p>HTTP åå•†ç¼“å­˜æ˜¯é€šè¿‡ ETag å’Œ Last-Modifiedæœºåˆ¶å®ç°çš„ã€‚æ¯æ¬¡è¯·æ±‚éœ€è¦è®©æœåŠ¡å™¨åˆ¤æ–­ä¸€ä¸‹èµ„æºæ˜¯å¦æ›´æ–°è¿‡ï¼ŒæœåŠ¡å™¨æ ¹æ®èµ„æºæ˜¯å¦ä¿®æ”¹æ¥å†³å®šè¿”å›304 Not Modifiedè¿˜æ˜¯æ–°å†…å®¹ï¼Œä»è€Œå†³å®šå®¢æˆ·ç«¯æµè§ˆå™¨æ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚å®ƒæ¯”å¼ºç¼“å­˜æ›´çµæ´»ï¼Œèƒ½ç¡®ä¿èµ„æºæœ€æ–°çŠ¶æ€ï¼Œä½†æ€§èƒ½ç•¥å·®äºå¼ºç¼“å­˜ã€‚</p></blockquote><p>ä¹Ÿå«å¯¹æ¯”ç¼“å­˜ã€‚ä¸å¼ºåˆ¶ç¼“å­˜ç›¸æ¯”ï¼Œè¿™æ¬¡æ˜¯æœåŠ¡å™¨è´Ÿè´£åˆ¤æ–­ç¼“å­˜çš„èµ„æºæœ‰æ²¡æœ‰è¿‡æœŸï¼Œå¦‚æœè¿”å›304è¯´æ˜æ²¡æœ‰è¿‡æœŸã€‚</p><p>åå•†ç¼“å­˜çš„ä¸¤ä¸ªä¸»è¦æœºåˆ¶ï¼š</p><table><thead><tr><th>æœºåˆ¶</th><th>è¯·æ±‚å¤´ï¼ˆæµè§ˆå™¨ï¼‰</th><th>å“åº”å¤´ï¼ˆæœåŠ¡å™¨ï¼‰</th></tr></thead><tbody><tr><td><strong>Last-Modified</strong></td><td><code>If-Modified-Since</code></td><td><code>Last-Modified</code></td></tr><tr><td><strong>ETag</strong></td><td><code>If-None-Match</code></td><td><code>ETag</code></td></tr></tbody></table><p>å›¾è§£å¦‚ä¸‹ï¼š</p><figure><img src="https://s21.ax1x.com/2025/08/06/pVUHqoQ.jpg"alt="if-None-Match" /><figcaption aria-hidden="true">if-None-Match</figcaption></figure><figure><img src="https://s21.ax1x.com/2025/08/06/pVUHOij.jpg"alt="if-Modified-Since" /><figcaption aria-hidden="true">if-Modified-Since</figcaption></figure><ol type="1"><li><strong>ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æº</strong></li></ol><p>å¦‚æœæœåŠ¡å™¨çš„å“åº”å¤´è¿”å›</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Last</span>-Modified: Tue, <span class="hljs-number">03</span> Jun <span class="hljs-number">2025</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT<br><span class="hljs-attribute">ETag</span>: <span class="hljs-string">&quot;v1.23abc&quot;</span><br><span class="hljs-attribute">Cache</span>-Control: no-cache<br></code></pre></td></tr></table></figure><p>å°±è¯´æ˜ä¸å…è®¸ä½¿ç”¨å¼ºåˆ¶ç¼“å­˜ï¼Œä½†æ˜¯å¯ä»¥åå•†ç¼“å­˜ã€‚</p><p><code>Last-Modified</code>è¡¨ç¤ºè¿™ä¸ªèµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´;<code>ETag</code>å‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰</p><ol start="2" type="1"><li><strong>å†æ¬¡è¯·æ±‚èµ„æº</strong></li></ol><p>è¯·æ±‚å¤´ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">If</span>-Modified-Since: Tue, <span class="hljs-number">03</span> Jun <span class="hljs-number">2025</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT<br><span class="hljs-attribute">If</span>-None-Match: <span class="hljs-string">&quot;v1.23abc&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœèµ„æºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒæœåŠ¡å™¨è¿”å›</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">HTTP</span>/<span class="hljs-number">1</span>.<span class="hljs-number">1</span> <span class="hljs-number">304</span> Not Modified<br></code></pre></td></tr></table></figure><ul><li><p><code>If-Modified-Since</code>æ˜¯æµè§ˆå™¨åœ¨è¯¢é—®æœåŠ¡ç«¯èµ„æºæ˜¯å¦è¿‡æœŸï¼Œåé¢ç´§è·Ÿçš„æ—¥æœŸæ˜¯å®¢æˆ·ç«¯ä¸Šæ¬¡ä»æœåŠ¡å™¨é‚£é‡Œæ”¶åˆ°çš„æœ€åä¿®æ”¹æ—¥æœŸã€‚</p></li><li><p><code>If-None-Match</code>å‘å‡ºå»çš„å€¼å°±æ˜¯ä¸Šæ¬¡ä»æœåŠ¡å™¨æ”¶åˆ°çš„å€¼ã€‚æœåŠ¡å™¨ä¼šæ¯”è¾ƒè¯·æ±‚èµ„æºçš„ç°åœ¨çš„<code>Etag</code>çš„å€¼å’Œå®¢æˆ·ç«¯å‘è¿‡æ¥çš„å€¼æ˜¯å¦ç›¸åŒï¼Œä¸ä¸€è‡´è¯´æ˜è¿™ä¸ªèµ„æºå·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œé‚£ä¹ˆå°±è¿”å›æœ€æ–°èµ„æºï¼ŒçŠ¶æ€ç 200.å¦‚æœæ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œè¿”å›304ã€‚</p></li></ul><p>å®é™…é¡¹ç›®ä¸­ä¸¤ç§æ–¹å¼å¸¸å¸¸åŒæ—¶ä½¿ç”¨ã€‚ETag-<code>If-None-Match</code>çš„å®ç°æ–¹å¼æ›´ä¼˜è¶Šï¼š</p><ul><li>æ–‡ä»¶å†…å®¹æ²¡æœ‰å‘ç”Ÿæ›´æ”¹çš„æƒ…å†µä¸‹ï¼Œæœ€åä¿®æ”¹æ—¶é—´ä¹Ÿå¯èƒ½æ”¹å˜ï¼Œé€ æˆè¯¯åˆ¤ï¼›</li><li><code>Last-Modified</code>æ–¹å¼ç²¾ç¡®åˆ°ç§’ï¼Œå¦‚æœéœ€è¦èµ„æºåœ¨ä¸€ç§’å†…åˆ·æ–°å¤šæ¬¡ï¼Œåªæœ‰<code>ETag</code>èƒ½åšåˆ°</li><li>æœ‰çš„æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®è·å–æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´</li></ul><p>å¦‚æœé€šè¿‡<code>ETag</code>å·²ç»åˆ¤æ–­è¿‡ï¼Œå°±<strong>ä¸ä¼š</strong>å†ä½¿ç”¨<code>Last-Modified</code>ã€‚</p><p><a href="https://imgse.com/i/pVCros1"><imgsrc="https://s21.ax1x.com/2025/06/03/pVCros1.png"alt="pVCros1.png" /></a></p><p><strong>æ³¨æ„ï¼šåå•†ç¼“å­˜åªæœ‰åœ¨å¼ºåˆ¶ç¼“å­˜è¿‡æœŸ/æœªå¯ç”¨çš„æƒ…å†µä¸‹æ‰ä¼šè¢«é‡‡ç”¨</strong>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Computer Networking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç½‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿ-Unixé£æ ¼æ–‡ä»¶ç³»ç»ŸçŸ¥è¯†æ¢³ç†</title>
    <link href="/2025/07/31/Unix%E9%A3%8E%E6%A0%BC%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/"/>
    <url>/2025/07/31/Unix%E9%A3%8E%E6%A0%BC%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>Unixé£æ ¼æ–‡ä»¶ç³»ç»Ÿæ€»ç»“ï¼Œæœ¬æ–‡çš„æ‰€æœ‰å‘½ä»¤å‡åœ¨Linuxä¸Šè¿è¡Œè¿‡ã€‚</p><p>æœ€è¿‘å­¦åˆ°è¿™ä¸€å—çš„æ—¶å€™æ‰¾ä¸åˆ°è´¨é‡å¾ˆé«˜çš„ç›¸å…³æ–‡ç« ï¼Œå¹²è„†è‡ªå·±æ€»ç»“ä¸€ä¸‹å¥½äº†ã€‚</p><ol type="1"><li><a href="#ç›®å½•directory">ç›®å½•ï¼ˆdirectoryï¼‰</a><ol type="1"><li><a href="#ç®€ä»‹">ç®€ä»‹</a></li><li><a href="#å­˜å‚¨ä½ç½®">å­˜å‚¨ä½ç½®</a></li></ol></li><li><a href="#æ–‡ä»¶çš„å…ƒæ•°æ®">æ–‡ä»¶çš„å…ƒæ•°æ®</a></li><li><a href="#æ–‡ä»¶æè¿°ç¬¦">æ–‡ä»¶æè¿°ç¬¦</a><ol type="1"><li><a href="#ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦">ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦</a></li><li><a href="#å¦‚ä½•åˆ†é…">å¦‚ä½•åˆ†é…ï¼Ÿ</a></li><li><a href="#é€šè¿‡ç»ˆç«¯æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦">é€šè¿‡ç»ˆç«¯æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦</a></li></ol></li><li><a href="#inode">â­inodeâ­</a><ol type="1"><li><a href="#ä»€ä¹ˆæ˜¯inode">ä»€ä¹ˆæ˜¯inode</a></li><li><a href="#ä»€ä¹ˆæ˜¯inode-number">ä»€ä¹ˆæ˜¯inode number</a></li><li><a href="#inodeå’Œæ•°æ®å—çš„å…³ç³»">inodeå’Œæ•°æ®å—çš„å…³ç³»</a></li><li><a href="#inodeèŠ‚ç‚¹çš„å¤§å°">inodeèŠ‚ç‚¹çš„å¤§å°</a></li><li><a href="#inodeç¼–å·å’Œæ–‡ä»¶åçš„å…³ç³»">inodeç¼–å·å’Œæ–‡ä»¶åçš„å…³ç³»</a></li></ol></li><li><a href="#åˆ›å»ºæ–‡ä»¶-link">åˆ›å»ºæ–‡ä»¶-link</a><ol type="1"><li><a href="#ç¡¬é“¾æ¥">ç¡¬é“¾æ¥</a></li><li><a href="#è½¯é“¾æ¥">è½¯é“¾æ¥</a></li></ol></li><li><ahref="#æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶è¡¨å’Œinodeè¡¨çš„å…³ç³»">æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶è¡¨å’Œinodeè¡¨çš„å…³ç³»</a></li><li><a href="#è¯»å†™ç£ç›˜">è¯»å†™ç£ç›˜</a><ol type="1"><li><a href="#è¯»å–æ–‡ä»¶æ— ç¼“å­˜">è¯»å–æ–‡ä»¶ï¼ˆæ— ç¼“å­˜ï¼‰</a></li><li><a href="#å†™å…¥æ–‡ä»¶æ— ç¼“å†²">å†™å…¥æ–‡ä»¶ï¼ˆæ— ç¼“å†²ï¼‰</a></li><li><a href="#cahe-and-buffering">cahe and buffering</a></li></ol></li><li><a href="#å´©æºƒä¸€è‡´æ€§">å´©æºƒä¸€è‡´æ€§</a><ol type="1"><li><a href="#é—®é¢˜æå‡º">é—®é¢˜æå‡º</a></li><li><a href="#è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</a></li></ol></li><li><a href="#å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</a></li></ol><h2 id="ç›®å½•directory">ç›®å½•ï¼ˆdirectoryï¼‰</h2><h3 id="ç®€ä»‹">ç®€ä»‹</h3><p>ç›®å½•æ˜¯ç”¨äºæè¿°æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯çš„æ•°æ®ç»“æ„ã€‚ç›®å½•æ–‡ä»¶çš„ç»“æ„éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ç³»åˆ—ç›®å½•é¡¹çš„åˆ—è¡¨ã€‚æ¯ä¸ªç›®å½•é¡¹ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<code>æ–‡ä»¶å -&gt; inode number</code>ã€‚</p><p><strong>åªæœ‰æ‹¿åˆ°ç›®å½•çš„<code>inode</code>èŠ‚ç‚¹ï¼Œæ‰èƒ½è®¿é—®å®ƒçš„ç›®å½•é¡¹</strong>ã€‚ï¼ˆåé¢ä¼šè¯´inodeï¼‰</p><p>æ¯ä¸ªç›®å½•éƒ½æœ‰ä¸¤ä¸ªå›ºæœ‰çš„éšè—çš„æ¡ç›®ï¼š<code>.</code>å’Œ<code>..</code>ï¼Œå‰è€…æŒ‡å‘è‡ªå·±ï¼Œåè€…æŒ‡å‘ä¸Šä¸€çº§ç›®å½•ã€‚ä½¿ç”¨<code>ll -a</code>å¯ä»¥æŸ¥çœ‹éšè—ç›®å½•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tap">â•­â”€ ~/Desktop/c-dev                   <br>â•°â”€â¯ ll -a<br>æ€»è®¡ 56K<br>drwxr-xr-x<span class="hljs-number"> 1 </span>kznleaf kznleaf <span class="hljs-number"> 278 </span> 7æœˆ30æ—¥ 11:12 .<br>drwxr-xr-x<span class="hljs-number"> 1 </span>kznleaf kznleaf <span class="hljs-number"> 262 </span> 7æœˆ25æ—¥ 19:56 ..<br>drwxr-xr-x<span class="hljs-number"> 1 </span>kznleaf kznleaf <span class="hljs-number"> 128 </span> 7æœˆ28æ—¥ 22:43 Lock<br>drwxr-xr-x<span class="hljs-number"> 1 </span>kznleaf kznleaf <span class="hljs-number"> 110 </span> 7æœˆ27æ—¥ 12:03 .vscode<br>-rw-r--r--<span class="hljs-number"> 1 </span>kznleaf kznleaf  <span class="hljs-number"> 20 </span> 7æœˆ23æ—¥ 17:48 .clang-format<br>-rw-r--r--<span class="hljs-number"> 1 </span>kznleaf kznleaf <span class="hljs-number"> 778 </span> 7æœˆ23æ—¥ 19:09 home1.c<br>-rw-r--r--<span class="hljs-number"> 1 </span>kznleaf kznleaf  <span class="hljs-number"> 79 </span> 7æœˆ23æ—¥ 19:19 home2.c<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>.</code> <code>..</code><code>.vscode</code>éƒ½å±äºéšè—ç›®å½•ã€‚</p><h3 id="å­˜å‚¨ä½ç½®">å­˜å‚¨ä½ç½®</h3><p><strong>ç›®å½•å¯ä»¥è¢«è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ç±»å‹</strong>ï¼Œåªä¸è¿‡ä¿å­˜çš„ä¸æ˜¯å­—èŠ‚æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—ç›®å½•é¡¹ã€‚å› æ­¤å­˜å‚¨ä½ç½®å’Œä¸€èˆ¬çš„æ–‡ä»¶æ²¡æœ‰åŒºåˆ«ï¼ˆä»ä¸Šé¢å‘½ä»¤çš„è¾“å‡ºç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œç›®å½•å’Œæ–‡ä»¶çš„åœ°ä½æ˜¯ç›¸åŒçš„ï¼‰ã€‚å­—æ¯<code>d</code>ä»£è¡¨ç›®å½•ç±»å‹ï¼Œä¾‹å¦‚<code>drwxr-xr-x</code>ï¼›å…¶ä½™ä¸¤ç§æ–‡ä»¶ç±»å‹åˆ†åˆ«æ˜¯<code>-</code>ï¼ˆæ™®é€šæ–‡ä»¶ï¼‰å’Œ<code>l</code>ï¼ˆç¬¦å·é“¾æ¥ï¼‰ã€‚</p><h2 id="æ–‡ä»¶çš„å…ƒæ•°æ®">æ–‡ä»¶çš„å…ƒæ•°æ®</h2><p>æè¿°æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯è¢«ç§°ä¸º<strong>å…ƒæ•°æ®</strong>ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½¿ç”¨<code>stat</code>å¯ä»¥è·å–æ–‡ä»¶çš„å…ƒæ•°æ®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">â•°â”€â¯ <span class="hljs-built_in">stat</span> test.lua               <br>  æ–‡ä»¶ï¼štest.lua<br>  å¤§å°ï¼š20              å—ï¼š8          IO å—å¤§å°ï¼š4096   ä¸€èˆ¬æ–‡ä»¶<br>è®¾å¤‡ï¼š0,37      Inode: 111926      ç¡¬é“¾æ¥ï¼š1<br>æƒé™ï¼š(0644/-rw-r--r--)  Uid: ( 1000/ kznleaf)   Gid: ( 1000/ kznleaf)<br>è®¿é—®æ—¶é—´ï¼š2025-07-30 11:06:21.136822528 +0800<br>ä¿®æ”¹æ—¶é—´ï¼š2025-07-27 12:02:15.742179634 +0800<br>å˜æ›´æ—¶é—´ï¼š2025-07-27 12:02:15.742179634 +0800<br>åˆ›å»ºæ—¶é—´ï¼š2025-07-27 12:01:52.866903170 +0800<br></code></pre></td></tr></table></figure><h2 id="æ–‡ä»¶æè¿°ç¬¦">æ–‡ä»¶æè¿°ç¬¦</h2><h3 id="ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦">ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦</h3><p>ä»¥ç¨‹åºå‘èµ· IO ç³»ç»Ÿè°ƒç”¨ä¸ºä¾‹æ¥è¯´æ˜ï¼š</p><p>IO æ“ä½œå¾€å¾€éœ€è¦è·å–ç³»ç»Ÿæƒé™ï¼Œæ¯”å¦‚ç¡¬ç›˜ IOæ“ä½œï¼Œå¿…é¡»å‘èµ·ç³»ç»Ÿè°ƒç”¨ã€äº¤ç»™å†…æ ¸ï¼Œè®©å†…æ ¸è´Ÿè´£å®Œæˆèƒ½ä¿è¯å®‰å…¨ï¼ˆå¦‚æœç›´æ¥äº¤ç»™è¿›ç¨‹å»å¹²çš„è¯ï¼Œæ¶æ„ç¨‹åºå°±å¯ä»¥æ¸…ç©ºä½ çš„ç¡¬ç›˜è€Œä¸ä¼šå—åˆ°ä»»ä½•é˜»æ‹¦ï¼‰ã€‚é‚£ä¹ˆå†…æ ¸æ€ä¹ˆçŸ¥é“è¿›ç¨‹æƒ³è¦è®¿é—®çš„æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Ÿé çš„å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½ç›¸å½“äºä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„â€œæƒé™â€ï¼Œæˆ–è€…è¯´â€œå¥æŸ„â€ï¼Œæ‹¿åˆ°è¿™ä¸ªå¥æŸ„å°±å¯ä»¥æ‰§è¡Œç›¸åº”çš„æ“ä½œäº†ã€‚</p><p>æ›´å…·ä½“çš„ä¿¡æ¯ï¼š</p><ul><li>è‹±æ–‡ï¼šfile descriptor (<strong>FD</strong>, less frequently fildes)è¯‘åï¼šæ–‡ä»¶æè¿°ç¬¦</li><li>å–å€¼èŒƒå›´ï¼šæœ‰æ•ˆçš„FDæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œè´Ÿæ•°ä¸€èˆ¬è¡¨ç¤ºä¸å­˜åœ¨æˆ–è€…errorã€‚</li><li>æ–‡ä»¶æè¿°ç¬¦ æ˜¯ POSIX API çš„ä¸€éƒ¨åˆ†ã€‚é™¤äº†å®ˆæŠ¤è¿›ç¨‹ä¹‹å¤–çš„æ¯ä¸ª Unixè¿›ç¨‹éƒ½é»˜è®¤æ‰“å¼€ä¸‰ä¸ªæ ‡å‡† POSIXæ–‡ä»¶æè¿°ç¬¦ï¼šæ ‡å‡†è¾“å…¥(0)ã€æ ‡å‡†è¾“å‡º(1)ã€æ ‡å‡†é”™è¯¯(2)ã€‚</li></ul><h3 id="å¦‚ä½•åˆ†é…">å¦‚ä½•åˆ†é…ï¼Ÿ</h3><p>æ¯æ¬¡æ‰§è¡Œ<strong>IOæ“ä½œ</strong>ï¼Œæ“ä½œç³»ç»Ÿä¼š<strong>ä»å½“å‰è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æ‰¾æœ€å°çš„å¯ç”¨æè¿°ç¬¦ç¼–å·</strong>ä½œä¸ºè¿”å›å€¼ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span> fd1 = open(<span class="hljs-string">&quot;test.txt&quot;</span>, O_RDONLY);<br>    <span class="hljs-type">int</span> fd2 = open(<span class="hljs-string">&quot;test.txt&quot;</span>, O_RDONLY);<br>    <span class="hljs-type">int</span> fd3 = open(<span class="hljs-string">&quot;test.txt&quot;</span>, O_RDONLY);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ–‡ä»¶æè¿°ç¬¦: %d, %d, %d\n&quot;</span>, fd1, fd2, fd3); <br>    <span class="hljs-comment">//close(fd);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Linuxä¸‹è¿è¡Œï¼Œæ¯ä¸€æ¬¡çš„è¾“å‡ºéƒ½æ˜¯<code>æ–‡ä»¶æè¿°ç¬¦ï¼š3, 4, 5</code>ï¼Œä¹‹æ‰€ä»¥ä»3 å¼€å§‹æ˜¯å› ä¸º0ã€1ã€2è¢«ä¸‰ä¸ªé»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦å ç”¨äº†ã€‚åç»­æ¯æ¬¡è°ƒç”¨<code>open</code>ï¼Œéƒ½ä¼šåˆ†é…ä¸€ä¸ªæè¿°ç¬¦ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸€æ—¦æŸä¸ªç³»ç»Ÿè°ƒç”¨è¢«å…³é—­ï¼Œé‚£ä¹ˆå®ƒå ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¼šè¢«ä¸€å¹¶å½’è¿˜ã€‚æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> fd1 = open(<span class="hljs-string">&quot;test.txt&quot;</span>, O_RDONLY);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;first: %d\n&quot;</span>, fd1);<br>    close(fd1);<br>    <span class="hljs-type">int</span> fd2 = open(<span class="hljs-string">&quot;test.txt&quot;</span>, O_RDONLY);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;second: %d\n&quot;</span>, fd2);<br>    close(fd2);<br>    <span class="hljs-type">int</span> fd3 = open(<span class="hljs-string">&quot;test.txt&quot;</span>, O_RDONLY);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;third: %d\n&quot;</span>, fd3);<br>    close(fd3);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ–‡ä»¶æè¿°ç¬¦: %d, %d, %d\n&quot;</span>, fd1, fd2, fd3);<br>    <span class="hljs-comment">// close(fd);</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pid: %d\n&quot;</span>, getpid());<br>    <span class="hljs-comment">// sleep(10);</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">â•­â”€ ~/Desktop<span class="hljs-keyword">/c-dev/</span>Lock                          <br>â•°â”€â¯ ./main                     <br><span class="hljs-symbol">first:</span> <span class="hljs-number">3</span><br><span class="hljs-symbol">second:</span> <span class="hljs-number">3</span><br><span class="hljs-symbol">third:</span> <span class="hljs-number">3</span><br>æ–‡ä»¶æè¿°ç¬¦: <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span><br><span class="hljs-symbol">pid:</span> <span class="hljs-number">5323</span><br></code></pre></td></tr></table></figure><p>ä¸‰ä¸ª<code>open</code>è°ƒç”¨çš„æ–‡ä»¶æè¿°ç¬¦éƒ½æ˜¯3ï¼Œå› ä¸ºæ¯ä¸ªè°ƒç”¨å‘èµ·ä¹‹åï¼Œåœ¨ç¬¬äºŒä¸ªè°ƒç”¨å‘èµ·ä¹‹å‰å°±è¢«å…³é—­äº†ï¼Œå ç”¨çš„æ–‡ä»¶æè¿°ç¬¦3 ä¹Ÿè¢«ä¸€å¹¶å½’è¿˜ã€‚</p><h3 id="é€šè¿‡ç»ˆç«¯æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦">é€šè¿‡ç»ˆç«¯æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦</h3><blockquote><p>åœ¨ Linuxä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆå¯ä»¥ç›´æ¥é€šè¿‡è·¯å¾„<code>/proc/PID/fd/</code>è®¿é—®ï¼Œå…¶ä¸­PIDæ˜¯è¿›ç¨‹æ ‡è¯†ç¬¦ã€‚<code>/proc/PID/fd/0</code>æ˜¯stdinï¼Œ<code>/proc/PID/fd/1</code>æ˜¯stdoutï¼Œ<code>/proc/PID/fd/2</code>æ˜¯stderrã€‚ä»»ä½•è¿è¡Œä¸­çš„è¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡<code>/prec/self/fd</code>å’Œ<code>/dev/fd</code>è®¿é—®è‡ªå·±çš„æ–‡ä»¶æè¿°ç¬¦ã€‚<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://en.wikipedia.org/wiki/File_descriptor">[1]</span></a></sup></p></blockquote><p>å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><ul><li>æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ä¸€ä¸ªç§æœ‰çš„ç”±æ–‡ä»¶æè¿°ç¬¦æ„æˆçš„é›†åˆ</li><li>å¯ä»¥é€šè¿‡è¿›ç¨‹æ ‡è¯†ç¬¦ï¼ˆPIDï¼‰è®¿é—®æŒ‡å®šè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆ</li><li>è¿è¡Œä¸­çš„è¿›ç¨‹å¯ä»¥é€šè¿‡<code>/prec/self/fd</code>è®¿é—®è‡ªå·±çš„æ–‡ä»¶æè¿°ç¬¦</li></ul><p>ç»§ç»­ç”¨æœ€å¼€å§‹çš„çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œä¸è¿‡è¿™æ¬¡åœ¨<code>return 0</code>ä¹‹å‰åŠ ä¸Š<code>sleep</code>è¯­å¥ï¼Œä¸ºæˆ‘ä»¬åœ¨ç»ˆç«¯æ•²å‘½ä»¤é¢„ç•™æ—¶é—´ã€‚å…ˆè¿è¡Œè¿è¡Œæµ‹è¯•ä»£ç ï¼Œè¿”å›PID12551ï¼Œæ‰€ä»¥åœ¨ç»ˆç«¯è¾“å…¥<code>ll /proc/12551/fd</code>è¿”å›å¦‚ä¸‹ï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tap">â•­â”€ ~                                                                       <br>â•°â”€â¯ ll /proc/12551/fd<br>æ€»è®¡ 0<br>lrwx------<span class="hljs-number"> 1 </span>kznleaf kznleaf<span class="hljs-number"> 64 </span> 7æœˆ28æ—¥ 22:45<span class="hljs-number"> 0 </span>-&gt; /dev/pts/1<br>lrwx------<span class="hljs-number"> 1 </span>kznleaf kznleaf<span class="hljs-number"> 64 </span> 7æœˆ28æ—¥ 22:45<span class="hljs-number"> 1 </span>-&gt; /dev/pts/1<br>lrwx------<span class="hljs-number"> 1 </span>kznleaf kznleaf<span class="hljs-number"> 64 </span> 7æœˆ28æ—¥ 22:45<span class="hljs-number"> 2 </span>-&gt; /dev/pts/1<br>lr-x------<span class="hljs-number"> 1 </span>kznleaf kznleaf<span class="hljs-number"> 64 </span> 7æœˆ28æ—¥ 22:45<span class="hljs-number"> 3 </span>-&gt; /home/kznleaf/Desktop/c-dev/Lock/test.txt<br>lr-x------<span class="hljs-number"> 1 </span>kznleaf kznleaf<span class="hljs-number"> 64 </span> 7æœˆ28æ—¥ 22:45<span class="hljs-number"> 4 </span>-&gt; /home/kznleaf/Desktop/c-dev/Lock/test.txt<br>lr-x------<span class="hljs-number"> 1 </span>kznleaf kznleaf<span class="hljs-number"> 64 </span> 7æœˆ28æ—¥ 22:45<span class="hljs-number"> 5 </span>-&gt; /home/kznleaf/Desktop/c-dev/Lock/test.txt<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰å‡ ä¸ªæœ‰è¶£çš„ç‚¹ï¼š</p><ul><li>0~5å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ²¡ä»€ä¹ˆå¯è¯´çš„</li><li><code>lr-x------</code>æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li><code>l</code>æŒ‡çš„æ˜¯è¿™æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥æ–‡ä»¶</li><li><code>r-x</code>æŒ‡è¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼ˆuserï¼‰æœ‰è¯»å’Œæ‰§è¡Œçš„æƒé™ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œæ¯•ç«Ÿæˆ‘ä»¬è°ƒç”¨çš„openæ“ä½œä¸ä¼šå†™å…¥ä»»ä½•ä¿¡æ¯</li><li><code>------</code>ä¸æ˜¯è¿æ¥çº¿ï¼Œè€Œæ˜¯æŒ‡åŒç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·éƒ½æ²¡æœ‰ä»»ä½•æƒé™ã€‚<strong>è¿™ä¹Ÿå°è¯äº†æ–‡ä»¶æè¿°ç¬¦æ˜¯è¿›ç¨‹ç§æœ‰çš„</strong>ã€‚</li></ul></li><li>å¯¹äºopenè°ƒç”¨ï¼Œæ¯ä¸ªè°ƒç”¨äº§ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ<code>/proc/&lt;pid&gt;/fd/æ–‡ä»¶æè¿°ç¬¦ç¼–å·</code>ï¼‰éƒ½æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘çš„éƒ½æ˜¯<code>test.txt</code>è¿™ä¸ªæ–‡ä»¶ã€‚</li></ul><p>æ€»ç»“ï¼šç³»ç»Ÿè°ƒç”¨<code>open</code>ä¼šè¢«åˆ†é…æ–‡ä»¶æè¿°ç¬¦ï¼ŒåŒæ—¶äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ç§æœ‰çš„ç¬¦å·é“¾æ¥æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æŒ‡å‘çš„å°±æ˜¯è¦æ‰“å¼€çš„ç›®æ ‡æ–‡ä»¶ã€‚</p><h2 id="inode">â­inodeâ­</h2><p>æ¯”è¾ƒé‡è¦çš„å†…å®¹</p><h3 id="ä»€ä¹ˆæ˜¯inode">ä»€ä¹ˆæ˜¯inode</h3><p>inodeæ˜¯ index node çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯â€œç´¢å¼•èŠ‚ç‚¹â€ã€‚ä»€ä¹ˆçš„ç´¢å¼•ï¼Ÿ</p><p>æ–‡ä»¶æ•°æ®éƒ½å‚¨å­˜åœ¨"å—(Block)"ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»å‚¨å­˜æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ä»¶çš„åˆ›å»ºè€…ã€æ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸã€æ–‡ä»¶çš„å¤§å°ç­‰ç­‰ã€‚è¿™äº›åˆ°å…ƒä¿¡æ¯æ˜¯ç”±ç³»ç»Ÿåˆ›å»ºçš„ï¼Œä¸ºæ–¹ä¾¿ç³»ç»Ÿä½¿ç”¨è€Œç”Ÿï¼Œä¸å±äºæ–‡ä»¶æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å¦å¤–å†æ‰¾ä¸€ä¸ªåœ°æ–¹å‚¨å­˜å®ƒä»¬ã€‚</p><p>æ–‡ä»¶ç³»ç»Ÿé€šå¸¸ä½¿ç”¨<code>inode</code>ç»“æ„æ¥å‚¨å­˜è¿™äº›æ•°æ®å—çš„å…ƒä¿¡æ¯ã€‚Linuxç³»ç»Ÿä¸‹ï¼Œä¿å­˜çš„å…ƒä¿¡æ¯åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>æ–‡ä»¶å</li><li>å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰</li><li>ç¡¬é“¾æ¥æ•°</li><li>æƒé™ä¿¡æ¯</li><li>è®¿é—®ã€ä¿®æ”¹ã€å˜æ›´ã€åˆ›å»ºæ—¶é—´</li><li>inodeè¿˜ä¿å­˜äº†æŒ‡å‘æ–‡ä»¶æ•°æ®å—çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡é’ˆï¼Œç”¨äºè®¿é—®æ–‡ä»¶æ•°æ®</li></ul><h3 id="ä»€ä¹ˆæ˜¯inode-number">ä»€ä¹ˆæ˜¯inode number</h3><p>inode numberï¼Œæˆ–è€…â€œinodeç¼–å·â€â€œinodeå·ç â€ï¼Œè¯´çš„éƒ½æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p><p>æ¯ä¸ªæ–‡ä»¶éƒ½ä¸ä¸€ä¸ª inode ç›¸å…³è”ï¼Œè®¸å¤šä¸ªinodeå°±æ„æˆäº†<strong>inodeè¡¨</strong>ï¼Œinodeè¡¨æ˜¯ç³»ç»Ÿçº§åˆ«çš„ã€<strong>æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ç»“æ„</strong>ï¼Œä½äºå†…å­˜ä¸­ï¼Œç”±å†…æ ¸ç»Ÿä¸€ç»´æŠ¤å’Œç®¡ç†ï¼Œè®°å½•äº†è¢«ä½¿ç”¨çš„inodeä¿¡æ¯ã€‚<strong>ä¸ºäº†å¿«é€Ÿè®¿é—®inodeè¡¨ä¸­è®°å½•çš„inodeä¿¡æ¯ï¼Œå°±éœ€è¦ä¸ºè¿™ä¸ªè¡¨åŠ ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯inodeç¼–å·</strong>ã€‚</p><p>æ—¢ç„¶inodeè¡¨æ˜¯ç”±å†…æ ¸ç»´æŠ¤å’Œç®¡ç†äº†ï¼Œé‚£ä¹ˆæœ‰äº†è¿™ä¸ªç´¢å¼•ï¼Œå†…æ ¸çš„æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ç¨‹åºå°±å¯ä»¥é€šè¿‡inodeç¼–å·å¿«é€Ÿè®¿é—®inodeä¿¡æ¯ã€‚</p><h3 id="inodeå’Œæ•°æ®å—çš„å…³ç³»">inodeå’Œæ•°æ®å—çš„å…³ç³»</h3><p>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„inodeã€‚</p><p>è®¿é—®ç£ç›˜ä¸­çš„æ–‡ä»¶ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶çš„inodeï¼Œæ‰èƒ½è®¿é—®æ–‡ä»¶æ‰€åœ¨æ•°æ®å—çš„å…·ä½“ä¿¡æ¯ã€‚</p><p><strong>é‚£ä¹ˆï¼Œinodeæ˜¯æ€ä¹ˆè®°å½•æ•°æ®å—çš„ä½ç½®çš„</strong>ï¼Ÿ</p><p>ä¸€ç§ç®€å•çš„æƒ…å½¢æ˜¯åœ¨ inodeä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç›´æ¥æŒ‡é’ˆï¼ˆä»£è¡¨ç£ç›˜åœ°å€ï¼‰ã€‚æ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å±äºè¯¥æ–‡ä»¶çš„ä¸€ä¸ªç£ç›˜å—ã€‚æ‰€ä»¥ï¼Œæ‹¿åˆ°inodeä¹Ÿå°±æ˜¯æ‹¿åˆ°äº†æ–‡ä»¶çš„ç£ç›˜åœ°å€ã€‚</p><p>ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•æœ‰å±€é™ï¼šä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œå¤§äºå—çš„å¤§å°ä¹˜ä»¥ç›´æ¥æŒ‡é’ˆæ•°ï¼‰ï¼Œé‚£å°±ä¸èµ°è¿äº†ï¼Œè¿™æ—¶å°±éœ€è¦åœ¨inodeå¼•å…¥æ–°çš„ç»“æ„â€”â€”å¤šçº§ç´¢å¼•ã€‚</p><p><strong>å¤šçº§ç´¢å¼•</strong></p><p>inodeä¸­ä¸ä»…ç”±ç›´æ¥æŒ‡å‘æ•°æ®å—çš„<strong>ç›´æ¥æŒ‡é’ˆ</strong>ï¼Œè¿˜æœ‰æŒ‡å‘é—´æ¥å—çš„<strong>é—´æ¥æŒ‡é’ˆ</strong>ã€‚æ‰€è°“â€œé—´æ¥å—â€ï¼ŒæŒ‡çš„å°±æ˜¯ç£ç›˜ä¸­ä¸“é—¨å­˜å‚¨æŒ‡é’ˆçš„å—ï¼Œé—´æ¥å—çš„æ¯ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®å—çš„åœ°å€ã€‚</p><p>å¦‚æœæ–‡ä»¶çš„å¤§å°è¶…è¿‡äº†ç›´æ¥æŒ‡é’ˆèƒ½å¤„ç†çš„èŒƒç•´ï¼Œé‚£ä¹ˆæ–‡ä»¶ç³»ç»Ÿå°±ä¼šåˆ†é…ä¸€ä¸ªé—´æ¥å—ï¼Œå¹¶ä¸”è®¾ç½®é—´æ¥æŒ‡é’ˆæŒ‡å‘å®ƒã€‚é—´æ¥æŒ‡é’ˆçš„è®¿é—®é¡ºåºæ˜¯ï¼š<code>é—´æ¥æŒ‡é’ˆ -&gt; é—´æ¥å— -&gt; è®¸å¤šæ•°æ®å—</code></p><p>å¦‚æœæƒ³è¿›ä¸€æ­¥æ‰©å®¹ï¼Œå¯ä»¥å¼•å…¥<strong>åŒé‡é—´æ¥æŒ‡é’ˆ</strong>ï¼š<code>åŒé‡é—´æ¥æŒ‡é’ˆ -&gt; è®¸å¤šé—´æ¥å— -&gt; æ›´å¤šçš„æ•°æ®å—</code>ã€‚å‡å¦‚ä¸€ä¸ªæ•°æ®å—æ˜¯4KBï¼Œä¸€ä¸ªæŒ‡é’ˆå ç”¨4ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆä¸€ä¸ªé—´æ¥å—å¯ä»¥ä¿å­˜1024ä¸ªæŒ‡é’ˆï¼Œ<strong>ä»…ä»…ä¸€ä¸ªåŒé‡é—´æ¥æŒ‡é’ˆå°±å¯ä»¥å¸¦æ¥é¢å¤–4GB çš„å¯»å€ç©ºé—´</strong>ï¼Œéå¸¸å¼ºå¤§ã€‚</p><h3 id="inodeèŠ‚ç‚¹çš„å¤§å°">inodeèŠ‚ç‚¹çš„å¤§å°</h3><h3 id="inodeç¼–å·å’Œæ–‡ä»¶åçš„å…³ç³»">inodeç¼–å·å’Œæ–‡ä»¶åçš„å…³ç³»</h3><p>å‰é¢æåˆ°è¿‡ï¼Œåœ¨ç›®å½•ä¸­çš„æ¯ä¸€ä¸ªç›®å½•é¡¹éƒ½æ˜¯<code>æ–‡ä»¶å - inodeç¼–å·</code>çš„ä¸€å †æ•°æ®ï¼Œé‚£ä¹ˆæ–‡ä»¶åå’Œinodeçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ— æ³•å°†æ‰“å¼€çš„æ–‡ä»¶æ˜ å°„åˆ°ç”¨äºæ‰“å¼€è¯¥æ–‡ä»¶çš„æ–‡ä»¶åã€‚<strong>å½“ç¨‹åºæ‰“å¼€æ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ–‡ä»¶åè½¬æ¢ä¸ºinode ç¼–å·ï¼Œç„¶åä¸¢å¼ƒè¯¥æ–‡ä»¶å</strong>ã€‚</p><p>ä¸€äº›æ“ä½œç³»ç»Ÿä¼šç»´æŠ¤ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä»¥åŠ å¿«æ­¤æ“ä½œçš„è¿è¡Œé€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œåœ¨Linuxè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ(VFS)ä¸­ï¼Œç›®å½•é¡¹ç¼“å­˜ï¼ˆä¹Ÿç§°ä¸º dentry æˆ–dcacheï¼‰æ˜¯å†…æ ¸ç”¨æ¥åŠ é€Ÿæ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„ç¼“å­˜æ¡ç›®ï¼Œå®ƒä»¬å°†ç›®å½•é“¾æ¥çš„ä¿¡æ¯å­˜å‚¨åœ¨RAMä¸­ã€‚<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://en.wikipedia.org/wiki/Inode">[2]</span></a></sup></p></blockquote><p>inodeçš„è¿™ä¸€ç‰¹æ€§å…è®¸æˆ‘ä»¬èµ°åˆ°ä¸å…³é—­è¿›ç¨‹çš„æƒ…å†µä¸‹å¯¹è¿›ç¨‹ä½¿ç”¨çš„æ–‡ä»¶è¿›è¡Œæ›´æ–°ã€‚æ›´æ–°ä¼šåˆ›å»ºæ–°çš„inodeï¼Œå¹¶ä¸”æŠŠåŸæ¥çš„æ–‡ä»¶åå¯¹åº”çš„inodeé‡å®šå‘åˆ°æ–°çš„inodeï¼Œæ­¤åæ–°çš„è¿›ç¨‹ä¼šä½¿ç”¨æ–°çš„æ–‡ä»¶ï¼Œè€Œè¿è¡Œä¸­çš„è¿›ç¨‹ä½¿ç”¨çš„ä»ç„¶æ˜¯åŸæ¥çš„inodeï¼Œå®ç°å¯¹è¿›ç¨‹é€æ˜çš„æ›¿æ¢æ“ä½œã€‚å½“æ—§çš„inodeæ²¡æœ‰è¢«ä»»ä½•è¿›ç¨‹ä½¿ç”¨ï¼Œå¹¶ä¸”å¼•ç”¨è®¡æ•°é™ä¸º0æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è¢«ç³»ç»Ÿå›æ”¶ã€‚è¿™ä¹Ÿæ˜¯Linuxç³»ç»Ÿçš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p><h2 id="åˆ›å»ºæ–‡ä»¶-link">åˆ›å»ºæ–‡ä»¶-link</h2><p>è¯´å®Œinodeæ—§å¾ˆå¥½ç†è§£é“¾æ¥äº†ã€‚</p><h3 id="ç¡¬é“¾æ¥">ç¡¬é“¾æ¥</h3><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå®é™…ä¸Šåšäº†ä¸¤ä»¶äº‹:</p><ul><li>é¦–å…ˆï¼Œè¦æ„å»ºä¸€ä¸ªç»“æ„ï¼ˆinodeï¼‰ï¼Œå®ƒå°†è·Ÿè¸ªå‡ ä¹æ‰€æœ‰å…³äºæ–‡ä»¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶å¤§å°ã€æ–‡ä»¶å—åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ç­‰ç­‰ã€‚</li><li>å…¶æ¬¡ï¼Œå°†äººç±»å¯è¯»çš„æ–‡ä»¶åé“¾æ¥åˆ°è¯¥æ–‡ä»¶ï¼Œå¹¶å°†è¯¥é“¾æ¥æ”¾å…¥ç›®å½•ä¸­ã€‚</li></ul><p>åœ¨åˆ›å»ºæ–‡ä»¶çš„ç¡¬é“¾æ¥ä¹‹åï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ŒåŸæœ‰æ–‡ä»¶åï¼ˆfileï¼‰å’Œæ–°åˆ›å»ºçš„æ–‡ä»¶åï¼ˆfile2ï¼‰ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚å®é™…ä¸Šï¼Œ<strong>å®ƒä»¬éƒ½åªæ˜¯æŒ‡å‘æ–‡ä»¶åº•å±‚å…ƒæ•°æ®çš„é“¾æ¥</strong>ï¼Œå¯ä»¥åœ¨<strong>åŒä¸€ä¸ªinodeç¼–å·</strong>ä¸­æ‰¾åˆ°ã€‚</p><p>å¼•ç”¨è®¡æ•°ï¼ˆæœ‰æ—¶ç§°ä¸ºé“¾æ¥è®¡æ•°ï¼Œlinkcountï¼‰å…è®¸æ–‡ä»¶ç³»ç»Ÿè·Ÿè¸ªæœ‰å¤šå°‘ä¸åŒçš„æ–‡ä»¶åå·²ç¡¬é“¾æ¥åˆ°è¿™ä¸ªinodeã€‚å¦‚æœå¼•ç”¨è®¡æ•°ä¸º0ï¼Œæ–‡ä»¶ç³»ç»Ÿæ‰ä¼šé‡Šæ”¾inodeå’Œç›¸å…³çš„æ•°æ®ã€‚çœŸæ­£åˆ é™¤è¯¥æ–‡ä»¶ã€‚</p><h3 id="è½¯é“¾æ¥">è½¯é“¾æ¥</h3><p>ç¬¦å·é“¾æ¥ symbolic link</p><p>ç¡¬é“¾æ¥åªé€‚ç”¨äºæ–‡ä»¶ï¼Œä¸èƒ½ç”¨äºç›®å½•ã€‚å› æ­¤äººä»¬åˆå‘æ˜äº†è½¯é“¾æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s &lt;åŸåç§°&gt; &lt;ç¬¦å·é“¾æ¥åç§°&gt;<br></code></pre></td></tr></table></figure><p>ç¬¦å·é“¾æ¥å’Œç¡¬é“¾æ¥å®Œå…¨ä¸åŒï¼Œå®ƒæ˜¯æ–‡ä»¶ç³»ç»Ÿç»§æ–‡ä»¶ã€ç›®å½•ä¹‹åçš„ç¬¬ä¸‰ç§ç±»å‹ã€‚åœ¨<code>ls -l</code>çš„ä¿¡æ¯ä¸­ï¼š</p><ul><li><code>-</code>ä»£è¡¨æ–‡ä»¶</li><li><code>d</code>ä»£è¡¨ç›®å½•</li><li><code>l</code>ä»£è¡¨è½¯é“¾æ¥</li></ul><p>è½¯é“¾æ¥æŒ‡å‘æ–‡ä»¶çš„è·¯å¾„åï¼Œè·¯å¾„åè¶Šé•¿ï¼Œé“¾æ¥æ–‡ä»¶è¶Šå¤§ã€‚</p><p><strong>æ‚¬ç©ºå¼•ç”¨</strong>ï¼šåˆ é™¤åŸå§‹æ–‡ä»¶ä¼šå¯¼è‡´è½¯é“¾æ¥æŒ‡å‘ä¸å­˜åœ¨çš„è·¯å¾„åã€‚</p><h2id="æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶è¡¨å’Œinodeè¡¨çš„å…³ç³»">æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶è¡¨å’Œinodeè¡¨çš„å…³ç³»</h2><p>ä¸‹é¢è¿™å¼ å›¾æ¥è‡ªwikiï¼Œæè¿°äº†<strong>å•ä¸ªè¿›ç¨‹</strong>çš„æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶è¡¨å’Œinodeè¡¨çš„å…³ç³»</p><p><img src="https://s21.ax1x.com/2025/07/28/pVYdwvD.png" /></p><p>æ–‡ä»¶æè¿°ç¬¦ 3 æ²¡æœ‰æŒ‡å‘ä»»ä½•æ¡ç›®ï¼Œè¡¨ç¤ºå®ƒå·²ç»è¢«å…³é—­äº†ã€‚</p><h2 id="è¯»å†™ç£ç›˜">è¯»å†™ç£ç›˜</h2><h3 id="è¯»å–æ–‡ä»¶æ— ç¼“å­˜">è¯»å–æ–‡ä»¶ï¼ˆæ— ç¼“å­˜ï¼‰</h3><p>æœ‰äº†å‰é¢çš„ä¸€å¤§å †é“ºå«ï¼Œç»ˆäºå¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜è¯´æ¸…æ¥šäº†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŠ å…¥æˆ‘ä»¬è¦è®¿é—®<code>/home/file.txt</code>è¿™ä¸ªæ–‡ä»¶ã€‚æ—¶åˆ»è®°ä½ï¼š<strong>åªæœ‰æ‹¿åˆ°ç›®å½•çš„<code>inode</code>èŠ‚ç‚¹ï¼Œæ‰èƒ½è®¿é—®å®ƒçš„ç›®å½•é¡¹</strong>ã€‚</p><ol type="1"><li>æ ¹ç›®å½•<code>/</code>çš„inodeç¼–å·æ˜¯å®ç°æ¸…æ¥šçš„ï¼Œä¸€èˆ¬å›ºå®šä¸º2ï¼Œæ‰€ä»¥ç³»ç»Ÿå¯ä»¥ç›´æ¥æ‹¿åˆ°æ ¹ç›®å½•çš„inode</li><li>è¯»å–<code>/</code>çš„æ•°æ®å—ï¼Œä¹Ÿå°±æ˜¯è¯»å–ç›®å½•é¡¹ï¼Œæ ¹æ®æ–‡ä»¶åæ‰¾åˆ°<code>home</code>ï¼Œè¿›è€Œå¾—åˆ°inodeç¼–å·</li><li>è¯»å–<code>/home/</code>è·¯å¾„ä¸‹çš„ç›®å½•é¡¹ï¼Œæ‰¾åˆ°<code>file.txt</code>çš„inodeç¼–å·ï¼Œè‡³æ­¤ç»ˆäºæ‹¿åˆ°ç›®æ ‡æ–‡ä»¶çš„inodeï¼</li><li>inodeä¸­è®°å½•äº†<code>file.txt</code>è¿™ä¸ªæ–‡ä»¶åœ¨ç£ç›˜ä¸­çš„åœ°å€æŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥å®šä½ç£ç›˜çš„å…·ä½“ä½ç½®ï¼Œå¼€å§‹è¯»å–æ•°æ®å—å†…å®¹äº†ã€‚</li><li>è¯»å–æ“ä½œä¹Ÿä¼šæ›´æ–°inodeçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´</li></ol><h3 id="å†™å…¥æ–‡ä»¶æ— ç¼“å†²">å†™å…¥æ–‡ä»¶ï¼ˆæ— ç¼“å†²ï¼‰</h3><p>åˆ›å»ºæ–‡ä»¶æ¶‰åŠåˆ°ä¸€èµ·åˆ—æ“ä½œï¼šè¯»å–inodeçš„bitmapï¼ˆbitmapè®°å½•äº†æ•°æ®å—çš„å ç”¨æƒ…å†µï¼‰ï¼Œæ›´æ–°bitmapï¼Œæ›´æ–°è¯¥æ–‡ä»¶çš„inodeï¼Œæ›´æ–°æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ›´æ–°æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•çš„inodeã€‚åˆ›å»ºå’Œå†™å…¥æ–‡ä»¶çš„æ—¶é—´çº¿ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/31/pVtNKSS.png" /></p><h3 id="cahe-and-buffering">cahe and buffering</h3><p><strong>cacheï¼šç¼“å­˜</strong>ï¼Œè¿™é‡Œä¸»è¦æŒ‡ç›®å½•é¡¹ç¼“å­˜<code>dentry</code></p><p>å¦‚ä¸Šé¢çš„ä¾‹å­æ‰€ç¤ºï¼Œè¯»å–å’Œå†™å…¥æ–‡ä»¶çš„æˆæœ¬æ˜¯éå¸¸å¤§çš„ï¼Œè€Œä¸”è·¯å¾„è¶Šé•¿ï¼Œæ£€ç´¢æ–‡ä»¶çš„å¼€é”€å°±è¶Šå¤§ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿéƒ½ä¼šä½¿ç”¨DRAMï¼Œå°†<code>è·¯å¾„ -&gt; inode</code>çš„æ˜ å°„ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡è®¿é—®å°±ä¸éœ€è¦ä»æ ¹ç›®å½•ä¸€å±‚ä¸€å±‚å¾€ä¸‹æ‰¾äº†ã€‚</p><p>ç›®å½•é¡¹ç¼“å­˜å¯¹è¯»å–æ“ä½œçš„æå‡æ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œç”šè‡³shellçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ä¹Ÿå—ç›Šäºdentryã€‚</p><p><strong>bufferingï¼šç¼“å†²</strong>ï¼Œè®¨è®ºä¸€ä¸‹å†™ç¼“å†²</p><p>Write bufferingæ˜¯æŒ‡å†™å…¥æ“ä½œæ—¶ï¼Œæ•°æ®å…ˆå†™å…¥å†…å­˜ä¸­çš„ç¼“å­˜åŒºåŸŸï¼ˆè€Œä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜ï¼‰ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼Œä»¥æé«˜æ€§èƒ½ï¼Œå‡å°‘I/Oæ¬¡æ•°ã€‚é€šè¿‡å»¶è¿Ÿå†™å…¥ï¼Œæ–‡ä»¶ç³»ç»Ÿå¯ä»¥ç§¯æ”’ä¸€æ‰¹å†™å…¥æ“ä½œï¼ŒåŒæ—¶æ‰§è¡Œï¼Œè¿˜å¯ä»¥é¿å…æ— æ•ˆæ“ä½œï¼Œæ¯”å¦‚å¦‚æœä¸€ä¸ªæ–‡ä»¶çš„inodeä½å›¾è¢«æ›´æ–°äº†ä¸¤æ¬¡ï¼Œé‚£ä¹ˆåªä¼šæ‰§è¡Œæœ€åé‚£ä¸€æ¬¡ã€‚</p><p>å½“ç„¶å†™å…¥ç¼“å†²ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œåƒæ•°æ®åº“è¿™ç§ç¨‹åºï¼Œä¸ºäº†é¿å…æ•°æ®æ„å¤–ä¸¢å¤±ï¼Œè¦æ±‚ç«‹å³å†™å…¥ã€‚ç”¨Cè¯­è¨€æ¥è¯´ï¼Œè¿™æ—¶å¯ä»¥åœ¨<code>write</code>å‘½ä»¤åç´§è·Ÿä¸€æ¡<code>fsync</code>ï¼Œç«‹å³å†™å…¥ç£ç›˜ï¼Œä¸ç»è¿‡ç¼“å­˜ã€‚</p><h2 id="å´©æºƒä¸€è‡´æ€§">å´©æºƒä¸€è‡´æ€§</h2><h3 id="é—®é¢˜æå‡º">é—®é¢˜æå‡º</h3><p>å¦‚æœå‡ºç°æ–­ç”µæˆ–è€…ç³»ç»Ÿå´©æºƒï¼Œå¦‚ä½•æ›´æ–°ç£ç›˜ï¼Ÿ</p><p>å…ˆå‡å®šä¸€ç§ç®€å•çš„æ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/31/pVtdSJ0.png" /></p><p>ç„¶åè§£é‡Šä¸€ä¸‹ä½å›¾ã€inodeå’Œæ•°æ®å—å„è‡ªçš„ä½œç”¨ï¼š</p><table><thead><tr><th>åè¯</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>æ•°æ®å—ï¼ˆData Blockï¼‰</strong></td><td>ç”¨äºå®é™…å­˜å‚¨æ–‡ä»¶å†…å®¹çš„ç£ç›˜å—</td></tr><tr><td><strong>æ•°æ®ä½å›¾ï¼ˆBlock Bitmapï¼ŒB[v2]ï¼‰</strong></td><td>ä¸€ä¸ªä½å›¾ï¼Œè®°å½•å“ªäº›æ•°æ®å—æ˜¯â€œè¢«ä½¿ç”¨â€çš„ï¼ˆå³ 0 ä»£è¡¨ç©ºé—²ï¼Œ1ä»£è¡¨å·²å ç”¨ï¼‰</td></tr><tr><td><strong>inodeï¼ˆI[v2]ï¼‰</strong></td><td>åŒ…å«æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼ˆæ–‡ä»¶å¤§å°ã€æƒé™ã€æ—¶é—´æˆ³ï¼‰å’Œ<strong>æŒ‡å‘æ•°æ®å—çš„åœ°å€</strong></td></tr></tbody></table><p>å®Œæ•´çš„å†™å…¥æ•°æ®è¿‡ç¨‹éœ€è¦æŠŠæ•°æ®å—ã€ä½å›¾å’Œinodeéƒ½æ›´æ–°ä¸€éã€‚ä½†æ˜¯è¿™ä¸‰æ­¥ä¸æ˜¯åŸå­çš„ï¼Œå¦‚æœæ›´æ–°è¿‡ç¨‹ä¸­ç³»ç»Ÿå´©æºƒã€æ–­ç”µï¼Œä¼šå‡ºç°æ•…éšœï¼Œä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><p>å¦‚æœä½å›¾å’Œæ•°æ®å—éƒ½è¢«å†™å…¥äº†ï¼Œä½†æ˜¯inodeæ²¡è¢«å†™å…¥ï¼Œé‚£ä¹ˆç›¸å½“äºæŸä¸ªè½¦ä½è¢«å ç”¨äº†ï¼Œä½†æ˜¯æ²¡æœ‰è®°å½•è°åœäº†è¿™ä¸ªè½¦ã€‚è¿™ç§inodeæ²¡å†™å…¥ä½†æ˜¯ä½å›¾å·²ç»å†™å…¥çš„å—è¢«ç§°ä¸º<strong>å­¤å„¿å—</strong>ï¼Œä¼šé€ æˆç£ç›˜ç©ºé—´çš„æ°¸ä¹…æµªè´¹ã€‚</p><h3 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h3><ol type="1"><li><strong>æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ç¨‹åº</strong></li></ol><p>ä»£è¡¨ï¼š<code>fsck</code>å‘½ä»¤ã€‚fsckï¼ˆfile system consistency checkï¼‰æ˜¯Unix å’Œç±» Unixç³»ç»Ÿä¸Šç”¨äºæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§çš„å·¥å…·[1]ã€‚å®ƒç±»ä¼¼äºWindowså’ŒMS-DOSä¸Šçš„CHKDSKã€‚é€‚ç”¨äºext2/3/4æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹äºBtrfsè¿™ç§å†™æ—¶å¤åˆ¶ç³»ç»Ÿæ¥è¯´ä¸éœ€è¦è¿™ä¸ªå‘½ä»¤ï¼Œå› ä¸ºç³»ç»Ÿæœ¬èº«å·²ç»ä¿è¯äº†ä¸€è‡´æ€§ã€‚</p><p><code>fsck</code>ï¼ˆå’Œç±»ä¼¼çš„æ–¹æ³•ï¼‰æœ‰ä¸€ä¸ªæ›´å¤§çš„ã€ä¹Ÿè®¸æ›´æ ¹æœ¬çš„é—®é¢˜ï¼šå®ƒä»¬å¤ªæ…¢äº†ã€‚å¯¹äºéå¸¸å¤§çš„ç£ç›˜å·ï¼Œæ‰«ææ•´ä¸ªç£ç›˜ï¼Œä»¥æŸ¥æ‰¾æ‰€æœ‰å·²åˆ†é…çš„å—å¹¶è¯»å–æ•´ä¸ªç›®å½•æ ‘ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæˆ–å‡ å°æ—¶ã€‚éšç€ç£ç›˜å®¹é‡çš„å¢é•¿å’ŒRAIDçš„æ™®åŠï¼Œfsckçš„æ€§èƒ½å˜å¾—ä»¤äººæœ›è€Œå´æ­¥ã€‚</p><hr /><ol start="2" type="1"><li><strong>æ•°æ®æ—¥å¿—</strong></li></ol><figure><img src="https://s21.ax1x.com/2025/07/31/pVtwYB4.png"alt="æ•°æ®æ—¥å¿—ç¤ºæ„å›¾" /><figcaption aria-hidden="true">æ•°æ®æ—¥å¿—ç¤ºæ„å›¾</figcaption></figure><p>åœ¨æ›´æ–°ç£ç›˜å†…å®¹ä¹‹å‰ï¼ŒæŠŠè¦åšçš„äº‹æƒ…å†™å…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—ã€‚è¿™æ ·ç³»ç»Ÿåœ¨å´©æºƒåå°±èƒ½å‡†ç¡®çŸ¥é“è¦ä¿®å¤çš„ä¿¡æ¯ã€‚å…ˆå†™æ—¥å¿—ï¼Œå†è¦†å†™ç£ç›˜ã€‚</p><p>é¦–å…ˆåº”è¯¥äº†è§£ç£ç›˜æä¾›çš„åŸå­æ€§ä¿è¯ï¼šç£ç›˜ä¿è¯ä»»ä½•512å­—èŠ‚çš„å†™å…¥éƒ½ä¼šå‘ç”Ÿæˆ–ä¸å‘ç”Ÿã€‚<strong>ext3</strong>æ–‡ä»¶ç³»ç»Ÿçš„æ—¥å¿—å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol type="1"><li><strong>æ—¥å¿—å†™å…¥</strong>ï¼šå°†äº‹åŠ¡çš„å†…å®¹ï¼ˆå¼€å§‹å—ã€æ•°æ®å—ã€‚å…ƒæ•°æ®å—ï¼ˆinodeï¼Œä½å›¾ï¼‰ï¼‰å†™å…¥æ—¥å¿—ï¼Œ<strong>ç­‰å¾…</strong>å†™å…¥å®Œæˆã€‚å…¶ä¸­äº‹åŠ¡å¼€å§‹ï¼ˆTxBï¼‰å‘Šè¯‰æˆ‘ä»¬æœ‰å…³æ­¤æ›´æ–°çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯¹æ–‡ä»¶ç³»ç»Ÿå³å°†è¿›è¡Œçš„æ›´æ–°çš„ç›¸å…³ä¿¡æ¯</li><li><strong>æ—¥å¿—æäº¤</strong>ï¼šå°†äº‹åŠ¡æäº¤å—å†™å…¥æ—¥å¿—ï¼Œ<strong>ç­‰å¾…</strong>å†™å…¥å®Œæˆï¼Œå®Œæˆåˆ™è¢«è§†ä¸ºäº‹åŠ¡å·²ç»æäº¤</li><li><strong>åŠ æ£€æŸ¥ç‚¹</strong>ï¼šå°†æ•°æ®å’Œå…ƒæ•°æ®å†™å…¥ç£ç›˜ã€‚</li></ol><p>åœ¨ext4ä¸­ï¼Œæ•´ä¸ªäº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ€§å†™å…¥æ—¥å¿—ï¼Œæ— éœ€ç­‰å¾…ï¼Œè¿™æ˜¯å› ä¸ºå¼€å§‹å—å’Œç»“æŸå—ä¸­åŠ å…¥äº†æ—¥å¿—å†…å®¹çš„æ ¡éªŒå’Œï¼Œå¦‚æœæ ¡éªŒå’Œä¸åŒ¹é…å°±ä¼šä¸¢å¼ƒäº‹åŠ¡ã€‚</p><p><strong>æ—¥å¿—çš„ç©ºé—´å ç”¨</strong></p><p>æ—¥å¿—çš„å¤§å°æœ‰é™ï¼Œæ—¥å¿—æ»¡æ—¶ï¼Œé€šè¿‡é‡ç”¨ç©ºé—´çš„æ–¹å¼æ¥è§£å†³ã€‚ä¸€æ—¦äº‹åŠ¡è¢«åŠ æ£€æŸ¥ç‚¹ï¼Œæ–‡ä»¶ç³»ç»Ÿåº”é‡Šæ”¾å®ƒåœ¨æ—¥å¿—ä¸­å ç”¨çš„ç©ºé—´ï¼Œå…è®¸é‡ç”¨æ—¥å¿—ç©ºé—´ã€‚æ”¹è¿›åçš„æ­¥éª¤ï¼š</p><ol type="1"><li>æ—¥å¿—å†™å…¥ï¼šå°†äº‹åŠ¡çš„å†…å®¹ï¼ˆåŒ…æ‹¬TxBå’Œæ›´æ–°å†…å®¹ï¼‰å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…è¿™äº›å†™å…¥å®Œæˆã€‚</li><li>æ—¥å¿—æäº¤ï¼šå°†äº‹åŠ¡æäº¤å—ï¼ˆåŒ…æ‹¬TxEï¼‰å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å®Œæˆï¼Œäº‹åŠ¡è¢«è®¤ä¸ºå·²æäº¤ï¼ˆcommittedï¼‰ã€‚</li><li>åŠ æ£€æŸ¥ç‚¹ï¼šå°†æ›´æ–°å†…å®¹å†™å…¥å…¶æœ€ç»ˆçš„ç£ç›˜ä½ç½®ã€‚</li><li>é‡Šæ”¾ï¼šä¸€æ®µæ—¶é—´åï¼Œé€šè¿‡æ›´æ–°æ—¥å¿—è¶…çº§å—ï¼Œåœ¨æ—¥å¿—ä¸­æ ‡è®°è¯¥äº‹åŠ¡ä¸ºç©ºé—²ã€‚</li></ol><hr /><ol start="3" type="1"><li><strong>æœ‰åºæ—¥å¿—</strong></li></ol><figure><img src="https://s21.ax1x.com/2025/07/31/pVtwIv8.png" alt="æœ‰åºæ—¥å¿—" /><figcaption aria-hidden="true">æœ‰åºæ—¥å¿—</figcaption></figure><p>ä¸Šé¢çš„æ—¥å¿—å°†æ•°æ®å—ä¹Ÿå†™å…¥æ—¥å¿—äº†ï¼ŒåŒä¸€ä¸ªæ•°æ®å—è¦è¢«å†™å…¥ä¸¤æ¬¡ï¼Œæ€§èƒ½æ¯”è¾ƒå·®ã€‚<strong>æœ‰åºæ—¥å¿—</strong>æˆ–è€…<strong>å…ƒæ•°æ®æ—¥å¿—</strong>æ²¡æœ‰æŠŠç”¨æˆ·æ•°æ®ä¹Ÿå†™å…¥æ—¥å¿—ï¼Œè€Œæ˜¯å…ˆæŠŠæ•°æ®å—å†™å…¥æœ€ç»ˆä½ç½®ï¼Œç„¶åå†è®°å½•æ—¥å¿—ã€‚ï¼ˆç›®å½•ä¹Ÿå±äºå…ƒæ•°æ®ï¼Œä¼šè¢«ä¿å­˜åˆ°è¿™é‡Œï¼‰</p><p>Linux ext3çš„æœ‰åºæ—¥å¿—ï¼š</p><ol type="1"><li>æ•°æ®å†™å…¥ï¼šå°†æ•°æ®å†™å…¥æœ€ç»ˆä½ç½®ï¼Œç­‰å¾…å®Œæˆï¼ˆç­‰å¾…æ˜¯å¯é€‰çš„ï¼Œè¯¦è§ä¸‹æ–‡ï¼‰ã€‚</li><li>æ—¥å¿—å…ƒæ•°æ®å†™å…¥ï¼šå°†å¼€å§‹å—å’Œå…ƒæ•°æ®å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å…¥å®Œæˆã€‚</li><li>æ—¥å¿—æäº¤ï¼šå°†äº‹åŠ¡æäº¤å—ï¼ˆåŒ…æ‹¬<code>TxE</code>ï¼‰å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å®Œæˆï¼Œç°åœ¨è®¤ä¸ºäº‹åŠ¡ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰å·²æäº¤ï¼ˆ<code>committed</code>ï¼‰ã€‚</li><li>åŠ æ£€æŸ¥ç‚¹å…ƒæ•°æ®ï¼šå°†å…ƒæ•°æ®æ›´æ–°çš„å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­çš„æœ€ç»ˆä½ç½®ã€‚</li><li>é‡Šæ”¾ï¼šç¨åï¼Œåœ¨æ—¥å¿—è¶…çº§å—ä¸­å°†äº‹åŠ¡æ ‡è®°ä¸ºç©ºé—²ã€‚</li></ol><p>ï¼ˆåªè¦ä¿è¯æäº¤äº‹åŠ¡ä¹‹å‰å®Œæˆæ­¥éª¤ä¸€å’Œæ­¥éª¤äºŒå³å¯ï¼Œä¸ä¸€å®šéè¦ç­‰æ­¥éª¤ä¸€å®Œæˆä¹‹åæ‰å¼€å§‹å†™å…¥æ—¥å¿—ï¼‰</p><p>æœ‰åºæ—¥å¿—çš„æ ¸å¿ƒæ€æƒ³ï¼š<strong>å…ˆå†™å…¥è¢«æŒ‡å¯¹è±¡ï¼Œå†å†™å…¥æŒ‡é’ˆå¯¹è±¡</strong></p><p>é™¤äº†ä»¥ä¸Šå‡ ç§è§£å†³æ–¹æ¡ˆä¹‹å¤–ï¼Œç°ä»£æ–‡ä»¶ç³»ç»Ÿè¿˜æœ‰åŸºäºå†™æ—¶å¤åˆ¶ä¹‹ç±»çš„æ›´é«˜çº§çš„æ€è·¯ï¼Œè¿™é‡Œå…ˆä¸è¯´äº†ã€‚</p><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://en.wikipedia.org/wiki/File_descriptor<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:2"class="footnote-text"><span>https://en.wikipedia.org/wiki/Inode<a href="#fnref:2" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºäºŒæ‰‹ç¬”è®°æœ¬é‡è£…Arch Linuxç³»ç»Ÿè¿‡ç¨‹è®°å½•</title>
    <link href="/2025/07/29/%E4%BA%8C%E6%89%8B%E7%AC%94%E8%AE%B0%E6%9C%ACArch/"/>
    <url>/2025/07/29/%E4%BA%8C%E6%89%8B%E7%AC%94%E8%AE%B0%E6%9C%ACArch/</url>
    
    <content type="html"><![CDATA[<p>I use arch btw</p><span id="more"></span><p>ä¸ºä»€ä¹ˆè¦ä¸“é—¨ä¹°ä¸€ä¸ªç ´ç¬”è®°æœ¬å®‰è£… GNU/Linuxç³»ç»Ÿï¼Ÿä¸€æ–¹é¢æ˜¯å› ä¸ºæœ€è¿‘åœ¨çœ‹ã€Šæ“ä½œç³»ç»Ÿå¯¼è®ºã€‹ï¼Œè¿™æœ¬ä¹¦æ˜¯åŸºäº UNIXç³»ç»Ÿè®²è§£çš„ï¼Œå½“ç„¶ä¹Ÿå®Œå…¨é€‚ç”¨äºGNU/Linuxï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆè™šæ‹Ÿæœºä¸Šçš„linuxè¾“å…¥å»¶è¿Ÿæ¯”è¾ƒå¤§ï¼Œæ—©å°±æƒ³è£…åˆ°å®ä½“æœºä¸Šä½“éªŒä¸€ä¸‹äº†ï¼›å¦ä¸€æ–¹é¢ï¼Œæœ€è¿‘å‡ ä¸ªæœˆæ²¡å°‘è¢«win11æ¶å¿ƒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>å¼ºåˆ¶å¯ç”¨hyper-v</li><li>Alt+Tabæ‰“ä¹±è¾“å…¥æ³•</li><li>æ¡Œé¢å›¾æ ‡æ¯æ¬¡å¼€æœºåéƒ½ä¼šé‡æ–°æ’åˆ—</li><li>ç¡çœ æ¨¡å¼æ¦‚ç‡ç¡æ­»ä¸”ç¡¬ç›˜é€šç”µæ¬¡æ•°æš´å¢</li><li>è¶Šæ›´æ–°bugè¶Šå¤šï¼Œåœ¨7æœˆ9æ—¥æ›´æ–°ä¹‹åæ¯æ¬¡ç¬”è®°æœ¬å¼€æœºéƒ½æœ‰å¾ˆå¤§çš„æ¦‚ç‡è“å±</li></ul><p>æ‰€ä»¥æˆ‘è€ƒè™‘è½¬å‘ GNU/Linuxã€‚</p><h2 id="é€‰å‹">é€‰å‹</h2><p>é¢„ç®—ï¼š1000ï¿¥ä»¥å†…ï¼Œé™„åŠ è¦æ±‚ï¼šèƒ½è‡ªç”±æ›´æ¢å°½å¯èƒ½å¤šçš„ç»„ä»¶</p><p>å»å’¸é±¼ä¸Šè½¬äº†ä¸€å¤§åœˆï¼Œèƒ½æŠŠä»·æ ¼å‹åˆ°1000ä»¥å†…çš„åŸºæœ¬éƒ½æ˜¯å…­ä¸ƒå¹´ä»¥å‰çš„è€ç¬”è®°æœ¬ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¨æ–°çš„ä½†æ˜¯æˆ‘æ²¡æ¡åˆ°æ¼ã€‚æœ€åç›¯ä¸Šäº†ä¸¤æ¬¾ï¼š</p><ul><li>ä¸€ä¸ªä¸“é—¨å– ThinkPad çš„è´©å­çš„ e470ï¼Œ880ï¿¥</li><li>è”æƒ³å°æ–°è€å‹å·ï¼Œè¿™ä¸ªå–çš„äººä¸€å¤§æŠŠï¼Œ600ï¿¥</li></ul><p>æœ€åæœ¬ç€ä¾¿å®œä¼˜å…ˆçš„åŸåˆ™æ‹ä¸‹äº†è”æƒ³å°æ–°2019ä¸æ¬¾ã€‚æ‹†å¼€åç›–é©¬ä¸Šå°±åæ‚”äº†...ä¸å¦‚æ¢æˆæ›´æ–¹ä¾¿æŠ˜è…¾çš„thinkpad</p><p>ä»Šå¤©çœ‹åˆ°äº†ä¸€ä¸ªè§†é¢‘ï¼š<ahref="https://www.youtube.com/watch?v=vtkQiLkNgOI">Building the ultimateThinkPad!</a>ï¼Œè§†é¢‘é‡Œç»™Think PadT440Pé‡Œé‡Œå¤–å¤–éƒ½æ¢äº†ä¸€åœˆï¼ŒåŒ…æ‹¬é”®ç›˜ã€å†…å­˜ã€ç¡¬ç›˜ã€BIOSã€å±å¹•ã€ç”šè‡³å°±è¿ CPUä¹Ÿæ˜¯å¯æ‹†å¸çš„ï¼ˆæ’æ§½å¼CPUï¼‰ğŸ˜²</p><p>ç„¶åå»æŸå®çœ‹äº†ä¸€çœ¼ï¼Œ700+å°±èƒ½æ‹¿ä¸‹ï¼Œæ—©çŸ¥é“ä¹°è¿™ä¸ªäº†ã€‚ç­‰æ‰¾åˆ°å®ä¹ æ”’å¤Ÿäº†é’±å°±æä¸€ä¸ªå›æ¥ç©ç©</p><h2 id="æ‹†æœº">æ‹†æœº</h2><figure><img src="https://s21.ax1x.com/2025/07/28/pVYu5DS.jpg" alt="æ‹†æœº" /><figcaption aria-hidden="true">æ‹†æœº</figcaption></figure><p>å¤å¤SATAå›ºæ€ï¼Œè£¸éœ²çš„å•çƒ­ç®¡ï¼Œè¿˜æœ‰å†…å­˜æ¡çš„å±è”½ç½©è·‘å“ªå„¿å»äº†ğŸ˜­ç®—äº†èƒ½ç”¨å°±è¡Œã€‚åç›–ä¸Šçš„é˜²æ‹†è´´è¿˜åœ¨ï¼Œä»æ’¬å¼€åç›–éœ€è¦çš„åŠ›åº¦æ¥çœ‹è¿™ä¸ªç¬”è®°æœ¬ä¸åƒæ˜¯è¢«æ‹†è¿‡çš„ï¼Œè«éæ˜¯ğŸ•â€ğŸ¦ºæƒ³åœ¨ä½œå¦–</p><p>ç„¶åæŠŠé£æ‰‡å–ä¸‹æ¥æ¸…äº†æ¸…ç°ï¼Œå‘ç°åŸºæœ¬æ²¡ä»€ä¹ˆç°å¯ä»¥æ¸…ã€‚å¦å¤–å†…å­˜å’Œç½‘å¡éƒ½å¤ªçƒ‚äº†ï¼Œæ‰€ä»¥é©¬ä¸Šä¸‹å•äº†ä¸€æ ¹16Gå†…å­˜å’ŒAX210ç½‘å¡ï¼Œè¿‡ä¸¤å¤©ä¸€åˆ°è´§é©¬ä¸Šå¼€å§‹æ¢ã€‚ç³»ç»Ÿä¿¡æ¯ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/28/pVYKuUH.jpg"alt="æ‡’å¾—æˆªå›¾äº†" /><figcaption aria-hidden="true">æ‡’å¾—æˆªå›¾äº†</figcaption></figure><h2 id="è£…ç³»ç»Ÿ">è£…ç³»ç»Ÿ</h2><p>ä¸»è¦å‚è€ƒ<ahref="https://arch.icekylin.online/">archlinuxç®€æ˜æŒ‡å—</a>å’Œ<ahref="https://www.bilibili.com/video/BV1L2gxzVEgs/?spm_id_from=333.337.search-card.all.click&amp;vd_source=918a6909c997fbaf818d1fbc55d65ca9">è¿™ä¸ªè§†é¢‘</a>ã€‚è¯´ä¸€ä¸‹åˆ†ç›˜æ€è·¯ï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS<br>sda      8:0   <span class="hljs-number"> 0 </span>238.5G <span class="hljs-number"> 0 </span>disk <br>â”œâ”€sda1   8:1   <span class="hljs-number"> 0 </span>    1G <span class="hljs-number"> 0 </span>part /boot/efi<br>â””â”€sda2   8:2   <span class="hljs-number"> 0 </span>237.5G <span class="hljs-number"> 0 </span>part /swap<br>                                 /home<br>                                 /<br></code></pre></td></tr></table></figure><p>ä¸€å…±256Gçš„ç¡¬ç›˜ï¼Œç»™ UEFIåˆ†äº†1Gï¼Œå‰©ä¸‹çš„éƒ½ç”¨åšæ ¹ç›®å½•ã€‚æ²¡æœ‰ä¸ºswapåˆ›å»ºåˆ†åŒºï¼Œå› ä¸ºç”¨çš„æ˜¯swapæ–‡ä»¶ã€‚æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨btrfsï¼Œæ–¹ä¾¿å¿«ç…§å’Œå›æ»šã€‚</p><h2 id="å‡çº§å†…å­˜ç½‘å¡">å‡çº§å†…å­˜&amp;ç½‘å¡</h2><p>è¿™ä¸ªç¬”è®°æœ¬è‡ªå¸¦çš„å†…å­˜æ˜¯ç„Šæ­»çš„ 4G å’Œä¸€æ ¹å¯æ›´æ¢çš„DDR4 4Gï¼Œä¸€å…±8Gï¼Œå®é™…å·¥ä½œé¢‘ç‡æ˜¯2400MHzã€‚ä¸è¿‡è‡ªå¸¦çš„å†…å­˜æ¡ä¸Šå†™çš„æ˜¯2666ï¼Œä¼°è®¡æ˜¯è¢«å‹ä¸‹å»äº†ã€‚</p><p>8Gå†…å­˜æ„Ÿè§‰è¿˜æ˜¯å°äº†ï¼Œå› ä¸ºè¿˜è¦ç»™ GPU åˆ†è¿‡å» 2Gã€‚æ‰€ä»¥å»pddæ¡äº†æ ¹16G2666MHzï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/28/pVYuJAJ.jpg" alt="å†…å­˜" /><figcaption aria-hidden="true">å†…å­˜</figcaption></figure><p>æ˜¯ä¸æ˜¯çœŸè´§ä¸çŸ¥é“ï¼Œåæ­£ç”¨ç€æ²¡æ¯›ç—…</p><hr /><p>è‡ªå¸¦çš„ç½‘å¡æ˜¯ QCA9377ï¼Œæœ‰ç‚¹å¤ªè€äº†ï¼Œæ¢æˆAX210ï¼Œç®€å•æ¯”è¾ƒä¸€ä¸‹ï¼š</p><table><thead><tr><th>å‚æ•°</th><th><strong>Intel AX210</strong></th><th><strong>Qualcomm Atheros QCA9377</strong></th></tr></thead><tbody><tr><td>ğŸ†” èŠ¯ç‰‡ä»£å·</td><td>Typhoon Peak</td><td>Sparrow</td></tr><tr><td>ğŸ“¶ Wi-Fiæ ‡å‡†</td><td>Wi-Fi 6Eï¼ˆ802.11axï¼‰</td><td>Wi-Fi 5ï¼ˆ802.11acï¼‰</td></tr><tr><td>ğŸ“¡ é¢‘æ®µæ”¯æŒ</td><td>2.4 GHz + 5 GHz + 6 GHzï¼ˆä¸‰é¢‘ï¼‰</td><td>2.4 GHz + 5 GHzï¼ˆåŒé¢‘ï¼‰</td></tr><tr><td>ğŸ“Š MIMOé…ç½®</td><td>2x2 MU-MIMO</td><td>1x1 SU-MIMO</td></tr><tr><td>ğŸš€ ç†è®ºæœ€å¤§é€Ÿç‡</td><td>~2.4 Gbpsï¼ˆ802.11axï¼‰</td><td>~433 Mbpsï¼ˆ802.11acï¼‰</td></tr><tr><td>ğŸ“± è“ç‰™ç‰ˆæœ¬</td><td>è“ç‰™ 5.2</td><td>è“ç‰™ 4.1</td></tr><tr><td>ğŸ”§ Linux æ”¯æŒ</td><td>âœ… æ–°å†…æ ¸ï¼ˆ5.10+ï¼‰+ æœ€æ–°å›ºä»¶</td><td>âœ… è€å†…æ ¸ï¼ˆ4.xï¼‰ä¹Ÿæ”¯æŒ</td></tr><tr><td>ğŸ”‹ åŠŸè€—</td><td>ç•¥é«˜ï¼Œä½†ä¸ºé«˜æ€§èƒ½è®¾è®¡</td><td>ä½åŠŸè€—ï¼ˆé€‚åˆç§»åŠ¨è®¾å¤‡ï¼‰</td></tr><tr><td>ğŸ§  æŠ€æœ¯æ”¯æŒ</td><td>OFDMA, TWT, WPA3 ç­‰æ–°ç‰¹æ€§</td><td>åŸºç¡€ 802.11ac åŠŸèƒ½</td></tr><tr><td>ğŸ§± åº”ç”¨åœºæ™¯</td><td>é«˜ç«¯ç¬”è®°æœ¬ã€æ¡Œé¢ã€Wi-Fi 6Eè·¯ç”±å™¨</td><td>è€æ—§ç¬”ç”µã€Chromebookã€ä¾¿æºè®¾å¤‡</td></tr></tbody></table><p>Linuxå†…æ ¸å·²ç»å†…ç½®äº†å¤§é‡ä¸»æµç½‘å¡çš„é©±åŠ¨ï¼ŒåŒ…æ‹¬ AX210åœ¨å†…ï¼Œæ‰€ä»¥æ¢ä¸Šç½‘å¡ä¹‹åä»€ä¹ˆä¹Ÿä¸ç”¨å¹²å°±å¯ä»¥ç›´æ¥å¼€å§‹ç”¨äº†ã€‚ï¼ˆè“ç‰™é¼ æ ‡è¦é‡æ–°é…å¯¹ï¼‰</p><p>æ¢å®Œç½‘å¡æ„Ÿè§‰ä¸ä»…ç½‘é€Ÿå˜å¿«ï¼Œè€Œä¸”è“ç‰™é¼ æ ‡çš„è¿æ¥é€Ÿåº¦å’Œçµæ•åº¦ä¹Ÿå¿«å¤šäº†=w=</p><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰çš„ç½‘å¡ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lspci | grep -i net<br></code></pre></td></tr></table></figure><ul><li><code>lspci</code>ï¼šåˆ—å‡ºæ‰€æœ‰ PCI æ€»çº¿ä¸Šçš„è®¾å¤‡</li><li><code>| grep -i net</code>å¯¹è¾“å‡ºç»“æœè¿›è¡Œç­›é€‰ï¼Œåªä¿ç•™åŒ…å«<code>net</code>çš„è¡Œ</li></ul><p>è¾“å‡ºï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">â•­â”€ <span class="hljs-symbol">~                                                                          10</span>:<span class="hljs-number">45</span><span class="hljs-punctuation">:</span><span class="hljs-number">12</span><br>â•°â”€â¯ lspci <span class="hljs-string">| grep -i net</span><br><span class="hljs-number">01</span><span class="hljs-punctuation">:</span><span class="hljs-number">00.0</span> Network controller<span class="hljs-punctuation">:</span> Intel Corporation Wi<span class="hljs-punctuation">-</span>Fi <span class="hljs-number">6</span>E<span class="hljs-punctuation">(</span><span class="hljs-number">802.11</span>ax<span class="hljs-punctuation">)</span> AX210/AX1675* <span class="hljs-number">2</span>x2 [Typhoon Peak] <span class="hljs-punctuation">(</span>rev <span class="hljs-number">1</span>a<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>lsmod | grep iwlwifi</code>æŸ¥çœ‹ wifié©±åŠ¨åŠ è½½æƒ…å†µã€‚ç­‰ä»¥åç»„äº†å°å¼æœºå¯ä»¥å†æŠŠè¿™å¼ ç½‘å¡æ¢ä¸Šï¼Œæƒ³æƒ³å°±çˆ½</p><h2 id="å®ç”¨å·¥å…·">å®ç”¨å·¥å…·</h2><h3 id="ä»£ç†">ä»£ç†</h3><p>ç›®å‰ä½¿ç”¨<ahref="https://v2raya.org/">v2raya</a>ï¼Œé€Ÿåº¦å°šå¯ï¼Œä½¿ç”¨æ–¹æ³•å‚è§<ahref="https://pengtech.net/network/v2rayA_install.html#3-1-%E9%85%8D%E7%BD%AE-v2rayA">è¿™ç¯‡åšå®¢</a>ã€‚</p><h3 id="å›¾åƒæŸ¥çœ‹">å›¾åƒæŸ¥çœ‹</h3><p>ä¸€å¼€å§‹ç”¨çš„æ˜¯<code>gwenview</code>ï¼Œæ„Ÿè§‰å¡å¡çš„ï¼Œå°è¯•å¥½å‡ ç§å›¾åƒæŸ¥çœ‹å™¨ä¹‹åå‘ç°<code>Okular</code>ä¹Ÿå¯ä»¥ç”¨æ¥çœ‹å›¾åƒï¼Œè€Œä¸”æµç•…å¾—å¤š=w=</p><h3 id="ç¡¬ç›˜æµ‹é€Ÿ">ç¡¬ç›˜æµ‹é€Ÿ</h3><p>å®‰è£…<code>hdparm</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S hdparm<br></code></pre></td></tr></table></figure><p>æµ‹è¯•è¯»å–é€Ÿåº¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> hdparm -Tt /dev/sdX<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">â•°â”€â¯ <span class="hljs-built_in">sudo</span> hdparm -Tt /dev/sda<br><br>/dev/sda:<br> Timing cached reads:   19300 MB <span class="hljs-keyword">in</span>  1.98 seconds = 9725.01 MB/sec<br> Timing buffered disk reads: 1328 MB <span class="hljs-keyword">in</span>  3.01 seconds = 441.80 MB/sec<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œæ˜¯CPUç¼“å­˜æµ‹è¯•ï¼Œç¬¬äºŒè¡Œæ˜¯é¡ºåºè¯»é€Ÿåº¦ã€‚</p><h3 id="æ–‡ä»¶äº’ä¼ ">æ–‡ä»¶äº’ä¼ </h3><p>LocalSend æ˜¯ä¸€æ¬¾è·¨å¹³å°çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå¯ä»¥ç›´æ¥ä»AURå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yay -S localsend<br></code></pre></td></tr></table></figure><p>windowsã€å®‰å“ã€Linuxï¼Œåªè¦åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹ï¼Œéƒ½å¯ä»¥éå¸¸æ–¹ä¾¿åœ°äº’ä¼ æ–‡ä»¶ï¼Œå¼ºæ¨</p><h3 id="ç›‘è§†ç³»ç»Ÿä¿¡æ¯">ç›‘è§†ç³»ç»Ÿä¿¡æ¯</h3><p>btopï¼Œ<del>è£…bç¥å™¨</del></p><p><img src="https://s21.ax1x.com/2025/07/29/pVYTngS.png" /></p><h3 id="æˆªå›¾">æˆªå›¾</h3><p>Windowsç³»ç»Ÿä¸‹æœ€å¥½ç”¨çš„æˆªå›¾å·¥å…·æ— ç–‘æ˜¯Snipasteï¼Œä½†æ˜¯è¿Ÿè¿Ÿæ²¡æœ‰æ¨å‡ºLinuxç‰ˆæœ¬ã€‚</p><p><code>Spectacle</code>å¯ä»¥ä¸€ç”¨ï¼Œè™½ç„¶æ¯”ä¸ä¸ŠSnipasteï¼Œä½†ä¹Ÿå¤Ÿç”¨äº†ã€‚</p><h2 id="ç¾åŒ–">ç¾åŒ–</h2><ul><li>ä¸»é¢˜ç¾åŒ–å‚è€ƒ<ahref="https://www.bilibili.com/video/BV1WsGmzRECp/?spm_id_from=333.337.search-card.all.click&amp;vd_source=918a6909c997fbaf818d1fbc55d65ca9">è¿™ä¸ªè§†é¢‘</a>ï¼Œä½¿ç”¨Nordic ä¸»é¢˜ï¼Œç›´æ¥è§£å†³äº†æ¯›ç»ç’ƒæ•ˆæœæ— æ³•ä½¿ç”¨çš„é—®é¢˜ã€‚</li><li>Konsole ä½¿ç”¨ zsh + <ahref="https://github.com/romkatv/powerlevel10k">powerlevel10k</a>ç¾åŒ–</li></ul><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/29/pVYRJVf.png" /></p><h2 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜</h2><h3 id="é”å±åŠ¨ç”»å¤±æ•ˆé—®é¢˜">é”å±åŠ¨ç”»å¤±æ•ˆé—®é¢˜</h3><p>å’Œ <ahref="https://bugs.kde.org/show_bug.cgi?id=499377&amp;utm_source=chatgpt.com">Bug499377</a> åæ˜ çš„é—®é¢˜å®Œå…¨ç›¸åŒï¼ŒåŒæ ·çš„ error æ—¥å¿—ä¹Ÿå‡ºç°åœ¨<ahref="https://bugs.kde.org/show_bug.cgi?id=478601">Bug478601</a>ï¼Œè¡¨ç°ä¸ºæ¯æ¬¡åˆ‡æ¢è‡³é”å±ç•Œé¢çš„æ—¶å€™æ˜¾ç¤ºå™¨éƒ½ä¼šå˜æˆå·¦åŠè¾¹çº¯ç»¿è‰²ã€å³åŠè¾¹çº¯é»‘ï¼ŒåŠ¨ç”»ç»“æŸä¹‹ååˆä¼šæ¢å¤æ­£å¸¸ã€‚</p><p>å…ˆè°ƒç”¨<code>journalctl -r</code>æŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼Œå®šä½é”å±å‡ºé”™ä¿¡æ¯</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">7</span>æœˆ <span class="hljs-number">26</span> <span class="hljs-number">12</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Arch kscreenlocker_greet[<span class="hljs-number">3176</span>]: Fai<br><span class="hljs-attribute">led</span> to write to the pipe: é”™è¯¯çš„æ–‡ä»¶æè¿°ç¬¦.<br><span class="hljs-attribute">7</span>æœˆ <span class="hljs-number">26</span> <span class="hljs-number">12</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Arch kscreenlocker_greet[<span class="hljs-number">3176</span>]: qt.<br><span class="hljs-attribute">qpa</span>.wayland: Could not create EGL surface (EGL error <span class="hljs-number">0</span>x3000)<br></code></pre></td></tr></table></figure><p><code>kscreenlocker_greet</code>ï¼šè´Ÿè´£é”å±ç•Œé¢æ¸²æŸ“ï¼Œè¯´æ˜æ˜¯é”å±ç•Œé¢åœ¨æ¸²æŸ“EGL æ—¶å¤±è´¥ï¼Œä¸´æ—¶æ˜¾ç¤ºå¼‚å¸¸ã€‚ä¸Šè¿°æ—¥å¿—çš„è§£é‡Šï¼š</p><blockquote><p>è¿™æ˜¯â€¯Plasmaâ€¯6 åœ¨â€¯Waylandâ€¯é”å±ç¨‹åº kscreenlocker_greeté‡Œç•™ä¸‹çš„å·²ç¡®è®¤â€¯bugï¼ˆKDEâ€¯Bugâ€¯478601/499377ï¼‰ã€‚æ—¥å¿—é‡Œ 0x3000 å®é™…ä»£è¡¨EGL_SUCCESSï¼Œä½† Qtä»æŠŠå®ƒå½“ä½œè­¦å‘Šæ‰“å°å‡ºæ¥ã€‚ç›®å‰ä¸Šæ¸¸å°šæœªåˆå¹¶ä¿®å¤è¡¥ä¸ï¼Œå¾ˆå¤šç”¨æˆ·éƒ½ä¼šåœ¨è§£é”æˆ–æ˜¾ç¤ºå™¨é‡æ–°ç‚¹äº®æ—¶çœ‹åˆ°åŒæ ·çš„ä¸¤è¡Œä¿¡æ¯ã€‚</p></blockquote><p>æ‰€ä»¥è¯´è¿™åº”è¯¥æ˜¯ç›®å‰ Wayland çš„ä¸€ä¸ªå¾…ä¿®å¤bugã€‚äºæ˜¯æˆ‘å°è¯•åˆ‡æ¢ä¸ºX11ï¼Œå‘ç°<code>/usr/share/xsessions/</code>ä¸ºç©ºï¼Œåæ¥æ‰çŸ¥é“X11ä¼šè¯æ–‡ä»¶è¢«æ‹†æˆäº†ç‹¬ç«‹çš„åŒ…<code>plasmaâ€‘x11â€‘session</code>æä¾›ï¼Œæ‰€ä»¥éœ€è¦å…ˆå•ç‹¬å®‰è£…è¿™ä¸ªè½¯ä»¶åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -S plasmaâ€‘x11â€‘session<br></code></pre></td></tr></table></figure><p>åˆ‡æ¢ä¸ºX11åï¼Œéœ€è¦é‡æ–°è®¾å®šå±å¹•ç¼©æ”¾æ¯”ä¾‹å’Œé¼ æ ‡çµæ•åº¦ï¼Œå…¶ä¸­å±å¹•ç¼©æ”¾æ¯”ä¾‹å¿…é¡»æ³¨é”€é‡æ–°ç™»å½•åæ‰èƒ½ç”Ÿæ•ˆï¼›è€Œä¸”x11æƒ…å†µä¸‹æŸäº›åº”ç”¨ç¨‹åºçš„åŠ¨æ•ˆå˜å¾—ååˆ†å¡é¡¿ï¼Ÿå¦å¤–ï¼Œé”å±åŠ¨ç”»ä¹Ÿæ˜¯ä¸å­˜åœ¨çš„ï¼Œè€Œæ˜¯ä»åŸæœ¬çš„ç”»é¢ç”Ÿç¡¬åœ°åˆ‡æ¢åˆ°é”å±ç”»é¢ï¼Œè·Ÿæˆ‘é¢„æœŸçš„ä¸ä¸€æ ·ã€‚è€ƒè™‘åˆ°ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/26/pVJ5nzQ.png" /></p><p>æ‰€ä»¥æœ€åè¿˜æ˜¯æ¢å› Wayland äº†QAQæš‚æ—¶çš„åº”å¯¹æ–¹æ¡ˆå°±æ˜¯ç›´æ¥ç¦ç”¨æ‰è‡ªåŠ¨é”å±ï¼ˆåæ­£æˆ‘ä¹Ÿæ²¡ä»€ä¹ˆé”å±çš„éœ€æ±‚ï¼‰</p><h3 id="minecraftå¯åŠ¨å¤±è´¥">Minecraftå¯åŠ¨å¤±è´¥</h3><p>è§<ahref="/2025/07/25/ArchLinux%E5%90%AF%E5%8A%A8mc%E5%B4%A9%E6%BA%83/">/2025/07/25/ArchLinux%E5%90%AF%E5%8A%A8mc%E5%B4%A9%E6%BA%83/</a></p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>é«˜è€ƒå®Œçš„æš‘å‡ä¹°äº†ä¸ªè”æƒ³æ‹¯æ•‘è€…R7000Pï¼Œä½œä¸ºä¸€ä¸ªæ¸¸æˆæœ¬å¯¹æˆ‘æ¥è¯´æ€§èƒ½æœ‰äº›å†—ä½™äº†ï¼Œå› ä¸ºå¹³æ—¶åŸºæœ¬ä¸æ‰“æ¸¸æˆï¼Œè€Œä¸”å››äº”æ–¤çš„é‡é‡å’Œä¸å­˜åœ¨çš„ç»­èˆªæ²¡å°‘æŠ˜ç£¨æˆ‘:(ã€‚å¦‚æœèƒ½å›åˆ°é‚£ä¸ªæš‘å‡ï¼Œæˆ‘ä¼°è®¡ä¼šä¹°ä¸€ä¸ªæ€§èƒ½å¥½ç‚¹çš„è½»è–„æœ¬å’Œä¸€ä¸ªthinkpadï¼Œä¸€ä¸ªç”¨æ¥ç³Šå¼„è¯¾å†…æ¯«æ— æ„ä¹‰çš„è¯¾ç¨‹ï¼Œä¸€ä¸ªè£…ä¸ŠArchç”¨æ¥æŠ˜è…¾ï¼Œå½“ç„¶æœ€é‡è¦çš„æ˜¯åŠè‡ªå·±æŠ¥è€ƒè½¯ä»¶ä¸“ä¸šï¼Œåˆ«è¸é©¬ç›¯ç€ä½ é‚£ç‰©ç†äº†ã€‚</p><p>åˆšæ‰çœ‹åˆ°äº†<ahref="https://www.youtube.com/watch?v=m_QAvGlh-Pg">è¿™ä¸ªè§†é¢‘</a>ï¼ŒçœŸæ­£çš„CS å¤§ä½¬åªéœ€è¦èŠ±è´¹300$ï¼ŒåŒ…æ‹¬ä¸€ä¸ªè£…äº† Ubuntu çš„ThinkPadï¼Œåˆ·äº†çº¯å‡€ç³»ç»Ÿçš„è€å¼ç´¢å°¼æ”¶é›†ï¼Œå’Œå‡ ä¸ªç”µå­é˜…è¯»å™¨(Kindleï¼ŒNOOK)å°±è¶³ä»¥æ»¡è¶³æ—¥å¸¸å­¦ä¹ éœ€æ±‚ã€‚ç›¸æ¯”ä¹‹ä¸‹é‚£ç¾¤å¤©å¤©å«Œå¼ƒè‡ªå·±çš„è®¾å¤‡å¤ªåƒåœ¾ï¼ˆå…¶å®åªæ˜¯æ¸¸æˆæ‰“å¾—ä¸å¤Ÿçˆ½ç½¢äº†ï¼‰äº’ç›¸æ”€æ¯”çš„å¤§å­¦ç”Ÿæœ‰å¤Ÿå¯ç¬‘çš„:)</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArchLinuxè¿è¡Œ 1.8.9 Minecraftå¤±è´¥è§£å†³æ–¹æ³•</title>
    <link href="/2025/07/25/ArchLinux%E5%90%AF%E5%8A%A8mc%E5%B4%A9%E6%BA%83/"/>
    <url>/2025/07/25/ArchLinux%E5%90%AF%E5%8A%A8mc%E5%B4%A9%E6%BA%83/</url>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2><p>ç”¨ HTML å¯åŠ¨1.8.9ç‰ˆæœ¬ï¼Œéœ€è¦ä¸‹è½½Java8ï¼Œä½¿ç”¨å‘½ä»¤<code>sudo pacman -S jdk8-openjdk</code>æˆåŠŸå®‰è£…ï¼Œç„¶åç”¨java8è¿è¡Œæ¸¸æˆï¼Œå¯åŠ¨å¤±è´¥ï¼Œ<code>./minecraft/crash-resources</code>ç›®å½•ä¸‹çš„å´©æºƒæ—¥å¿—å®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">----</span> <span class="hljs-string">Minecraft</span> <span class="hljs-string">Crash</span> <span class="hljs-string">Report</span> <span class="hljs-string">----</span><br><span class="hljs-string">//</span> <span class="hljs-string">Don&#x27;t</span> <span class="hljs-string">be</span> <span class="hljs-string">sad,</span> <span class="hljs-string">have</span> <span class="hljs-string">a</span> <span class="hljs-string">hug!</span> <span class="hljs-string">&lt;3</span><br><br><span class="hljs-attr">Time:</span> <span class="hljs-number">25</span><span class="hljs-number">-7</span><span class="hljs-number">-25</span> <span class="hljs-string">ä¸‹åˆ6:03</span><br><span class="hljs-attr">Description:</span> <span class="hljs-string">Initializing</span> <span class="hljs-string">game</span><br><br><span class="hljs-string">java.lang.ExceptionInInitializerError</span><br><span class="hljs-string">at</span> <span class="hljs-string">Config.getDisplayModes(Config.java:1862)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.settings.GameSettings$Options.&lt;clinit&gt;(GameSettings.java:3384)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.settings.GameSettings.&lt;init&gt;(GameSettings.java:313)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.Minecraft.func_71384_a(Minecraft.java:395)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.Minecraft.func_99999_d(Minecraft.java:329)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.main.Main.main(SourceFile:124)</span><br><span class="hljs-string">at</span> <span class="hljs-string">sun.reflect.NativeMethodAccessorImpl.invoke0(Native</span> <span class="hljs-string">Method)</span><br><span class="hljs-string">at</span> <span class="hljs-string">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="hljs-string">at</span> <span class="hljs-string">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="hljs-string">at</span> <span class="hljs-string">java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.launchwrapper.Launch.launch(Launch.java:135)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.launchwrapper.Launch.main(Launch.java:28)</span><br><span class="hljs-attr">Caused by: java.lang.ArrayIndexOutOfBoundsException:</span> <span class="hljs-number">0</span><br><span class="hljs-string">at</span> <span class="hljs-string">org.lwjgl.opengl.LinuxDisplay.getAvailableDisplayModes(LinuxDisplay.java:951)</span><br><span class="hljs-string">at</span> <span class="hljs-string">org.lwjgl.opengl.LinuxDisplay.init(LinuxDisplay.java:738)</span><br><span class="hljs-string">at</span> <span class="hljs-string">org.lwjgl.opengl.Display.&lt;clinit&gt;(Display.java:138)</span><br><span class="hljs-string">...</span> <span class="hljs-number">12</span> <span class="hljs-string">more</span><br><br><br><span class="hljs-string">A</span> <span class="hljs-string">detailed</span> <span class="hljs-string">walkthrough</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">error,</span> <span class="hljs-attr">its code path and all known details is as follows:</span><br><span class="hljs-string">---------------------------------------------------------------------------------------</span><br><br><span class="hljs-string">--</span> <span class="hljs-string">Head</span> <span class="hljs-string">--</span><br><span class="hljs-attr">Stacktrace:</span><br><span class="hljs-string">at</span> <span class="hljs-string">Config.getDisplayModes(Config.java:1862)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.settings.GameSettings$Options.&lt;clinit&gt;(GameSettings.java:3384)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.settings.GameSettings.&lt;init&gt;(GameSettings.java:313)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.Minecraft.func_71384_a(Minecraft.java:395)</span><br><br><span class="hljs-string">--</span> <span class="hljs-string">Initialization</span> <span class="hljs-string">--</span><br><span class="hljs-attr">Details:</span><br><span class="hljs-attr">Stacktrace:</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.Minecraft.func_99999_d(Minecraft.java:329)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.client.main.Main.main(SourceFile:124)</span><br><span class="hljs-string">at</span> <span class="hljs-string">sun.reflect.NativeMethodAccessorImpl.invoke0(Native</span> <span class="hljs-string">Method)</span><br><span class="hljs-string">at</span> <span class="hljs-string">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="hljs-string">at</span> <span class="hljs-string">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="hljs-string">at</span> <span class="hljs-string">java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.launchwrapper.Launch.launch(Launch.java:135)</span><br><span class="hljs-string">at</span> <span class="hljs-string">net.minecraft.launchwrapper.Launch.main(Launch.java:28)</span><br><br><span class="hljs-string">--</span> <span class="hljs-string">System</span> <span class="hljs-string">Details</span> <span class="hljs-string">--</span><br><span class="hljs-attr">Details:</span><br><span class="hljs-attr">Minecraft Version:</span> <span class="hljs-number">1.8</span><span class="hljs-number">.9</span><br><span class="hljs-attr">Operating System:</span> <span class="hljs-string">Linux</span> <span class="hljs-string">(amd64)</span> <span class="hljs-string">version</span> <span class="hljs-number">6.15</span><span class="hljs-number">.7</span><span class="hljs-string">-arch1-1</span><br><span class="hljs-attr">Java Version:</span> <span class="hljs-number">1.8</span><span class="hljs-string">.0_462,</span> <span class="hljs-string">Arch</span> <span class="hljs-string">Linux</span><br><span class="hljs-attr">Java VM Version:</span> <span class="hljs-string">OpenJDK</span> <span class="hljs-number">64</span><span class="hljs-string">-Bit</span> <span class="hljs-string">Server</span> <span class="hljs-string">VM</span> <span class="hljs-string">(mixed</span> <span class="hljs-string">mode),</span> <span class="hljs-string">Arch</span> <span class="hljs-string">Linux</span><br><span class="hljs-attr">Memory:</span> <span class="hljs-number">130908928</span> <span class="hljs-string">bytes</span> <span class="hljs-string">(124</span> <span class="hljs-string">MB)</span> <span class="hljs-string">/</span> <span class="hljs-number">301989888</span> <span class="hljs-string">bytes</span> <span class="hljs-string">(288</span> <span class="hljs-string">MB)</span> <span class="hljs-string">up</span> <span class="hljs-string">to</span> <span class="hljs-number">7952400384</span> <span class="hljs-string">bytes</span> <span class="hljs-string">(7584</span> <span class="hljs-string">MB)</span><br><span class="hljs-attr">JVM Flags:</span> <span class="hljs-number">17</span> <span class="hljs-string">total;</span> <span class="hljs-string">-Xmx7559m</span> <span class="hljs-string">-XX:+UnlockExperimentalVMOptions</span> <span class="hljs-string">-XX:+UnlockDiagnosticVMOptions</span> <span class="hljs-string">-XX:+UseG1GC</span> <span class="hljs-string">-XX:G1MixedGCCountTarget=5</span> <span class="hljs-string">-XX:G1NewSizePercent=20</span> <span class="hljs-string">-XX:G1ReservePercent=20</span> <span class="hljs-string">-XX:MaxGCPauseMillis=50</span> <span class="hljs-string">-XX:G1HeapRegionSize=32m</span> <span class="hljs-string">-XX:-OmitStackTraceInFastThrow</span> <span class="hljs-string">-XX:MaxInlineLevel=15</span> <span class="hljs-string">-XX:-DontCompileHugeMethods</span> <span class="hljs-string">-XX:MaxNodeLimit=240000</span> <span class="hljs-string">-XX:NodeLimitFudgeFactor=8000</span> <span class="hljs-string">-XX:TieredCompileTaskTimeout=10000</span> <span class="hljs-string">-XX:ReservedCodeCacheSize=400M</span> <span class="hljs-string">-XX:NmethodSweepActivity=1</span><br><span class="hljs-attr">IntCache: cache:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">tcache:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">allocated:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">tallocated:</span> <span class="hljs-number">0</span><br><span class="hljs-attr">FML:</span> <br><span class="hljs-attr">Loaded coremods (and transformers):</span> <br><span class="hljs-attr">Launched Version:</span> <span class="hljs-number">1.8</span><span class="hljs-number">.9</span><span class="hljs-string">-Forge-OptiFine</span><br><span class="hljs-attr">LWJGL:</span> <span class="hljs-number">2.9</span><span class="hljs-number">.4</span><br><span class="hljs-attr">OpenGL:</span> <span class="hljs-string">~~ERROR~~</span> <span class="hljs-attr">RuntimeException:</span> <span class="hljs-literal">No</span> <span class="hljs-string">OpenGL</span> <span class="hljs-string">context</span> <span class="hljs-string">found</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">current</span> <span class="hljs-string">thread.</span><br><span class="hljs-attr">GL Caps:</span> <br><span class="hljs-attr">Using VBOs:</span> <span class="hljs-string">~~ERROR~~</span> <span class="hljs-attr">NullPointerException:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">Is Modded:</span> <span class="hljs-string">Definitely;</span> <span class="hljs-string">Client</span> <span class="hljs-string">brand</span> <span class="hljs-string">changed</span> <span class="hljs-string">to</span> <span class="hljs-string">&#x27;fml,forge&#x27;</span><br><span class="hljs-attr">Type:</span> <span class="hljs-string">Client</span> <span class="hljs-string">(map_client.txt)</span><br><span class="hljs-attr">Resource Packs:</span> <span class="hljs-string">~~ERROR~~</span> <span class="hljs-attr">NullPointerException:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">Current Language:</span> <span class="hljs-string">~~ERROR~~</span> <span class="hljs-attr">NullPointerException:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">Profiler Position:</span> <span class="hljs-string">N/A</span> <span class="hljs-string">(disabled)</span><br><span class="hljs-attr">CPU:</span> <span class="hljs-string">&lt;unknown&gt;</span><br><span class="hljs-attr">OptiFine Version:</span> <span class="hljs-string">OptiFine_1.8.9_HD_U_M5</span><br><span class="hljs-attr">OptiFine Build:</span> <span class="hljs-number">20210124</span><span class="hljs-number">-163719</span><br><span class="hljs-attr">Shaders:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">OpenGlVersion:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">OpenGlRenderer:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">OpenGlVendor:</span> <span class="hljs-literal">null</span><br><span class="hljs-attr">CpuCount:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å…³é”®åœ¨è¿™ä¸¤è¡Œï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Caused by: java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.ArrayIndexOutOfBoundsException</span>: <span class="hljs-number">0</span><br>at org<span class="hljs-selector-class">.lwjgl</span><span class="hljs-selector-class">.opengl</span><span class="hljs-selector-class">.LinuxDisplay</span><span class="hljs-selector-class">.getAvailableDisplayModes</span>(LinuxDisplay<span class="hljs-selector-class">.java</span>:<span class="hljs-number">951</span>)<br><br>OpenGL: ~~ERROR~~ RuntimeException: No OpenGL context found <span class="hljs-keyword">in</span> the current thread.<br></code></pre></td></tr></table></figure><p>å¯¹åº”ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol type="1"><li><strong>lwjgl è·å–ä¸åˆ°ä»»ä½•æ˜¾ç¤ºæ¨¡å¼</strong></li><li><strong>æ‰¾ä¸åˆ° OpenGL</strong></li></ol><p>ç¡¬ä»¶ä¿¡æ¯ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/25/pVJ0yPx.png" alt="ç¡¬ä»¶ä¿¡æ¯" /><figcaption aria-hidden="true">ç¡¬ä»¶ä¿¡æ¯</figcaption></figure><h2 id="é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</h2><p>å…ˆæ’æŸ¥openGLç›¸å…³çš„é—®é¢˜ï¼š</p><ol type="1"><li>æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯ã€åŠ è½½çš„å†…æ ¸æ¨¡å—</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">lspci -k | grep -A 3 -E <span class="hljs-string">&quot;(VGA|3D)&quot;</span><br>lsmod | grep amdgpu<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>æ£€æŸ¥openGLæ˜¯å¦å·¥ä½œæ­£å¸¸</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">glxgears<br></code></pre></td></tr></table></figure><p>å‡ºç°ä¸€ä¸ªè½¬åŠ¨çš„é½¿è½®çª—å£ï¼Œè¯´æ˜ OpenGLæ¸²æŸ“æ­£å¸¸ã€‚å‰ä¸¤æ­¥çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/25/pVJwZX4.png" /></p><p>éƒ½æ²¡æœ‰é—®é¢˜ã€‚</p><p>ä¸‹é¢æ’æŸ¥LWJGLã€‚åœ¨ä¸€ç•ªæŸ¥æ‰¾åæˆ‘æ‰¾åˆ°äº†<ahref="https://github.com/PolyMC/PolyMC/issues/1533">è¿™ä¸ªissue</a>ï¼Œé‡Œé¢æåˆ°ï¼š</p><blockquote><p>LWJGL åœ¨åº•å±‚ä½¿ç”¨ xrandrï¼Œé€šè¿‡è§£æ xrandr -qå‘½ä»¤çš„è¾“å‡ºæ¥è·å–å±å¹•åˆ†è¾¨ç‡ã€‚</p><p>æˆ‘å®‰è£…äº† xrandrï¼Œå„ä¸ªç‰ˆæœ¬åŠ è½½éƒ½æ²¡æœ‰é—®é¢˜ã€‚</p></blockquote><p>Arch Linuxå®‰è£…xrandrçš„æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S xorg-xrandr<br></code></pre></td></tr></table></figure><p>å®‰è£…åæˆåŠŸå¯åŠ¨æ¸¸æˆã€‚æ¸¸æˆæˆªå›¾ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/25/pVJ03an.png" alt="æˆªå›¾" /><figcaption aria-hidden="true">æˆªå›¾</figcaption></figure><p>ï¼ˆå…­å¹´å‰çš„ç‰¢æ ¸æ˜¾ä½ç«¯ç¬”è®°æœ¬è¿˜èƒ½ç¨³å®šåœ¨60Hzï¼Œæ»¡è¶³äº†ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€è½¬è½½ã€‘æŠ˜è…¾çš„é‡è¦æ€§</title>
    <link href="/2025/07/19/%E6%8A%98%E8%85%BE%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/"/>
    <url>/2025/07/19/%E6%8A%98%E8%85%BE%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è½¬è‡ªç¼–ç¨‹éšæƒ³çš„åšå®¢https://program-think.blogspot.com/2017/04/The-Importance-of-Zheteng.html<br />å‘å¸ƒæ—¶é—´ï¼š2017å¹´4æœˆ19æ—¥</p><span id="more"></span><h2 id="æ–‡ç« ç›®å½•">æ–‡ç« ç›®å½•</h2><p><a href="#å¼•å­">å¼•å­</a><br /><a href="#åè¯å®šä¹‰ä½•ä¸ºæŠ˜è…¾">â˜…åè¯å®šä¹‰ï¼šä½•ä¸ºâ€œæŠ˜è…¾â€</a><br /><a href="#æŠ˜è…¾ä¸è‡ªå­¦èƒ½åŠ›">â˜…â€œæŠ˜è…¾â€ä¸â€œè‡ªå­¦èƒ½åŠ›â€</a><br /><a href="#æŠ˜è…¾ä¸è§£å†³é—®é¢˜èƒ½åŠ›">â˜…â€œæŠ˜è…¾â€ä¸â€œè§£å†³é—®é¢˜èƒ½åŠ›â€</a><br /><a href="#æŠ˜è…¾ä¸çŸ¥è¯†é¢çŸ¥è¯†ç»“æ„">â˜…â€œæŠ˜è…¾â€ä¸â€œçŸ¥è¯†é¢/çŸ¥è¯†ç»“æ„â€</a><br /><a href="#æŠ˜è…¾ä¸åŠ¨æ‰‹å®è·µèƒ½åŠ›">â˜…â€œæŠ˜è…¾â€ä¸â€œåŠ¨æ‰‹å®è·µèƒ½åŠ›â€</a><br /><a href="#æŠ˜è…¾ä¸å¿ƒç†èˆ’é€‚åŒº">â˜…â€œæŠ˜è…¾â€ä¸â€œå¿ƒç†èˆ’é€‚åŒºâ€</a><br /><ahref="#èŠèŠé‚£äº›ä¸æŠ˜è…¾çš„ç†ç”±æˆ–å€Ÿå£">â˜…èŠèŠé‚£äº›â€œä¸æŠ˜è…¾â€çš„ç†ç”±æˆ–å€Ÿå£</a><br /><a href="#ä¿ºå†™æœ¬æ–‡çš„åŠ¨æœº">â˜…ä¿ºå†™æœ¬æ–‡çš„åŠ¨æœº</a></p><h2 id="å¼•å­">å¼•å­</h2><p>å‰ä¸ä¹…å†™äº†ç¯‡å…³äº Linuxçš„åšæ–‡ã€‚çœ‹åˆ°åšå®¢è¯„è®ºåŒºä¸­æœ‰ä¸€äº›â€œå…³äºæŠ˜è…¾çš„æŠ±æ€¨â€ã€‚ä¹‹å‰ä¿ºå†™å…¶å®ƒæ•™ç¨‹ï¼ˆæ¯”å¦‚ï¼šç¿»å¢™ã€æ“ä½œç³»ç»Ÿè™šæ‹Ÿæœºï¼‰ï¼Œä¹Ÿçœ‹åˆ°è¿‡ç±»ä¼¼çš„æŠ±æ€¨ã€‚</p><p>å…³äºæŠ˜è…¾çš„æŠ±æ€¨ï¼Œä¿ºæ€»ç»“ä¸‹æ¥æœ‰ä¸¤ç±»ï¼š</p><ul><li>å…¶ä¸€ï¼Œâ€œä»ä¸æŠ˜è…¾çš„äººâ€æŠ±æ€¨æŠ˜è…¾å¤ªéº»çƒ¦ï¼ˆè¿™ç±»æŠ±æ€¨å¾€å¾€æ˜¯æ³›æ³›çš„ï¼‰</li><li>å…¶äºŒï¼Œâ€œæœ‰è¿‡æŠ˜è…¾ç»å†çš„äººâ€æŠ±æ€¨æŠ˜è…¾å¤ªéº»çƒ¦ï¼ˆè¿™ç±»æŠ±æ€¨å¾€å¾€æ˜¯æœ‰å…·ä½“æ‰€æŒ‡çš„ï¼‰</li></ul><p>æ‰€ä»¥ä»Šå¤©å°±æ¥èŠèŠâ€œæŠ˜è…¾â€è¿™ä¸ªè¯é¢˜ã€‚</p><h2 id="åè¯å®šä¹‰ä½•ä¸ºæŠ˜è…¾">â˜…åè¯å®šä¹‰ï¼šä½•ä¸ºâ€œæŠ˜è…¾â€</h2><p>ä¸ºäº†é¿å…æŸäº›äººæŠ¬æ ï¼Œå…ˆç•Œå®šä¸€ä¸‹å…³é”®æœ¯è¯­â€”â€”â€œæŠ˜è…¾â€ä¸€è¯æŒ‡çš„æ˜¯å•¥ï¼Ÿ</p><p>åœ¨ä¸‹é¢çš„è®¨è®ºä¸­ï¼Œâ€œæŠ˜è…¾â€ä¸€è¯æŒ‡çš„æ˜¯ï¼š</p><ul><li>åœ¨ä½ ã€ä¸ç†Ÿæ‚‰ã€‘çš„é¢†åŸŸä¸­å¹²æŸäº›äº‹æƒ…ï¼ˆå¦‚æœæ˜¯ä½ ã€ç†Ÿæ‚‰ã€‘çš„é¢†åŸŸï¼Œé‚£å±äºâ€œè½»è½¦ç†Ÿè·¯â€ï¼Œä¸èƒ½ç®—â€œæŠ˜è…¾â€ï¼‰</li><li>è¿™äº›äº‹æƒ…é€šå¸¸å¸¦æœ‰æŸç§â€œæ¢ç´¢/é’»ç ”â€çš„æ€§è´¨ï¼ˆé€šå¸¸é¢‡è´¹å‘¨æŠ˜ï¼‰</li><li>è¿™äº›äº‹æƒ…é€šå¸¸è¦è€—è´¹ä¸€å®šçš„æ—¶é—´å’Œç²¾åŠ›ï¼ˆèƒ½å¾ˆå¿«æå®šçš„ï¼Œå°±ä¸èƒ½ç®—â€œæŠ˜è…¾â€ï¼‰</li><li>è¿™äº›äº‹æƒ…é€šå¸¸å…·æœ‰ä¸ç¡®å®šçš„ç»“æœï¼ˆä½ ä¸æ¸…æ¥šæ˜¯å¦èƒ½å¾—åˆ°æœŸæœ›çš„ç»“æœï¼‰ã€‚</li></ul><p>ä¸¾ä¾‹ï¼š</p><ul><li>é’ˆå¯¹è½¯ä»¶çš„æŠ˜è…¾ï¼ˆæ¯”å¦‚ï¼šLinuxï¼‰</li><li>é’ˆå¯¹ç¡¬ä»¶çš„æŠ˜è…¾ï¼ˆæ¯”å¦‚ï¼šæ ‘è“æ´¾ï¼‰</li><li>é’ˆå¯¹ç½‘ç»œçš„æŠ˜è…¾ï¼ˆæ¯”å¦‚ï¼šç¿»å¢™ï¼‰</li><li>......</li></ul><h2 id="æŠ˜è…¾ä¸è‡ªå­¦èƒ½åŠ›">â˜…â€œæŠ˜è…¾â€ä¸â€œè‡ªå­¦èƒ½åŠ›â€</h2><h3 id="è‡ªå­¦èƒ½åŠ›çš„é‡è¦æ€§">â—‡â€œè‡ªå­¦èƒ½åŠ›â€çš„é‡è¦æ€§</h3><p>åšå®¢çš„è¯»è€…ä»¬åº”è¯¥éƒ½æ˜ç™½è¿™ç©æ„å„¿çš„é‡è¦æ€§å§ï¼Ÿä¿ºéšä¾¿è¯´å‡ ç‚¹ï¼š</p><ul><li>æ¯”å¦‚ï¼šä¿¡æ¯æ—¶ä»£ä¼šæœ‰å¾ˆå¤šæ–°ç”Ÿäº‹ç‰©ã€‚ä½ ä»¥å‰åœ¨å­¦æ ¡è¯¾å ‚é‡Œå­¦åˆ°çš„çŸ¥è¯†/æŠ€èƒ½å·²ç»æ— æ³•åº”å¯¹è¿™äº›æ–°ç”Ÿäº‹åŠ¡ï¼Œä½ éœ€è¦é€šè¿‡è‡ªå­¦æ¥æå®šå®ƒä»¬ã€‚</li><li>æ¯”å¦‚ï¼šåœ¨ä¿¡æ¯æ—¶ä»£ï¼ŒçŸ¥è¯†çš„åŠè¡°æœŸä¼šå˜çŸ­ã€‚ä½ ä»¥å‰åœ¨å­¦æ ¡è¯¾å ‚é‡Œå­¦åˆ°çš„çŸ¥è¯†/æŠ€èƒ½ï¼Œç­‰åˆ°ä½ å·¥ä½œæ—¶ï¼Œæœ‰äº›å·²ç»è¿‡æ—¶ï¼ˆå¤±æ•ˆï¼‰äº†ã€‚ä½ éœ€è¦é€šè¿‡è‡ªå­¦æ¥æ›´æ–°è¿™éƒ¨åˆ†è¿‡æ—¶çš„çŸ¥è¯†ã€‚</li><li>æ¯”å¦‚ï¼šå¦‚ä»Šçš„èŒåœºç«äº‰ä¼šæ¯”ä»¥å¾€æ›´æ¿€çƒˆï¼ˆä¿¡æ¯æµåŠ¨åŠ å¿«ä½¿å¾—äººæ‰æµåŠ¨åŠ å¿«ï¼‰ã€‚è‡ªå­¦èƒ½åŠ›å¼ºçš„äººæ— ç–‘ä¼šæœ‰æ›´å¤§çš„ä¼˜åŠ¿ã€‚</li><li>......</li></ul><h3 id="ä¸¤è€…çš„å…³ç³»">â—‡ä¸¤è€…çš„å…³ç³»</h3><p>å‰é¢ä¿ºå¼ºè°ƒäº†ï¼šæŠ˜è…¾çš„å‰ææ˜¯â€”â€”åœ¨ä½ ã€ä¸ç†Ÿæ‚‰ã€‘çš„é¢†åŸŸã€‚</p><p>åœ¨è¿™ç§é¢†åŸŸä¸­ï¼Œä½ å¤šåŠè¦é€šè¿‡è‡ªå­¦ï¼ŒæŒæ¡æŸäº›çŸ¥è¯†æˆ–æŠ€èƒ½ï¼Œè®©â€œä¸ç†Ÿæ‚‰çš„é¢†åŸŸâ€å˜ä¸ºâ€œç†Ÿæ‚‰çš„é¢†åŸŸâ€ã€‚</p><p>æ‰€ä»¥ï¼Œå–œæ¬¢æŠ˜è…¾çš„äººï¼Œä»–/å¥¹çš„è‡ªå­¦èƒ½åŠ›ä¼šç»å¸¸å¾—åˆ°é”»ç‚¼ã€‚å½“ç„¶å•¦ï¼Œâ€œç»å¸¸é”»ç‚¼è‡ªå­¦èƒ½åŠ›â€ä¸ä¸€å®šå°±è¡¨ç¤ºâ€œè‡ªå­¦èƒ½åŠ›å¾ˆå¼ºâ€ï¼Œä½†è‡³å°‘å¥½äºé‚£äº›â€œä»æ¥æ²¡æœ‰å¾—åˆ°é”»ç‚¼çš„äººâ€ã€‚</p><h2 id="æŠ˜è…¾ä¸è§£å†³é—®é¢˜èƒ½åŠ›">â˜…â€œæŠ˜è…¾â€ä¸â€œè§£å†³é—®é¢˜èƒ½åŠ›â€</h2><h3 id="è§£å†³é—®é¢˜èƒ½åŠ›çš„é‡è¦æ€§">â—‡â€œè§£å†³é—®é¢˜èƒ½åŠ›â€çš„é‡è¦æ€§</h3><p>è¯´åˆ°è¿™ä¸ªï¼Œä¿ºåˆè¦è¶æœºæ¥æ¶æ¯’æ”»å‡»ä¸€ä¸‹å’±ä»¬å¤©æœçš„æ•™è‚²ä½“åˆ¶äº†:)</p><p>å¦‚æœä½ å›é¡¾ä¸€ä¸‹å­¦æ ¡ï¼ˆå°å­¦/ä¸­å­¦/å¤§å­¦ï¼‰é‡Œé¢çš„è€ƒè¯•æˆ–è¯¾åä½œä¸šï¼Œå¤§éƒ¨åˆ†çš„é¢˜ç›®éƒ½æœ‰æ ‡å‡†ç­”æ¡ˆï¼ˆç†å·¥ç§‘å°¤å…¶æ˜æ˜¾ï¼‰ã€‚</p><p>ä½†æ˜¯å½“ä½ è¿›å…¥èŒåœºåï¼Œå¾ˆå¤šå·¥ä½œä¸­çš„é—®é¢˜ï¼Œå…¶è§£å†³æ–¹æ³•æ˜¯å¤šç§å¤šæ ·çš„ï¼Œã€æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆã€‘ã€‚</p><p><strong>è¿™ä¸¤ç±»é—®é¢˜çš„è§£é¢˜æ€è·¯æ˜¯å®Œå…¨ä¸åŒæ»´â€”â€”</strong> -ã€æœ‰ã€‘æ ‡å‡†ç­”æ¡ˆçš„é—®é¢˜ï¼Œè§£é¢˜çš„æ€ç»´è¿‡ç¨‹é€šå¸¸æ˜¯ã€æ”¶æ•›å¼ã€‘ï¼› -ã€æ²¡æœ‰ã€‘æ ‡å‡†ç­”æ¡ˆçš„é—®é¢˜ï¼Œè§£ä½“çš„æ€ç»´è¿‡ç¨‹é€šå¸¸æ˜¯ã€å‘æ•£å¼ã€‘ã€‚</p><p>æœ‰å¾ˆå¤šå­¦æ ¡ä¸­çš„ä¼˜ç§€ç”Ÿï¼Œä»–ä»¬å¾ˆæ“…é•¿äºè€ƒè¯•ï¼Œä½†æ˜¯åœ¨å·¥ä½œä¸­çš„è¡¨ç°å´ä»¤äººéš¾ä»¥æ­ç»´ã€‚å› ä¸ºä»–ä»¬æ“…é•¿çš„ã€æ”¶æ•›å¼æ€ç»´ã€‘ï¼Œåœ¨å·¥ä½œä¸­é€šå¸¸ç”¨ä¸ä¸Šã€‚</p><h3 id="ä¸¤è€…çš„å…³ç³»-1">â—‡ä¸¤è€…çš„å…³ç³»</h3><p>â€œæŠ˜è…¾â€ä¸â€œè§£é¢˜èƒ½åŠ›â€æœ‰å“ªäº›å…³ç³»æï¼Ÿ</p><p>å½“ä½ åœ¨ä¸ç†Ÿæ‚‰çš„é¢†åŸŸä¸­æŠ˜è…¾ï¼Œé€šå¸¸ä¸ä¼šä¸€å¸†é£é¡ºâ€”â€”æ•´ä¸ªè¿‡ç¨‹å¿…ç„¶ä¼šç¢°åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼ˆå›°éš¾å’Œéšœç¢ï¼‰ï¼Œè¿™äº›é—®é¢˜å¾€å¾€æ˜¯æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆæ»´ã€‚æ¢å¥è¯è¯´ï¼ŒæŠ˜è…¾ä¸­ç¢°åˆ°é—®é¢˜ï¼Œã€ä¸åŒäºã€‘ä½ åœ¨å­¦æ ¡ä¸­ç¢°åˆ°çš„è€ƒé¢˜ï¼Œè€Œã€æ›´æ¥è¿‘äºã€‘ä½ åœ¨å®é™…å·¥ä½œä¸­ç¢°åˆ°é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œç»å¸¸æŠ˜è…¾çš„äººï¼Œä¼šæœ‰æ›´å¤šçš„æœºä¼šå»é”»ç‚¼ä»–/å¥¹çš„ã€å‘æ•£æ€ç»´èƒ½åŠ›ã€‘ã€‚ä¹Ÿå°±å¯ä»¥æ›´å¤šåœ°å¼¥è¡¥å­¦æ ¡æ•™è‚²åœ¨è¿™æ–¹é¢çš„ç¼ºé™·ã€‚</p><h2 id="æŠ˜è…¾ä¸çŸ¥è¯†é¢çŸ¥è¯†ç»“æ„">â˜…â€œæŠ˜è…¾â€ä¸â€œçŸ¥è¯†é¢/çŸ¥è¯†ç»“æ„â€</h2><h3 id="çŸ¥è¯†é¢çš„é‡è¦æ€§">â—‡çŸ¥è¯†é¢çš„é‡è¦æ€§</h3><p>å¦‚ä»Šè¿™ä¸ªä¿¡æ¯æ—¶ä»£ï¼Œã€å¤åˆå‹äººæ‰ã€‘æ›´æœ‰ç«äº‰ä¼˜åŠ¿ã€‚æ‰€è°“çš„â€œå¤åˆå‹â€ï¼Œå…¶ä¸»è¦ç‰¹å¾ã€ä¹‹ä¸€ã€‘å°±æ˜¯â€œçŸ¥è¯†é¢æ¯”è¾ƒå¹¿â€ã€‚è¿™ç±»äººå¾€å¾€å…¼å…·å¤šä¸ªä¸åŒé¢†åŸŸçš„æŠ€èƒ½ã€‚</p><p>å°±æ‹¿è‡ªå·±æ¥ç°èº«è¯´æ³•â€”â€”ç®€è¿°ä¸€ä¸‹ï¼šç»´æŠ¤ç›®å‰è¿™ä¸ªåšå®¢ï¼Œå¤§æ¦‚éœ€è¦å“ªäº›æŠ€èƒ½ï¼Ÿ</p><ul><li>åŸºæœ¬çš„å†™ä½œèƒ½åŠ›æ˜¯å¿…ä¸å¯å°‘æ»´â€”â€”å¦‚æœå†™å‡ºæ¥çš„æ–‡ç« ç‹—å±ä¸é€šï¼Œå°±æ²¡äººçœ‹äº†ï¼›</li><li>ç¿»å¢™æ˜¯å¿…ä¸å¯å°‘æ»´â€”â€”ä¿ºå¿…é¡»æŠŠåšå®¢æ­å»ºåœ¨å¢™å¤–ï¼Œæ‰èƒ½é˜²æ­¢çœŸç†éƒ¨çš„å’Œè°ï¼›</li><li>ä¿¡æ¯å®‰å…¨ä¹Ÿæ˜¯å¿…ä¸å¯å°‘æ»´â€”â€”å¦åˆ™æ—©å°±è¢«è·¨çœè¿½æ•äº†ï¼›</li><li>æ‡‚ä¸€äº› Web å¼€å‘çš„æŠ€èƒ½ï¼ˆCSS å’ŒJSï¼‰æ˜¯æœ‰å¥½å¤„æ»´â€”â€”æœ‰åŠ©äºä¿ºæŠŠåšå®¢ç•Œé¢æå¾—å¥½çœ‹/å¥½ç”¨ï¼›</li></ul><p>é™¤äº†ä¸Šé¢è¿™äº›ï¼Œå› ä¸ºä¿ºåšå®¢èŠåˆ°äº†â€œæ”¿æ²»ã€å†å²ã€å¿ƒç†å­¦ã€ç®¡ç†ã€ç¼–ç¨‹â€è¿™å‡ ç±»è¯é¢˜ï¼Œæ‰€ä»¥ä¿ºåœ¨è¿™å‡ ä¸ªé¢†åŸŸå¤šå°‘è¿˜ç®—ç•¥æ‡‚ï¼ˆä¸æ•¢å¦„ç§°ç²¾é€šï¼‰ã€‚</p><h3id="ä»€ä¹ˆæ ·çš„çŸ¥è¯†ç»“æ„æ‰æ˜¯åˆç†çš„æœ‰ä¼˜åŠ¿çš„">â—‡ä»€ä¹ˆæ ·çš„çŸ¥è¯†ç»“æ„æ‰æ˜¯åˆç†çš„ï¼ˆæœ‰ä¼˜åŠ¿çš„ï¼‰</h3><p>å‰é¢æåˆ°äº†â€œçŸ¥è¯†é¢çš„å¹¿åº¦â€ã€‚ä½†ä»…ä»…æœ‰å¹¿åº¦æ˜¯ã€ä¸å¤Ÿã€‘æ»´ã€‚è‰¯å¥½çš„çŸ¥è¯†ç»“æ„ï¼Œåº”è¯¥å…¼å…·ã€å¹¿åº¦ã€‘ä¸ã€æ·±åº¦ã€‘ã€‚</p><p>è‡³äºâ€œæ·±åº¦â€ä¸â€œå¹¿åº¦â€è¦å¦‚ä½•æ­é…æ‰æ¯”è¾ƒå¥½ï¼Œå¯ä»¥çœ‹ä¿ºå¤šå¹´å‰çš„ä¸€ç¯‡åšæ–‡ã€Š<ahref="https://program-think.blogspot.com/2013/09/knowledge-structure.html">å¦‚ä½•å®Œå–„è‡ªå·±çš„çŸ¥è¯†ç»“æ„</a>ã€‹ã€‚</p><h3 id="ä¸¤è€…çš„å…³ç³»-2">â—‡ä¸¤è€…çš„å…³ç³»</h3><p>é‚£ä¹ˆï¼Œâ€œæŠ˜è…¾â€ä¸â€œçŸ¥è¯†é¢/çŸ¥è¯†ç»“æ„â€æœ‰å•¥å…³ç³»æï¼Ÿ</p><p>æ¯”å¦‚è¯´ï¼šä½ æ­£åœ¨æŠ˜è…¾ Aé¢†åŸŸçš„æŸä¸ªäº‹ç‰©ï¼Œåœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä¾èµ–åˆ°ç›¸å…³é¢†åŸŸçš„çŸ¥è¯†ï¼ˆæ¯”å¦‚è¯´ Bé¢†åŸŸ å’ŒCé¢†åŸŸï¼‰ã€‚è€Œ Bé¢†åŸŸ å’Œ Cé¢†åŸŸ å¯èƒ½æ˜¯ä½ ä¹‹å‰æ‰€ä¸äº†è§£çš„ã€‚ä¸ºäº†æå®šAé¢†åŸŸï¼Œä½ å°±éœ€è¦é¡ºä¾¿å»äº†è§£ Bé¢†åŸŸ å’ŒCé¢†åŸŸã€‚æ— å½¢ä¸­ï¼Œä½ çš„çŸ¥è¯†é¢å°±æ‹“å®½äº†ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼š</p><p>æŸä¸ªæŠ€æœ¯èœé¸Ÿå»æŠ˜è…¾ç¿»å¢™ï¼Œå½“æ­¤äººæå®šä¹‹åï¼Œé€šå¸¸ä¹Ÿé¡ºä¾¿å­¦ä¼šäº†ä¸€äº›ç½‘ç»œç›¸å…³çš„çŸ¥è¯†ï¼ˆæ¯”å¦‚ï¼šä»£ç†ã€VPN...ï¼‰</p><p>å¦‚æœæ­¤äººæ˜¯é€šè¿‡ VPS æ¥æ­å»ºç¿»å¢™ä»£ç†ï¼Œè¯´ä¸å®šè¿˜é¡ºä¾¿å­¦ä¼šäº†ä¸€äº› Linuxç³»ç»Ÿç®¡ç†æ–¹é¢çš„çŸ¥è¯†ã€‚</p><h2 id="æŠ˜è…¾ä¸åŠ¨æ‰‹å®è·µèƒ½åŠ›">â˜…â€œæŠ˜è…¾â€ä¸â€œåŠ¨æ‰‹å®è·µèƒ½åŠ›â€</h2><h3 id="ä¸¤ç§ä¸åŒçš„é¢†åŸŸ">â—‡ä¸¤ç§ä¸åŒçš„é¢†åŸŸ</h3><p>æ‰€æœ‰çš„é¢†åŸŸå¯ä»¥åˆ†ä¸ºä¸¤ç±»â€”â€”â€œè®°å¿†å‹â€ä¸â€œå®è·µå‹â€ã€‚<br />ï¼ˆæ³¨ï¼šè¿™ä¸¤ä¸ªæœ¯è¯­æ˜¯ä¿ºæ‹è„‘è¢‹ä¸´æ—¶èµ·çš„åå„¿ï¼Œå¦‚æœä½ æœ‰æ›´æ°å½“çš„å«æ³•ï¼Œæ¬¢è¿å‘ŠçŸ¥ä¿ºï¼‰</p><p>æ‰€è°“çš„â€œè®°å¿†å‹â€ï¼Œæ„æ€å°±æ˜¯è¯´ï¼šä½ åªéœ€è¦ä¾é è®°å¿†åŠ›å°±å¯ä»¥æŒæ¡è¯¥é¢†åŸŸã€‚</p><p>è€Œâ€œå®è·µå‹â€åˆ™å®Œå…¨ä¸åŒâ€”â€”è¦æŒæ¡è¿™ç§ç±»å‹çš„é¢†åŸŸï¼Œå…‰é è®°å¿†åŠ›æ˜¯è‚¯å®šä¸å¤Ÿæ»´ï¼Œä¸€å®šè¦ç»è¿‡åŠ¨æ‰‹å®è·µã€‚</p><p>ä¸¾ä¾‹ï¼š - â€œè®°å¿†å‹â€çš„ä¾‹å­æ¯”è¾ƒå°‘ï¼šå†å²ã€è‰ºæœ¯é‰´èµ... -â€œå®è·µå‹â€çš„ä¾‹å­æ¯”è¾ƒå¤šï¼šæ‰€æœ‰çš„ä½“è‚²é¡¹ç›®ã€æ‰€æœ‰çš„æ£‹ç‰Œæ¸¸æˆå’Œç”µå­æ¸¸æˆã€çƒ¹è°ƒã€ç¼–ç¨‹ã€ç®¡ç†ã€è‰ºæœ¯åˆ›ä½œ......</p><p>å¯¹äºâ€œå®è·µå‹â€çš„é¢†åŸŸï¼Œä¸ç®¡ä½ çœ‹äº†å¤šå°‘ç›¸å…³çš„ä¹¦ç±ï¼Œè®°ä½äº†å¤šå°‘ç›¸å…³çš„çŸ¥è¯†ï¼Œæœ€åéƒ½è¦ç»è¿‡å®è·µï¼Œæ‰èƒ½æœ€ç»ˆæŒæ¡è¯¥é¢†åŸŸã€‚å¥—ç”¨ä¸€å¥å¤è¯å°±æ˜¯ï¼šçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p><p>ä¸¾ä¾‹ï¼š</p><ul><li>æ¯”å¦‚è¯´ä¸‹å›´æ£‹â€”â€”å¦‚æœæŸäººä»æ¥æ²¡æœ‰å®é™…ä¸‹è¿‡ï¼Œå³ä½¿æ­¤äººçœ‹äº† Nå¤šçš„æ£‹è°±ï¼Œçœ‹äº† N å¤šçš„å›´æ£‹ç†è®ºä¹¦ç±ï¼Œä¹Ÿä¸èƒ½ç®—æ˜¯â€œä¼šä¸‹æ£‹â€ã€‚</li><li>å­¦ç¼–ç¨‹ä¹Ÿç±»ä¼¼â€”â€”ä¿ºä¸€ç›´å¼ºè°ƒå­¦ç¼–ç¨‹ï¼ˆå°¤å…¶æ˜¯æ–°äººå­¦ç¼–ç¨‹ï¼‰è¦ï¼šä¸€è¾¹çœ‹ä¹¦ä¸€è¾¹åŠ¨æ‰‹å†™ç‚¹å°ç¨‹åºç»ƒæ‰‹ã€‚</li></ul><h3 id="ä¸¤è€…çš„å…³ç³»-3">â—‡ä¸¤è€…çš„å…³ç³»</h3><p>ä¿ºä¸ªäººè®¤ä¸ºï¼šå‡¡æ˜¯éœ€è¦æŠ˜è…¾çš„é¢†åŸŸï¼Œéƒ½æ˜¯å®è·µå‹çš„é¢†åŸŸã€‚<br />è€Œç»å¸¸æŠ˜è…¾çš„å¥½å¤„åœ¨äºï¼šæ¯æ¬¡æŠ˜è…¾éƒ½æ˜¯åœ¨é”»ç‚¼ä½ çš„åŠ¨æ‰‹å®è·µèƒ½åŠ›ã€‚</p><h2 id="æŠ˜è…¾ä¸å¿ƒç†èˆ’é€‚åŒº">â˜…â€œæŠ˜è…¾â€ä¸â€œå¿ƒç†èˆ’é€‚åŒºâ€</h2><h3 id="å•¥æ˜¯å¿ƒç†èˆ’é€‚åŒº">â—‡å•¥æ˜¯â€œå¿ƒç†èˆ’é€‚åŒºâ€ï¼Ÿ</h3><p>ä¸¤å¹´å‰ï¼ˆ2015ï¼‰å†™è¿‡ä¸€ç¯‡ã€Š<ahref="https://program-think.blogspot.com/2015/12/Hobbies-and-Interests.html">ä»€ä¹ˆæ˜¯ã€çœŸæ­£çš„ã€‘å…´è¶£çˆ±å¥½ï¼Ÿä»¥åŠå®ƒæœ‰å•¥å¥½å¤„ï¼Ÿ</a>ã€‹ï¼Œå…¶ä¸­æ­£å¥½èŠè¿‡â€œå¿ƒç†èˆ’é€‚åŒºâ€è¿™ä¸ªæ¦‚å¿µã€‚ä¸‹é¢è¿™æ®µç›´æ¥å¼•è‡ªé‚£ç¯‡åšæ–‡çš„ç›¸å…³æ®µè½ã€‚</p><p>é¦–å…ˆæ¥è§£é‡Šä¸€ä¸‹ï¼Œä½•ä¸ºâ€œå¿ƒç†èˆ’é€‚åŒºâ€ã€‚è¿™ç©æ„å„¿ï¼Œæ´‹æ–‡ç§°ä¹‹ä¸ºâ€œComfortZoneâ€ï¼Œç”¨æ¥æè¿°ä¸€ç§â€œå¿ƒç†çŠ¶æ€â€ã€‚å¤„äºè¿™ç§çŠ¶æ€ï¼Œä½ ä¼šæ„Ÿè§‰åˆ°æ”¾æ¾ï¼Œæ²¡æœ‰å‹åŠ›å’Œç„¦è™‘ã€‚</p><p>å¦‚æœä½ å¤„äºæŸä¸ªç¯å¢ƒä¸­ï¼Œåœ¨è¯¥ç¯å¢ƒä¸‹æ‰€éœ€è¦çš„è¡Œä¸ºä½ éƒ½å¯ä»¥è½»æ¾æå®šã€‚é‚£ä¹ˆï¼Œä½ å°±å¤„äºâ€œå¿ƒç†èˆ’é€‚åŒºâ€ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><ul><li>ä¸Šç½‘é—²é€›</li><li>çœ‹ç”µè§†å‰§</li><li>çœ‹å¨±ä¹èŠ‚ç›®</li></ul><h3 id="å¿ƒç†èˆ’é€‚åŒºçš„æ ¹æº">â—‡â€œå¿ƒç†èˆ’é€‚åŒºâ€çš„ã€æ ¹æºã€‘</h3><p>æœ¬æ–‡å†™å®Œä¸¤å¹´ä¹‹åï¼ˆ2019ï¼‰ï¼Œä¿ºåˆå†™äº†å¦‚ä¸‹è¿™ç¯‡ã€‚ä»â€œå¿ƒç†å­¦ ï¼†è„‘ç¥ç»ç§‘å­¦â€çš„è§’åº¦èŠäº†â€œå¿ƒç†èˆ’é€‚åŒºâ€çš„ã€éƒ¨åˆ†ã€‘æˆå› ã€‚ã€Š<ahref="https://program-think.blogspot.com/2019/03/Why-Thinking-Hard-So-Hard.html">ä¸ºä»€ä¹ˆç‹¬ç«‹æ€è€ƒè¿™ä¹ˆéš¾ï¼Ÿâ€”â€”è°ˆè°ˆå¿ƒç†å­¦çš„æˆå› ï¼Œå¹¶åˆ†äº«ä¿ºçš„ç»éªŒ</a>ã€‹</p><h3 id="èµ°å‡ºå¿ƒç†èˆ’é€‚åŒºçš„é‡è¦æ€§">â—‡â€œèµ°å‡ºå¿ƒç†èˆ’é€‚åŒºâ€çš„é‡è¦æ€§</h3><p>å‡ ä¹æ‰€æœ‰çš„ä¸ªäººèƒ½åŠ›ï¼Œå¦‚æœè¦æƒ³å¾—åˆ°æå‡ï¼Œéƒ½éœ€è¦è·³å‡ºâ€œå¿ƒç†èˆ’é€‚åŒºâ€ã€‚</p><p>æ¯”å¦‚è¯´é‚£äº›ä¼˜ç§€çš„ä½“æ“è¿åŠ¨å‘˜ï¼Œä»–ä»¬éœ€è¦ä¸æ–­ç»ƒä¹ è‡ªå·±ã€ä¸ç†Ÿæ‚‰ã€‘çš„åŠ¨ä½œï¼Œè¿™æ ·æ‰èƒ½æé«˜ï¼›åä¹‹ï¼Œå¦‚æœæŸä¸ªä½“æ“è¿åŠ¨å‘˜æ€»æ˜¯ç»ƒä¹ è‡ªå·±æœ€æ‹¿æ‰‹çš„åŠ¨ä½œï¼Œé‚£æ˜¯æ²¡æœ‰é•¿è¿›çš„ï¼ˆæˆ–è€…è¯´ï¼Œé•¿è¿›éå¸¸æœ‰é™ï¼‰ã€‚</p><h3id="ä¸ºå•¥å¤§éƒ¨åˆ†äººéƒ½æ— æ³•èµ°å‡ºå¿ƒç†èˆ’é€‚åŒº">â—‡ä¸ºå•¥å¤§éƒ¨åˆ†äººéƒ½ã€æ— æ³•ã€‘èµ°å‡ºå¿ƒç†èˆ’é€‚åŒºï¼Ÿ</h3><p>é¦–å…ˆï¼Œäººéƒ½æ˜¯æƒ°æ€§çš„ã€‚<br />åœç•™åœ¨å¿ƒç†èˆ’é€‚åŒºï¼Œæå¤§åœ°æ»¡è¶³äº†äººçš„æƒ°æ€§ã€‚<br />è¦ç¦»å¼€å¿ƒç†èˆ’é€‚åŒºï¼Œå°±è¦å…‹æœè¿™ç§æƒ°æ€§ï¼›è¿™é€šå¸¸éœ€è¦åŠ¨ç”¨æ„å¿—åŠ›ï¼Œè€Œä¸”éœ€è¦ä¸€å®šçš„æŠ€å·§ã€‚</p><p>å¤§å¤šæ•°äººçš„æ„å¿—åŠ›æ˜¯åå¼±çš„ï¼›å³ä½¿æ˜¯å°‘æ•°æ„å¿—åŠ›è¾ƒå¼ºçš„äººï¼Œå…¶ä¸­è¿˜æœ‰ä¸€å®šæ¯”ä¾‹æ˜¯ç¼ºä¹è¿ç”¨æŠ€å·§çš„ã€‚</p><p>å¦‚æœä½ å¯¹è¿™ä¸ªç»“è®ºæœ‰æ‰€æ€€ç–‘ï¼Œä¸å¦¨å»è§‚å¯Ÿä¸€ä¸‹ï¼šå¤§éƒ¨åˆ†äººåœ¨é—²æš‡æ—¶é—´éƒ½åœ¨å¹²å˜›ã€‚ä½ å°±ä¼šå‘ç°ï¼šå¤§éƒ¨åˆ†äººéƒ½åœ¨ç”¨ä¸€äº›ã€è½»æ¾çš„/æ¶ˆé£æ€§çš„/å¨±ä¹æ€§çš„ã€‘æ´»åŠ¨æ¥æ‰“å‘æ—¶å…‰ã€‚</p><h3 id="ä¸¤è€…çš„å…³ç³»-4">â—‡ä¸¤è€…çš„å…³ç³»</h3><p>å‰é¢è¯´è¿‡ï¼šæŠ˜è…¾çš„å¾€å¾€æ˜¯è‡ªå·±ä¸ç†Ÿæ‚‰çš„é¢†åŸŸï¼Œæ‰€ä»¥æŠ˜è…¾çš„è¿‡ç¨‹å¾€å¾€ä¼šç¢°åˆ°ä¸€äº›éšœç¢å’Œå›°éš¾ã€‚</p><p>è€Œæå®šè¿™äº›éšœç¢å’Œå›°éš¾ï¼Œé€šå¸¸éœ€è¦ä½ è·³åˆ°â€œå¿ƒç†èˆ’é€‚åŒºâ€ã€ä¹‹å¤–ã€‘ã€‚</p><p>æ‰€ä»¥ï¼Œç»å¸¸æŠ˜è…¾çš„äººï¼Œå°±ç»å¸¸éœ€è¦æŒ‘æˆ˜å›°éš¾å’Œéšœç¢ï¼Œäºæ˜¯ä¹Ÿå°±æœ‰æ›´å¤šæœºä¼šå»ç»ƒä¹ â€”â€”å¦‚ä½•è·³å‡ºå¿ƒç†èˆ’é€‚åŒºã€‚</p><h2 id="èŠèŠé‚£äº›ä¸æŠ˜è…¾çš„ç†ç”±æˆ–å€Ÿå£">â˜…èŠèŠé‚£äº›â€œä¸æŠ˜è…¾â€çš„ç†ç”±æˆ–å€Ÿå£</h2><p>è¯´å®Œäº†â€œå¿ƒç†èˆ’é€‚åŒºâ€ï¼Œé¡ºä¾¿åˆ—å‡ ä¸ªåé¢æ•™æâ€”â€”å…³äºâ€œä¸æŠ˜è…¾çš„ç†ç”±æˆ–å€Ÿå£â€ã€‚</p><p>å¸¸è§çš„ç†ç”±/å€Ÿå£æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><h3 id="æŠ±æ€¨æ— ç”¨åŠŸ">â—‡æŠ±æ€¨â€œæ— ç”¨åŠŸâ€</h3><p>å¾ˆå¤šäººè§‰å¾—ï¼šå¦‚æœæŠ˜è…¾æŸä¸ªä¸œè¥¿ï¼Œæœ€åæ²¡æœ‰æå‡ºæ¥ï¼ˆå¤±è´¥äº†ï¼‰ï¼Œé‚£å°±ç™½ç™½æµªè´¹äº†æ—¶é—´ï¼Œæˆä¸ºâ€œæ— ç”¨åŠŸâ€ã€‚</p><p>è¿™ä¸ªç†ç”±éå¸¸æœ‰è¿·æƒ‘æ€§ï¼ˆå°¤å…¶æ˜¯åœ¨å¤©æœè¿™ä¸ªåŠŸåˆ©ä¸»ä¹‰éå¸¸ç››è¡Œçš„ç¤¾ä¼šï¼‰ã€‚</p><p>å®é™…æƒ…å†µæ˜¯ï¼šå³ä½¿ä½ æŠ˜è…¾æŸä¸ªä¸œè¥¿æœ€åå¤±è´¥äº†ï¼Œä¹Ÿã€ä¸ä¼šã€‘æ˜¯æ— ç”¨åŠŸã€‚</p><p>å› ä¸ºåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ ä¼šæœ‰å¾ˆå¤šæ”¶è·â€”â€”åŒ…æ‹¬å‰é¢æåˆ°çš„å‡ ç§èƒ½åŠ›æå‡å’ŒçŸ¥è¯†é¢çš„æ‹“å±•ã€‚</p><h3 id="æŠ±æ€¨æ—¶é—´ä¸å¤Ÿ">â—‡æŠ±æ€¨â€œæ—¶é—´ä¸å¤Ÿâ€</h3><p>è¿™å¯èƒ½æ˜¯æœ€å¸¸è§çš„ä¸€ç§æŠ±æ€¨ï¼ˆå€Ÿå£ï¼‰â€”â€”è¯´è‡ªå·±å·¥ä½œå¤ªå¿™ï¼Œæ²¡æœ‰ç©ºé—²çš„æ—¶é—´å»æŠ˜è…¾å…¶å®ƒä¸œè¥¿ã€‚</p><p>é¦–å…ˆï¼Œæ‹¿ç½‘ä¸Šæµä¼ çš„ä¸€å¥è¯æ¥åé©³æ­¤å€Ÿå£â€”â€”æ—¶é—´å°±åƒä¹³æ²Ÿï¼Œåªè¦ä½ æ„¿æ„æŒ¤ï¼Œæ€»æ˜¯æœ‰çš„ã€‚</p><p>ç„¶åï¼Œæ¥åˆ†æä¸€ä¸‹ä¿ºåšå®¢çš„è¯»è€…ç¾¤ï¼Œåº”è¯¥å¤§éƒ¨åˆ†æ˜¯å­¦ç”Ÿæˆ–è€…ç™½é¢†/è“é¢†ã€‚</p><p><strong>å¯¹äºåœ¨æ ¡çš„å­¦ç”Ÿ</strong></p><p>ï¼ˆä¸ç®¡æ˜¯å¤§å­¦ç”Ÿè¿˜æ˜¯ä¸­å­¦ç”Ÿï¼‰è‚¯å®šæ˜¯æ˜¯æœ‰é—²æš‡æ—¶é—´çš„ï¼ˆæ¯”å¦‚å¯’æš‘å‡ï¼‰ã€‚<br />å³ä½¿æ˜¯é«˜ä¸‰å¹´å¾ˆå¿™ï¼Œåªè¦ç­‰é«˜è€ƒç»“æŸï¼Œä¹‹åé‚£ä¸ªå‡æœŸæ€»å½’æ˜¯ç©ºé—²çš„ã€‚</p><p><strong>å¯¹äºå·¥ä½œä¸­çš„ä¸Šç­æ—</strong></p><p>å¾ˆå¤šäººæŠ±æ€¨â€œåŠ ç­â€å ç”¨æ—¶é—´ã€‚<br />è¯•é—®ï¼šæœ‰å¤šå°‘å…¬å¸æ˜¯ä¸€å¹´365å¤©ï¼Œå¤©å¤©éƒ½åŠ ç­ï¼ˆå®Œå…¨æ²¡æœ‰å‘¨æœ«å’ŒèŠ‚å‡æ—¥ï¼‰ï¼›è€Œä¸”æ¯å¤©ï¼ˆæ— ä¸€ä¾‹å¤–ï¼‰éƒ½åŠ ç­åˆ°æ·±å¤œï¼Œä¸€å›å®¶å°±ä¸ŠåºŠç¡è§‰ï¼Œç„¶åä¸€è§‰é†’æ¥å°±åˆå»ä¸Šç­ã€‚è¿™æ ·çš„å…¬å¸ï¼Œå°±ç®—æœ‰ï¼Œå æ€»ä½“çš„æ¯”ä¾‹è‚¯å®šä¹Ÿæ˜¯å¾®ä¹å…¶å¾®çš„ã€‚</p><p>è¿˜æœ‰ä¸€äº›äººæŠ±æ€¨â€œå…»å°å­©â€å ç”¨æ—¶é—´ã€‚<br />è¿™ç§å€Ÿå£åŒæ ·æ˜¯ç«™ä¸ä½è„šæ»´ã€‚â€œå…»å°å­©â€ç¡®å®ä¼šå ç”¨ä¸€äº›ä¸šä½™æ—¶é—´ï¼Œä½†æ¯”ä¾‹è‚¯å®šè¾¾ä¸åˆ°100%ï¼›è€Œä¸”ç‰¹åˆ«å æ—¶é—´çš„ï¼Œé€šå¸¸æ˜¯å°å­©åˆšå‡ºç”Ÿçš„å¼€å¤´ä¸‰äº”å¹´ã€‚<br />æ‰€ä»¥ï¼Œç»å¤§éƒ¨åˆ†ä¸Šç­æ—è‚¯å®šæ˜¯æœ‰é—²æš‡æ—¶é—´çš„ã€‚</p><h3 id="æŠ±æ€¨ç²¾åŠ›ä¸å¤Ÿ">â—‡æŠ±æ€¨â€œç²¾åŠ›ä¸å¤Ÿâ€</h3><p>å¦ä¸€ç§å¸¸è§çš„æŠ±æ€¨æ˜¯ï¼šä¸Šç­å·²ç»å¾ˆç´¯ï¼Œä¸‹ç­å›å®¶å“ªè¿˜æœ‰ç²¾åŠ›å»æŠ˜è…¾å…¶å®ƒä¸œè¥¿ã€‚<br />é¦–å…ˆï¼Œå¾ˆå¤šäººå‘è¿™ç§æŠ±æ€¨ï¼Œæœ‰å¤¸å¤§å…¶è¾çš„å«Œç–‘ã€‚<br />å…¶æ¬¡ï¼Œé€€ä¸€æ­¥è®²ï¼Œå°±ç®—æœ‰ã€å°‘æ•°å·¥ä½œã€‘æ˜¯æ¯å¤©éƒ½å¾ˆç´¯ï¼Œä»¥è‡³äºæ¯å¤©ä¸‹ç­å›å®¶éƒ½ç²¾ç–²åŠ›ç«­ã€‚ä½†ä½ è‡³å°‘è¿˜æœ‰å‘¨æœ«çš„åŒä¼‘æ—¥å¯ç”¨å•Šã€‚æ¯å¹´æœ‰52ä¸ªæ˜ŸæœŸï¼Œå•ç®—åŒä¼‘æ—¥å°±æœ‰ä¸€ç™¾å¤šå¤©å‘¢ï¼ï¼ˆè¿™è¿˜æ²¡ç®—ä¸Šå›½å®šå‡æ—¥ï¼‰</p><h3 id="æŠ±æ€¨æŠ€èƒ½ä¸å¤Ÿ">â—‡æŠ±æ€¨â€œæŠ€èƒ½ä¸å¤Ÿâ€</h3><p>æœ‰è¿™ç§æŠ±æ€¨çš„äººï¼Œè¦ä¹ˆæ˜¯æ‰¾å€Ÿå£ï¼Œè¦ä¹ˆæ˜¯å¤ªç¼ºä¹è‡ªä¿¡ ã€‚åœ¨å¦‚ä»Šè¿™ä¸ªäº’è”ç½‘å¾ˆæ™®åŠçš„æ—¶ä»£ï¼ˆå¤©æœç½‘æ°‘æ®è¯´å·²ç»6äº¿æˆ–7äº¿äº†ï¼‰ï¼Œå¾ˆå¤šéœ€è¦æŠ˜è…¾çš„äº‹ç‰©ï¼Œéƒ½å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°æ•™ç¨‹ï¼Œç”šè‡³æ˜¯æ‰‹æŠŠæ‰‹çš„å‚»ç“œæ•™ç¨‹ã€‚æœ‰äº†æ•™ç¨‹ï¼ˆå°¤å…¶æ˜¯å‚»ç“œæ•™ç¨‹ï¼‰ï¼ŒæŠ˜è…¾çš„é—¨æ§›å·²ç»å¤§å¤§é™ä½äº†ã€‚<br />ï¼ˆè‡³äºå¦‚ä½•åœ¨ç½‘ä¸Šæ‰¾åˆ°æ•™ç¨‹ï¼Œå¯ä»¥å‚è€ƒã€Šå¦‚ä½•æŒ–æ˜ç½‘ç»œèµ„æºã€‹ç³»åˆ—åšæ–‡ï¼‰<br />å½“ç„¶å•¦ï¼Œå³ä½¿æœ‰äº†å†å®Œå¤‡çš„æ•™ç¨‹ï¼Œä½ ä¾ç„¶ä¼šåœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€äº›å›°éš¾å’Œéšœç¢ã€‚æ‰€ä»¥â€œæ•™ç¨‹çš„å­˜åœ¨â€å¹¶ã€ä¸ä¼šã€‘å½±å“ä½ é”»ç‚¼â€œè§£å†³é—®é¢˜çš„èƒ½åŠ›â€ã€‚</p><h3 id="å°ç»“">â—‡å°ç»“</h3><p>ä¸Šè¿°æ‰€æœ‰è¿™äº›ï¼Œå¦‚æœæ˜¯ã€ç†ç”±ã€‘çš„è¯ï¼Œé‚£éƒ½æ˜¯ä¸æˆç«‹çš„ï¼›å¦‚æœæ˜¯ã€å€Ÿå£ã€‘çš„è¯ï¼Œé‚£éƒ½å¯ä»¥å½’å’äºâ€”â€”ä¸æ„¿æ„ç¦»å¼€å¿ƒç†èˆ’é€‚åŒºã€‚</p><p>ä¸ºå•¥å¾ˆå¤šäººéƒ½åœ¨æ‰¾å€Ÿå£æï¼Ÿå› ä¸ºå¤§éƒ¨åˆ†äººã€ä¸ã€‘æ„¿æ„æ‰¿è®¤ï¼šè‡ªå·±æ€»æ˜¯åœç•™åœ¨å¿ƒç†èˆ’é€‚åŒºï¼›å¹¶ä¸”å¤§éƒ¨åˆ†äººæ›´ã€ä¸ã€‘æ„¿æ„æ‰¿è®¤ï¼šè‡ªå·±æ— æ³•ç¦»å¼€å¿ƒç†èˆ’é€‚åŒºã€‚æ‰€ä»¥ï¼Œä»–ä»¬éœ€è¦æ‰¾å„ç§å€Ÿå£æ¥æ©é¥°ã€‚</p><h2 id="ä¿ºå†™æœ¬æ–‡çš„åŠ¨æœº">â˜…ä¿ºå†™æœ¬æ–‡çš„åŠ¨æœº</h2><p>åœ¨æœ¬æ–‡æœ€åï¼Œç¨å¾®é€éœ²ä¸€ä¸‹ä¿ºå†™æœ¬æ–‡çš„åŠ¨æœºã€‚</p><p>å¯èƒ½å¤§å¤šæ•°è¯»è€…ä¼šã€è¯¯ä»¥ä¸ºã€‘â€”â€”ä¿ºå†™è¿™ç¯‡ï¼Œæ˜¯æƒ³åŠé‚£äº›ä¸å–œæ¬¢æŠ˜è…¾çš„äººæ”¹å˜ä¹ æƒ¯ï¼Œå¤šå¤šæŠ˜è…¾ã€‚</p><p>NOï¼ŒNOï¼ŒNOï¼è¿™ã€ä¸æ˜¯ã€‘ä¿ºçš„æœ¬æ„ï¼</p><p>å‰é¢è¯´äº†ï¼šé‚£äº›ä¸å–œæ¬¢æŠ˜è…¾çš„äººï¼Œæ— æ³•ï¼ˆéš¾ä»¥ï¼‰è·³å‡ºâ€œå¿ƒç†èˆ’é€‚åŒºâ€ã€‚è¿™æ˜¯ç”±ä»–ä»¬çš„ã€æœ¬æ€§ã€‘ï¼ˆæ„å¿—åŠ›ã€æ€§æ ¼ã€è§‚å¿µã€å¿ƒæ€...ï¼‰å†³å®šçš„ã€‚è€Œä¸€ä¸ªäººçš„æœ¬æ€§ï¼Œæ˜¯ã€æ— æ³•ã€‘è½»æ˜“æ”¹å˜æ»´ã€‚æ‰€ä»¥ï¼Œä¿ºå½“ç„¶ã€ä¸æŒ‡æœ›ã€‘ï¼šé è¿™æ ·ä¸€ç¯‡çŸ­çŸ­çš„åšæ–‡ï¼Œå°±èƒ½æ”¹å˜ä»–ä»¬çš„æœ¬æ€§ã€‚</p><p>é‚£ä¿ºä¸ºå•¥è¿˜è¦å†™è¿™ç¯‡åšæ–‡æï¼Ÿå†™æ­¤æ–‡çš„ç›®çš„æ˜¯ï¼šé¼“åŠ±é‚£äº›å·²ç»èµ°ä¸ŠæŠ˜è…¾ä¹‹è·¯çš„åŒå­¦ä»¬ï¼Œå¸Œæœ›ä»–ä»¬èƒ½åœ¨è¿™æ¡è·¯ä¸Šèµ°å¾—è¶³å¤Ÿè¿œã€‚ã€å¥½å¥½æŠ˜è…¾ï¼Œå¤©å¤©å‘ä¸Šã€‘</p><hr /><p style="border: 2px solid black; padding: 10px; margin: 20px; background-color: #f9f9f9;"><strong>ç‰ˆæƒå£°æ˜</strong><br>æœ¬åšå®¢æ‰€æœ‰çš„åŸåˆ›æ–‡ç« ï¼Œä½œè€…çš†ä¿ç•™ç‰ˆæƒã€‚è½¬è½½å¿…é¡»åŒ…å«æœ¬å£°æ˜ï¼Œä¿æŒæœ¬æ–‡å®Œæ•´ï¼Œå¹¶ä»¥è¶…é“¾æ¥å½¢å¼æ³¨æ˜ä½œè€…ç¼–ç¨‹éšæƒ³å’Œæœ¬æ–‡åŸå§‹åœ°å€ï¼šhttps://program-think.blogspot.com/2017/04/The-Importance-of-Zheteng.html</p>]]></content>
    
    
    
    <tags>
      
      <tag>è½¬è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUC-çº¿ç¨‹æ± éƒ¨åˆ†æºç &amp;APIæ€»ç»“</title>
    <link href="/2025/07/18/JUC-%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <url>/2025/07/18/JUC-%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹æ± ç®€ä»‹">çº¿ç¨‹æ± ç®€ä»‹</h2><p>Javaä¸­çš„çº¿ç¨‹æ± æ˜¯è¿ç”¨åœºæ™¯æœ€å¤šçš„å¹¶å‘æ¡†æ¶ï¼Œå‡ ä¹æ‰€æœ‰éœ€è¦å¼‚æ­¥æˆ–è€…å¹¶å‘æ‰§è¡Œä»»åŠ¡çš„ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ã€‚</p><p>Javaçº¿ç¨‹æ± æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¤„ç†ä»»åŠ¡ï¼š</p><ol type="1"><li>ä¼˜å…ˆä½¿ç”¨æ ¸å¿ƒçº¿ç¨‹</li><li>æ ¸å¿ƒçº¿ç¨‹æ»¡äº†ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—</li><li>å·¥ä½œé˜Ÿåˆ—æ»¡äº†ä½¿ç”¨éæ ¸å¿ƒçº¿ç¨‹</li><li>éƒ½æ»¡äº†æ‰§è¡Œæ‹’ç»ç­–ç•¥</li></ol><figure><img src="https://s21.ax1x.com/2025/07/16/pV1bCGD.png"alt="çº¿ç¨‹æ± çš„ä¸»è¦å¤„ç†æµç¨‹" /><figcaption aria-hidden="true">çº¿ç¨‹æ± çš„ä¸»è¦å¤„ç†æµç¨‹</figcaption></figure><p><strong>çº¿ç¨‹æ± åœ¨ç³»ç»Ÿä¸­çš„åº”ç”¨</strong>ï¼š</p><ul><li>WebæœåŠ¡å™¨å¤„ç†HTTPè¯·æ±‚</li><li>æ•°æ®åº“è¿æ¥å’ŒIOæ“ä½œï¼Œä¾‹å¦‚æŸ¥è¯¢å’Œæ’å…¥æ•°æ®åº“ã€æ–‡ä»¶è¯»å†™æ“ä½œã€Nettyå®ç”¨çº¿ç¨‹æ± å¤„ç†ç½‘ç»œäº‹ä»¶</li><li>å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼Œä¾‹å¦‚ RabbitMQã€Kafkaæ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†æ¶ˆæ¯</li><li>è®¡ç®—å¯†é›†åœºæ™¯ï¼Œä¾‹å¦‚å¹¶è¡Œè®¡ç®—ï¼šFork/Joinæ¡†æ¶ã€parallelstreamsåº•å±‚ä½¿ç”¨çº¿ç¨‹æ± </li></ul><h2 id="threadpoolexecutoråŸºæœ¬æºç ">ThreadPoolExecutoråŸºæœ¬æºç </h2><figure><img src="https://s21.ax1x.com/2025/07/16/pV1bixH.png"alt="ThreadPoolExecutoræ‰§è¡Œç¤ºæ„å›¾" /><figcaption aria-hidden="true">ThreadPoolExecutoræ‰§è¡Œç¤ºæ„å›¾</figcaption></figure><p>ThreadPoolExecutoræ‰§è¡Œ<code>execute</code>æ–¹æ³•åˆ†ä¸ºå››ç§æƒ…å†µï¼Œä¾æ®å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼š</p><ol type="1"><li>å°‘äº<code>corePoolSize</code></li><li>å¤§äºç­‰äº<code>corePoolSize</code>ï¼Œä¸”é˜»å¡é˜Ÿåˆ—è¿˜æ²¡æ»¡</li><li>é˜»å¡é˜Ÿåˆ—å·²ç»æ»¡äº†</li><li>çº¿ç¨‹æ± èƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•°ä¹Ÿä¸å¤Ÿäº†</li></ol><p>å…¶ä¸­1ï¼Œ2æ­¥ä¼šå…ˆè·å–å…¨å±€é”ï¼Œç„¶ååˆ›å»ºæ–°çº¿ç¨‹ã€‚è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯å°½é‡å‡å°‘è·å–é”çš„æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡ã€‚</p><p><strong>é¢„çƒ­</strong>ï¼ŒæŒ‡çš„æ˜¯å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºç­‰äº<code>corePoolSize</code>ï¼Œæ­¤æ—¶å‡ ä¹æ‰€æœ‰çš„è·å–çº¿ç¨‹æ“ä½œéƒ½ä¼šèµ°ç¬¬äºŒæ­¥ï¼Œæ’é˜Ÿç­‰ç€æ‹¿åˆ°çº¿ç¨‹ã€‚æ³¨æ„æ ¸å¿ƒçº¿ç¨‹æ˜¯å§‹ç»ˆä¿æŒæ´»åŠ¨çš„ï¼Œè€Œéæ ¸å¿ƒçº¿ç¨‹åªåœ¨ä»»åŠ¡é«˜å³°æœŸåˆ›å»ºï¼Œç©ºé—²ä¸€æ®µæ—¶é—´<code>keepAliveTime</code>åå°±ä¼šè¢«é”€æ¯ã€‚</p><p>ä¸ç®¡æ˜¯æ ¸å¿ƒçº¿ç¨‹è¿˜æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œä¸€æ—¦è¢«åˆ›å»ºå¹¶æˆåŠŸåŠ å…¥çº¿ç¨‹æ± çš„<code>workers</code>é›†åˆä¸­ï¼Œå®ƒä»¬éƒ½ä¼šè¿›å…¥ä¸€ä¸ªå¾ªç¯â€”â€”åå¤ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼Œç›´åˆ°è¢«ç»ˆæ­¢ä¸ºæ­¢ã€‚</p><h3 id="çº¿ç¨‹æ± çŠ¶æ€">çº¿ç¨‹æ± çŠ¶æ€</h3><p>è¿™ä¸€éƒ¨åˆ†å±äº<code>ThreadPoolExecutor</code>çš„åŸºæœ¬å­—æ®µï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">ctl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(ctlOf(RUNNING, <span class="hljs-number">0</span>));<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT_BITS</span> <span class="hljs-operator">=</span> Integer.SIZE - <span class="hljs-number">3</span>; <span class="hljs-comment">// ä¹Ÿå°±æ˜¯29</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT_MASK</span> <span class="hljs-operator">=</span> (<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS) - <span class="hljs-number">1</span>; <br><span class="hljs-comment">// COUNT_MASK æ˜¯æ©ç å¸¸é‡ï¼Œç”¨äºç§»ä½</span><br><span class="hljs-comment">// COUNT_MASK çš„ä½29ä½å…¨æ˜¯1ï¼Œå…¶ä½™ä¸º0</span><br><br><span class="hljs-comment">// runState is stored in the high-order bits</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">RUNNING</span>    <span class="hljs-operator">=</span> -<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHUTDOWN</span>   <span class="hljs-operator">=</span>  <span class="hljs-number">0</span> &lt;&lt; COUNT_BITS;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STOP</span>       <span class="hljs-operator">=</span>  <span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TIDYING</span>    <span class="hljs-operator">=</span>  <span class="hljs-number">2</span> &lt;&lt; COUNT_BITS;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TERMINATED</span> <span class="hljs-operator">=</span>  <span class="hljs-number">3</span> &lt;&lt; COUNT_BITS;<br></code></pre></td></tr></table></figure><p>ç”¨ä¸€ä¸ªåŸå­æ•´æ•°<code>ctl</code>çš„<code>é«˜3ä½</code>ä¿å­˜<strong>çº¿ç¨‹æ± çš„çŠ¶æ€</strong><code>runState</code>ï¼›<code>ä½29ä½</code>ä¿å­˜<code>workerCount</code>ï¼Œè¡¨ç¤ºæœ‰æ•ˆçš„çº¿ç¨‹æ•°é‡ï¼Œå³<strong>å·²ç»å¯åŠ¨ä½†è¿˜æ²¡æœ‰ç»“æŸçš„çº¿ç¨‹æ•°é‡</strong>ã€‚</p><p><code>runState</code><strong>æ˜¯çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸæ§åˆ¶çš„æ ¸å¿ƒï¼Œå…¶å–å€¼åŒ…æ‹¬</strong>ï¼š</p><ul><li><code>RUNNING</code>ï¼ˆ<strong>è¿è¡Œä¸­</strong>ï¼‰ï¼šæ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li><li><code>SHUTDOWN</code>ï¼ˆ<strong>å…³é—­ä¸­</strong>ï¼‰ï¼šä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†å¤„ç†é˜Ÿåˆ—ä¸­å·²æœ‰çš„ä»»åŠ¡ã€‚</li><li><code>STOP</code>ï¼ˆ<strong>åœæ­¢</strong>ï¼‰ï¼šä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä¸å¤„ç†é˜Ÿåˆ—ä»»åŠ¡ï¼Œå¹¶ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li><code>TIDYING</code>ï¼ˆ<strong>æ•´ç†ä¸­</strong>ï¼‰ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»ˆæ­¢ï¼ŒworkerCountä¸º 0ï¼Œè´Ÿè´£è½¬å…¥è¯¥çŠ¶æ€çš„çº¿ç¨‹å°†æ‰§è¡Œ<code>terminated()</code>é’©å­æ–¹æ³•ã€‚</li><li><code>TERMINATED</code>ï¼ˆ<strong>å·²ç»ˆæ­¢</strong>ï¼‰ï¼šterminated()é’©å­æ–¹æ³•å·²æ‰§è¡Œå®Œæ¯•ã€‚</li></ul><p>è¿™äº›çŠ¶æ€çš„æ•°å€¼é¡ºåºå¾ˆé‡è¦ï¼Œç”¨äºå®ç°æœ‰åºæ¯”è¾ƒã€‚runStateçš„å€¼æ˜¯å•è°ƒé€’å¢çš„ï¼Œä½†ä¸ä¼šä¿è¯æ¯ä¸ªçŠ¶æ€éƒ½ä¼šç»å†ä¸€éã€‚</p><hr /><p><strong>çŠ¶æ€è½¬ç§»è·¯å¾„å¦‚ä¸‹ï¼š</strong></p><ul><li><code>RUNNING</code> â†’ <code>SHUTDOWN</code>ï¼šè°ƒç”¨<code>shutdown()</code> æ–¹æ³•ã€‚</li><li><code>RUNNING</code> æˆ– <code>SHUTDOWN</code> â†’<code>STOP</code>ï¼šè°ƒç”¨ <code>shutdownNow()</code> æ–¹æ³•ã€‚</li><li><code>SHUTDOWN</code> â†’<code>TIDYING</code>ï¼šå½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºä¸”çº¿ç¨‹æ± ä¸ºç©ºæ—¶ã€‚</li><li><code>STOP</code> â†’ <code>TIDYING</code>ï¼šå½“çº¿ç¨‹æ± ä¸ºç©ºæ—¶ã€‚</li><li><code>TIDYING</code> â†’<code>TERMINATED</code>ï¼š<code>terminated()</code> é’©å­æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶ã€‚è°ƒç”¨ <code>awaitTermination()</code> ç­‰å¾…çš„çº¿ç¨‹ä¼šåœ¨çŠ¶æ€å˜ä¸º<code>TERMINATED</code> æ—¶è¿”å›ã€‚</li></ul><hr /><p><strong>ç”¨äºè£…ç®±/æ‹†ç®±<code>ctl</code>çš„æ–¹æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Packing and unpacking ctl</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">runStateOf</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span>     &#123; <span class="hljs-keyword">return</span> c &amp; ~COUNT_MASK; &#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">workerCountOf</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span>  &#123; <span class="hljs-keyword">return</span> c &amp; COUNT_MASK; &#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">ctlOf</span><span class="hljs-params">(<span class="hljs-type">int</span> rs, <span class="hljs-type">int</span> wc)</span> &#123; <span class="hljs-keyword">return</span> rs | wc; &#125;<br></code></pre></td></tr></table></figure><p><code>COUNT_MASK</code>çš„ä½ 29 ä½å…¨æ˜¯<code>1</code>ï¼Œé€ä¸€æ¥çœ‹ï¼š</p><ul><li><code>runStateOf(int c)</code>å–å‡ºæ•´æ•°<code>c</code>çš„é«˜ 3ä½ï¼Œå³çº¿ç¨‹æ± çš„çŠ¶æ€<code>runState</code>ï¼›</li><li><code>workerCountOf(int c)</code>å–å‡ºä½ 29 ä½ï¼Œå³æœ‰æ•ˆçº¿ç¨‹æ•°é‡ï¼›</li><li><code>ctlOf</code>:<code>rs</code>ä»£è¡¨çº¿ç¨‹æ± çŠ¶æ€ï¼Œ<code>wc</code>ä»£è¡¨æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ï¼ŒæŒ‰ä½æˆ–å³å¯æ‹¼æ¥æˆ<code>int</code>å½¢å¼çš„<code>ctl</code>ï¼ˆè¿˜æ²¡æœ‰è½¬åŒ–æˆåŸå­æ•´æ•°ï¼‰ã€‚</li></ul><h3 id="execute">execute()</h3><p><strong>æ–¹æ³•æ¦‚è¿°</strong></p><p><code>execute()</code>æ–¹æ³•æ˜¯çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡çš„å…¥å£ç‚¹ï¼Œå®ƒä¼šæ ¹æ®å½“å‰çº¿ç¨‹æ± çŠ¶æ€å†³å®šå¦‚ä½•å¤„ç†æäº¤çš„ä»»åŠ¡ã€‚<strong>æŒ‰ä¼˜å…ˆçº§å¤„ç†ä»»åŠ¡</strong>ï¼š</p><ol type="1"><li>ä¼˜å…ˆä½¿ç”¨æ ¸å¿ƒçº¿ç¨‹</li><li>æ ¸å¿ƒçº¿ç¨‹æ»¡äº†ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—</li><li>å·¥ä½œé˜Ÿåˆ—æ»¡äº†ä½¿ç”¨éæ ¸å¿ƒçº¿ç¨‹</li><li>éƒ½æ»¡äº†æ‰§è¡Œæ‹’ç»ç­–ç•¥</li></ol><figure><img src="https://s21.ax1x.com/2025/07/16/pV1qs1g.png"alt="æ‰§è¡Œä»»åŠ¡ç¤ºæ„å›¾" /><figcaption aria-hidden="true">æ‰§è¡Œä»»åŠ¡ç¤ºæ„å›¾</figcaption></figure><p>å·²ç»åœ¨æ³¨é‡Šä¸­æ ‡å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable command)</span> &#123;<br>    <span class="hljs-keyword">if</span> (command == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> ctl.get(); <span class="hljs-comment">// è·å–åŸå­æ•´æ•°çš„intå€¼</span><br><br>    <span class="hljs-comment">// 1. å·¥ä½œçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹å¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼š</span><br>    <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;<br>        <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-literal">true</span>)) <span class="hljs-comment">// trueè¡¨ç¤ºåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹</span><br>            <span class="hljs-keyword">return</span>;<br>        <span class="hljs-comment">// å¦‚æœåˆ›å»ºæˆåŠŸç›´æ¥è¿”å›ï¼Œå¤±è´¥åˆ™é‡æ–°è·å–çŠ¶æ€ç»§ç»­åç»­æ­¥éª¤</span><br>        c = ctl.get();<br>    &#125;<br><br>    <span class="hljs-comment">// 2. çº¿ç¨‹æ± å¤„äºRUNNINGçŠ¶æ€ï¼Œå°è¯•å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;<br>        <span class="hljs-comment">// æˆåŠŸå°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span><br>        <span class="hljs-comment">// åŒé‡æ£€æŸ¥</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">recheck</span> <span class="hljs-operator">=</span> ctl.get(); <br>        <span class="hljs-keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))<br>            reject(command);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)<br>            addWorker(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3. é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†å‘½ä»¤</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-literal">false</span>))<br>    <span class="hljs-comment">// 4. å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œè¯´æ˜çº¿ç¨‹æ± å·²é¥±å’Œæˆ–å…³é—­ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥</span><br>        reject(command);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥çš„ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œä¸‹é¢å†è¡¥å……è¯´æ˜å‡ å¥ã€‚</p><p>ç¬¬äºŒæ­¥å°è¯•å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œé€šè¿‡åˆ¤æ–­åï¼Œç»§ç»­é‡‡ç”¨<strong>åŒé‡æ£€æŸ¥</strong>çš„æ–¹å¼ï¼Œç›®çš„æ˜¯é˜²æ­¢åœ¨å¤šçº¿ç¨‹æ¡ä»¶ä¸‹çš„ç«æ€æ¡ä»¶ï¼š</p><ul><li>ä»»åŠ¡å…¥é˜Ÿåçº¿ç¨‹æ± å¯èƒ½è¢«å…³é—­</li><li>ä»»åŠ¡å…¥é˜Ÿåæ‰€æœ‰å·¥ä½œçº¿ç¨‹å¯èƒ½éƒ½ç»ˆæ­¢äº†</li></ul><p>ç›¸åº”å¯¹ç­–ï¼š</p><ul><li>é‡æ–°æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€(<code>! isRunning(recheck)</code>)ï¼Œå¦‚æœå·²å…³é—­åˆ™ç§»é™¤ä»»åŠ¡(<code>remove(command)</code>)å¹¶æ‹’ç»(<code>reject(command);</code>)</li><li>å¦‚æœå·¥ä½œçº¿ç¨‹æ•°ä¸º0ï¼Œåˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡<code>addWorker(null, false);</code></li></ul><p>å¦å¤–ï¼Œå…³äºæœ€åå½“å·¥ä½œçº¿ç¨‹æ•°ä¸º 0æ—¶ä¸ºä»€ä¹ˆè°ƒç”¨<code>addWorker(null, false);</code>ï¼š</p><p>å› ä¸ºç¬¬äºŒæ­¥çš„åˆ¤æ–­æ¡ä»¶ä¸­å·²ç»æŠŠå½“å‰ä»»åŠ¡åŠ å…¥äº†é˜Ÿåˆ—ï¼Œæ‰€ä»¥ç°åœ¨éœ€è¦çš„ä¸æ˜¯å†æ¬¡æäº¤è¿™ä¸ªä»»åŠ¡ï¼Œè€Œæ˜¯ç¡®ä¿<strong>æœ‰å·¥ä½œçº¿ç¨‹</strong>æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œæ‰€ä»¥å½“æœ€åå‘ç°å·¥ä½œçº¿ç¨‹æ•°ä¸º0æ—¶ï¼Œæ·»åŠ å‘½ä»¤ä¸º<code>null</code>ï¼›åˆå› ä¸ºå‰é¢é€»è¾‘ä¸Šæˆ‘ä»¬å·²ç»"å°è¯•è¿‡"åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹äº†ï¼Œç°åœ¨åº”è¯¥æŒ‰ç…§æ­£å¸¸çš„æ‰©å®¹é€»è¾‘åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>false</code>ã€‚</p><p>å›é¡¾ä¸€ä¸‹çº¿ç¨‹æ± çš„è®¾è®¡å“²å­¦ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">æ ¸å¿ƒçº¿ç¨‹ -&gt; é˜Ÿåˆ— -&gt; éæ ¸å¿ƒçº¿ç¨‹ -&gt; æ‹’ç»ç­–ç•¥<br></code></pre></td></tr></table></figure><p>åˆ¤æ–­åˆ°è¿™ä¸€æ­¥å‘ç°å·¥ä½œçº¿ç¨‹ä¸º0ï¼Œåªèƒ½è¯´æ˜åŸæ¥çš„æ ¸å¿ƒçº¿ç¨‹æ­»äº¡äº†ï¼Œå³ä¾¿å¦‚æ­¤ä¹Ÿä¸èƒ½ç ´åä¸Šè¾¹è¿™ä¸ªé¡ºåºï¼Œè¿™é‡Œåªèƒ½åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚</p><hr /><p>æœ€åè¡¥å……ä¸€ä¸‹<code>addWorker()</code>æ–¹æ³•çš„ç®€åŒ–åŸç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addWorker</span><span class="hljs-params">(Runnable firstTask, <span class="hljs-type">boolean</span> core)</span> &#123;<br>    <span class="hljs-comment">// ç®€åŒ–ç‰ˆæœ¬</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> ctl.get();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> runStateOf(c);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">wc</span> <span class="hljs-operator">=</span> workerCountOf(c);<br>        <br>        <span class="hljs-comment">// æ£€æŸ¥çº¿ç¨‹æ•°é™åˆ¶</span><br>        <span class="hljs-keyword">if</span> (wc &gt;= (core ? corePoolSize : maximumPoolSize))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            <br>        <span class="hljs-comment">// çº¿ç¨‹æ•°åˆæ³•ï¼Œåˆ›å»ºå·¥ä½œçº¿ç¨‹...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>core = true</code>ï¼šæ£€æŸ¥æ˜¯å¦è¶…è¿‡<code>corePoolSize</code></li><li><code>core = false</code>ï¼šæ£€æŸ¥æ˜¯å¦è¶…è¿‡<code>maximumPoolSize</code></li></ul><p>ä»¥åŠ<code>Worker</code>çš„ç®€åŒ–å·¥ä½œæµç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç®€åŒ–çš„Workerå·¥ä½œæµç¨‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> &#123;<br>    Worker(Runnable firstTask) &#123;<br>        <span class="hljs-built_in">this</span>.firstTask = firstTask;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> firstTask;  <span class="hljs-comment">// é¦–å…ˆæ‰§è¡Œä¼ å…¥çš„ä»»åŠ¡</span><br>        firstTask = <span class="hljs-literal">null</span>;<br>        <br>        <span class="hljs-keyword">while</span> (task != <span class="hljs-literal">null</span> || (task = getTask()) != <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// ç„¶åä»é˜Ÿåˆ—è·å–ä»»åŠ¡æ¥æ‰§è¡Œ</span><br>            task.run();<br>            task = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,</span><br><span class="hljs-params">                            <span class="hljs-type">int</span> maximumPoolSize,</span><br><span class="hljs-params">                            <span class="hljs-type">long</span> keepAliveTime,</span><br><span class="hljs-params">                            TimeUnit unit,</span><br><span class="hljs-params">                            BlockingQueue&lt;Runnable&gt; workQueue)</span> &#123;<br>    <span class="hljs-built_in">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,<br>            Executors.defaultThreadFactory(), defaultHandler);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>corePoolSize</code>ï¼šæœ€å¤§æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ¯æäº¤åˆ°ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œç›´åˆ°æ»¡ä¸ºæ­¢ã€‚ä¹Ÿå«çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ã€‚</li><li><code>maximumPoolSize</code>ï¼šçº¿ç¨‹æ± å¯å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•°ï¼ŒåŒ…å«æ ¸å¿ƒçº¿ç¨‹æ•°å’Œéæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</li><li><code>keepAliveTime</code>ï¼šéæ ¸å¿ƒçº¿ç¨‹ç©ºé—²åï¼Œä¿æŒå­˜æ´»çš„æ—¶é—´ï¼Œå¦‚æœç©ºé—²è¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«é”€æ¯ã€‚æ ¸å¿ƒçº¿ç¨‹å³ä½¿ä¸€ç›´ç©ºé—²ä¹Ÿä¸ä¼šè¢«é”€æ¯</li><li><code>unit</code>ï¼šä¸Šé¢æ—¶é—´çš„å•ä½</li><li><code>workQueue</code>ï¼šå·¥ä½œé˜Ÿåˆ—ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ä¸€å…±æœ‰ 4ä¸ªé‡è½½çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ä¹Ÿä¸åŒã€‚è¿˜æœ‰ä¸¤ä¸ªå‚æ•°åœ¨ä¸Šé¢æ²¡æœ‰å±•ç¤ºå‡ºæ¥ï¼š</p><ul><li><code>RejectedExecutionHandler handler</code>ï¼šé¥±å’Œç­–ç•¥ï¼Œå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†çš„æ—¶å€™ï¼Œå¿…é¡»é‡‡ç”¨ä¸€ç§ç­–ç•¥å»å¤„ç†æäº¤çš„ä»»åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚</li><li><code>ThreadFactory threadFactory</code>ï¼šç”¨äºè®¾ç½®åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ã€‚</li></ul><h2 id="é™æ€å·¥å‚æ–¹æ³•">é™æ€å·¥å‚æ–¹æ³•</h2><p>é™æ€å·¥å‚æ–¹æ³•æä¾›äº†ä¸€äº›å¿«é€Ÿä½¿ç”¨çº¿ç¨‹æ± æ¨¡æ¿çš„é€”å¾„ã€‚</p><h3 id="å›ºå®šå¤§å°çº¿ç¨‹æ± ">å›ºå®šå¤§å°çº¿ç¨‹æ± </h3><p><code>newFixedThreadPool</code>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> nThreads)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(nThreads, nThreads,<br>                                    <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>nThreads</code>æŒ‡å®šæ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡</li><li>æ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ï¼Œæ— éœ€è¶…æ—¶æ—¶é—´</li><li>é˜»å¡é˜Ÿåˆ—æ˜¯å¯é€‰æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡ã€‚é“¾å¼é˜Ÿåˆ—é€šå¸¸æ¯”åŸºäºæ•°ç»„çš„é˜Ÿåˆ—å…·æœ‰æ›´é«˜çš„ååé‡ï¼Œä½†åœ¨å¤§å¤šæ•°å¹¶å‘åº”ç”¨ä¸­æ€§èƒ½è¾ƒéš¾é¢„æµ‹ã€‚</li></ul><p>ä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="å¸¦ç¼“å­˜çš„çº¿ç¨‹æ± ">å¸¦ç¼“å­˜çš„çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newCachedThreadPool</span><span class="hljs-params">(ThreadFactory threadFactory)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">0</span>, Integer.MAX_VALUE,<br>                                    <span class="hljs-number">60L</span>, TimeUnit.SECONDS,<br>                                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;Runnable&gt;(),<br>                                    threadFactory);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ— æ ¸å¿ƒçº¿ç¨‹ï¼Œåªæœ‰éæ ¸å¿ƒçº¿ç¨‹ï¼Œ<strong>æŒ‰éœ€åˆ›å»º</strong></li><li>æœ€å¤§ç©ºé—²æ—¶é—´<code>60s</code></li><li><code>SynchronousQueue</code>ï¼šä¸€ä¸ª<strong>ä¸å­˜å‚¨å…ƒç´ </strong>çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸€ä¸ª<code>put()</code>æ“ä½œï¼Œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„<code>take()</code>æ“ä½œé…å¯¹å®Œæˆï¼Œå¦åˆ™å°±ä¼šé˜»å¡ï¼Œåä¹‹äº¦ç„¶ã€‚</li></ul><p>é€‚åˆä»»åŠ¡æ¯”è¾ƒå¯†é›†ï¼Œæ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ¯”è¾ƒçŸ­çš„æƒ…å†µã€‚</p><h3 id="å•çº¿ç¨‹çº¿ç¨‹æ± ">å•çº¿ç¨‹çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newSingleThreadExecutor</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizableDelegatedExecutorService</span><br>        (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<br>                                <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>1ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œæ— éæ ¸å¿ƒçº¿ç¨‹</li><li><code>LinkedBlockingQueue</code>è¡¨ç°ä¸ºæ— ç•Œ</li></ul><p>é€‚åˆå¤šä¸ªä»»åŠ¡æ’é˜Ÿè¿›è¡Œã€‚ä¸è‡ªå·±æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç›¸æ¯”ï¼Œå•çº¿ç¨‹çº¿ç¨‹æ± å¯ä»¥ä¿è¯å°±ç®—çº¿ç¨‹å› ä¸ºæŸäº›åŸå› æŒ‚æ‰ï¼Œä¹Ÿèƒ½ç«‹åˆ»é‡æ–°é‡å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¿è¯å§‹ç»ˆæœ‰å¯ç”¨çš„çº¿ç¨‹ã€‚</p><h3 id="ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ">ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ScheduledExecutorService <span class="hljs-title function_">newScheduledThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize);<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¯ä»¥è°ƒåº¦å‘½ä»¤åœ¨<strong>æŒ‡å®šå»¶è¿Ÿ</strong>åè¿è¡Œï¼Œæˆ–å®šæœŸæ‰§è¡Œã€‚</p><ul><li>å‚æ•°ï¼š<code>corePoolSize</code> â€“ä¿ç•™åœ¨æ± ä¸­çš„çº¿ç¨‹æ•°ï¼Œéƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹</li><li>è¿”å›ï¼šæ–°åˆ›å»ºçš„è°ƒåº¦çº¿ç¨‹æ± </li></ul><p>å‘çº¿ç¨‹æ± æäº¤<strong>ä¸€æ¬¡æ€§</strong>ä»»åŠ¡çš„æ–¹æ³•ï¼ˆé‡è½½äº†ä¸¤ä¸ªï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command,<br>                                    <span class="hljs-type">long</span> delay, TimeUnit unit);<br><br><span class="hljs-keyword">public</span> &lt;V&gt; ScheduledFuture&lt;V&gt; <span class="hljs-title function_">schedule</span><span class="hljs-params">(Callable&lt;V&gt; callable,</span><br><span class="hljs-params">                                        <span class="hljs-type">long</span> delay, TimeUnit unit)</span>;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä»»åŠ¡ä¸­å‘ç”Ÿçš„å¼‚å¸¸ä¼šè¢«åæ‰ï¼Œç›´æ¥ç»ˆæ­¢å¯¹åº”çº¿ç¨‹è€Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.TestSchedule&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSchedule</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);<br>        log.debug(<span class="hljs-string">&quot;start&quot;</span>);<br><br>        pool.schedule(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;Task1&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">2000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br><br>        pool.schedule(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;Task2&quot;</span>);<br>        &#125;, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">10</span>:<span class="hljs-number">20</span>:<span class="hljs-number">13.902</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.TestSchedule</span> - start<br><span class="hljs-number">10</span>:<span class="hljs-number">20</span>:<span class="hljs-number">14.918</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.TestSchedule</span> - Task2<br><span class="hljs-number">10</span>:<span class="hljs-number">20</span>:<span class="hljs-number">14.918</span> <span class="hljs-selector-attr">[pool-1-thread-1]</span> c<span class="hljs-selector-class">.TestSchedule</span> - Task1<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è®¾ç½®<strong>å‘¨æœŸä»»åŠ¡</strong>ï¼šï¼ˆåªèƒ½æ˜¯æ— è¿”å›å€¼çš„ä»»åŠ¡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command,<br>                                                <span class="hljs-type">long</span> initialDelay,<br>                                                <span class="hljs-type">long</span> period,<br>                                                TimeUnit unit);<br></code></pre></td></tr></table></figure><p>æäº¤ä¸€ä¸ªå‘¨æœŸæ€§æ“ä½œï¼Œè¯¥æ“ä½œé¦–å…ˆåœ¨ç»™å®šçš„åˆå§‹å»¶è¿Ÿåå¯ç”¨ï¼Œç„¶åå‘¨æœŸæ€§è¢«è°ƒç”¨ã€‚</p><p><code>period</code>æŒ‡çš„æ˜¯ä»ä¸Šä¸€æ¬¡ä»»åŠ¡çš„å¼€å§‹æ—¶é—´åˆ°ä¸‹ä¸€æ¬¡ä»»åŠ¡çš„å¼€å§‹æ—¶é—´ä¹‹é—´çš„é—´éš”ã€‚å¦‚æœäººç‰©æœ¬èº«çš„æ‰§è¡Œæ—¶é—´å¤§äºè¿™ä¸ªé—´éš”ï¼Œé‚£ä¹ˆä¼šåœ¨ä¸Šä¸€ä¸ªä»»åŠ¡ç»“æŸåé©¬ä¸Šæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œä¸ä¼šé‡å ã€‚</p><p>è®¾ç½®å›ºå®šå»¶æ—¶<code>delay</code>çš„æ–¹æ³•ï¼Œ<code>delay</code>æ˜¯ä¸Šä¸€ä¸ªä»»åŠ¡çš„ç»ˆæ­¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡çš„å¼€å§‹ä¹‹é—´çš„å›ºå®šæ—¶é—´é—´éš”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command,<br>                                                     <span class="hljs-type">long</span> initialDelay,<br>                                                     <span class="hljs-type">long</span> delay,<br>                                                     TimeUnit unit);<br></code></pre></td></tr></table></figure><hr /><h2 id="çº¿ç¨‹æ± api">çº¿ç¨‹æ± API</h2><h3 id="å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡">å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡</h3><p>ä»JDK5å¼€å§‹ï¼Œå·¥ä½œå•å…ƒä¸æ‰§è¡Œæœºåˆ¶åˆ†ç¦»å¼€æ¥ã€‚å·¥ä½œå•å…ƒåŒ…æ‹¬ï¼š<code>Runnable</code>å’Œ<code>Callable</code>ï¼Œæ‰§è¡Œæœºåˆ¶ç”±<code>Executor</code>æ¡†æ¶æä¾›ã€‚</p><p><code>execute()</code>ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸã€‚è¾“å…¥çš„ä»»åŠ¡æ˜¯ä¸€ä¸ª<code>Runnable</code>å®ä¾‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>        <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">60L</span>, TimeUnit.SECONDS,<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1</span>)  <span class="hljs-comment">// å®¹é‡ä¸º1çš„é˜Ÿåˆ—</span><br>);<br><br><span class="hljs-comment">// æäº¤ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹</span><br>executor.execute(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;Task 1 by core thread&quot;</span>);<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Core thread dies!&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><hr /><p><code>submit()</code>ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œçº¿ç¨‹æ± è¿”å›ä¸€ä¸ª<code>Future</code>ç±»å‹çš„å¯¹è±¡ã€‚<code>get()</code>æ–¹æ³•ä¼š<strong>é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆ</strong>ï¼Œä¹Ÿå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>                <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">60L</span>, TimeUnit.SECONDS,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1</span>)  <span class="hljs-comment">// å®¹é‡ä¸º1çš„é˜Ÿåˆ—</span><br>        );<br>        Future&lt;String&gt; res = executor.submit(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;);<br><br>        System.out.println(res.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¸€æ¬¡æ€§æäº¤å¤šä¸ªä»»åŠ¡ï¼Œè¿”å›æ‰€æœ‰ç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="hljs-title function_">invokeAll</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br>    <span class="hljs-keyword">throws</span> InterruptedException;<br></code></pre></td></tr></table></figure><p><code>invokeAll()</code>æ–¹æ³•å¯ä»¥<strong>ä¸€æ¬¡æ€§æäº¤ä¸€ç»„ä»»åŠ¡</strong>ï¼ˆåªèƒ½æ˜¯Callableï¼‰ï¼Œå¹¶ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œç„¶åè¿”å›åŒ…å«æ¯ä¸ªä»»åŠ¡æ‰§è¡Œç»“æœçš„Futureå¯¹è±¡é›†åˆã€‚é€‚åˆæœ‰ä¸€æ‰¹å¹¶å‘ä»»åŠ¡éœ€è¦åŒæ—¶æäº¤ï¼Œç„¶ååœ¨æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆä¹‹åç»Ÿä¸€å¤„ç†ç»“æœçš„åœºåˆã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>                <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">60L</span>, TimeUnit.SECONDS,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1</span>)  <span class="hljs-comment">// å®¹é‡ä¸º1çš„é˜Ÿåˆ—</span><br>        );<br><br>        List&lt;Future&lt;Object&gt;&gt; futures = executor.invokeAll(Arrays.asList(<br>                () -&gt; &#123;<br>                    System.out.println(<span class="hljs-string">&quot;Task 1 by core thread&quot;</span>);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK1&quot;</span>;<br>                &#125;,<br>                () -&gt; &#123;<br>                    System.out.println(<span class="hljs-string">&quot;Task 2 by core thread&quot;</span>);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK2&quot;</span>;<br>                &#125;<br>        ));<br><br>        Thread.sleep(<span class="hljs-number">1000</span>);<br><br>        futures.forEach((res) -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                System.out.println(res.get());<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¸€æ¬¡æäº¤å¤šä¸ªä»»åŠ¡ï¼Œè¿”å›æœ€å¿«çš„ç»“æœ</strong></p><p><code>invokeAny</code>ï¼šæäº¤æ‰€æœ‰ä»»åŠ¡ï¼Œè¿”å›æœ€å¿«ç»“æœã€‚<strong>åªæœ‰ä¸€ä¸ªè¿”å›å€¼</strong>ã€‚è¿”å›ç»“æœåï¼Œå…¶ä»–ä»»åŠ¡ç«‹åˆ»å–æ¶ˆã€‚</p><h3 id="å…³é—­çº¿ç¨‹æ± ">å…³é—­çº¿ç¨‹æ± </h3><ul><li><code>shutdown()</code>ï¼šæ‹’ç»æ–°çš„ä»»åŠ¡æäº¤ï¼Œå·²ç»æäº¤çš„ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œçš„å’Œç­‰å¾…æ‰§è¡Œçš„ï¼‰ä¼šç»§ç»­å¤„ç†å®Œã€‚çº¿ç¨‹æ± ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­ï¼Œæ˜¯ä¸€ç§<strong>æ¸©å’Œçš„å…³é—­æ–¹å¼</strong>ã€‚</li><li><code>shutdownNow()</code>ï¼šä¸ä¼šç­‰å¾…æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å®Œæˆï¼Œå¼ºåˆ¶å…³é—­ã€‚</li></ul><p>è°ƒç”¨ä¸¤è€…ä»»æ„ä¸€ä¸ªï¼Œ<code>isShutdown</code>å°±ä¼šè¿”å›<code>true</code>ã€‚å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å…³é—­ä»¥åï¼Œè°ƒç”¨<code>isTerminaed</code>æ–¹æ³•ä¼šè¿”å›<code>true</code>ã€‚</p><h2 id="åˆç†é…ç½®çº¿ç¨‹æ± ">åˆç†é…ç½®çº¿ç¨‹æ± </h2><ul><li><strong>CPUå¯†é›†å‹ä»»åŠ¡</strong>ï¼šä¸»è¦è€—è´¹ CPU èµ„æºï¼Œå‡ ä¹ä¸æ¶‰åŠ I/Oæ“ä½œï¼ŒCPUå§‹ç»ˆåœ¨æ‰§è¡ŒæŒ‡ä»¤ï¼Œçº¿ç¨‹åŸºæœ¬ä¸ä¼šè¢«é˜»å¡ã€‚ä¾‹å¦‚ï¼šæ•°å­¦è®¡ç®—ã€å›¾åƒå¤„ç†ã€åŠ è§£å¯†ç­‰ã€‚çº¿ç¨‹æ•°æ¨èï¼šæ ¸æ•°+1</li><li><strong>IOå¯†é›†å‹ä»»åŠ¡</strong>ï¼šä»»åŠ¡å¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰å¾…å¤–éƒ¨ I/Oè®¾å¤‡å“åº”ï¼Œä¾‹å¦‚è¯»å–å¤§æ–‡ä»¶ã€HTTPè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢å’Œå†™å…¥ã€‚çº¿ç¨‹ç»å¸¸é˜»å¡ï¼Œåº”å½“å°½é‡å¤šå¼€çº¿ç¨‹ã€‚</li><li><strong>æ··åˆå‹ä»»åŠ¡</strong>ï¼šå°†å…¶æ‹†åˆ†æˆCPUå¯†é›†å‹ä»»åŠ¡å’ŒIOå¯†é›†å‹ä»»åŠ¡</li><li>å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</li><li>ä¼˜å…ˆçº§ä¸åŒçš„ä»»åŠ¡å¯ä»¥ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å¤„ç†</li></ul>]]></content>
    
    
    <categories>
      
      <category>JUC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUC-synchronizedå…³é”®å­—</title>
    <link href="/2025/07/17/JUC-synchronized/"/>
    <url>/2025/07/17/JUC-synchronized/</url>
    
    <content type="html"><![CDATA[<h2 id="å…±äº«é—®é¢˜">å…±äº«é—®é¢˜</h2><ul><li>å¤šä¸ªçº¿ç¨‹è®¿é—®<strong>å…±äº«èµ„æº</strong>ï¼Œè¿›è¡Œè¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤çš„äº¤é”™å°±ä¼šå‘ç”Ÿé—®é¢˜ã€‚</li><li>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º<strong>ä¸´ç•ŒåŒº</strong>ã€‚</li><li>å¤šä¸ªä»£ç åœ¨ä¸´ç•ŒåŒºå†…è¿è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹å‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong>ã€‚</li></ul><p>å¦‚ä½•é¿å…ä¸´ç•ŒåŒºçš„äº’æ–¥æ¡ä»¶çš„å‘ç”Ÿï¼Ÿä¸¤ç§æ–¹æ³•ï¼š</p><ol type="1"><li>é˜»å¡å¼çš„è§£å†³æ–¹æ³•ï¼š<code>synchronized</code> <code>Lock</code></li><li>éé˜»å¡å¼çš„ï¼šåŸå­å˜é‡</li></ol><h2 id="synchronized">synchronized</h2><p><code>synchronized</code>ï¼šå¯¹è±¡é”ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡é”ï¼Œæ— æ³•è·å–è¿™ä¸ªé”çš„çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span>(å¯¹è±¡) &#123;<br>    ä¸´ç•ŒåŒº<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.SynchronizedTest&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedTest</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>                <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                    counter++;<br>                &#125;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>                <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                    counter--;<br>                &#125;<br>            &#125;<br>        &#125;);<br><br>        t1.start();<br>        t2.start();<br>        t2.join();<br>        t1.join();<br><br>        log.debug(<span class="hljs-string">&quot;counter = &#123;&#125;&quot;</span>, counter);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœä¸º<code>0</code>ã€‚</p><p><strong>ä¸ºä»€ä¹ˆé”å¿…é¡»æ˜¯å¼•ç”¨æ•°æ®ç±»å‹</strong>ï¼š<code>synchronized</code>çš„åº•å±‚æœºåˆ¶ä¾èµ–äºå¯¹è±¡å¤´ä¸­çš„<code>Monitor</code>ï¼ˆç›‘è§†å™¨ï¼‰é”ç»“æ„ã€‚æ¯ä¸ªJavaå¯¹è±¡ï¼ˆå¼•ç”¨ç±»å‹ï¼‰éƒ½æœ‰ä¸€ä¸ªå¯¹è±¡å¤´ï¼ŒåŒ…å«ä¸€äº›å…ƒä¿¡æ¯ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†ç”¨äºå®ç°é”ï¼ˆ<code>Mark Word</code>ï¼‰ã€‚åŸºæœ¬ç±»å‹æ²¡æœ‰å¯¹è±¡å¤´ï¼Œæ— æ³•å­˜å‚¨é”çš„ä¿¡æ¯ï¼ŒJVMä¸æ”¯æŒã€‚</p><blockquote><p>MarkWordï¼Œåœ¨64ä½è™šæ‹Ÿæœºä¸­å æ®64ä¸ªæ¯”ç‰¹ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒåŒ…æ‹¬å †å¯¹è±¡å¸ƒå±€ã€ç±»å‹ã€GCçŠ¶æ€ã€åŒæ­¥çŠ¶æ€å’Œèº«ä»½å“ˆå¸Œç çš„åŸºæœ¬ä¿¡æ¯ã€‚</p></blockquote><hr /><p><code>synchronized</code>ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°<strong>æ–¹æ³•</strong>ï¼Œç­‰ä»·äºé”ä½äº†<code>this</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<strong>å½“å‰å®ä¾‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªå¯¹è±¡å®ä¾‹å„è‡ªæœ‰è‡ªå·±çš„é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br><br>&#125;<br><br>ç­‰ä»·äº:<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœç”¨æ¥ä¿®é¥°<strong>é™æ€æ–¹æ³•</strong>ï¼Œç­‰ä»·äºé”ä½äº†<strong>ç±»å¯¹è±¡</strong>ï¼ˆ<code>xxx.class</code>ï¼‰ã€‚</p><h2 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»">å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</h2><p>è¿™é‡Œçš„çº¿ç¨‹å®‰å…¨æŒ‡ï¼šå¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼š</p><ol type="1"><li>ä»–ä»¬çš„æ¯ä¸ªæ–¹æ³•æ˜¯åŸå­çš„</li><li>ä½†æ˜¯æ³¨æ„ä»–ä»¬çš„å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŸå­çš„</li></ol><p>å¸¸è§çš„çº¿ç¨‹å®‰å…¨ç±»å¦‚<code>String</code>ã€åŒ…è£…ç±»éƒ½å±äºä¸å¯å˜ç±»ã€‚ä»¥<code>String</code>ä¸ºä¾‹ï¼Œ<code>String.substring()</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ï¼Œæ ¹æœ¬æ²¡æœ‰æ”¹åŠ¨åŸå¯¹è±¡çš„å€¼ã€‚</p><p><code>String</code>ç±»æ˜¯è¢«<code>final</code>ä¿®é¥°çš„ï¼Œå¦‚æœ<code>String</code>ä¸æ˜¯<code>final</code>ï¼Œä»»ä½•äººéƒ½å¯ä»¥å†™ä¸€ä¸ªå­ç±»æ”¹å˜<code>String</code>çš„è¡Œä¸ºï¼Œä»è€Œç ´åå®ƒçš„ä¸å¯å˜æ€§ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŸæœ¬å®‰å…¨å¯é¢„æœŸçš„<code>String</code>è¡Œä¸ºå°±ä¼šå´©æºƒã€‚</p><h2 id="å¤ä¹ javaå¯¹è±¡å†…å­˜å¸ƒå±€">å¤ä¹ ï¼šJavaå¯¹è±¡å†…å­˜å¸ƒå±€</h2><p>Javaå¯¹è±¡ä¿å­˜åœ¨å †ä¸­æ—¶ï¼Œç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/31/pV9uJ1A.png"alt="å¯¹è±¡çš„å†…å­˜å¸ƒå±€" /><figcaption aria-hidden="true">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</figcaption></figure><h3 id="å¯¹è±¡å¤´object-header">å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰</h3><ol type="1"><li><strong>MarkWord</strong>ï¼Œåœ¨64ä½è™šæ‹Ÿæœºä¸­å æ®64ä¸ªæ¯”ç‰¹ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒåŒ…æ‹¬å †å¯¹è±¡å¸ƒå±€ã€ç±»å‹ã€GCçŠ¶æ€ã€åŒæ­¥çŠ¶æ€å’Œèº«ä»½å“ˆå¸Œç çš„åŸºæœ¬ä¿¡æ¯</li><li><strong>KlassPointer</strong>ï¼Œç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘å®ƒçš„ç±»å‹å…ƒæ•°æ®ï¼Œç”¨äºç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</li><li><strong>å¯¹äºæ•°ç»„å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€å—ç”¨äºå­˜å‚¨æ•°ç»„é•¿åº¦çš„åŒºåŸŸ</strong>ã€‚å› ä¸ºä»¥åçš„JVMéœ€è¦è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ã€GCéœ€è¦çŸ¥é“å¯¹è±¡å å¤šå¤§ç©ºé—´ç­‰ç­‰ï¼Œæ•°ç»„é•¿åº¦çš„å€¼æ˜¯è¦è¢«å¤šæ¬¡ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æ•°ç»„å¯¹è±¡è‡ªèº«å¿…é¡»ä¹Ÿä¿å­˜ä¸€ä¸ªé•¿åº¦ã€‚</li></ol><p>64ä½JVMçš„Mark Wordç»“æ„ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/31/pV9Koa8.png"alt="Mark Word" /><figcaption aria-hidden="true">Mark Word</figcaption></figure><h3 id="å®ä¾‹æ•°æ®instance-data">å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</h3><p>å®ä¾‹æ•°æ®æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>ä»çˆ¶ç±»ç»§æ‰¿çš„å„ç§ç±»å‹çš„å­—æ®µ</li><li>åœ¨å­ç±»ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ</li></ul><p>å¦‚æœå¯¹è±¡æ²¡æœ‰å±æ€§å­—æ®µï¼Œé‚£ä¹ˆè¿™é‡Œä¸ä¼šæœ‰ä¿¡æ¯ã€‚</p><h3 id="å¯¹é½å¡«å……padding">å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</h3><p>å¹¶éå¿…è¦ä¿¡æ¯ï¼Œèµ·åˆ°å ä½ç¬¦çš„ä½œç”¨ï¼ŒåŸå› æ˜¯Javaçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œè€Œå¯¹è±¡çš„å®ä¾‹æ•°æ®å¯èƒ½ä¸æ»¡è¶³ï¼Œæ‰€ä»¥éœ€è¦å¯¹é½å¡«å……ä¸€ä¸‹ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆèµ·å§‹åœ°å€ä¼šæœ‰è¿™ä¸ªè¦æ±‚:[^1]</p><div class="note note-success">            <p>å­—æ®µå†…å­˜å¯¹é½çš„å…¶ä¸­ä¸€ä¸ªåŸå› ï¼Œæ˜¯è®©å­—æ®µåªå‡ºç°åœ¨åŒä¸€CPUçš„ç¼“å­˜è¡Œä¸­ã€‚å¦‚æœå­—æ®µä¸æ˜¯å¯¹é½çš„ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°è·¨ç¼“å­˜è¡Œçš„å­—æ®µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å­—æ®µçš„è¯»å–å¯èƒ½éœ€è¦æ›¿æ¢ä¸¤ä¸ªç¼“å­˜è¡Œï¼Œè€Œè¯¥å­—æ®µçš„å­˜å‚¨ä¹Ÿä¼šåŒæ—¶æ±¡æŸ“ä¸¤ä¸ªç¼“å­˜è¡Œã€‚è¿™ä¸¤ç§æƒ…å†µå¯¹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡è€Œè¨€éƒ½æ˜¯ä¸åˆ©çš„ã€‚å…¶å®å¯¹å…¶å¡«å……çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†è®¡ç®—æœºé«˜æ•ˆå¯»å€ã€‚</p>          </div><h2id="synchronizedåœ¨monitorå±‚é¢çš„åŸç†">synchronizedåœ¨Monitorå±‚é¢çš„åŸç†</h2><p>Monitorè¢«ç¿»è¯‘ä¸ºç›‘è§†å™¨/ç®¡ç¨‹ï¼Œæ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œæ˜¯ä¸€ä¸ªå°è£…äº†å¾ˆå¤šä¸œè¥¿çš„æŠ½è±¡ç»“æ„ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å¸¦æœ‰<strong>äº’æ–¥é”</strong>æœºåˆ¶å’Œ<strong>æ¡ä»¶å˜é‡</strong>æœºåˆ¶çš„å¯¹è±¡ã€‚å…·å¤‡ä¸‰è¦ç´ ï¼š</p><ul><li>äº’æ–¥é”<code>Mutex Lock</code>ï¼šä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ Monitorå†…æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </li><li>ç­‰å¾…é˜Ÿåˆ—<code>WaitSet</code>ï¼šå­˜æ”¾å·²ç»è¿›å…¥Monitorã€ä½†å› ä¸ºæ¡ä»¶ä¸æ»¡è¶³è€Œç­‰å¾…çš„çº¿ç¨‹ã€‚</li><li>å…¥å£é˜Ÿåˆ—<code>EntryList</code>ï¼šå…¶ä»–å°è¯•è¿›å…¥Monitorã€ä½†å‘ç°å·²ç»æœ‰çº¿ç¨‹æŒæœ‰é”è€Œè¢«é˜»å¡çš„çº¿ç¨‹ã€‚</li></ul><p>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitorå¯¹è±¡ï¼Œä½¿ç”¨<code>synchronized</code>ç»™å¯¹è±¡åŠ ä¸Šäº’æ–¥é”ä¹‹åï¼Œå¦‚æœè·å–é”æˆåŠŸï¼Œ2bité”æ ‡å¿—ä½ä¼šè¢«ç½®ä¸º<code>10</code>ï¼ŒMarkWordçš„å‰62ä½éƒ½ä¼šè¢«æ›¿æ¢ä¸ºæŒ‡å‘äº’æ–¥é”çš„æŒ‡é’ˆï¼Œè¿™ä¸ªçº¿ç¨‹æˆä¸º<code>Owner</code>ã€‚å¦‚æœè·å–é”å¤±è´¥ï¼Œè¿™ä¸ªçº¿ç¨‹å°±è¿›å…¥äº†Monitorçš„é˜»å¡é˜Ÿåˆ—<code>EntryList</code>ï¼Œå¤„äº<code>BLOCKED</code>é˜»å¡çŠ¶æ€ã€‚</p><figure><img src="https://s21.ax1x.com/2025/07/12/pVlUib8.png"alt="synchronizedæœºåˆ¶" /><figcaption aria-hidden="true">synchronizedæœºåˆ¶</figcaption></figure><p>è§£é”æµç¨‹ï¼šæŒ‰ç…§ Monitor çš„åœ°å€æ‰¾åˆ° Monitor å¯¹è±¡ï¼Œè®¾ç½® Owner ä¸ºnullï¼Œå”¤é†’é˜Ÿåˆ—ä¸­çš„ BLOCKED çº¿ç¨‹ã€‚</p><h2id="synchronizedå…³é”®å­—åœ¨å­—èŠ‚ç å±‚é¢çš„åŸç†">synchronizedå…³é”®å­—åœ¨å­—èŠ‚ç å±‚é¢çš„åŸç†</h2><p>å¯¹äº<strong>åŒæ­¥ä»£ç å—</strong>ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆ<code>monitorenter</code>å’Œ<code>monitorexit</code>æŒ‡ä»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (MyTest.class) &#123;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>main</code>æ–¹æ³•çš„å­—èŠ‚ç ä¸ºï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span>ldc #<span class="hljs-number">2</span> &lt;<span class="hljs-keyword">com</span>/kzn/test/synchronous/MyTest&gt;  // ä»å¸¸é‡æ± åŠ è½½Classå¯¹è±¡åˆ°æ ˆé¡¶<br><span class="hljs-symbol">2 </span>dup                                       // å¤åˆ¶æ ˆé¡¶çš„Classå¯¹è±¡å¼•ç”¨<br><span class="hljs-symbol">3 </span>astore_1                                  // å°†å¤åˆ¶çš„å¼•ç”¨å­˜å‚¨åˆ°å±€éƒ¨å˜é‡<span class="hljs-number">1</span><br><span class="hljs-symbol">4 </span>monitorenter                              // è·å–ç›‘è§†å™¨é”ï¼ˆä½¿ç”¨æ ˆé¡¶çš„Classå¯¹è±¡ï¼‰<br><span class="hljs-symbol">5 </span>aload_1                                   // åŠ è½½å±€éƒ¨å˜é‡<span class="hljs-number">1</span>ï¼ˆä¸ºmonitorexitå‡†å¤‡ï¼‰<br><span class="hljs-symbol">6 </span>monitorexit                               // é‡Šæ”¾ç›‘è§†å™¨é”<br><span class="hljs-symbol">7 </span><span class="hljs-keyword">goto</span> <span class="hljs-number">15</span>                                   // è·³è½¬åˆ°<span class="hljs-keyword">return</span>ï¼Œæ­£å¸¸ç»“æŸ<br><span class="hljs-symbol">10 </span>astore_2                                 // å­˜å‚¨å¼‚å¸¸å¯¹è±¡åˆ°å±€éƒ¨å˜é‡<span class="hljs-number">2</span><br><span class="hljs-symbol">11 </span>aload_1                                  // åŠ è½½ç›‘è§†å™¨å¯¹è±¡å¼•ç”¨<br><span class="hljs-symbol">12 </span>monitorexit                              // é‡Šæ”¾ç›‘è§†å™¨é”ï¼ˆç¡®ä¿å¼‚å¸¸æ—¶ä¹Ÿé‡Šæ”¾ï¼‰<br><span class="hljs-symbol">13 </span>aload_2                                  // é‡æ–°åŠ è½½å¼‚å¸¸å¯¹è±¡<br><span class="hljs-symbol">14 </span>athrow                                   // æŠ›å‡ºå¼‚å¸¸<br></code></pre></td></tr></table></figure><ul><li>ç±»é”æœºåˆ¶ï¼š<code>ldc</code>åŠ è½½äº†ç±»é”å¯¹è±¡</li><li>åŒé‡é‡Šæ”¾ï¼š<code>monitorexit</code>è°ƒç”¨ä¸¤æ¬¡ï¼Œä¿è¯åœ¨æ­£å¸¸æƒ…å†µå’Œå¼‚å¸¸æƒ…å†µéƒ½èƒ½é‡Šæ”¾ã€‚</li><li><code>monitorenter</code>æ¶ˆè€—æ ˆé¡¶çš„å¯¹è±¡å¼•ç”¨</li><li><code>monitorexit</code>ä¹Ÿéœ€è¦ç›¸åŒçš„å¯¹è±¡å¼•ç”¨</li><li>ä¸¤ä¸ª<code>monitorexit</code>ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆå±€éƒ¨å˜é‡1ï¼‰ï¼Œç¡®ä¿äº†é”çš„è·å–å’Œé‡Šæ”¾æ“ä½œçš„å¯¹è±¡ä¸€è‡´æ€§ã€‚</li></ul><p>æ€»ç»“ï¼š</p><ol type="1"><li>å…ˆåŠ è½½é”å¯¹è±¡åˆ°æ ˆé¡¶ï¼Œè·å–åˆ°é”å¯¹è±¡çš„å¼•ç”¨</li><li>ç„¶åå°†é”å¯¹è±¡çš„å¼•ç”¨å¤åˆ¶ä¸€ä»½å‚¨å­˜åˆ°å±€éƒ¨å˜é‡1ä¸­</li><li>è·å–é”ï¼Œæ¶ˆè€—æ ˆé¡¶çš„é”å¯¹è±¡çš„å¼•ç”¨ï¼ŒåŒæ—¶å°†é”å¯¹è±¡çš„ Mark Wordçš„é«˜62ä½æ›¿æ¢æˆæŒ‡å‘äº’æ–¥é”çš„æŒ‡é’ˆ</li><li>åŠ è½½å±€éƒ¨å˜é‡1ï¼Œä¹Ÿå°±æ˜¯é”å¯¹è±¡çš„å¼•ç”¨ï¼Œå‡†å¤‡é‡Šæ”¾é”</li><li>é‡Šæ”¾ç›‘è§†å™¨é”</li></ol>]]></content>
    
    
    <categories>
      
      <category>JUC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUC-å¹¶å‘çš„æ¦‚å¿µå’ŒåŸºç¡€API</title>
    <link href="/2025/07/15/JUC-%E5%B9%B6%E5%8F%91%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E5%9F%BA%E7%A1%80API/"/>
    <url>/2025/07/15/JUC-%E5%B9%B6%E5%8F%91%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E5%9F%BA%E7%A1%80API/</url>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹">çº¿ç¨‹</h2><h3 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨</h3><p>ç›®æ ‡ï¼šåˆ›å»ºçº¿ç¨‹å¯¹è±¡ã€è¿è¡Œçº¿ç¨‹</p><p>æ–¹å¼ä¸€ï¼šåªç”¨Thread</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.ThreadTest&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>()&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;run&quot;</span>);<br><br>            &#125;<br>        &#125;;<br>        thread.setName(<span class="hljs-string">&quot;ThreadTest&quot;</span>);<br>        thread.start();<br><br>        log.debug(<span class="hljs-string">&quot;main&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šRunnable + Thread</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.ThreadTest2&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadTest2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Runnable</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>()&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>            &#125;<br>        &#125;;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">&quot;ThreadTest2&quot;</span>);<br>        t.start();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="threadå’Œrunnableçš„å…³ç³»">Threadå’ŒRunnableçš„å…³ç³»</h3><p>æœ¬è´¨ä¸Šéƒ½æ˜¯é‡å†™äº†äº†<code>Runnable</code>çš„<code>run</code>æ–¹æ³•ã€‚</p><p>æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼ŒæŠŠ<code>Runnable</code>å’Œçº¿ç¨‹å¯¹è±¡åˆ†ç¦»ï¼Œå› ä¸ºå‰è€…æ›´å®¹æ˜“å’Œçº¿ç¨‹æ± ç­‰APIç»“åˆï¼Œè€Œä¸”æ›´çµæ´»ã€‚</p><h3 id="futuretaskthread">FutureTask+Thread</h3><p>FutureTask é—´æ¥å®ç°äº† Runnable å’Œ Futureæ¥å£ï¼Œåè€…å¯ä»¥è¿”å›æ‰§è¡Œçš„ç»“æœï¼ˆrun æ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼‰</p><p>FutureTask å¯ä»¥ä¼ å…¥ Callable ç±»å‹çš„å‚æ•°ã€‚Callable çš„ callå¯ä»¥æœ‰è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ Runnable çš„ runæ— è¿”å›å€¼ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ã€‚</p><p><code>FutureTask</code>çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FutureTask</span>&lt;V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RunnableFuture</span>&lt;V&gt; &#123;...&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­æ³›å‹<code>V</code>æŒ‡å®šå°†æ¥è¿”å›å€¼çš„ç±»å‹ã€‚</p><p><code>FutureTask</code>çš„æ„é€ æ–¹æ³•æ—¢å¯ä»¥åªä¼ å…¥ä¸€ä¸ª<code>Callable</code>ç±»å‹ï¼ˆè‡ªå¸¦è¿”å›å€¼ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>Runnable</code>å’Œä¸€ä¸ª<code>result</code>ï¼ˆç”¨æ¥æŒ‡å®šè¿”å›å€¼ï¼‰ã€‚å‰è€…çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Creates a &#123;<span class="hljs-doctag">@code</span> FutureTask&#125; that will, upon running, execute the</span><br><span class="hljs-comment"> * given &#123;<span class="hljs-doctag">@code</span> Callable&#125;.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span>  callable the callable task</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> NullPointerException if the callable is null</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">FutureTask</span><span class="hljs-params">(Callable&lt;V&gt; callable)</span> &#123;<br>    <span class="hljs-keyword">if</span> (callable == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br>    <span class="hljs-built_in">this</span>.callable = callable;<br>    <span class="hljs-built_in">this</span>.state = NEW;       <span class="hljs-comment">// ensure visibility of callable</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼ å…¥çš„å‚æ•°ç±»å‹<code>Callable</code>æ˜¯ä¸€ä¸ª<strong>å‡½æ•°å¼æ¥å£</strong>ï¼Œå†…éƒ¨æä¾›äº†å¸¦è¿”å›å€¼çš„æŠ½è±¡æ–¹æ³•<code>call</code>éœ€è¦è‡ªå·±å®ç°ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callable</span>&lt;V&gt; &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Computes a result, or throws an exception if unable to do so.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> computed result</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception if unable to compute a result</span><br><span class="hljs-comment">     */</span><br>    V <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å› ä¸º FutureTask å®ç°äº† Runnable æ¥å£ï¼Œæ‰€ä»¥Threadçš„è¿™ä¸ªæ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Thread</span><span class="hljs-params">(Runnable task)</span>&#123;...&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä¼ å…¥ FutureTask ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.ThreadTest2&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadTest2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        FutureTask&lt;Integer&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                log.debug(<span class="hljs-string">&quot;run!&quot;</span>);<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);<br>        thread.start();<br><br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, futureTask.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">09</span>:<span class="hljs-number">17</span>:<span class="hljs-number">22</span> <span class="hljs-selector-attr">[Thread-0]</span> c<span class="hljs-selector-class">.ThreadTest2</span> - run!<br><span class="hljs-number">09</span>:<span class="hljs-number">17</span>:<span class="hljs-number">23</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.ThreadTest2</span> - <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h2 id="çº¿ç¨‹è¿è¡Œçš„åŸç†">çº¿ç¨‹è¿è¡Œçš„åŸç†</h2><p>æ¯ä¸ªçº¿ç¨‹ç”±å¤šä¸ªæ ˆå¸§æ„æˆï¼Œå¯¹åº”å½“å‰æ–¹æ³•ã€‚æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ã€‚</p><p>çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</p><ul><li>çº¿ç¨‹çš„cpuæ—¶é—´ç‰‡ç”¨å®Œ</li><li>åƒåœ¾å›æ”¶</li><li>æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ</li><li>çº¿ç¨‹è‡ªå·±è°ƒç”¨äº†<code>sleep</code>ç­‰æ–¹æ³•</li></ul><p>å‘ç”Ÿçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œéœ€è¦cpuä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œæ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ã€‚è¿™ä¸€ç‚¹è¦é€šè¿‡ç¨‹åºè®¡æ•°å™¨æ¥å®ç°ã€‚ç¨‹åºè®¡æ•°å™¨å¯ä»¥ä¿å­˜ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p><h2 id="æ–¹æ³•">æ–¹æ³•</h2><ul><li><code>start()</code> è®©çº¿ç¨‹å°±ç»ªï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹è±¡åªèƒ½è°ƒç”¨ä¸€æ¬¡</li><li><code>run()</code>çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨<code>Runnable</code>çš„<code>run()</code>æ–¹æ³•</li><li><code>join()</code> ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ</li><li><code>yield()</code> çº¿ç¨‹ä¸»åŠ¨æ”¾å¼ƒ</li></ul><h3 id="startrun">start&amp;run</h3><ul><li>å‡è®¾æœ‰ä¸€ä¸ªçº¿ç¨‹<code>t1</code>ï¼Œå¦‚æœæ‰§è¡Œå‘½ä»¤<code>t1.run()</code>ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ˜¯ç”±<code>main</code>ä¸»çº¿ç¨‹è°ƒç”¨äº†<code>run()</code>é‡å†™çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯<code>t1</code>çº¿ç¨‹ã€‚</li><li>å¿…é¡»ç”¨<code>t1.start()</code>å¯åŠ¨<code>t1</code>çº¿ç¨‹ï¼Œç”±è¿™ä¸ªæ–°çº¿ç¨‹è°ƒç”¨<code>run()</code>æ–¹æ³•ã€‚</li></ul><h3 id="sleepyield">sleep&amp;yield</h3><p><strong>sleep</strong></p><ul><li>ä½¿å½“å‰çº¿ç¨‹è¿›å…¥<code>TIMED_WAITING</code>çŠ¶æ€</li><li>å¯ä»¥ä½¿ç”¨<code>interrupt</code>æ‰“æ–­ç¡çœ ï¼Œå¼ºåˆ¶é€€å‡ºç¡çœ æ¨¡å¼ï¼Œå¹¶ä¸”æŠ›å‡ºå¼‚å¸¸<code>java.lang.InterruptedException: sleep interrupted</code></li><li>ç¡çœ æ—¶é—´ç»“æŸä»¥åçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»æ‰§è¡Œï¼Œåˆ†åˆ°æ—¶é—´ç‰‡æ‰å¯ä»¥ã€‚</li><li>æ¨èä½¿ç”¨<code>TimeUnit.SECONDS.sleep(1);</code>ä»£æ›¿<code>Thread.sleep(1000)</code>ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚</li></ul><p><strong>yield</strong></p><ul><li>ä½¿å½“å‰çº¿ç¨‹è¿›å…¥<code>RUNNABLE</code>å°±ç»ªçŠ¶æ€ï¼Œä»ç„¶å¯ä»¥è¢«åˆ†é…æ—¶é—´ç‰‡ã€‚æ— å‚æ•°ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹ä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œã€‚</li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ul><p><strong>çº¿ç¨‹ä¼˜å…ˆçº§</strong></p><ul><li>ä¼˜å…ˆçº§çš„æ•°å­—è¶Šå¤§ï¼Œè¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚ä¼˜å…ˆçº§å¯ä»¥<strong>æç¤º</strong>è°ƒåº¦å™¨ä¼˜å…ˆæ‰§è¡Œè¿™ä¸ªçº¿ç¨‹ã€‚ï¼ˆä¸ä¸€å®šçœŸçš„ä¼˜å…ˆä½¿ç”¨ï¼‰ã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼šåœ¨æ— éœ€é”åŒæ­¥çš„åœºæ™¯ï¼Œä½¿ç”¨<code>sleep</code>æˆ–è€…<code>yield</code>å¯ä»¥é˜²æ­¢cpu è¿‡åº¦ç©ºè½¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">50</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="join">join</h3><h4 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">th.join()<br></code></pre></td></tr></table></figure><p>ä½œç”¨æ˜¯å½“å‰çº¿ç¨‹ç­‰å¾…çº¿ç¨‹<code>th</code>è¿è¡Œç»“æŸåæ‰ä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.JoinTest&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JoinTest</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                r = <span class="hljs-number">10</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;);<br>        t1.start();<br>        t1.join();<br>        log.debug(<span class="hljs-string">&quot;r: &#123;&#125;&quot;</span>, r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">19</span>:<span class="hljs-number">34</span>:<span class="hljs-number">06</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.JoinTest</span> - <span class="hljs-attribute">r</span>: <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p><code>t1.join();</code>è¿«ä½¿ä¸»çº¿ç¨‹ç­‰å¾…<code>t1</code>ç»“æŸï¼Œèµ‹å€¼å®Œæˆåæ‰æ‰“å°æ—¥å¿—ï¼Œå› æ­¤æ‰“å°ç»“æœä¸º<code>10</code>ã€‚</p><h4 id="åŒæ­¥å’Œå¼‚æ­¥">åŒæ­¥å’Œå¼‚æ­¥</h4><p>ä¸Šé¢ä»£ç çš„æ—¶åºå¦‚ä¸‹ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/07/pVMrXhF.png" alt="æµç¨‹å›¾" /><figcaption aria-hidden="true">æµç¨‹å›¾</figcaption></figure><p>ä½•ä¸ºåŒæ­¥ï¼Ÿåœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>main</code>çº¿ç¨‹ç­‰å¾…<code>t1</code>çº¿ç¨‹æ‰§è¡Œå®Œæ¯•è¿”å›ç»“æœä¹‹åæ‰ä¼šç»§ç»­è¿è¡Œï¼Œè¿™å°±å±äºåŒæ­¥ã€‚åä¹‹ï¼Œå¦‚æœ<code>main</code>ä¸ç­‰å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œå°±ç»§ç»­æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œé‚£å°±å±äºå¼‚æ­¥ã€‚</p><h4 id="æœ€å¤§ç­‰å¾…æ—¶é—´">æœ€å¤§ç­‰å¾…æ—¶é—´</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">thread.join(<span class="hljs-type">long</span> n)<br></code></pre></td></tr></table></figure><p>è®¾ç½®<strong>æœ€å¤§ç­‰å¾…æ—¶é—´</strong>ä¸º<code>n</code>æ¯«ç§’</p><h3 id="interrupt">interrupt</h3><ul><li><code>sleep</code> <code>wait</code><code>join</code>è¢«æ‰“æ–­æ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰“æ–­æ ‡å¿—ä½æ˜¯<code>false</code>ã€‚</li><li>æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹è¢«æ‰“æ–­æ—¶ä¸ä¼šåœæ­¢è¿è¡Œï¼Œä½†æ˜¯ä¼šç½®æ ‡å¿—ä½<code>isInterrupted</code>ä¸º<code>true</code>ã€‚</li><li><code>isInterrupted()</code>è·å–æ ‡å¿—ä½ï¼Œå¹¶ä¸”ä¸ä¼šæ¸…é™¤æ ‡å¿—ä½ï¼›<code>Interrupted()</code>è·å–æ ‡å¿—ä½åŒæ—¶æ¸…é™¤æ ‡å¿—ä½ï¼Œç½®ä¸º<code>false</code></li></ul><h2 id="å®ˆæŠ¤çº¿ç¨‹">å®ˆæŠ¤çº¿ç¨‹</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaçº¿ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¿è¡Œç»“æŸåæ‰ä¼šç»“æŸã€‚ä½†æ˜¯ï¼Œå®ˆæŠ¤çº¿ç¨‹é™¤å¤–ï¼Œä¸ç®¡å®ˆæŠ¤çº¿ç¨‹çš„ä»£ç æ‰§è¡Œå®Œæ²¡æœ‰ï¼Œåªè¦éå®ˆæŠ¤çº¿ç¨‹èµ°å®Œäº†ï¼Œç¨‹åºå°±ä¼šç»“æŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">t1.setDaemon(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>åƒåœ¾å›æ”¶å™¨çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹ã€‚å¦‚æœç¨‹åºåœæ­¢äº†ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹ä¹Ÿä¼šè¢«åœæ­¢ã€‚</p><h2 id="çº¿ç¨‹çš„çŠ¶æ€">çº¿ç¨‹çš„çŠ¶æ€</h2><p>äº”ç§çŠ¶æ€çš„è¯´æ³•ï¼š</p><figure><img src="https://s21.ax1x.com/2025/07/08/pVMO534.png" alt="äº”ç§çŠ¶æ€" /><figcaption aria-hidden="true">äº”ç§çŠ¶æ€</figcaption></figure><p>å…­ç§çŠ¶æ€çš„è¯´æ³•ï¼š</p><p><img src="https://s21.ax1x.com/2025/07/08/pVMXY24.png" /></p><p>æ“ä½œç³»ç»Ÿå±‚é¢çš„é˜»å¡å±äº<code>RUNNABLE</code>çš„ç±»åˆ«ã€‚</p><h2 id="wait-notify">wait notify</h2><h3 id="åŸç†">åŸç†</h3><p><img src="https://s21.ax1x.com/2025/07/12/pVlUib8.png" /></p><ul><li>å¦‚æœæŸä¸ªçº¿ç¨‹æ‹¿åˆ°äº†æŸä¸ªå¯¹è±¡çš„ Monitor é”ï¼Œå°±ä¼šæˆä¸ºOwnerã€‚</li><li>å¦‚æœçº¿ç¨‹è·å–äº†é”ï¼Œä½†å‘ç°<strong>ç¨‹åºé€»è¾‘ä¸Šæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå¿…é¡»ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å˜åŒ–</strong>ï¼Œéœ€è¦æˆ‘ä»¬ä¸»åŠ¨è°ƒç”¨<code>wait()</code>è¿›å…¥<code>WaitSet</code>ï¼Œå½“é€»è¾‘æ»¡è¶³æ—¶è°ƒç”¨<code>notify()</code>å”¤é†’ã€‚</li><li><code>BLOCKED</code> <code>WAITING</code>éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸å ç”¨ CPUæ—¶é—´ç‰‡ã€‚</li><li><code>BLOCKED</code>åœ¨é”é‡Šæ”¾çš„æ—¶å€™<strong>è¢«å”¤é†’</strong>ï¼›<code>WAITING</code>åœ¨æ‰§è¡Œ<code>notify()</code>æˆ–è€…<code>notifyAll()</code>æ—¶è¢«å”¤é†’ï¼Œå”¤é†’åçš„çº¿ç¨‹ä¼šè¿›å…¥<code>EntryList</code>é˜»å¡é˜Ÿåˆ—é‡æ–°ç«äº‰ã€‚</li></ul><h3 id="api">API</h3><ul><li><code>obj.wait()</code>è®©å·²ç»è·å–é”çš„çº¿ç¨‹è¿›å…¥<code>WaitSet</code>ç­‰å¾…</li><li><code>obj.wait(long n)</code>è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´<code>n</code>æ¯«ç§’ï¼Œè¶…æ—¶å¼ºåˆ¶å”¤é†’</li><li><code>obj.notify()</code>ä»æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹ä¸­æŒ‘ä¸€ä¸ªå”¤é†’ï¼Œä¸ä¿è¯å”¤é†’é¡ºåº</li><li><code>obj.norifyAll()</code>å”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹</li></ul><p>å¿…é¡»è·å¾—é”å¯¹è±¡ä¹‹åï¼Œæ‰èƒ½è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•ã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.TestWait&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestWait</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                log.debug(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªçº¿ç¨‹&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    lock.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>                log.debug(<span class="hljs-string">&quot;t1è¢«å”¤é†’&quot;</span>);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                log.debug(<span class="hljs-string">&quot;ç¬¬äºŒä¸ªçº¿ç¨‹&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    lock.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>                log.debug(<span class="hljs-string">&quot;t2è¢«å”¤é†’&quot;</span>);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br><br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        log.debug(<span class="hljs-string">&quot;å”¤é†’å…¶ä»–çº¿ç¨‹&quot;</span>);<br>        <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>            lock.notify(); <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªçº¿ç¨‹</span><br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">13</span>:<span class="hljs-number">12</span>:<span class="hljs-number">39.383</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.TestWait</span> - ç¬¬ä¸€ä¸ªçº¿ç¨‹<br><span class="hljs-number">13</span>:<span class="hljs-number">12</span>:<span class="hljs-number">39.385</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.TestWait</span> - ç¬¬äºŒä¸ªçº¿ç¨‹<br><span class="hljs-number">13</span>:<span class="hljs-number">12</span>:<span class="hljs-number">40.387</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.TestWait</span> - å”¤é†’å…¶ä»–çº¿ç¨‹<br><span class="hljs-number">13</span>:<span class="hljs-number">12</span>:<span class="hljs-number">40.387</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.TestWait</span> - t1è¢«å”¤é†’<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ç¨‹åºè¿˜æ²¡æœ‰æ¨å‡ºï¼Œå› ä¸º<code>t2</code>æ²¡æœ‰è¢«å”¤é†’ã€‚å¦‚æœæ‰§è¡Œçš„æ˜¯<code>lock.notifyAll();</code>ç¨‹åºå¯ä»¥æ­£å¸¸ç»“æŸã€‚</p><p><code>wait</code>å’Œ<code>sleep</code>çš„é‡è¦åŒºåˆ«æ˜¯å‰è€…ä¼šé‡Šæ”¾å½“å‰çš„é”ï¼Œè€Œåè€…ä¸ä¼šã€‚</p><h3 id="sleepå’Œwaitçš„åŒºåˆ«">sleepå’Œwaitçš„åŒºåˆ«</h3><ul><li>sleep æ˜¯ Thread æ–¹æ³•ï¼Œwait æ˜¯ Object æ–¹æ³•</li><li>sleep ä¸éœ€è¦å’Œ<code>synchronized</code>é…åˆä½¿ç”¨ï¼Œä½†æ˜¯ waitéœ€è¦å’Œå®ƒé…åˆä½¿ç”¨</li><li><code>wait</code>ä¼šé‡Šæ”¾å¯¹è±¡é”</li><li>å®ƒä»¬çš„çŠ¶æ€éƒ½æ˜¯<code>TIMED_WAITING</code></li></ul><h3 id="è™šå‡å”¤é†’">è™šå‡å”¤é†’</h3><p>åœ¨ Java å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œè™šå‡å”¤é†’ï¼ˆSpurious Wakeupï¼‰æ˜¯ä¸€ä¸ªéå¸¸é‡è¦ä½†å®¹æ˜“è¢«å¿½è§†çš„æ¦‚å¿µã€‚</p><p>è™šå‡å”¤é†’æŒ‡çš„æ˜¯ï¼šçº¿ç¨‹åœ¨æ²¡æœ‰è¢«<code>notify()</code>æˆ–<code>notifyAll()</code>æ˜¾å¼å”¤é†’çš„æƒ…å†µä¸‹ï¼Œçªç„¶ä»<code>wait()</code>è¿”å›äº†ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œçº¿ç¨‹æ˜æ˜æ²¡æœ‰è¢«äººå«é†’ï¼Œä¹Ÿæ²¡æœ‰è¶…æ—¶ï¼Œå´è‡ªå·±é†’æ¥äº†ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span> (lock) &#123;<br>    <span class="hljs-keyword">if</span> (!condition) &#123;<br>        lock.wait();  <span class="hljs-comment">// âŒ åªåˆ¤æ–­ä¸€æ¬¡</span><br>    &#125;<br>    <span class="hljs-comment">// æ¡ä»¶æˆç«‹ï¼Œå¼€å§‹æ‰§è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºå€¼åˆ¤æ–­äº†ä¸€æ¬¡æ¡ä»¶ï¼Œæ‰€ä»¥è¢«é”™è¯¯å”¤é†’ä¹‹åï¼Œä¸ç®¡æ¡ä»¶æ˜¯å¦æˆç«‹éƒ½ä¼šç»§ç»­æ‰§è¡Œã€‚è§£å†³æ–¹æ³•æ˜¯æŠŠ<code>if</code>æ¢æˆ<code>while</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span> (lock) &#123;<br>    <span class="hljs-keyword">while</span> (!condition) &#123;<br>        lock.wait();  <span class="hljs-comment">// è¢«æŒ‚èµ·ç­‰å¾…å”¤é†’</span><br>    &#125;<br>    <span class="hljs-comment">// æ¡ä»¶æˆç«‹ï¼Œå¼€å§‹æ‰§è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="park-unpark">park unpark</h2><p>éƒ½æ˜¯<code>LockSupport.java</code>æä¾›çš„ä¸¤ä¸ªåº•å±‚çº¿ç¨‹é˜»å¡/å”¤é†’æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯æ„å»ºé«˜çº§å¹¶å‘å·¥å…·ï¼ˆå¦‚AQSã€ReentrantLockã€CountDownLatchç­‰ï¼‰çš„åŸºç¡€ã€‚ç›¸æ¯”<code>wait()</code>/<code>notify()</code>ï¼Œå®ƒä»¬æ›´çµæ´»ã€ä½çº§ä¸”<strong>ä¸éœ€è¦åŒæ­¥å—</strong>ã€‚</p><p><code>unpark</code>æ—¢å¯ä»¥åœ¨<code>park</code>ä¹‹å‰è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ä¹‹åã€‚å¦‚æœå…ˆè°ƒç”¨<code>unpark(t)</code>ï¼Œå†<code>park()</code>ï¼Œè¿™ä¸ªçº¿ç¨‹<strong>ä¸ä¼šè¢«æŒ‚èµ·</strong>ã€‚</p><h3 id="ç”¨æ³•">ç”¨æ³•</h3><ul><li><code>LockSupport.park()</code>æŒ‚èµ·<strong>å½“å‰</strong>çº¿ç¨‹</li><li><code>LockSupport.unpark(thread)</code>æ¢å¤<strong>æŒ‡å®š</strong>çº¿ç¨‹</li></ul><p>ç”¨æ³•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Park&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPark</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;Child thread parking...&quot;</span>);<br>            LockSupport.park();  <span class="hljs-comment">// é˜»å¡åœ¨è¿™é‡Œ</span><br>            log.debug(<span class="hljs-string">&quot;Child thread resumed!&quot;</span>);<br>        &#125;);<br><br>        t.start();<br><br>        Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// ä¸»çº¿ç¨‹ç¡ 1 ç§’</span><br><br>        log.debug(<span class="hljs-string">&quot;Main thread unparking child...&quot;</span>);<br>        LockSupport.unpark(t); <span class="hljs-comment">// å”¤é†’å­çº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">20</span>:<span class="hljs-number">27</span>:<span class="hljs-number">12.106</span> <span class="hljs-selector-attr">[Thread-0]</span> c<span class="hljs-selector-class">.Park</span> - Child thread parking...<br><span class="hljs-number">20</span>:<span class="hljs-number">27</span>:<span class="hljs-number">13.119</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.Park</span> - Main thread unparking child...<br><span class="hljs-number">20</span>:<span class="hljs-number">27</span>:<span class="hljs-number">13.119</span> <span class="hljs-selector-attr">[Thread-0]</span> c<span class="hljs-selector-class">.Park</span> - Child thread resumed!<br></code></pre></td></tr></table></figure><h3 id="åŸç†-1">åŸç†</h3><p>æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªâ€œè®¸å¯æ ‡å¿—â€ï¼š</p><ul><li>åˆå§‹ä¸º<code>false</code></li><li><code>park()</code>è°ƒç”¨æ—¶æ£€æŸ¥è®¸å¯ï¼š</li><li>ä¸º<code>false</code>â†’ é˜»å¡</li><li>ä¸º<code>true</code>â†’ æ¶ˆè€—è®¸å¯ï¼Œç»§ç»­æ‰§è¡Œ</li><li><code>unpark(thread)</code>ï¼šè®¾ç½®è¯¥çº¿ç¨‹çš„è®¸å¯ä¸º<code>true</code></li></ul><p>æ‰€ä»¥å¦‚æœå…ˆè°ƒç”¨<code>unpark</code>ï¼Œè¯¥çº¿ç¨‹çš„è®¸å¯å·²ç»ä¸º<code>true</code>ï¼Œè°ƒç”¨<code>park</code>ä¸ä¼šå†é˜»å¡çº¿ç¨‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JUC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬å››æ¬¡åšå®¢æŠ˜è…¾è®°å½•</title>
    <link href="/2025/06/27/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/"/>
    <url>/2025/06/27/%E7%AC%AC%E5%9B%9B%E6%AC%A1%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åˆæŠ˜è…¾äº†ä¸€ä¸‹åšå®¢ï¼Œä¸»è¦æ”¹å–„äº†ä¸€äº›ç»†èŠ‚ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h2id="hexoæ³¨å…¥å™¨å•ç‹¬ä¿®æ”¹é¦–é¡µå‰¯æ ‡é¢˜å­—ä½“">Hexoæ³¨å…¥å™¨å•ç‹¬ä¿®æ”¹é¦–é¡µå‰¯æ ‡é¢˜å­—ä½“</h2><p>é¦–é¡µå‰¯æ ‡é¢˜é¦–å…ˆè¦çš„æ˜¯<strong>ç¾è§‚</strong>ï¼Œè¦å¥‘åˆé¦–é¡µå£çº¸çš„é£æ ¼ã€‚æˆ‘æ—©å°±æƒ³æŠŠé¦–é¡µçš„æ—¥è¯­å­—ä½“ä¿®æ”¹æˆæ¸¸æ˜æœï¼Œæˆ–è€…A1æ˜æœä½“ä¹‹ç±»çš„æœ‰è¡¬çº¿å­—ä½“ï¼Œä½†æ˜¯é‡åˆ°äº†æ¯”è¾ƒå°´å°¬çš„åœ°æ–¹ï¼šæ–‡ç« é¡µå‰¯æ ‡é¢˜å’Œé¦–é¡µå‰¯æ ‡é¢˜å…¬ç”¨åŒä¸€ä¸ª<code>id</code>å’Œ<code>class</code>ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;subtitle&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;visible&quot;</span>&gt;</span>å‰¯æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥ä¿®æ”¹<code>id</code>æˆ–è€…<code>class</code>çš„ CSSæ ·å¼çš„è¯ä¼šæ®ƒåŠæ–‡ç« é¡µï¼Œè¿™æ˜¯æˆ‘ä¸æƒ³çœ‹åˆ°çš„ã€‚</p><p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Hexo æ³¨å…¥å™¨ï¼Œå®ç°æ— ä¾µå…¥åœ°æ³¨å…¥ HTMLç‰‡æ®µã€‚å…·ä½“ç”¨æ³•å‚è§<ahref="https://hexo.fluid-dev.com/docs/advance/#hexo-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81">Hexoæ³¨å…¥ä»£ç </a>ï¼Œæˆ‘é‡‡ç”¨çš„æ³¨å…¥æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* ä¸ºé¦–é¡µçš„å‰¯æ ‡é¢˜æ’å…¥class */</span><br>hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;body_begin&#x27;</span>, <br>     <span class="hljs-string">`</span><br><span class="hljs-string">      &lt;style&gt;</span><br><span class="hljs-string">        .banner-text .h2 &gt; #subtitle.visible &#123;</span><br><span class="hljs-string">          font-family: &quot;Yu Mincho&quot;, &quot;æ¸¸æ˜æœ&quot;, serif !important;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">      &lt;/style&gt;</span><br><span class="hljs-string">    `</span>,<br>     <span class="hljs-string">&#x27;home&#x27;</span>);<br></code></pre></td></tr></table></figure><p>åœ¨<code>home</code>ï¼ˆé¦–é¡µï¼‰çš„<code>&lt;head&gt;</code>æ ‡ç­¾ä¹‹åï¼Œæ³¨å…¥å†…éƒ¨CSSç”¨äºä¿®æ”¹å­—ä½“ï¼Œéå¸¸ç®€å•ã€‚ï¼ˆä¸è¿‡è¿™ä¸ªæ•ˆæœåœ¨ç§»åŠ¨ç«¯ä¸èµ·ä½œç”¨ï¼Œä»ç„¶æ˜¯é»˜è®¤å­—ä½“ï¼‰</p><h2 id="å€ŸåŠ©-inkscape-å®Œå–„è‰ºæœ¯å­—ç­¾å">å€ŸåŠ© Inkscape å®Œå–„è‰ºæœ¯å­—ç­¾å</h2><p>çœ‹äº†ä¸€äº›å¤§ç½‘ç«™çš„é¡µé¢è®¾è®¡ï¼Œæ¯ä¸€ä¸ªé¡µé¢çš„å·¦ä¸Šè§’å¾€å¾€éƒ½æ˜¯ç½‘ç«™çš„å›¾æ ‡ï¼Œæ¯”å¦‚ï¼š</p><figure><img src="https://s21.ax1x.com/2025/06/27/pVmLdij.png" alt="Youtube" /><figcaption aria-hidden="true">Youtube</figcaption></figure><figure><img src="https://s21.ax1x.com/2025/06/27/pVmLwJs.png" alt="Github" /><figcaption aria-hidden="true">Github</figcaption></figure><p>å…±åŒç‰¹å¾ï¼š</p><ol type="1"><li>éƒ½æ˜¯<strong>å›¾æ ‡+æ–‡å­—</strong>çš„å½¢å¼ï¼Œ</li><li>ç‚¹å‡»å›¾æ ‡å°±ä¼š<strong>è·³è½¬åˆ°é¦–é¡µ</strong>ã€‚</li></ol><p>ä¸‹é¢å®ç°ç¬¬ä¸€é¡¹ï¼š<em>æŠŠå›¾æ ‡æ·»åŠ åˆ°é¡µé¢å·¦ä¸Šè§’</em></p><p>ä»¥å‰é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ç›´æ¥åœ¨ <ahref="https://danmarshall.github.io/google-font-to-svg-path/">GoogleFont to Svg Path</a> ç”Ÿæˆéœ€è¦çš„å­—ä½“ svgæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥åªéœ€è¦æŠŠå›¾æ ‡çš„å›¾åƒæ–‡ä»¶è·Ÿè¿™ä¸ª svgåˆå¹¶åœ¨ä¸€èµ·ï¼Œç”Ÿæˆä¸€ä¸ªå¤§å°åˆé€‚çš„æ–°çš„ svg æ–‡ä»¶å³å¯ã€‚</p><p>ç›®æ ‡å¾ˆæ˜ç¡®ï¼Œä½†æ˜¯å…³é”®æ˜¯é€‰æ‹©åˆé€‚çš„<strong>ç”¨äºç¼–è¾‘ svgå›¾åƒçš„å·¥å…·</strong>ã€‚æˆ‘æœ€å¼€å§‹æ˜¯å°è¯•äº†å¥½å‡ ä¸ªåœ¨çº¿ç¼–è¾‘ svgçš„ç½‘ç«™ï¼Œè¦ä¹ˆæ˜¯ä¹±æ”¶è´¹ï¼Œè¦ä¹ˆæ˜¯åŠŸèƒ½æ¬ ä½³ã€‚èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œæœ€åç»ˆäºè®©æˆ‘æ‰¾åˆ°äº†<strong>Inkscape</strong>ï¼Œä¸€ä¸ª<strong>å…è´¹å¼€æº</strong>çš„çŸ¢é‡å›¾å½¢ç¼–è¾‘è½¯ä»¶ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ï¼Œåªéœ€è¦æŠŠå·²æœ‰çš„å›¾æ ‡<code>img2</code>å’Œè‰ºæœ¯å­—<code>path2</code>å¯¼å…¥å³å¯å¼€å§‹ç¼–è¾‘ï¼š</p><figure><img src="https://s21.ax1x.com/2025/06/27/pVmqvrT.png" alt="ç¼–è¾‘é¡µé¢" /><figcaption aria-hidden="true">ç¼–è¾‘é¡µé¢</figcaption></figure><p>æŠŠå›¾æ ‡å’Œæ–‡å­—æ”¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œè°ƒæ•´ä¸€ä¸‹å¤§å°ï¼Œæœ€åç‚¹å‡»ç•Œé¢å³ä¸‹è§’çš„<code>æ–‡æ¡£å±æ€§</code>ä¿®æ”¹å›¾å½¢å¤§å°å°±å¯ä»¥è£å‰ªæ‰å¤šä½™çš„éƒ¨åˆ†äº†ï¼Œéå¸¸çš„å‚»ç“œğŸ˜‚å½“ç„¶è¿™åªæ˜¯æœ€åŸºç¡€çš„æ“ä½œï¼Œè¿™ä¸ªè½¯ä»¶çš„åŠŸèƒ½è¿œæ¯”å®ƒå¤šå¾—å¤šï¼Œç•™åˆ°ä»¥åä¿ºå†æ…¢æ…¢ç ”ç©¶ã€‚</p><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼ˆå·¦ä¸Šè§’ï¼‰ï¼š</p><figure><img src="https://s21.ax1x.com/2025/06/27/pVmOnXV.jpg" alt="æ»¡æ˜" /><figcaption aria-hidden="true">æ»¡æ˜</figcaption></figure><h2 id="ç‚¹å‡»ç­¾åè·³è½¬åˆ°é¦–é¡µ">ç‚¹å‡»ç­¾åè·³è½¬åˆ°é¦–é¡µ</h2><p>ä¸‹é¢è§£é‡Šç¬¬äºŒä¸ªåŠŸèƒ½ã€‚</p><p>è¿™é‡Œçš„å›¾æ ‡å’Œè‰ºæœ¯å­—æ˜¯ç”±ä¸€ä¸ª svgæ–‡ä»¶å‘ˆç°çš„ï¼Œåªè¦ç‚¹å‡»è¿™ä¸€å—åŒºåŸŸå°±ä¼šè·³è½¬ã€‚</p><p>å…¶å® Hexo Fluidä¸»é¢˜<strong>é»˜è®¤é…ç½®</strong>ä¸‹ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„æ–‡å­—æ˜¯å¯ä»¥è·³è½¬é¦–é¡µçš„ï¼Œä½†æ˜¯æ›¿æ¢æˆè‰ºæœ¯å­—å°±ä¸å¥æ•ˆäº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿä¸å¦¨çœ‹çœ‹ä»¥å‰æ˜¯æ€ä¹ˆæŠŠæ–‡å­—æ›¿æ¢æˆsvg è‰ºæœ¯å­—çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span>  navbarBrand  =  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.container a&#x27;</span>);<br><br>navbarBrand.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`</span><br><span class="hljs-string">  &lt;object type=&quot;image/svg+xml&quot; data=&quot;/img/banyee&#x27;s Blog.svg&quot;&gt;&lt;/object&gt;</span><br><span class="hljs-string">`</span>;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>&lt;object&gt;</code>æ ‡ç­¾ä¼š<strong>é˜»æ­¢ç‚¹å‡»äº‹ä»¶ä¼ é€’åˆ°çˆ¶å…ƒç´ </strong>ã€‚è¿™æ˜¯å› ä¸º<code>&lt;object&gt;</code>å†…éƒ¨çš„å†…å®¹ä¼šè¢«å½“æˆä¸€ä¸ª<strong>ç‹¬ç«‹çš„æ–‡æ¡£</strong>åŠ è½½è¿›æ¥ï¼Œå®ƒå’Œçˆ¶é¡µé¢æ˜¯<strong>éš”ç¦»</strong>çš„ï¼Œè‡ªç„¶ä¸ä¼šç»§æ‰¿ç‚¹å‡»è·³è½¬çš„åŠŸèƒ½ï¼Œç®€å•æ¥è¯´å°±æ˜¯é¼ æ ‡è¢«è¿™ä¸ªsvg å›¾åƒæŒ¡ä½äº†ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span>  navbarBrand  =  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.container a&#x27;</span>);<br><br><span class="hljs-comment">/* &lt;object&gt; æ ‡ç­¾ä¼šé˜»æ­¢ç‚¹å‡»äº‹ä»¶ä¼ é€’åˆ°çˆ¶å…ƒç´ ã€‚è¿™æ˜¯å› ä¸º &lt;object&gt; å†…éƒ¨çš„å†…å®¹ï¼ˆSVGï¼‰ä¼š&quot;å¸æ”¶&quot;ç‚¹å‡»äº‹ä»¶ã€‚</span><br><span class="hljs-comment">ä½¿ç”¨ pointer-events: none å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ */</span><br><br>navbarBrand.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`</span><br><span class="hljs-string">  &lt;object type=&quot;image/svg+xml&quot; data=&quot;/img/banyee&#x27;s Blog.svg&quot; style=&quot;pointer-events: none;&quot;&gt;&lt;/object&gt;</span><br><span class="hljs-string">`</span>;<br><br>navbarBrand.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">&#x27;https://kznleaf.top&#x27;</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><p>åªæ·»åŠ äº†ä¸€ç‚¹ç‚¹ä»£ç ï¼š<code>style="pointer-events: none</code>ï¼ŒåŸç†æ˜¯è§„å®šæˆ‘ä»¬æ’å…¥çš„å…ƒç´ ä¸ä¼šå“åº”ä»»ä½•é¼ æ ‡äº¤äº’äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ’å…¥çš„svgå¯¹äºé¼ æ ‡æ¥è¯´æ˜¯<strong>é€æ˜</strong>çš„ï¼Œä½ å¯¹å®ƒçš„ç‚¹å‡»éƒ½ä¼šç©¿é€åˆ°ä¸‹é¢å»ï¼Œè¿™æ ·ä¸€æ¥å°±èƒ½æ­£å¸¸è·³è½¬äº†ã€‚</p><h2 id="åŠ å¿«å›½å†…è®¿é—®é€Ÿåº¦">åŠ å¿«å›½å†…è®¿é—®é€Ÿåº¦</h2><p>Cloudflareè¢«ç§°ä¸ºèµ›åšæ´»ä½›ï¼Œå‘ç”¨æˆ·æä¾›<strong>ä¸éœ€è¦å®åè®¤è¯çš„ã€å…è´¹çš„</strong> CDNåŠ é€ŸæœåŠ¡ã€‚ä½†æ˜¯å‘¢ï¼Œç”±äºå¤©æœå¥‡è‘©çš„ç½‘ç»œç¯å¢ƒï¼Œä½¿ç”¨ Cloudflareæä¾›çš„æœåŠ¡åè€Œä¼š<strong>æ‹–æ…¢</strong>å›½å†…çš„åŠ è½½é€Ÿåº¦ï¼Œè¿‘å¹´æ¥ä¸å°‘Cloudflare ä¸ºç”¨æˆ·åˆ†é…çš„èŠ‚ç‚¹éƒ½å·²ç»è¢« GFWå±è”½ï¼ˆåŒ…æ‹¬ä¿ºä½¿ç”¨çš„èŠ‚ç‚¹ï¼‰ã€‚ä¸ºäº†è§„é¿ GFWï¼Œæœ‰äººæƒ³å‡ºäº†ä½¿ç”¨ä¼˜é€‰åŸŸå/ IPçš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ç°åœ¨å¾ˆå¤šä¼˜é€‰åŸŸåä¹Ÿè¢« GFW å±è”½äº†ğŸ˜‚è¿™ä¹Ÿç¬¦åˆ GFWçš„ä¸€è´¯åŸåˆ™ï¼šå®å¯æ»¥æ€é”™æ€ï¼Œä¹Ÿç»ä¸æ¼æ‰ä»»ä½•ä¸€ä¸ªã€<strong>å¯èƒ½</strong>ã€‘åŒ…å«æ”¿æ²»æ•æ„Ÿä¿¡æ¯çš„ç½‘ç«™ã€‚</p><p>å˜›ï¼Œè¦æƒ³äº«å—å›½å†…çš„åŠ é€ŸæœåŠ¡ï¼Œæœ€ç¬¦åˆã€å›½å®¶æ„å¿—ã€‘çš„åšæ³•å°±æ˜¯åŸŸåå¤‡æ¡ˆ:</p><blockquote><p>æ ¹æ®å›½åŠ¡é™¢ä»¤ç¬¬292å·ã€Šäº’è”ç½‘ä¿¡æ¯æœåŠ¡ç®¡ç†åŠæ³•ã€‹å’Œã€Šéç»è¥æ€§äº’è”ç½‘ä¿¡æ¯æœåŠ¡å¤‡æ¡ˆç®¡ç†åŠæ³•ã€‹è§„å®šï¼Œå›½å®¶å¯¹ç»è¥æ€§äº’è”ç½‘ä¿¡æ¯æœåŠ¡å®è¡Œè®¸å¯åˆ¶åº¦ï¼Œå¯¹éç»è¥æ€§äº’è”ç½‘ä¿¡æ¯æœåŠ¡å®è¡Œå¤‡æ¡ˆåˆ¶åº¦ã€‚æœªè·å–è®¸å¯æˆ–è€…æœªå±¥è¡Œå¤‡æ¡ˆæ‰‹ç»­çš„ï¼Œä¸å¾—ä»äº‹äº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼Œå¦åˆ™å±äºè¿æ³•è¡Œä¸ºã€‚</p></blockquote><p>ä¼˜ç‚¹ï¼šè¿è¥å•†å¤§å‘æ…ˆæ‚²ä¸ºä½ æä¾›å¤§é™†åŠ é€ŸæœåŠ¡</p><p>ç¼ºç‚¹ï¼š</p><ol type="1"><li>å¤‡æ¡ˆæµç¨‹<strong>åˆè‡­åˆé•¿</strong>ï¼Œä»¥è…¾è®¯äº‘ä¸ºä¾‹ï¼š<ul><li>éªŒè¯å¤‡æ¡ˆç±»å‹</li><li>å¡«å†™ä¸»ä½“ä¿¡æ¯</li><li>å¡«å†™ç½‘ç«™/åŸŸåæˆ– APP ä¿¡æ¯</li><li>ä¸Šä¼ è¡¥å……ææ–™ï¼ˆæ¯”å¦‚èº«ä»½è¯ï¼‰</li><li>æäº¤å¤‡æ¡ˆ</li><li>çŸ­ä¿¡æ ¸éªŒ</li><li>ç®¡å±€å®¡æ ¸</li></ul></li><li>å¤‡æ¡ˆå°±æ„å‘³ç€æŠŠç½‘ç«™çš„æ‰€æœ‰å†…å®¹ã€ä¸»åŠ¨ã€‘æäº¤ç»™å¤©æœå®¡æŸ¥ï¼Œè¿™ä¿ºå¯æ²¡æ³•æ¥å—ã€‚</li></ol><hr /><p>åœ¨ä¸å¤‡æ¡ˆçš„æƒ…å†µä¸‹ï¼Œç¨ç¨æé«˜å›½å†…è®¿é—®é€Ÿåº¦çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ Cloudflareçš„<strong>è‡ªå®šä¹‰ä¸»æœºå</strong>æœåŠ¡ã€‚</p><p><img src="https://s21.ax1x.com/2025/06/27/pVmh91g.png" /></p><p>åœ¨æºç«™çš„ Cloudflareé¡µé¢æ·»åŠ è‡ªå®šä¹‰ä¸»æœºåï¼Œä¸¤è¾¹çš„éªŒè¯éƒ½é€šè¿‡ä¹‹åï¼Œè‡ªå®šä¹‰ä¸»æœºåå¯¹åº”çš„ç½‘ç«™çš„æµé‡éƒ½ä¼šè¢«å¼•å‘æºç«™ã€‚</p><p>è¿™ç§æ–¹æ³•éœ€è¦å‡†å¤‡ä¸¤ä¸ªåŸŸåï¼šä¸€ä¸ªä½œä¸º<strong>å›é€€æº</strong>ï¼Œæ‰˜ç®¡åˆ°Cloudflareï¼›å¦ä¸€ä¸ªä½œä¸º<strong>å®é™…è®¿é—®çš„åŸŸå</strong><code>kznleaf.top</code>ï¼Œæ‰˜ç®¡åˆ°éCloudflareçš„DNSè§£ææœåŠ¡å™¨ã€‚ä½œä¸ºå›é€€æºçš„åŸŸåæ·»åŠ <code>A</code>è®°å½•æŒ‡å‘ç½‘ç«™æœåŠ¡å™¨çš„åœ°å€ï¼Œç„¶ååœ¨SaaSé‡ŒæŠŠ<code>kznleaf.top</code>ä½œä¸ºè‡ªå®šä¹‰ä¸»æœºåæ·»åŠ è¿›æ¥ï¼Œæ ¹æ®æç¤ºè¿›è¡Œ<code>TXT</code>è®°å½•éªŒè¯ã€‚æœ€åä¸º<code>kznleaf.top</code>æ·»åŠ ä¸€æ¡<code>CNAME</code>è®°å½•æŒ‡å‘å›é€€æºçš„åŸŸåå³å¯ã€‚</p><p>é€šè¿‡ CNAME çš„æ–¹å¼æŒ‡å‘ Cloudflare è€Œéå›ºå®š IPï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨ Cloudflareçš„æ³›æ’­è‡ªåŠ¨æ‰¾åˆ°æœ€å¿«çš„è¾¹ç¼˜æœåŠ¡å™¨ï¼ŒåŠ å¿«äº†è®¿é—®é€Ÿåº¦ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Theme</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Cloudflare</tag>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£…ArchLinuxè™šæ‹Ÿæœºè¿‡ç¨‹è®°å½•</title>
    <link href="/2025/06/25/ArchLinux%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/"/>
    <url>/2025/06/25/ArchLinux%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<figure><img src="https://s21.ax1x.com/2025/06/25/pVeqEee.jpg"alt="Arch Linux" /><figcaption aria-hidden="true">Arch Linux</figcaption></figure><h2 id="å‰è¨€">å‰è¨€</h2><p>æœ€è¿‘ç»™æ‰‹ä¸Šçš„ä¸¤ä¸ªç¬”è®°æœ¬éƒ½è£…ä¸Šäº† Arch Linuxè™šæ‹Ÿæœºï¼Œæ¥æ¥å›å›é‡è£…äº†å¤§æ¦‚å››äº”æ¬¡ï¼Œè¿™é‡ŒæŠŠæ¯”è¾ƒé‡è¦çš„åœ°æ–¹è®°å½•ä¸€ä¸‹ã€‚ä¸»è¦å‚è€ƒï¼š<ahref="https://arch.icekylin.online/guide/">archlinuxç®€æ˜æŒ‡å—</a>ã€<ahref="https://archlinuxstudio.github.io/ArchLinuxTutorial/#/">Arch Linuxå®‰è£…ä½¿ç”¨æ•™ç¨‹ - ArchTutorial - Arch Linux Studio</a></p><h2 id="å±å¹•åˆ†è¾¨ç‡">å±å¹•åˆ†è¾¨ç‡</h2><p>ç¬¬ä¸€æ¬¡æˆ‘æ˜¯åœ¨å¤–ç•Œ24å¯¸2kæ˜¾ç¤ºå±çš„æ¸¸æˆæœ¬ä¸Šå®‰è£…çš„ Arch Linuxï¼Œåœ¨è£…å¥½ KDEæ¡Œé¢ç¯å¢ƒå’Œè™šæ‹Ÿæœºå¢å¼ºåŠŸèƒ½ä¹‹åï¼Œè™šæ‹Ÿæœºçš„ç•Œé¢åˆ†è¾¨ç‡è·Ÿå®¿ä¸»æœºå·®ä¸å¤šï¼Œç®—æ˜¯æ¸…æ™°ã€‚ä½†æ˜¯åœ¨å¦ä¸€ä¸ª14å¯¸2880x1880 åˆ†è¾¨ç‡çš„è½»è–„æœ¬ä¸Šå®‰è£…ä¹‹åï¼Œç•Œé¢çœ‹èµ·æ¥æœ‰ç‚¹ç³Šï¼Œåƒè¿™æ ·ï¼š</p><figure><img src="https://s21.ax1x.com/2025/06/25/pVe2GCQ.jpg" alt="ç³Š" /><figcaption aria-hidden="true">ç³Š</figcaption></figure><p>åº”è¯¥å±äºæ­£å¸¸ç°è±¡ï¼Œç©è™šæ‹Ÿæœºçš„è¯è¿˜æ˜¯æ¨èç”¨å¤§å±</p><h2 id="æ— æ³•è¿æ¥æ ¡å›­ç½‘">æ— æ³•è¿æ¥æ ¡å›­ç½‘</h2><p>æ¡¥æ¥æ–¹å¼ä¸­è™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æœºå™¨ï¼Œç›¸å½“äºä¸€ä¸ªçœŸå®æœºå™¨ï¼Œè€Œæ­¤æœºå™¨åœ¨æ ¡å›­ç½‘ä¸­å¹¶æœªæ³¨å†Œï¼Œåœ¨æ ¡å›­ç½‘ä¸­æ˜¯<strong>éœ€è¦éªŒè¯</strong>çš„ï¼Œå¯¼è‡´æ— æ³•è”ç½‘ã€‚</p><p>ä½¿ç”¨ NAT æ–¹å¼å¯ä»¥è”ç½‘ï¼Œå› ä¸º NAT æ¨¡å¼ä¸‹è™šæ‹Ÿæœºé€šè¿‡å®¿ä¸»æœºæ¥è”ç½‘ã€‚</p><figure><img src="https://s21.ax1x.com/2025/06/24/pVeecCt.png"alt="NATæ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼" /><figcaption aria-hidden="true">NATæ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼</figcaption></figure><h2 id="linuxç£ç›˜åˆ†åŒº">Linuxç£ç›˜åˆ†åŒº</h2><p>å‰ç½®çŸ¥è¯†ï¼šLinuxæ˜¯é€šè¿‡ç›®å½•æ ‘çš„æ–¹å¼æ¥ç®¡ç†æ–‡ä»¶çš„ï¼Œå½¢å¦‚</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stata">/<br>â”œâ”€â”€ bin<br>â”œâ”€â”€ <span class="hljs-keyword">boot</span><br>â”œâ”€â”€ etc<br>â”œâ”€â”€ home<br>â”‚   â”œâ”€â”€ user1<br>â”‚   â””â”€â”€ user2<br>â”œâ”€â”€ <span class="hljs-keyword">var</span><br>â””â”€â”€ usr<br>    â””â”€â”€ <span class="hljs-keyword">local</span><br></code></pre></td></tr></table></figure><p>å¯¹äº Linux çš„åˆ†åŒºå’Œç›®å½•æ¥è¯´ï¼Œéœ€è¦ç†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ol type="1"><li>ç›®å½•æ˜¯æ ‘çŠ¶å±‚çº§ç»“æ„çš„ã€‚</li><li>åˆ†åŒºå¯ä»¥é€šè¿‡æŒ‚è½½çš„æ–¹å¼æŒ‡å®šä¸ºä»»ä½•å±‚çº§ä¸‹çš„ç›®å½•ã€‚</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ç°åœ¨æˆ‘ä»¬æ‰‹ä¸Šæœ‰ä¸¤å—ç¡¬ç›˜ï¼š</p><ul><li><code>/dev/sda1</code> ä¸»åˆ†åŒºï¼Œä½œä¸ºæ ¹ç›®å½•</li><li><code>/dev/sdb1</code>ç¬¬äºŒå—ç£ç›˜</li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠç¬¬äºŒå—ç›˜æŒ‚è½½åˆ°<code>/home</code>ç›®å½•ï¼Œè¿è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/sdb1 /home<br></code></pre></td></tr></table></figure><p>è¿™æ ·<code>/home</code>çš„æ–‡ä»¶å°±å…¨éƒ¨æ¥è‡ª<code>/dev/sdb1</code>ç£ç›˜åˆ†åŒºäº†ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œå®‰è£…Linuxç³»ç»Ÿï¼Œåªéœ€è¦ç»™ç¡¬ç›˜åˆ†ä¸€ä¸ªåŒºï¼Œç„¶åæŒ‚è½½<code>/</code>æ ¹åˆ†åŒºç›®å½•å³å¯æ­£å¸¸å®‰è£…å’Œä½¿ç”¨ã€‚</p><p><strong>fdiskå‘½ä»¤</strong>ï¼š</p><p>ä½œç”¨ï¼šæ ¼å¼åŒ–ç£ç›˜ï¼Œç”¨äºåˆ†åŒºæ“ä½œã€‚çº¯å‘½ä»¤è¡Œäº¤äº’ã€‚ä¸€èˆ¬ä¸ç”¨å®ƒæ¥åˆ†åŒºï¼Œè€Œæ˜¯ç”¨<code>fdisk -l</code>æ¥æŸ¥çœ‹å½“å‰åˆ†åŒºçŠ¶æ€ã€‚</p><p><strong>cfdiskå‘½ä»¤</strong></p><p>ç›¸å½“äºå›¾å½¢åŒ–ç‰ˆæœ¬çš„fdiskï¼Œç”¨æ–¹å‘é”®é€‰æ‹©åˆ†åŒºï¼ŒTabé”®åˆ‡æ¢æ“ä½œæŒ‰é’®ï¼Œç„¶åé€‰<code>[New]</code>ã€<code>[Delete]</code>ã€<code>[Write]</code>ç­‰è¿›è¡Œæ“ä½œã€‚ä¸€èˆ¬ç”¨è¿™ä¸ªæ¥åˆ†åŒºã€‚</p><h2 id="åˆ†åŒº">åˆ†åŒº</h2><p>å…ˆè®¾å®šåˆ†åŒºæ–¹æ¡ˆï¼Œå¯¹äºè™šæ‹Ÿæœºæ¥è¯´å¯ä»¥è®¾ç½®ä¸‰ä¸ªåˆ†åŒºï¼š</p><ul><li><strong>EFI åˆ†åŒº</strong>ï¼š512M</li><li>Swap åˆ†åŒºï¼š4G</li><li>æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºï¼šå‰©ä½™å…¨éƒ¨</li></ul><p>ç„¶åé€šè¿‡<code>fdisk -l</code>å‘½ä»¤ï¼Œç¡®å®šéœ€è¦åˆ†åŒºçš„ç£ç›˜æ˜¯<code>/dev/sda</code>ã€‚</p><p>åœ¨åˆ†åŒºä¹‹å‰ï¼Œ<strong>é¦–å…ˆå°†ç£ç›˜è½¬æ¢ä¸º gpt ç±»å‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">fdisk -l                    <span class="hljs-comment">#æ˜¾ç¤ºåˆ†åŒºæƒ…å†µ æ‰¾åˆ°ä½ æƒ³å®‰è£…çš„ç£ç›˜åç§°</span><br>parted /dev/sda             <span class="hljs-comment">#æ‰§è¡Œpartedï¼Œè¿›å…¥äº¤äº’å¼å‘½ä»¤è¡Œï¼Œè¿›è¡Œç£ç›˜ç±»å‹å˜æ›´</span><br>(parted)mktable             <span class="hljs-comment">#è¾“å…¥mktable</span><br>New disk label <span class="hljs-built_in">type</span>? gpt    <span class="hljs-comment">#è¾“å…¥gpt å°†ç£ç›˜ç±»å‹è½¬æ¢ä¸ºgpt å¦‚ç£ç›˜æœ‰æ•°æ®ä¼šè­¦å‘Šï¼Œè¾“å…¥yeså³å¯</span><br>(parted)quit                        <span class="hljs-comment">#æœ€åquité€€å‡ºpartedå‘½ä»¤è¡Œäº¤äº’</span><br></code></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨<code>cfdisk</code>å‘½ä»¤å¯¹ç£ç›˜åˆ†åŒºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cfdisk /dev/sda<br></code></pre></td></tr></table></figure><p>å…·ä½“çš„çš„åˆ†åŒºå¦‚ä¸‹ï¼š</p><ul><li><code>/dev/sda1</code>ï¼š<strong>EFI åˆ†åŒº</strong>ï¼Œ512M</li><li><code>/dev/sda2</code>ï¼šSwap åˆ†åŒºï¼Œ4G</li><li><code>/dev/sda3</code>ï¼šæ–‡ä»¶ç³»ç»Ÿåˆ†åŒºã€‚å…¶ä½™å…¨éƒ¨</li></ul><p><code>[write]</code>åï¼Œé€€å‡ºï¼Œä½¿ç”¨<code>fdisk -l</code>å†æ¬¡æ£€æŸ¥åˆ†åŒºæƒ…å†µã€‚</p><figure><img src="https://s21.ax1x.com/2025/06/24/pVemSa9.png" alt="åˆ†åŒº" /><figcaption aria-hidden="true">åˆ†åŒº</figcaption></figure><p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸€æ­¥ä¸è¦å¿˜è®°é…ç½® EFIåˆ†åŒºï¼åœ¨ç®€æ˜æŒ‡å—ä¸­ï¼Œç›´åˆ°ã€å®‰è£…è¯¦è§£ã€‘ä¸€æ–‡æ‰æè¿°äº†æ€ä¹ˆé…ç½® EFIåˆ†åŒºï¼Œå®é™…ä¸Š EFI åˆ†åŒºåœ¨è¿™é‡Œå°±åˆ›å»ºå¥½äº†ï¼Œåº”è¯¥æ”¾åˆ°å‰è¾¹å°±è®²æ‰å¯¹ã€‚</p><h2 id="æ ¼å¼åŒ–åˆ†åŒº">æ ¼å¼åŒ–åˆ†åŒº</h2><p>åˆ’å®šåˆ†åŒºåå°±æ˜¯æ ¼å¼åŒ–åˆ†åŒºï¼Œåˆ†ä¸‰æ­¥ï¼š</p><ul><li>å°† EFIåˆ†åŒºæ ¼å¼åŒ–ä¸º<code>FAT32</code>æ ¼å¼ï¼š<code>mkfs.vfat /dev/sda1</code></li><li>æ ¼å¼åŒ– Swap åˆ†åŒºï¼š<code>mkswap /dev/sdxn</code></li><li>å°†æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºæ ¼å¼åŒ–ä¸º<code>Btrfs</code>æ–‡ä»¶ç³»ç»Ÿï¼š<code>mkfs.btrfs -L myArch /dev/sda3</code>ï¼Œå…¶ä¸­<code>-L</code>åçš„æ ‡ç­¾åå¯ä»¥éšæ„èµ·ã€‚</li></ul><h3 id="å…³äºæŒ‚è½½">å…³äºæŒ‚è½½</h3><p>æŒ‚è½½å¯åˆ†ä¸º<strong>æ°¸ä¹…æ€§æŒ‚è½½</strong>å’Œ<strong>ä¸´æ—¶æ€§æŒ‚è½½</strong>ä¸¤ç§æ–¹å¼ã€‚<code>mount</code>å‘½ä»¤ä¸ºä¸´æ—¶æ€§æŒ‚è½½ï¼Œåœ¨æ“ä½œç³»ç»Ÿé‡å¯æ—¶å°±ä¼šå¤±æ•ˆã€‚è€Œæ°¸ä¹…æ€§æŒ‚è½½åˆ™éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/fstab</code>ï¼Œå°†éœ€è¦æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿå†™å…¥è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå†ä½¿ç”¨å‘½ä»¤<code>mount -a</code>è®©é…ç½®ä¿¡æ¯ç”Ÿæ•ˆï¼ŒæŒ‚è½½çš„æ–‡ä»¶å³å¯ä½¿ç”¨ï¼Œé‡å¯åæŒ‚è½½ä»ç„¶æœ‰æ•ˆã€‚</p><p>åœ¨ Btrfs æ–‡ä»¶ç³»ç»Ÿä¸Šä¸º Linuxå®‰è£…å‡†å¤‡åˆ†åŒºï¼Œå¹¶ä½¿ç”¨å­å·ï¼ˆsubvolumeï¼‰æ¥ç»„ç»‡æ ¹ç›®å½•ï¼ˆ/ï¼‰å’Œç”¨æˆ·ç›®å½•ï¼ˆ/homeï¼‰ã€‚è¿™æ˜¯Arch Linux å’Œå…¶ä»–ä¸€äº› Linux å‘è¡Œç‰ˆä¸­å¸¸ç”¨çš„åˆ†åŒºæ–¹å¼ï¼Œç‰¹åˆ«éœ€è¦ Btrfsçš„é«˜çº§åŠŸèƒ½ï¼ˆå¦‚å¿«ç…§ã€å‹ç¼©ã€å¤åˆ¶ï¼‰æ—¶ã€‚æœ¬æ¬¡åˆ†åŒºå°±é‡‡ç”¨äº†å­å·çš„æ–¹å¼ã€‚</p><h3 id="å¼•å¯¼ç¨‹åºçš„ä½ç½®">å¼•å¯¼ç¨‹åºçš„ä½ç½®</h3><p><a href="https://arch.icekylin.online/guide/">archlinuxç®€æ˜æŒ‡å—</a>å°†GRUBå¼•å¯¼ç¨‹åºå®‰è£…åœ¨<code>/boot</code>ç›®å½•ä¸‹ï¼Œä¸è¿‡ç»è¿‡æŸ¥æ‰¾èµ„æ–™å‘ç°å¹¶ä¸æ¨èè¿™æ ·åšï¼Œåº”è¯¥æŠŠEFI åˆ†åŒºæŒ‚è½½åˆ°<code>/boot/efi</code>åˆ†åŒºä¸‹ï¼Œç„¶åæŠŠ GRUBå¼•å¯¼ç¨‹åºå®‰è£…åˆ°<code>/boot/efi</code>ã€‚</p><p>å®é™…æ‰§è¡Œçš„æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŒ‚è½½æ ¹ç›®å½•å­å·ï¼ˆ@ï¼‰</span><br>mount -t btrfs -o compress=zstd,subvol=/@ /dev/sda3 /mnt<br><br><span class="hljs-comment"># åˆ›å»º home å’Œ boot ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> /mnt/home<br><span class="hljs-built_in">mkdir</span> -p /mnt/boot/efi<br><br><span class="hljs-comment"># æŒ‚è½½ home å­å·</span><br>mount -t btrfs -o compress=zstd,subvol=/@home /dev/sda3 /mnt/home<br><br><span class="hljs-comment"># æŒ‚è½½ EFI åˆ†åŒº</span><br>mount /dev/sda1 /mnt/boot/efi<br><br><span class="hljs-comment"># å¯ç”¨ swap åˆ†åŒº</span><br>swapon /dev/sda2<br></code></pre></td></tr></table></figure><p>æŒ‚è½½åçš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span>mnt<br>â”œâ”€â”€ home<span class="hljs-operator">/</span>        â† æŒ‚è½½äº† <span class="hljs-variable">@home</span> å­å·<br>â”œâ”€â”€ boot<span class="hljs-operator">/</span><br>â”‚   â””â”€â”€ efi<span class="hljs-operator">/</span>     â† æŒ‚è½½äº† <span class="hljs-operator">/</span>dev<span class="hljs-operator">/</span>sda1ï¼ˆEFI <span class="hljs-keyword">System</span> <span class="hljs-keyword">Partition</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ä¼ ç»Ÿçš„ BIOS å¯åŠ¨æ–¹å¼æ˜¯ä¹ æƒ¯å°†å¼•å¯¼ç¨‹åºæ”¾åˆ°<code>/boot</code>ï¼Œä½†æ˜¯ UEFIå¯åŠ¨æ–¹å¼ä¸€èˆ¬æ”¾åˆ°<code>/boot/efi</code>ï¼ˆä¹Ÿæœ‰ç›´æ¥æ”¾åˆ°<code>/efi</code>çš„ï¼‰ã€‚å…³äºBIOS å’Œ UEFI è¿™ä¸¤ç§å¯åŠ¨æ–¹å¼çš„åŒºåˆ«ï¼Œå‚è§ï¼š<ahref="https://www.partitionwizard.com/partitionmagic/uefi-vs-bios.html">https://www.partitionwizard.com/partitionmagic/uefi-vs-bios.html</a></p><h2 id="å®‰è£…å¼•å¯¼ç¨‹åº">å®‰è£…å¼•å¯¼ç¨‹åº</h2><h3 id="å®‰è£…grubè½¯ä»¶åŒ…">å®‰è£…grubè½¯ä»¶åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman -S grub efibootmgr os-prober<br></code></pre></td></tr></table></figure><p><code>os-prober</code>ä¸»è¦æ˜¯ä¸ºå¼•å¯¼åŒç³»ç»Ÿä¸­çš„ windowsç³»ç»Ÿä½¿ç”¨çš„ï¼Œå¦‚æœåªå®‰è£…ä¸€ä¸ªLinuxè™šæ‹Ÿæœºç³»ç»Ÿï¼Œé‚£å°±å¯ä»¥çœç•¥ï¼Œç›´æ¥å†™æˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman -S grub efibootmgr<br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼Œåé¢ç¼–è¾‘<code>/etc/default/grub</code>æ–‡ä»¶çš„æ—¶å€™ä¹Ÿä¸ç”¨æ·»åŠ æ–°çš„ä¸€è¡Œ<code>GRUB_DISABLE_OS_PROBER=false</code>äº†ã€‚</p><h3 id="å°†grubå®‰è£…åˆ°efiåˆ†åŒº">å°†grubå®‰è£…åˆ°EFIåˆ†åŒº</h3><p>ä¹‹å‰æˆ‘å·²ç»æŠŠRFIåˆ†åŒºæŒ‚è½½åˆ°äº†<code>/boot/efi</code>ç›®å½•ä¸‹ï¼Œæ‰€ä»¥è¿™é‡Œä¹ŸæŠŠgrubå®‰è£…åˆ°è¿™ä¸ªç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ARCH<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…å®Œæ¯•">å®‰è£…å®Œæ¯•</h2><figure><img src="https://s21.ax1x.com/2025/06/24/pVeA3WT.png" alt="123" /><figcaption aria-hidden="true">123</figcaption></figure><p>è£…å®Œæ¡Œé¢ç¯å¢ƒä»¥åæœ€å¥½å…ˆæŠŠè™šæ‹Ÿæœºå¢å¼ºåŠŸèƒ½åŠ ä¸Šï¼Œè¿™æ ·ä»¥åå¯ä»¥ç›´æ¥ä»å®¿ä¸»æœºå¤åˆ¶å‘½ä»¤äº†ï¼Œçœä¸‹ä¸å°‘æ—¶é—´ã€‚</p><p>å®‰è£…è¾“å…¥æ³•çš„è¯å…ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S fcitx5-im <span class="hljs-comment">#åŸºç¡€åŒ…ç»„</span><br><span class="hljs-built_in">sudo</span> pacman -S fcitx5-chinese-addons <span class="hljs-comment">#å®˜æ–¹ä¸­æ–‡è¾“å…¥å¼•æ“</span><br><span class="hljs-built_in">sudo</span> pacman -S fcitx5-anthy <span class="hljs-comment">#æ—¥æ–‡è¾“å…¥å¼•æ“</span><br>yay -S fcitx5-pinyin-moegirl <span class="hljs-comment">#èŒå¨˜ç™¾ç§‘è¯åº“ ç”±äºä¸­å›½å¤§é™†æ”¿åºœå¯¹githubå°é”ï¼Œä½ å¯èƒ½åœ¨æ­¤å¡ä½ã€‚å¦‚å¡ä½ï¼Œå¯æ ¹æ®åæ–‡è®¾ç½®å¥½ä»£ç†åå†å®‰è£…</span><br><span class="hljs-built_in">sudo</span> pacman -S fcitx5-pinyin-zhwiki <span class="hljs-comment">#ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯åº“</span><br><span class="hljs-built_in">sudo</span> pacman -S fcitx5-material-color <span class="hljs-comment">#ä¸»é¢˜</span><br></code></pre></td></tr></table></figure><p>ç„¶åéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚ç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œ<ahref="https://arch.icekylin.online/guide/">archlinuxç®€æ˜æŒ‡å—</a>ä¸­ä¸ºè¾“å…¥æ³•é…ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ³•å·²ç»å¤±æ•ˆã€‚æ­£ç¡®çš„æ“ä½œæ˜¯ï¼š</p><p>åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤<code>EDITOR=vim sudoedit /etc/environment</code>ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GTK_IM_MODULE=fcitx<br>QT_IM_MODULE=fcitx<br>XMODIFIERS=@im=fcitx<br>SDL_IM_MODULE=fcitx<br></code></pre></td></tr></table></figure><p>ç›®çš„æ˜¯ä¸º konsole ä»¥åŠ dolphin æä¾›ä¸­æ–‡è¾“å…¥æ”¯æŒã€‚</p><p>ç„¶åï¼Œæ‰“å¼€<code>ç³»ç»Ÿè®¾ç½® &gt; åŒºåŸŸè®¾ç½® &gt; è¾“å…¥æ³•</code>ï¼Œå…ˆç‚¹å‡»è¿è¡Œ<code>Fcitx</code>å³å¯ï¼Œæ‹¼éŸ³ä¸ºé»˜è®¤æ·»åŠ é¡¹ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åŒæ‹¼è¾“å…¥æ³•ï¼ŒåŒ…å«å¤šç§å¯é€‰çš„åŒæ‹¼æ–¹æ¡ˆï¼Œæ¯”å¦‚æˆ‘ç”¨çš„å°é¹¤ã€‚</p><p>æ¥ä¸‹æ¥ç‚¹å‡»æ‹¼éŸ³å³ä¾§çš„é…ç½®æŒ‰é’®ï¼Œç‚¹é€‰äº‘æ‹¼éŸ³å’Œåœ¨ç¨‹åºä¸­æ˜¾ç¤ºé¢„ç¼–è¾‘æ–‡æœ¬ï¼Œæœ€ååº”ç”¨ã€‚</p><p>å›åˆ°è¾“å…¥æ³•è®¾ç½®ï¼Œç‚¹å‡»é…ç½®é™„åŠ ç»„ä»¶ï¼Œæ‰¾åˆ°ç»å…¸ç”¨æˆ·ç•Œé¢ï¼Œåœ¨ä¸»é¢˜é‡Œé€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„é¢œè‰²ï¼Œæœ€ååº”ç”¨ã€‚</p><p>æœ€åé‡å¯å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨è¾“å…¥æ³•äº†ã€‚</p><h3 id="ä»githubä¸‹è½½æ–‡ä»¶">ä»githubä¸‹è½½æ–‡ä»¶</h3><p>æœ‰æ—¶å€™éœ€è¦ç›´æ¥ä» githubä»“åº“æ‹‰å–æ‰€éœ€çš„å®‰è£…è„šæœ¬ï¼Œæ¯”å¦‚<code>zim</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -fsSL https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh<br></code></pre></td></tr></table></figure><p>github.io ä¸ raw.githubusercontent.comå·²ç»è¢«å¤©æœæ”¿åºœç›¯ä¸Šäº†ï¼Œè™½ç„¶å°é”åŠ›åº¦æš‚æ—¶è¿˜æ²¡æœ‰å¾ˆå¤§ï¼Œä½†æ˜¯è¿è¡Œä¸Šè¿°å‘½ä»¤çš„æ—¶å€™å¤šåŠä¼šè¿æ¥å¤±è´¥ã€‚æœ€æ ¹æœ¬çš„æ–¹æ³•å½“ç„¶æ˜¯é…ç½®å…¨å±€ä»£ç†ï¼Œä¸è¿‡å¦‚æœè¿˜æ²¡é…ç½®å…¨å±€ä»£ç†çš„è¯ï¼Œå¯ä»¥è€ƒè™‘æš‚æ—¶å€ŸåŠ©<a href="https://ghproxy.link/">Github Proxy</a> ä¸‹è½½ã€‚</p><h3 id="ä¿æŒç³»ç»Ÿä¸ºæœ€æ–°">ä¿æŒç³»ç»Ÿä¸ºæœ€æ–°</h3><p>Arch Linuxé‡‡ç”¨æ»šåŠ¨å¼æ›´æ–°ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸€ç»å‘å¸ƒé©¬ä¸Šä¼šæ¨é€ç»™ç”¨æˆ·ã€‚åº”å½“ç»å¸¸æ›´æ–°ç³»ç»Ÿï¼Œé˜²æ­¢ç³»ç»Ÿæ»šæŒ‚ã€‚</p><p>ä½¿ç”¨<code>pacman</code>æ›´æ–°ç³»ç»Ÿï¼Œç”¨åˆ°çš„é€‰é¡¹ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>-S</code></td><td>å®‰è£…è½¯ä»¶åŒ…ï¼ˆsyncï¼‰</td></tr><tr><td><code>-y</code></td><td><strong>åŒæ­¥è½¯ä»¶åŒ…æ•°æ®åº“</strong>ï¼ˆä»æœåŠ¡å™¨æ›´æ–°æœ¬åœ°çš„åŒ…åˆ—è¡¨ï¼‰</td></tr><tr><td><code>-yy</code></td><td><strong>å¼ºåˆ¶é‡æ–°ä¸‹è½½</strong>è½¯ä»¶åŒ…æ•°æ®åº“ï¼ˆå³ä½¿ç³»ç»Ÿè®¤ä¸ºæ˜¯æœ€æ–°çš„ä¹Ÿå¼ºåˆ¶ï¼‰</td></tr><tr><td><code>-u</code></td><td>å‡çº§æ‰€æœ‰å¯å‡çº§çš„è½¯ä»¶åŒ…ï¼ˆupdateï¼‰</td></tr></tbody></table><ul><li><code>pacman -Syu</code>ç”¨äºæ­£å¸¸æ›´æ–°ï¼Œå¦‚æœæœ¬åœ°çš„æ•°æ®åº“å’Œè¿œç¨‹ä¸€è‡´çš„è¯å°±ä¸å†é‡å¤ä¸‹è½½æ•°æ®åº“ã€‚</li><li><code>pacman -Syyu</code>å¼ºåˆ¶æ›´æ–°ï¼Œå½“æ•°æ®åº“æŸåæˆ–åŒæ­¥å‡ºé”™ã€æ›´æ–°é•œåƒæºï¼ˆ<code>/etc/pacman.d/mirrorlist</code>ï¼‰ä¹‹åçš„ç¬¬ä¸€æ¬¡å¼ºåˆ¶åŒæ­¥åº”æ‰§è¡Œã€‚ä¸è¦ç»å¸¸ç”¨ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸŸåçš„åŸºç¡€çŸ¥è¯†ã€åŸŸååŠ«æŒå’ŒåŸŸåæ±¡æŸ“</title>
    <link href="/2025/06/22/%E5%9F%9F%E5%90%8D%E6%89%AB%E7%9B%B2/"/>
    <url>/2025/06/22/%E5%9F%9F%E5%90%8D%E6%89%AB%E7%9B%B2/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹<ahref="https://program-think.blogspot.com/2014/01/dns.html">æ‰«ç›² DNSåŸç†ï¼Œå…¼è°ˆâ€œåŸŸååŠ«æŒâ€å’Œâ€œåŸŸåæ¬ºéª—/åŸŸåæ±¡æŸ“â€</a>çš„æ•´ç†ï¼Œåœ¨åŸæ–‡çš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸€äº›æ³¨è§£ã€‚æ„Ÿè°¢ç¼–ç¨‹éšæƒ³ã€‚</p><p>HTTPS SSL/TLS æ‰«ç›²è§é“¾æ¥ï¼šhttps://program-think.blogspot.com/2014/11/https-ssl-tls-0.html</p><h2 id="åŸŸåè§£æçš„å®ç°è¿‡ç¨‹">åŸŸåè§£æçš„å®ç°è¿‡ç¨‹</h2><p>å¦‚æœä½ æ›¾ç»é…ç½®è¿‡ç”µè„‘çš„ç½‘å¡ï¼Œåº”è¯¥è®°å¾—ä¸Šé¢é™¤äº†æœ‰ IPåœ°å€ã€æ©ç ç­‰è®¾ç½®ï¼Œè¿˜æœ‰ä¸€é¡¹è®¾ç½®æ˜¯â€œDNSæœåŠ¡å™¨/åŸŸåæœåŠ¡å™¨â€ã€‚è¿™é¡¹è®¾ç½®å°±æ˜¯ç”¨æ¥å¸®åŠ©ä½ çš„ç”µè„‘è¿›è¡ŒåŸŸåè§£æçš„ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªâ€œDNSæœåŠ¡å™¨â€æƒ³è±¡æˆ114æŸ¥å·å°ã€‚æ¯å½“ç”µè„‘éœ€è¦ç¿»è¯‘æŸä¸ªåŸŸåï¼Œå°±æ‰¾è¿™ä¸ªåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼Œç„¶ååŸŸåæœåŠ¡å™¨ä¼šå‘Šè¯‰ä½ çš„ç”µè„‘ï¼Œè¦æŸ¥è¯¢çš„åŸŸåå¯¹åº”çš„IPåœ°å€æ˜¯å•¥ã€‚</p><p>ä¸‹é¢ç®€å•è¯´ä¸€ä¸‹ï¼Œä½ çš„ç”µè„‘è¿›è¡ŒåŸŸåè§£æçš„è¿‡ç¨‹ã€‚ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œä»¥ä¿ºåšå®¢ä¸ºä¾‹ã€‚å½“ä½ åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­è¾“å…¥https://program-think.blogspot.com/ç„¶åæ•²å›è½¦ï¼Œè¿™æ—¶å€™ç”µè„‘è½¯ä»¶ä¼šè¿›è¡Œå¦‚ä¸‹ä¸€ç³»åˆ—äº‹æƒ…ã€‚</p><ol type="1"><li>é¦–å…ˆæ ¹æ®è¾“å…¥çš„ç½‘å€ï¼Œæå–å‡ºåŸŸåï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯program-think.blogspot.comï¼‰</li><li>å¦‚æœä½ åœ¨ç³»ç»Ÿä¸­é…ç½®äº† <strong>Hosts</strong> æ–‡ä»¶ï¼Œé‚£ä¹ˆç”µè„‘ä¼šå…ˆæŸ¥è¯¢Hosts æ–‡ä»¶ï¼Œçœ‹è¿™ä¸ª program-think.blogspot.com æ˜¯å¦å·²ç»åœ¨ Hostsé‡Œé¢æœ‰äº†å¯¹åº”çš„è®°å½•ã€‚å¦‚æœæœ‰ï¼Œç›´æ¥å°±å¯ä»¥æ‹¿åˆ°è¯¥è®°å½•ä¸­çš„ IPåœ°å€ï¼Œè¿‡ç¨‹å°±ç»“æŸäº†ã€‚</li><li>å¦‚æœ Hostsé‡Œé¢æ²¡æœ‰è¿™ä¸ªåˆ«åï¼Œé‚£ä¹ˆç”µè„‘ä¼šçœ‹ä½ æœ‰æ²¡æœ‰è®¾ç½®<strong>åŸŸåæœåŠ¡å™¨</strong>ï¼ˆDNSæœåŠ¡å™¨ï¼‰ã€‚å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰è®¾ç½®åŸŸåæœåŠ¡å™¨ï¼Œé‚£ç”µè„‘å°±æ²¡è¾™äº†ï¼Œæµè§ˆå™¨ç›´æ¥ä¼šæŠ¥é”™ï¼Œè¯´ç½‘ç«™çš„åŸŸåæ— æ³•è§£æã€‚è¿‡ç¨‹å°±ç»“æŸäº†ã€‚</li><li>å¦‚æœä½ è®¾ç½®è¿‡â€œåŸŸåæœåŠ¡å™¨â€ï¼Œé‚£ä¹ˆç”µè„‘ä¼šå‘è¿™ä¸ªåŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ª<strong>åŸŸåæŸ¥è¯¢</strong>ï¼ˆDNSqueryï¼‰çš„è¯·æ±‚ï¼Œç„¶åç­‰å€™åŸŸåæœåŠ¡å™¨çš„å›åº”ã€‚</li><li>å¦‚æœåŸŸåæœåŠ¡å™¨å§‹ç»ˆæ²¡æœ‰å›åº”ï¼ˆæ¯”å¦‚åŸŸåæœåŠ¡å™¨æŒ‚äº†ï¼Œæˆ–åŸŸåæœåŠ¡å™¨çš„ IPå¡«é”™äº†ï¼Œæˆ–è¯·æ±‚è¢« GFW æ‹¦æˆªäº†ï¼‰ï¼Œé‚£ä¹ˆç”µè„‘è¿˜æ˜¯æ²¡è¾™ï¼ˆæµè§ˆå™¨ä¼šæŠ¥é”™ï¼‰ã€‚</li><li>å¦‚æœåŸŸåæœåŠ¡å™¨å›åº”äº†ï¼Œé‚£ä¹ˆä½ çš„ç”µè„‘å°±å¯ä»¥æ ¹æ®åŸŸåæœåŠ¡å™¨çš„åº”ç­”ä¿¡æ¯ï¼Œå¾—åˆ°è¯¥åŸŸåçš„IP åœ°å€ã€‚ä¹‹åæµè§ˆå™¨å°±ä¼šå‘è¿™ä¸ª IP åœ°å€å¯¹åº”çš„ Web ç«¯å£å‘é€ HTTPè¯·æ±‚ã€‚</li></ol><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç”µè„‘æ‹¿åˆ°çš„ï¼ˆDNSæœåŠ¡å™¨ï¼‰åº”ç­”ä¿¡æ¯æ˜¯æ­£ç¡®çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç­”ä¸­çš„ IPåœ°å€ç¡®å®å¯¹åº”é‚£ä¸ªåŸŸåâ€”â€”è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„ç½‘ç»œè½¯ä»¶å°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚</p><p>ä½†æ˜¯åœ¨å¤©æœè¿™ä¸ªå¥‡è‘©çš„å›½å®¶ï¼Œç”µè„‘æ‹¿åˆ°çš„ DNSåº”ç­”æœ‰å¯èƒ½æ˜¯ã€é”™çš„ã€‘ã€‚ä¸ºå•¥ä¼šè¿™æ ·æï¼Œæœ¬æ–‡çš„ååŠéƒ¨ï¼Œä¿ºä¼šä»‹ç»ä¸€ä¸‹â€œ<strong>åŸŸååŠ«æŒ</strong>â€å’Œâ€œ<strong>åŸŸåæ±¡æŸ“</strong>â€ã€‚</p><h2 id="é€’å½’æœåŠ¡å™¨">é€’å½’æœåŠ¡å™¨</h2><p>åˆšæ‰æåˆ°çš„â€œåŸŸåæœåŠ¡å™¨â€å…¶å®æ˜¯â€œé€’å½’æœåŠ¡å™¨â€ï¼ˆRecursive DNSServerï¼‰ã€‚é€’å½’æœåŠ¡å™¨ï¼Œå°±æ˜¯ä½ æœ¬åœ°ç”µè„‘æˆ–è·¯ç”±å™¨åœ¨è®¿é—®ç½‘ç«™ï¼ˆå¦‚www.baidu.comï¼‰æ—¶ï¼Œç¬¬ä¸€æ—¶é—´è¯·æ±‚çš„ DNS æœåŠ¡å™¨ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>å¸®ä½ ä¸€æ­¥ä¸€æ­¥åœ°æ‰¾åˆ°æœ€ç»ˆçš„ IPåœ°å€</strong>ï¼Œå°±åƒè·‘è…¿å‘˜ä¸€æ ·å»é—®åˆ«äººã€‚</p><ul><li>ç”¨æˆ·ï¼šè¯·é—®<code>www.example.com</code>çš„ IP åœ°å€æ˜¯å¤šå°‘ï¼Ÿ<ul><li>é€’å½’æœåŠ¡å™¨ï¼šä¸çŸ¥é“ï¼Œæˆ‘å¸®ä½ å»æ‰“å¬æ‰“å¬</li></ul></li><li>é€’å½’æœåŠ¡å™¨é—®æ ¹æœåŠ¡å™¨<ul><li>æ ¹æœåŠ¡å™¨ï¼šè¿™ä¸ªåŸŸåä½äº<code>.com</code>é¡¶çº§åŸŸæœåŠ¡å™¨ï¼Œå®ƒçš„ IPåœ°å€æ˜¯ã€‚ã€‚</li></ul></li><li>é€’å½’æœåŠ¡å™¨ç»§ç»­é—®<code>.com</code>é¡¶çº§åŸŸæœåŠ¡å™¨<ul><li>å›ç­”ï¼šä½ åº”è¯¥å»æ‰¾<code>example.com</code>çš„æƒå¨æœåŠ¡å™¨ï¼Œå®ƒçš„ IPåœ°å€æ˜¯ã€‚ã€‚</li></ul></li><li>é€’å½’æœåŠ¡å™¨é—®æƒå¨æœåŠ¡å™¨<ul><li>å›ç­”ï¼š<code>www.example.com</code>çš„ IP åœ°å€æ˜¯ã€‚ã€‚ã€‚</li></ul></li></ul><blockquote><p>ä¸Šé¢æåˆ°äº†æƒå¨æœåŠ¡å™¨ã€‚æ‰€è°“æƒå¨æœåŠ¡å™¨ï¼Œå…¶å®å°±æ˜¯ç›´æ¥æŒç®¡åŸŸåä¸ IPçš„æ˜ å°„ä¿¡æ¯ï¼ˆAè®°å½•ã€MXè®°å½•ã€CNAMEç­‰ï¼‰çš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯åŸŸåè§£ææœåŠ¡æä¾›åˆ†é…ç»™ä½ ã€ç”¨äºæ·»åŠ å„ç§è®°å½•çš„çš„æœåŠ¡å™¨ã€‚</p></blockquote><h2 id="åŸŸåçš„ç¼“å­˜">åŸŸåçš„ç¼“å­˜</h2><p>å› ä¸ºé€’å½’æœåŠ¡å™¨çš„æŸ¥è¯¢æ•ˆç‡å¾ˆä½ï¼Œæ‰€ä»¥é€’å½’æœåŠ¡å™¨å¿…é¡»æœ‰ä¸€ä¸ªç¼“å­˜ã€‚å½“æŸå°ç”µè„‘å‘é€’å½’æœåŠ¡å™¨å‘èµ·åŸŸåæŸ¥è¯¢æ—¶ï¼Œé€’å½’æœåŠ¡å™¨é¦–å…ˆçœ‹è‡ªå·±çš„ç¼“å­˜ä¸­æœ‰æ²¡æœ‰è¯¥åŸŸåçš„è®°å½•ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥å°±å›å¤è¯¥è®°å½•ç»™æŸ¥è¯¢çš„ç”µè„‘ã€‚å¦‚æœæ²¡æœ‰ï¼Œå†æ‰§è¡Œä¸Šé¢çš„æŸ¥è¯¢è¿‡ç¨‹ã€‚</p><p>å› ä¸ºäº’è”ç½‘ä¸Šçš„åŸŸåä¿¡æ¯æ˜¯æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–çš„ï¼Œæ¯”å¦‚å¢åŠ äº†æŸä¸ªæ–°åŸŸåï¼Œæ³¨é”€äº†æŸä¸ªæ—§åŸŸåï¼Œæˆ–è€…æŸä¸ªåŸŸåå¯¹åº”çš„IPåœ°å€å˜äº†ã€‚æ‰€ä»¥ï¼Œâ€œ<strong>é€’å½’æœåŠ¡å™¨</strong>â€ä¸Šä¿ç•™çš„<strong>ç¼“å­˜</strong>ä¸­ï¼Œæ¯ä¸€æ¡åŸŸåè®°å½•éƒ½æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆå¯èƒ½æ˜¯å‡ åˆ†é’Ÿï¼Œä¹Ÿå¯èƒ½æ˜¯å‡ å°æ—¶ï¼‰ã€‚å¦‚æœæŸæ¡è®°å½•çš„ç”Ÿå‘½å‘¨æœŸè¿‡äº†ï¼Œå°±ä¼šè¢«åˆ é™¤ï¼Œç„¶åé‡æ–°åŒæ­¥ã€‚</p><blockquote><p>è¡¥å……ï¼šDNSç¼“å­˜çš„ä½ç½®æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼šæœ¬åœ°æ“ä½œç³»ç»Ÿç¼“å­˜è¡¨ã€æµè§ˆå™¨ç¼“å­˜ã€å®¶ç”¨è·¯ç”±å™¨ç¼“å­˜ã€ä»¥åŠé€’å½’DNS æœåŠ¡å™¨ç¼“å­˜ã€‚</p></blockquote><h2 id="åŸŸååŠ«æŒ">åŸŸååŠ«æŒ</h2><h3 id="ä»€ä¹ˆæ˜¯åŸŸååŠ«æŒ">ä»€ä¹ˆæ˜¯åŸŸååŠ«æŒ</h3><p>åˆšæ‰è¯´äº†ï¼ŒåŸŸåæœåŠ¡å™¨ä¸Šéƒ½ä¼šä¿å­˜ä¸€å¤§å †çš„åŸŸåè®°å½•ï¼ˆæ¯æ¡è®°å½•åŒ…å«â€œåŸŸåâ€å’Œâ€œIPåœ°å€â€ï¼‰ã€‚å½“æ”¶åˆ°åŸŸåæŸ¥è¯¢çš„æ—¶å€™ï¼ŒåŸŸåæœåŠ¡å™¨ä¼šä»è¿™å †è®°å½•ä¸­æ‰¾åˆ°å¯¹æ–¹æƒ³è¦çš„ï¼Œç„¶åå›åº”ç»™å¯¹æ–¹ã€‚</p><p>å¦‚æœåŸŸåæœåŠ¡å™¨ä¸Šçš„æŸæ¡è®°å½•è¢«ã€<strong>äººä¸ºä¿®æ”¹</strong>ã€‘äº†ï¼ˆæ”¹æˆé”™çš„ï¼‰ï¼Œé‚£ä¹ˆä¸€æ—¦è¦æŸ¥è¯¢è¿™æ¡è®°å½•ï¼Œå¾—åˆ°çš„å°±æ˜¯é”™è¯¯çš„ç»“æœã€‚è¿™ç§æƒ…å†µç§°ä¹‹ä¸ºâ€œ<strong>åŸŸååŠ«æŒ</strong>â€ï¼ˆDNShijackingï¼‰ã€‚</p><blockquote><p>åŸŸååŠ«æŒï¼ˆDNShijackingï¼‰é€šå¸¸æ˜¯æŒ‡æ”»å‡»è€…ç¯¡æ”¹äº†DNSè§£æé“¾æ¡ä¸­æŸä¸ªå…³é”®ç¯èŠ‚çš„è®°å½•ï¼Œå¯¼è‡´ç”¨æˆ·è®¿é—®æŸä¸ªåŸŸåæ—¶è¢«å¯¼å‘äº†é”™è¯¯ç”šè‡³æ¶æ„çš„IPåœ°å€ã€‚å…·ä½“æ¥è¯´ï¼ŒåŠ«æŒå¯èƒ½å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç±»åŸŸåæœåŠ¡å™¨ä¸Šçš„è®°å½•è¢«ç¯¡æ”¹ï¼š</p><ul><li>æƒå¨æœåŠ¡å™¨ã€‚æ”»å‡»è€…å…¥ä¾µæƒå¨æœåŠ¡å™¨å¹¶ä¿®æ”¹æŸä¸ªåŸŸåçš„ A è®°å½•ã€CNAMEç­‰ï¼Œä»æ ¹æºä¸Šç¯¡æ”¹ï¼Œè¿™æ—¶æœ€ä¸¥é‡çš„åŠ«æŒï¼Œå½±å“æ‰€æœ‰æŸ¥è¯¢è¯¥åŸŸåçš„ç”¨æˆ·ã€‚</li><li>é€’å½’ DNS æœåŠ¡å™¨çš„ç¼“å­˜è¢«ç¯¡æ”¹ï¼Œä¹Ÿå«<strong>DNSç¼“å­˜æ±¡æŸ“</strong>ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡â€œ<strong>ç¼“å­˜æŠ•æ¯’</strong>â€ï¼ˆDNS cachepoisoningï¼‰æ”»å‡»ï¼Œå‘é€’å½’æœåŠ¡å™¨æ³¨å…¥ä¼ªé€ çš„ DNSè®°å½•ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·é€šè¿‡è¯¥é€’å½’æœåŠ¡å™¨æŸ¥è¯¢åŸŸåæ—¶ï¼Œå¾—åˆ°çš„æ˜¯ä¼ªé€ çš„é”™è¯¯IPã€‚å½±å“ä½¿ç”¨è¯¥é€’å½’æœåŠ¡å™¨çš„ç”¨æˆ·ã€‚</li><li>æœ¬åœ° hosts æ–‡ä»¶æˆ–æœ¬åœ° DNS è§£æé…ç½®è¢«ç¯¡æ”¹ã€‚æ¶æ„è½¯ä»¶å¯ä»¥ç¯¡æ”¹ç”¨æˆ·æœ¬åœ°çš„hosts æ–‡ä»¶ã€‚åªå½±å“ç”¨æˆ·æœ¬æœºã€‚</li><li>ä¸­é—´ä»£ç†è¢«ç¯¡æ”¹ã€‚ä»£ç† DNSæœåŠ¡å™¨çš„è®°å½•è¢«ç¯¡æ”¹ï¼Œå½±å“ä½¿ç”¨è¯¥ä»£ç†æœåŠ¡å™¨çš„æ‰€æœ‰ç”¨æˆ·ã€‚</li></ul></blockquote><h3 id="è°å¹²çš„">è°å¹²çš„</h3><p>ã€€â€œåŸŸååŠ«æŒâ€é€šå¸¸æ˜¯<strong>ç”µä¿¡è¿è¥å•†</strong>ï¼ˆISPï¼‰å¹²çš„å¥½äº‹å„¿ã€‚å¾ˆå¤šå®½å¸¦ç”¨æˆ·ç”¨çš„åŸŸåæœåŠ¡å™¨å°±æ˜¯ISP æä¾›ç»™ä½ çš„ã€‚è€Œå¤©æœçš„ ISP ä¹Ÿæ˜¯å¾ˆå¥‡è‘©çš„â€”â€”ç»å¸¸è€æµæ°“ã€‚</p><p>ä¸¾ä¾‹ï¼š å‰å‡ å¹´æ›¾ç»å‡ºç°è¿‡ï¼šæŸä¸ª ISPè·Ÿç™¾åº¦å‹¾ç»“ï¼ŒæŠŠè°·æ­Œçš„æµé‡é‡å®šå‘åˆ°ç™¾åº¦ã€‚å…·ä½“ææ³•æ˜¯ï¼šè¯¥ ISPç¯¡æ”¹è‡ªå·±çš„åŸŸåæœåŠ¡å™¨çš„è®°å½•ï¼ŒæŠŠé‡Œé¢è·Ÿ google.com ç›¸å…³çš„åŸŸåè®°å½•çš„ IPåœ°å€ä¿®æ”¹ä¸ºç™¾åº¦æœåŠ¡å™¨çš„ IP åœ°å€ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå‡è®¾ä½ ç”¨çš„æ˜¯è¿™ä¸ª ISPçš„åŸŸåæœåŠ¡å™¨ï¼Œå½“ä½ åœ¨æµè§ˆå™¨è¾“å…¥ www.google.com çš„æ—¶å€™ï¼Œä½ çš„ç”µè„‘æŸ¥è¯¢åˆ°çš„IP åœ°å€å…¶å®æ˜¯ç™¾åº¦çš„ IPåœ°å€ï¼Œæ‰€ä»¥æµè§ˆå™¨æ‰“å¼€çš„æ˜¯â€œç™¾åº¦â€çš„ä¸»é¡µã€‚ï¼ˆè¿™å°±å±äºæƒå¨æœåŠ¡å™¨çš„åŸŸååŠ«æŒï¼Œæœ€ä¸¥é‡çš„ä¸€ç§æƒ…å†µï¼‰</p><h3 id="å¦‚ä½•åº”å¯¹">å¦‚ä½•åº”å¯¹</h3><p>åˆšæ‰è¯´äº†ï¼Œâ€œåŸŸååŠ«æŒâ€çš„æ ¹æºåœ¨äºï¼šåŸŸåæœåŠ¡å™¨ä¸Šçš„è®°å½•è¢«äººç»™æ”¹äº†ã€‚è¦å¯¹ä»˜è¿™ç§è€æµæ°“ï¼Œæœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯ä¸è¦ä½¿ç”¨è¿™ç§æµæ°“ISP æä¾›çš„åŸŸåæœåŠ¡å™¨ï¼Œæ”¹ç”¨å›½å¤–é‚£äº›æ¯”è¾ƒé è°±çš„ã€‚ç›®å‰å£ç¢‘æœ€å¥½çš„ï¼Œå¤§æ¦‚æ˜¯Google æä¾›çš„ä¸¤ä¸ªåŸŸåæœåŠ¡å™¨ï¼ŒIP åœ°å€åˆ†åˆ«æ˜¯ 8.8.8.8 å’Œ 8.8.4.4â€”â€”è¿™ä¿©ä¸å…‰æ˜¯åœ°å€å¥½è®°ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä¸ä¼šè€æµæ°“æåŠ«æŒã€‚</p><h2 id="åŸŸåæ±¡æŸ“">åŸŸåæ±¡æŸ“</h2><p>å®šä¹‰ï¼š<strong>ä¸“æŒ‡æ”»å‡»è€…é€šè¿‡å‘é€’å½’DNSæœåŠ¡å™¨æ³¨å…¥ä¼ªé€ çš„é”™è¯¯DNSè®°å½•ï¼Œä½¿è¯¥é€’å½’æœåŠ¡å™¨ç¼“å­˜äº†é”™è¯¯çš„è§£æç»“æœ</strong>ã€‚æ˜¯ä¸€ç§åŸŸååŠ«æŒçš„å…·ä½“æ‰‹æ®µã€‚</p><blockquote><p>WIKI:</p><p>ç½‘åŸŸæœåŠ¡å™¨ç¼“å­˜æ±¡æŸ“ï¼ˆè‹±è¯­ï¼š<strong>DNS cachepollution</strong>ï¼‰ã€<strong>DNSæ±¡æŸ“æˆ–DNSåŠ«æŒ</strong>ï¼Œæ˜¯ä¸€ç§ç ´ååŸŸåç³»ç»ŸæŸ¥è¯¢è§£æçš„è¡Œä¸ºï¼Œé€šå¸¸ç”±è®¡ç®—æœºç¨‹åºè‡ªåŠ¨æ‰§è¡Œï¼Œä»è€Œå¯¼è‡´DNS æœåŠ¡å™¨ç¼“å­˜é”™è¯¯è®°å½•ï¼Œåˆç§°åŸŸåæœåŠ¡å™¨ç¼“å­˜æŠ•æ¯’ï¼ˆDNS cache poisoningï¼‰å’ŒDNSç¼“å­˜æŠ•æ¯’ã€‚æ±¡æŸ“ä¸€è¯å¯èƒ½å–è‡ªåŸŸåç³»ç»ŸåŸŸåè§£æä¹‹ç‰¹æ€§ï¼Œè‹¥é€’å½’DNSè§£æå™¨æŸ¥è¯¢ä¸Šæ¸¸æ—¶æ”¶åˆ°é”™è¯¯å›å¤ï¼Œæ‰€æœ‰ä¸‹æ¸¸ä¹Ÿä¼šå—å½±å“ã€‚</p><p>è¿™äº›ç¯¡æ”¹å¯èƒ½æ˜¯å‡ºäºæ¶æ„ç›®çš„ï¼Œä¾‹å¦‚ç½‘ç»œé’“é±¼ï¼›ä¹Ÿå¯èƒ½æ˜¯å‡ºäº<strong>äº’è”ç½‘æœåŠ¡æä¾›å•†</strong>ï¼ˆISPï¼‰çš„è‡ªèº«ç›®çš„ï¼Œä¾‹å¦‚<strong>é˜²ç«é•¿åŸ</strong>ä»¥åŠå…¬å…±æˆ–è·¯ç”±å™¨æä¾›çš„DNS æœåŠ¡æä¾›å•†å°†ç”¨æˆ·çš„ç½‘ç»œæµé‡å¼•å¯¼è‡³ ISP è‡ªå·±çš„ webæœåŠ¡å™¨ï¼Œä»¥ä¾¿æŠ•æ”¾å¹¿å‘Šã€æ”¶é›†ç»Ÿè®¡æ•°æ®æˆ–å®ç°ISPçš„å…¶ä»–ç›®çš„ï¼ˆ<strong>å¼•æµ</strong>ï¼‰ï¼›è¿˜å¯èƒ½æ˜¯DNSæœåŠ¡æä¾›å•†ä¸ºäº†é˜»æ­¢å¯¹ç‰¹å®šåŸŸåçš„è®¿é—®è€Œé‡‡å–çš„ä¸€ç§<strong>å®¡æŸ¥</strong>å½¢å¼ã€‚</p></blockquote><hr /><p>â€œåŸŸåæ±¡æŸ“â€çš„åŸç†ï¼Œç®€å•è¯´æ¥æ˜¯è¿™æ ·æ»´ï¼šå½“ä½ çš„ç”µè„‘å‘åŸŸåæœåŠ¡å™¨å‘é€äº†â€œåŸŸåæŸ¥è¯¢â€çš„è¯·æ±‚ï¼Œç„¶ååŸŸåæœåŠ¡å™¨æŠŠå›åº”å‘é€ç»™ä½ çš„ç”µè„‘ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªã€<strong>æ—¶é—´å·®</strong>ã€‘ã€‚å¦‚æœæŸä¸ªæ”»å‡»è€…èƒ½å¤Ÿåœ¨åŸŸåæœåŠ¡å™¨çš„â€œDNS åº”ç­”â€è¿˜æ²¡æœ‰åˆ°è¾¾ä½ çš„ç”µè„‘ä¹‹å‰ï¼Œå…ˆä¼ªé€ ä¸€ä¸ªé”™è¯¯çš„â€œDNSåº”ç­”â€å‘ç»™ä½ ç”µè„‘ã€‚é‚£ä¹ˆä½ çš„ç”µè„‘æ”¶åˆ°çš„å°±æ˜¯é”™è¯¯çš„ä¿¡æ¯ï¼Œå¹¶å¾—åˆ°ä¸€ä¸ªé”™è¯¯çš„ IPåœ°å€ã€‚</p><h2 id="gfw-çš„åŸŸåæ±¡æŸ“">GFW çš„åŸŸåæ±¡æŸ“</h2><p>GFWéƒ¨ç½²åœ¨å¤©æœäº’è”ç½‘çš„å›½é™…å‡ºå£ï¼Œä¸‰æ¿æ–§ï¼š</p><ol type="1"><li><strong>DNS æ±¡æŸ“</strong></li><li><strong>IP å°é”</strong>ï¼Œé‡‡ç”¨é»‘åå•æœºåˆ¶</li><li><strong>æ•æ„Ÿè¯è¿‡æ»¤</strong>ï¼ŒGFWç»´æŠ¤ä¸€ä¸ªå¾ˆé•¿çš„æ•æ„Ÿè¯åˆ—è¡¨ï¼Œå¦‚æœä½ çš„ç½‘ç«™ä¸­åŒ…å«<strong>ä»»ä½•ä¸€ä¸ª</strong>æ•æ„Ÿè¯ï¼ŒGFWä¼šé€šè¿‡æŠ€æœ¯æ‰‹æ®µå±è”½è¯¥é¡µé¢</li></ol><p>GFWæœ‰ä¸¤ç§æ±¡æŸ“æ–¹å¼ï¼šç›´æ¥æ±¡æŸ“ï¼Œé—´æ¥æ±¡æŸ“ã€‚ä½¿ç”¨å›½å¤–çš„åŸŸåæœåŠ¡å™¨ä¼šå—åˆ°ç›´æ¥æ±¡æŸ“ï¼Œä½¿ç”¨å›½å†…çš„åŸŸåæœåŠ¡å™¨ä¼šå—åˆ°é—´æ¥æ±¡æŸ“ã€‚</p><h3 id="gfw-çš„éƒ¨ç½²ä½ç½®">GFW çš„éƒ¨ç½²ä½ç½®</h3><p>å¤©æœçš„äº’è”ç½‘åªæœ‰å°‘æ•°å‡ ä¸ª<strong>å›½é™…å‡ºå£</strong>ï¼ˆåæ°”è¾ƒå¤§çš„æ˜¯ï¼šåŒ—äº¬å‡ºå£ã€ä¸Šæµ·å‡ºå£ã€å¹¿å·å‡ºå£ï¼‰ã€‚å¦‚æœä½ è¦è®¿é—®å¤©æœä¹‹å¤–çš„ç½‘ç«™ï¼Œä½ çš„ç½‘ç»œæ•°æ®æµå°±å¿…å®šä¼šç»è¿‡å…¶ä¸­çš„æŸä¸ªâ€œå›½é™…å‡ºå£â€ã€‚è€Œå¤©æœçš„ã€<strong>æ¯ä¸€ä¸ª</strong>ã€‘å›½é™…å‡ºå£éƒ½éƒ¨ç½²äº†GFW çš„è®¾å¤‡ã€‚</p><h3 id="gfw-ç›´æ¥æ±¡æŸ“">GFW ç›´æ¥æ±¡æŸ“</h3><p>å› ä¸º GFWéƒ¨ç½²åœ¨å¤©æœçš„ã€å›½é™…å‡ºå£ã€‘ã€‚å¦‚æœä½ ç”¨çš„æ˜¯<strong>å›½å¤–çš„åŸŸåæœåŠ¡å™¨</strong>ï¼Œä½ çš„â€œDNS è¯·æ±‚â€å¿…å®šä¼šç»è¿‡å›½é™…å‡ºå£ï¼›åŒæ ·ï¼ŒåŸŸåæœåŠ¡å™¨çš„â€œ DNSåº”ç­”â€å¿…å®šä¹Ÿä¼šç»è¿‡å›½é™…å‡ºå£æ‰èƒ½åˆ°ä½ çš„ç”µè„‘ã€‚è¿™ä¸€æ¥ä¸€å›å°±ç»™ GFWæä¾›äº†è€æµæ°“çš„æœºä¼šã€‚</p><h3 id="gfw-é—´æ¥æ±¡æŸ“">GFW é—´æ¥æ±¡æŸ“</h3><ol type="1"><li>ä½ ç”¨çš„æ˜¯å›½å†…çš„åŸŸåæœåŠ¡å™¨ï¼Œæƒ³è®¿é—®æŸä¸ªè¢«å¤§é™†å°æ€çš„ç½‘ç«™ã€‚</li><li>è¢«å°æ€çš„ç½‘ç«™ï¼Œå®ƒçš„æƒå¨æœåŠ¡å™¨è‚¯å®šåœ¨å›½å¤–</li><li>å½“ä½ å‘å›½å†…çš„DNSæœåŠ¡å™¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿™ä¸ªDNSæœåŠ¡å™¨éœ€è¦ä»å›½å¤–è¿›è¡ŒåŸŸåæŸ¥è¯¢</li><li><strong>æ­£æ˜¯å› ä¸ºä»å›½å¤–è¿›è¡ŒåŸŸåæŸ¥è¯¢ï¼Œæ‰€ä»¥ç›¸å…³çš„æ•°æ®æµå¿…å®šä¼šç»è¿‡å›½é™…å‡ºå£ï¼Œä¸€æ—¦ç»è¿‡å›½é™…å‡ºå£ï¼Œå¿…å®šä¼šè¢«GFW æ±¡æŸ“</strong></li><li>æ‰€ä»¥ DNSæœåŠ¡å™¨è¿”å›çš„æ˜¯è¢«æ±¡æŸ“çš„åŸŸåè®°å½•ï¼Œè€Œä¸”ï¼Œ<strong>å›½å†…çš„DNSæœåŠ¡å™¨ä¼šæŠŠè¿™æ¡é”™è¯¯çš„è®°å½•ç¼“å­˜ä¸‹æ¥</strong>ã€‚</li><li>äºæ˜¯ä¹~å¦‚æœä»¥åè¿˜æœ‰äººæŸ¥è¯¢è¿™ä¸ªåŸŸåï¼Œä¹Ÿä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœ</li></ol><p>ä¸Šè¿°è¿‡ç¨‹ä¸æ–­é‡å¤ï¼Œæœ€ç»ˆä¼šå¯¼è‡´ï¼šå…¨å›½æ‰€æœ‰çš„åŸŸåæœåŠ¡å™¨ï¼Œå®ƒä»¬çš„ç¼“å­˜ä¸­åªè¦æ˜¯åŒ…å«äº†é‚£ä¸ªåå…±ç½‘ç«™çš„è®°å½•ï¼Œè®°å½•ä¸­çš„â€œIPåœ°å€â€å¿…å®šæ˜¯é”™çš„ï¼ˆè¿™ä¸ªé”™è¯¯çš„â€œIP åœ°å€â€ä¹Ÿå°±æ˜¯ GFWä¼ªé€ çš„é‚£ä¸ªï¼‰ã€‚æ‰€ä»¥è¯´â€œé—´æ¥æ±¡æŸ“â€æ˜¯å¾ˆç‰›é€¼æ»´â€”â€”å¯ä»¥æŠŠé”™è¯¯çš„åŸŸåè®°å½•æ‰©æ•£åˆ°å…¨å›½ã€‚</p><p>åˆšæ‰ä¿ºè¯´äº†ï¼Œâ€œåŸŸåæ±¡æŸ“â€ä¹Ÿå«â€œåŸŸåç¼“å­˜æŠ•æ¯’â€ã€‚<strong>â€œæŠ•æ¯’â€ä¸€è¯çœŸçš„éå¸¸å½¢è±¡â€”â€”å°±å¥½è±¡åœ¨æŸæ¡æ²³æµçš„ã€æºå¤´ã€‘ä¸‹æ¯’ï¼Œä»è€ŒæŠŠæ•´æ¡æ²³æµçš„æ°´éƒ½æ±¡æŸ“</strong>ã€‚åœ¨äº’è”ç½‘æ—¶ä»£æâ€œåŸŸåæ±¡æŸ“â€æ˜¯éå¸¸å‘é„™ä¸‹æµçš„åšæ³•ã€‚å› ä¸ºDNSæ˜¯äº’è”ç½‘çš„åŸºç¡€è®¾æ–½ï¼Œ<strong>è€Œâ€œåŸŸåæ±¡æŸ“â€ç›´æ¥ç ´åäº†äº’è”ç½‘çš„åŸºç¡€è®¾æ–½</strong>ã€‚</p><h3 id="å¦‚ä½•åº”å¯¹åŸŸåæ±¡æŸ“åŸŸåæ¬ºéª—">å¦‚ä½•åº”å¯¹åŸŸåæ±¡æŸ“/åŸŸåæ¬ºéª—</h3><p>ä¸‹é¢è¿™ç¯‡æ•™ç¨‹ä»‹ç»äº†å››ç§æ–°çš„åŸŸååè®®ï¼Œæœ‰æ•ˆå¯¹æŠ—GFWã€‚</p><p>https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html</p>]]></content>
    
    
    <categories>
      
      <category>Computer Networking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç½‘</tag>
      
      <tag>è½¬è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM-ç»å…¸åƒåœ¾æ”¶é›†å™¨</title>
    <link href="/2025/06/14/JVM-%E7%BB%8F%E5%85%B8%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/"/>
    <url>/2025/06/14/JVM-%E7%BB%8F%E5%85%B8%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¯»ä¹¦ç¬”è®°(4)</p><span id="more"></span><h1 id="ç»å…¸åƒåœ¾æ”¶é›†å™¨">ç»å…¸åƒåœ¾æ”¶é›†å™¨</h1><p>å„æ¬¾ç»å…¸æ”¶é›†å™¨ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://s21.ax1x.com/2025/06/04/pVPDtRH.png"alt="HotSpotè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†å™¨" /><figcaption aria-hidden="true">HotSpotè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†å™¨</figcaption></figure><ul><li>ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨é€‚ç”¨çš„åˆ†ä»£ä¹Ÿä¸åŒï¼Œæ”¶é›†å™¨ä¹‹é—´çš„è¿çº¿è¡¨ç¤ºå®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼ˆä½†æ˜¯è¿™ç§å…³ç³»ä¸å›ºå®šï¼‰ï¼›</li><li>å›¾çš„ä¸ŠåŠéƒ¨åˆ†ä¸ºæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¸‹åŠéƒ¨åˆ†ä¸ºè€å¹´ä»£æ”¶é›†å™¨ã€‚</li></ul><blockquote><p>è™½ç„¶åƒåœ¾æ”¶é›†å™¨çš„æŠ€æœ¯åœ¨ä¸æ–­è¿›æ­¥ï¼Œä½†ç›´åˆ°ç°åœ¨è¿˜æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨å‡ºç°ï¼Œæ›´åŠ ä¸å­˜åœ¨â€œä¸‡èƒ½â€çš„æ”¶é›†å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©çš„åªæ˜¯å¯¹å…·ä½“åº”ç”¨æœ€åˆé€‚çš„æ”¶é›†å™¨ã€‚</p></blockquote><h2 id="serial">Serial</h2><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºç¡€ã€å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ã€‚ç‰¹ç‚¹ï¼›</p><ul><li><strong>å•çº¿ç¨‹</strong>ï¼Œä½†æ˜¯ç‰¹æ®Šçš„å•çº¿ç¨‹ï¼Œ<strong>å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸ</strong>ã€‚</li></ul><figure><img src="https://s21.ax1x.com/2025/06/04/pVPDBeP.png" alt="å·¥ä½œæµç¨‹" /><figcaption aria-hidden="true">å·¥ä½œæµç¨‹</figcaption></figure><p>å¦‚å›¾ï¼Œæ¯æ¬¡ GCä¹‹å‰éƒ½è¦ç¡®ä¿æ‰€æœ‰çš„çº¿ç¨‹éƒ½å·²ç»åˆ°è¾¾å®‰å…¨ç‚¹ï¼Œç„¶åæ‰€æœ‰çš„çº¿ç¨‹è¢«æš‚åœï¼Œç­‰å¾… GCæ‰§è¡Œå®Œæ¯•ã€‚</p><p>è¿„ä»Šä¸ºæ­¢ï¼Œå®ƒä¾ç„¶æ˜¯HotSpotè™šæ‹Ÿæœºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•é«˜æ•ˆï¼Œå®ƒæ˜¯æ‰€æœ‰æ”¶é›†å™¨ä¸­é¢å¤–å†…å­˜å ç”¨æœ€å°çš„ä¸€ä¸ªã€‚</li><li>å¯¹äºå•æ ¸å¤„ç†å™¨ï¼Œæˆ–è€…æœ¬æ¥æ ¸å¿ƒå°±æ¯”è¾ƒå°‘çš„å¤„ç†å™¨ï¼ŒSerialå› ä¸ºä¸“æ³¨äºå•çº¿ç¨‹ï¼Œæ‰€ä»¥æ•ˆç‡åè€Œä¼šé«˜ã€‚</li></ul><p>å¦‚æœåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜æœ¬æ¥å°±ä¸æ˜¯ç‰¹åˆ«å¤§ï¼ˆæ¯”å¦‚ä¸€äº›å¾®æœåŠ¡åº”ç”¨ï¼‰ï¼Œé‚£ä¹ˆæ¯æ¬¡éœ€è¦æ”¶é›†çš„åƒåœ¾ä¹Ÿå¹¶ä¸å¤šï¼Œåœé¡¿æ—¶é—´ä¸ä¼šå¾ˆé•¿ï¼Œæ˜¯è¶³å¤Ÿä½¿ç”¨çš„ã€‚</p><h2 id="parnew">ParNew</h2><figure><img src="https://s21.ax1x.com/2025/06/06/pViJeLF.png" alt="ParNew" /><figcaption aria-hidden="true">ParNew</figcaption></figure><p><strong>ParNew æ”¶é›†å™¨å®è´¨ä¸Šæ˜¯ Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬</strong>ï¼Œæœ€å¤§çš„åŒºåˆ«æ˜¯å­˜åœ¨å¤šä¸ªGCçº¿ç¨‹ï¼Œä½†æ˜¯GCçš„è¿‡ç¨‹ä¸€æ ·éœ€è¦æš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ã€‚</p><p>ParNewæ”¶é›†å™¨æ˜¯æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¹Ÿæ˜¯JDK7ä¹‹å‰çš„è€ç³»ç»Ÿçš„é¦–é€‰å¤„ç†å™¨ï¼Œå› ä¸ºåªæœ‰å®ƒèƒ½å’ŒCMSæ”¶é›†å™¨é…åˆå·¥ä½œï¼Œä½†æ˜¯åæ¥ParNewå’ŒCMSä¹Ÿå°±åªèƒ½äº’ç›¸æ­é…ä½¿ç”¨ï¼Œç›¸å½“äºè¢«åˆå¹¶äº†ã€‚</p><div class="note note-success">            <p>è¡¥å……ï¼šå…³äºå¹¶å‘å’Œå¹¶è¡Œ</p><p>å¹¶å‘(Parallel)ï¼šåœ¨åŒä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œæœ‰å¤šä¸ªä»»åŠ¡åœ¨äº¤æ›¿æ‰§è¡Œï¼ˆå®è§‚ä¸ŠåŒæ—¶ï¼Œå¾®è§‚ä¸Šè½®æµï¼‰ï¼Œå¼ºè°ƒçš„æ˜¯äººç‰©çš„äº¤æ›¿å’Œåˆ‡æ¢ã€‚å³ä½¿åªæœ‰ä¸€ä¸ªCPUæ ¸ï¼Œä¹Ÿèƒ½åšåˆ°å‡ ä¹åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡çš„æ•ˆæœï¼Œåªè¦é€Ÿåº¦è¶³å¤Ÿå¿«ã€‚</p><p>å¹¶è¡Œ(Concurrent)ï¼šåœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šä¸ªä»»åŠ¡çœŸæ­£åŒæ—¶è¿è¡Œï¼ˆç‰©ç†ä¸ŠåŒæ—¶ï¼‰ï¼Œéœ€è¦å¤šä¸ªCPUæ ¸å¿ƒæ‰èƒ½å®ç°ï¼Œè¿™æ—¶çœŸæ­£çš„åŒæ—¶æ‰§è¡Œã€‚</p><p>æ”¾åˆ°è¿™é‡Œçš„è¯­å¢ƒä¸­ï¼Œå¹¶è¡ŒæŒ‡çš„æ˜¯å¤šæ¡ GCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå³æœ‰å¤šä¸ªGCçº¿ç¨‹åœ¨åŒæ—¶å·¥ä½œï¼Œä½†æ˜¯ç”¨æˆ·çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼›å¹¶å‘æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œç”¨æˆ·çº¿ç¨‹å’ŒGC çº¿ç¨‹ä¹‹é—´åœ¨å¿«é€Ÿåˆ‡æ¢ï¼Œæ‰€ä»¥å®è§‚ä¸Šç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºæ‰§è¡Œçš„çŠ¶æ€ã€‚</p>          </div><p>åº”è¯¥è¯´ï¼Œä¸ºäº†é˜²æ­¢å‡ºç°åˆ†æè¿‡ç¨‹ä¸­æ ¹èŠ‚ç‚¹é›†åˆçš„å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–çš„æƒ…å†µï¼ŒGCçº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æ˜¯ä¸å¯èƒ½å¹¶è¡Œè¿›è¡Œçš„ï¼Œåªèƒ½äº¤æ›¿è¿›è¡Œï¼ˆå¤šä¸ªGCçº¿ç¨‹å€’æ˜¯å¯ä»¥å¹¶è¡Œï¼‰ï¼Œæ‰€ä»¥æ•ˆç‡æœ€é«˜çš„æ–¹å¼å°±æ˜¯GC å’Œç”¨æˆ·çº¿ç¨‹äºŒè€…å¹¶å‘ã€‚åæ¥å‡ºç°çš„ CMS æ”¶é›†å™¨æ˜¯ HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šæ”¯æŒå¹¶å‘çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå®ƒé¦–æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚</p><h2 id="parallel-scavenge">Parallel Scavenge</h2><p>å¹¶è¡Œæ¸…é™¤</p><p>ä¹Ÿæ˜¯æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼ŒåŸºäºæ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œèƒ½å¤Ÿå¤šçº¿ç¨‹å¹¶è¡Œ.</p><p>å…¶ä»–åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹éƒ½æ˜¯<em>ç¼©çŸ­åƒåœ¾æ”¶é›†å¸¦æ¥çš„åœé¡¿æ—¶é—´</em>ï¼Œä½†æ˜¯Parallel Scavenge çš„å…³æ³¨ç‚¹æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼š <spanclass="math display">\[ååé‡=\frac{è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´}{è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+è¿è¡Œåƒåœ¾æ”¶é›†æ—¶é—´}\]</span>ååé‡è¶Šå¤§ï¼Œç¨‹åºè¿è¡ŒèŠ±åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„å æ¯”å°±è¶Šå°ï¼Œå“åº”è¶Šå¿«ï¼Œè¶Šé€‚åˆä¸ç”¨æˆ·é¢‘ç¹äº¤äº’çš„ç¨‹åºã€‚è¿™ä¸€æ”¶é›†å™¨ä¹Ÿè¢«ç§°ä½œâ€œååé‡ä¼˜å…ˆæ”¶é›†å™¨â€œã€‚</p><p>Parallel Scavenge æ”¶é›†å™¨æä¾›äº†ä¸‰ä¸ªå‚æ•°ç”¨äºæ§åˆ¶ååé‡ï¼š</p><ul><li><code>-XXï¼šMaxGCPauseMillis</code>ï¼šæ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ï¼Œæ˜¯å¤§äº0çš„æ¯«ç§’æ•°</li><li><code>-XXï¼šGCTimeRatio</code>ï¼šç¨‹åºè¿è¡Œæ—¶é—´å’ŒGCæ—¶é—´ä¹‹æ¯”ï¼Œå¤§äº0å°äº100çš„æ•´æ•°ï¼Œé»˜è®¤99</li><li><code>XXï¼š+UseAdaptiveSizePolicy</code>ï¼šæ¿€æ´»åï¼Œåƒåœ¾æ”¶é›†é‡‡ç”¨è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGCErgonomicsï¼‰</li></ul><p>ä½¿ç”¨<code>-XXï¼šMaxGCPauseMillis</code>å‡å°æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´æ˜¯æœ‰ä»£ä»·çš„ï¼šé€šè¿‡å‡å°æ–°ç”Ÿä»£çš„å†…å­˜ç©ºé—´å¤§å°æ˜¾ç„¶èƒ½å¤Ÿç¼©çŸ­åƒåœ¾æ”¶é›†æ¶ˆè€—çš„æ—¶é—´ï¼Œä½†è¿™æ ·çš„è¯<code>Eden</code>åŒºæ›´å®¹æ˜“æ»¡ï¼ŒGCå‘ç”Ÿçš„é¢‘ç‡æ›´å¿«ã€‚è™½ç„¶æ¯ä¸€æ¬¡åœé¡¿çš„æ—¶é—´å°‘äº†ï¼Œä½†æ˜¯åœé¡¿çš„é¢‘ç‡å˜é«˜äº†ï¼Œååé‡å¯èƒ½åè€Œä¸‹é™ã€‚</p><p>è°ƒä¼˜æ—¶ï¼Œå¯ä»¥æŠŠå†…å­˜ç®¡ç†çš„ä»»åŠ¡äº¤ç»™è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼Œç„¶åäººå·¥è°ƒèŠ‚æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´å’ŒXXï¼šGCTimeRatioã€‚</p><h2 id="serial-old">Serial Old</h2><p>Serial Old æ˜¯ Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p><figure><img src="https://s21.ax1x.com/2025/06/09/pVFllan.png"alt="Serial/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" /><figcaption aria-hidden="true">Serial/SerialOldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><p>å›¾ä¸­å·¦ä¾§ä¸º Serial æ”¶é›†å™¨ï¼ŒåŸºäºæ ‡è®°-å¤åˆ¶ç®—æ³•ï¼›å³ä¾§ä¸º Serial Oldæ”¶é›†å™¨ã€‚</p><h2 id="parallel-old-æ”¶é›†å™¨">Parallel Old æ”¶é›†å™¨</h2><p>Parallel Oldæ˜¯ParallelScavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘æ”¶é›†ï¼ŒåŸºäºæ ‡è®°-æ•´ç†ç®—æ³•å®ç°ã€‚</p><p>åœ¨æ³¨é‡ååé‡æˆ–è€…å¤„ç†å™¨èµ„æºè¾ƒä¸ºç¨€ç¼ºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ ParallelScavenge åŠ  Parallel Old æ”¶é›†å™¨è¿™ä¸ªç»„åˆã€‚å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="https://s21.ax1x.com/2025/06/09/pVFloJP.png"alt="è¿è¡Œç¤ºæ„å›¾" /><figcaption aria-hidden="true">è¿è¡Œç¤ºæ„å›¾</figcaption></figure><h2 id="cms">CMS</h2><p>CMS(Concurrent MarkSweep)æ”¶é›†å™¨ï¼Œæ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œè¿è¡Œåœ¨è€å¹´ä»£ã€‚</p><p>åŸºäº<strong>æ ‡è®°-æ¸…é™¤</strong>æ³•ï¼Œè¿è¡Œè¿‡ç¨‹åŒ…æ‹¬å››æ­¥ï¼š</p><ol type="1"><li>åˆå§‹æ ‡è®°ï¼šä»…æ ‡è®°GC Rootsç›´æ¥å…³è”åˆ°çš„å¯¹è±¡</li><li>å¹¶å‘æ ‡è®°ï¼šä»ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾</li><li>é‡æ–°æ ‡è®°ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ä¸ºç”¨æˆ·çº¿ç¨‹çš„æ´»åŠ¨é€ æˆçš„å¯¹è±¡æ ‡è®°çš„å˜åŠ¨</li><li>å¹¶å‘æ¸…é™¤ï¼šæ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡</li></ol><p>åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°è¿™ä¸¤æ­¥éƒ½éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œä½†æ˜¯å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤ä¸éœ€è¦ã€‚</p><figure><img src="https://s21.ax1x.com/2025/06/09/pVF8bQK.png"alt="Concurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" /><figcaption aria-hidden="true">Concurrent MarkSweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><p>CMS çš„ç¼ºç‚¹ï¼š</p><ol type="1"><li>å¯¹å¤„ç†å™¨èµ„æºå¾ˆæ•æ„Ÿï¼Œå› ä¸ºåœ¨å¹¶å‘çš„è¿‡ç¨‹ä¸­éœ€è¦é¢å¤–å ç”¨ä¸€éƒ¨åˆ†å¤„ç†å™¨çš„èµ„æºç”¨äºåƒåœ¾æ”¶é›†ï¼Œè™½ç„¶ç”¨æˆ·çš„çº¿ç¨‹ä¸ä¼šåœé¡¿ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦ä¼šå˜æ…¢ã€‚</li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾(FloatingGarbage)ï¼Œæµ®åŠ¨åƒåœ¾æŒ‡çš„æ˜¯åœ¨æ ‡è®°è¿‡ç¨‹ç»“æŸä»¥åï¼Œç”±äºç”¨æˆ·çš„çº¿ç¨‹ä»ç„¶åœ¨è¿è¡Œï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿæ–°çš„æœªè¢«æ ‡è®°çš„åƒåœ¾ï¼Œè¿™äº›åƒåœ¾åªèƒ½åœ¨ä¸‹ä¸€æ¬¡è¢«æ¸…ç†ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºåƒåœ¾æ”¶é›†å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶è¿›è¡Œï¼Œæ‰€ä»¥å†…å­˜åŒºéœ€è¦æå‰è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œåœ¨JDK6ä¸­è€å¹´ä»£æ”¶é›†çš„è§¦å‘é˜ˆå€¼æ˜¯92%ã€‚å¯ä»¥é€šè¿‡å‚æ•°<code>-XXï¼šCMSInitiatingOccu-pancyFraction</code>ä¿®æ”¹CMSè§¦å‘çš„ç™¾åˆ†æ¯”ã€‚å½“CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œä¼šè§¦å‘å¹¶å‘å¤±è´¥ï¼ŒJVMä¸´æ—¶è°ƒç”¨SerialOldé‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚</li><li>CMSåŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œæ”¶é›†ç»“æŸçš„æ—¶å€™ä¼šäº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢ç‰‡ï¼Œéœ€è¦å†è§¦å‘FyllGCç”¨äºç¢ç‰‡æ•´ç†ã€‚</li></ol><h2 id="garbage-firstg1">Garbage First(G1)</h2><p>åƒåœ¾æ”¶é›†å™¨æŠ€æœ¯å‘å±•å†å²ä¸Šçš„é‡Œç¨‹ç¢‘å¼çš„æˆæœï¼Œå¼€åˆ›äº†æ”¶é›†å™¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºRegion çš„å†…å­˜å¸ƒå±€å½¢å¼ã€‚é¢å‘æœåŠ¡ç«¯ã€‚</p><ul><li>MixedGCæ¨¡å¼ï¼š<strong>é¢å‘å±€éƒ¨æ”¶é›†</strong>ï¼Œå“ªå—å†…å­˜ä¸­å­˜æ”¾çš„åƒåœ¾æ•°é‡æœ€å¤šï¼Œå›æ”¶æ”¶ç›Šæœ€å¤§ï¼Œå°±å›æ”¶å“ªé‡Œï¼Œå¯ä»¥é¢å‘å †å†…å­˜ä»»ä½•éƒ¨åˆ†æ¥ç»„æˆå›æ”¶é›†ï¼ˆCollectionSetï¼Œä¸€èˆ¬ç®€ç§°CSetï¼‰è¿›è¡Œå›æ”¶</li><li>åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ï¼š<strong>æŠŠè¿ç»­çš„ Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸ</strong>ï¼ˆRegionï¼‰ï¼Œæ¯ä¸€ä¸ª Regionéƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ‰®æ¼”æ–°ç”Ÿä»£çš„ Eden ç©ºé—´ã€Survivorç©ºé—´ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ï¼›æ”¶é›†å™¨èƒ½å¤Ÿå¯¹æ‰®æ¼”ä¸åŒè§’è‰²çš„Regioné‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»å¤„ç†ã€‚<strong>Regionæ˜¯å•æ¬¡å›æ”¶çš„æœ€å°å†…å­˜å•å…ƒ</strong>ã€‚</li></ul><p>ç›¸æ¯”äºä»¥å¾€å›ºå®šæ–°ç”Ÿä»£å’Œè€å¹´ä»£åˆ†é…å†…å­˜åŒºåŸŸå¤§å°çš„æ–¹å¼ï¼Œè¿™ç§åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€æ›´åŠ çµæ´»ã€‚</p><p>G1å¯¹å¤§å¯¹è±¡çš„å¤„ç†ï¼š</p><ul><li><code>-XXï¼šG1HeapRegionSize</code>å‚æ•°æŒ‡å®šæ¯ä¸ªRegionåŒºåŸŸçš„å¤§å°ï¼Œä¸€ä¸ªå¯¹è±¡åªè¦è¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„ä¸€åŠå³è¢«è§†ä¸ºå¤§å¯¹è±¡</li><li>å¯¹äºè¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„è¶…çº§å¤§å¯¹è±¡ï¼Œå°†ä¼šè¢«å­˜æ”¾åœ¨Nä¸ªè¿ç»­çš„<code>Humongous Region</code>ä¹‹ä¸­</li></ul><p>G1åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œä¼˜å…ˆæ”¶é›†é‚£äº›æ”¶é›†ä»·å€¼å¤§çš„Regionï¼Œå³æ”¶é›†ä¹‹åèƒ½è·å¾—æœ€å¤šçš„ç©ºé—´ä¸”å¤„ç†æ—¶é—´å°½å¯èƒ½çŸ­çš„åŒºåŸŸï¼Œ</p><figure><img src="https://s21.ax1x.com/2025/06/10/pVFH1Tf.png"alt="Regionå †å†…å­˜å¸ƒå±€ä¸­ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åŒºåŸŸä¸ä¸€å®šè¿ç»­" /><figcaptionaria-hidden="true">Regionå †å†…å­˜å¸ƒå±€ä¸­ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åŒºåŸŸä¸ä¸€å®šè¿ç»­</figcaption></figure><p>G1çš„è¿è¡Œè¿‡ç¨‹å¤§è‡´ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ol type="1"><li>åˆå§‹æ ‡è®°ï¼Œåªæ ‡è®°å’ŒGCRootså¯¹è±¡ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦æš‚åœçº¿ç¨‹ä½†æ˜¯è€—æ—¶å¾ˆçŸ­</li><li>å¹¶å‘æ ‡è®°ï¼šä»ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾ï¼Œä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘</li><li>æœ€ç»ˆæ ‡è®°ï¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œå¤„ç†åŸå§‹å¿«ç…§ï¼ˆSATBï¼‰</li><li>ç­›é€‰å›æ”¶ï¼šç¡®å®šéœ€è¦å›æ”¶å“ªäº›Regionï¼ŒæŠŠéœ€è¦å›æ”¶çš„Regionçš„å¯¹è±¡å¤åˆ¶åˆ°ç©ºRegionä¸­ï¼Œç„¶åæ¸…ç†æ—§Regionçš„æ‰€æœ‰ç©ºé—´ã€‚</li></ol><figure><img src="https://s21.ax1x.com/2025/06/10/pVFHH9e.png"alt="G1æ”¶é›†å™¨è¿è¡Œè¿‡ç¨‹" /><figcaption aria-hidden="true">G1æ”¶é›†å™¨è¿è¡Œè¿‡ç¨‹</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®ç»“æ„-å †</title>
    <link href="/2025/06/12/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A0%86/"/>
    <url>/2025/06/12/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A0%86/</url>
    
    <content type="html"><![CDATA[<h1 id="å †çš„åˆ†ç±»">å †çš„åˆ†ç±»</h1><p>å…ˆå›é¡¾ä¸€ä¸‹å®Œå…¨äºŒå‰æ ‘ã€‚</p><p>å®Œå…¨äºŒå‰æ ‘æ˜¯æŒ‡ï¼šå¦‚æœäºŒå‰æ ‘é™¤äº†æœ€åä¸€å±‚æœ‰ç¼ºå¤±å¤–ï¼Œå…¶å®ƒæ˜¯æ»¡çš„ï¼Œä¸”æœ€åä¸€å±‚åªæœ‰å³ä¾§æœ‰ç¼ºå¤±çš„å¶å­èŠ‚ç‚¹ï¼Œåˆ™è¿™æ ·çš„äºŒå‰æ ‘å«å®Œå…¨äºŒå‰æ ‘ã€‚</p><p><strong>æ¢å¥è¯è¯´ï¼Œå®Œå…¨äºŒå‰æ ‘ä»æ ¹ç»“ç‚¹åˆ°å€’æ•°ç¬¬äºŒå±‚æ»¡è¶³å®Œç¾äºŒå‰æ ‘ï¼Œæœ€åä¸€å±‚å¯ä»¥ä¸å®Œå…¨å¡«å……ï¼Œå…¶å¶å­ç»“ç‚¹éƒ½é å·¦å¯¹é½</strong>ã€‚å›¾ç¤º<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://jokinkuang.github.io/2017/01/30/complete-binary-tree.html">[1]</span></a></sup>ï¼š</p><figure><imgsrc="https://jokinkuang.github.io/w3c/images/algorithm/tree/complete-binary-tree.jpg"alt="å®Œå…¨äºŒå‰æ ‘å›¾ç¤º" /><figcaption aria-hidden="true">å®Œå…¨äºŒå‰æ ‘å›¾ç¤º</figcaption></figure><p>ä¸‹é¢æ¥çœ‹ä»€ä¹ˆæ˜¯å †ï¼ˆheapï¼‰ã€‚<strong>å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®Œå…¨äºŒå‰æ ‘</strong>ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><ul><li><strong>å°é¡¶å †</strong>ï¼ˆminheapï¼‰ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼å°äºç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ã€‚</li><li><strong>å¤§é¡¶å †</strong>ï¼ˆmaxheapï¼‰ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼å¤§äºç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ã€‚</li></ul><figure><imgsrc="https://www.hello-algo.com/chapter_heap/heap.assets/min_heap_and_max_heap.png"alt="å°é¡¶å †ä¸å¤§é¡¶å †[2]" /><figcaptionaria-hidden="true">å°é¡¶å †ä¸å¤§é¡¶å †<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://www.hello-algo.com/chapter_heap/heap/">[2]</span></a></sup></figcaption></figure><ul><li>äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ç§°ä¸ºâ€œå †é¡¶â€ï¼Œåº•å±‚æœ€é å³çš„èŠ‚ç‚¹ç§°ä¸ºâ€œå †åº•â€ã€‚</li><li>å°é¡¶å †çš„æ ¹èŠ‚ç‚¹å…·æœ‰æœ€å°å€¼ï¼Œå¤§é¡¶å †çš„æ ¹èŠ‚ç‚¹å…·æœ‰æœ€å¤§å€¼ã€‚</li></ul><h1 id="åº”ç”¨">åº”ç”¨</h1><p>å †é€šå¸¸ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¤§é¡¶å †ç›¸å½“äºå…ƒç´ æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºå‡ºé˜Ÿçš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚ä»ä½¿ç”¨è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†â€œä¼˜å…ˆé˜Ÿåˆ—â€å’Œâ€œå †â€çœ‹ä½œç­‰ä»·çš„æ•°æ®ç»“æ„ï¼ˆå½“ç„¶åº•å±‚å®ç°ä¸è§å¾—ç›¸åŒï¼‰ã€‚</p><p>å¦‚æœé¢è¯•é¢˜éœ€è¦æ±‚å‡ºä¸€ä¸ªåŠ¨æ€æ•°æ®é›†åˆä¸­çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨å †æ¥è§£å†³é—®é¢˜ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Javaæä¾›çš„ä¼˜å…ˆé˜Ÿåˆ—<code>PriorityQueue</code>å»ºå †:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">// åˆå§‹åŒ–å°é¡¶å †</span><br> Queue&lt;Integer&gt; minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br> <span class="hljs-comment">// åˆå§‹åŒ–å¤§é¡¶å †ï¼ˆä½¿ç”¨ lambda è¡¨è¾¾å¼ä¿®æ”¹ Comparator å³å¯ï¼‰</span><br> Queue&lt;Integer&gt; maxHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; b - a);<br></code></pre></td></tr></table></figure><p>è¯¥å»ºå †æ–¹æ³•ä½¿ç”¨äº†<code>PriorityQueue.java</code>æä¾›çš„æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* </span><br><span class="hljs-comment">* è¯¥æ„é€ å™¨åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰åˆå§‹å®¹é‡ï¼ˆ11ï¼‰ä¸”æ¯ä¸ªå…ƒç´ æŒ‰ç…§æŒ‡å®šçš„æ¯”è¾ƒå™¨æ’åˆ—çš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚</span><br><span class="hljs-comment">* å¦‚æœcomparatorä¸ºnullï¼Œé‚£ä¹ˆä¼šæŒ‰ç…§è‡ªç„¶æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰æ’åºã€‚</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">PriorityQueue</span><span class="hljs-params">(Comparator&lt;? <span class="hljs-built_in">super</span> E&gt; comparator)</span> &#123;<br>    <span class="hljs-built_in">this</span>(DEFAULT_INITIAL_CAPACITY, comparator);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä»–å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ“ä½œç±»å‹</th><th>æ–¹æ³•</th><th>æ—¶é—´å¤æ‚åº¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>å…¥é˜Ÿ / å‡ºé˜Ÿ</td><td><code>offer()</code>, <code>poll()</code></td><td>O(log n)</td><td>æ’å…¥æˆ–å–å‡ºå †é¡¶å…ƒç´ </td></tr><tr><td>åˆ é™¤æŒ‡å®šå¯¹è±¡ / æŸ¥æ‰¾</td><td><code>remove(obj)</code>, <code>contains(obj)</code></td><td>O(n)</td><td>åœ¨æ•´ä¸ªå †é‡ŒæŸ¥æ‰¾/åˆ é™¤æŸä¸ªå¯¹è±¡</td></tr><tr><td>æŸ¥çœ‹å †é¡¶ / é˜Ÿåˆ—å¤§å°</td><td><code>peek()</code>, <code>element()</code>,<code>size()</code></td><td>O(1)</td><td>è®¿é—®ä¸ç§»é™¤å †é¡¶å…ƒç´  / è·å–å¤§å°ä¿¡æ¯</td></tr></tbody></table><p>æ³¨æ„ï¼š</p><ol type="1"><li>æ²¡æœ‰<code>push</code>å’Œ<code>pop</code></li><li>ç®—æ³•æœ€å¸¸ç”¨ï¼š<code>offer</code> <code>poll</code><code>isEmpty</code> <code>size</code></li><li><code>PriorityQueue</code><strong>å¹¶ä¸ä¿è¯è¿­ä»£é¡ºåºæ˜¯æœ‰åºçš„</strong>ï¼Œå®ƒåªä¿è¯æ¯æ¬¡è°ƒç”¨å‡ºå †å’Œå…¥å †æ—¶æ‹¿åˆ°çš„æ˜¯æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰çš„å…ƒç´ ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* è¾“å…¥åˆ—è¡¨å¹¶å»ºå † */</span><br>minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>));<br><span class="hljs-comment">/*PriorityQueue å¹¶ä¸ä¿è¯è¿­ä»£é¡ºåºæ˜¯æœ‰åºçš„ï¼*/</span><br>minHeap.forEach((a) -&gt; System.out.print(a + <span class="hljs-string">&quot;\t&quot;</span>));<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š<code>1 3   2   5   4</code>ï¼Œæ‰€ä»¥ä¸è¦æŒ‡æœ›é€šè¿‡è¿™ç§æ–¹å¼æŒ‰é¡ºåºéå†å †äº†ã€‚</p><h1 id="åº•å±‚ç»“æ„">åº•å±‚ç»“æ„</h1><p>Javaä¸­çš„<code>PriorityQueue</code>çš„<strong>åº•å±‚æ˜¯æ•°ç»„å®ç°çš„å¹³è¡¡äºŒå‰å †</strong>ï¼Œå¹¶ä¸æ˜¯æŒ‡é’ˆå‹äºŒå‰æ ‘ã€‚ä¸å¦¨çœ‹çœ‹ä¸‹é¢çš„<code>grow</code>æ–¹æ³•ï¼Œä¼˜å…ˆé˜Ÿåˆ—çš„<code>add</code>ä¸­å°±è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* </span><br><span class="hljs-comment">* Increases the capacity of the array.</span><br><span class="hljs-comment">* Params:minCapacity â€“ the desired minimum capacity</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">grow</span><span class="hljs-params">(<span class="hljs-type">int</span> minCapacity)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldCapacity</span> <span class="hljs-operator">=</span> queue.length;<br>    <span class="hljs-comment">// Double size if small; else grow by 50%</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> ArraysSupport.newLength(oldCapacity,<br>            minCapacity - oldCapacity, <span class="hljs-comment">/* minimum growth */</span><br>            oldCapacity &lt; <span class="hljs-number">64</span> ? oldCapacity + <span class="hljs-number">2</span> : oldCapacity &gt;&gt; <span class="hljs-number">1</span><br>                                       <span class="hljs-comment">/* preferred growth */</span>);<br>    queue = Arrays.copyOf(queue, newCapacity);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜æ˜¾æ˜¯å¯¹æ•°ç»„çš„æ“ä½œã€‚</p><p>è™½ç„¶å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®Œå…¨äºŒå‰æ ‘ï¼Œå±äºéçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å †åœ¨å­˜å‚¨çš„æ—¶å€™å®Œå…¨å¯ä»¥ä½¿ç”¨çº¿æ€§æ•°æ®ç»“æ„æ¥å­˜å‚¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>é€»è¾‘ä¸Šæ˜¯æ ‘å½¢ç»“æ„ï¼Œç‰©ç†ä¸Šè¿˜æ˜¯çº¿æ€§å­˜å‚¨çš„</strong>ã€‚</p><p>è€Œä¸”ï¼Œåœ¨å †çš„å®ç°ä¸­ï¼Œæ•°ç»„æ¯”é“¾è¡¨æŒ‡é’ˆç»“æ„æ›´åŠ é«˜æ•ˆï¼Œå…·ä½“ä½“ç°åœ¨ï¼š -ç»“æ„ç´§å‡‘ - æ”¯æŒéšæœºè®¿é—® - å †è°ƒæ•´åªéœ€è¦äº¤æ¢æ•°ç»„å…ƒç´ ï¼Œæ•ˆç‡é«˜</p><p>è€ŒæŒ‡é’ˆå‹äºŒå‰æ ‘ç»“æ„è™½ç„¶æ¸…æ™°ï¼Œä½†æ˜¯å†…å­˜å¼€é”€å¤§ã€éš¾ä»¥é«˜æ•ˆåœ°è¿›è¡Œå †è°ƒæ•´ï¼ˆæ¯”å¦‚ä¸Šæµ®ã€ä¸‹æ²‰æ“ä½œï¼‰ã€‚</p><p>è‡³äºæ€ä¹ˆä½¿ç”¨æ•°ç»„å­˜å‚¨äºŒå‰æ ‘ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/25/pVSKEHU.png"alt="ç”¨æ•°ç»„å­˜å‚¨å †" /><figcaption aria-hidden="true">ç”¨æ•°ç»„å­˜å‚¨å †</figcaption></figure><p>å®ç°æ–¹æ³•æœ‰ä¸¤ç§ï¼šä»ç´¢å¼• 0 å¼€å§‹å­˜å‚¨æ•°æ®ï¼Œå’Œä»ç´¢å¼• 1å¼€å§‹å­˜å‚¨æ•°æ®ã€‚ä¸Šå›¾æ¼”ç¤ºçš„æ˜¯å‰è€…ã€‚ç”¨æ•°ç»„å­˜å‚¨çš„æ–¹å¼éµå¾ªå¦‚ä¸‹è§„å¾‹ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/25/pVSKTVU.png"alt="æ•°ç»„-å †ç‰¹å¾" /><figcaption aria-hidden="true">æ•°ç»„-å †ç‰¹å¾</figcaption></figure><p>è¿™æ ·ä»¥æ¥ï¼Œåªè¦çŸ¥é“äº†ä¸€ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå°±å¯ä»¥å¾ˆè½»æ¾åœ°å®šä½å…¶çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ã€‚</p><h1 id="æ‰‹å†™å°é¡¶å †">æ‰‹å†™å°é¡¶å †</h1><p>ä¸‹é¢æ ¹æ® <ahref="https://www.hello-algo.com/chapter_heap/heap/#2">Helloç®—æ³•</a>å’Œjdkæºç æ‰‹å†™ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ•´æ•°å°é¡¶å †ã€‚</p><h2 id="å †çš„å­˜å‚¨ä¸è¡¨ç¤º">å †çš„å­˜å‚¨ä¸è¡¨ç¤º</h2><p>å †çš„åˆå§‹åŒ–ï¼ˆæºç ä¸­ä¼˜å…ˆé˜Ÿåˆ—çš„åˆå§‹é»˜è®¤å®¹é‡ä¹Ÿæ˜¯11ï¼‰ï¼Œè¿™é‡Œåˆ›å»ºä¸€ä¸ªå›ºå®šå®¹é‡çš„æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_INITIAL_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;<br><br><span class="hljs-type">int</span> size;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] minHeap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">PQ</span><span class="hljs-params">()</span> &#123;<br>    minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[DEFAULT_INITIAL_CAPACITY];<br>    size = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®å‰é¢å¾—åˆ°çš„ç´¢å¼•ä¸å †ä¸­å…ƒç´ çš„æ˜ å°„å…³ç³»ï¼Œå†™å‡ºè·å–èŠ‚ç‚¹ç´¢å¼•çš„å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*ç´¢å¼•æ˜ å°„*/</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">left</span> <span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">right</span> <span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">parent</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    <span class="hljs-keyword">return</span> (i - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>; <span class="hljs-comment">// å‘ä¸‹æ•´é™¤</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è®¿é—®å †é¡¶å…ƒç´ ">è®¿é—®å †é¡¶å…ƒç´ </h2><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œå› ä¸ºæ˜¯ä»ç´¢å¼• 0 å¼€å§‹å­˜å‚¨çš„ï¼Œè·å–ç´¢å¼• 0çš„å€¼å°±å¥½äº†ã€‚æºç ä¸­çš„<code>peek</code>å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°javaä¹Ÿæ˜¯ä»0ä½ç½®å¼€å§‹å­˜å‚¨å…ƒç´ çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">peek</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> (E) queue[<span class="hljs-number">0</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>è‡ªå·±å†™çš„<code>peek</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">peek</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> minHeap[<span class="hljs-number">0</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¥å †">å…¥å †</h2><p>å…ˆæŠŠæ–°å…ƒç´ æ”¾åœ¨å †åº•ï¼Œç„¶åä¸æ–­ä¸Šç§»å®ƒï¼Œç›´åˆ°å®ƒå¤§äºç­‰äºå…¶çˆ¶èŠ‚ç‚¹ï¼Œæˆ–è€…ç›´æ¥æˆä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ¥ç»´æŒä¸€ä¸ªå°é¡¶å †ã€‚å…¥å †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)ã€‚</p><p>ä»åº•è‡³é¡¶è¿›è¡Œå †åŒ–ï¼Œæˆ–è€…å«åš<strong>ä¸Šæµ®ï¼ˆsiftUpï¼‰</strong>ã€‚å…ˆçœ‹çœ‹æºç ä¸­æ˜¯æ€ä¹ˆåšçš„ï¼ˆæºç å¯¹å˜é‡çš„èµ·åå…¶å®ä¹ŸæŒºéšæ„çš„...ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">offer</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">if</span> (e == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br>    modCount++;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> size;<br>    <span class="hljs-keyword">if</span> (i &gt;= queue.length)<br>        grow(i + <span class="hljs-number">1</span>);<br>    siftUp(i, e);<br>    size = i + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftUp</span><span class="hljs-params">(<span class="hljs-type">int</span> k, E x)</span> &#123;<br>    <span class="hljs-keyword">if</span> (comparator != <span class="hljs-literal">null</span>)<br>        siftUpUsingComparator(k, x, queue, comparator);<br>    <span class="hljs-keyword">else</span><br>        siftUpComparable(k, x, queue);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>comparator</code>ä¸º<code>null</code>çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* </span><br><span class="hljs-comment">* k: å½“å‰æ’å…¥å…ƒç´ çš„ç´¢å¼•ä½ç½®</span><br><span class="hljs-comment">* x: å½“å‰è¦æ’å…¥çš„å…ƒç´ </span><br><span class="hljs-comment">* es: PriorityQueue åº•å±‚ä½¿ç”¨çš„æ•°ç»„</span><br><span class="hljs-comment">* */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftUpComparable</span><span class="hljs-params">(<span class="hljs-type">int</span> k, T x, Object[] es)</span> &#123;<br>    <span class="hljs-comment">// å°†å…ƒç´  x å¼ºåˆ¶è½¬æ¢ä¸ºå¯æ¯”è¾ƒç±»å‹ Comparableï¼Œä»¥ä¾¿åç»­è°ƒç”¨ compareTo æ–¹æ³•</span><br>    Comparable&lt;? <span class="hljs-built_in">super</span> T&gt; key = (Comparable&lt;? <span class="hljs-built_in">super</span> T&gt;) x;<br><br>    <span class="hljs-comment">// å½“å‰å…ƒç´ ä¸æ˜¯æ ¹èŠ‚ç‚¹(k=0)æ—¶æ‰§è¡Œï¼š</span><br>    <span class="hljs-comment">// k æ¥æºäº sizeï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯å¤§äº0çš„ï¼Œå¦‚æœç­‰äº0é‚£å°±æŠŠå®ƒå½“ä½œæ–°çš„æ ¹èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">while</span> (k &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// è®¡ç®—å½“å‰å…ƒç´ çš„çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œç›¸å½“äºé™¤ä»¥2</span><br>        <span class="hljs-comment">// ä½¿ç”¨ç§»ä½èƒ½å¤Ÿæé«˜è¿è¡Œé€Ÿåº¦ï¼Œå¹¶ä¸”é€‚ç”¨äºå¤§æ•°çš„æƒ…å½¢</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> (k - <span class="hljs-number">1</span>) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br><br>        <span class="hljs-comment">//è·å–çˆ¶èŠ‚ç‚¹å…ƒç´ </span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> es[parent];<br>        <span class="hljs-comment">// æ¯”è¾ƒå½“å‰èŠ‚ç‚¹å…ƒç´ ä¸çˆ¶èŠ‚ç‚¹ e çš„å¤§å°ï¼Œç¬¦åˆè§„åˆ™å°±é€€å‡º</span><br>        <span class="hljs-keyword">if</span> (key.compareTo((T) e) &gt;= <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">// å¦‚æœå½“å‰å…ƒç´ å°äºçˆ¶èŠ‚ç‚¹ï¼Œåˆ™è¿åäº†å°é¡¶å †çš„æ€§è´¨</span><br>        <span class="hljs-comment">// å°†å½“å‰ä½ç½® k æ›¿æ¢ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œç„¶åç»§ç»­å‘ä¸Šæ£€æŸ¥çˆ¶èŠ‚ç‚¹</span><br>        es[k] = e;<br>        k = parent;<br>    &#125;<br>    es[k] = key;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ®æ­¤å¯ä»¥å†™å‡ºè‡ªå·±å®ç°çš„å°é¡¶å †çš„offeræ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*å…ƒç´ å…¥å †*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">offer</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> size;<br>    <span class="hljs-keyword">if</span>(size &gt;= minHeap.length) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Heap overflow&quot;</span>);<br>    siftUp(i, val, minHeap);<br>    size = i + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftUp</span><span class="hljs-params">(<span class="hljs-type">int</span> currentIndex, <span class="hljs-type">int</span> insertVal, <span class="hljs-type">int</span>[] es)</span> &#123;<br>    <span class="hljs-keyword">while</span>(currentIndex &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">parentIndex</span> <span class="hljs-operator">=</span> (currentIndex - <span class="hljs-number">1</span>)/<span class="hljs-number">2</span>;<br>        <span class="hljs-comment">// çˆ¶èŠ‚ç‚¹å…ƒç´ </span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">parentVal</span> <span class="hljs-operator">=</span> es[parentIndex];<br>        <span class="hljs-keyword">if</span>(insertVal &gt;= parentVal)<br>            <span class="hljs-keyword">break</span>;<br>        es[currentIndex] = parentVal;<br>        currentIndex = parentIndex;<br>    &#125;<br>    <span class="hljs-comment">// å‡ºå¾ªç¯ä¹‹åï¼ŒcurrentIndexå°±æ˜¯æ’å…¥çš„å…ƒç´ è¯¥æ”¾çš„æ­£ç¡®ä½ç½®</span><br>    es[currentIndex] = insertVal;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å †é¡¶å…ƒç´ å‡ºå †">å †é¡¶å…ƒç´ å‡ºå †</h2><p>é€šå¸¸åªåˆ é™¤ä½äºå †é¡¶éƒ¨çš„å…ƒç´ ã€‚å¦‚æœåˆ é™¤æœ€å¤§å †çš„é¡¶éƒ¨èŠ‚ç‚¹ï¼Œåˆ™å°†å †æœ€ä½å±‚æœ€å³è¾¹çš„èŠ‚ç‚¹ç§»åˆ°å †çš„é¡¶éƒ¨ã€‚å¦‚æœæ­¤æ—¶å®ƒçš„å·¦å­èŠ‚ç‚¹æˆ–å³å­èŠ‚ç‚¹çš„å€¼å¤§äºå®ƒï¼Œé‚£ä¹ˆå®ƒå’Œå·¦å³å­èŠ‚ç‚¹ä¸­å€¼è¾ƒå¤§çš„èŠ‚ç‚¹äº¤æ¢ã€‚å¦‚æœäº¤æ¢ä¹‹åèŠ‚ç‚¹çš„å€¼ä»ç„¶å°äºå®ƒçš„å­èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å†æ¬¡äº¤æ¢ï¼Œç›´åˆ°è¯¥èŠ‚ç‚¹çš„å€¼å¤§äºæˆ–ç­‰äºå®ƒçš„å·¦å³å­èŠ‚ç‚¹çš„å€¼ï¼Œæˆ–è€…åˆ°è¾¾æœ€ä½å±‚ä¸ºæ­¢ã€‚åˆ é™¤æœ€å°å †çš„é¡¶éƒ¨èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸æ­¤ç±»ä¼¼ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯è¦ç¡®ä¿èŠ‚ç‚¹çš„å€¼è¦å°äºå®ƒçš„å·¦å³å­èŠ‚ç‚¹çš„å€¼ã€‚</p><p>jdkæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">poll</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">final</span> Object[] es;<br>    <span class="hljs-keyword">final</span> E result;<br><br>    <span class="hljs-keyword">if</span> ((result = (E) ((es = queue)[<span class="hljs-number">0</span>])) != <span class="hljs-literal">null</span>) &#123;<br>        modCount++;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> n;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">E</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> (E) es[(n = --size)];<br>        es[n] = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">final</span> Comparator&lt;? <span class="hljs-built_in">super</span> E&gt; cmp;<br>            <span class="hljs-keyword">if</span> ((cmp = comparator) == <span class="hljs-literal">null</span>)<br>                siftDownComparable(<span class="hljs-number">0</span>, x, es, n);<br>            <span class="hljs-keyword">else</span><br>                siftDownUsingComparator(<span class="hljs-number">0</span>, x, es, n, cmp);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹æ²‰å‡½æ•°<code>siftDownComparable</code>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftDownComparable</span><span class="hljs-params">(<span class="hljs-type">int</span> k, T x, Object[] es, <span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-comment">// å°†å…ƒç´  x å¼ºåˆ¶è½¬æ¢ä¸ºå¯æ¯”è¾ƒç±»å‹ Comparableï¼Œä»¥ä¾¿åç»­è°ƒç”¨ compareTo æ–¹æ³•</span><br>    <span class="hljs-comment">// key ä»£è¡¨åŸæ¥çš„æ ˆåº•å…ƒç´ </span><br>    <span class="hljs-comment">// k ä»£è¡¨å½“å‰è¦â€œä¸‹æ²‰â€çš„ä½ç½®ï¼ˆé€šå¸¸æ˜¯å †é¡¶ï¼Œå³ 0ï¼‰</span><br>    Comparable&lt;? <span class="hljs-built_in">super</span> T&gt; key = (Comparable&lt;? <span class="hljs-built_in">super</span> T&gt;)x;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">half</span> <span class="hljs-operator">=</span> n &gt;&gt;&gt; <span class="hljs-number">1</span>;           <span class="hljs-comment">// å¯¹éå¶å­èŠ‚ç‚¹è¿›è¡Œå¾ªç¯</span><br>    <span class="hljs-keyword">while</span> (k &lt; half) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> (k &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>; <span class="hljs-comment">// å…ˆå–å·¦èŠ‚ç‚¹çš„ç´¢å¼•</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> es[child];     <span class="hljs-comment">// æ‹¿åˆ°å·¦èŠ‚ç‚¹çš„å€¼ c</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> child + <span class="hljs-number">1</span>;    <span class="hljs-comment">// æ‹¿åˆ°å³èŠ‚ç‚¹çš„ç´¢å¼•</span><br>        <span class="hljs-keyword">if</span> (right &lt; n &amp;&amp;<br>            ((Comparable&lt;? <span class="hljs-built_in">super</span> T&gt;) c).compareTo((T) es[right]) &gt; <span class="hljs-number">0</span>)<br>            c = es[child = right];<br>        <span class="hljs-keyword">if</span> (key.compareTo((T) c) &lt;= <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        es[k] = c;<br>        k = child;<br>    &#125;<br>    es[k] = key;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªè§„å¾‹ï¼šå †ä¸­ç´¢å¼•å°äº<code>size / 2</code>çš„å…ƒç´ éƒ½æ˜¯éå¶å­èŠ‚ç‚¹ã€‚æ‰€ä»¥åé¢çš„å¾ªç¯æ¡ä»¶æ˜¯<code>k&lt;half</code>ï¼Œåªæœ‰éå¶å­èŠ‚ç‚¹æ‰æœ‰å­èŠ‚ç‚¹ï¼Œæ‰å¯èƒ½å‘ä¸‹æ¯”è¾ƒã€‚</p><p>è¿™ä¸ªéå¸¸é•¿çš„æ¯”è¾ƒè¯­å¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (right &lt; n &amp;&amp;<br>    ((Comparable&lt;? <span class="hljs-built_in">super</span> T&gt;) c).compareTo((T) es[right]) &gt; <span class="hljs-number">0</span>)<br>    c = es[child = right];<br></code></pre></td></tr></table></figure><p>çš„å«ä¹‰æ˜¯ï¼šå¦‚æœå³èŠ‚ç‚¹å­˜åœ¨ï¼ˆright &lt;nï¼‰ï¼Œè€Œä¸”å·¦èŠ‚ç‚¹çš„å€¼æ¯”å³èŠ‚ç‚¹å¤§ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å³èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡éƒ½å°†çˆ¶èŠ‚ç‚¹ä¸è¾ƒå°çš„é‚£ä¸€ä¸ªå­èŠ‚ç‚¹è¿›è¡Œäº’æ¢ã€‚</p><p>æ‰‹å†™çš„å‡ºå †çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å †é¡¶å…ƒç´ å‡ºå †</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">poll</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span>(size == <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Heap is empty&quot;</span>);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> minHeap[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> minHeap[--size];<br>    <span class="hljs-comment">// åˆ é™¤æ ˆåº•å…ƒç´ </span><br>    minHeap[size] = <span class="hljs-literal">null</span>;<br>    siftDown(<span class="hljs-number">0</span>, last, minHeap, size);<br><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftDown</span><span class="hljs-params">(<span class="hljs-type">int</span> currentIndex, <span class="hljs-type">int</span> currentVal, Integer[] es, <span class="hljs-type">int</span> size)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">half</span> <span class="hljs-operator">=</span> size / <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">while</span>(currentIndex &lt; half) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">childIndex</span> <span class="hljs-operator">=</span> currentIndex * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>; <span class="hljs-comment">// å…ˆæ‹¿å·¦èŠ‚ç‚¹çš„å€¼</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">childVal</span> <span class="hljs-operator">=</span> es[childIndex];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rightIndex</span> <span class="hljs-operator">=</span> childIndex + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span>(rightIndex &lt; size &amp;&amp; es[rightIndex] &lt; childVal) &#123;<br>            childVal = es[rightIndex];<br>            childIndex = rightIndex;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(currentVal &lt;= childVal) &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        es[currentIndex] = childVal;<br>        currentIndex = childIndex;<br>    &#125;<br>    es[currentIndex] = currentVal;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://jokinkuang.github.io/2017/01/30/complete-binary-tree.html<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:2"class="footnote-text"><span>https://www.hello-algo.com/chapter_heap/heap/<a href="#fnref:2" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®ç»“æ„ä¸ç®—æ³•</tag>
      
      <tag>æºç å‰–æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring-ä½¿ç”¨PageHelperå®ç°æ¡ä»¶åˆ†é¡µ</title>
    <link href="/2025/06/08/%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5/"/>
    <url>/2025/06/08/%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5/</url>
    
    <content type="html"><![CDATA[<h2 id="éœ€æ±‚">éœ€æ±‚</h2><h3 id="åŸºæœ¬ä¿¡æ¯">åŸºæœ¬ä¿¡æ¯</h3><p>è¯·æ±‚è·¯å¾„ï¼š/article</p><p>è¯·æ±‚æ–¹å¼ï¼šGET</p><p>æ¥å£æè¿°ï¼šè¯¥æ¥å£ç”¨äºæ ¹æ®æ¡ä»¶æŸ¥è¯¢æ–‡ç« ,<strong>å¸¦åˆ†é¡µ</strong>ã€‚</p><p>è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>å‚æ•°åç§°</th><th>è¯´æ˜</th><th>ç±»å‹</th><th>æ˜¯å¦å¿…é¡»</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>pageNum</td><td>å½“å‰é¡µç </td><td>number</td><td>æ˜¯</td><td></td></tr><tr><td>pageSize</td><td>æ¯é¡µæ¡æ•°</td><td>number</td><td>æ˜¯</td><td></td></tr><tr><td>categoryId</td><td>æ–‡ç« åˆ†ç±»ID</td><td>number</td><td>å¦</td><td></td></tr><tr><td>state</td><td>å‘å¸ƒçŠ¶æ€</td><td>string</td><td>å¦</td><td>å·²å‘å¸ƒ | è‰ç¨¿</td></tr></tbody></table><p>è¯·æ±‚æ•°æ®ç¤ºä¾‹ï¼š<code>pageNum=1&amp;pageSize=3&amp;categoryId=2&amp;state=è‰ç¨¿</code></p><p>å“åº”æ•°æ®ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ“ä½œæˆåŠŸ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;items&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é™•è¥¿æ—…æ¸¸æ”»ç•¥&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…µé©¬ä¿‘,åæ¸…æ± ,æ³•é—¨å¯º,åå±±...çˆ±å»å“ªå»å“ª...&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;coverImg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://big-event-gwd.oss-cn-beijing.aliyuncs.com/9bf1cf5b-1420-4c1b-91ad-e0f4631cbed4.png&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è‰ç¨¿&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;categoryId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-09-03 11:55:30&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-09-03 11:55:30&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="mybatis-pagehelper-åˆ†é¡µæ€è·¯">MyBatis + PageHelper åˆ†é¡µæ€è·¯</h2><p>åˆ†é¡µæŸ¥è¯¢çš„ç›®çš„ï¼š<strong>é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®ï¼ŒèŠ‚çœå†…å­˜å’Œç½‘ç»œèµ„æºï¼Œæé«˜æ€§èƒ½</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œå‰ç«¯ä¼ æ¥ä¸¤ä¸ªå‚æ•°ï¼š<code>pageNum=3, pageSize=5</code>ï¼Œæ„æ€æ˜¯æŸ¥è¯¢ç¬¬ä¸‰é¡µï¼ŒæŒ‡å®šæ¯ä¸€é¡µ5æ¡æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¸­ç¬¬11åˆ°ç¬¬15æ¡è®°å½•ã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>LIMIT &lt;N-M&gt; OFFSET &lt;M&gt;</code>å­å¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œè¡¨ç¤ºä»ç¬¬<code>M</code>æ¡è®°å½•å¼€å§‹ï¼Œå–<code>N-M</code>æ¡è®°å½•ï¼Œç»“æœå°±æ˜¯ä»ç»“æœé›†ä¸­â€œæˆªå–â€å‡ºç¬¬<code>M~N</code>æ¡è®°å½•ã€‚æœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p><ul><li>LIMIT æ€»æ˜¯è®¾å®šä¸º<code>pageSize</code>ï¼›</li><li>OFFSET è®¡ç®—å…¬å¼ä¸º<code>pageSize * (pageIndex - 1)</code>ã€‚</li></ul><p>å¦‚æœæ¯æ¬¡éƒ½æ˜¯è‡ªå·±æ‰‹ç®—çš„è¯ï¼Œæœªå…æœ‰ç‚¹éº»çƒ¦ï¼Œäºæ˜¯å°±æœ‰äº†<code>PageHelper</code>ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨åœ¨SQLè¯­å¥åé¢é™„åŠ è¿™ä¸€å­å¥ã€‚</p><h3 id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ§åˆ¶å±‚">æ§åˆ¶å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span><br><span class="hljs-keyword">public</span> Result&lt;PageBean&lt;Article&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(</span><br><span class="hljs-params">        Integer pageNum,</span><br><span class="hljs-params">        Integer pageSize,</span><br><span class="hljs-params">        <span class="hljs-meta">@RequestParam(required = false)</span> Integer categoryId,</span><br><span class="hljs-params">        <span class="hljs-meta">@RequestParam(required = false)</span> String state</span><br><span class="hljs-params">)</span>&#123;<br>    PageBean&lt;Article&gt; pb = articleService.list(pageNum, pageSize, categoryId, state);<br>    <span class="hljs-keyword">return</span> Result.success(pb);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥æ”¶å‰ç«¯ä¼ æ¥çš„å‚æ•°ï¼š<code>pageNum</code> <code>pageSize</code>å’Œä¸¤ä¸ªå¯é€‰æ¡ä»¶ï¼š<code>categoryId</code><code>state</code>ï¼Œè¿™é‡Œè°ƒç”¨æœåŠ¡å±‚çš„<code>list</code>æ–¹æ³•è·å–ç»“æœé›†ã€‚</p><p>è¿”å›ï¼šè‡ªå®šä¹‰ç±»<code>PageBean</code>ï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ã€‚å®ƒç”¨æ¥ä¿å­˜æŸ¥è¯¢åˆ°çš„è¿™ä¸€é¡µçš„æ€»è®°å½•æ•°ã€æ‰€æœ‰æŸ¥è¯¢åˆ°çš„ç»“æœæ„æˆçš„é›†åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageBean</span> &lt;T&gt;&#123;<br>    <span class="hljs-keyword">private</span> Long total;<span class="hljs-comment">//æ€»æ¡æ•°</span><br>    <span class="hljs-keyword">private</span> List&lt;T&gt; items;<span class="hljs-comment">//å½“å‰é¡µæ•°æ®é›†åˆ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æœåŠ¡å±‚">æœåŠ¡å±‚</h3><p>åœ¨æœåŠ¡å±‚è®¾ç½®åˆ†é¡µï¼Œæ€»å…±åˆ†ä¸º5æ­¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> PageBean&lt;Article&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Integer pageNum, Integer pageSize, Integer categoryId, String state)</span> &#123;<br>    <span class="hljs-comment">// 1. å¼€å¯åˆ†é¡µæ’ä»¶æ‹¦æˆª</span><br>    PageHelper.startPage(pageNum, pageSize);<br><br>    <span class="hljs-comment">// 2. è·å–å½“å‰ç™»å½•ç”¨æˆ· idï¼ˆä¸€èˆ¬ç”¨äºæƒé™æ§åˆ¶ï¼‰</span><br>    Map&lt;String, Object&gt; map = ThreadLocalUtil.get();<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Integer) map.get(<span class="hljs-string">&quot;id&quot;</span>);<br><br>    <span class="hljs-comment">// 3. æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼ˆSELECT * FROM ... LIMIT ...ï¼‰</span><br>    List&lt;Article&gt; list = articleMapper.list(userId, categoryId, state);<br><br>    <span class="hljs-comment">// 4. ç”¨ PageInfo å°è£…åˆ†é¡µä¿¡æ¯</span><br>    PageInfo&lt;Article&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(list);<br><br>    <span class="hljs-comment">// 5. å°è£…æˆè‡ªå·±çš„ PageBeanï¼Œè¿”å›å‰ç«¯</span><br>    PageBean&lt;Article&gt; pb = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageBean</span>&lt;&gt;();<br>    pb.setTotal(pageInfo.getTotal());     <span class="hljs-comment">// æ€»è®°å½•æ•°</span><br>    pb.setItems(pageInfo.getList());      <span class="hljs-comment">// å½“å‰é¡µæ•°æ®åˆ—è¡¨</span><br>    <span class="hljs-keyword">return</span> pb;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li><p><code>PageHelper.startPage(pageNum, pageSize);</code><strong>ä¼šåŠ¨æ€æ‹¦æˆªæ¥ä¸‹æ¥çš„SQLæŸ¥è¯¢</strong>ï¼Œå¹¶è‡ªåŠ¨åœ¨SQLåé¢æ·»åŠ <code>LIMIT</code>å’Œ<code>OFFSET</code>ã€‚</p></li><li><p><code>ThreadLocalUtil.get()</code>è·å–å½“å‰ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯</p></li><li><p><code>PageInfo&lt;Article&gt; pageInfo = new PageInfo&lt;&gt;(list);</code>å°†æŸ¥è¯¢æ•°æ®åº“è¿”å›çš„è®°å½•å°è£…æˆ<code>PageInfo</code>ï¼Œç„¶åå¯ä»¥è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>getTotal()</code>ï¼šæ€»è®°å½•æ•°</li><li><code>getList()</code>ï¼šå½“å‰é¡µæ•°æ®</li><li><code>getPageNum()</code>ï¼šå½“å‰é¡µç </li><li><code>getPageSize()</code>ï¼šæ¯é¡µè®°å½•æ•°</li><li><code>getPages()</code>ï¼šæ€»é¡µæ•°</li><li><code>isHasNextPage()</code>ã€<code>isHasPreviousPage()</code>ç­‰</li></ul></li></ul><p>è¿™é‡Œç”¨åˆ°äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>getTotal()</code>ï¼Œå¯¹åº”<code>PageBean</code>ä¸­çš„<code>total</code>å­—æ®µï¼Œç”¨setter ä¸ºpbèµ‹å€¼ï¼›</li><li><code>getList()</code>ï¼Œå¯¹åº”<code>getList</code>ä¸­çš„<code>items</code>å­—æ®µï¼Œç”¨setter ä¸ºpbèµ‹å€¼ã€‚</li></ul><h3 id="mapper">Mapper</h3><p>æœåŠ¡å±‚è°ƒç”¨äº†<code>articleMapper.list(userId, categoryId, state);</code>ç”¨äºä»<code>article</code>è¡¨ä¸­è¯»å–æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼š</p><ol type="1"><li><code>userId</code>ä¸ºç™»å½•ç”¨æˆ·çš„id</li><li><code>categoryId</code>ä¸ºå‰ç«¯å‘æ¥çš„æŒ‡å®šåˆ†ç±»id</li><li><code>state</code>ä¸ºå‰ç«¯å‘æ¥çš„æŒ‡å®šæ–‡ç« çŠ¶æ€</li></ol><p>ç¬¬ä¸€æ¡éœ€è¦ä»<code>ThreadLocal</code>ä¸­è¯»å–ï¼Œè¿™ä¸€æ­¥åœ¨æœåŠ¡å±‚å·²ç»åšè¿‡äº†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥åªéœ€è¦å†™SQLè¯­å¥ã€‚</p><p>é¦–å…ˆåº”è¯¥æ³¨æ„åˆ°ï¼ŒcategoryId å’Œ stateéƒ½æ˜¯å¯é€‰çš„æ¡ä»¶ï¼Œå¯ä»¥ä¸ºç©ºï¼Œè¿™æ˜¯éå¸¸åˆç†çš„ï¼Œå› ä¸ºç”¨æˆ·åœ¨å‰ç«¯å¯èƒ½åªæƒ³æŒ‰ç…§åˆ†ç±»æŸ¥æ‰¾ï¼Œæˆ–è€…åªæƒ³æŸ¥æŸä¸ªçŠ¶æ€ï¼ˆæ¯”å¦‚â€œè‰ç¨¿â€æˆ–â€œå·²å‘å¸ƒâ€ï¼‰ï¼Œä¸åº”è¯¥å¼ºåˆ¶ä»–æä¾›æ‰€æœ‰æ¡ä»¶ã€‚</p><p>å½“å¯é€‰æ¡ä»¶å­˜åœ¨æ—¶å°±åŠ å…¥SQLå­å¥ï¼Œä¸å­˜åœ¨æ—¶å°±å¿½ç•¥ï¼Œéœ€è¦åŠ¨æ€SQLæ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚å…ˆç¼–å†™æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArticleMapper</span> &#123;<br>    List&lt;Article&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Integer userId, Integer categoryId, String state)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ resourcesç›®å½•ä¸‹çš„<code>com/kzn/mapper/ArticleMapper.xml</code>é‡Œå†™åŠ¨æ€SQLï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.kzn.mapper.ArticleMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.kzn.pojo.Article&quot;</span>&gt;</span><br>        select * from article<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>                create_user=#&#123;userId&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId!=null&quot;</span>&gt;</span><br>                and category_id = #&#123;categoryId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;state!=null&quot;</span>&gt;</span><br>                and state = #&#123;state&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸ä¼ <code>categoryId</code>å’Œ<code>state</code>æ—¶åªä¼šæ‹¼æ¥<code>user_id</code>ï¼Œé¿å…äº†å†—ä½™æŸ¥è¯¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web Development</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ThreadLocalä½¿ç”¨åœºæ™¯+æºç ç®€æ</title>
    <link href="/2025/06/07/ThreadLocal%E5%89%96%E6%9E%90/"/>
    <url>/2025/06/07/ThreadLocal%E5%89%96%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½œç”¨">ä½œç”¨</h2><ol type="1"><li>çº¿ç¨‹å¹¶å‘ï¼šå¤šçº¿ç¨‹å¹¶å‘çš„åœºæ™¯</li><li>ä¼ é€’æ•°æ®ï¼šå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹çš„ä¸åŒç»„ä»¶ä¸­ä¼ é€’å…¬å…±å˜é‡</li><li>çº¿ç¨‹éš”ç¦»ï¼šæ¯ä¸ªçº¿ç¨‹çš„å˜é‡éƒ½æ˜¯ç‹¬ç«‹çš„ä¸ä¼šäº’ç›¸å½±å“</li></ol><h2 id="ç”¨æ³•">ç”¨æ³•</h2><p>ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œä¸”çº¿ç¨‹å®‰å…¨ã€‚ä¸ºæ¯ä¸ªçº¿ç¨‹å•ç‹¬åˆ›å»ºä¸€ä¸ªå­˜å‚¨ç©ºé—´ã€‚</p><p>åˆ›å»ºå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadLocal&lt;String&gt; tl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>è®¾ç½®å½“å‰çº¿ç¨‹ç»‘å®šçš„å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>    set(Thread.currentThread(), value);<br>    <span class="hljs-keyword">if</span> (TRACE_VTHREAD_LOCALS) &#123;<br>        dumpStackIfVirtualThread();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> get(Thread.currentThread());<br>&#125;<br></code></pre></td></tr></table></figure><p>ç§»é™¤å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span>&#123;...&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸šåŠ¡åœºæ™¯">ä¸šåŠ¡åœºæ™¯</h2><p>åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼ŒæŸäº›é¡µé¢ä»…å½“ç”¨æˆ·ç™»å½•ä»¥åæ‰èƒ½è®¿é—®ï¼Œå¯ä»¥åœ¨æ¯å½“ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶å°±ä¸ºç”¨æˆ·å‘æ”¾ä¸€ä¸ªJWTä»¤ç‰Œï¼Œéšåçš„æ¯æ¬¡è¯·æ±‚éƒ½åœ¨è¯·æ±‚å¤´é‡Œå¸¦ä¸Šè¿™ä¸ªtokenï¼Œå¦‚æœtokenæ ¡éªŒé€šè¿‡ï¼Œåˆ™è¯´æ˜ç”¨æˆ·çš„ç¡®å·²ç»ç™»å½•ï¼Œå…è®¸ç»§ç»­è®¿é—®ã€‚</p><p>é‡‡ç”¨è¿™ç§æ€è·¯ï¼ŒæŸ¥è¯¢ç”¨æˆ·çš„æ–‡ç« åˆ—è¡¨çš„å¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/article&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader(name = &quot;Authorization&quot;)</span> String token, HttpServletResponse resp)</span> &#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>            Map&lt;String, Object&gt; claims = JwtUtil.parseToken(token); <span class="hljs-comment">// è§£ætoken</span><br>            <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">&quot;æ‰€æœ‰çš„æ–‡ç« æ•°æ®&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            resp.setStatus(<span class="hljs-number">401</span>);<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;æœªç™»å½•&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">&quot;æ‰€æœ‰çš„æ–‡ç« æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å½¢å‚é‡Œä¸»åŠ¨æ¥æ”¶è¯·æ±‚å¤´æºå¸¦çš„tokenï¼Œç„¶åæ‰‹åŠ¨è§£æã€‚å¦‚æœè§£æå‡ºé”™ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›ç»“æœâ€œæœªç™»å½•â€ã€‚</p><p>ä¸Šé¢çš„æ€è·¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼šç™»å½•æˆåŠŸä»¥åï¼Œæ¯ä¸ªå’Œç”¨æˆ·æœ‰å…³çš„åŠŸèƒ½éƒ½éœ€è¦éªŒè¯tokenï¼Œå¦‚æœåœ¨æ¯ä¸ªé¡µé¢çš„å¤„ç†æ–¹æ³•éƒ½å†™ä¸€éè§£ætokençš„æ–¹æ³•æœªå…å¤ªè¿‡å†—ä½™ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>ThreadLocal</code>å­˜å‚¨tokeanè§£æåçš„ç»“æœï¼Œè€Œtokenè§£æçš„å·¥ä½œæ”¾åœ¨æ‹¦æˆªå™¨çš„<code>preHandle</code>é‡Œè¿›è¡Œï¼Œå¹¶åœ¨<code>afterCompletion</code>æ¸…é™¤å±€éƒ¨å˜é‡ã€‚</p><p>ä¸ºæ­¤ï¼Œå…ˆå†™ä¸€ä¸ª ThreadLocalUtilå·¥å…·ç±»ï¼Œå°è£…äº†å­˜å‚¨å±€éƒ¨å˜é‡ã€è·å–å±€éƒ¨å˜é‡ã€æ¸…é™¤çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalUtil</span> &#123;<br>    <span class="hljs-comment">//æä¾›ThreadLocalå¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadLocal</span> <span class="hljs-variable">THREAD_LOCAL</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>();<br><br>    <span class="hljs-comment">//æ ¹æ®é”®è·å–å€¼</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">get</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> (T) THREAD_LOCAL.get();<br>    &#125;<br><br>    <span class="hljs-comment">//å­˜å‚¨ä¸çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(Object value)</span>&#123;<br>        THREAD_LOCAL.set(value);<br>    &#125;<br><br>    <span class="hljs-comment">//æ¸…é™¤ThreadLocal é˜²æ­¢å†…å­˜æ³„æ¼</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span>&#123;<br>        THREAD_LOCAL.remove();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†é…ç½®æ‹¦æˆªå™¨ï¼Œåœ¨æ‹¦æˆªå™¨é‡Œè§£ætokenã€‚æ­¤å¤„tokençš„è§£æç»“æœæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ŒåŒ…æ‹¬</p><ul><li><code>"id=ç”¨æˆ·id"</code></li><li><code>"username=ç”¨æˆ·å"</code></li></ul><p>ç„¶åæŠŠè§£æå¾—åˆ°çš„è¡¨ä½œä¸º<code>ThreadLocalMap</code>çš„valueå­˜å‚¨èµ·æ¥ï¼Œåé¢æ‰§è¡Œæ–¹æ³•çš„æ—¶å€™ç›´æ¥è¯»å–å°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>    <span class="hljs-comment">// åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰è¿›è¡Œæ‹¦æˆª</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;Authorization&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Map&lt;String, Object&gt; claims = JwtUtil.parseToken(token);<br>            <span class="hljs-comment">// æŠŠä¸šåŠ¡æ•°æ®å­˜å‚¨åˆ° ThreadLocal ä¸­</span><br>            ThreadLocalUtil.set(claims);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ”¾è¡Œ</span><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            response.setStatus(<span class="hljs-number">401</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// ä¸æ”¾è¡Œ</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Spring DispatcherServlet åœ¨å®Œæˆä¸€æ¬¡ HTTP è¯·æ±‚çš„æ•´ä¸ªå¤„ç†æµç¨‹åï¼Œ</span><br>    <span class="hljs-comment">// è‡ªåŠ¨è°ƒç”¨ afterCompletion() æ–¹æ³•</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// è¿™é‡Œæ¸…é™¤ ThreadLocal ä¸­å·²ç»ä½¿ç”¨è¿‡çš„æ•°æ®ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span><br>        ThreadLocalUtil.remove();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–åçš„æŸ¥è¯¢æ–‡ç« çš„å¤„ç†æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/article&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// èƒ½å¤Ÿæ‰§è¡Œåˆ°è¿™é‡Œçš„è¯ä¸€å®šæ˜¯é€šè¿‡éªŒè¯äº†</span><br>        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">&quot;æ‰€æœ‰çš„æ–‡ç« æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒç†ï¼ŒæŸ¥è¯¢ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„è¯å¯ä»¥å…ˆä»<code>ThreadLocalUtil</code>è·å–ç”¨æˆ·åæˆ–idï¼Œç„¶åè°ƒç”¨ä¸šåŠ¡å±‚çš„æ–¹æ³•æŸ¥è¯¢ä¿¡æ¯å¹¶è¿”å›:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="hljs-meta">@GetMapping(&quot;/userInfo&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;User&gt; <span class="hljs-title function_">Info</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader(name = &quot;Authorization&quot;)</span> String token)</span> &#123;<br>    <span class="hljs-comment">// å…ˆä» token ä¸­è¯»å–ç”¨æˆ·çš„ç”¨æˆ·å</span><br>    Map&lt;String, Object&gt; stringObjectMap = ThreadLocalUtil.get();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> (String) stringObjectMap.get(<span class="hljs-string">&quot;username&quot;</span>);<br>    <span class="hljs-comment">// è°ƒç”¨ä¸šåŠ¡å±‚çš„æ–¹æ³•ï¼ŒæŸ¥è¯¢è¿™ä¸ªç”¨æˆ·åçš„å…·ä½“ä¿¡æ¯</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> userService.findByUserName(username);<br>    <span class="hljs-keyword">return</span> Result.success(u);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸åŒæ­¥ä»£ç å—çš„åŒºåˆ«">ä¸åŒæ­¥ä»£ç å—çš„åŒºåˆ«</h2><p><strong>ä½œç”¨æœºåˆ¶</strong></p><ul><li><code>ThreadLocal</code>ä¸ºå¤šä¸ªçº¿ç¨‹æä¾›<strong>ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹äº’ä¸å¹²æ‰°</li><li><code>synchronized</code>å¤šä¸ªçº¿ç¨‹<strong>å…±äº«</strong>èµ„æºï¼Œé€šè¿‡é”å®ç°åŒæ­¥è®¿é—®</li><li><code>ThreadLocal</code>å®ç°çº¿ç¨‹éš”ç¦»ï¼Œå„ä¸ªçº¿ç¨‹ä¿å­˜è‡ªå·±çš„å˜é‡ï¼ˆå¸¸ç”¨äºç”¨æˆ·ä¸Šä¸‹æ–‡ï¼‰</li><li><code>synchronized</code>å®ç°çº¿ç¨‹äº’æ–¥ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹èµ„æºï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´</li></ul><p><strong>çº¿ç¨‹å®‰å…¨æ–¹å¼</strong></p><ul><li><code>ThreadLocal</code>å„ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œä¸éœ€è¦åŠ é”å°±å¯ä»¥è®¿é—®</li><li><code>synchronized</code>é€šè¿‡åŠ äº’æ–¥é”é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«å˜é‡</li></ul><p><strong>æ€§èƒ½</strong></p><ul><li><code>ThreadLocal</code>æ€§èƒ½æ›´å¥½ï¼Œé¿å…äº†é”ç«äº‰ï¼›<code>synchronized</code>æ€§èƒ½è¾ƒå·®</li></ul><h2 id="threadlocalåº•å±‚å®ç°">ThreadLocalåº•å±‚å®ç°</h2><p>æ ¸å¿ƒæ€æƒ³ï¼š</p><p>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª<code>ThreadLocalMap</code>ï¼Œç”¨æ¥å­˜å‚¨è‡ªå·±çš„å±€éƒ¨å˜é‡å‰¯æœ¬ã€‚</p><p>è¿™ä¸ª<code>Map</code>çš„<code>key</code>æ˜¯<code>ThreadLocal</code>å¯¹è±¡æœ¬èº«ï¼Œ<code>value</code>æ˜¯ä¸ºå®ƒè®¾ç½®çš„å€¼ã€‚</p><p>å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; &#123;...&#125;<br></code></pre></td></tr></table></figure><h3 id="setæ–¹æ³•">setæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹</span><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap</span><br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// ä¸ä¸ºç©ºï¼Œåˆ™å°†ThreadLocalä½œä¸ºé”®ï¼Œvalueä½œä¸ºå€¼</span><br>        map.set(<span class="hljs-built_in">this</span>, value);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ä¸ºç©ºåˆ™åˆ›å»º</span><br>        createMap(t, value);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è·å–æŒ‡å®šçº¿ç¨‹ t ç»´æŠ¤çš„ ThreadLocalMap çš„æ–¹æ³•</span><br>ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> &#123;<br>    <span class="hljs-keyword">return</span> t.threadLocals;<br>&#125;<br><br><span class="hljs-comment">// ä¸ºçº¿ç¨‹åˆ›å»ºThreadLocalMap</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> &#123;<br>    t.threadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>threadLocals</code>åœ¨<code>Thread.java</code>å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸æ­¤çº¿ç¨‹ç›¸å…³çš„ threadLocal å€¼ã€‚æ­¤æ˜ å°„ç”± ThreadLocal ç±»ç»´æŠ¤</span><br>ThreadLocal.<span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">threadLocals</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><h3 id="getæ–¹æ³•">getæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿”å›å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡çš„å‰¯æœ¬ã€‚</span><br><span class="hljs-comment">// å¦‚æœè¯¥å˜é‡åœ¨å½“å‰çº¿ç¨‹ä¸­æ²¡æœ‰å€¼ï¼Œåˆ™é¦–å…ˆå°†å…¶åˆå§‹åŒ–ä¸ºè°ƒç”¨ initialValue æ–¹æ³•è¿”å›çš„å€¼ã€‚</span><br><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹</span><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap</span><br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-comment">// å·²ç»åˆ›å»ºè¿‡ map ç»§ç»­çœ‹é‡Œé¢æ˜¯å¦å­˜æ”¾çš„æœ‰æ˜ å°„</span><br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-comment">// å­˜æ”¾çš„æœ‰æ˜ å°„ï¼Œåˆ™æŠŠæ˜ å°„ä¸­çš„å€¼å–å‡ºæ¥è¿”å›</span><br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// æ²¡æœ‰åˆ›å»ºè¿‡mapï¼Œæˆ–è€…æ²¡æœ‰entryï¼Œåˆ™å»¶è¿Ÿåˆå§‹åŒ–å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡çš„å€¼</span><br>    <span class="hljs-keyword">return</span> setInitialValue();<br>&#125;<br><br><span class="hljs-keyword">private</span> T <span class="hljs-title function_">setInitialValue</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">T</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> initialValue(); <span class="hljs-comment">// å³ value = null</span><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        map.set(<span class="hljs-built_in">this</span>, value); <span class="hljs-comment">// æœ‰mapï¼Œå°±æŠŠnullå­˜è¿›å»ï¼Œå¦åˆ™æ–°å»ºmap</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        createMap(t, value);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> <span class="hljs-keyword">instanceof</span> TerminatingThreadLocal) &#123;<br>        TerminatingThreadLocal.register((TerminatingThreadLocal&lt;?&gt;) <span class="hljs-built_in">this</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMapï¼Œå†æ ¹æ®è°ƒç”¨è€…ThreadLocalï¼ˆé”®ï¼‰æ‰¾åˆ°å­˜å‚¨çš„å€¼</p><h3 id="removeæ–¹æ³•">removeæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> getMap(Thread.currentThread());<br>        <span class="hljs-keyword">if</span> (m != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// ç§»é™¤è¿™ä¸ªentry</span><br>            m.remove(<span class="hljs-built_in">this</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨ç§»é™¤ï¼Ÿå› ä¸º ThreadLocalMap çš„é”®æ˜¯<strong>å¼±å¼•ç”¨</strong>çš„ThreadLocal å®ä¾‹ï¼Œå€¼æ˜¯å®é™…çš„å€¼ï¼ˆObject valueï¼‰ã€‚</p><p><code>ThreadLocalMap.Entry</code>çš„é”®æ˜¯ç”¨å¼±å¼•ç”¨åŒ…è£…çš„ï¼Œ<strong>ä½†æ˜¯å®ƒçš„å€¼æ˜¯å¼ºå¼•ç”¨</strong>ã€‚å¦‚æœé”®ä¸å†è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œä½†æ˜¯å€¼å¼•ç”¨çš„å¯¹è±¡è¿˜åœ¨è¢«å¼ºå¼•ç”¨ï¼Œå ç€å†…å­˜ï¼Œå¿…é¡»æ‰‹åŠ¨æ¸…é™¤ã€‚</p><h2 id="threadlocalmap">ThreadLocalMap</h2><p>ä¸ºä»€ä¹ˆä¸ç”¨ HashMap è€Œç”¨ ThreadLocalMapï¼Ÿ</p><p>ThreadLocalMap æ˜¯ ThreadLocal çš„ç§æœ‰é™æ€å†…éƒ¨ç±»ï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºThreadLocal å®šåˆ¶çš„ï¼š</p><ul><li>å®ƒçš„ key æ˜¯ ThreadLocal å¼±å¼•ç”¨</li><li>å¦‚æœ ThreadLocal æ²¡æœ‰å¤–éƒ¨å¼•ç”¨ï¼Œkey ä¼šè¢« GC æ‰ï¼›ä½†å¦‚æœä¸æ¸…ç†valueï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</li></ul><hr /><p>ThreadLocalMapæ˜¯ThreadLocalçš„<strong>å†…éƒ¨é™æ€å®ç°ç±»</strong>ï¼Œæ²¡æœ‰å®ç°Map æ¥å£ï¼Œç‹¬ç«‹å®ç°äº† Map çš„åŠŸèƒ½ã€‚</p><p>å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalMap</span> &#123;...&#125;<br></code></pre></td></tr></table></figure><h3 id="entry">Entry</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;<br>    <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span><br>    Object value;<br><br>    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;<br>        <span class="hljs-built_in">super</span>(k);<br>        value = v;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Entry</code>ç»§æ‰¿äº†<code>WeakReference</code>ï¼Œæ˜¯<code>ThreadLocalMap</code>çš„åº•å±‚ã€‚</p><p><code>ThreadLocal</code>è¢«å¼±å¼•ç”¨ï¼Œè¿™ç§å¼•ç”¨ä¸ä¼šå½±å“ GCè¿‡ç¨‹ã€‚æ„é€ å™¨<code>Entry(ThreadLocal&lt;?&gt; k, Object v)</code>å†…éƒ¨çš„<code>super(k);</code>è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å™¨ã€‚è¿™é‡Œçš„æ³›å‹<code>T</code>å¯¹åº”<code>ThreadLocal&lt;?&gt;</code>ï¼Œçˆ¶ç±»æ„é€ å™¨å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Creates a new weak reference that refers to the given object.  The new</span><br><span class="hljs-comment"> * reference is not registered with any queue.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> referent object the new weak reference will refer to</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">WeakReference</span><span class="hljs-params">(T referent)</span> &#123;<br>    <span class="hljs-built_in">super</span>(referent);<br>&#125;<br></code></pre></td></tr></table></figure><p>äºæ˜¯å°±åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘<code>ThreadLocal</code>çš„å¼±å¼•ç”¨<code>k</code>ã€‚å¦ä¸€ä¸ªå‚æ•°<code>v</code>ä½¿ç”¨çš„æ˜¯å¼ºå¼•ç”¨ï¼š<code>value = v</code>ã€‚</p><h3 id="æˆå‘˜å˜é‡">æˆå‘˜å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆå§‹å®¹é‡â€”â€”å¿…é¡»æ˜¯ 2 çš„æ¬¡å¹‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INITIAL_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Mç”¨äºå­˜å‚¨å…ƒç´ çš„Entryæ•°ç»„ï¼Œå®¹é‡å¿…é¡»æ˜¯2çš„æ¬¡å¹‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> Entry[] table;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç°å­˜çš„entryçš„ä¸ªæ•°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰©å®¹é˜ˆå€¼</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> threshold; <span class="hljs-comment">// Default to 0</span><br><br></code></pre></td></tr></table></figure><h3 id="åŸºæœ¬æ–¹æ³•">åŸºæœ¬æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰©å®¹é˜ˆå€¼å–ä¸ºå½“å‰æ•°ç»„é•¿åº¦çš„2/3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setThreshold</span><span class="hljs-params">(<span class="hljs-type">int</span> len)</span> &#123;<br>    threshold = len * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿”å›å½“å‰ç´¢å¼• i çš„ä¸‹ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœåˆ°å¤´äº†å°±ç»•å›æ•°ç»„èµ·å§‹å¤„ï¼ˆ0ï¼‰ã€‚</span><br><span class="hljs-comment"> * è¿™æ˜¯ç”¨äºçº¿æ€§æ¢æµ‹çš„ä¸€ä¸ªè¾…åŠ©æ–¹æ³•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextIndex</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> len)</span> &#123;<br>    <span class="hljs-keyword">return</span> ((i + <span class="hljs-number">1</span> &lt; len) ? i + <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·Ÿä¸Šé¢çš„åè¿‡æ¥ï¼Œæ‰¾åˆ°å‰ä¸€ä¸ªç´¢å¼•ï¼Œåˆ°å¤´äº†å°±ç»•å›å°¾éƒ¨ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">prevIndex</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> len)</span> &#123;<br>    <span class="hljs-keyword">return</span> ((i - <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span>) ? i - <span class="hljs-number">1</span> : len - <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">// ä»ä¸Šé¢ä¸¤ä¸ªå–ç´¢å¼•çš„æ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„æ•°ç»„ç›¸å½“äºä¸€ä¸ªç¯å½¢æ•°ç»„</span><br></code></pre></td></tr></table></figure><p>è´Ÿè½½å› å­ä¹‹æ‰€ä»¥å–2/3ï¼Œæ˜¯å› ä¸º ThreadLocalMapå†…éƒ¨ä½¿ç”¨çš„æ˜¯<strong>å¼€æ”¾åœ°å€æ³•</strong>ï¼ˆçº¿æ€§æ¢æµ‹ï¼‰ï¼Œè¿™ç§ç­–ç•¥å¯¹è´Ÿè½½å› å­æ¯”è¾ƒæ•æ„Ÿï¼Œåœ¨é«˜è´Ÿè½½ä¸‹çš„æ’å…¥å’ŒæŸ¥æ‰¾éƒ½ä¼šå˜æ…¢ï¼Œæ‰€ä»¥éœ€è¦æå‰æ‰©å®¹ã€‚</p><div class="note note-info">            <p>ä»€ä¹ˆæ˜¯å¼€æ”¾åœ°å€æ³•ï¼Ÿ</p><p>å¼€æ”¾åœ°å€æ³•ä¹Ÿæ˜¯ä¸€ç§å“ˆå¸Œå†²çªçš„è§£å†³ç­–ç•¥ï¼šå½“æˆ‘ä»¬å‘å“ˆå¸Œè¡¨ä¸­æ’å…¥ä¸€ä¸ªé”®æ—¶ï¼Œå¦‚æœå®ƒæ˜ å°„åˆ°çš„ä½ç½®å·²ç»è¢«å ç”¨äº†ï¼Œå°±åœ¨è¡¨ä¸­ç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºä½ç½®ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœ key1 å’Œ key2éƒ½æ˜ å°„åˆ°äº†ç´¢å¼•3ï¼Œé‚£ä¹ˆkey2æ’å…¥çš„æ—¶å€™ä¼šç»§ç»­å‘åå¯»æ‰¾ç´¢å¼• 4 ï¼Œç´¢å¼• 4ä¹Ÿä¸ä¸ºç©ºçš„è¯å°±æ‰¾ç´¢å¼• 5ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºä½ç½®ã€‚è¿™ä¸ªç»§ç»­å¯»æ‰¾çš„è¿‡ç¨‹å°±ç§°ä¹‹ä¸º<strong>æ¢æµ‹</strong>ã€‚æ¢æµ‹çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼ŒThreadLocalMapä½¿ç”¨çš„æ˜¯çº¿æ€§æ¢æµ‹æ³•ï¼Œä¹Ÿå°±æ˜¯åˆšæ‰æè¿°çš„æ¯æ¬¡ç´¢å¼•åŠ ä¸€çš„æ€è·¯ã€‚</p><p>å¼€æ”¾åœ°å€æ³•çš„å¥½å¤„æ˜¯èŠ‚çœå†…å­˜ï¼Œä»…ç”¨ä¸€ä¸ªæ•°ç»„å­˜å‚¨æ‰€æœ‰çš„å…ƒç´ ï¼Œæ— éœ€é¢å¤–çš„æ•°æ®ç»“æ„ï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šæ•°ç»„ä¸­å­˜å‚¨çš„ä¸ªæ•°è¶Šæ¥è¿‘æ•°ç»„é•¿åº¦ï¼Œç©ºä½è¶Šå°‘ï¼Œå“ˆå¸Œå†²çªçš„æ¦‚ç‡ä¼šè¿…é€Ÿä¸Šå‡ï¼Œæ¯æ¬¡æ’å…¥/æŸ¥æ‰¾çš„æ•ˆç‡è¿…é€Ÿä¸‹é™ã€‚æ‰€ä»¥è¯´å®ƒå¯¹è´Ÿè½½å› å­æ˜¯å¾ˆæ•æ„Ÿçš„ï¼Œä¸€èˆ¬ä¸èƒ½è¶…è¿‡0.7ã€‚</p>          </div><p>æ€»ç»“ï¼šå¼€æ”¾åœ°å€æ³•æ˜¯æŒ‡å“ˆå¸Œå†²çªæ—¶ï¼Œé€šè¿‡åœ¨æ•°ç»„ä¸­ç»§ç»­æ‰¾ä¸‹ä¸€ä¸ªç©ºä½æ¥è§£å†³å†²çªçš„æ–¹æ³•ã€‚å®ƒä¸ä½¿ç”¨é“¾è¡¨ï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨æ•°ç»„ä¸­ï¼Œå› æ­¤å¯¹è´Ÿè½½å› å­éå¸¸æ•æ„Ÿï¼Œä¸€æ—¦å¤ªæ»¡ï¼Œæ€§èƒ½ä¼šè¿…é€Ÿä¸‹é™ã€‚ä¸ºäº†å°½å¯èƒ½å‡å°å“ˆå¸Œå†²çªçš„æ¦‚ç‡ï¼Œå¯¹å“ˆå¸Œå€¼çš„é€‰å–é‡‡ç”¨äº†ç‰¹æ®Šçš„å¤„ç†åŠæ³•ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå“ˆå¸Œè¡¨é‡‡ç”¨<strong>é“¾åœ°å€æ³•</strong>ï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªæ—¶å°†å†²çªçš„å…ƒç´ å­˜å‚¨åˆ°é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­ï¼Œå¯¹è´Ÿè½½æ›´è€å—ï¼Œå¯¹è´Ÿè½½å› å­ä¸é‚£ä¹ˆæ•æ„Ÿï¼Œæ‰€ä»¥å–0.75ã€‚</p><h3 id="å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼">å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼</h3><p>å†è¯¦ç»†åœ°ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µï¼š</p><p>å†…å­˜æ³„æ¼ï¼šç¨‹åºä¸­å·²ç»åˆ†é…çš„åŠ¨æ€å †å†…å­˜ç”±äºæŸç§åŸå› æœªé‡Šæ”¾æˆ–è€…æ— æ³•é‡Šæ”¾ï¼Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œå‡æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰ä¸¥é‡åæœã€‚å†…å­˜çš„å †ç§¯æœ€ç»ˆå°†å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p><p>ç„¶åå›é¡¾ä¸€ä¸‹JVMå¯¹è±¡å¼•ç”¨çš„å››ç§ç±»å‹ï¼š</p><ul><li>å¼ºå¼•ç”¨ï¼šæ¯”å¦‚<code>Object obj = new Object()</code>ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œè¯¥å¯¹è±¡å°±æ°¸è¿œä¹Ÿä¸ä¼šè¢«å›æ”¶</li><li>è½¯å¼•ç”¨ï¼šæè¿°ä¸€äº›æœ‰ç”¨ï¼Œä½†æ˜¯å¹¶éå¿…é¡»çš„å¯¹è±¡ã€‚è¢«è½¯å¼•ç”¨çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿçš„å†…å­˜å¿«è¦æº¢å‡ºçš„æ—¶å€™ä¼šè¢«å›æ”¶ï¼Œå¦‚æœå›æ”¶ä¹‹åå†…å­˜è¿˜æ˜¯ä¸å¤Ÿæ‰ä¼šæŠ›å¼‚å¸¸</li><li>å¼±å¼•ç”¨ï¼šåªè¦åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œï¼Œåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡å°±ä¼šè¢«å›æ”¶ã€‚</li><li>è™šå¼•ç”¨ï¼šè™šå¼•ç”¨å®Œå…¨ä¸ä¼šå¯¹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¢«å›æ”¶é€ æˆå½±å“ï¼Œå®ƒæ˜¯ä¸ºäº†è®©ç³»ç»ŸçŸ¥é“è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶äº†</li></ul><p>åƒåœ¾å›æ”¶å™¨ä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œå°±ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚</p><hr /><p>ThreadLocal ç›¸å…³å˜é‡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š</p><p>Thread â”€â”€â”€â–¶ ThreadLocalMap â”€â”€â”€â–¶ Entry[] â”€â”€â”€â–¶(WeakReference<ThreadLocal>, value)</p><p>æ‰€æœ‰å¯¹è±¡çš„å®ä¾‹éƒ½ä¿å­˜åœ¨ Javaå †ä¸­ï¼Œå¼•ç”¨ç±»å‹çš„å­—æ®µç”±äºæ˜¯å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¹Ÿåœ¨å †é‡Œã€‚</p><p><code>Thread</code>ç±»æŒæœ‰ä¸€ä¸ª <code>ThreadLocalMap</code>å­—æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadLocal.<span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">threadLocals</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><p>ThreadLocalMapçš„å®ä¾‹ä¹Ÿä½äºå †ä¸­ï¼Œå®ƒè¢«å½“å‰çº¿ç¨‹ï¼ˆCurrentThreadï¼‰å¼•ç”¨ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº† ThreadLocal æŒæœ‰çš„å±€éƒ¨å˜é‡æœ‰æ•ˆæ—¶çš„æƒ…å†µï¼š</p><p><img src="https://s21.ax1x.com/2025/06/07/pViDMnI.png" /></p><ul><li>å½“<code>ThreadLocalRef</code>ä¸å†è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œ<code>ThreadLocal</code>åªå…·å¤‡ä¸€ä¸ªæ¥è‡ª<code>k</code>çš„å¼±å¼•ç”¨ï¼Œæ‰€ä»¥é©¬ä¸Šä¼šè¢«GCå›æ”¶ï¼Œäºæ˜¯<code>k</code>å˜ä¸ºç©ºã€‚</li><li>ä½†æ˜¯<code>value</code>æ˜¯ç”±å¼ºå¼•ç”¨<code>value = v;</code>åˆ›å»ºçš„ï¼Œ<code>ThreadLocalMap</code>ä¸­çš„<code>Entry</code>æ•°ç»„æŒæœ‰å¯¹<code>value</code>çš„å¼ºå¼•ç”¨ï¼Œå› æ­¤æ— æ³•è¢«GCï¼Œå¿…é¡»æ‰‹åŠ¨æ¸…é™¤ã€‚</li></ul><p><strong>ThreadLocalå†…å­˜æ³„æ¼çš„æ ¹æº</strong>ï¼šThreadLocalMap æ˜¯ Threadçš„å­—æ®µï¼Œç”Ÿå‘½å‘¨æœŸå’Œ Thread ç›¸åŒï¼Œå½“ ThreadLocalä½¿ç”¨å®Œæ¯•ä¹‹åï¼Œçº¿ç¨‹å¹¶æ²¡æœ‰ç»“æŸã€‚æ¯”å¦‚ï¼Œåœ¨çº¿ç¨‹æ± ä¸­ï¼Œçº¿ç¨‹ç»“æŸä¹‹åæ˜¯ä¸ä¼šè¢«é”€æ¯çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœä¸æ‰‹åŠ¨æ¸…é™¤entryï¼Œä¼šé€ æˆä¸¥é‡çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p><p>ä½¿ç”¨å¼±å¼•ç”¨è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼š</p><p>å¦‚æœåœ¨æ‰§è¡Œ<code>ThreadLocalMap</code>çš„ set æˆ–è€… getæ–¹æ³•çš„æ—¶å€™æ‰¾ä¸åˆ°<code>key</code>ï¼Œå°±ä¼šåˆ†åˆ«æ‰§è¡Œ<code>expungeStaleEntry((int staleSlot))</code>æ–¹æ³•å’Œ<code>replaceStaleEntry</code>æ–¹æ³•ï¼Œå‰è€…çš„ä½œç”¨æ˜¯æ¸…é™¤è¿‡æœŸçš„entryï¼Œ åè€…çš„ä½œç”¨æ˜¯æŠŠè¿‡æœŸçš„ entry æ›´æ–°ä¸ºæ–°çš„ entryï¼Œè€Œåˆ¤æ–­ entryæ˜¯å¦è¿‡æœŸå°±æ˜¯çœ‹å®ƒæ˜¯å¦æ»¡è¶³<code>key == null &amp;&amp; value != null</code>ã€‚<strong>æ‰€ä»¥ä½¿ç”¨å¼±å¼•ç”¨çš„æ–¹å¼å®é™…ä¸Šä¸ºæˆ‘ä»¬æ·»åŠ äº†ä¸€å±‚ä¿éšœï¼Œå°±ç®—æ˜¯å¿˜è®°äº†æ‰‹åŠ¨æ¸…é™¤è¿‡æœŸçš„entryï¼Œ è°ƒç”¨ get æˆ– set æ–¹æ³•ä¹Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠå®ƒä»¬æ¸…ç†æ‰</strong>ã€‚</p><h3 id="å‡è½»å“ˆå¸Œå†²çª">å‡è½»å“ˆå¸Œå†²çª</h3><p>ThreadLocalMap çš„æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;<br>    table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[INITIAL_CAPACITY]; <span class="hljs-comment">// åˆå§‹å®¹é‡16</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="hljs-number">1</span>); <span class="hljs-comment">// è®¡ç®—ç´¢å¼•</span><br>    table[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(firstKey, firstValue); <span class="hljs-comment">// å…ˆåˆ›å»ºä¸€ä¸ªentry</span><br>    size = <span class="hljs-number">1</span>;<br>    setThreshold(INITIAL_CAPACITY); <span class="hljs-comment">// è®¾ç½®é˜ˆå€¼</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>threadLocalHashCode</code>æ˜¯<code>ThreadLocal</code>çš„å­—æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">threadLocalHashCode</span> <span class="hljs-operator">=</span> nextHashCode();<br></code></pre></td></tr></table></figure><p>nextHashCodeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextHashCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">nextHashCode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br></code></pre></td></tr></table></figure><p><code>AtomicInteger</code>æ˜¯ä¸€ä¸ªæä¾›åŸå­æ“ä½œçš„ Integerç±»ï¼Œé€šè¿‡çº¿ç¨‹å®‰å…¨çš„æ–¹å¼åŠ å‡ã€‚<code>nextHashCode()</code>æ˜¯é€šè¿‡æŠŠåŸæ¥çš„å€¼ä¸æ–­åŠ ä¸Š<code>HASH_INCREMENT</code>å¾—æ¥çš„ã€‚<code>HASH_INCREMENT</code>ä¸é»„é‡‘åˆ†å‰²æ•°æœ‰å…³ï¼Œç›®çš„æ˜¯è®©å“ˆå¸Œç å‡åŒ€åœ°åˆ†å¸ƒåœ¨2çš„næ¬¡æ–¹çš„æ•°ç»„é‡Œã€‚</p><blockquote><p><code>HASH_INCREMENT = é»„é‡‘åˆ†å‰² * 2^32</code>æ˜¯ç›®å‰è¢«è®¤ä¸ºæœ€æ¥è¿‘å®Œç¾å‡åŒ€æ•£åˆ—çš„æ–¹å¼ã€‚</p></blockquote><p>æ‰€æœ‰çš„ ThreadLocal å®ä¾‹çš„å“ˆå¸Œå€¼å°±æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼š</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">0<br>0 + HASH_INCREMENT<br>0 + 2*HASH_INCREMENT<br>0 + 3*HASH_INCREMENT<br><span class="hljs-meta prompt_">...</span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><ul><li>ThreadLocalè®©æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°ï¼Œé€‚åˆçº¿ç¨‹å¤ç”¨ç¯å¢ƒä¸‹ä¿å­˜çº¿ç¨‹ç§æœ‰æ•°æ®ï¼Œæ¯”å¦‚åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œé¿å…å±‚å±‚æ–¹æ³•ä¼ å‚ï¼›</li><li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª<code>ThreadLocalMap</code>ï¼Œ<code>ThreadLocalMap</code>æ˜¯ThreadLocalçš„å†…éƒ¨é™æ€ç±»ï¼Œå°†<code>ThreadLocal</code>å¯¹è±¡ä½œä¸ºkeyï¼Œå°†éœ€è¦ä¸çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡ä½œä¸ºvalueï¼Œå…¶ä¸­<code>key</code>ä¸ºå¼±å¼•ç”¨ï¼Œ<code>value</code>ä¸ºå¼ºå¼•ç”¨ï¼Œå› ä¸ºå­˜åœ¨å¼ºå¼•ç”¨æ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ¸…é™¤å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼</li><li><code>ThreadLocalMap</code>ç‹¬ç«‹å®ç°äº† Mapçš„åŠŸèƒ½ï¼Œåº•å±‚æ˜¯<code>Entry</code>æ•°ç»„ï¼Œå®¹é‡æ˜¯ 2 çš„æ¬¡å¹‚ï¼Œä½†æ˜¯è´Ÿè½½å› å­å–2/3ï¼Œå‡è½»å“ˆå¸Œå†²çªçš„æ–¹æ³•æ˜¯å¼€æ”¾åœ°å€æ³•ä¸­çš„çº¿æ€§æ¢æµ‹æ³•ï¼Œç›¸æ¯”ä¹‹ä¸‹ HashMapé‡‡ç”¨é“¾åœ°å€æ³•</li><li><code>ThreadLocalMap</code>çš„å“ˆå¸Œå€¼ç­‰è·åˆ†å¸ƒï¼Œé—´éš”ä¸º<code>HASH_INCREMENT = é»„é‡‘åˆ†å‰²*2^32</code>ï¼Œç›®çš„æ˜¯è®©å“ˆå¸Œå€¼å°½å¯èƒ½å‡åŒ€åˆ†å¸ƒï¼Œå‡å°å“ˆå¸Œå†²çªçš„æ¦‚ç‡</li></ul>]]></content>
    
    
    <categories>
      
      <category>Web Development</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
      <tag>æºç å‰–æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM-3.2-åƒåœ¾å›æ”¶ç®—æ³•</title>
    <link href="/2025/06/02/JVM-3-2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95/"/>
    <url>/2025/06/02/JVM-3-2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¯»ä¹¦ç¬”è®°(3)</p><span id="more"></span><h2 id="å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•">å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•</h2><h3 id="ä»€ä¹ˆåŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶">ä»€ä¹ˆåŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶ï¼Ÿ</h3><p>è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨å±äºçº¿ç¨‹ç§æœ‰ï¼Œéšçº¿ç¨‹è€Œç”Ÿï¼Œéšçº¿ç¨‹è€Œç­ï¼Œè€Œä¸”å®ƒä»¬å æ®çš„å†…å­˜å¤§å°åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç¡®å®šä¸‹æ¥äº†ï¼Œçº¿ç¨‹ç»“æŸçš„æ—¶å€™è‡ªç„¶ä¼šè¢«å›æ”¶ï¼Œä¸ç”¨æ‹…å¿ƒåƒåœ¾å›æ”¶çš„é—®é¢˜ã€‚</p><p>æ–¹æ³•åŒºã€å †ç”±çº¿ç¨‹å…±äº«ï¼Œå…¶ä¸­æ–¹æ³•åŒºå­˜å‚¨ç±»çš„ä¿¡æ¯å’Œè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå †å†…å­˜å­˜æ”¾å¯¹è±¡çš„å®ä¾‹ã€‚æ–¹æ³•åŒºå­˜å‚¨çš„ä¿¡æ¯ç›¸å¯¹å›ºå®šï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºæ¯”è¾ƒå°‘è§ï¼Œå †å†…å­˜æ˜¯åƒåœ¾å›æ”¶çš„é‡ç¾åŒºã€‚</p><h3 id="å¼•ç”¨è®¡æ•°ç®—æ³•">å¼•ç”¨è®¡æ•°ç®—æ³•?</h3><p>å¼•ç”¨è®¡æ•°ç®—æ³•çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><div class="note note-info">            <p>åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ ä¸€ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡ä¸€ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸ºé›¶çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p>          </div><p>å¼•ç”¨è®¡æ•°æ³•æœ‰ä¸ªå¾ˆæ˜æ˜¾çš„ç¼ºé™·ï¼š<strong>å¦‚æœä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œé‚£ä¹ˆä»–ä»¬çš„å¼•ç”¨è®¡æ•°éƒ½ä¸ä¸ºé›¶ï¼Œè™½ç„¶å±äºåƒåœ¾ä½†æ˜¯æ°¸è¿œä¸ä¼šè¢«å›æ”¶</strong>ã€‚ä¸»æµJavaè™šæ‹Ÿæœºæ²¡æœ‰é‡‡ç”¨è¿™ç§ç®—æ³•ã€‚</p><h3 id="å¯è¾¾æ€§åˆ†æç®—æ³•">å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>é¦–å…ˆï¼Œå¯è¾¾æ€§åˆ†æå’Œå¯è¾¾é¸­æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ˆé›¾ï¼‰</p><p>ç®€å•æ¥è¯´ï¼Œä»è¢«ç§°ä¸ºGCRootsçš„æ ¹å¯¹è±¡å‡ºå‘ï¼Œæ ¹æ®å¯¹è±¡çš„å¼•ç”¨å…³ç³»æŸ¥æ‰¾å…¶ä»–èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰ä¸€æ¡è·¯å¾„èƒ½å¤Ÿåˆ°è¾¾æŸä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«è§†ä¸ºåƒåœ¾ã€‚</p><figure><img src="https://s21.ax1x.com/2025/06/02/pV9L4Xt.png"alt="å¯è¾¾æ€§åˆ†æç®—æ³•å›¾è§£" /><figcaption aria-hidden="true">å¯è¾¾æ€§åˆ†æç®—æ³•å›¾è§£</figcaption></figure><p>å›ºå®šå¯ä»¥ä½œä¸º GC Roots çš„å¯¹è±¡æœ‰ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆæ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»çš„é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„Nativeæ–¹æ³•å¼•ç”¨çš„å¯¹è±¡</li><li>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆæ¯”å¦‚NullPointExcepitonã€OutOfMemoryErrorï¼‰ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li><li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedå…³é”®å­—ï¼‰æŒæœ‰çš„å¯¹è±¡</li><li>åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰</li></ul><p>é™¤äº†è¿™äº›å›ºå®šçš„å¯¹è±¡æ„ä»¥å¤–ï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–çš„å¯¹è±¡ä¸´æ—¶åŠ å…¥ã€‚</p><h3 id="å¼•ç”¨çš„å››ç§ç±»å‹">å¼•ç”¨çš„å››ç§ç±»å‹</h3><ul><li>å¼ºå¼•ç”¨ï¼šæ¯”å¦‚<code>Object obj=new Object()</code>ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œè¯¥å¯¹è±¡å°±æ°¸è¿œä¹Ÿä¸ä¼šè¢«å›æ”¶</li><li>è½¯å¼•ç”¨ï¼šæè¿°ä¸€äº›æœ‰ç”¨ï¼Œä½†æ˜¯å¹¶éå¿…é¡»çš„å¯¹è±¡ã€‚è¢«è½¯å¼•ç”¨çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿçš„å†…å­˜å¿«è¦æº¢å‡ºçš„æ—¶å€™ä¼šè¢«å›æ”¶ï¼Œå¦‚æœå›æ”¶ä¹‹åå†…å­˜è¿˜æ˜¯ä¸å¤Ÿæ‰ä¼šæŠ›å¼‚å¸¸</li><li>å¼±å¼•ç”¨ï¼šåªè¦åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œï¼Œå¼±å¼•ç”¨çš„å¯¹è±¡å°±ä¼šè¢«å›æ”¶ã€‚</li><li>è™šå¼•ç”¨ï¼šè™šå¼•ç”¨å®Œå…¨ä¸ä¼šå¯¹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¢«å›æ”¶é€ æˆå½±å“ï¼Œå®ƒæ˜¯ä¸ºäº†è®©ç³»ç»ŸçŸ¥é“è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶äº†</li></ul><h3 id="æ–¹æ³•åŒºçš„å›æ”¶">æ–¹æ³•åŒºçš„å›æ”¶</h3><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li>ä¸å†ä½¿ç”¨çš„å¸¸é‡</li><li>ä¸å†ä½¿ç”¨çš„ç±»å‹</li></ul><p>å›æ”¶åºŸå¼ƒå¸¸é‡ï¼šå¾ˆç®€å•ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸­æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨è¯¥å¸¸é‡æ± ä¸­çš„å¸¸é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¸¸é‡å·²ç»åºŸå¼ƒäº†ï¼Œéœ€è¦è¢«å›æ”¶ã€‚</p><p>ä¸å†ä½¿ç”¨çš„ç±»å‹çš„åˆ¤æ–­æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼š</p><ol type="1"><li>è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶</li><li>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶</li><li>è¯¥ç±»å¯¹è±¡çš„ Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå¹¶ä¸”æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥æ–¹æ³•ã€‚</li></ol><p>æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ç±»<strong>å…è®¸</strong>è¢«å›æ”¶ï¼Œä½†æ˜¯ä¸ä¸€å®šçœŸçš„ä¼šè¢«å›æ”¶ã€‚</p><h2 id="åƒåœ¾æ”¶é›†ç®—æ³•-è¿½è¸ªå¼åƒåœ¾æ”¶é›†">åƒåœ¾æ”¶é›†ç®—æ³•-è¿½è¸ªå¼åƒåœ¾æ”¶é›†</h2><p>è¿½è¸ªå¼åƒåœ¾æ”¶é›†æ˜¯ä¸»æµJavaè™šæ‹Ÿæœºé‡‡ç”¨çš„ç®—æ³•ï¼Œä»¥ä¸‹æ‰€æœ‰ç®—æ³•å‡å±äºè·Ÿè¸ªå¼åƒåœ¾æ”¶é›†çš„èŒƒç•´ã€‚</p><h3 id="åˆ†ä»£æ”¶é›†ç†è®º">åˆ†ä»£æ”¶é›†ç†è®º</h3><p><code>Generational Collection</code></p><p>åˆ†ä»£æ”¶é›†ç†è®ºçš„å‡è¯´åŸºç¡€ï¼š</p><ol type="1"><li><strong>å¼±åˆ†ä»£å‡è¯´</strong>ï¼ˆWeak GenerationalHypothesisï¼‰ï¼šç»å¤§å¤šæ•°çš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­çš„</li><li><strong>å¼ºåˆ†ä»£å‡è¯´</strong>ï¼ˆStrong GenerationalHypothesisï¼‰ï¼šç†¬è¿‡è¶Šå¤šæ¬¡åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„å¯¹è±¡å°±è¶Šéš¾ä»¥æ¶ˆäº¡</li></ol><p>æ ¹æ® 1 å’Œ 2å¯ä»¥æ¨è®ºï¼šå­˜åœ¨å¼•ç”¨å…³ç³»çš„å¯¹è±¡å¤§å¤šæ•°éƒ½å±äºåŒä¸€ä»£çš„å¯¹è±¡ï¼Œæ¯”å¦‚å¦‚æœä¸€ä¸ªè€å¹´ä»£çš„å¯¹è±¡å¼•ç”¨äº†ä¸€ä¸ªæ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°ç”Ÿä»£å¯¹è±¡å°±ä¸å¤ªå¯èƒ½è¢«å›æ”¶ï¼Œè¿Ÿæ—©ä¼šå˜æˆè€å¹´ä»£ã€‚ç”±æ­¤å¯ä»¥å¾—åˆ°ç¬¬ä¸‰æ¡å‡è¯´ï¼š</p><ol start="3" type="1"><li><strong>è·¨ä»£å¼•ç”¨å‡è¯´</strong>ï¼ˆIntergenerational ReferenceHypothesisï¼‰ï¼šè·¨ä»£å¼•ç”¨ç›¸å¯¹äºåŒä»£å¼•ç”¨æ¥è¯´ä»…å æå°‘æ•°</li></ol><p>å¯¹è±¡çš„å¹´é¾„ï¼šå¯¹è±¡ç†¬è¿‡åƒåœ¾å›æ”¶è¿‡ç¨‹çš„æ¬¡æ•°ã€‚</p><p><strong>åƒåœ¾æ”¶é›†å™¨çš„è®¾è®¡åŸåˆ™ï¼šæ”¶é›†å™¨åº”è¯¥æŠŠjavaå †åˆ’åˆ†å‡ºä¸åŒçš„åŒºåŸŸï¼Œå°†å¯¹è±¡æ ¹æ®å¹´é¾„å­˜æ”¾åœ¨ä¸åŒçš„åŒºåŸŸ</strong>ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼šæŠŠéš¾ä»¥ç†¬è¿‡åƒåœ¾æ”¶é›†çš„å¯¹è±¡é›†ä¸­åœ¨ä¸€èµ·ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå›æ”¶çš„æ—¶å€™åªéœ€è¦å…³æ³¨å°‘é‡æ²¡æœ‰è¢«å›æ”¶çš„å¯¹è±¡ï¼Œå¹¶ä¸”æé«˜å›æ”¶çš„é¢‘ç‡ï¼›æŠŠéš¾ä»¥æ¶ˆäº¡çš„å¯¹è±¡é›†ä¸­åœ¨ä¸€èµ·ï¼Œå›æ”¶ä»–ä»¬çš„æ—¶å€™åªéœ€è¦å…³æ³¨å°‘é‡è¢«å›æ”¶çš„å¯¹è±¡ï¼Œå¹¶ä¸”é™ä½å›æ”¶çš„é¢‘ç‡ã€‚</p><p>å› ä¸ºå¯¹ä¸åŒçš„åŒºåŸŸé‡‡å–é’ˆå¯¹æ€§çš„å›æ”¶ç­–ç•¥ï¼Œæ‰€ä»¥æé«˜äº†åƒåœ¾æ”¶é›†çš„æ•ˆç‡ï¼Œå°½å¯èƒ½æŠŠå†…å­˜ç©ºé—´ç”¨åˆ°æœ‰æ„ä¹‰çš„å¯¹è±¡èº«ä¸Šï¼Œæé«˜äº†å †å†…å­˜ç©ºé—´çš„åˆ©ç”¨ç‡ã€‚</p><div class="note note-secondary">            <p>åƒåœ¾æ”¶é›†ç›¸å…³åè¯ï¼š</p><ul><li>éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼šæŒ‡æ”¶é›†æ•´ä¸ªJavaå †çš„ä¸€éƒ¨åˆ†çš„åƒåœ¾æ”¶é›†ï¼ŒåŒ…æ‹¬ï¼š<ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC/Young GCï¼‰ï¼šåªé’ˆå¯¹æ–°ç”Ÿä»£çš„æ”¶é›†</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC/OldGCï¼‰ï¼šåªé’ˆå¯¹è€å¹´ä»£çš„æ”¶é›†ï¼ˆåªæœ‰CMSæ”¶é›†å™¨å­˜åœ¨ï¼‰</li><li>æ··åˆæ”¶é›†ï¼ˆMixedGCï¼‰ï¼šæŒ‡ç›®æ ‡æ˜¯æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰G1æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚</li></ul></li><li>æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li></ul>          </div><h3 id="æ ‡è®°æ¸…é™¤ç®—æ³•">æ ‡è®°æ¸…é™¤ç®—æ³•</h3><blockquote><p>ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåï¼Œç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ï¼Œæ ‡è®°å­˜æ´»çš„å¯¹è±¡ï¼Œç»Ÿä¸€å›æ”¶æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚</p></blockquote><p>æ ‡è®°æ¸…é™¤ç®—æ³•æ˜¯æœ€åŸºç¡€çš„ç®—æ³•ï¼Œåç»­çš„å¾ˆå¤šç®—æ³•ä»¥å®ƒä¸ºåŸºç¡€ã€‚å®ƒæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ol type="1"><li>æ•ˆç‡ä¸ç¨³å®šï¼Œéœ€è¦æ ‡è®°çš„å¯¹è±¡æ•°é‡è¶Šå¤šæ•ˆç‡è¶Šä½</li><li>å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§å¤§é‡çš„ä¸è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œåç»­å¦‚æœéœ€è¦ä¸ºå¤§å¯¹è±¡åˆ†é…ç©ºé—´ï¼Œéœ€è¦å†ä¸´æ—¶è°ƒç”¨ä¸€æ¬¡åƒåœ¾æ”¶é›†æ“ä½œè…¾å‡ºç©ºé—´ã€‚</li></ol><h3 id="æ ‡è®°å¤åˆ¶ç®—æ³•">æ ‡è®°å¤åˆ¶ç®—æ³•</h3><p>ä¸ºäº†è§£å†³å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼ŒFenichel æå‡ºäº†æ ‡è®°å¤åˆ¶ç®—æ³•ï¼š</p><blockquote><p>å¤åˆ¶ç®—æ³•å°†å†…å­˜åˆ†ä¸ºä¸¤ä¸ªåŒºé—´,è¿™ä¸¤ä¸ªåŒºé—´æ˜¯åŠ¨æ€çš„ï¼Œåœ¨ä»»æ„ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œæ‰€æœ‰åˆ†é…çš„å¯¹è±¡å†…å­˜åªèƒ½åœ¨å…¶ä¸­ä¸€ä¸ªåŒºé—´ï¼ˆæ´»åŠ¨åŒºé—´ï¼‰ï¼Œå¦å¤–ä¸€ä¸ªåŒºé—´å°±æ˜¯ç©ºé—²åŒºé—´ã€‚</p><p>å½“æœ‰æ•ˆå†…å­˜ç©ºé—´è€—å°½æ—¶ï¼ŒJVMå°†æš‚åœç¨‹åºè¿è¡Œï¼Œå¼€å¯å¤åˆ¶ç®—æ³•GCçº¿ç¨‹ã€‚GCçº¿ç¨‹ä¼šå°†æ´»åŠ¨åŒºé—´å†…çš„å­˜æ´»å¯¹è±¡ï¼Œå…¨éƒ¨å¤åˆ¶åˆ°ç©ºé—²åŒºé—´ï¼Œä¸”ä¸¥æ ¼æŒ‰ç…§å†…å­˜åœ°å€ä¸€æ¬¡æ’åˆ—ï¼Œä¸æ­¤åŒæ—¶ï¼ŒGCçº¿ç¨‹å°†æ›´æ–°å­˜æ´»å¯¹è±¡çš„å†…å­˜å¼•ç”¨åœ°å€æŒ‡å‘æ–°çš„å†…å­˜åœ°å€ã€‚è¿™ä¸ªæ—¶å€™ç©ºé—²å†…å­˜å·²ç»å˜æˆäº†æ´»åŠ¨åŒºé—´ï¼Œåƒåœ¾å¯¹è±¡å…¨éƒ¨åœ¨åŸæ¥çš„æ´»åŠ¨åŒºé—´ï¼Œæ¸…ç†æ‰åƒåœ¾å¯¹è±¡ï¼ŒåŸæ´»åŠ¨åŒºé—´å°±å˜æˆäº†ç©ºé—²åŒºé—´ã€‚</p></blockquote><figure><img src="https://s21.ax1x.com/2025/06/02/pV9XVPg.png"alt="æ ‡è®°å¤åˆ¶ç®—æ³•" /><figcaption aria-hidden="true">æ ‡è®°å¤åˆ¶ç®—æ³•</figcaption></figure><p>è¿™ç§ç®—æ³•æœ‰ä¸¤ä¸ªæ˜æ˜¾ç¼ºç‚¹ï¼š</p><ol type="1"><li>ç©ºé—´åˆ©ç”¨ç‡è¿‡ä½ï¼Œå¯ç”¨å†…å­˜ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠ</li><li>æ‰§è¡Œæ•ˆç‡å–å†³äºå­˜æ´»å¯¹è±¡æ•°é‡ï¼Œå­˜æ´»æ•°é‡è¶Šå¤šï¼Œéœ€è¦å¤åˆ¶çš„å¯¹è±¡å°±è¶Šå¤šï¼Œæ‰§è¡Œæ•ˆç‡è¶Šæ…¢</li></ol><p>ç¬¬ 2ç‚¹å†³å®šäº†è¿™ç§ç®—æ³•<strong>åªé€‚ç”¨äºæ–°ç”Ÿä»£å¯¹è±¡</strong>ï¼›å¯¹äºç¬¬ä¸€ç‚¹ï¼ŒAndrewAppel æå‡ºäº†ä¼˜åŒ–åçš„ç®—æ³•ï¼Œå³Appelå›æ”¶ï¼š</p><blockquote><p>å°†æ–°ç”Ÿä»£çš„ç©ºé—´åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivorç©ºé—´ï¼Œæ¯æ¬¡åˆ†é…å†…å­˜æ—¶ï¼Œåªä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivor ï¼Œå¦ä¸€å— Survivorä¸ºç©ºé—²ã€‚æ¯æ¬¡å‘ç”Ÿåƒåœ¾æ”¶é›†æ—¶ï¼ŒæŠŠ Eden å’Œ Survivorä¸­ä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°ç©ºé—² Survivor ä¸­ï¼Œç„¶åæ¸…ç†Eden å’ŒSurvivorã€‚</p></blockquote><p>HotSpot é»˜è®¤ Eden å’Œ ä¸€å— Survivor çš„æ¯”ä¾‹æ˜¯8:1ï¼Œæ‰€ä»¥æ¯æ¬¡å¯ç”¨çš„å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å†…å­˜ç©ºé—´çš„90%ã€‚</p><p>åœ¨å¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹ï¼Œå­˜æ´»å¯¹è±¡ä¸ä¼šè¶…è¿‡å†…å­˜çš„10%ï¼Œå¦‚æœçœŸçš„è¶…è¿‡äº†ï¼Œå¤šå‡ºæ¥çš„å¯¹è±¡ä¼šä¾èµ–è€å¹´ä»£çš„å†…å­˜åŒºåŸŸè¿›è¡Œ<strong>åˆ†é…æ‹…ä¿</strong>ï¼ˆHandlePromotionï¼‰ã€‚</p><p>HotSpotè™šæ‹Ÿæœºçš„Serialã€ParNewç­‰æ–°ç”Ÿä»£æ”¶é›†å™¨å‡é‡‡ç”¨äº† Appelå›æ”¶ç­–ç•¥æ¥è®¾è®¡æ–°ç”Ÿä»£çš„å†…å­˜å¸ƒå±€ã€‚</p><h3 id="æ ‡è®°æ•´ç†ç®—æ³•">æ ‡è®°æ•´ç†ç®—æ³•</h3><p>è€å¹´ä»£å¯¹è±¡åœ¨æ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶çš„å­˜æ´»æ•°é‡è¦å¤§äºæ¶ˆäº¡æ•°ï¼ŒEdward Luedersé’ˆå¯¹è¿™ç§å­˜äº¡ç‰¹å¾è®¾è®¡äº†æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚</p><p>æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><figure><img src="https://s21.ax1x.com/2025/06/02/pV9j4XR.png"alt="å›æ”¶å‰çš„çŠ¶æ€" /><figcaption aria-hidden="true">å›æ”¶å‰çš„çŠ¶æ€</figcaption></figure><figure><img src="https://s21.ax1x.com/2025/06/02/pV9jIn1.png"alt="å›æ”¶åçš„çŠ¶æ€" /><figcaption aria-hidden="true">å›æ”¶åçš„çŠ¶æ€</figcaption></figure><p>æ ‡è®°æ•´ç†ç®—æ³•ç›¸æ¯”äºæ ‡è®°æ¸…é™¤ç®—æ³•å¤šäº†ä¸€ä¸ªç§»åŠ¨å†…å­˜çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼˜ç¼ºç‚¹å¹¶å­˜ï¼š</p><ul><li>ç¼ºç‚¹ï¼šè€å¹´ä»£å¯¹è±¡åŒºåŸŸæ¯æ¬¡åƒåœ¾æ”¶é›†åä¼šæœ‰å¤§é‡çš„å¯¹è±¡å­˜æ´»ï¼Œç§»åŠ¨è¿™äº›å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä½ç½®å¹¶æ›´æ–°å…¶ä»–åœ°æ–¹å¯¹è¿™äº›å¯¹è±¡çš„å¼•ç”¨éå¸¸è€—æ—¶ï¼Œéœ€è¦å°†ç”¨æˆ·ç¨‹åºåœé¡¿è¾ƒé•¿çš„æ—¶é—´ä¸“é—¨æ‰§è¡Œæ“ä½œã€‚</li><li>ä¼˜ç‚¹ï¼šè§£å†³äº†ç©ºé—´çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œå†…å­˜åˆ†é…å’Œè®¿é—®çš„è´Ÿæ‹…éƒ½ä¼šè¢«å‡è½»ï¼Œè€Œå†…å­˜çš„è®¿é—®å°±æ˜¯ç”¨æˆ·æ‰§è¡Œæœ€é¢‘ç¹çš„æ“ä½œ</li></ul><p>â€œç¨‹åºååé‡â€ = ç”¨æˆ·ç¨‹åºæ‰§è¡Œæ•ˆç‡ + åƒåœ¾æ”¶é›†å™¨æ•ˆç‡ çš„æ€»å’Œâ€”â€”</p><p><strong>è™½ç„¶ç§»åŠ¨å¯¹è±¡çš„åƒåœ¾å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†ç”±äºå®ƒèƒ½æ˜¾è‘—æå‡å¯¹è±¡åˆ†é…å’Œè®¿é—®æ•ˆç‡ï¼Œæ‰€ä»¥æ•´ä½“æ¥çœ‹ï¼Œå¯¹ç¨‹åºååé‡æ›´æœ‰åˆ©ï¼›è€Œä¸ç§»åŠ¨å¯¹è±¡è™½ç„¶å‡å°‘äº†GCåœé¡¿ï¼Œå»¶è¿Ÿæ›´ä½ï¼Œä½†é™ä½äº†å†…å­˜åˆ†é…æ•ˆç‡ï¼Œä¸é€‚åˆé«˜ååé‡éœ€æ±‚åœºæ™¯</strong>ã€‚ä¸åŒçš„åƒåœ¾å›æ”¶å™¨é€‰æ‹©äº†ä¸åŒçš„ç­–ç•¥æ¥é€‚åº”ä¸åŒçš„éœ€æ±‚ã€‚</p><p>æ­£å› å¦‚æ­¤ï¼ŒHotSpotè™šæ‹Ÿæœºé‡Œé¢å…³æ³¨ååé‡çš„ Parallel Scavengeæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œè€Œå…³æ³¨å»¶è¿Ÿçš„ CMSæ”¶é›†å™¨åˆ™æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„ã€‚</p><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2><p>https://www.cnblogs.com/gengaixue/p/13602322.html</p>]]></content>
    
    
    <categories>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM-Javaè™šæ‹Ÿæœºä¸­çš„å¯¹è±¡</title>
    <link href="/2025/06/01/JVM-2-3-%E5%AF%B9%E8%B1%A1%E6%8F%AD%E7%A7%98/"/>
    <url>/2025/06/01/JVM-2-3-%E5%AF%B9%E8%B1%A1%E6%8F%AD%E7%A7%98/</url>
    
    <content type="html"><![CDATA[<p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¯»ä¹¦ç¬”è®°(2)</p><span id="more"></span><h1 id="hotspotå¯¹è±¡">HotSpotå¯¹è±¡</h1><h2 id="åˆ›å»ºæ–°å¯¹è±¡">åˆ›å»ºæ–°å¯¹è±¡</h2><blockquote><p>å½“Javaè™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡å­—èŠ‚ç  newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ï¼Œ</p></blockquote><p>ç±»åŠ è½½å®Œæ¯•åï¼Œè™šæ‹Ÿæœºä¼šä¸ºè¯¥æ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚å› ä¸ºæ¯ä¸ªå¯¹è±¡æ‰€éœ€è¦çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåå°±å°±å¯ä»¥ç¡®å®šï¼Œæ‰€ä»¥ç°åœ¨çš„é—®é¢˜æ˜¯æ€ä¹ˆä»Javaå †è¿™ä¸€å¤§å—å†…å­˜ä¸­åˆ’åˆ†ä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ã€‚</p><p><strong>ä¸¤ç§åˆ’åˆ†å †å†…å­˜çš„æ–¹å¼</strong>ï¼š</p><ol type="1"><li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼ˆBump ThePointerï¼‰ï¼šé€‚ç”¨äºå †å†…å­˜éå¸¸è§„æ•´ã€å·²ä½¿ç”¨å†…å­˜å’Œç©ºé—²å†…å­˜ç•Œé™åˆ†æ˜çš„æƒ…å†µï¼Œè¿™æ ·åªéœ€è¦æŠŠç”¨ä½œåˆ†ç•Œç‚¹çš„æŒ‡é’ˆå‘ç©ºé—²å†…å­˜çš„æ–¹å‘æŒªåŠ¨ä¸€å°æ®µè·ç¦»å°±è¡Œäº†ã€‚</li><li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼ˆFreeListï¼‰ï¼Œé€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´ï¼Œç©ºé—²å†…å­˜å’Œå·²ç”¨å†…å­˜æ··æ‚ä¸æ¸…çš„æƒ…å†µï¼Œè¿™æ—¶è™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­è®°å½•äº†ç©ºé—²å†…å­˜çš„ä½ç½®ï¼Œå› æ­¤è¢«ç§°ä½œç©ºé—²åˆ—è¡¨ã€‚æ¯æ¬¡æ›´æ–°å†…å­˜éƒ½è¦åŒæ­¥æ›´æ–°ç©ºé—²åˆ—è¡¨ä¸­çš„å†…å®¹ã€‚</li></ol><p>å †å†…å­˜çš„è§„æ•´ä¸å¦ç”±åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰<strong>ç©ºé—´å‹ç¼©æ•´ç†</strong>ï¼ˆCompactï¼‰åŠŸèƒ½å†³å®šã€‚</p><hr /><p>åˆ’åˆ†ç©ºé—´ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼šæ­£åœ¨ç»™å¯¹è±¡Aåˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œå¯¹è±¡BåˆåŒæ—¶ä½¿ç”¨äº†åŸæ¥çš„æŒ‡é’ˆæ¥åˆ†é…å†…å­˜ã€‚ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å¯¹åˆ†é…å†…å­˜ç©ºé—´çš„åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†ï¼Œä½†æ˜¯å®é™…ä¸Šè™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯<strong>CAS+å¤±è´¥é‡è¯•</strong>ä¿è¯æ“ä½œçš„åŸå­æ€§</li><li><strong>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²</strong>ï¼ˆThread Local AllocationBufferï¼ŒTLABï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­æå‰åˆ†é…äº†ä¸€å—ç¼“å†²åŒºï¼Œæœ¬åœ°ç¼“å†²åŒºç”¨å®Œäº†ï¼Œåˆ†é…æ–°çš„ç¼“å†²åŒºçš„æ—¶å€™æ‰ä¼šè€ƒè™‘åŒæ­¥é”å®š</li></ul><div class="note note-secondary">            <p>CAS(Compare AndSet)+å¤±è´¥é‡è¯•æ˜¯ä¸€ç§<strong>ä¹è§‚é”</strong>ç­–ç•¥ï¼Œå®ƒå‡è®¾å¹¶å‘ä¸ä¼šå¤ªæ¿€çƒˆï¼Œå¦‚æœå¤±è´¥å°±ä¸æ–­é‡è¯•ï¼Œç›´åˆ°åŸå­æ›´æ–°æˆåŠŸã€‚</p>          </div><p>å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºä¼šæŠŠåˆ†é…å¥½çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆæ‰€ä»¥Javaä¸­çš„å­—æ®µä¸èµ‹åˆå€¼å°±å¯ä»¥ä½¿ç”¨ï¼‰ï¼Œæœ€åè®¾ç½®å¯¹è±¡å¤´ã€‚è¿™æ ·ä¸€ä¸ªæ–°çš„å¯¹è±¡å°±åˆ›å»ºå¥½äº†ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œæ„é€ æ–¹æ³•ã€‚</p><h2 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h2><p>Javaå¯¹è±¡ä¿å­˜åœ¨å †ä¸­æ—¶ï¼Œç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/31/pV9uJ1A.png"alt="å¯¹è±¡çš„å†…å­˜å¸ƒå±€" /><figcaption aria-hidden="true">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</figcaption></figure><h3 id="å¯¹è±¡å¤´object-header">å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰</h3><ol type="1"><li><strong>MarkWord</strong>ï¼Œåœ¨64ä½è™šæ‹Ÿæœºä¸­å æ®64ä¸ªæ¯”ç‰¹ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒåŒ…æ‹¬å †å¯¹è±¡å¸ƒå±€ã€ç±»å‹ã€GCçŠ¶æ€ã€åŒæ­¥çŠ¶æ€å’Œèº«ä»½å“ˆå¸Œç çš„åŸºæœ¬ä¿¡æ¯</li><li><strong>KlassPointer</strong>ï¼Œç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘å®ƒçš„ç±»å‹å…ƒæ•°æ®ï¼Œç”¨äºç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</li><li><strong>å¯¹äºæ•°ç»„å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€å—ç”¨äºå­˜å‚¨æ•°ç»„é•¿åº¦çš„åŒºåŸŸ</strong>ã€‚å› ä¸ºä»¥åçš„JVMéœ€è¦è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ã€GCéœ€è¦çŸ¥é“å¯¹è±¡å å¤šå¤§ç©ºé—´ç­‰ç­‰ï¼Œæ•°ç»„é•¿åº¦çš„å€¼æ˜¯è¦è¢«å¤šæ¬¡ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æ•°ç»„å¯¹è±¡è‡ªèº«å¿…é¡»ä¹Ÿä¿å­˜ä¸€ä¸ªé•¿åº¦ã€‚</li></ol><p>64ä½JVMçš„å¯¹è±¡å¤´ç»“æ„ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/31/pV9Koa8.png" alt="å¯¹è±¡å¤´" /><figcaption aria-hidden="true">å¯¹è±¡å¤´</figcaption></figure><h3 id="å®ä¾‹æ•°æ®instance-data">å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</h3><p>å®ä¾‹æ•°æ®æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>ä»çˆ¶ç±»ç»§æ‰¿çš„å„ç§ç±»å‹çš„å­—æ®µ</li><li>åœ¨å­ç±»ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ</li></ul><p>å¦‚æœå¯¹è±¡æ²¡æœ‰å±æ€§å­—æ®µï¼Œé‚£ä¹ˆè¿™é‡Œä¸ä¼šæœ‰ä¿¡æ¯ã€‚</p><h3 id="å¯¹é½å¡«å……padding">å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</h3><p>å¹¶éå¿…è¦ä¿¡æ¯ï¼Œèµ·åˆ°å ä½ç¬¦çš„ä½œç”¨ï¼ŒåŸå› æ˜¯Javaçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œè€Œå¯¹è±¡çš„å®ä¾‹æ•°æ®å¯èƒ½ä¸æ»¡è¶³ï¼Œæ‰€ä»¥éœ€è¦å¯¹é½å¡«å……ä¸€ä¸‹ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆèµ·å§‹åœ°å€ä¼šæœ‰è¿™ä¸ªè¦æ±‚:<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://www.cnblogs.com/jajian/p/13681781.html">[1]</span></a></sup></p><div class="note note-success">            <p>å­—æ®µå†…å­˜å¯¹é½çš„å…¶ä¸­ä¸€ä¸ªåŸå› ï¼Œæ˜¯è®©å­—æ®µåªå‡ºç°åœ¨åŒä¸€CPUçš„ç¼“å­˜è¡Œä¸­ã€‚å¦‚æœå­—æ®µä¸æ˜¯å¯¹é½çš„ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°è·¨ç¼“å­˜è¡Œçš„å­—æ®µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å­—æ®µçš„è¯»å–å¯èƒ½éœ€è¦æ›¿æ¢ä¸¤ä¸ªç¼“å­˜è¡Œï¼Œè€Œè¯¥å­—æ®µçš„å­˜å‚¨ä¹Ÿä¼šåŒæ—¶æ±¡æŸ“ä¸¤ä¸ªç¼“å­˜è¡Œã€‚è¿™ä¸¤ç§æƒ…å†µå¯¹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡è€Œè¨€éƒ½æ˜¯ä¸åˆ©çš„ã€‚å…¶å®å¯¹å…¶å¡«å……çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†è®¡ç®—æœºé«˜æ•ˆå¯»å€ã€‚</p>          </div><h2 id="å¯¹è±¡çš„è®¿é—®å®šä½">å¯¹è±¡çš„è®¿é—®å®šä½</h2><p>Javaç¨‹åºä¼šé€šè¿‡æ ˆä¸Šçš„<code>reference</code>æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ï¼Œä¸»æµçš„è™šæ‹Ÿæœºçš„å¯¹è±¡è®¿é—®æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ol type="1"><li><strong>å¥æŸ„</strong></li></ol><figure><img src="https://s21.ax1x.com/2025/05/31/pV9MHw6.png" alt="å¥æŸ„" /><figcaption aria-hidden="true">å¥æŸ„</figcaption></figure><p>Javaå †ä¸­ä¼šåˆ’åˆ†å‡ºæ¥ä¸€å—åŒºåŸŸç”¨æˆ·å­˜æ”¾å¥æŸ„ï¼Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡çš„å®ä¾‹å’Œç±»å‹æ•°æ®çš„åœ°å€ä¿¡æ¯ã€‚æ­¤æ—¶ï¼Œ<code>reference</code>ä¸­å­˜æ”¾çš„æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè®¿é—®è¿‡ç¨‹æ˜¯ï¼š<code>reference</code>-&gt;å¥æŸ„-&gt;å¯¹è±¡çš„å®ä¾‹æ•°æ®å’Œç±»å‹æ•°æ®</p><ol start="2" type="1"><li><strong>ç›´æ¥æŒ‡é’ˆè®¿é—®</strong></li></ol><p><code>reference</code>ç›´æ¥å­˜å‚¨å¯¹è±¡å®ä¾‹æ•°æ®çš„åœ°å€ï¼Œå¯¹è±¡å®ä¾‹æ•°æ®ä¸­ä¿å­˜äº†æŒ‡å‘ç±»å‹æ•°æ®çš„æŒ‡é’ˆã€‚</p><figure><img src="https://s21.ax1x.com/2025/05/31/pV9MbTK.png" alt="ç›´æ¥è®¿é—®" /><figcaption aria-hidden="true">ç›´æ¥è®¿é—®</figcaption></figure><p><code>reference</code>-&gt;å¯¹è±¡å®ä¾‹æ•°æ®-&gt;å¯¹è±¡ç±»å‹æ•°æ®ï¼Œè¿™ç§æ–¹å¼çš„è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚è¿™ä¹Ÿæ˜¯HotSpotä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚</p><p>æœ€åçœ‹çœ‹ Oracleæ˜¯å¦‚ä½•æè¿°å¯¹è±¡çš„å®šä½çš„<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.7">[2]</span></a></sup></p><div class="note note-success">            <p>Java è™šæ‹Ÿæœºå¹¶ä¸å¼ºåˆ¶è§„å®šå¯¹è±¡çš„å†…éƒ¨ç»“æ„å¿…é¡»æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><p>åœ¨ Oracle çš„ä¸€äº› Javaè™šæ‹Ÿæœºå®ç°ä¸­ï¼Œå¯¹ç±»å®ä¾‹çš„å¼•ç”¨å®é™…ä¸Šæ˜¯æŒ‡å‘ä¸€ä¸ªâ€œå¥æŸ„â€ï¼ˆhandleï¼‰çš„æŒ‡é’ˆã€‚è€Œè¿™ä¸ªå¥æŸ„æœ¬èº«æ˜¯ç”±ä¸€å¯¹æŒ‡é’ˆç»„æˆçš„ï¼š-ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªè¡¨ï¼Œè¯¥è¡¨åŒ…å«äº†è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘è¡¨ç¤ºè¯¥å¯¹è±¡ç±»å‹çš„Class å¯¹è±¡çš„æŒ‡é’ˆï¼› - å¦ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å †ä¸­ä¸ºè¯¥å¯¹è±¡æ•°æ®åˆ†é…çš„å†…å­˜ã€‚</p>          </div><p>å¥‡æ€ªçš„æ˜¯è¿™é‡Œæ²¡æœ‰æåˆ°HotSpoté‡‡ç”¨çš„æ–¹å¼ã€‚</p><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://www.cnblogs.com/jajian/p/13681781.html<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:2"class="footnote-text"><span>https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.7<a href="#fnref:2" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰‘æŒ‡offer-é¢˜ç›®é“¾æ¥+è§£æ</title>
    <link href="/2025/05/31/%E5%89%91%E6%8C%87offer%E5%8A%9B%E6%89%A3%E9%93%BE%E6%8E%A5%E5%90%88%E9%9B%86/"/>
    <url>/2025/05/31/%E5%89%91%E6%8C%87offer%E5%8A%9B%E6%89%A3%E9%93%BE%E6%8E%A5%E5%90%88%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<p><a href="/2025/06/07/å‰‘æŒ‡offer-é“¾è¡¨/">é“¾è¡¨</a></p><p><a href="/2025/06/03/å‰‘æŒ‡offer-å“ˆå¸Œè¡¨/">å“ˆå¸Œè¡¨</a></p><p><a href="/2025/05/23/å‰‘æŒ‡offer-æ ‘/">æ ‘&amp;å †</a></p><p><a href="/2025/05/31/å‰‘æŒ‡offer-æ ˆ/">æ ˆ</a></p><p><a href="/2025/06/01/å‰‘æŒ‡offer-é˜Ÿåˆ—/">é˜Ÿåˆ—</a></p><p><a href="/2025/06/14/å‰‘æŒ‡offer-æ’åº/">æ’åº</a></p><p><a href="/2025/06/19/å‰‘æŒ‡offer-å›æº¯/">å›æº¯</a></p><p><a href="/2025/07/14/å‰‘æŒ‡offer-åŠ¨æ€è§„åˆ’/">åŠ¨æ€è§„åˆ’</a></p>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®ç»“æ„ä¸ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMï¼šè¿è¡Œæ—¶æ•°æ®åŒºåŸŸç®€æ</title>
    <link href="/2025/05/31/JVM-2.2-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F/"/>
    <url>/2025/05/31/JVM-2.2-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F/</url>
    
    <content type="html"><![CDATA[<p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¯»ä¹¦ç¬”è®°(1)</p><span id="more"></span><h1 id="jvmè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ">JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h1><p><code>Run-Time Data Areas</code></p><figure><img src="https://s21.ax1x.com/2025/05/28/pVp3Xe1.png"alt="Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒº" /><figcaption aria-hidden="true">Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒº</figcaption></figure><h2 id="ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨</h2><p>å®˜æ–¹æ–‡æ¡£çš„è¡¨è¿°<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.1">[1]</span></a></sup>ï¼š</p><blockquote><p>Java è™šæ‹Ÿæœºå¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ªæ‰§è¡Œçº¿ç¨‹ã€‚æ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„pcï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰å¯„å­˜å™¨ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œæ¯ä¸ª Javaè™šæ‹Ÿæœºçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œå•ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå³è¯¥çº¿ç¨‹çš„å½“å‰æ–¹æ³•ã€‚å¦‚æœè¯¥æ–¹æ³•ä¸æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œåˆ™pc å¯„å­˜å™¨åŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„ Javaè™šæ‹ŸæœºæŒ‡ä»¤çš„åœ°å€ã€‚å¦‚æœçº¿ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œåˆ™ Java è™šæ‹Ÿæœºçš„ pcå¯„å­˜å™¨çš„å€¼æœªå®šä¹‰ã€‚</p></blockquote><ul><li>æ¦‚å¿µï¼šç¨‹åºè®¡æ•°å™¨ï¼ˆProgram CounterRegisterï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯<strong>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚</li><li>ä½œç”¨èŒƒå›´ï¼šçº¿ç¨‹ç§æœ‰<ul><li>åœ¨ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨åªä¼šå¤„ç†å¤šçº¿ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹çš„æŒ‡ä»¤ã€‚æ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œè¿™å—å†…å­˜åŒºåŸŸæ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜ã€‚</li></ul></li><li>ç¨‹åºè®¡æ•°å™¨é€‚ç”¨äºJavaæ–¹æ³•ï¼Œä¸é€‚ç”¨äºæœ¬åœ°æ–¹æ³•ã€‚è¿è¡ŒJavaæ–¹æ³•æ—¶ï¼Œå®ƒè®°å½•è™šæ‹Ÿæœºçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¯¹äºæœ¬åœ°æ–¹æ³•ï¼Œåˆ™ä¸ºç©ºã€‚</li></ul><h2 id="javaè™šæ‹Ÿæœºæ ˆ">Javaè™šæ‹Ÿæœºæ ˆ</h2><h3 id="å«ä¹‰">å«ä¹‰</h3><p>Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºä¹‹ä¸€ã€‚</p><ul><li>ä½œç”¨èŒƒå›´ï¼š<strong>çº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœºæ ˆ</strong>ã€‚è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨å°±æ˜¯ç”¨æ¥å­˜å‚¨ä¸<em>è¯¥çº¿ç¨‹çš„æ–¹æ³•è°ƒç”¨</em> å¯¹åº”çš„æ ˆå¸§ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸï¼šå½“çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæ–¹æ³•è°ƒç”¨ä¹Ÿå°±å…¨éƒ¨å®Œæˆäº†ï¼Œå¯¹åº”çš„ JVMæ ˆè‡ªç„¶å°±ä¸éœ€è¦äº†ï¼Œå¯ä»¥ç”± JVMè‡ªåŠ¨é‡Šæ”¾å›æ”¶ï¼Œå› æ­¤<strong>è™šæ‹Ÿæœºæ ˆå’Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒ</strong>ã€‚</li></ul><h3 id="æ ˆå¸§">æ ˆå¸§</h3><p><strong>æ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯</strong>ã€‚æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¸§ï¼ˆæ ˆå¸§å…¥è™šæ‹Ÿæœºæ ˆï¼‰ï¼›å½“è¯¥æ–¹æ³•è°ƒç”¨å®Œæˆæ—¶ï¼Œä¸è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯ç”±äºæŠ›å‡ºæœªæ•è·å¼‚å¸¸è€Œå¼‚å¸¸ç»ˆæ­¢ï¼Œå¯¹åº”çš„å¸§éƒ½ä¼šè¢«é”€æ¯ï¼ˆæ ˆå¸§å‡ºè™šæ‹Ÿæœºæ ˆï¼‰ã€‚å¯ä»¥è¿™æ ·è¯´ï¼Œæ ˆå¸§æ˜¯æ–¹æ³•è¿è¡Œæ—¶çš„å·¥ä½œå†…å­˜ã€‚</p><p><strong>å±€éƒ¨å˜é‡æ•°ç»„å’Œæ“ä½œæ•°æ ˆçš„å®¹é‡ï¼ˆæ§½ä½æ•°é‡ï¼‰æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œå¹¶ä¸è¯¥æ–¹æ³•çš„å­—èŠ‚ç ä¸€èµ·æä¾›ç»™å¸§</strong>ï¼ˆè¿™ä¸€ç‚¹é€šè¿‡åˆ†æåç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶å°±å¯ä»¥çœ‹å‡ºï¼Œåé¢ä¼šåˆ†æï¼‰ã€‚æ—¢ç„¶æ§½ä½æ•°é‡æ˜¯ç¡®å®šçš„ï¼Œé‚£ä¹ˆ<strong>å¸§çš„æ•°æ®ç»“æ„çš„å¤§å°ä»…å–å†³äºJavaè™šæ‹Ÿæœºçš„å®ç°æ–¹å¼</strong>ï¼ˆè­¬å¦‚æŒ‰ç…§1ä¸ªå˜é‡æ§½å ç”¨32ä¸ªæ¯”ç‰¹ã€64ä¸ªæ¯”ç‰¹ï¼Œæˆ–è€…æ›´å¤šï¼‰ï¼Œå…¶æ‰€éœ€çš„å†…å­˜å¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨æ—¶ä¸€å¹¶åˆ†é…ã€‚</p><p>Oracleæ–‡æ¡£çš„æè¿°ï¼š</p><blockquote><p>Each frame has its own array of local variables (Â§2.6.1), its ownoperand stack (Â§2.6.2), and a reference to the run-time constant pool(Â§2.5.5) of the class of the current method.</p><p>æ¯ä¸ªå¸§æ‹¥æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡æ•°ç»„ã€æ“ä½œæ•°æ ˆï¼Œä»¥åŠæŒ‡å‘å½“å‰æ–¹æ³•æ‰€åœ¨ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ã€‚</p></blockquote><p><strong>åœ¨ä¸€ä¸ªçº¿ç¨‹çš„æ§åˆ¶æµç¨‹ä¸­ï¼Œä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªå¸§æ˜¯æ´»åŠ¨çš„</strong>ï¼Œè¿™ä¸ªå¸§ç§°ä¸º<strong>å½“å‰å¸§</strong>ï¼ˆcurrentframeï¼‰ï¼Œå…¶å¯¹åº”çš„æ–¹æ³•ç§°ä¸º<strong>å½“å‰æ–¹æ³•</strong>ï¼ˆcurrentmethodï¼‰ï¼Œå®šä¹‰è¯¥æ–¹æ³•çš„ç±»ç§°ä¸º<strong>å½“å‰ç±»</strong>ï¼ˆcurrentclassï¼‰ã€‚å¯¹å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆçš„æ“ä½œé€šå¸¸éƒ½æ˜¯é’ˆå¯¹å½“å‰å¸§è¿›è¡Œçš„ã€‚</p><p>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å¦ä¸€ä¸ªæ–¹æ³•æˆ–è€…è¯¥æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæˆï¼Œå½“å‰å¸§å°±ä¸å†æ˜¯å½“å‰å¸§ã€‚å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¸§ï¼Œå¹¶åœ¨æ§åˆ¶è½¬ç§»åˆ°è¯¥æ–¹æ³•æ—¶æˆä¸ºå½“å‰å¸§ã€‚æ–¹æ³•è¿”å›æ—¶ï¼Œå½“å‰å¸§ä¼šå°†å…¶æ–¹æ³•è°ƒç”¨çš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰ä¼ å›ç»™å‰ä¸€ä¸ªå¸§ã€‚ç„¶åï¼Œå½“å‰å¸§å°†è¢«ä¸¢å¼ƒï¼Œè€Œå‰ä¸€ä¸ªå¸§å°†æˆä¸ºå½“å‰å¸§ï¼ˆè¿™å°±æ˜¯é€’å½’å˜›ï¼‰ã€‚</p><p><strong>ç”±çº¿ç¨‹åˆ›å»ºçš„å¸§æ˜¯è¯¥çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼•ç”¨ï¼</strong></p><h3 id="å±€éƒ¨å˜é‡è¡¨">å±€éƒ¨å˜é‡è¡¨</h3><h4 id="æ¦‚å†µ">æ¦‚å†µ</h4><p>å±€éƒ¨å˜é‡è¡¨å‚¨å­˜åœ¨æ ˆå¸§ä¸­ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨<strong>æ–¹æ³•å‚æ•°</strong>å’Œ<strong>å®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡</strong>ã€‚</p><p>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§Javaè™šæ‹ŸæœºåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆå¯èƒ½æ˜¯é€šè¿‡å¥æŸ„å¼•ç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡é’ˆç›´æ¥å¼•ç”¨ï¼‰ã€<code>returnAddress</code>ç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚æ­£æ˜¯å› ä¸ºå®ƒæ‰€å­˜å‚¨çš„ä¸œè¥¿éƒ½æ˜¯ç¼–è¯‘çš„æ—¶å€™å°±å¯çŸ¥çš„ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨çš„åˆ†é…æ˜¯åœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼ˆå³åˆ›å»ºæ ˆå¸§æ—¶ï¼‰å°±å®Œæˆçš„ã€‚</p><blockquote><p><code>returnAddress</code>ç±»å‹ç”¨äº Java è™šæ‹Ÿæœºçš„ jsrã€ret å’Œ jsr_wæŒ‡ä»¤ã€‚<code>returnAddress</code>ç±»å‹çš„å€¼æ˜¯æŒ‡å‘ Javaè™šæ‹ŸæœºæŒ‡ä»¤æ“ä½œç çš„æŒ‡é’ˆã€‚ä¸æ•°å€¼å‹çš„åŸºæœ¬ç±»å‹ä¸åŒï¼Œ<code>returnAddress</code>ç±»å‹ä¸å¯¹åº”äºä»»ä½•Javaç¼–ç¨‹è¯­è¨€ä¸­çš„ç±»å‹ï¼Œå¹¶ä¸”æ— æ³•è¢«è¿è¡Œä¸­çš„ç¨‹åºä¿®æ”¹ã€‚<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.3">[2]</span></a></sup></p></blockquote><h4 id="å ç”¨ç©ºé—´">å ç”¨ç©ºé—´</h4><p>å•ä¸ªå±€éƒ¨å˜é‡å¯ä»¥ä¿å­˜ä¸€ä¸ªç±»å‹ä¸º<code>boolean</code> <code>byte</code><code>char</code> <code>short</code> <code>int</code> <code>float</code><code>reference</code>æˆ–<code>returnAdress</code>çš„å€¼ã€‚è‡³äº<code>long</code>ã€<code>double</code>éƒ½éœ€è¦ä¸€å¯¹å±€éƒ¨å˜é‡æ‰èƒ½å‚¨å­˜ã€‚</p><p>å±€éƒ¨å˜é‡è¡¨æœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯Slotï¼ˆå˜é‡æ§½ï¼‰ï¼Œä¸€ä¸ªå±€éƒ¨å˜é‡å¯¹åº”ä¸€ä¸ªæ§½ä½ã€‚ä¸€äº›æ•°æ®ç±»å‹å ç”¨çš„æ§½ä½æ•°å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å ç”¨æ§½ä½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>int</code></td><td>1</td><td>åŸºæœ¬ç±»å‹</td></tr><tr><td><code>float</code></td><td>1</td><td>åŸºæœ¬ç±»å‹</td></tr><tr><td><code>reference</code></td><td>1</td><td>å¯¹è±¡å¼•ç”¨ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰</td></tr><tr><td><code>returnAddress</code></td><td>1</td><td>æŸäº›è·³è½¬æŒ‡ä»¤çš„è¿”å›åœ°å€ï¼ˆå°‘è§ï¼‰</td></tr><tr><td><code>long</code></td><td>2</td><td>64 ä½ï¼Œéœ€è¦ä¸¤ä¸ªæ§½ä½</td></tr><tr><td><code>double</code></td><td>2</td><td>64 ä½ï¼Œéœ€è¦ä¸¤ä¸ªæ§½ä½</td></tr></tbody></table><h4 id="å¯»å€">å¯»å€</h4><p><strong>å±€éƒ¨å˜é‡é€šè¿‡ç´¢å¼•æ¥å¯»å€</strong>ã€‚ç¬¬ä¸€ä¸ªå±€éƒ¨å˜é‡çš„ç´¢å¼•ä¸ºé›¶ã€‚å½“ä¸”ä»…å½“ä¸€ä¸ªæ•´æ•°ä»‹äºé›¶åˆ°æ¯”å±€éƒ¨å˜é‡æ•°ç»„çš„å¤§å°å°ä¸€ä¹‹é—´æ—¶ï¼Œè¯¥æ•´æ•°æ‰è¢«è§†ä¸ºå±€éƒ¨å˜é‡æ•°ç»„çš„ç´¢å¼•ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç±»å‹ä¸º<code>long</code>æˆ–<code>double</code>çš„å€¼ä¼š<strong>å ç”¨ä¸¤ä¸ªè¿ç»­çš„å±€éƒ¨å˜é‡æ§½ä½</strong>ï¼Œ<strong>åªèƒ½é€šè¿‡è¾ƒå°çš„ç´¢å¼•æ¥è®¿é—®</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç±»å‹ä¸º<code>double</code>çš„å€¼å¦‚æœå­˜å‚¨åœ¨ç´¢å¼•ä¸º<code>n</code>çš„å±€éƒ¨å˜é‡æ•°ç»„ä¸­ï¼Œå®ƒå®é™…ä¸Šä¼šå ç”¨ç´¢å¼•ä¸º<code>n</code>å’Œ<code>n+1</code>çš„ä¸¤ä¸ªå±€éƒ¨å˜é‡æ§½ã€‚ä½†ä½ ä¸èƒ½ä»ç´¢å¼•ä¸º<code>n+1</code>çš„æ§½ä¸­åŠ è½½è¯¥å€¼ã€‚ä½ å¯ä»¥å‘ç´¢å¼•ä¸º<code>n+1</code>çš„æ§½å†™å…¥æ•°æ®ï¼Œä½†è¿™æ ·åšä¼šä½¿ç´¢å¼•ä¸º<code>n</code>ä¸­çš„åŸå§‹æ•°æ®å¤±æ•ˆã€‚</p><h4 id="å±€éƒ¨å˜é‡ä¼ é€’æ–¹æ³•å‚æ•°">å±€éƒ¨å˜é‡ä¼ é€’æ–¹æ³•å‚æ•°</h4><p>Java è™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡æ¥ä¼ é€’æ–¹æ³•è°ƒç”¨æ—¶çš„å‚æ•°ï¼š</p><ol type="1"><li>å¯¹äº<strong>ç±»æ–¹æ³•</strong>ï¼ˆå³<code>static</code>æ–¹æ³•ï¼‰çš„è°ƒç”¨ï¼Œæ‰€æœ‰å‚æ•°ä»å±€éƒ¨å˜é‡æ§½0 å¼€å§‹ï¼Œä¾æ¬¡æŒ‰é¡ºåºå­˜æ”¾åœ¨è¿ç»­çš„å±€éƒ¨å˜é‡ä¸­ã€‚</li><li>å¯¹äº<strong>å®ä¾‹æ–¹æ³•</strong>ï¼ˆå³é<code>static</code>æ–¹æ³•ï¼‰çš„è°ƒç”¨ï¼Œå±€éƒ¨å˜é‡æ§½0 æ€»æ˜¯ç”¨äºå­˜æ”¾å¯¹<strong>å½“å‰å¯¹è±¡çš„å¼•ç”¨</strong>ï¼ˆå³ Javaç¼–ç¨‹è¯­è¨€ä¸­çš„<code>this</code>å…³é”®å­—ï¼‰ã€‚ä¹‹åçš„æ–¹æ³•å‚æ•°ä»å±€éƒ¨å˜é‡æ§½ 1å¼€å§‹ï¼Œä¾æ¬¡å­˜æ”¾åœ¨è¿ç»­çš„å±€éƒ¨å˜é‡ä¸­ã€‚</li></ol><h3 id="æ“ä½œæ•°æ ˆ">æ“ä½œæ•°æ ˆ</h3><p><code>Operand Stacks</code></p><p>æ“ä½œæ•°æ ˆæ˜¯æ ˆå¸§ä¸­çš„å¦ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚å±€éƒ¨å˜é‡å­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼Œè€Œæ“ä½œæ•°æ ˆç”¨äº<strong>ä¸´æ—¶ä¿å­˜ä¸­é—´è¿ç®—æ•°æ®</strong>ã€‚æ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨æ˜¯é…åˆä½¿ç”¨çš„ã€‚</p><p>æ“ä½œæ•°æ ˆä¸­çš„æ¯ä¸ªæ¡ç›®(Entry)å¯ä»¥ä¿å­˜ä»»æ„ä¸€ç§ Javaè™šæ‹Ÿæœºç±»å‹çš„å€¼ï¼ŒåŒ…æ‹¬<code>long</code>æˆ–<code>double</code>ç±»å‹ï¼Œè™½ç„¶å®ƒä»¬å ç”¨ä¸¤ä¸ªå·¨å˜å˜é‡æ§½ï¼Œä½†æ˜¯åœ¨æ“ä½œæ•°æ ˆä¸­æ˜¯ä½œä¸ºä¸€ä¸ªå•å…ƒè¢«çœ‹å¾…çš„ã€‚æ“ä½œæ•°æ ˆæœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ€»æ·±åº¦ï¼Œ<code>long</code>æˆ–<code>double</code>ä¸ºå…¶è´¡çŒ®ä¸¤ä¸ªæ·±åº¦ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä¸€ä¸ªã€‚</p><p>JVMæ˜¯ä¸€ä¸ª<strong>å¼ºç±»å‹</strong>çš„è™šæ‹Ÿæœºï¼Œæ“ä½œæ•°æ ˆä¸­çš„å€¼å¿…é¡»ç”¨<strong>ä¸ä¹‹ç›¸ç¬¦</strong>çš„æŒ‡ä»¤è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼Œä¸èƒ½å°†ä¸¤ä¸ª<code>int</code>å€¼å‹å…¥æ ˆä¸­ï¼Œç„¶åè¯•å›¾æŠŠå®ƒä»¬å½“ä½œä¸€ä¸ª<code>long</code>å€¼æ¥å¤„ç†ï¼›ä¹Ÿä¸èƒ½å°†ä¸¤ä¸ª<code>float</code>å€¼å‹å…¥æ ˆåï¼Œä½¿ç”¨<code>iadd</code>æŒ‡ä»¤æ¥æ‰§è¡ŒåŠ æ³•ã€‚ç¼–è¯‘å™¨å’ŒJVM ä¼šé€šè¿‡å­—èŠ‚ç éªŒè¯æœºåˆ¶ï¼ˆclass fileverificationï¼‰ï¼Œç¡®ä¿æ‰€æœ‰æ ˆæ“ä½œéƒ½ç±»å‹æ­£ç¡®ã€‚å¦åˆ™ä¼šæŠ›å‡ºéªŒè¯é”™è¯¯ï¼Œç¨‹åºæ ¹æœ¬æ— æ³•è¿è¡Œã€‚</p><p>ä¸ºäº†è¯´æ˜æ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨çš„é…åˆè¿‡ç¨‹ï¼Œçœ‹ä¸‹é¢çš„æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">test1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a * b;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨IDEAå¯ä»¥æŸ¥çœ‹<code>main</code>æ–¹æ³•çš„å­—èŠ‚ç ï¼ˆå‰é¢çš„ç±»å®šä¹‰éƒ¨åˆ†å’Œæ„é€ å‡½æ•°å·²å¿½ç•¥ï¼‰</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">public</span> static main([Ljava/lang/String;)V<br>   <span class="hljs-attribute">L0</span><br>    <span class="hljs-attribute">LINENUMBER</span> <span class="hljs-number">10</span> L0<br>    <span class="hljs-attribute">BIPUSH</span> <span class="hljs-number">6</span><br>    <span class="hljs-attribute">ISTORE</span> <span class="hljs-number">1</span><br>   <span class="hljs-attribute">L1</span><br>    <span class="hljs-attribute">LINENUMBER</span> <span class="hljs-number">11</span> L1<br>    <span class="hljs-attribute">BIPUSH</span> <span class="hljs-number">9</span><br>    <span class="hljs-attribute">ISTORE</span> <span class="hljs-number">2</span><br>   <span class="hljs-attribute">L2</span><br>    <span class="hljs-attribute">LINENUMBER</span> <span class="hljs-number">12</span> L2<br>    <span class="hljs-attribute">ILOAD</span> <span class="hljs-number">1</span><br>    <span class="hljs-attribute">ILOAD</span> <span class="hljs-number">2</span><br>    <span class="hljs-attribute">IMUL</span><br>    <span class="hljs-attribute">ISTORE</span> <span class="hljs-number">3</span><br>   <span class="hljs-attribute">L3</span><br>    <span class="hljs-attribute">LINENUMBER</span> <span class="hljs-number">13</span> L3<br>    <span class="hljs-attribute">RETURN</span><br>   <span class="hljs-attribute">L4</span><br>    <span class="hljs-attribute">LOCALVARIABLE</span> args<span class="hljs-meta"> [Ljava/lang/String; L0 L4 0</span><br><span class="hljs-meta">    LOCALVARIABLE a I L1 L4 1</span><br><span class="hljs-meta">    LOCALVARIABLE b I L2 L4 2</span><br><span class="hljs-meta">    LOCALVARIABLE c I L3 L4 3</span><br><span class="hljs-meta">    MAXSTACK = 2</span><br><span class="hljs-meta">    MAXLOCALS = 4</span><br><span class="hljs-meta">&#125; </span><br></code></pre></td></tr></table></figure><p><code>L0</code>~<code>L4</code>éƒ½ä»£è¡¨ç”Ÿå‘½å‘¨æœŸã€‚é€ä¸€æŸ¥çœ‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">L0</span><br>  <span class="hljs-attribute">BIPUSH</span> <span class="hljs-number">6</span><br>  <span class="hljs-attribute">ISTORE</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ul><li><code>BIPUSH 6</code>: å°†æ•°å­—å¸¸é‡ 6 å‹å…¥æ“ä½œæ•°æ ˆ</li><li><code>ISTORE 1</code>: å°†æ“ä½œæ•°æ ˆçš„æ ˆé¡¶æ•´æ•°å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ index 1ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯<code>a</code>ï¼‰</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">L1</span><br>  <span class="hljs-attribute">BIPUSH</span> <span class="hljs-number">9</span><br>  <span class="hljs-attribute">ISTORE</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><ul><li><code>BIPUSH 6</code>: å°†æ•°å­—å¸¸é‡ 9 å‹å…¥æ“ä½œæ•°æ ˆ</li><li><code>ISTORE 2</code>: å°†æ“ä½œæ•°æ ˆçš„æ ˆé¡¶æ•´æ•°å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ index 2ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯<code>b</code>ï¼‰</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">L2</span><br>  <span class="hljs-attribute">ILOAD</span> <span class="hljs-number">1</span><br>  <span class="hljs-attribute">ILOAD</span> <span class="hljs-number">2</span><br>  <span class="hljs-attribute">IMUL</span><br>  <span class="hljs-attribute">ISTORE</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><ul><li><code>ILOAD 1</code>ï¼šä»å±€éƒ¨å˜é‡è¡¨ä¸­åŠ è½½ aï¼ˆindex 1ï¼‰</li><li><code>ILOAD 2</code>ï¼šåŠ è½½ bï¼ˆindex 2ï¼‰</li><li><code>IMUL</code>ï¼šæ‰§è¡Œæ•´æ•°ç›¸ä¹˜ï¼Œè¿™æ—¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ç»“æœ</li><li><code>ISTORE 3</code>ï¼šå°†ç»“æœå­˜å…¥ index 3ï¼ˆå³ cï¼‰</li></ul><p><code>RETURN</code>: æ–¹æ³•è¿”å›ï¼ˆ<code>void</code>ï¼‰</p><p>æœ€åæ˜¯å±€éƒ¨å˜é‡è¡¨ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">LOCALVARIABLE</span> <span class="hljs-variable">args</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Ljava</span><span class="hljs-operator">/</span><span class="hljs-variable">lang</span><span class="hljs-operator">/</span><span class="hljs-built_in">String</span><span class="hljs-operator">;</span> <span class="hljs-variable">L0</span> <span class="hljs-variable">L4</span> <span class="hljs-number">0</span><br><span class="hljs-variable">LOCALVARIABLE</span> <span class="hljs-variable">a</span> <span class="hljs-built_in">I</span> <span class="hljs-variable">L1</span> <span class="hljs-variable">L4</span> <span class="hljs-number">1</span><br><span class="hljs-variable">LOCALVARIABLE</span> <span class="hljs-variable">b</span> <span class="hljs-built_in">I</span> <span class="hljs-variable">L2</span> <span class="hljs-variable">L4</span> <span class="hljs-number">2</span><br><span class="hljs-variable">LOCALVARIABLE</span> <span class="hljs-variable">c</span> <span class="hljs-built_in">I</span> <span class="hljs-variable">L3</span> <span class="hljs-variable">L4</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>ç”Ÿå‘½å‘¨æœŸèŒƒå›´</th><th>æ§½ä½ index</th></tr></thead><tbody><tr><td><code>args</code></td><td><code>String[]</code></td><td>L0 åˆ° L4</td><td>0</td></tr><tr><td><code>a</code></td><td><code>int</code></td><td>L1 åˆ° L4</td><td>1</td></tr><tr><td><code>b</code></td><td><code>int</code></td><td>L2 åˆ° L4</td><td>2</td></tr><tr><td><code>c</code></td><td><code>int</code></td><td>L3 åˆ° L4</td><td>3</td></tr></tbody></table><p>æœ€åçš„<code>MAXSTACK = 2 MAXLOCALS = 4</code>åˆ†åˆ«æŒ‡å®š<strong>æ“ä½œæ•°æ ˆçš„æœ€å¤§æ ˆæ·±åº¦</strong>å’Œ<strong>å±€éƒ¨å˜é‡æ§½çš„æ§½ä½æ•°é‡</strong>ã€‚å¯è§ï¼Œå±€éƒ¨å˜é‡æ•°ç»„å’Œæ“ä½œæ•°æ ˆçš„å¤§å°åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®è®¤ä¸‹æ¥äº†ï¼Œè¿™ä¹Ÿå°è¯äº†å‰é¢çš„è¡¨è¿°ã€‚</p><h4 id="åŠ¨æ€é“¾æ¥">åŠ¨æ€é“¾æ¥</h4><p><code>Dynamic Linking</code></p><p>å‰é¢æåˆ°ï¼Œæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ï¼Œç°åœ¨æ¥è¯´è¯´åŠ¨æ€é“¾æ¥æ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚</p><p>åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œæ–¹æ³•çš„å­—èŠ‚ç é€šè¿‡<strong>ç¬¦å·å¼•ç”¨</strong>ï¼ˆsymbolicreferencesï¼‰æ¥å¼•ç”¨è¦è°ƒç”¨çš„æ–¹æ³•æˆ–è®¿é—®çš„å˜é‡ï¼Œè¿™æ—¶çš„æ–¹æ³•è¿˜ä¸çŸ¥é“è¦è°ƒç”¨æ–¹æ³•å’Œå˜é‡çš„åœ°å€åˆ°åº•åœ¨å“ªé‡Œï¼Œåªæ˜¯æ‹¿åˆ°äº†å‡ ä¸ªæŠ½è±¡çš„ç¬¦å·ã€‚</p><p><strong>åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€é“¾æ¥æœºåˆ¶ä¼šæ ¹æ®éœ€è¦æŠŠç¬¦å·å¼•ç”¨è§£æä¸ºå®é™…çš„å†…å­˜åœ°å€</strong>ï¼Œå…·ä½“æ¥è¯´ï¼š</p><ul><li>æ–¹æ³•è°ƒç”¨çš„ç¬¦å·å¼•ç”¨ä¼šè¢«è§£æä¸ºå®é™…çš„æ–¹æ³•åœ°å€ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œç±»çš„åŠ è½½ï¼Œç¡®ä¿æ‰€æœ‰è¿˜æ²¡è§£æçš„ç¬¦å·éƒ½è¢«è§£æå®Œæ¯•ï¼›</li><li>å˜é‡çš„ç¬¦å·å¼•ç”¨ä¼šè¢«è§£æä¸ºä»å¯¹è±¡æˆ–è€…ç±»ç»“æ„çš„èµ·å§‹åœ°å€ç®—èµ·çš„åœ°å€åç§»é‡ã€‚</li></ul><hr /><p>æ€»è€Œè¨€ä¹‹ï¼Œâ€œåŠ¨æ€é“¾æ¥â€çš„å…³é”®å°±åœ¨äºâ€œåŠ¨æ€â€å’Œâ€œé“¾æ¥â€ï¼š</p><ul><li>å½“æ–¹æ³•è°ƒç”¨ã€å­—æ®µè®¿é—®ç­‰å­—èŠ‚ç æŒ‡ä»¤é¦–æ¬¡æ‰§è¡Œæ—¶ï¼ŒJVMæ ¹æ®éœ€è¦åŠ¨æ€åœ°æŠŠéœ€è¦è§£æçš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºå®é™…åœ°å€ï¼›</li><li>é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯æŠŠç¬¦å·å¼•ç”¨å’Œå¯¹åº”çš„å†…å­˜åœ°å€è¿æ¥èµ·æ¥çš„è¿‡ç¨‹ã€‚</li></ul><p>æ³¨æ„ï¼Œå±€éƒ¨å˜é‡è¡¨çš„åˆ†é…åœ¨åŠ¨æ€é“¾æ¥ä¹‹å‰ï¼Œå³ä½¿æŸä¸ªå­—æ®µè¿˜æ²¡è§£æå‡ºæ¥ï¼Œå±€éƒ¨å˜é‡è¡¨ä¹Ÿç…§æ ·åˆ†é…å¥½äº†ï¼Œåªæ˜¯ç­‰çœŸæ­£æ‰§è¡Œè®¿é—®æŸä¸ªæ–¹æ³•æˆ–å­—æ®µæ—¶ï¼Œæ‰è§¦å‘åŠ¨æ€é“¾æ¥ã€‚</p><hr /><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒåŠ¨æ€é“¾æ¥æ˜¯æ€ä¹ˆçŸ¥é“æŸä¸ªç¬¦å·å¼•ç”¨çš„å®é™…åœ°å€æ˜¯åœ¨å“ªé‡Œçš„ï¼Ÿè¿™æ˜¯å› ä¸ºæ¯ä¸ªæ ˆå¸§åŒ…å«å¯¹å½“å‰æ–¹æ³•çš„ç±»å‹çš„<em>è¿è¡Œæ—¶å¸¸é‡æ± </em>çš„å¼•ç”¨ï¼Œè€Œè¿è¡Œæ—¶å¸¸é‡æ± é™¤äº†ä¿å­˜Classæ–‡ä»¶ä¸­æè¿°çš„ç¬¦å·å¼•ç”¨å¤–ï¼Œè¿˜ä¼šæŠŠç”±ç¬¦å·å¼•ç”¨ç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¹Ÿå­˜å‚¨åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚æ‰€ä»¥è¯´åŠ¨æ€é“¾æ¥çš„å®ç°æ˜¯ä¾é è¿è¡Œæ—¶å¸¸é‡æ± çš„ã€‚</p><p>è¿™ç§åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šæ–¹æ³•å’Œå˜é‡çš„å®é™…åœ°å€çš„æœºåˆ¶è¢«ç§°ä¸º<strong>å»¶è¿Ÿç»‘å®šæœºåˆ¶</strong>ã€‚</p><h3 id="å¼‚å¸¸">å¼‚å¸¸</h3><p>åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­ï¼Œå¯¹è¿™ä¸ªå†…å­˜åŒºåŸŸè§„å®šäº†ä¸¤ç±»å¼‚å¸¸çŠ¶å†µï¼š</p><ol type="1"><li>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸ï¼›</li><li>å¦‚æœJavaè™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“æ ˆæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</li></ol><p>æ‰€è°“â€œè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦â€ï¼ŒæŒ‡çš„æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å¯å®¹çº³çš„æ ˆå¸§çš„æ·±åº¦ã€‚å› ä¸ºæ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šå‹å…¥ä¸€ä¸ªæ ˆå¸§ï¼Œæ‰€ä»¥æ„æ€å°±æ˜¯è°ƒç”¨çš„æ–¹æ³•æœ€å¤šèƒ½åµŒå¥—å¤šå°‘å±‚ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">test1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recurse</span><span class="hljs-params">()</span> &#123;<br>        recurse();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        recurse();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>mainæ–¹æ³•è°ƒç”¨äº†<code>recurse</code>ï¼Œ<code>recurse</code>ç»§ç»­è°ƒç”¨å®ƒæœ¬èº«ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å°±å‹å…¥ä¸€ä¸ªæ ˆå¸§ã€‚ç”±äºæ²¡æœ‰è®¾å®šç»ˆæ­¢æ¡ä»¶ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºæ ˆå¾ˆå¿«å°±ä¼šæº¢å‡ºã€‚è¿è¡ŒæŠ¥å¼‚å¸¸ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.StackOverflowError</span><br>at JVMtest<span class="hljs-selector-class">.test1</span><span class="hljs-selector-class">.recurse</span>(test1<span class="hljs-selector-class">.java</span>:<span class="hljs-number">10</span>)<br>at JVMtest<span class="hljs-selector-class">.test1</span><span class="hljs-selector-class">.recurse</span>(test1<span class="hljs-selector-class">.java</span>:<span class="hljs-number">10</span>)<br>        ...<br></code></pre></td></tr></table></figure><p>è‡³äºç¬¬äºŒç§å¼‚å¸¸ï¼Œå› ä¸ºHotSpotè™šæ‹Ÿæœºçš„æ ˆå®¹é‡æ˜¯ä¸å¯ä»¥åŠ¨æ€æ‰©å±•çš„ï¼Œæ‰€ä»¥åªè¦çº¿ç¨‹ç”³è¯·æ ˆç©ºé—´æˆåŠŸäº†å°±ä¸ä¼šæœ‰OOMã€‚</p><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„æœ¬åœ°ï¼ˆNativeï¼‰æ–¹æ³•æœåŠ¡ã€‚</p><p>å¯¹åº”åˆ°jdkæºç ä¸­ï¼Œç”±<code>native</code>ä¿®é¥°çš„æ–¹æ³•éƒ½æ˜¯æœ¬åœ°æ–¹æ³•ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">currentTimeMillis</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>åœ¨ HotSpot ä¸­æ˜¯ä½¿ç”¨ C++ å®ç°çš„ã€‚</p><p>æœ¬åœ°æ–¹æ³•æ ˆçš„å¼‚å¸¸å’Œè™šæ‹Ÿæœºæ ˆç›¸åŒã€‚</p><p>Javaè™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰è§„å®šæœ¬åœ°æ–¹æ³•æ ˆå…·ä½“çš„å®ç°å½¢å¼ï¼ŒHotSpotç›´æ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€äº†ã€‚</p><h2 id="javaå †">Javaå †</h2><h3 id="å«ä¹‰-1">å«ä¹‰</h3><p>é¦–å…ˆéœ€è¦æ¾„æ¸…ï¼šå†…å­˜ä¸­çš„å †çš„å’Œæ•°æ®ç»“æ„ä¸­çš„å †å®Œå…¨æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œäº‹å®ä¸Šå†…å­˜ä¸­çš„å †æ˜¯ç”¨æ¥<strong>å­˜å‚¨å¯¹è±¡å®ä¾‹</strong>çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œæ•°æ®ç»“æ„çš„å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘å½¢ç»“æ„ï¼ŒäºŒè€…æ²¡æœ‰ä»»ä½•ç›´æ¥å…³ç³»ã€‚</p><p><strong>Javaå †ï¼ˆJavaHeapï¼‰æ˜¯è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œç”±GC è‡ªåŠ¨ç®¡ç†</strong>ã€‚</p><ul><li>ä½œç”¨ï¼šJavaå †çš„å”¯ä¸€ç›®çš„å°±æ˜¯<strong>å­˜æ”¾å¯¹è±¡å®ä¾‹</strong>ï¼ˆInstanceï¼‰ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡çš„å®ä¾‹ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚ç›´ç™½ç‚¹è¯´ï¼Œæ‰€æœ‰<code>new</code>å‡ºæ¥çš„å¯¹è±¡éƒ½æ˜¯åœ¨è¿™é‡Œåˆ†é…å†…å­˜çš„ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸï¼šJavaå †çš„ç”Ÿå‘½å‘¨æœŸç”±ç¨‹åºæ§åˆ¶æˆ–åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰æ§åˆ¶.</li><li>Javaå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯åœ¨é€»è¾‘ä¸Šå¿…é¡»è¿ç»­ã€‚å¯¹äºå¤§çš„å¯¹è±¡ï¼Œè¿ç»­çš„å†…å­˜ç©ºé—´å¯ä»¥æé«˜è®¿é—®é€Ÿåº¦ã€‚</li></ul><h3 id="å¼‚å¸¸-1">å¼‚å¸¸</h3><p><code>OutOfMemoryError</code></p><p>å †ç›¸å…³çš„å¼‚å¸¸ä¸»è¦å°±æ˜¯å†…å­˜ä¸å¤Ÿç”¨çš„é—®é¢˜ã€‚å½“å‰ä¸»æµçš„Javaè™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‰©å±•å †å†…å­˜æ¥å®ç°çš„ï¼ˆé€šè¿‡å‚æ•°-Xmxå’Œ-Xmsè®¾å®šï¼‰ï¼š</p><p><code>-Xmx</code>è®¾ç½®åˆå§‹å †å†…å­˜å¤§å°ï¼Œ<code>-Xms</code>è®¾ç½®æœ€å¤§å †å†…å­˜å¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹JVMä¼šä»è¾ƒå°çš„å †å®¹é‡å¼€å§‹è¿è¡Œã€‚å¦‚æœæ‰‹åŠ¨è®¾ç½®<code>-Xmx = -Xms</code>ï¼Œå¯ä»¥é¿å…åŠ¨æ€æ‰©å®¹é€ æˆçš„å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚</p><p>JVMåœ¨å¯åŠ¨æ—¶ä¼šåˆ†é…ä¸€å®šå¤§å°çš„å †ã€‚åœ¨<code>new</code>ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒJVMä¼šåšå¦‚ä¸‹æ£€æŸ¥ï¼š</p><ul><li>Javaå †æ˜¯å¦è¿˜æœ‰å¯ç”¨çš„ç©ºé—´ï¼Ÿ<ul><li>æœ‰åˆ™ç›´æ¥åˆ†é…</li><li>æ²¡æœ‰ï¼Œåˆ™å°è¯•é€šè¿‡åƒåœ¾åˆ†é…æœºåˆ¶å›æ”¶å‡ºç©ºé—´</li><li>å¦‚æœå›æ”¶åè¿˜æ˜¯ä¸å¤Ÿç”¨ï¼ŒJVMä¼šå°è¯•æ‹“å±•å †ï¼ˆå…è®¸çš„è¯ï¼‰</li><li>å¦‚æœå †å·²ç»è¾¾åˆ°ä¸Šé™ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼š<code>OutOfMemoryError</code></li></ul></li></ul><h2 id="æ–¹æ³•åŒº">æ–¹æ³•åŒº</h2><figure><img src="https://s21.ax1x.com/2025/05/30/pVpxvHx.png"alt="æ–¹æ³•åŒºç¤ºæ„å›¾" /><figcaption aria-hidden="true">æ–¹æ³•åŒºç¤ºæ„å›¾</figcaption></figure><h3 id="å«ä¹‰-2">å«ä¹‰</h3><p><code>Method Area</code></p><p>è¿è¡Œæ—¶æ•°æ®åŒºæœ‰ä¸¤ä¸ªå¤šçº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œä¸€ä¸ªæ˜¯Javaå †ï¼Œå¦ä¸€ä¸ªå°±æ˜¯æ–¹æ³•åŒºã€‚</p><p>Oracle <ahref="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4">å®˜æ–¹æ–‡æ¡£</a>æ˜¯è¿™æ ·æè¿°æ–¹æ³•åŒºçš„ï¼š</p><blockquote><p>æ–¹æ³•åŒºç±»ä¼¼äºä¼ ç»Ÿè¯­è¨€ä¸­ç¼–è¯‘ä»£ç çš„å­˜å‚¨åŒºåŸŸï¼Œæˆ–è€…ç±»ä¼¼äºæ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­çš„<code>text</code>æ®µã€‚å®ƒå­˜å‚¨æ¯ä¸ªç±»çš„ç»“æ„ï¼Œä¾‹å¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ï¼Œä»¥åŠæ–¹æ³•å’Œæ„é€ å‡½æ•°çš„ä»£ç ï¼ŒåŒ…æ‹¬ç±»å’Œå®ä¾‹åˆå§‹åŒ–ä»¥åŠæ¥å£åˆå§‹åŒ–ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ–¹æ³•ã€‚</p></blockquote><ul><li>ä½œç”¨ï¼šç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸï¼šæ–¹æ³•åŒºåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå…³é—­æ—¶é‡Šæ”¾</li><li>Javaè™šæ‹Ÿæœºè§„èŒƒæ—¢ä¸å¼ºåˆ¶è¦æ±‚æ–¹æ³•åŒºçš„ä½ç½®ã€ç®¡ç†ç¼–è¯‘åçš„æœºå™¨ä»£ç (compiledcode)çš„ä½ç½®ï¼Œä¹Ÿä¸è¦æ±‚æ–¹æ³•åŒºçš„å¤§å°æ˜¯å¦å›ºå®šï¼Œæ—¢å¯ä»¥æ˜¯å›ºå®šå¤§å°ï¼Œä¹Ÿå¯ä»¥æ‰©å±•æˆ–è€…æ”¶ç¼©ã€‚</li><li>æ–¹æ³•åŒºçš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</li><li>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†è¡Œä¸ºæ¯”è¾ƒå°‘è§ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ã€‚</li></ul><h3 id="hotspotæ–¹æ³•åŒºçš„æ¼”è¿›">HotSpotæ–¹æ³•åŒºçš„æ¼”è¿›</h3><p>JDK8 ä¹‹å‰ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºï¼Œè¿™æ ·ä½¿å¾— HotSpotçš„åƒåœ¾æ”¶é›†å™¨èƒ½å¤Ÿåƒç®¡ç†Javaå †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜ï¼Œçœå»ä¸“é—¨ä¸ºæ–¹æ³•åŒºç¼–å†™å†…å­˜ç®¡ç†ä»£ç çš„å·¥ä½œã€‚ä½†æ˜¯è¿™ç§è®¾è®¡ä¹Ÿå¯¼è‡´äº†Javaåº”ç”¨æ›´å®¹æ˜“é‡åˆ°å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</p><p>åœ¨Java 8ä»¥åï¼Œæ°¸ä¹…ä»£è¢«<strong>å…ƒç©ºé—´</strong>(Metaspace)å…ƒç©ºé—´ä¹Ÿä¸å±äº Javaå †ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜åˆ†é…ï¼Œå³åœ¨æ“ä½œç³»ç»Ÿçš„å†…å­˜ä¸­å¼€è¾ŸåŒºåŸŸã€‚</p><h3 id="å¼‚å¸¸-2">å¼‚å¸¸</h3><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„è§„å®šï¼Œå¦‚æœæ–¹æ³•åŒºæ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± ">è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime ConstantPoolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯ä»æ–¹æ³•åŒºåˆ†é…å†…å­˜çš„ã€‚</p><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ¯ä¸ªç±»æˆ–æ¥å£åœ¨è¿è¡Œæ—¶å¯¹ classæ–‡ä»¶ä¸­<code>constant_pool</code>è¡¨ï¼ˆå¸¸é‡æ± è¡¨ï¼‰çš„ä¸€ç§å®ç°å½¢å¼ã€‚å­—èŠ‚ç ä¸­çš„<code>constant_pool</code>è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ï¼Œç±»åŠ è½½ä»¥åè¿™äº›ä¿¡æ¯è¢«å­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒé™¤äº†ä¿å­˜Classæ–‡ä»¶ä¸­æè¿°çš„<strong>ç¬¦å·å¼•ç”¨</strong>å¤–ï¼Œè¿˜ä¼šæŠŠç”±ç¬¦å·å¼•ç”¨ç¿»è¯‘å‡ºæ¥çš„<strong>ç›´æ¥å¼•ç”¨</strong>ä¹Ÿå­˜å‚¨åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œè¿è¡Œæ—¶JVMä¼šæŠŠclassæ–‡ä»¶ä¸­é¢„ç½®çš„ <em>å¸¸é‡æ± è¡¨</em> åŠ è½½ä¸º<em>è¿è¡Œæ—¶å¸¸é‡æ± </em> ã€‚ç›¸å½“äºæŠŠé¢„åˆ¶èœç…®ç†Ÿçš„è¿‡ç¨‹(?)</p><p>é™¤äº†è¿™ç§é¢„åˆ¶çš„æ–¹å¼ä»¥å¤–ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å¸¸é‡ä¹Ÿå¯ä»¥æ˜¯<strong>åŠ¨æ€</strong>ç”Ÿæˆçš„ï¼Œä¾‹å¦‚String çš„<code>intern</code>æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸º Java ä¸­çš„ Stringç±»è‡ªå·±(privately)ç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œè°ƒç”¨<code>intern</code>æ–¹æ³•æ—¶ï¼Œå¦‚æœæ± ä¸­å·²åŒ…å«ä¸€ä¸ªç”±<code>equals(Object)</code>æ–¹æ³•ç¡®å®šä¸æ­¤<code>String</code>å¯¹è±¡ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚å¦åˆ™ï¼Œå°†æ­¤<code>String</code>å¯¹è±¡æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›å¯¹æ­¤<code>String</code>å¯¹è±¡çš„å¼•ç”¨ã€‚</p><h2 id="ç›´æ¥å†…å­˜">ç›´æ¥å†…å­˜</h2><figure><img src="https://s21.ax1x.com/2025/05/30/pVpz6Vx.png"alt="ç›´æ¥å†…å­˜ã€å †å¤–å†…å­˜ã€æœ¬åœ°å†…å­˜çš„å…³ç³»[3]" /><figcaptionaria-hidden="true">ç›´æ¥å†…å­˜ã€å †å¤–å†…å­˜ã€æœ¬åœ°å†…å­˜çš„å…³ç³»<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://juejin.cn/post/7195478842432028732">[3]</span></a></sup></figcaption></figure><div class="note note-secondary">            <p>ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹çš„ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‡ºç°ã€‚</p>          </div><p><strong>ç›´æ¥å†…å­˜æ˜¯åœ¨Javaå †å¤–çš„ã€ç›´æ¥å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜åŒºé—´ï¼Œä¸“é—¨ç”¨äºJVM å’Œ IO è®¾å¤‡æ‰“äº¤é“ï¼ŒJavaåº•å±‚ä½¿ç”¨ C è¯­è¨€çš„ API è°ƒç”¨æ“ä½œç³»ç»Ÿä¸ IOè®¾å¤‡è¿›è¡Œäº¤äº’</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨JDK1.4ä¸­æ–°åŠ å…¥çš„<code>NIO(New Input/Output)</code>ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åˆ©ç”¨<strong>é€šé“</strong>å’Œ<strong>ç¼“å†²åŒº</strong>çš„IOæ–¹å¼ï¼Œè°ƒç”¨<code>Native</code>å‡½æ•°åº“åˆ†é…å †å¤–å†…å­˜ï¼Œé€šè¿‡JVMå †ä¸­çš„<code>DirectByteBuffer</code>å¯¹è¿™ä¸€éƒ¨åˆ†æœ¬åœ°å†…å­˜è¿›è¡Œ<strong>è™šå¼•ç”¨</strong>ã€‚</p><p><em>è™šå¼•ç”¨</em>ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ã€‚ä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆä»–å°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ç”¨è™šå¼•ç”¨ï¼Ÿå› ä¸ºç›´æ¥å†…å­˜ä½äº JVMæŒæ§çš„èŒƒå›´ä¹‹å¤–ï¼Œåƒåœ¾æ”¶é›†å™¨å¯¹å®ƒä¸èµ·ä½œç”¨ã€‚å› æ­¤ï¼Œç›´æ¥å†…å­˜çš„å›æ”¶éœ€è¦åšè¿›ä¸€æ­¥çš„æ‰‹åŠ¨æ¸…ç†ï¼Œä½ æƒ³å¯¹å†…å­˜æ“ä½œçš„è¯èµ·ç å¾—é€šè¿‡å¼•ç”¨æ‹¿åˆ°å®ƒçš„åœ°å€å§ã€‚è™šå¼•ç”¨çš„ä½œç”¨å°±æ˜¯è·Ÿè¸ª<em>è¢«å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶</em> è¿™ä¸€æ´»åŠ¨ï¼Œå…·ä½“æ¥è®²ï¼š</p><ul><li>å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„<strong>å¼•ç”¨é˜Ÿåˆ—</strong>ä¸­ï¼›</li><li>äºæ˜¯ Javaç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼›</li><li>å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ï¼ˆè°ƒç”¨<code>Cleaner</code>çš„<code>clean</code>æ–¹æ³•ï¼‰ã€‚</li></ul><figure><img src="https://s21.ax1x.com/2025/05/30/pVpz8rn.png" alt="NIO" /><figcaption aria-hidden="true">NIO</figcaption></figure><h1 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.1<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:2"class="footnote-text"><span>https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.3<a href="#fnref:2" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:3"class="footnote-text"><span>https://juejin.cn/post/7195478842432028732<a href="#fnref:3" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cloudflareé…ç½®å°†åšå®¢æ—§åŸŸåçš„è¯·æ±‚é‡å®šå‘åˆ°æ–°åŸŸå</title>
    <link href="/2025/05/30/Cloudflare%E9%87%8D%E5%AE%9A%E5%90%91%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/"/>
    <url>/2025/05/30/Cloudflare%E9%87%8D%E5%AE%9A%E5%90%91%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<p>åœ¨åšå®¢æ›´æ¢åŸŸåä¹‹ååˆ©ç”¨Cloudflareå°†å‘æ—§åŸŸåçš„è¯·æ±‚é‡å®šå‘åˆ°æ–°åŸŸåï¼Œå¹¶ä¸”ä¿ç•™è¯·æ±‚çš„èµ„æºè·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²</p><span id="more"></span><h2 id="å‰è¨€">å‰è¨€</h2><p>æœ€è¿‘ä¸ºåšå®¢æ›´æ¢äº†åŸŸåï¼ŒåŸåŸŸåä¸º<code>kznep19.blog</code>ï¼Œå› ä¸ºç»­è´¹è´¹ç”¨è¿‡é«˜è€Œæ›´æ¢ä¸ºç°åœ¨çš„<code>kznleaf.top</code>ã€‚ç°åœ¨é‡åˆ°äº†å‡ ä¸ªé—®é¢˜ï¼š</p><ol type="1"><li>åŸåŸŸåè™½ç„¶ä¸å†ä½¿ç”¨äº†ï¼Œä½†æ˜¯ä¸€ç›´åˆ°2026å¹´1æœˆæ‰è¿‡æœŸï¼›</li><li>Googleå’Œå¿…åº”æœç´¢å¼•æ“ä»åœ¨æ”¶å½•åŸåŸŸåä¸‹çš„æ–‡ç« é¡µï¼Œå¦‚æœé©¬ä¸ŠåºŸå¼ƒåŸåŸŸåï¼Œåˆè¦é‡æ–°æŠ“å–ä¸€éæ–‡ç« ï¼›</li><li>æœ‰å‡ ç¯‡åšå®¢åœ¨åˆ«çš„åœ°æ–¹è¢«å¼•ç”¨äº†ï¼Œæˆ‘å¸Œæœ›è¿™äº›å¤–é“¾ä»ç„¶èƒ½å¤Ÿç”Ÿæ•ˆ</li></ol><p>ç»¼ä¸Šè€ƒè™‘ï¼Œæˆ‘å¸Œæœ›è·å¾—çš„æ•ˆæœæ˜¯ï¼šå°†åšå®¢åˆ‡æ¢ä¸ºæ–°åŸŸåï¼ŒåŒæ—¶ä¸ºæ—§åŸŸåé…ç½®é‡å®šå‘ï¼Œä½¿å¾—å¯¹æ—§åŸŸåä¸‹çš„èµ„æºçš„è¯·æ±‚ä¼šè¢«è‡ªåŠ¨é‡å®šå‘åˆ°æ–°åŸŸåä¸‹å¯¹äºçš„èµ„æºè·¯å¾„ã€‚</p><p>èŠ±äº†ä¸å°‘æ—¶é—´æŸ¥èµ„æ–™ï¼Œå¤§éƒ¨åˆ†çš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯é€šè¿‡é…ç½®é¡µé¢è§„åˆ™(PageRules)é…ç½®çš„æ–¹å¼å®ç°é‡å®šå‘ï¼Œæˆ‘ç»è¿‡å°è¯•ä¹‹åå‘ç°å¹¶æ²¡æœ‰æ•ˆæœã€‚æœ€åæ‰¾åˆ°äº†è¿™ç¯‡åšå®¢ï¼š</p><p><ahref="https://appscross.com/blog/issues-resolved-during-cloudflares-configuration-site-redirection-process.html">Cloudflareé…ç½®ç«™ç‚¹é‡å®šå‘</a></p><p>è¿™ä¸ªåšå®¢æ˜¯æŠŠå¯¹æ—§åŸŸåä¸‹çš„ä»»ä½•èµ„æºçš„è¯·æ±‚éƒ½é‡å®šå‘åˆ°ä¸€ä¸ªå›ºå®šçš„URLä¸‹ï¼Œæˆ‘åœ¨è¯¥åšå®¢çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›è¡¥å……ï¼Œæœ€åè¾¾åˆ°äº†ç†æƒ³çš„æ•ˆæœã€‚</p><h2 id="é…ç½®è¦ç‚¹">é…ç½®è¦ç‚¹</h2><h3 id="é…ç½®é‡å®šå‘è§„åˆ™">é…ç½®é‡å®šå‘è§„åˆ™</h3><p>å…ˆæ‰“å¼€ä¸»é¡µå·¦ä¾§çš„â€œè§„åˆ™â€ï¼Œç„¶åç‚¹å‡»å³ä¾§çš„åˆ›å»ºè§„åˆ™â€”â€”<strong>é‡å®šå‘è§„åˆ™</strong>ã€‚ï¼ˆæ³¨æ„ä¸æ˜¯æœ€å·¦è¾¹çš„é¡µé¢è§„åˆ™ï¼Œè¿™ä¸¤ä¸ªä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œåé¢ä¼šè¯´ï¼‰</p><figure><img src="https://s21.ax1x.com/2025/05/30/pV9F3fP.png"alt="é‡å®šå‘è§„åˆ™" /><figcaption aria-hidden="true">é‡å®šå‘è§„åˆ™</figcaption></figure><p>è¿™é‡Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸‰ä¸ªé€‰é¡¹ï¼š</p><p><img src="https://s21.ax1x.com/2025/05/30/pV9FGSf.png" /></p><p>åº”å½“é€‰æ‹©<strong>é‡å®šå‘åˆ°å…¶ä»–åŸŸ</strong>ã€‚<ahref="https://developers.cloudflare.com/rules/url-forwarding/examples/redirect-all-different-hostname/">å®˜æ–¹æ–‡æ¡£</a>å¯¹å®ƒçš„æè¿°ä¸ºï¼š</p><div class="note note-secondary">            <p>åˆ›å»ºé‡å®šå‘è§„åˆ™ï¼Œå°†å¯¹<code>smallshop.example.com</code>çš„æ‰€æœ‰è¯·æ±‚é‡å®šå‘åˆ°ä½¿ç”¨HTTPS çš„å…¶ä»–ä¸»æœºåï¼ŒåŒæ—¶ä¿ç•™åŸå§‹è·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p>          </div><p>ä½¿ç”¨é€šé…ç¬¦åŒ¹é…æ¨¡å¼ï¼Œå¦‚æœè¯·æ±‚çš„URLä¸º<code>http*://smallshop.example.com/*</code>ï¼Œé‚£ä¹ˆï¼š</p><ul><li>ç›®æ ‡URLï¼š<code>https://globalstore.example.net/$&#123;2&#125;</code></li><li>çŠ¶æ€ç ï¼š301</li><li>ä¿ç•™æŸ¥è¯¢å­—ç¬¦ä¸²ï¼šå¯ç”¨</li></ul><p>è¯·æ±‚URLä¸­çš„<code>*</code>æ˜¯å¯¹é›¶ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦è¿›è¡ŒåŒ¹é…ï¼Œè¿™é‡Œè¡¨ç¤ºä½¿ç”¨HTTP æˆ– HTTPSåè®®å¯¹<code>smallshop.example.com</code>ä¸‹çš„ä»»æ„èµ„æºçš„è¯·æ±‚éƒ½å°†è¢«åŒ¹é…ã€‚</p><p>ç›®æ ‡URLå³è¯¥è¯·æ±‚å°†ä¼šè¢«é‡å®šå‘åˆ°çš„URLï¼Œå…¶ä¸­çš„<code>$&#123;2&#125;</code>æ˜¯å¯¹é€šé…ç¬¦æ•è·çš„å†…å®¹çš„å¼•ç”¨ï¼Œè¿™é‡Œä»£è¡¨çš„æ˜¯è¯·æ±‚URLä¸­çš„ç¬¬äºŒä¸ª<code>*</code>ï¼Œæ‰€ä»¥ç”¨æˆ·æœ€ç»ˆè®¿é—®çš„æ˜¯æ–°åŸŸå<code>globalstore.example.net</code>ä¸‹çš„å¯¹åº”èµ„æºã€‚</p><p>ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºè¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚é‚£æ¥ä¸‹æ¥çš„é…ç½®å°±å¾ˆç®€å•äº†ï¼ŒæŒ‰ç…§åˆšæ‰æåˆ°çš„ä¸‰ç‚¹ï¼šç›®æ ‡URLã€çŠ¶æ€ç ã€å¯ç”¨ä¿ç•™æŸ¥è¯¢å­—ç¬¦ä¸²é…ç½®å³å¯ã€‚</p><p><img src="https://s21.ax1x.com/2025/05/30/pV9FO7d.png" /></p><h3 id="ä½¿è§„åˆ™ç”Ÿæ•ˆ">ä½¿è§„åˆ™ç”Ÿæ•ˆ</h3><p>å…‰æ˜¯é…ç½®è§„åˆ™æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜è¦ç»™è¿™ä¸ªåŸŸåæ·»åŠ DNSè®°å½•ä»¥ä½¿è§„åˆ™ç”Ÿæ•ˆã€‚åˆ›å»ºä¸€æ¡Aè®°å½•å³å¯ï¼ŒIPåœ°å€å¯ä»¥éšä¾¿å†™ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ä¿ç•™IPåœ°å€<code>192.0.2.1</code>ï¼Œå†™äº†ä¸¤æ¡</p><p><img src="https://s21.ax1x.com/2025/05/30/pV9kn3V.png" /></p><p>å…³äºè¿™ä¸€éƒ¨åˆ†ï¼ŒCloudflareæ–‡æ¡£åœ¨Page Rulesä¸€èŠ‚ä¸­æ˜¯è¿™æ ·è¯´çš„ï¼š</p><p><img src="https://s21.ax1x.com/2025/05/30/pV9kajO.png" /></p><p><ahref="https://developers.cloudflare.com/rules/page-rules/">åŸæ–‡é“¾æ¥</a></p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœIPåœ°å€ä½œä¸ºå ä½ç¬¦çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨ä¿ç•™IPåœ°å€<code>192.0.2.*</code>ï¼Œé¿å…æŠŠæµé‡å‘åˆ°ä»€ä¹ˆå¥‡æ€ªçš„åœ°æ–¹ã€‚</p><h2 id="page-ruleså’Œredirectsçš„åŒºåˆ«">Page Ruleså’ŒRedirectsçš„åŒºåˆ«</h2><p>å‰é¢æåˆ°äº†ï¼Œåœ¨æœç´¢å¼•æ“ä¸­æœç´¢â€œä½¿ç”¨CloudflareæŠŠæ—§åŸŸåé‡å®šå‘åˆ°æ–°åŸŸåâ€ï¼Œå¼¹å‡ºæ¥çš„ç»“æœå¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨PageRulesçš„ï¼Œä½†è¿™å…¶å®ä¸å¤ªåˆé€‚ã€‚å…¶å®å…³é”®å°±æ˜¯<strong>è½¬å‘</strong>å’Œ<strong>é‡å®šå‘</strong>çš„åŒºåˆ«ã€‚PageRulesä¸­å¯ä»¥é…ç½®ä¸€ä¸ªå«åš<code>URL Forwarding(è½¬å‘URL)</code>çš„ä¸œè¥¿ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/30/pV9Alxf.png"alt="é¡µé¢è§„åˆ™ä¸­çš„è½¬å‘URL" /><figcaption aria-hidden="true">é¡µé¢è§„åˆ™ä¸­çš„è½¬å‘URL</figcaption></figure><p>å¦‚æœä½ é…ç½®äº†ç›®æ ‡åœ°å€ï¼Œé‚£ä¹ˆï¼š</p><div class="note note-secondary">            <p>If you enter the address above in the forwarding box and select AddRule, within a few seconds any requests that match the pattern youentered will automatically be forwarded with an HTTP 302 redirect statuscode to the new URL.</p>          </div><p>å³è¿™æ ·é…ç½®è¿”å›çš„çŠ¶æ€ç æ˜¯<code>302</code>ï¼Œè€Œåˆšæ‰çš„é‡å®šå‘çŠ¶æ€ç æ˜¯301ï¼Œè‡³æ­¤ç†Ÿæ‚‰è®¡ç½‘çš„äººåº”è¯¥æ¸…æ¥šæ˜¯æ€ä¹ˆä¸€å›äº‹äº†ã€‚ä¸è¿‡è¿˜æ˜¯å†çœ‹çœ‹<ahref="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81">wiki</a>å¯¹è¿™ä¸¤ç§çŠ¶æ€ç çš„è¡¨è¿°ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/30/pV9Amad.png"alt="çŠ¶æ€ç 301å’Œ302çš„åŒºåˆ«" /><figcaption aria-hidden="true">çŠ¶æ€ç 301å’Œ302çš„åŒºåˆ«</figcaption></figure><ul><li>301ç”¨äºæ°¸ä¹…é‡å®šå‘çš„æƒ…å†µï¼Œå‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªçŠ¶æ€ç ä¹‹åï¼Œé™¤äº†æ”¶åˆ°ä¸€ä¸ªç”¨äºé‡å®šå‘çš„åœ°å€ä»¥å¤–ï¼Œè¿˜ä¼šè¢«å‘ŠçŸ¥æŠŠä»¥åçš„è¯·æ±‚ç›®æ ‡åœ°å€ä¹Ÿæ”¹æˆè¿™ä¸ªåœ°å€ï¼Œè€Œä¸”è¿™ä¸ªåœ°å€é»˜è®¤æ˜¯ä¼šè¢«ç¼“å­˜çš„ã€‚</li><li>302ç”¨äºä¸´æ—¶é‡å®šå‘ï¼Œè€Œä¸”è¿™ä¸ªå“åº”ä¸ä¼šè¢«ç¼“å­˜ï¼Œå®¢æˆ·ç«¯ä»¥åç»§ç»­å‘æ—§åŸŸåå‘é€è¯·æ±‚ã€‚</li></ul><p>æ‰€ä»¥åœ¨è€ƒè™‘æ˜¯é€‰æ‹©é¡µé¢è§„åˆ™ä¸­çš„è½¬å‘URLè¿˜æ˜¯åˆ›å»ºé‡å®šå‘è§„åˆ™çš„æ—¶å€™ï¼Œåº”å½“æ ¹æ®ä»¥ä¸Šå†…å®¹è¿›è¡Œè€ƒè™‘ã€‚åƒæˆ‘è¿™ç§ä¸ºç½‘ç«™æ›´æ¢åŸŸåçš„æƒ…å†µå½“ç„¶æ˜¯é€‰æ‹©é‡å®šå‘äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Cloudflare</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Cloudflare</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬ä¸‰æ¬¡åšå®¢æŠ˜è…¾è®°å½•</title>
    <link href="/2025/05/27/%E7%AC%AC%E4%B8%89%E6%AC%A1%E6%8A%98%E8%85%BE/"/>
    <url>/2025/05/27/%E7%AC%AC%E4%B8%89%E6%AC%A1%E6%8A%98%E8%85%BE/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åˆæŠ˜è…¾äº†ä¸€ä¸‹åšå®¢ï¼Œç¬¬ä¸€æ¬¡æŠ˜è…¾åº”è¯¥æ˜¯å¹´åˆçš„æ—¶å€™ç»‘å®šåŸŸåï¼Œç¬¬äºŒæ¬¡æ˜¯ä¸€ä¸ªæœˆä¹‹å‰ï¼Œè¿™å›åº”è¯¥æ˜¯è¿‘æœŸçš„æœ€åä¸€æ¬¡äº†ã€‚</p><p>ä¸»è¦å†…å®¹ï¼š</p><ol type="1"><li>æŠŠåšå®¢çš„åŸŸåæ¢æˆäº†<code>kznleaf.top</code>ï¼Œå› ä¸ºè§‰å¾—åŸæ¥çš„åŸŸåä¸å¥½å¬ã€‚ç»­è´¹çš„è¯å¤§çº¦ä¸€å¹´30rmbï¼Œè¿˜ç®—å®æƒ ï¼Œä»¥åæ²¡æœ‰ç‰¹æ®Šæƒ…å†µçš„è¯åº”è¯¥ä¸ä¼šå†æ”¹äº†</li><li>DNSè§£ææœåŠ¡ç”± DNSPod æ¢æˆ Cloudflareï¼Œå› ä¸ºä¸æƒ³ç”¨è…¾è®¯çš„äº§å“</li><li>ç§»é™¤æ¯›ç»ç’ƒæ•ˆæœ</li><li>ç§»é™¤å…³äºé¡µçš„ GitHub äº‹ä»¶ç»Ÿè®¡å’Œ contribution graph</li></ol><p>æœ€åä¸€æ¡ä¸ºä»€ä¹ˆè¦å…³é—­è¿™ä¸¤ä¸ªå‘¢ï¼Œå› ä¸ºä»Šå¤©æµ‹è¯•ç½‘ç«™åŠŸèƒ½çš„æ—¶å€™ï¼Œå…³æ‰ä»£ç†ï¼ŒF12å…³é—­ç¼“å­˜ï¼Œå‘ç°å…³äºé¡µçš„åŠ è½½é€Ÿåº¦æå…¶ç¼“æ…¢ï¼ŒæŸ¥çœ‹ç½‘ç»œï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/27/pVSLhpn.png" alt="ä¹" /><figcaption aria-hidden="true">ä¹</figcaption></figure><p>è¿™é‡Œç”¨åˆ°çš„ä¸¤ä¸ªé¡¹ç›®ï¼šGitHubäº‹ä»¶ç»Ÿè®¡ å’Œ Contribution Graphéƒ½è¢«å¤§é™†å¢™äº†</p><p>å› ä¸ºæˆ‘ä¹‹å‰è®¾ç½®äº†é¢„åŠ è½½åŠŸèƒ½ï¼Œå¹¶ä¸”è§„å®š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"> $(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  $(<span class="hljs-string">&quot;#Loadanimation&quot;</span>).<span class="hljs-title function_">fadeOut</span>(<span class="hljs-number">500</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>å³æ•´ä¸ªé¡µé¢çš„èµ„æºéƒ½åŠ è½½å®Œæ¯•åå†é€€å‡ºåŠ¨ç”»ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ— æ³•è®¿é—®é¡¹ç›®ä¼šä½¿è®¿é—®è€…é•¿æ—¶é—´å¡åœ¨é¢„åŠ è½½åŠ¨ç”»å‡ºä¸æ¥ï¼Œç›´åˆ°è¾¾åˆ°è¶…æ—¶æ—¶é—´æ”¾å¼ƒåŠ è½½ã€‚</p><p>ChatGPT:</p><blockquote><p>Contribution Graphçš„æœåŠ¡éƒ¨ç½²åœ¨ vercel.app åŸŸåä¸Šï¼Œå¤§é™†å¯¹ vercel.appå±è”½ä¸¥é‡ï¼Œæ‰€ä»¥æ— æ³•è®¿é—®ã€‚</p></blockquote><p>æˆ‘ç°åœ¨ä¹Ÿæ²¡ç²¾åŠ›å»æƒ³è§£å†³æ–¹æ¡ˆ...å¹²è„†åˆ æ‰å¥½äº†</p><p><span class="heimu" title="ä½ çŸ¥é“çš„å¤ªå¤šäº†">GFWä½ èµ¢äº†</span></p><p>ä¹‹å‰æˆ‘åœ¨æŸç”µå­ä¿¡æ¯å¼ºæ ¡ï¼ˆå¤§å˜˜ï¼‰çš„ç”µå­å®éªŒå®¤çš„å¤è‘£ç”µè„‘ä¸Šå°è¯•è®¿é—®è¿‡è‡ªå·±çš„åšå®¢ï¼Œå·²ç»å‘ç°äº†å…³äºé¡µæ— æ³•åŠ è½½çš„é—®é¢˜ï¼Œè€Œä¸”ç”±äºæœ€æ—©å‘å¸ƒçš„åå‡ ç¯‡åšå®¢çš„å°é¢å›¾æ˜¯æ‰˜ç®¡åœ¨imgur ä¸Šçš„ï¼Œæ‰€ä»¥åšå®¢çš„å‰ä¸¤é¡µçš„å†…å®¹å…¨éƒ½æ— æ³•åŠ è½½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Theme</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatis-ç¼“å­˜</title>
    <link href="/2025/05/20/MyBatis-%E7%BC%93%E5%AD%98/"/>
    <url>/2025/05/20/MyBatis-%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h1 id="mybatisçš„ç¼“å­˜">MyBatisçš„ç¼“å­˜</h1><p>å‚è€ƒé“¾æ¥ï¼š</p><p><ahref="https://tech.meituan.com/2018/01/19/mybatis-cache.html">èŠèŠMyBatisç¼“å­˜æœºåˆ¶-ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p><p><ahref="https://itmyhome.com/mybatis-pdf/MyBatis-3-User-Guide-Simplified-Chinese.pdf">MyBatisç”¨æˆ·æŒ‡å—</a></p><p><ahref="https://www.cnblogs.com/gavincoder/p/13977037.html">Mybatisæ·±å…¥æµ…å‡ºä¹‹ç¼“å­˜æœºåˆ¶</a></p><h2 id="ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</h2><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3><p>ä¸€çº§ç¼“å­˜é»˜è®¤å¼€å¯ï¼Œæ˜¯sqlSessionçº§åˆ«çš„ã€‚åŒä¸€ä¸ª sqlSessionå¯¹è±¡åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç›¸åŒçš„ SQL ä¸”å‚æ•°ä¹Ÿä¸€æ ·ï¼ŒMyBatisä¼šå°†ç»“æœç¼“å­˜èµ·æ¥ï¼Œåç»­å†æŸ¥ç›¸åŒå†…å®¹æ—¶ç›´æ¥ä»ç¼“å­˜ä¸­å–ï¼Œè€Œä¸æ˜¯å†è®¿é—®æ•°æ®åº“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br><br><span class="hljs-type">User</span> <span class="hljs-variable">u1</span> <span class="hljs-operator">=</span> session.selectOne(<span class="hljs-string">&quot;getUserById&quot;</span>, <span class="hljs-number">1</span>);<br><span class="hljs-type">User</span> <span class="hljs-variable">u2</span> <span class="hljs-operator">=</span> session.selectOne(<span class="hljs-string">&quot;getUserById&quot;</span>, <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p><code>u1</code>æ­£å¸¸æŸ¥è¯¢æ•°æ®åº“ï¼Œ<code>u2</code>ç›´æ¥ä»ä¸€çº§ç¼“å­˜ä¸­è¯»å–æŸ¥è¯¢è¿‡çš„æ•°æ®ã€‚</p><figure><img src="https://s21.ax1x.com/2025/05/20/pExKhgx.png"alt="ä¸€çº§ç¼“å­˜æµç¨‹å›¾" /><figcaption aria-hidden="true">ä¸€çº§ç¼“å­˜æµç¨‹å›¾</figcaption></figure><p>æ¯ä¸ªSqlSessionä¸­æŒæœ‰Executorï¼Œæ¯ä¸ªExecutorä¸­æœ‰ä¸€ä¸ªLocalCacheã€‚å½“ç”¨æˆ·å‘èµ·æŸ¥è¯¢æ—¶ï¼ŒMyBatisæ ¹æ®å½“å‰æ‰§è¡Œçš„è¯­å¥ç”ŸæˆMappedStatementï¼Œåœ¨LocalCacheè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­çš„è¯ï¼Œç›´æ¥è¿”å›ç»“æœç»™ç”¨æˆ·ï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­çš„è¯ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œç»“æœå†™å…¥LocalCacheï¼Œæœ€åè¿”å›ç»“æœç»™ç”¨æˆ·ã€‚</p><!-- ![ä¸€çº§ç¼“å­˜æ—¶åºå›¾](https://s21.ax1x.com/2025/05/20/pExKIKK.jpg) --><h3 id="å¤±æ•ˆ">å¤±æ•ˆ</h3><p>ä¸€çº§ç¼“å­˜ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆçš„ï¼Œå®ƒåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼š</p><ol type="1"><li>ä¸åŒçš„sqlSessionã€‚<strong>æ¯ä¸ªsqlSessionéƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜</strong>ï¼Œäº’ä¸å½±å“ï¼Œä¸åŒçš„sessionä¸ä¼šå…±äº«ç¼“å­˜ã€‚</li><li>æ‰§è¡Œäº†å¢åˆ æ”¹æ“ä½œã€‚è¿™äº›æ“ä½œå¯èƒ½ä¼šä¿®æ”¹æ•°æ®ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ŒMyBatisä¼šæ¸…é™¤ç¼“å­˜ã€‚ä¸ç®¡æ˜¯å¦çœŸçš„æ”¹åŠ¨äº†æ•°æ®åº“ã€ä¹Ÿä¸ç®¡æ˜¯å¦æäº¤äº‹åŠ¡ï¼Œä¸€çº§ç¼“å­˜éƒ½ä¼šè¢«æ¸…é™¤ã€‚</li><li>æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼Œè°ƒç”¨<code>session.clearCache()</code>æ¸…é™¤ä¸€çº§ç¼“å­˜ã€‚</li><li>åŒä¸€æ¡SQLä½†æ˜¯æŸ¥è¯¢å‚æ•°ä¸åŒã€‚</li></ol><p><strong>æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> userMapper.getStudentById(<span class="hljs-number">1</span>);<br>    System.out.println(student);<br>    sqlSession.clearCache();<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> userMapper.getStudentById(<span class="hljs-number">1</span>);<br>    System.out.println(student2);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: SELECT * FROM students WHERE id = ?;<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: id, class_id, name, gender, score<br>TRACE [main] - &lt;==        Row: 1, 1, å°æ˜, F, 100<br>DEBUG [main] - &lt;==      Total: 1<br>Student&#123;id=1, class_id=1, name=&#x27;å°æ˜&#x27;, gender=&#x27;F&#x27;, score=100&#125;<br>DEBUG [main] - ==&gt;  Preparing: SELECT * FROM students WHERE id = ?;<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: id, class_id, name, gender, score<br>TRACE [main] - &lt;==        Row: 1, 1, å°æ˜, F, 100<br>DEBUG [main] - &lt;==      Total: 1<br>Student&#123;id=1, class_id=1, name=&#x27;å°æ˜&#x27;, gender=&#x27;F&#x27;, score=100&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æ‰‹åŠ¨æ¸…é™¤äº†ç¼“å­˜ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æŸ¥è¯¢çš„æ—¶å€™ä»ç„¶è¦è¿æ¥æ•°æ®åº“ï¼Œå‘é€sqlè¯­å¥è‡³æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p><strong>å¢åˆ æ”¹æ¸…é™¤ç¼“å­˜æµ‹è¯•</strong></p><p>å•å…ƒæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> userMapper.getStudentById(<span class="hljs-number">1</span>);<br>    System.out.println(<span class="hljs-string">&quot;ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š&quot;</span> + student);<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.deleteStudentById(<span class="hljs-number">12</span>);<br><br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> userMapper.getStudentById(<span class="hljs-number">1</span>);<br>    System.out.println(<span class="hljs-string">&quot;ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼š&quot;</span> + student2);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: SELECT * FROM students WHERE id = ?;<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: id, class_id, name, gender, score<br>TRACE [main] - &lt;==        Row: 1, 1, å°æ˜, F, 100<br>DEBUG [main] - &lt;==      Total: 1<br>ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼šStudent&#123;id=1, class_id=1, name=&#x27;å°æ˜&#x27;, gender=&#x27;F&#x27;, score=100&#125;<br>DEBUG [main] - ==&gt;  Preparing: DELETE FROM students WHERE id = ?;<br>DEBUG [main] - ==&gt; Parameters: 12(Integer)<br>DEBUG [main] - &lt;==    Updates: 1<br>DEBUG [main] - ==&gt;  Preparing: SELECT * FROM students WHERE id = ?;<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: id, class_id, name, gender, score<br>TRACE [main] - &lt;==        Row: 1, 1, å°æ˜, F, 100<br>DEBUG [main] - &lt;==      Total: 1<br>ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼šStudent&#123;id=1, class_id=1, name=&#x27;å°æ˜&#x27;, gender=&#x27;F&#x27;, score=100&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè™½ç„¶åˆ é™¤æ“ä½œå¹¶æ²¡æœ‰è¢«æäº¤ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æŸ¥è¯¢è¿˜æ˜¯è¦é‡æ–°è¿æ¥æ•°æ®åº“ã€‚</p><h2 id="äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</h2><p>ä¸€çº§ç¼“å­˜æ˜¯ <strong>SqlSession</strong> çº§åˆ«çš„ç¼“å­˜ï¼Œæ¯ä¸ª SqlSessionæ‹¥æœ‰è‡ªå·±çš„ç¼“å­˜ã€‚</p><p>äºŒçº§ç¼“å­˜æ˜¯ <strong>namespace</strong>çº§åˆ«çš„ç¼“å­˜ï¼Œ<strong>å®ƒæ˜¯å¯ä»¥è¢«å¤šä¸ª SqlSessionå…±äº«çš„ç¼“å­˜</strong>ã€‚å› ä¸ºä¸€ä¸ªMapperæ˜ å°„é…ç½®æ–‡ä»¶å¾€å¾€å¯¹åº”ä¸€ä¸ªnamespaceï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è¯´å®ƒæ˜¯ <strong>Mapper</strong> çº§åˆ«çš„ç¼“å­˜ã€‚</p><figure><img src="https://s21.ax1x.com/2025/05/20/pExM3GR.png"alt="äºŒçº§ç¼“å­˜æµç¨‹å›¾" /><figcaption aria-hidden="true">äºŒçº§ç¼“å­˜æµç¨‹å›¾</figcaption></figure><p>äºŒçº§ç¼“å­˜å¼€å¯åï¼ŒåŒä¸€ä¸ªnamespaceä¸‹çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œéƒ½å½±å“ç€åŒä¸€ä¸ªCacheï¼Œå³äºŒçº§ç¼“å­˜è¢«å¤šä¸ªSqlSessionå…±äº«ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„å˜é‡ã€‚</p><p>å½“å¼€å¯äºŒçº§ç¼“å­˜åï¼Œæ•°æ®çš„æŸ¥è¯¢æ‰§è¡Œçš„æµç¨‹å°±æ˜¯<code>äºŒçº§ç¼“å­˜ -&gt; ä¸€çº§ç¼“å­˜ -&gt; æ•°æ®åº“</code>ï¼Œæ›´æ–°æ‰§è¡Œé¡ºåºï¼š<code>æ•°æ®åº“-&gt;ä¸€çº§ç¼“å­˜-&gt;äºŒçº§ç¼“å­˜</code>ã€‚</p><h3 id="äºŒçº§ç¼“å­˜é…ç½®">äºŒçº§ç¼“å­˜é…ç½®</h3><p>MyBatisé»˜è®¤æƒ…å†µä¸‹åªå¼€å¯å±€éƒ¨çš„session ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜éœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚</p><ol type="1"><li>åœ¨<code>&lt;setting&gt;</code>æ ‡ç­¾ä¸­è®¾ç½®<code>cacheEnabled</code>å±æ€§çš„å€¼ä¸º<code>true</code>;</li><li>åœ¨MyBatisçš„æ˜ å°„XMLä¸­é…ç½®cacheï¼š<code>&lt;cache/&gt;</code>;</li><li>äºŒçº§ç¼“å­˜å¿…é¡»åœ¨sqlSessionå…³é—­æˆ–æäº¤åæ‰æœ‰æ•ˆï¼›</li><li>æŸ¥è¯¢æ•°æ®æ‰€è½¬æ¢çš„å®ä½“æ•°æ®ç±»å‹å¿…é¡»å®ç°åºåˆ—åŒ–æ¥å£<code>Serializable</code>ã€‚</li></ol><p>å®Œæˆä¸Šè¿°é…ç½®ä¹‹åï¼ŒæŸ¥è¯¢è¯­å¥ä¼šé»˜è®¤ä½¿ç”¨ç¼“å­˜ã€‚æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li>XMLæ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰<code>select</code>éƒ½ä¼šè¢«ç¼“å­˜ï¼Œæ‰€æœ‰å¢åˆ æ”¹å…³é”®å­—éƒ½ä¼šåˆ·æ–°ç¼“å­˜ã€‚</li><li>ç¼“å­˜ä¼šä½¿ç”¨<ahref="https://leetcode.cn/problems/lru-cache/">LRUç®—æ³•</a>æ¥æ”¶å›ã€‚</li><li>ç¼“å­˜æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œä¸ä¼šæ ¹æ®æ—¶é—´è‡ªåŠ¨åˆ·æ–°ã€‚</li></ul><p>äºŒçº§ç¼“å­˜ä¾èµ–äºä¸€çº§ç¼“å­˜ï¼Œ<code>sqlSession.close()</code>æ‰§è¡Œå®Œï¼ŒMybatisä¼šå°†ä¸€çº§ç¼“å­˜å¯¹è±¡æ‹·è´å­˜å‚¨åˆ°äºŒçº§ç¼“å­˜ï¼Œç„¶åäºŒçº§ç¼“å­˜æ‰ä¼šèµ·ä½œç”¨ã€‚</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">// 1. åŠ è½½é…ç½®</span><br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>);<br>    <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(is);<br><br>    <span class="hljs-comment">// 2. åˆ›å»ºä¸¤ä¸ª sqlSession è¿›è¡Œæ•°æ®åº“æ“ä½œ</span><br><br>    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession1</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br>    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession2</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<br><br>    <span class="hljs-type">CacheMapper</span> <span class="hljs-variable">sqlSession1Mapper</span> <span class="hljs-operator">=</span> sqlSession1.getMapper(CacheMapper.class);<br>    <span class="hljs-type">CacheMapper</span> <span class="hljs-variable">sqlSession2Mapper</span> <span class="hljs-operator">=</span> sqlSession2.getMapper(CacheMapper.class);<br><br>    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æŸ¥è¯¢</span><br>    <span class="hljs-type">Student</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> sqlSession1Mapper.getStudentById(<span class="hljs-number">1</span>);<br>    System.out.println(s1);<br>    <span class="hljs-comment">// å…³é—­ä¸€çº§ç¼“å­˜,å°†æ•°æ®ä»å†…å­˜å­˜å‚¨åˆ°ç¡¬ç›˜</span><br>    sqlSession1.close();<br>    <span class="hljs-comment">// ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œç›¸åŒ namespace ä¸‹æŸ¥è¯¢ï¼ŒäºŒçº§ç¼“å­˜å‘½ä¸­</span><br>    <span class="hljs-type">Student</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> sqlSession2Mapper.getStudentById(<span class="hljs-number">1</span>);<br>    System.out.println(s2);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - Cache Hit Ratio [com.kzn.mapper.CacheMapper]: 0.0<br>DEBUG [main] - ==&gt;  Preparing: SELECT * FROM students WHERE id = ?;<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: id, class_id, name, gender, score<br>TRACE [main] - &lt;==        Row: 1, 1, å°æ˜, F, 100<br>DEBUG [main] - &lt;==      Total: 1<br>Student&#123;id=1, class_id=1, name=&#x27;å°æ˜&#x27;, gender=&#x27;F&#x27;, score=100&#125;<br> WARN [main] - As you are using functionality that deserializes object streams, it is recommended to define the JEP-290 serial filter. Please refer to https://docs.oracle.com/pls/topic/lookup?ctx=javase15&amp;id=GUID-8296D8E8-2B93-4B9A-856E-0A65AF9B8C66<br>DEBUG [main] - Cache Hit Ratio [com.kzn.mapper.CacheMapper]: 0.5<br>Student&#123;id=1, class_id=1, name=&#x27;å°æ˜&#x27;, gender=&#x27;F&#x27;, score=100&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ¬¡æŸ¥è¯¢ä½¿ç”¨äº†ç¼“å­˜ï¼Œç¼“å­˜å‘½ä¸­ç‡0.5.</p><p>æ³¨æ„ï¼š</p><ul><li><strong>äºŒçº§ç¼“å­˜ä¾èµ–äºä¸€çº§ç¼“å­˜å†™å…¥</strong>ï¼Œä¸å…³é—­sqlSession1ï¼Œä¸ä¼šå†™å…¥å½“å‰namespaceçš„äºŒçº§ç¼“å­˜ï¼Œé€ æˆäºŒçº§ç¼“å­˜å¤±æ•ˆã€‚</li><li>MybatisäºŒçº§ç¼“å­˜å¯¹è±¡å­˜å‚¨åœ¨<strong>ç¡¬ç›˜</strong>ä¸­ï¼Œå› æ­¤éœ€è¦namespaceä¸‹å®ä½“å¯¹è±¡åºåˆ—åŒ–ï¼Œå¦‚æœä¸åºåˆ—è¯è¿è¡Œä¼šæŠ¥é”™ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>MyBatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatis-ç»“æœæ˜ å°„ï¼ˆresultMapï¼‰è¯¦è§£</title>
    <link href="/2025/05/18/MyBatis-%E9%AB%98%E7%BA%A7%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84/"/>
    <url>/2025/05/18/MyBatis-%E9%AB%98%E7%BA%A7%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h1id="mybatis-ç»“æœæ˜ å°„resultmapè¯¦è§£">MyBatis-ç»“æœæ˜ å°„ï¼ˆresultMapï¼‰è¯¦è§£</h1><h2 id="å‰è¨€">å‰è¨€</h2><p>çœ‹MyBatisç½‘è¯¾çš„æ—¶å€™è¿™ä¸€éƒ¨åˆ†æŠŠæˆ‘å¬çº¢æ¸©äº†ï¼Œé‚è‡ªå·±æ¢³ç†ã€‚</p><p>resultMapçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœJavaBeançš„å±æ€§åå’Œæ•°æ®åº“ä¸­çš„åˆ—åï¼ˆå­—æ®µåï¼‰åˆšå¥½ä¸€ä¸€å¯¹åº”å¹¶ä¸”åå­—ä¹Ÿç›¸åŒï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä»€ä¹ˆæ˜ å°„å…³ç³»äº†ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡SQLæŸ¥è¯¢å‡ºè¡¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯äº‹å®å¾€å¾€æ²¡é‚£ä¹ˆç†æƒ³ï¼Œå¾ˆå¤šæƒ…å†µä¸‹è¿™ä¸¤ä¸ªçš„åå­—å¹¶ä¸ç›¸åŒï¼Œç”šè‡³ä¸å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼›è€Œä¸”æˆ‘ä»¬å¯èƒ½å¹¶ä¸æ»¡è¶³äºä»…æŸ¥è¯¢ä¸€å¼ è¡¨ï¼Œè€Œæ˜¯è¦æŠŠä¸¤å¼ è¡¨çš„å…³é”®ä¿¡æ¯åˆåœ¨ä¸€èµ·ã€‚ä¸ç®¡æ˜¯é‚£ç§æƒ…å†µï¼Œéƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†æ˜ å°„å…³ç³»ã€‚</p><h2 id="ç›®å½•">ç›®å½•</h2><ol type="1"><li><ahref="#mybatisçš„ç»“æœæ˜ å°„resultmapè¯¦è§£">MyBatisçš„ç»“æœæ˜ å°„ï¼ˆresultMapï¼‰è¯¦è§£</a><ol type="1"><li><a href="#å‰è¨€">å‰è¨€</a></li><li><a href="#ç›®å½•">ç›®å½•</a></li><li><a href="#resultmap">resultMap</a></li><li><a href="#idå’Œresult">idå’Œresult</a></li><li><a href="#constructor">constructor</a><ol type="1"><li><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ„é€ æ–¹æ³•">ä¸ºä»€ä¹ˆéœ€è¦æ„é€ æ–¹æ³•</a></li><li><a href="#ç”¨æ³•">ç”¨æ³•</a></li></ol></li><li><a href="#association">association</a><ol type="1"><li><a href="#åµŒå¥—-select-æŸ¥è¯¢æŒ‰éœ€åŠ è½½">åµŒå¥— Select æŸ¥è¯¢ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰</a><ol type="1"><li><a href="#æ¦‚å¿µ">æ¦‚å¿µ</a></li><li><a href="#å®æˆ˜">å®æˆ˜</a></li><li><a href="#åæ€">åæ€</a></li></ol></li><li><a href="#åµŒå¥—ç»“æœæ˜ å°„">åµŒå¥—ç»“æœæ˜ å°„</a></li></ol></li><li><a href="#resultset">resultSet</a></li></ol></li></ol><h2 id="resultmap">resultMap</h2><p>ä¸€ä¸ªæ˜ å°„å…³ç³»ç”±<code>&lt;resultMap&gt;</code>æ ‡ç­¾åŒ…è£¹ï¼Œè€Œè¿™ä¸ªæ ‡ç­¾æœ¬èº«ä¹Ÿæœ‰å®ƒçš„å±æ€§ï¼š</p><ul><li><code>id</code>: <code>resultMap</code>æ ‡ç­¾çš„å”¯ä¸€æ ‡è¯†ã€‚</li><li><code>type</code>: è¿”å›å€¼çš„ Javaå…¨é™å®šç±»åï¼Œæˆ–ç±»å‹åˆ«åï¼ˆåœ¨å·²ç»å¤„ç†å¥½åˆ«åçš„æƒ…å†µä¸‹ï¼‰ã€‚</li><li><code>autoMapping</code>: MyBatis ç”¨æ¥æ§åˆ¶æ˜¯å¦è‡ªåŠ¨æ˜ å°„æ•°æ®åº“å­—æ®µåˆ°Java å¯¹è±¡å±æ€§çš„å¼€å…³ã€‚<code>autoMapping="true"</code>æ—¶ï¼ŒMyBatisä¼šè‡ªåŠ¨åŒ¹é…åˆ—åä¸å±æ€§åç›¸åŒçš„å­—æ®µã€‚åŒ¹é…è§„åˆ™ï¼š<ul><li>æ•°æ®åº“çš„åˆ—åä¸ Javaçš„å±æ€§ååŒ¹é…ï¼ˆå¿½ç•¥å¤§å°å†™ã€æ”¯æŒä¸‹åˆ’çº¿è½¬é©¼å³°ï¼‰ï¼›</li><li>æ²¡æœ‰è¢«<code>&lt;result&gt;</code>æ˜ç¡®æŒ‡å®š</li><li>å¿…é¡»ä¾èµ–<code>&lt;setting&gt;</code>ä¸­çš„å…¨å±€é…ç½®é¡¹ï¼š<code>&lt;setting name="mapUnderscoreToCamelCase" value="true"/&gt;</code></li></ul></li></ul><h2 id="idå’Œresult">idå’Œresult</h2><blockquote><p>id å’Œ result å…ƒç´ éƒ½å°†ä¸€ä¸ªåˆ—çš„å€¼æ˜ å°„åˆ°ä¸€ä¸ªç®€å•æ•°æ®ç±»å‹ï¼ˆString, int,double, Date ç­‰ï¼‰çš„å±æ€§æˆ–å­—æ®µã€‚</p></blockquote><p>ä¸¤ä¸ªå…ƒç´ çš„å¸¸ç”¨å±æ€§æœ‰ï¼š</p><ul><li><code>property</code>: æ˜ å°„åˆ°åˆ—ç»“æœçš„å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœ JavaBeanæœ‰è¿™ä¸ªåå­—çš„å±æ€§ï¼ˆpropertyï¼‰ï¼Œä¼šå…ˆä½¿ç”¨è¯¥å±æ€§ã€‚å¯ä»¥ç†è§£ä¸ºâ€œJavaçš„å®ä½“ç±»çš„å±æ€§â€ã€‚<ul><li><code>id</code>å…ƒç´ çš„<code>property</code>å¾€å¾€å–è¡¨ä¸­çš„ä¸»é”®å¯¹åº”çš„Java1å®ä½“ç±»çš„å±æ€§åï¼Œä¾‹å¦‚<code>&lt;id property="id" column="user_id" /&gt;</code>æ„æ€å°±æ˜¯è¡¨çš„ä¸»é”®åå­—æ˜¯<code>user_id</code>ï¼Œä¸ä¹‹å¯¹åº”çš„Javaå±æ€§åä¸º<code>id</code>ã€‚</li><li><code>result</code>å…ƒç´ çš„<code>property</code>ç”¨æ¥å®šä¹‰å…¶ä»–æ™®é€šå…ƒç´ å’Œè¡¨ä¸­çš„åˆ—çš„ä¸€ä¸€å¯¹åº”çš„æ˜ å°„å…³ç³»ã€‚</li></ul></li><li><code>column</code>ï¼šå·²ç»å­˜åœ¨çš„æ•°æ®åº“ä¸­çš„åˆ—åï¼Œå¦‚æœæœ‰åˆ«åçš„è¯ä¹Ÿå¯ä»¥æ˜¯åˆ«åã€‚</li><li><code>javaType</code>:Javaç±»çš„å…¨é™å®šåï¼Œå¯¹äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¦‚<code>java.lang.String</code>ï¼Œå¯ä»¥å†™ä¸º<code>String</code>ã€‚å¦‚æœæ˜ å°„åˆ°ä¸€ä¸ªJavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ï¼Œæ­¤é¡¹å¿½ç•¥ä¸å†™ã€‚</li></ul><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>id</code>ç”¨äºè®¾ç½®ä¸»é”®å­—æ®µä¸é¢†åŸŸæ¨¡å‹å±æ€§çš„æ˜ å°„å…³ç³»ï¼Œ<code>result</code>ç”¨äºè®¾ç½®æ™®é€šå­—æ®µä¸é¢†åŸŸæ¨¡å‹å±æ€§çš„æ˜ å°„å…³ç³»ã€‚</p><h2 id="constructor">constructor</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦æ„é€ æ–¹æ³•">ä¸ºä»€ä¹ˆéœ€è¦æ„é€ æ–¹æ³•</h3><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œå½“æˆ‘ä»¬æ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„æ—¶å€™ï¼ŒMyBatisä¸ä¼šç›´æ¥è¿”å›æ•°æ®åº“åŸå§‹æ•°æ®ï¼Œå®ƒä¼šæŠŠæŸ¥è¯¢ç»“æœâ€œæ˜ å°„â€æˆ<strong>Javaå¯¹è±¡</strong>è¿”å›ç»™ä½ ã€‚ä¾‹å¦‚ï¼Œ<code>SELECT id, name FROM user;</code>è¿™ä¸€sqlè¯­å¥ï¼Œå¦‚æœåœ¨MySQLä¸­ç›´æ¥è¿è¡Œï¼Œè¿”å›çš„æ˜¯ä¸€å¼ è¡¨æ ¼ï¼Œä½†ä½ æ€»ä¸èƒ½è®©Java è¿”å›åŸå§‹çš„ SQL è¡¨æ ¼å§ï¼Ÿä½ å¸Œæœ›å¾—åˆ°çš„æ˜¯<strong>Javaå¯¹è±¡</strong>ï¼Œå¯¹åº”ä¸‹é¢çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;User&gt; users = userMapper.selectAll();<br></code></pre></td></tr></table></figure><p>MyBatis ä¼šæŠŠé‚£å¼ è¡¨çš„æ¯ä¸€è¡Œæ„é€ æˆä¸€ä¸ª User å¯¹è±¡ï¼Œç„¶åæ”¾åˆ° Listé‡Œè¿”å›ã€‚</p><p>å¯¹äºä¸€èˆ¬çš„å¯å˜å¯¹è±¡ï¼ŒJavaBeanä¼šæä¾›ä¸€ä¸ª<code>setter</code>æ–¹æ³•ï¼Œæœ‰äº†è¿™ä¸ªæ–¹æ³•ä¹‹åäº‹æƒ…å°±å¾ˆå¥½åŠäº†ï¼Œåªéœ€è¦è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>u.setId(<span class="hljs-number">1</span>);<br>u.setName(<span class="hljs-string">&quot;Alice&quot;</span>);<br></code></pre></td></tr></table></figure><p>MyBatis å…ˆé€šè¿‡ç©ºå‚æ„é€ å™¨æ„å»ºä¸€ä¸ª<code>User</code>å¯¹è±¡ï¼Œç„¶åé€šè¿‡setter ä¸ºè¿™ä¸ªå¯¹è±¡ä¸€ä¸€èµ‹å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªç±»çš„å¯¹è±¡ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½æ›´æ”¹ï¼ˆå³ä¸å¯å˜ç±»ï¼‰ï¼Œä¾‹å¦‚ç”¨æˆ·çš„id ï¼Œåå­—å’Œå¹´é¾„åœ¨ç‰¹å®šæ—¶é—´æ®µå†…æ˜¯å›ºå®šä¸å˜çš„ï¼Œé‚£ä¹ˆ JavaBean å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String username;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-comment">// å…¨å‚æ„é€ å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, String username, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.username = username;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br>    <span class="hljs-comment">// æ²¡æœ‰ setter æ–¹æ³•</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ—¶æƒ³ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼ï¼Œæœ€ç›´æ¥çš„ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨æ„é€ å‡½æ•°ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±èµ‹å¥½å€¼ã€‚</p><p>å› ä¸º MyBatis ä¸èƒ½åƒåŸæ¥ä¸€æ ·è°ƒç”¨ setteræ¥èµ‹å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æ„é€ å‡½æ•°èµ‹å€¼ã€‚â€œèµ‹å€¼â€è¿™ä¸ªæ“ä½œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>æ³¨å…¥</strong>(injection)ï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·è¯´çš„ï¼š</p><blockquote><p>MyBatis ä¹Ÿæ”¯æŒç§æœ‰å±æ€§å’Œç§æœ‰ JavaBeanå±æ€§æ¥å®Œæˆæ³¨å…¥ï¼Œä½†æœ‰ä¸€äº›äººæ›´é’çäºé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚</p></blockquote><p>è¿™å¥è¯çš„æ„æ€å°±æ˜¯ï¼š<em>MyBatisä¹Ÿå¯ä»¥é€šè¿‡åå°„ç›´æ¥ä¿®æ”¹ç§æœ‰å­—æ®µçš„å€¼ï¼Œä½†è¿™ä¸æ€»æ˜¯æœ€å¥½çš„åšæ³•ã€‚å¾ˆå¤šç¨‹åºå‘˜æ›´å–œæ¬¢åªå…è®¸é€šè¿‡æ„é€ å‡½æ•°è®¾ç½®å±æ€§å€¼</em>ã€‚</p><p>ä¸Šé¢æåˆ°ï¼ŒMyBatisä¹Ÿå¯ä»¥é€šè¿‡åå°„ç›´æ¥æ³¨å…¥ç§æœ‰å­—æ®µï¼Œä¸è¿‡æœ‰äº›ç¨‹åºå‘˜è¿˜æ˜¯å–œæ¬¢ä½¿ç”¨æ„é€ æ–¹æ³•è¾¾æˆç›®çš„ï¼Œè€Œ<code>constructor</code>å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚</p><h3 id="ç”¨æ³•">ç”¨æ³•</h3><p>å‡è®¾æˆ‘ä»¬çš„æ•°æ®åº“ä¸­çš„å­—æ®µä¸ºï¼šuser_id, user_name, user_ageã€‚</p><p>å…ˆæŠŠ<code>User</code>éœ€è¦ç”¨åˆ°çš„æ–¹æ³•è¡¥å……å®Œæ•´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String username;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> <span class="hljs-type">int</span> id,</span><br><span class="hljs-params">                <span class="hljs-meta">@Param(&quot;username&quot;)</span> String username,</span><br><span class="hljs-params">                <span class="hljs-meta">@Param(&quot;age&quot;)</span> <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.username = username;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-comment">// getter æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> id; &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> username; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> age; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Mapperæ¥å£ï¼š<code>User selectUserById(int id);</code></p><p>ç„¶åä¸ºä¸Šé¢é‚£ä¸ª<code>User</code>å†™ä¸€ä¸ªXMLæ˜ å°„å§ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.example.User&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- æ„é€ å™¨ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">idArg</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_name&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_age&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">constructor</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUserById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;userMap&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span><br>    SELECT user_id, user_name, user_age FROM users WHERE user_id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>column=æ•°æ®åº“å­—æ®µå</code><br /></li><li><code>name=æ„é€ å™¨å‚æ•°å</code></li><li><code>idArg</code>æ˜¯ä¸»é”®ï¼Œ<code>arg</code>æ˜¯æ™®é€šå­—æ®µ</li><li>å› ä¸ºæˆ‘ä»¬åœ¨æ¥å£ä¸­ä½¿ç”¨<code>@Param</code>æ˜¾å¼ä¸ºå‚æ•°èµ·åï¼Œæ‰€ä»¥<code>&lt;constructor&gt;</code>å†…éƒ¨çš„é¡ºåºå¯ä»¥æ˜¯ä»»æ„çš„ã€‚</li></ul><h2 id="association">association</h2><p>å…³è”ï¼ˆassociationï¼‰å…ƒç´ å¤„ç†ä¸€å¯¹ä¸€ç±»å‹çš„å…³ç³»ã€‚MyBatisæœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼åŠ è½½å…³è”ï¼š</p><h3 id="åµŒå¥—-select-æŸ¥è¯¢æŒ‰éœ€åŠ è½½">åµŒå¥— Select æŸ¥è¯¢ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰</h3><h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4><ul><li>åµŒå¥— SelectæŸ¥è¯¢ï¼šä¹Ÿå«<strong>å»¶è¿ŸåŠ è½½</strong>ã€<strong>æŒ‰éœ€åŠ è½½</strong>ã€‚å®ƒæ˜¯é€šè¿‡è°ƒç”¨å¦ä¸€ä¸ªSQL æ˜ å°„è¯­å¥ï¼Œæ¥åŠ è½½å…³è”å¯¹è±¡çš„ã€‚</li></ul><p><strong>åµŒå¥—SelectæŸ¥è¯¢çš„ç‰¹ç‚¹</strong>ï¼šæŒ‰éœ€åŠ è½½ï¼Œä¹Ÿå°±æ˜¯â€œæ‡’æ±‰å¼â€ï¼›æ‰§è¡Œæ•ˆç‡ç¨æ…¢ã€‚</p><p>å‡å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">users(id, name, dept_id)<br>departments(id, dept_name)<br></code></pre></td></tr></table></figure><p>Javaå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-type">int</span> id;<br>    String name;<br>    Department dept;  <span class="hljs-comment">// å…³è”å±æ€§</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>selectAllById</code>æ–¹æ³•<code>User selectAllById(Integer id)</code>ï¼ŒUserçš„å‰ä¸¤ä¸ªå±æ€§éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒæŸ¥è¯¢èµ·æ¥å¾ˆç®€å•ã€‚ä½†æ˜¯<code>dept</code>å±äºå¼•ç”¨ç±»å‹ï¼Œ<strong>MyBatisä¸ä¼šè‡ªåŠ¨å¡«å……è¿™ç§å…³è”å­—æ®µ</strong>ï¼Œé™¤éæˆ‘æ˜¾å¼åœ°é…ç½®äº†å…³è”æŸ¥è¯¢ã€‚</p><p>æŒ‰ç…§åµŒå¥— SelectæŸ¥è¯¢çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ˜ å°„å…³ç³»ä¸­å°†<code>dept</code>å±æ€§å’Œ<code>selectDeptById</code>æ–¹æ³•å…³è”èµ·æ¥ï¼Œéœ€è¦æŸ¥è¯¢æ—¶å°±è°ƒç”¨<code>selectDeptById</code>éƒ¨é—¨æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å®šä¹‰æ˜ å°„å…³ç³» --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;Department&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;selectDeptById&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;dept_id&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- éƒ¨é—¨æŸ¥è¯¢è¯­å¥ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectDeptById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Department&quot;</span>&gt;</span><br>  SELECT id, dept_name AS deptName<br>  FROM departments<br>  WHERE id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>javaType</code>ç”¨äºä¿®é¥°<code>dept</code>å±æ€§ï¼ŒæŒ‡å®šè¯¥å±æ€§çš„æ•°æ®ç±»å‹ï¼›</li><li><code>select</code>æŒ‡å®šå…³è”çš„æ˜¯æŸ¥è¯¢æ–¹æ³•ï¼Œä¸”æ–¹æ³•åä¸º<code>selectDeptById</code>ï¼Œæ„æ€å°±æ˜¯<code>dept</code>è¿™ä¸ªå±æ€§æ˜¯é è¿™ä¸ªæŸ¥è¯¢è¯­å¥æŸ¥å‡ºæ¥çš„ã€‚</li><li><code>column</code>ä¸ºæ•°æ®åº“ä¸­çš„åˆ—åï¼Œè¿™é‡Œè¡¨ç¤ºå°†æ•°æ®åº“ä¸­çš„è¿™ä¸€å­—æ®µä½œä¸ºå‚æ•°<strong>ä¼ é€’</strong>ç»™<code>selectDeptById</code>è¯­å¥ï¼Œç”±<code>#&#123;id&#125;</code>æ¥æ”¶ã€‚<code>column</code>å¾€å¾€æ˜¯å¤šä¸ªè¡¨å…±æœ‰çš„åˆ—ã€‚</li></ul><p>ç„¶ååˆ©ç”¨<code>resultMap</code>å®šä¹‰æŸ¥è¯¢è¯­å¥å°±OKï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectAllById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;userMap&quot;</span>&gt;</span><br>SELECT * FROM users WHERE id = #&#123;id&#125;;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¾èµ–è°ƒç”¨<code>selectAllById</code>å°±èƒ½è·å–ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯äº†ã€‚</p><h4 id="å®æˆ˜">å®æˆ˜</h4><p>å¥½äº†ä¸‹é¢æ˜¯å®æˆ˜ç¯èŠ‚ğŸ¥°</p><p>ç°åœ¨æˆ‘çš„æ•°æ®åº“ä¸­æœ‰ä¸¤å¼ è¡¨ï¼š</p><ul><li>sys_user</li></ul><table><thead><tr><th>uid</th><th>username</th><th>user_pwd</th></tr></thead><tbody><tr><td>1</td><td>zhangsan</td><td>114411</td></tr><tr><td>2</td><td>æµ‹è¯•</td><td>111</td></tr><tr><td>3</td><td>CowBoy</td><td>2233</td></tr></tbody></table><ul><li>sys_schedule</li></ul><table><thead><tr><th>id</th><th>uid</th><th>title</th><th>completed</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>å­¦ä¹ Java</td><td>0</td></tr><tr><td>2</td><td>2</td><td>åƒé¥­</td><td>1</td></tr></tbody></table><p>ç›®æ ‡ï¼šå†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œèƒ½å¤ŸæŠŠæ‰€æœ‰ç”¨æˆ·æœ¬èº«çš„å±æ€§åŠå…¶å¯¹åº”çš„äº‹åŠ¡ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ¥ã€‚</p><p>æ ¹æ®ä¸¤å¼ è¡¨çš„å­—æ®µåï¼Œå®šä¹‰ä¸¤ä¸ªJavaç±»ï¼š</p><ul><li><code>User.java</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer uid;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String user_pwd;<br><br>    <span class="hljs-keyword">private</span> Schedule schedule;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(Integer uid, String username, String user_pwd)</span> &#123;<br>        <span class="hljs-built_in">this</span>.uid = uid;<br>        <span class="hljs-built_in">this</span>.username = username;<br>        <span class="hljs-built_in">this</span>.user_pwd = user_pwd;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String username, String user_pwd)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>        <span class="hljs-built_in">this</span>.user_pwd = user_pwd;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;uid=&quot;</span> + uid +<br>                <span class="hljs-string">&quot;, username=&#x27;&quot;</span> + username + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, user_pwd=&#x27;&quot;</span> + user_pwd + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, schedule=&quot;</span> + schedule +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>schedule.java</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Schedule</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer sid;<br>    <span class="hljs-keyword">private</span> Integer uid;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> Integer completed;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Schedule</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Schedule&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;sid=&quot;</span> + sid +<br>                <span class="hljs-string">&quot;, uid=&quot;</span> + uid +<br>                <span class="hljs-string">&quot;, title=&#x27;&quot;</span> + title + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, completed=&quot;</span> + completed +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢å¼€å§‹è€ƒè™‘æ¥å£ã€‚</p><p><code>sys_user</code>è®°å½•äº†æ¯ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œ<code>sys_schedule</code>è®°å½•äº†ç”¨æˆ·çš„äº‹åŠ¡ï¼Œä¸¤å¼ è¡¨é€šè¿‡ä¸»é”®<code>uid</code>å…³è”èµ·æ¥ã€‚ç°åœ¨çš„ç›®æ ‡æ˜¯ï¼šå†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œèƒ½å¤ŸæŠŠæ‰€æœ‰ç”¨æˆ·çš„æ‰€æœ‰è‡ªå¸¦å±æ€§åŠå…¶å¯¹åº”çš„äº‹åŠ¡ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ¥ã€‚ç¼–å†™æ¥å£å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰“å°æ‰€æœ‰çš„ç”¨æˆ·åŠå…¶å¯¹åº”çš„æ—¥ç¨‹</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> åŒ…å«æ‰€æœ‰å±æ€§çš„ç”¨æˆ·å®ä½“ç±»</span><br><span class="hljs-comment"> */</span><br>List&lt;User&gt; <span class="hljs-title function_">getAllUserAndSchedule</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>æ—¢ç„¶è¦æŸ¥è¯¢æ—¥ç¨‹ï¼Œé‚£å°±å°‘ä¸äº†æŸ¥è¯¢æ—¥ç¨‹çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨<code>ScheduleMapper.java</code>æ·»åŠ æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ScheduleMapper</span> &#123;<br>    <span class="hljs-comment">// æ ¹æ®uidæŸ¥è¯¢ç”¨æˆ·çš„äº‹åŠ¡</span><br>    Schedule <span class="hljs-title function_">getScheduleByUid</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;uid&quot;)</span> Integer uid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>OKä¸‹é¢å¯ä»¥é…ç½®XMLäº†ã€‚å…ˆä»æœ€ç®€å•çš„æ—¥ç¨‹çš„æŸ¥è¯¢å¼€å§‹ï¼Œåœ¨<code>ScheduleMapper.xml</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Schedule getScheduleByUid(Integer uid);--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getScheduleByUid&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Integer&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Schedule&quot;</span>&gt;</span><br>    SELECT *<br>    FROM sys_schedule<br>    WHERE uid = #&#123;uid&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å¾ˆç®€å•çš„æ ¹æ®<code>uid</code>æŸ¥è¯¢æŒ‡å®šæ—¥ç¨‹çš„sqlè¯­å¥ã€‚</p><p>æ¥ä¸‹æ¥åœ¨<code>UserMapper.xml</code>é…ç½®æ˜ å°„å…³ç³»å’ŒæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è·å–æ‰€æœ‰çš„ç”¨æˆ·åŠå…¶å®ä½“ç±»ï¼Œæµ‹è¯•associateæ ‡ç­¾--&gt;</span><br><span class="hljs-comment">&lt;!--  User getAllUserAndSchedule();--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ScheduleAndUser&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;schedule&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.kzn.mapper.ScheduleMapper.getScheduleByUid&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllUserAndSchedule&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ScheduleAndUser&quot;</span>&gt;</span><br>    SELECT * FROM sys_user LIMIT 3<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå› ä¸ºåœ¨æ˜ å°„å…³ç³»ä¸­å¼•ç”¨çš„<code>getScheduleByUid</code>æ–¹æ³•çš„XMLé…ç½®ä½äºå¦ä¸€ä¸ªXMLæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œå¯¹è¯¥æ–¹æ³•çš„å¼•ç”¨è¦ä½¿ç”¨<code>å…¨ç±»å.æ–¹æ³•å</code>çš„å½¢å¼ã€‚</p><p>æ‰€æœ‰çš„ä»£ç éƒ½å‡†å¤‡å®Œæ¯•ä¹‹åå°±å¯ä»¥æµ‹è¯•äº†ã€‚å‡†å¤‡å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetUserAndSchedule</span><span class="hljs-params">()</span> &#123;<br>    List&lt;User&gt; allUserAndSchedule = userMapper.getAllUserAndSchedule();<br>    allUserAndSchedule.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ˆé™„å¸¦æ—¥å¿—åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘æ‰‹åŠ¨åŠ äº†ç©ºè¡Œæ–¹ä¾¿é˜…è¯»ï¼‰ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: SELECT * FROM sys_user LIMIT 3<br>DEBUG [main] - ==&gt; Parameters: <br>TRACE [main] - &lt;==    Columns: uid, username, user_pwd<br>TRACE [main] - &lt;==        Row: 1, zhangsan, 114411<br>DEBUG [main] - ====&gt;  Preparing: SELECT * FROM sys_schedule WHERE uid = ?<br>DEBUG [main] - ====&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;====    Columns: sid, uid, title, completed<br>TRACE [main] - &lt;====        Row: 1, 1, å­¦ä¹ Java, 0<br>DEBUG [main] - &lt;====      Total: 1<br><br>TRACE [main] - &lt;==        Row: 2, æµ‹è¯•, 111<br>DEBUG [main] - ====&gt;  Preparing: SELECT * FROM sys_schedule WHERE uid = ?<br>DEBUG [main] - ====&gt; Parameters: 2(Integer)<br>TRACE [main] - &lt;====    Columns: sid, uid, title, completed<br>TRACE [main] - &lt;====        Row: 2, 2, åƒé¥­, 1<br>DEBUG [main] - &lt;====      Total: 1<br><br>TRACE [main] - &lt;==        Row: 3, CowBoy, 2233<br>DEBUG [main] - ====&gt;  Preparing: SELECT * FROM sys_schedule WHERE uid = ?<br>DEBUG [main] - ====&gt; Parameters: 3(Integer)<br>DEBUG [main] - &lt;====      Total: 0<br>DEBUG [main] - &lt;==      Total: 3<br><br>User&#123;uid=1, username=&#x27;zhangsan&#x27;, user_pwd=&#x27;114411&#x27;, schedule=Schedule&#123;sid=1, uid=1, title=&#x27;å­¦ä¹ Java&#x27;, completed=0&#125;&#125;<br>User&#123;uid=2, username=&#x27;æµ‹è¯•&#x27;, user_pwd=&#x27;111&#x27;, schedule=Schedule&#123;sid=2, uid=2, title=&#x27;åƒé¥­&#x27;, completed=1&#125;&#125;<br>User&#123;uid=3, username=&#x27;CowBoy&#x27;, user_pwd=&#x27;2233&#x27;, schedule=null&#125;<br></code></pre></td></tr></table></figure><p>ä»æ—¥å¿—ä¸­å¯ä»¥ç›´è§‚åœ°å‘ç°ä¸€å…±æ‰§è¡Œäº†4æ¬¡æŸ¥è¯¢æ“ä½œï¼ˆæ¯ä¸€ç»„<code>==&gt;</code>éƒ½å¯¹åº”ä¸€æ¬¡æŸ¥è¯¢è¯·æ±‚ï¼‰ã€‚</p><h4 id="åæ€">åæ€</h4><p>åµŒå¥— Selectçš„å¤ç”¨æ€§æ›´å¾ˆå¥½ï¼Œç»“æ„ä¹Ÿå¾ˆæ¸…æ™°ï¼Œæ–¹ä¾¿ç»´æŠ¤ï¼Œä½†æ˜¯å®ƒä¼šå¯¼è‡´æ‰€è°“çš„<strong>N+1æŸ¥è¯¢é—®é¢˜</strong>ï¼Œç»“åˆä¸Šé¢çš„ä¾‹å­å°±å¾ˆå¥½è¯´æ˜ï¼š</p><ul><li><code>1</code>ï¼ŒæŒ‡çš„æ˜¯æ“ä½œè€…è°ƒç”¨äº†ä¸€æ¬¡æŸ¥è¯¢è¯­å¥<code>getAllUserAndSchedule</code>ï¼Œæ“ä½œè€…æœŸæœ›ä¸€æ¬¡è¿”å›æ‰€æœ‰çš„ç”¨æˆ·åŠå…¶æ—¥ç¨‹</li><li><code>N</code>ï¼Œä¸ºäº†å®Œæˆ<code>getAllUserAndSchedule</code>çš„æŸ¥è¯¢å‘½ä»¤ï¼Œå¯¹äºNä¸ªç”¨æˆ·ï¼ŒMyBatisä¸€å…±éœ€è¦è°ƒç”¨Næ¬¡<code>getScheduleByUid</code>æŸ¥è¯¢è¯­å¥ä»¥è·å–æ—¥ç¨‹ä¿¡æ¯ã€‚</li></ul><p>å®è§‚è°ƒç”¨çš„ä¸€æ¬¡åŠ ä¸ŠMyBatiså†…éƒ¨è°ƒç”¨çš„Næ¬¡ï¼Œåˆèµ·æ¥å°±æ˜¯N+1æ¬¡ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªé—®é¢˜ä¼šå¯¼è‡´æˆç™¾ä¸Šåƒçš„SQL è¯­å¥è¢«æ‰§è¡Œï¼Œæ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„ã€‚</p><blockquote><p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒMyBatisèƒ½å¤Ÿå¯¹è¿™æ ·çš„æŸ¥è¯¢è¿›è¡Œ<strong>å»¶è¿ŸåŠ è½½</strong>ï¼Œå› æ­¤å¯ä»¥å°†å¤§é‡è¯­å¥åŒæ—¶è¿è¡Œçš„å¼€é”€åˆ†æ•£å¼€æ¥ã€‚ç„¶è€Œï¼Œå¦‚æœä½ åŠ è½½è®°å½•åˆ—è¡¨ä¹‹åç«‹åˆ»å°±éå†åˆ—è¡¨ä»¥è·å–åµŒå¥—çš„æ•°æ®ï¼Œå°±ä¼šè§¦å‘æ‰€æœ‰çš„å»¶è¿ŸåŠ è½½æŸ¥è¯¢ï¼Œæ€§èƒ½å¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿç³•ã€‚</p></blockquote><p>æ‰€ä»¥è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•â€”â€”<strong>åµŒå¥—ç»“æœæ˜ å°„</strong>ã€‚</p><h3 id="åµŒå¥—ç»“æœæ˜ å°„">åµŒå¥—ç»“æœæ˜ å°„</h3><ul><li>åµŒå¥—ç»“æœæ˜ å°„ï¼šä½¿ç”¨åµŒå¥—çš„ç»“æœæ˜ å°„æ¥å¤„ç†è¿æ¥ç»“æœçš„é‡å¤å­é›†ã€‚</li></ul><p>åµŒå¥—ç»“æœæ˜ å°„çš„æŸ¥è¯¢æ–¹å¼æœ¬è´¨ä¸Šè¿˜æ˜¯MySQLçš„<ahref="/2025/05/06/MySQLåŸºæœ¬ä½¿ç”¨/#å¤šè¡¨æŸ¥è¯¢è”ç»“è¡¨">å¤šè¡¨æŸ¥è¯¢</a>ã€‚ä»ç„¶ä»¥ä¸Šé¢çš„æƒ…å†µä¸ºä¾‹ï¼Œè¦æŠŠç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œæ—¥ç¨‹æ”¾åœ¨ä¸€èµ·å¹¶ä¸”ä¿è¯ç”¨æˆ·çš„ä¿¡æ¯ä¸€ä¸ªä¸å°‘ï¼Œé‚£ä¸å°±æ˜¯å¤–éƒ¨é“¾æ¥æŸ¥è¯¢å—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> user.uid, user.Username, schedule.title<br><span class="hljs-keyword">FROM</span> sys_user <span class="hljs-keyword">AS</span> <span class="hljs-keyword">user</span><br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> sys_schedule <span class="hljs-keyword">AS</span> schedule<br><span class="hljs-keyword">ON</span> schedule.uid <span class="hljs-operator">=</span> user.uid<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user.uid<br>LIMIT <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>ï¼ˆè¿™æ˜¯åˆ©ç”¨ORDER BYæ˜¯å› ä¸ºä¸è¿™æ ·åšçš„è¯è¾“å‡ºä¼šä¹±åºï¼‰</p><p>æ‰€ä»¥åªè¦æŠŠå‰©ä¸‹çš„xmlé…ç½®åšå¥½å°±è¡Œäº†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åµŒå¥—æ˜ å°„æ–¹å¼--&gt;</span><br><span class="hljs-comment">&lt;!--List&lt;User&gt; getAllUserAndSchedule_mapping();--&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ScheduleAndUserMapping&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--ç¬¬ä¸‰åˆ—ä½¿ç”¨æ˜ å°„è§£å†³--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;schedule&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--æŠŠè¡¨ä¸­çš„titleå­—æ®µæ˜ å°„åˆ°Scheduleçš„titleå±æ€§--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;title&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getAllUserAndSchedule_mapping&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ScheduleAndUserMapping&quot;</span>&gt;</span><br>    SELECT user.uid, user.Username, schedule.title<br>    FROM sys_user AS user<br>    LEFT JOIN sys_schedule AS schedule<br>    ON schedule.uid = user.uid<br>    ORDER BY user.uid<br>    LIMIT 3<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: SELECT user.uid, user.Username, schedule.title FROM sys_user AS user LEFT JOIN sys_schedule AS schedule ON schedule.uid = user.uid ORDER BY user.uid LIMIT 3<br>DEBUG [main] - ==&gt; Parameters: <br>TRACE [main] - &lt;==    Columns: uid, Username, title<br>TRACE [main] - &lt;==        Row: 1, zhangsan, å­¦ä¹ Java<br>TRACE [main] - &lt;==        Row: 2, æµ‹è¯•, åƒé¥­<br>TRACE [main] - &lt;==        Row: 3, CowBoy, null<br>DEBUG [main] - &lt;==      Total: 3<br><br>User&#123;uid=1, username=&#x27;zhangsan&#x27;, user_pwd=&#x27;null&#x27;, schedule=Schedule&#123;sid=null, uid=null, title=&#x27;å­¦ä¹ Java&#x27;, completed=null&#125;&#125;<br>User&#123;uid=2, username=&#x27;æµ‹è¯•&#x27;, user_pwd=&#x27;null&#x27;, schedule=Schedule&#123;sid=null, uid=null, title=&#x27;åƒé¥­&#x27;, completed=null&#125;&#125;<br>User&#123;uid=3, username=&#x27;CowBoy&#x27;, user_pwd=&#x27;null&#x27;, schedule=null&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢å‡ºçš„æ•°æ®åªæœ‰ä¸‰åˆ—ï¼šuid, username,titleï¼Œæ²¡æœ‰æŸ¥è¯¢çš„æ•°æ®å‡æ˜¾ç¤ºä¸ºnullï¼Œè¿™æ ·åªæŸ¥è¯¢äº†å¿…è¦çš„æ•°æ®ã€‚</p><p>è€Œä¸”ï¼Œä»æ—¥å¿—å¯ä»¥å‘ç°å…¨ç¨‹åªæ‰§è¡Œäº†ä¸€æ¬¡æŸ¥è¯¢æ“ä½œï¼Œå¤§å¤§æé«˜æ‰§è¡Œçš„æ•ˆç‡ã€‚</p><h2 id="resultset">resultSet</h2><div class="note note-secondary">            <p>æŸäº›æ•°æ®åº“å…è®¸å­˜å‚¨è¿‡ç¨‹è¿”å›å¤šä¸ªç»“æœé›†(resultSet)ï¼Œæˆ–ä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œæ¯ä¸ªè¯­å¥è¿”å›ä¸€ä¸ªç»“æœé›†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨ä¸ä½¿ç”¨è¿æ¥çš„æƒ…å†µä¸‹ï¼Œåªè®¿é—®æ•°æ®åº“ä¸€æ¬¡å°±èƒ½è·å¾—ç›¸å…³æ•°æ®ã€‚</p>          </div><p>æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ä¸€æ¬¡æ€§æ‰§è¡Œäº†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„æŸ¥è¯¢å’Œæ—¥ç¨‹çš„æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> get_student_by_id (<br>    <span class="hljs-keyword">IN</span> p_uid <span class="hljs-type">INT</span><br>)<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys_user <span class="hljs-keyword">WHERE</span> uid <span class="hljs-operator">=</span> p_uid;<br>    <span class="hljs-keyword">SELECT</span> uid, title, completed <span class="hljs-keyword">FROM</span> sys_schedule <span class="hljs-keyword">WHERE</span> uid <span class="hljs-operator">=</span> p_uid;<br><span class="hljs-keyword">END</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>åœ¨DBeaverä¸­è°ƒç”¨è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">&#123; <span class="hljs-keyword">CALL</span> schedule_system.get_student_by_id(<span class="hljs-number">1</span>) &#125;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/19/pEvL4Cq.png" alt="ç¬¬ä¸€å¼ è¡¨" /><figcaption aria-hidden="true">ç¬¬ä¸€å¼ è¡¨</figcaption></figure><figure><img src="https://s21.ax1x.com/2025/05/19/pEvLbb4.png" alt="ç¬¬äºŒå¼ è¡¨" /><figcaption aria-hidden="true">ç¬¬äºŒå¼ è¡¨</figcaption></figure><p>è¿™æ˜¯ä¸¤å¼ ç‹¬ç«‹çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª<strong>ç»“æœé›†</strong>ã€‚</p><p>æˆ‘ä»¬è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•ç”¨MyBatiså®Œæˆå¯¹å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨ï¼Œä»¥åŠè°ƒç”¨å®Œæˆä¹‹åå¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªç»“æœé›†ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯<strong>é¿å…ä½¿ç”¨è¿æ¥æŸ¥è¯¢</strong>ï¼Œæ”¹ç”¨â€œå¤šä¸ªç‹¬ç«‹ç»“æœé›†â€ï¼Œæ¥å‡å°‘æ•°æ®åº“çš„è´Ÿæ‹…ã€‚</p><hr /><p>å®šä¹‰ä»¥ä¸‹æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">User <span class="hljs-title function_">getUserByResultSet</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;uid&quot;)</span> Integer uid)</span>;<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“ä¸­å·²ç»æœ‰å­˜å‚¨è¿‡ç¨‹<code>get_student_by_id(IN p_uid INT)</code>ï¼Œæƒ³è¦ä½¿ç”¨è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œæ˜ å°„è¯­å¥å¦‚ä¸‹ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é€šè¿‡ç»“æœé›†æŸ¥è¯¢--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectByResultSet&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--å®šä¹‰ç¬¬ä¸€ä¸ªç»“æœé›†--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;user_pwd&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_pwd&quot;</span>/&gt;</span><br><br>    <span class="hljs-comment">&lt;!--å®šä¹‰ç¬¬äºŒä¸ªç»“æœé›†--&gt;</span><br>    <span class="hljs-comment">&lt;!--column è¡¨ç¤ºç¬¬ä¸€ä¸ªç»“æœé›†ä¸­çš„å­—æ®µï¼ˆé€šå¸¸æ˜¯ä¸»è¡¨å­—æ®µï¼‰ï¼Œ</span><br><span class="hljs-comment">         foreignColumn è¡¨ç¤ºç¬¬äºŒä¸ªç»“æœé›†ä¸­çš„å­—æ®µï¼ˆé€šå¸¸æ˜¯å­è¡¨å­—æ®µï¼‰ã€‚--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;schedule&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;Schedule&quot;</span> <span class="hljs-attr">resultSet</span>=<span class="hljs-string">&quot;resultSet2&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">foreignColumn</span>=<span class="hljs-string">&quot;uid&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--è¿™é‡Œå¿…é¡»å’Œå­˜å‚¨è¿‡ç¨‹çš„ç¬¬äºŒä¸ªè¯­å¥å®Œå…¨å¯¹åº”--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;title&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;completed&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;completed&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--getUserByResultSet--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByResultSet&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;selectByResultSet&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">statementType</span>=<span class="hljs-string">&quot;CALLABLE&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">resultSets</span>=<span class="hljs-string">&quot;resultSet1,resultSet2&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--#&#123;ä¼ å…¥å‚æ•°å, jdbcType=ç±»å‹, mode=æ¨¡å¼&#125;--&gt;</span><br>    &#123;CALL get_student_by_id(#&#123;uid, jdbcType=INTEGER, mode=IN&#125;)&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p><ul><li><code>association</code>çš„<code>column</code>è¡¨ç¤º<strong>ä¸»ç»“æœé›†</strong>ï¼ˆçˆ¶ç»“æœé›†ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªç»“æœé›†<code>sys_user</code>è¡¨ï¼‰ä¸­çš„å­—æ®µï¼Œ<code>foreignColumn</code>è¡¨ç¤º<strong>å…³è”ç»“æœé›†</strong>ï¼ˆå­ç»“æœé›†ï¼Œæ¯”å¦‚<code>sys_schedule</code>è¡¨ï¼‰ä¸­çš„å­—æ®µåŒ¹é…ã€‚</li><li><code>resultSets</code>ç»“æœé›†çš„å‘½åé»˜è®¤ä¸º<code>resultSet1, resultSet2, ...</code>ï¼Œè¿™é‡Œæ²¡æœ‰èµ·åˆ«åï¼Œç›´æ¥ç”¨é»˜è®¤çš„äº†</li></ul><p>ç„¶åæµ‹è¯•è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: &#123;CALL get_student_by_id(?)&#125;<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: uid, username, user_pwd<br>TRACE [main] - &lt;==        Row: 1, zhangsan, 114411<br>DEBUG [main] - &lt;==      Total: 1<br>TRACE [main] - &lt;==    Columns: uid, title, completed<br>TRACE [main] - &lt;==        Row: 1, å­¦ä¹ Java, 0<br>DEBUG [main] - &lt;==      Total: 1<br>DEBUG [main] - &lt;==    Updates: 0<br>User&#123;uid=1, username=&#x27;zhangsan&#x27;, user_pwd=&#x27;114411&#x27;, schedule=Schedule&#123;sid=null, uid=1, title=&#x27;å­¦ä¹ Java&#x27;, completed=0&#125;&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œæ²¡æœ‰æŸ¥è¯¢<code>sid</code>ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸ºnullã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MyBatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatisé…ç½®è¿‡ç¨‹å’ŒåŸºæœ¬ç”¨æ³•</title>
    <link href="/2025/05/14/MyBatis%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/"/>
    <url>/2025/05/14/MyBatis%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯-mybatis">ä»€ä¹ˆæ˜¯ MyBatis</h1><p>MyBatisæ˜¯ä¸€ä¸ªJavaæŒä¹…åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡XMLæè¿°ç¬¦æˆ–æ³¨è§£æŠŠå¯¹è±¡ä¸å­˜å‚¨è¿‡ç¨‹æˆ–SQLè¯­å¥å…³è”èµ·æ¥ï¼Œæ˜ å°„æˆæ•°æ®åº“å†…å¯¹åº”çš„çºªå½•ã€‚<ahref="https://mybatis.org/mybatis-3/zh_CN/index.html">å®˜æ–¹æ–‡æ¡£åœ°å€</a></p><p>MyBatis å±äº SSMæ¡†æ¶çš„æ•°æ®è®¿é—®å±‚ï¼Œæœ‰äº†å®ƒå°±ä¸å¿…å†å†™JDBCé‚£ç§ç¹ççš„æ“ä½œæ•°æ®åº“çš„ä»£ç ï¼Œæ›´ç®€å•æ˜“ç”¨ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Controllerï¼ˆæ§åˆ¶å±‚ï¼‰       &lt;<span class="hljs-comment">-- SpringMVC</span><br>   â†“<br>Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰       &lt;<span class="hljs-comment">-- Spring</span><br>   â†“<br>DAO / Mapperï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰ &lt;<span class="hljs-comment">-- MyBatis</span><br>   â†“<br><span class="hljs-keyword">Database</span>ï¼ˆæ•°æ®åº“ï¼‰<br></code></pre></td></tr></table></figure><h1 id="é…ç½®-mybatis">é…ç½® MyBatis</h1><ol type="1"><li>ä½¿ç”¨IDEA<strong>åˆ›å»º</strong>ä¸€ä¸ªMavenå·¥ç¨‹ï¼ŒåŠ å…¥mybatis, junit,mysql-connector-jä¾èµ–ï¼š</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.mysql/mysql-connector-j --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>åœ¨resourcesç›®å½•ä¸‹<strong>åˆ›å»º</strong><code>mybatis-config.xml</code>é…ç½®æ–‡ä»¶ï¼ˆå‚æ•°æ”¹æˆè‡ªå·±çš„ï¼‰</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- è®¾ç½®å®ä½“ç±»çš„åˆ«åï¼Œè¿™æ ·ä»¥åå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»åè€Œä¸ç”¨å†å†™å…¨ç±»åäº† --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.kzn.pojo&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/schedule_system&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;************&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>åœ¨javaç›®å½•ä¸‹<strong>åˆ›å»º</strong>pojoåŒ…å’ŒmapperåŒ…ï¼Œåˆ†åˆ«å­˜æ”¾è¡¨å¯¹åº”çš„å®ä½“ç±»å’Œå¤„ç†æ˜ å°„å…³ç³»çš„æ¥å£ã€‚å­˜åœ¨è¿™æ ·çš„å¯¹åº”å…³ç³»ï¼š<code>è¡¨â€”â€”å®ä½“ç±»â€”â€”mapperæ¥å£â€”â€”æ˜ å°„æ–‡ä»¶</code>ã€‚</li></ol><p>ç„¶ååˆ›å»ºæ˜ å°„æ–‡ä»¶ã€‚æ˜ å°„æ–‡ä»¶ç”¨äºå°†æˆ‘ä»¬åˆ›å»ºçš„æ¥å£å’Œsqlè¯­å¥å»ºç«‹è”ç³»ã€‚è€ƒè™‘åˆ°ä¸€ä¸ªé¡¹ç›®ä¸­ä¼šå­˜åœ¨å¤šä¸ªæ¥å£ï¼Œå› æ­¤åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºmappersæ–‡ä»¶å¤¹ç»Ÿä¸€ç®¡ç†<code>.xml</code>æ–‡ä»¶ï¼š</p><figure><img src="https://s21.ax1x.com/2025/05/14/pEj8Phj.png" alt="é¡¹ç›®ç»“æ„" /><figcaption aria-hidden="true">é¡¹ç›®ç»“æ„</figcaption></figure><ol start="4" type="1"><li><strong>MyBatis é¢å‘æ¥å£ç¼–ç¨‹çš„ä¸¤ä¸ªä¸€è‡´</strong><ol type="1"><li>æ˜ å°„æ–‡ä»¶çš„<code>namespace</code>å’Œå¯¹åº”æ¥å£çš„<strong>å…¨ç±»å</strong>ä¿æŒä¸€è‡´</li><li>æ˜ å°„æ–‡ä»¶ä¸­sqlè¯­å¥çš„idå’Œmapperæ¥å£ä¸­å®šä¹‰çš„<strong>æ–¹æ³•å</strong>ä¸€è‡´</li></ol></li></ol><p>ä»¥ä¸Šä¸¤ç‚¹æ˜¯å¦‚ä½•ä½“ç°çš„å‘¢ï¼Ÿå…ˆå†™<code>UserMapper.xml</code>é…ç½®ï¼ˆè¿™é‡Œæ˜¯sqlçš„æ’å…¥è¯­å¥ï¼‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- å‘½åç©ºé—´æ˜¯æ¥å£çš„å…¨ç±»å --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.kzn.mapper.UserMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertUser&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--è¿™é‡Œå°±å¯ä»¥æ„‰å¿«åœ°å†™ sql è¯­å¥å•¦--&gt;</span><br>        <span class="hljs-comment">&lt;!-- è¿™é‡Œä½¿ç”¨åŠ¨æ€sql --&gt;</span><br>        insert into sys_user (username, user_pwd)<br>        values (#&#123;username&#125;, #&#123;user_pwd&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å¯¹åº”çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‘è¡¨ä¸­æ’å…¥æ–°ç”¨æˆ·</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> user æ–°ç”¨æˆ·çš„å®ä¾‹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¯¹æ•°æ®åº“å½±å“çš„è¡Œæ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">insertUser</span><span class="hljs-params">(User user)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†™é…ç½®æ–‡ä»¶æ—¶å°±éµå¾ªäº†è¿™ä¸¤ä¸ªåŸåˆ™ï¼š</p><ul><li><code>namespace</code>æ”¹æˆå¯¹åº”æ¥å£çš„å…¨ç±»åï¼š<code>com/kzn/mapper/UserMapper</code></li><li><code>mapper</code>æ ‡ç­¾å†…éƒ¨å†™æ˜ å°„è¯­å¥ï¼Œå¹¶ä¸”æ˜ å°„è¯­å¥çš„æ ‡ç­¾åå°±æ˜¯è¦å¯¹æ•°æ®åº“è¿›è¡Œçš„æ“ä½œ(<code>insert</code>)ï¼›<code>id</code>å±æ€§è¦å’Œæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•å(æ­¤å¤„ä¸º<code>insertUser</code>)ä¿æŒä¸€è‡´ã€‚</li></ul><ol start="5" type="1"><li><strong>å‘æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¼•å…¥æ˜ å°„æ–‡ä»¶</strong></li></ol><p><code>mappers</code>æ ‡ç­¾åœ¨åˆšæ‰å¤åˆ¶ç²˜è´´çš„æ¨¡æ¿ä¸­å·²ç»å­˜åœ¨ï¼Œåªéœ€è¦ä¿®æ”¹å†…å®¹å³å¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="6" type="1"><li>æµ‹è¯•åŠŸèƒ½æ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestMyBatis</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">//åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span><br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>);<br>        <span class="hljs-comment">// è·å–SqlSessionFactoryBuilder ï¼ˆå·¥å‚æ¨¡å¼ï¼‰</span><br>        <span class="hljs-type">SqlSessionFactoryBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();<br>        <span class="hljs-comment">// è·å–SqlSessionFactory</span><br>        <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> builder.build(is);<br>        <span class="hljs-comment">// è·å–SqlSession: Javaç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„å¯¹è¯</span><br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> factory.openSession();<br>        <span class="hljs-comment">// è·å–mapperæ¥å£çš„å®ç°ç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆåº•å±‚é‡‡ç”¨ä»£ç†æ¨¡å¼ï¼‰</span><br>        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">userMapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);<br>        <span class="hljs-comment">// ç„¶ååˆ©ç”¨æ¥å£çš„å®ç°ç±»å¯¹è±¡ï¼Œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.insertUser(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;Origami&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>));<br>        <span class="hljs-comment">// æäº¤äº‹åŠ¡</span><br>        sqlSession.commit();<br>        System.out.println(result);<br><br>        sqlSession.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>factory.openSession();</code>å¯ä»¥ä¼ å…¥<code>boolean</code>å‚æ•°å†³å®šæ˜¯å¦è‡ªåŠ¨æäº¤ï¼Œ<code>true</code>ä¸ºå¼€å¯è‡ªåŠ¨æäº¤ï¼Œ<code>false</code>ä¸ºå…³é—­è‡ªåŠ¨æäº¤ã€‚é»˜è®¤ä¸º<code>false</code>ã€‚</p><p>è·å–mapperæ¥å£çš„å®ç°ç±»çš„å®ä¾‹å¯¹è±¡ä¹‹å‰çš„ä»£ç å¯¹äºæ¯ä¸ªæµ‹è¯•éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸å¦¨æŠŠå®ƒå°è£…æˆä¸€ä¸ªæµ‹è¯•ç±»<code>MyBatisUtils.java</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisUtils</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlSessionFactory sqlSessionFactory;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>);<br>            sqlSessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(is);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;åˆå§‹åŒ–SqlSessionFactoryå¤±è´¥&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å– SqlSessionï¼ˆå¯ä»¥è‡ªåŠ¨æäº¤æˆ–æ‰‹åŠ¨æäº¤ï¼‰</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSqlSession</span><span class="hljs-params">(<span class="hljs-type">boolean</span> autoCommit)</span> &#123;<br>        <span class="hljs-keyword">return</span> sqlSessionFactory.openSession(autoCommit);<br>    &#125;<br>    <span class="hljs-comment">// è·å– SqlSession é»˜è®¤æ‰‹åŠ¨æäº¤</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSqlSession</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> getSqlSession(<span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰äº†è¿™æ ·ä¸€ä¸ªå·¥å…·ç±»ä»¥åï¼Œå°±å¯ä»¥åœ¨æµ‹è¯•ä¸­ç›´æ¥ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MyBatisUtils.getSqlSession()) &#123;<br>    <span class="hljs-comment">// é€šè¿‡ sqlSession è·å–æ¥å£çš„å®ç°ç±»çš„å®ä¾‹å¯¹è±¡</span><br><br>    <span class="hljs-comment">//è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ—¥å¿—çš„é…ç½®">æ—¥å¿—çš„é…ç½®</h2><p>Mybatisé€šè¿‡ä½¿ç”¨å†…ç½®çš„æ—¥å¿—å·¥å‚æä¾›æ—¥å¿—åŠŸèƒ½ã€‚å†…ç½®æ—¥å¿—å·¥å‚å°†ä¼šæŠŠæ—¥å¿—å·¥ä½œå§”æ‰˜ç»™ä¸‹é¢çš„å®ç°ä¹‹ä¸€ï¼š</p><ul><li>SLF4J</li><li>Apache Commons Logging</li><li>Log4j 2</li><li>Log4jï¼ˆ3.5.9èµ·åºŸå¼ƒï¼‰</li><li>JDK logging</li></ul><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ Log4j2 ã€‚</p><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.23.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å‘<code>log4j2.xml</code>ä¸­åŠ å…¥è¯­å¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://logging.apache.org/log4j/2.0/config&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;stdout&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%5level [%t] - %msg%n&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.kzn.mapper.UserMapper&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;trace&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> &gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;stdout&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>com.kzn.mapper.UserMapper</code>è¦æ¢æˆè‡ªå·±æ¥å£çš„å…¨ç±»åã€‚å½“ç„¶ä¹Ÿå¯ä»¥å°†æ—¥å¿—çš„è®°å½•æ–¹å¼ä»æ¥å£çº§åˆ«åˆ‡æ¢åˆ°è¯­å¥çº§ï¼Œåªéœ€å°†è¿™ä¸€é¡¹æ”¹ä¸ºå¯¹åº”æ–¹æ³•çš„åç§°ã€‚<code>level</code>æ˜¯æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ï¼Œæ—¥å¿—çš„æ‰€æœ‰çº§åˆ«å¦‚ä¸‹ï¼š</p><p>FATAL&gt;ERROR&gt;WARN&gt;INFO&gt;DUBUG</p><p>è¿™æ—¶è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå¾—åˆ°çš„è¾“å‡ºä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">DEBUG [main] - ==&gt;  Preparing: insert into sys_user (username, user_pwd) values (?, ?)<br>DEBUG [main] - ==&gt; Parameters: xQc(String), 123(String)<br>DEBUG [main] - &lt;==    Updates: 1<br>1<br></code></pre></td></tr></table></figure><h1 id="æŸ¥è¯¢">æŸ¥è¯¢</h1><h2 id="é’ˆå¯¹å·²çŸ¥å€¼çš„æŸ¥è¯¢">é’ˆå¯¹å·²çŸ¥å€¼çš„æŸ¥è¯¢</h2><p>ç›®æ ‡ï¼šå®ç°å¯¹<code>sys_user</code>è¡¨ä¸­çš„å•ä¸ªç”¨æˆ·çš„æŸ¥è¯¢å’Œæ‰€æœ‰ç”¨æˆ·çš„æŸ¥è¯¢ã€‚</p><p>å¦‚æœæŸ¥è¯¢çš„æ•°æ®æœ‰å¤šæ¡ï¼Œå¿…é¡»ä½¿ç”¨<code>List</code>æ¥æ”¶ã€‚</p><h3 id="åŸºäº-xml-çš„æ–¹å¼">åŸºäº XML çš„æ–¹å¼</h3><h4 id="å®šä¹‰æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•">å®šä¹‰æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•</h4><p>å‘<code>UserMapper.java</code>æ¥å£ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸ¥è¯¢å•ä¸ªç”¨æˆ·</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> uid ç”¨æˆ·çš„å”¯ä¸€uid</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> ç”¨æˆ·ç±»çš„å®ä¾‹</span><br><span class="hljs-comment"> */</span><br>User <span class="hljs-title function_">selectUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼Œè¿”å›ç”¨æˆ·ç»„æˆçš„åˆ—è¡¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> ç”¨æˆ·åˆ—è¡¨</span><br><span class="hljs-comment"> */</span><br>List&lt;User&gt; <span class="hljs-title function_">selectAllUsers</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢å•ä¸ªç”¨æˆ·ç›´æ¥è¿”å›å¯¹åº”ç”¨æˆ·çš„<code>User</code>å¯¹è±¡ï¼ŒæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·å°±è¿”å›ç»„æˆçš„åˆ—è¡¨ã€‚</p><h4 id="xml-æ˜ å°„æ–‡ä»¶">XML æ˜ å°„æ–‡ä»¶</h4><p>åœ¨æ˜ å°„æ–‡ä»¶<code>UserMapper.xml</code>çš„<code>&lt;mapper&gt;</code>æ ‡ç­¾å†…éƒ¨å¼•å…¥æ–¹æ³•çš„æ˜ å°„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--User selectUserById(int uid);--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUserById&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Integer&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.kzn.pojo.User&quot;</span>&gt;</span><br>    SELECT *<br>    FROM sys_user<br>    WHERE uid = #&#123;uid&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--List&lt;User&gt; selectAllUsers();--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectAllUsers&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.kzn.pojo.User&quot;</span>&gt;</span><br>    SELECT *<br>    FROM sys_user<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªè¯­å¥åä¸º selectUserByIdï¼Œæ¥å—ä¸€ä¸ª intï¼ˆæˆ–Integerï¼‰ç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª User ç±»å‹çš„å¯¹è±¡ã€‚æ³¨æ„å‚æ•°ç¬¦å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">&#123;<span class="hljs-built_in">id</span>&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™å°±å‘Šè¯‰ MyBatisåˆ›å»ºä¸€ä¸ª<strong>é¢„å¤„ç†è¯­å¥</strong>ï¼ˆPreparedStatementï¼‰å‚æ•°ã€‚è¿™å…¶å®ç›¸å½“äºJDBCä¸­çš„é¢„å¤„ç†è¯­å¥ï¼Œå½“æ—¶æˆ‘ä»¬æ˜¯è¿™æ ·å¤„ç†çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰sqlè¯­å¥ï¼Œå‚æ•°å€¼ç”¨ï¼Ÿæ›¿ä»£</span><br><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from sys_user where uid=?&quot;</span>;<br><span class="hljs-comment">// è·å–PreparedStatement å¯¹è±¡</span><br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(sql);<br><span class="hljs-comment">// è®¾ç½®å‚æ•°å€¼</span><br><span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç¼–å·ï¼Œä» 1 å¼€å§‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯èµ‹å€¼</span><br>preparedStatement.setInt(<span class="hljs-number">1</span>, uid);<br></code></pre></td></tr></table></figure><p><code>select</code>å…ƒç´ å…è®¸ä½ é…ç½®å¾ˆå¤šå±æ€§æ¥é…ç½®æ¯æ¡è¯­å¥çš„è¡Œä¸ºç»†èŠ‚ã€‚è¿™é‡Œç”¨åˆ°çš„å±æ€§æœ‰ï¼š</p><ul><li><code>id</code>: åœ¨å‘½åç©ºé—´ä¸­å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬å†™æˆæ–¹æ³•å</li><li><code>parameterType</code>:å°†ä¼šä¼ å…¥è¿™æ¡è¯­å¥çš„<strong>å‚æ•°çš„ç±»å…¨é™å®šåæˆ–åˆ«å</strong>ã€‚è¿™ä¸ªå±æ€§æ˜¯<strong>å¯é€‰</strong>çš„ï¼Œå› ä¸ºMyBatiså¯ä»¥æ ¹æ®è¯­å¥ä¸­å®é™…ä¼ å…¥çš„å‚æ•°è®¡ç®—å‡ºåº”è¯¥ä½¿ç”¨çš„ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰ï¼Œé»˜è®¤å€¼ä¸ºæœªè®¾ç½®ï¼ˆunsetï¼‰ã€‚</li><li><code>resultType</code>:æœŸæœ›ä»è¿™æ¡è¯­å¥ä¸­<strong>è¿”å›ç»“æœçš„ç±»å…¨é™å®šåæˆ–åˆ«å</strong>ã€‚æ³¨æ„ï¼Œå¦‚æœè¿”å›çš„æ˜¯é›†åˆï¼Œé‚£åº”è¯¥è®¾ç½®ä¸º<strong>é›†åˆåŒ…å«çš„ç±»å‹</strong>ï¼ˆè¿™é‡Œä¸º<code>com.kzn.pojo.User</code>ï¼‰ï¼Œè€Œä¸æ˜¯é›†åˆæœ¬èº«çš„ç±»å‹ã€‚<code>resultType</code>å’Œ<code>resultMap</code>ä¹‹é—´åªèƒ½åŒæ—¶ä½¿ç”¨ä¸€ä¸ªã€‚<ul><li>MyBatisä¸­è®¾ç½®äº†é»˜è®¤çš„ç±»å‹åˆ«åï¼Œä¾‹å¦‚<code>int</code>æˆ–<code>_int</code>éƒ½å¯æ­£ç¡®åœ°å¯¹åº”<code>Integer</code>ã€‚</li></ul></li></ul><h4 id="æµ‹è¯•">æµ‹è¯•</h4><p>å¾—ç›Šäºæˆ‘ä»¬å¯¹<code>MyBatisUtils</code>å·¥å…·ç±»çš„å°è£…ï¼Œç°åœ¨çš„æµ‹è¯•ä»£ç ä¼šç®€æ´å¾ˆå¤šï¼š</p><p>å¯¹äº†ï¼Œä¸ºäº†ä¿è¯<code>userList.forEach(System.out::println);</code>èƒ½æ­£ç¡®æ‰“å°å‡ºç”¨æˆ·æ‰€æœ‰å­—æ®µçš„ä¿¡æ¯è€Œä¸æ˜¯å…·ä½“çš„åœ°å€ï¼Œåœ¨è¿è¡Œä¹‹å‰æœ‰å¿…è¦é‡å†™<code>User</code>ç±»çš„<code>toString()</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectAllUsers</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MyBatisUtils.getSqlSession()) &#123;<br><br>        <span class="hljs-comment">// è·å–mapperæ¥å£çš„å®ç°ç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆåº•å±‚é‡‡ç”¨ä»£ç†æ¨¡å¼ï¼‰</span><br>        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);<br><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.selectUserById(<span class="hljs-number">1</span>);<br>        System.out.println(user);<br><br>        List&lt;User&gt; userList = mapper.selectAllUsers();<br>        userList.forEach(System.out::println);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: SELECT * FROM sys_user WHERE uid = ?<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: uid, username, user_pwd<br>TRACE [main] - &lt;==        Row: 1, zhangsan, 114411<br>DEBUG [main] - &lt;==      Total: 1<br>User&#123;uid=1, username=&#x27;zhangsan&#x27;, user_pwd=&#x27;114411&#x27;&#125;<br>DEBUG [main] - ==&gt;  Preparing: SELECT * FROM sys_user<br>DEBUG [main] - ==&gt; Parameters: <br>TRACE [main] - &lt;==    Columns: uid, username, user_pwd<br>TRACE [main] - &lt;==        Row: 1, zhangsan, 114411<br>TRACE [main] - &lt;==        Row: 2, lisi, 223322<br>TRACE [main] - &lt;==        Row: 3, CowBoy, 2233<br>TRACE [main] - &lt;==        Row: 4, ddd, 1234<br>TRACE [main] - &lt;==        Row: 5, Asuka, 456<br>TRACE [main] - &lt;==        Row: 8, Spike, 123455<br>TRACE [main] - &lt;==        Row: 11, Origami, 123456<br>TRACE [main] - &lt;==        Row: 14, xQc, 123<br>DEBUG [main] - &lt;==      Total: 8<br>User&#123;uid=1, username=&#x27;zhangsan&#x27;, user_pwd=&#x27;114411&#x27;&#125;<br>User&#123;uid=2, username=&#x27;lisi&#x27;, user_pwd=&#x27;223322&#x27;&#125;<br>User&#123;uid=3, username=&#x27;CowBoy&#x27;, user_pwd=&#x27;2233&#x27;&#125;<br>User&#123;uid=4, username=&#x27;ddd&#x27;, user_pwd=&#x27;1234&#x27;&#125;<br>User&#123;uid=5, username=&#x27;Asuka&#x27;, user_pwd=&#x27;456&#x27;&#125;<br>User&#123;uid=8, username=&#x27;Spike&#x27;, user_pwd=&#x27;123455&#x27;&#125;<br>User&#123;uid=11, username=&#x27;Origami&#x27;, user_pwd=&#x27;123456&#x27;&#125;<br>User&#123;uid=14, username=&#x27;xQc&#x27;, user_pwd=&#x27;123&#x27;&#125;<br></code></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æ¯”è¾ƒé•¿ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘å¯ç”¨äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ã€‚</p><h3 id="åŸºäºæ³¨è§£çš„æ–¹å¼">åŸºäºæ³¨è§£çš„æ–¹å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-meta">@Select(&quot;SELECT id, username, password FROM users WHERE id = #&#123;id&#125;&quot;)</span><br>    User <span class="hljs-title function_">selectUserById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span>;<br><br>    <span class="hljs-meta">@Select(&quot;SELECT id, username, password FROM users&quot;)</span><br>    List&lt;User&gt; <span class="hljs-title function_">selectAllUsers</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°çš„åŠŸèƒ½å’Œå‰é¢æ˜¯ä¸€æ ·çš„ã€‚</p><h1 id="ç‰¹æ®Š-sql">ç‰¹æ®Š SQL</h1><h2 id="æ¨¡ç³ŠåŒ¹é…">æ¨¡ç³ŠåŒ¹é…</h2><p>ä¸Šè¿°æŸ¥è¯¢æ“ä½œä¸­çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯é’ˆå¯¹å·²çŸ¥å€¼è¿›è¡Œè¿‡æ»¤çš„ï¼Œæœ‰æ—¶å€™å¹¶ä¸å¥½ç”¨ï¼Œä¾‹å¦‚ï¼Œæ€æ ·æœç´¢äº§å“åä¸­åŒ…å«æ–‡æœ¬anvilçš„æ‰€æœ‰äº§å“ï¼Ÿç”¨ç®€å•çš„æ¯”è¾ƒæ“ä½œç¬¦è‚¯å®šä¸è¡Œï¼Œå¿…é¡»ä½¿ç”¨é€šé…ç¬¦ã€‚MySQLä¸­ä½¿ç”¨<code>LIKE</code>å…³é”®å­—è¡¨åæ¥ä¸‹æ¥è¦æ‰§è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œä¸ä¹‹å¯¹åº”çš„é€šé…ç¬¦æœ‰ï¼š</p><ul><li>ç™¾åˆ†å·<code>%</code>: åŒ¹é…å¤šä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºå­—ç¬¦å’Œç©ºæ ¼ï¼‰</li><li>ä¸‹åˆ’çº¿<code>_</code>: åªåŒ¹é…å•ä¸ªå­—ç¬¦</li></ul><p>åœ¨ MyBatis ä¸­å†™sqlè¯­å¥æ—¶ï¼Œä¸‹é¢è¿™ç§èµ‹å€¼æ–¹å¼ä¸å¯å–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sys_user <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%#&#123;username&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œçš„<code>#&#123;&#125;</code>è¢«å½“æˆå­—ç¬¦ä¸²å¤„ç†äº†ï¼Œæ— æ³•å¼•ç”¨ä¼ å…¥çš„å‚æ•°ã€‚å¦‚æœæŠŠå®ƒæ¢æˆ<code>$&#123;&#125;</code>ï¼Œè™½ç„¶å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯ä¸æ¨èï¼Œå› ä¸ºè¿™æ—¶å­˜åœ¨<strong>SQLæ³¨å…¥</strong>çš„é—®é¢˜ã€‚ä¾‹å¦‚å½“username=<code>"' or '1'='1"</code>æ—¶ï¼Œsqlè¯­å¥å®é™…ä¸Šå˜æˆäº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sys_user <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure><p>whereæ¡ä»¶å§‹ç»ˆæˆç«‹ï¼Œè¿™ä¼šå¯¼è‡´æ•´ä¸ªè¡¨çš„æ•°æ®éƒ½è¢«è¿”å›ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨<code>#&#123;&#125;</code>é…åˆæ–‡æœ¬å¤„ç†å‡½æ•°<code>concat</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sys_user <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> concat(<span class="hljs-string">&#x27;%&#x27;</span>, #&#123;username&#125;)<br></code></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</p><h2 id="æ‰¹é‡åˆ é™¤">æ‰¹é‡åˆ é™¤</h2><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªæƒ…æ™¯ï¼šç”¨æˆ·åœ¨é‚®ç®±ä¸­ä¸€æ¬¡æ€§é€‰ä¸­å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰¹é‡åˆ é™¤ã€‚ç”¨æˆ·æŒ‰ä¸‹åˆ é™¤æŒ‰é’®åï¼Œå‰ç«¯å‘åç«¯å‘æ¥è¢«é€‰ä¸­çš„åºå·æ„æˆçš„æ•°ç»„ï¼Œåç«¯æ ¹æ®è¿™ä¸ªæ•°ç»„æ‰§è¡Œæ•°æ®åº“çš„åˆ é™¤æ“ä½œã€‚ä¸ºæ­¤å¯ä»¥å†™å‡ºä»¥ä¸‹æ¥å£æŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUsersByIds</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ids&quot;)</span> List&lt;Integer&gt; ids)</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨åˆ—è¡¨è€Œä¸æ˜¯æ•°ç»„å‚¨å­˜æ•°æ®ï¼Œå› ä¸ºåˆ—è¡¨çš„è¯æ›´å…·é€šç”¨æ€§ã€‚</p><p>é‡å¤´æˆæ˜¯<code>.xml</code>é…ç½®æ–‡ä»¶ã€‚æˆ‘ä½¿ç”¨çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUsersByIds&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>    DELETE FROM sys_user<br>    WHERE uid IN<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>        #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…³é”®åœ¨äº<code>foraeach</code>æ ‡ç­¾ã€‚<code>&lt;foreach&gt;</code>ç”¨äºç”Ÿæˆ<strong>åŠ¨æ€SQL</strong>ï¼Œæ¯”å¦‚æ„é€ <code>IN (...)</code>å­å¥ï¼Œä»¥æ”¯æŒæ‰¹é‡æ“ä½œï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›´æ–°ç­‰ï¼‰ã€‚</p><ul><li><code>collection</code>:æŒ‡å®šè¦éå†çš„é›†åˆåç§°ï¼Œä¹Ÿå°±æ˜¯ä¼ å…¥çš„é›†åˆå<code>ids</code></li><li><code>item</code>:éå†é›†åˆä¸­çš„æ¯ä¸ªå˜é‡æ—¶ä½¿ç”¨çš„ä¸´æ—¶å˜é‡çš„åå­—ï¼Œç±»ä¼¼äºå¢å¼ºå‹ for å¾ªç¯ã€‚</li><li><code>open="xxx"</code>:æŒ‡å®šéå†å¼€å§‹å‰å°±è¾“å‡ºçš„å†…å®¹ã€‚å› ä¸ºæˆ‘ä»¬è¦æ„é€ çš„æ˜¯<code>IN(...)</code>å­—å¥ï¼Œæ‰€ä»¥å¼€å§‹ä½ç½®å…ˆæ”¾ä¸Šä¸€ä¸ªå·¦æ‹¬å·</li><li><code>separator="xxx"</code>: æ¯ä¸ªå…ƒç´ ä¹‹é—´çš„åˆ†éš”ç¬¦</li><li><code>close="xxx"</code>:éå†ç»“æŸåè¾“å‡ºçš„å†…å®¹ï¼Œè¿™é‡Œæ”¾ä¸€ä¸ªå³æ‹¬å·ã€‚</li></ul><p>ä¸‹é¢ç»“åˆæµ‹è¯•ç”¨ä¾‹çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDeleteUsersByIds</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// åˆ é™¤uidä¸º2ï¼Œ4çš„è®°å½•</span><br>    userMapper.deleteUsersByIds(List.of(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>));<br>    sqlSession.commit();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›¸å½“äºæ‰§è¡Œ<code>DELETE FROM sys_user WHERE uid IN(2, 4)</code>ï¼Œæ‰“å°ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">DEBUG [main] - ==&gt;  Preparing: DELETE FROM sys_user WHERE uid IN ( ? , ? )<br>DEBUG [main] - ==&gt; Parameters: 2(Integer), 4(Integer)<br>DEBUG [main] - &lt;==    Updates: 2<br></code></pre></td></tr></table></figure><p>æˆåŠŸåˆ é™¤ä¸¤æ¡è®°å½•ã€‚</p><h1 id="mybatis-è·å–æ•°æ®å€¼çš„ä¸¤ç§æ–¹å¼">MyBatis è·å–æ•°æ®å€¼çš„ä¸¤ç§æ–¹å¼</h1><h2 id="ç»†èŠ‚">ç»†èŠ‚</h2><p>ä½¿ç”¨<code>#&#123;&#125;</code>å‚æ•°è¯­æ³•æ—¶ï¼ŒMyBatisä¼šåˆ›å»º<code>PreparedStatement</code>å‚æ•°å ä½ç¬¦ï¼Œå¹¶é€šè¿‡å ä½ç¬¦å®‰å…¨åœ°è®¾ç½®å‚æ•°ï¼ˆå°±åƒä½¿ç”¨<code>?</code>ä¸€æ ·ï¼‰ã€‚è¿™æ ·åšæ›´å®‰å…¨ï¼Œæ›´è¿…é€Ÿï¼Œé€šå¸¸ä¹Ÿæ˜¯é¦–é€‰åšæ³•ï¼Œä¸è¿‡æœ‰æ—¶ä½ å°±æ˜¯æƒ³ç›´æ¥åœ¨ SQLè¯­å¥ä¸­ç›´æ¥æ’å…¥ä¸€ä¸ªä¸è½¬ä¹‰çš„å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>$&#123;&#125;</code>ã€‚</p><div class="note note-secondary">            <p><code>${}</code>çš„æœ¬è´¨å°±æ˜¯å­—ç¬¦ä¸²çš„æ‹¼æ¥<code>str1 + str2</code>ï¼Œ<code>#{}</code>çš„æœ¬è´¨å°±æ˜¯å ä½ç¬¦èµ‹å€¼ã€‚</p>          </div><p><code>$&#123;&#125;</code>çš„ä½¿ç”¨æƒ…æ™¯ä¸»è¦æ˜¯åŠ¨æ€è®¾ç½®è¡¨åã€åˆ—åã€ORDER BYåŠ¨æ€æ’åºç­‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">ORDER</span> <span class="hljs-title">BY</span> $&#123;columnName&#125;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³<code>select</code>ä¸€ä¸ªè¡¨ä»»æ„ä¸€åˆ—çš„æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥å†™æˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-variable">@Select</span>(&quot;select * from user where $&#123;column&#125; = #&#123;value&#125;&quot;)<br><span class="hljs-keyword">User</span> findByColumn(<span class="hljs-variable">@Param</span>(&quot;column&quot;) String <span class="hljs-keyword">column</span>, <span class="hljs-variable">@Param</span>(&quot;value&quot;) String <span class="hljs-keyword">value</span>);<br></code></pre></td></tr></table></figure><p><code>$&#123;column&#125;</code>å¼•ç”¨ä¸€ä¸ªåŠ¨æ€çš„å­—æ®µåï¼Œæ¯”å¦‚<code>uid</code>ï¼Œ<code>user_pwd</code>ã€‚è¿™æ ·å°±ä¸å¿…ä¸ºæ¯ä¸ªå­—æ®µéƒ½å•ç‹¬å†™ä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•äº†ï¼Œè¿™ä¹Ÿé€‚ç”¨äºæ›¿æ¢è¡¨åçš„æƒ…å†µã€‚</p><p>ä½†æ˜¯ï¼Œå‡¡æ˜¯ä½¿ç”¨<code>$&#123;&#125;</code>å‡ºç°çš„åœ°æ–¹éƒ½æœ‰<strong>SQLæ³¨å…¥</strong>çš„é£é™©ï¼Œå¦‚æœè¦ä½¿ç”¨è¿™ç§å†™æ³•ï¼Œå› æ­¤ï¼Œè¦ä¹ˆä¸å…è®¸ç”¨æˆ·è¾“å…¥è¿™äº›å­—æ®µï¼Œè¦ä¹ˆè‡ªè¡Œè½¬ä¹‰å¹¶æ£€éªŒè¿™äº›å‚æ•°ã€‚</p><hr /><p><code>#&#123;&#125;</code>ç”¨äºç»™å‚æ•°èµ‹å€¼ï¼ŒMyBatis<strong>é»˜è®¤åªèƒ½è¯†åˆ«å•ä¸ªå‚æ•°</strong>ã€‚</p><p>å¤šä¸ªå‚æ•°æ—¶ï¼ŒMyBatisä¼šæŠŠè¿™äº›å‚æ•°æ”¾åˆ°ä¸€ä¸ªmapä¸­ï¼Œåœ¨æ²¡æœ‰æ˜¾å¼å‘½åå‚æ•°çš„æƒ…å†µä¸‹ï¼š</p><ul><li><code>$&#123;&#125;</code>ï¼Œä»¥<code>param1, param2...</code>ä¸ºé”®ï¼Œå‚æ•°ä¸ºå€¼<br /></li><li><code>#&#123;&#125;</code>ï¼Œä»¥<code>arg0, arg1...</code>ä¸ºé”®ï¼Œå‚æ•°ä¸ºå€¼</li></ul><p>æ­¤æ—¶æœ€å¥½åœ¨æ¥å£çš„æ–¹æ³•ä¸­ç”¨<code>@Param</code>ä¸ºå‚æ•°<strong>æ˜¾å¼å‘½å</strong>ï¼Œæ–¹ä¾¿åœ¨sqlè¯­å¥ä¸­å¼•ç”¨ã€‚è¿™ç§æƒ…å†µä¸‹MyBatisåˆ›å»ºçš„é›†åˆä¸­å®é™…ä¸ŠåŒæ—¶å­˜åœ¨ä¸¤ç§å¼•ç”¨æ–¹å¼ï¼Œé»˜è®¤å’Œè‡ªå®šä¹‰éƒ½å¯ä½¿ç”¨ï¼Œå½“ç„¶ä¸€èˆ¬éƒ½æ˜¯ç”¨è‡ªå®šä¹‰çš„åå­—ã€‚</p><p>å¯¹å•å‚æ•°å’Œå¤šå‚æ•°å„ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸ¥è¯¢å•ä¸ªç”¨æˆ·</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> uid ç”¨æˆ·çš„å”¯ä¸€uid</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> ç”¨æˆ·ç±»çš„å®ä¾‹</span><br><span class="hljs-comment"> */</span><br>User <span class="hljs-title function_">selectUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç å¯¹åº”çš„äººæ˜¯å¦å­˜åœ¨ï¼ˆä»…ä½œä¸ºæµ‹è¯•ï¼Œå®é™…æ•°æ®åº“ä¸­ä¸å¯èƒ½å­˜å‚¨æ˜æ–‡å¯†ç ï¼‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> username ç”¨æˆ·å</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> password å¯†ç </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">checkUserExists</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;username&quot;)</span> String username, <span class="hljs-meta">@Param(&quot;password&quot;)</span> String password)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--User selectUserById(int uid);--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUserById&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Integer&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    SELECT *<br>    FROM sys_user<br>    WHERE uid = #&#123;uid&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- boolean checkUserExists(@Param(&quot;username&quot;) String username, @Param(&quot;password&quot;) String password); --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;checkUserExists&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;boolean&quot;</span>&gt;</span><br>    SELECT COUNT(*) &gt; 0 <span class="hljs-comment">&lt;!--ç”¨äºæ£€æµ‹æ»¡è¶³åé¢çš„è®°å½•æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨çš„è¯å°±è¿”å›true--&gt;</span><br>    FROM sys_user<br>    WHERE username = #&#123;username&#125; AND user_pwd = #&#123;password&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>selectUserById</code>åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æ— éœ€æ˜¾å¼å‘½åï¼Œç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ç”¨<code>#&#123;uid&#125;</code>è¡¨ç¤ºï¼ˆè¿™é‡Œçš„åå­—å¯ä»¥éšä¾¿èµ·ï¼Œä¸ä¸€å®šæ˜¯uidï¼‰ã€‚ä½†æ˜¯ç¬¬äºŒä¸ªæ–¹æ³•ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œæ˜¾å¼å‘½åä¸º<code>username</code>å’Œ<code>password</code>ï¼Œè¿™æ ·åœ¨xmlé…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨<code>#&#123;username&#125;</code>å’Œ<code>#&#123;password&#125;</code>å¼•ç”¨ä¼ å…¥çš„å€¼äº†ã€‚</p><hr /><p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ä¼ å…¥çš„å‚æ•°åˆšå¥½æ˜¯æŸä¸ªå®ä½“ç±»çš„ç±»å‹ï¼Œå¦‚æœè¦ä½¿ç”¨sqlè®¿é—®å®ä½“ç±»çš„å±æ€§å€¼ï¼Œä½¿ç”¨<code>#&#123;&#125;</code>å’Œ<code>$&#123;&#125;</code>éƒ½å¯ã€‚ä¹‹å‰æŸ¥è¯¢éƒ¨åˆ†çš„ä»£ç å°±å±äºè¿™ç§æƒ…å†µï¼Œä¸å†èµ˜è¿°ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p><strong>è·å–æ•°æ®å€¼çš„ä¸¤ç§æ–¹å¼ï¼š</strong></p><ul><li><code>$&#123;&#125;</code>: å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸å®‰å…¨ï¼Œå°‘ç”¨</li><li><code>#&#123;&#125;</code>: å ä½ç¬¦èµ‹å€¼ï¼Œå®‰å…¨ï¼Œä¼˜å…ˆä½¿ç”¨ã€‚</li></ul><p><strong>æ¥å£æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿå¯ä»¥åˆ†æˆä¸¤å¤§ç±»ï¼š</strong></p><ul><li>å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯æŸä¸ªå®ä½“ç±»çš„ç±»å‹ï¼Œsqlè¯­å¥å¯ä»¥ç›´æ¥ä½¿ç”¨<code>#&#123;å±æ€§å&#125;</code>è®¿é—®æŸä¸ªå®ä½“ç±»çš„å€¼ï¼Œå¦‚<code>insert into sys_user (username, user_pwd) values (#&#123;username&#125;, #&#123;user_pwd&#125;)</code></li><li>å¦‚æœä¼ å…¥äº†ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œå»ºè®®éƒ½ä½¿ç”¨<code>@Param</code>æ˜¾å¼å‘½åå‚æ•°ï¼Œä¹‹åsqlè¯­å¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ«åæ¥å¼•ç”¨å‚æ•°çš„å€¼</li></ul>]]></content>
    
    
    <categories>
      
      <category>MyBatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TCPåè®®</title>
    <link href="/2025/05/10/TCP%E5%8D%8F%E8%AE%AE/"/>
    <url>/2025/05/10/TCP%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p>ä¸»è¦å‚è€ƒï¼šwiki å’Œ å°æ—codingï¼Œä»¥åŠ<ahref="https://www.cnblogs.com/jojop/p/14111160.html">è¿™ç¯‡åšå®¢</a></p><h1 id="tcp-æŠ¥æ–‡å¤´éƒ¨æ ¼å¼">TCP æŠ¥æ–‡å¤´éƒ¨æ ¼å¼</h1><p>ä¸€ä¸ª TCP æŠ¥æ–‡ï¼ˆTCP segmentï¼‰ æ˜¯ TCPåè®®åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„åŸºæœ¬å•ä½ã€‚å®ƒæœ‰ä¸€ä¸ª<strong>å›ºå®šæ ¼å¼çš„å¤´éƒ¨</strong>ï¼ˆHeaderï¼‰å’Œä¸€ä¸ª<strong>å¯å˜é•¿åº¦çš„æ•°æ®éƒ¨åˆ†</strong>ï¼ˆPayloadï¼‰ã€‚</p><figure><img src="https://s21.ax1x.com/2025/05/10/pEODgrd.png"alt="TCPå¤´éƒ¨æ ¼å¼" /><figcaption aria-hidden="true">TCPå¤´éƒ¨æ ¼å¼</figcaption></figure><h2 id="æºç«¯å£å·å’Œç›®æ ‡ç«¯å£å·">æºç«¯å£å·å’Œç›®æ ‡ç«¯å£å·</h2><ul><li><code>Source Port</code>: 16ä½ï¼Œæºç«¯å£å·ï¼Œæ ‡è¯†å‘é€ç«¯å£ã€‚</li><li><code>Destination Port</code>: 16ä½ï¼Œæ ‡è¯†æ¥æ”¶ç«¯å£</li></ul><h2 id="åºåˆ—å·">åºåˆ—å·</h2><ul><li><code>Sequence Number</code>ï¼š32ä½ï¼Œåºå·ï¼ˆæˆ–è€…åºåˆ—å·ï¼‰ï¼Œæœ‰åŒé‡ä½œç”¨ï¼š<ul><li>å¦‚æœ SYNæ ‡å¿—ä½ä¸º1ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯åˆå§‹åºåˆ—å·ã€‚å®é™…çš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºåˆ—å·ä»¥åŠç›¸åº”ACK ä¸­çš„ç¡®è®¤å·ï¼ˆacknowledged numberï¼Œä¹Ÿå«ACKå·ï¼‰éƒ½ç­‰äºæ­¤åºåˆ—å·åŠ 1ã€‚</li><li>å¦‚æœ SYN æ ‡å¿—ä½ä¸º 0ï¼Œé‚£ä¹ˆè¿™ä¸ªåºåˆ—å·å°±æ˜¯å½“å‰ä¼šè¯ä¸­çš„è¿™ä¸ª segmentä¸­ç¬¬ä¸€ä¸ªæ•°æ®çš„ç´¯è®¡å­—èŠ‚åºå·ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºåœ¨ TCP è¿æ¥å·²ç»å»ºç«‹ä¹‹åï¼ŒSYNå°±ä¸å†ä½¿ç”¨äº†ï¼ˆä¸º 0ï¼‰ã€‚</li></ul></li></ul><h2 id="æ•°æ®åç§»é‡">æ•°æ®åç§»é‡</h2><ul><li><code>Data Offset</code>(DOffset): 4ä½ï¼Œæ•°æ®åç§»é‡ï¼Œç”¨æŒ‡å®š TCPå¤´çš„sizeï¼Œä»¥wordï¼ˆ32-bitï¼Œå³4å­—èŠ‚ï¼‰ä¸ºå•ä½ã€‚TCP å¤´çš„æœ€å°é•¿åº¦æ˜¯ 5wordsï¼ˆå› ä¸ºå›ºå®šéƒ¨åˆ†çš„ TCP æŠ¥æ–‡å¤´æ­£å¥½æ˜¯ 5 ä¸ª wordï¼‰ï¼Œæœ€å¤§æ˜¯ 15wordsï¼Œå› æ­¤æœ€å°æ˜¯ 20 å­—èŠ‚ï¼Œæœ€å¤§æ˜¯ 60 å­—èŠ‚ï¼ŒæŠ¥å¤´æœ€å¤šå¯ä»¥å®¹çº³ 40å­—èŠ‚çš„é€‰é¡¹ï¼ˆoptionsï¼‰å­—æ®µã€‚è¿™ä¸ªå­—æ®µä¹‹æ‰€ä»¥å«â€œoffsetâ€ï¼Œæ˜¯å› ä¸ºå®ƒä¹Ÿè¡¨ç¤ºä»TCP æ®µèµ·å§‹å¤„ åˆ° å®é™…æ•°æ®å¼€å§‹ä½ç½®(Data) çš„åç§»é‡ã€‚</li></ul><h2 id="ä¿ç•™ä½">ä¿ç•™ä½</h2><ul><li><code>Reserved</code>(Rsrvd): 4 bits, ä¿ç•™ä½ï¼Œä¾›æœªæ¥ä½¿ç”¨ï¼Œåº”å½“è®¾ç½®ä¸º0.åœ¨æ²¡æœ‰è¿›ä¸€æ­¥çš„è§„èŒƒçš„æƒ…å†µä¸‹ï¼Œå‘é€æ–¹ä¸åº”è¯¥è®¾ç½®è¿™äº›ä½ï¼Œæ¥æ”¶æ–¹ä¹Ÿåº”å½“å¿½ç•¥ä»–ä»¬ï¼ˆå°±ç®—è¢«ä¸æ…è®¾ç½®äº†ï¼‰ã€‚</li></ul><h2 id="çŠ¶æ€ä½">çŠ¶æ€ä½</h2><ul><li><code>Flags</code>: 8 bits, 8ä½çŠ¶æ€ä½ï¼ŒåŒ…å«ä»¥ä¸‹ 8 ä¸ªæ ‡å¿—ä½ï¼š<ul><li><code>CWR</code>(Congestion window reduced):<strong>æ‹¥å¡çª—å£å·²å‡å°‘</strong>æ ‡å¿—ï¼Œç”±<strong>å‘é€æ–¹</strong>è®¾ç½®ï¼Œä»¥è¡¨æ˜å®ƒæ”¶åˆ°äº†è®¾ç½®äº†ECE æ ‡å¿—çš„ TCPæ®µï¼Œå¹¶ä¸”å·²ç»æ ¹æ®æ‹¥å¡æ§åˆ¶æœºåˆ¶ä½œå‡ºäº†å“åº”ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼šå‘é€æ–¹å‘Šè¯‰æ¥æ”¶æ–¹â€œæˆ‘çŸ¥é“ç½‘ç»œæ‹¥å¡äº†ï¼Œæˆ‘å·²ç»å‡å°äº†å‘é€çª—å£â€ã€‚<strong>æœ‰çš„å›¾è§£ä¼šæŠŠ<code>CWR</code>å½’å…¥ä¿ç•™ä½</strong>ã€‚</li><li><code>ECE</code>(ECN-Echo): 1 bit, ECNå›æ˜¾æ ‡å¿—å…·æœ‰åŒé‡ä½œç”¨ï¼Œå…¶å«ä¹‰å–å†³äº SYN æ ‡å¿—ä½ï¼š<ul><li>å¦‚æœ SYN æ ‡å¿—ä½ä¸º1ï¼Œè¡¨ç¤ºè¯¥ TCP peer æ”¯æŒ ECN åŠŸèƒ½</li><li>å¦‚æœ SYN æ ‡å¿—ä½ä¸º0ï¼Œåˆ™åœ¨æ­£å¸¸ä¼ è¾“æœŸé—´æ¥æ”¶åˆ°äº† IPæ ‡å¤´ä¸­è®¾ç½®äº†æ‹¥å¡ç»å†æ ‡å¿—ï¼ˆ<code>ECN=11</code>ï¼‰çš„æ•°æ®åŒ…ã€‚è¿™å‘Šè¯‰ TCPå‘é€æ–¹ç½‘ç»œå·²ç»å‘ç”Ÿæˆ–å³å°†å‘ç”Ÿæ‹¥å¡ã€‚<strong>æœ‰çš„å›¾è§£ä¼šæŠŠ<code>ECE</code>å½’å…¥ä¿ç•™ä½</strong>ã€‚</li></ul></li><li><code>URG</code>, 1 bit, è¡¨ç¤º â€œç´§æ€¥æŒ‡é’ˆï¼ˆUrgentPointerï¼‰â€å­—æ®µæ˜¯æœ‰æ•ˆçš„ã€‚å½“ URG æ ‡å¿—ä½ç½®ä¸º 1 æ—¶ï¼Œè¯´æ˜å½“å‰è¿™ä¸ª TCPæŠ¥æ–‡ä¸­æœ‰â€œç´§æ€¥æ•°æ®â€ï¼›æ­¤æ—¶ï¼Œç´§æ€¥æŒ‡é’ˆå­—æ®µå‘Šè¯‰æ¥æ”¶æ–¹ï¼šç´§æ€¥æ•°æ®åœ¨æ•°æ®æ®µä¸­ç»“æŸçš„ä½ç½®ã€‚é€šå¸¸ç”¨äºtelnet ç­‰è€æ—§åè®®ï¼Œ<strong>ç°åœ¨å¾ˆå°‘ç”¨</strong>ã€‚</li><li><code>ACK</code>: 1 bit, æŒ‡ç¤ºç¡®è®¤å­—æ®µæœ‰æ•ˆã€‚<strong>å®¢æˆ·ç«¯å‘é€åˆå§‹SYNæ•°æ®åŒ…ä¹‹åçš„æ‰€æœ‰æ•°æ®åŒ…éƒ½åº”è®¾ç½®æ­¤æ ‡å¿—</strong>ã€‚å³ï¼Œåªæœ‰å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹æ—¶ä¸ç”¨è®¾ç½®ACKæ ‡å¿—ä½ï¼Œæ¯•ç«Ÿåœ¨æ­¤ä¹‹å‰å®¢æˆ·ç«¯è¿˜æ²¡æœ‰æ”¶åˆ°è¿‡ä¿¡æ¯ã€‚</li><li><code>PSH</code>: 1 bit, è¡¨ç¤ºâ€œæ¨é€åŠŸèƒ½ï¼ˆPushFunctionï¼‰â€ï¼Œè¯·æ±‚å°†ç¼“å†²æ•°æ®ç«‹å³æ¨é€åˆ°æ¥æ”¶åº”ç”¨ç¨‹åºã€‚</li><li><code>RST</code>: 1 bit, é‡æ–°è¿æ¥ã€‚</li><li><code>SYN</code>: 1 bit,åŒæ­¥åºåˆ—å·ã€‚<strong>åªæœ‰åœ¨å‰ä¸¤æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹åº”è®¾ç½®æ­¤æ ‡å¿—</strong>ã€‚ä¸€äº›å…¶ä»–çš„æ ‡å¿—ä½å’Œå­—æ®µæ ¹æ®SYN æ”¹å˜å«ä¹‰ï¼Œæœ‰çš„åªæœ‰åœ¨SYNä¸º1æ—¶æœ‰æ•ˆï¼Œæœ‰çš„åªæœ‰åœ¨SYNæ¸…ç©ºæœ‰æ•ˆã€‚</li><li><code>FIN</code>: 1 bit, è¡¨ç¤ºå‘é€æ–¹çš„æœ€åä¸€ä¸ªæ•°æ®åŒ…ï¼Œ<strong>ç”¨äºTCP è¿æ¥çš„æ­£å¸¸å…³é—­</strong>ã€‚å½“ä¸€ä¸ªä¸»æœºå‘é€å¸¦æœ‰ FIN=1 çš„ TCPæŠ¥æ–‡æ—¶ï¼Œå®ƒè¡¨ç¤ºä¸»æœºè¯·æ±‚æ–­å¼€è¿æ¥ï¼Œç„¶åå›è¿›å…¥ç»ˆæ­¢è¿æ¥çš„å››æ¬¡æŒ¥æ‰‹è¿›ç¨‹ã€‚</li></ul></li></ul><h2 id="çª—å£">çª—å£</h2><ul><li>16ä½ï¼Œæ¥æ”¶çª—å£çš„å¤§å°ï¼Œè¡¨ç¤ºæœ¬æŠ¥æ–‡æ®µçš„<strong>å‘é€æ–¹</strong>ç›®å‰æ„¿æ„æ¥æ”¶çš„çª—å£å¤§å°å•ä½æ•°ã€‚ï¼ˆè¯¦è§â€œæµé‡æ§åˆ¶â€å’Œâ€œçª—å£ç¼©æ”¾â€éƒ¨åˆ†ï¼‰ã€‚</li></ul><h2 id="æ ¡éªŒå’Œ">æ ¡éªŒå’Œ</h2><p><code>Checksum</code>: 16 bitsï¼Œ 16 ä½æ ¡éªŒå’Œå­—æ®µç”¨äºå¯¹ TCPæŠ¥å¤´ã€æœ‰æ•ˆè½½è·(payload)å’Œ IPä¼ªæŠ¥å¤´(pseudo-header)è¿›è¡Œé”™è¯¯æ ¡éªŒã€‚ä¼ªæŠ¥å¤´ç”±æº IP åœ°å€ã€ç›®æ ‡ IP åœ°å€ã€TCPåè®®å· (6) ä»¥åŠ TCPæŠ¥å¤´å’Œæœ‰æ•ˆè½½è·çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ç»„æˆã€‚å…·ä½“è§<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://en.wikipedia.org/wiki/Internet_checksum">[1]</span></a></sup></p><p>payload data:æœ‰æ•ˆè½½è·æ•°æ®ï¼Œåœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼ŒæŒ‡ä¼ è¾“çš„æ•°æ®ä¸­é™¤å»åè®®å¤´å’Œæ ¡éªŒç ç­‰æ§åˆ¶ä¿¡æ¯ä¹‹å¤–çš„å®é™…æ•°æ®éƒ¨åˆ†ã€‚</p><h2 id="ç´§æ€¥æŒ‡é’ˆ">ç´§æ€¥æŒ‡é’ˆ</h2><p><code>Urgent Pointer</code>: 16 bits, å¦‚æœè®¾ç½®äº† URG æ ‡å¿—ï¼Œåˆ™æ­¤ 16ä½å­—æ®µæ˜¯ç›¸å¯¹äºæŒ‡ç¤ºæœ€åä¸€ä¸ªç´§æ€¥æ•°æ®å­—èŠ‚çš„åºåˆ—å·çš„åç§»é‡ã€‚<strong>ç°ä»£åè®®å‡ ä¹ä¸ä½¿ç”¨URGå’Œç´§æ€¥æŒ‡é’ˆ</strong>ã€‚</p><h2 id="é€‰é¡¹">é€‰é¡¹</h2><p>é€‰é¡¹ï¼ˆ<code>TCP Option</code>ï¼‰ï¼šé•¿åº¦å¯å˜ï¼Œ0â€“320 ä½ï¼ˆå³ 0â€“40å­—èŠ‚ï¼‰ï¼Œå•ä½æ˜¯ 32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰ï¼› å…¶å¤§å°ç”± TCP æŠ¥æ–‡å¤´çš„ Data Offsetå­—æ®µå†³å®šï¼Œè®¡ç®—å…¬å¼æ˜¯ï¼š <figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Options</span> å­—æ®µå¤§å° <span class="hljs-operator">=</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Data</span> <span class="hljs-built_in">Offset</span> <span class="hljs-operator">-</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span> Ã— <span class="hljs-number">32</span> ä½<br></code></pre></td></tr></table></figure></p><p>å¦‚æœè¿™ä¸ªå­—æ®µå­˜åœ¨ï¼Œæ•°æ®åç§»é‡å°†å¤§äº 5 wordsã€‚å› ä¸º Data Offsetè¡¨ç¤ºçš„æ˜¯ä»¥ wordï¼ˆ32 ä½ï¼‰ä¸ºå•ä½çš„ TCPå¤´éƒ¨é•¿åº¦ï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡åœ¨æœ«å°¾æ·»åŠ å¡«å…… 0ï¼Œå°† TCP å¤´éƒ¨é•¿åº¦å¡«å……ä¸º 4å­—èŠ‚çš„æ•´æ•°å€ã€‚</p><h1 id="ä¸‰æ¬¡æ¡æ‰‹">ä¸‰æ¬¡æ¡æ‰‹</h1><p>åœ¨ HTTP ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ TCP å»ºç«‹è¿æ¥ï¼ŒTCPè¿æ¥çš„å»ºç«‹ï¼Œé€šå¸¸ç§°ä¸º<strong>ä¸‰æ¬¡æ¡æ‰‹</strong>ã€‚</p><p>å…ˆå¼„æ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>åºåˆ—å·</strong>ï¼ˆSequenceNumberï¼‰ï¼šæ˜¯<strong>å‘é€æ–¹</strong>ä¸ºæ•°æ®æµä¸­çš„å­—èŠ‚æŒ‡å®šçš„â€œæ ‡è®°â€ï¼Œè¡¨ç¤ºå®ƒæ­£åœ¨å‘é€å“ªäº›å­—èŠ‚ã€‚å®ƒå‘Šè¯‰æ¥æ”¶æ–¹â€œ<strong>æˆ‘å‡†å¤‡ä»è¿™ä¸ªåºåˆ—å·å¼€å§‹ç»™ä½ å‘æ•°æ®</strong>â€ã€‚</li><li><strong>ç¡®è®¤å·</strong>ï¼ˆAcknowledgmentNumberï¼‰ï¼šæ˜¯<strong>æ¥æ”¶æ–¹</strong>å‘Šè¯‰å‘é€æ–¹å®ƒå·²ç»æˆåŠŸæ¥æ”¶åˆ°çš„å­—èŠ‚çš„<strong>ä¸‹ä¸€ä¸ªåºåˆ—å·</strong>ï¼Œè¡¨ç¤ºæ¥æ”¶æ–¹å·²ç»æ”¶åˆ°äº†æ‰€æœ‰å°äºè¯¥ç¡®è®¤å·çš„å­—èŠ‚ã€‚å®ƒå‘Šè¯‰å‘é€æ–¹â€œ<strong>æ¥ä¸‹æ¥æˆ‘å‡†å¤‡æ¥æ”¶ä»è¿™ä¸ªåºåˆ—å·å¼€å§‹çš„æ•°æ®</strong>â€ã€‚</li></ul><div class="note note-secondary">            <p>åœ¨å®¢æˆ·ç«¯å°è¯•è¿æ¥æœåŠ¡å™¨ä¹‹å‰ï¼ŒæœåŠ¡å™¨å¿…é¡»å…ˆç»‘å®šå¹¶ç›‘å¬æŸä¸ªç«¯å£ï¼Œä»¥ä¾¿å¼€æ”¾è¿æ¥ï¼šè¿™ç§°ä¸º<strong>è¢«åŠ¨å¼€å¯</strong>(passiveopen)ã€‚è¢«åŠ¨æ‰“å¼€å»ºç«‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹(three-way/3-stephandshake)å‘èµ·<strong>ä¸»åŠ¨å¼€å¯</strong>(active open)æ¥å»ºç«‹è¿æ¥ã€‚</p>          </div><p>ä¸‰æ¬¡æ¡æ‰‹çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li><strong>SYN</strong>ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ SYN æŠ¥æ–‡ï¼ˆSYNæ ‡å¿—ä½è®¾ç½®ä¸º1ï¼‰ä¸»åŠ¨å¼€å¯è¿æ¥ã€‚å®¢æˆ·ç«¯æŠŠTCPæ®µçš„åºåˆ—å·è®¾ç½®ä¸ºä¸€ä¸ªéšæœºæ•°Aã€‚å› ä¸ºå®¢æˆ·ç«¯è¿˜æ²¡æœ‰å—åˆ°è¿‡æ¶ˆæ¯ï¼Œæ‰€ä»¥è¿™é‡Œä¸ç”¨è®¾ç½®ç¡®è®¤å·ï¼Œä¹Ÿä¸åŒ…å«ä»»ä½•åº”ç”¨å±‚çš„æ•°æ®ã€‚</li><li><strong>SYN-ACK</strong>ï¼šä½œä¸ºå›å¤ï¼ŒæœåŠ¡å™¨å“åº”äº†ä¸€ä¸ªSYN-ACKæŠ¥æ–‡ã€‚è¯¥TCPæ®µçš„ç¡®è®¤å·è¢«è®¾ç½®ä¸ºA+1ï¼Œè€Œåºåˆ—å·è¢«æœåŠ¡å™¨è®¾ç½®ä¸ºå¦ä¸€ä¸ªéšæœºæ•°Bã€‚åˆ°è¿™é‡Œå®¢æˆ·ç«¯å·²ç»å®Œæˆäº†ä¸€å‘ä¸€æ”¶ï¼Œæ‰€ä»¥å¤„äº<code>ESTABLISHED</code>çŠ¶æ€ã€‚</li><li><strong>ACK</strong>ï¼šæœ€åï¼Œå®¢æˆ·ç«¯æŠŠ ACKå‘é€ç»™æœåŠ¡å™¨ï¼Œè¿™æ—¶çš„åºåˆ—å·è®¾ç½®ä¸ºæ¥æ”¶åˆ°çš„ç¡®è®¤å·ï¼Œå³A+1ï¼Œè€Œç¡®è®¤å·è¢«è®¾ç½®æˆæ¥æ”¶åˆ°çš„åºåˆ—å·åŠ ä¸€ï¼Œå³B+1ã€‚<strong>è¿™æ¬¡æŠ¥æ–‡å¯ä»¥æºå¸¦å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®</strong>ã€‚è‡³æ­¤æœåŠ¡å™¨ä¹Ÿå®Œæˆäº†ä¸€å‘ä¸€æ”¶ï¼Œä¹Ÿå¤„äº<code>ESTABLISHED</code>çŠ¶æ€ã€‚</li></ol><p><img src="https://s21.ax1x.com/2025/05/11/pEOHxFf.png" /></p><p>æ­¥éª¤1å’Œ2ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ–¹å‘å»ºç«‹å’Œç¡®è®¤åºåˆ—å·ï¼Œæ­¥éª¤2å’Œæ­¥éª¤3ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ–¹å‘å»ºç«‹å’Œç¡®è®¤åºåˆ—å·ã€‚è¿™äº›æ­¥éª¤å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å®Œæˆäº†ç¡®è®¤ï¼Œå…¨åŒå·¥é€šä¿¡æ­£å¼å»ºç«‹ã€‚</p><p>å¯è§ï¼Œä¸‰æ¬¡æ¡æ‰‹ç›®çš„æ˜¯ä¿è¯åŒæ–¹éƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›ã€‚</p><h1 id="åˆ†å‰²æ•°æ®">åˆ†å‰²æ•°æ®</h1><p>TCPä¼ è¾“çš„æ•°æ®å½’æ ¹ç»“åº•è¿˜æ˜¯æ¥æºäºåº”ç”¨ç¨‹åºäº§ç”Ÿçš„HTTPè¯·æ±‚æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼ŒTCPæ¯ä¸ªæ®µèƒ½ä¼ è¾“çš„æ•°æ®é•¿åº¦æ˜¯æœ‰æœ€å¤§é™åˆ¶çš„ï¼š</p><ul><li>MTUï¼šä¸€ä¸ªç½‘ç»œåŒ…ï¼ˆIPå¤´+TCPå¤´+æ•°æ®ï¼‰çš„æœ€å¤§é•¿åº¦ï¼Œä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸º1500å­—èŠ‚ã€‚</li><li>MSSï¼šé™¤å»IPå¤´å’ŒTCPå¤´ä¹‹åï¼Œä¸€ä¸ªç½‘ç»œåŒ…æ‰€èƒ½å®¹çº³çš„TCPæ•°æ®çš„æœ€å¤§é•¿åº¦ã€‚</li></ul><p>å¦‚æœæ•°æ®çš„é•¿åº¦è¶…è¿‡äº†<code>MSS</code>ï¼Œåˆ™ä¼šå°†æ•°æ®ä»¥<code>MSS</code>çš„é•¿åº¦ä¸ºå•ä½è¿›è¡Œåˆ‡åˆ†ï¼Œæ¯ä¸€å—éƒ½ä¼šè¢«æ”¾è¿›å•ç‹¬çš„ç½‘ç»œåŒ…ä¸­ï¼ŒåŠ ä¸ŠTCPå¤´éƒ¨åäº¤ç»™IPæ¨¡å—å‘é€å‡ºå»ã€‚</p><hr /><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€å¹¶å›è½¦åï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘èµ· HTTPè¯·æ±‚ï¼Œè¿™æ˜¯ä¸€æ®µçº¯æ–‡æœ¬æ•°æ®ï¼Œæµè§ˆå™¨å°†è¿™æ®µæ•°æ®äº¤ç»™æ“ä½œç³»ç»Ÿçš„åè®®æ ˆï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡ä¸Šæ–‡è®²è¿°çš„TCPåè®®å»ºç«‹è¿æ¥ã€å‘é€ã€‚å¦‚æœæ•°æ®çš„é•¿åº¦è¶…è¿‡äº†<code>MSS</code>ï¼Œåˆ™ä¼šå°†æ•°æ®ä»¥<code>MSS</code>çš„é•¿åº¦ä¸ºå•ä½è¿›è¡Œåˆ‡åˆ†ï¼Œæ¯ä¸€å—éƒ½ä¼šè¢«æ”¾è¿›å•ç‹¬çš„ç½‘ç»œåŒ…ä¸­ï¼ŒåŠ ä¸ŠTCPå¤´éƒ¨åäº¤ç»™IPæ¨¡å—å‘é€å‡ºå»ã€‚è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°TCPæŠ¥æ–‡åï¼ŒTCPåè®®å±‚æŒ‰ç…§åºåˆ—å·é‡æ–°ç»„è£…æ•°æ®ï¼Œç„¶åæŠŠå®Œæ•´çš„HTTPè¯·æ±‚äº¤ç»™HTTPæœåŠ¡å™¨ç¨‹åºï¼Œæœ€åç”±æœåŠ¡å™¨è§£æå¹¶åšå‡ºå“åº”ï¼Œä¾‹å¦‚è¿”å›è¯·æ±‚çš„ç½‘é¡µå†…å®¹ã€‚è¿™å°±æ˜¯åœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€åå‘ç”Ÿçš„äº‹æƒ…ã€‚</p><h1 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://en.wikipedia.org/wiki/Internet_checksum<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Computer Networking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç½‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®—æ³•-Javaå¸¸ç”¨API</title>
    <link href="/2025/05/08/Java%E5%90%8E%E7%BB%AD%E9%97%AE%E9%A2%98%E8%A1%A5%E5%85%85/"/>
    <url>/2025/05/08/Java%E5%90%8E%E7%BB%AD%E9%97%AE%E9%A2%98%E8%A1%A5%E5%85%85/</url>
    
    <content type="html"><![CDATA[<h2 id="java-scanner">Java Scanner</h2><p><code>java.util.Scanner</code> æ˜¯ Java5 çš„æ–°ç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Scanner ç±»æ¥è·å–ç”¨æˆ·çš„è¾“å…¥ã€‚ACM æ¨¡å¼å¿…å¤‡ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šJUnitçš„æµ‹è¯•æ–¹æ³•ï¼ˆå¦‚<code>@Test</code>ï¼‰é»˜è®¤ä¸ä¼šè¿æ¥æ§åˆ¶å°ï¼ˆ<code>System.in</code>ï¼‰ï¼Œä¸€å®šè¦åœ¨<code>main()</code>æ–¹æ³•ä¸­è¿è¡Œã€‚</p><p>Scanner ç±»çš„UML å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/05/07/pELmNqI.png" /></p><p>å®ƒå®ç°äº†<code>AutoCloseable</code>æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨try-with-resourcesè‡ªåŠ¨å…³é—­èµ„æºã€‚</p><p>åˆ›å»ºä¸€ä¸ª Scanner å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br></code></pre></td></tr></table></figure><p><strong>æ¥æ”¶ String ç±»å‹è¾“å…¥</strong>ï¼š</p><ul><li><code>next()</code><ul><li>ä¸€å®šè¦è¯»å–åˆ°æœ‰æ•ˆå­—ç¬¦åæ‰å¯ä»¥ç»“æŸè¾“å…¥ã€‚</li><li>å¯¹è¾“å…¥æœ‰æ•ˆå­—ç¬¦ä¹‹å‰é‡åˆ°çš„ç©ºç™½ï¼Œ<code>next()</code>æ–¹æ³•ä¼šè‡ªåŠ¨å°†å…¶å»æ‰ã€‚</li><li>åªæœ‰è¾“å…¥æœ‰æ•ˆå­—ç¬¦åæ‰å°†å…¶åé¢è¾“å…¥çš„ç©ºç™½ä½œä¸ºåˆ†éš”ç¬¦æˆ–è€…ç»“æŸç¬¦ã€‚</li><li><code>next()</code> ä¸èƒ½å¾—åˆ°å¸¦æœ‰ç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚</li></ul></li><li><code>nextLine()</code><ul><li>ä»¥Enterä¸ºç»“æŸç¬¦,ä¹Ÿå°±æ˜¯è¯´<code>nextLine()</code>æ–¹æ³•è¿”å›çš„æ˜¯è¾“å…¥å›è½¦ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦ã€‚</li><li>å¯ä»¥è·å¾—ç©ºç™½</li></ul></li></ul><p><strong>æ¥æ”¶<code>int</code>ã€<code>long</code>ç±»å‹çš„è¾“å…¥</strong>ï¼Œå¯ä»¥ä½¿ç”¨<code>nextInt()</code>ã€<code>nextLong()</code>ç­‰ã€‚ä½†æ˜¯æœ‰ä»¥ä¸‹å‡ ç‚¹è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ol type="1"><li>è¿™ç±»æ–¹æ³•ä¸ä¼šæ¶ˆè€—å›è½¦é”®äº§ç”Ÿçš„æ¢è¡Œç¬¦ï¼Œä½†æ˜¯<code>nextLine()</code>ä¼šè¯»å–æ¢è¡Œç¬¦ï¼Œæ‰€ä»¥åœ¨äºŒè€…æ··ç”¨çš„æ—¶å€™è¦æ³¨æ„ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScannerDemoTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scan</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—ï¼š&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> scan.nextInt();  <span class="hljs-comment">// è¾“å…¥ï¼š123</span><br><br>        System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€å¥è¯ï¼š&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> scan.nextLine();  <span class="hljs-comment">// é—®é¢˜å‡ºåœ¨è¿™é‡Œ</span><br><br>        System.out.println(<span class="hljs-string">&quot;ä½ è¾“å…¥çš„æ•°å­—æ˜¯ï¼š&quot;</span> + num);<br>        System.out.println(<span class="hljs-string">&quot;ä½ è¾“å…¥çš„è¯æ˜¯ï¼š&quot;</span> + line);<br><br>        scan.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—ï¼š123<br>è¯·è¾“å…¥ä¸€å¥è¯ï¼šä½ è¾“å…¥çš„æ•°å­—æ˜¯ï¼š123<br>ä½ è¾“å…¥çš„è¯æ˜¯ï¼š<br></code></pre></td></tr></table></figure><p>è§£é‡Šï¼šè¾“å…¥<code>123</code>ï¼ŒæŒ‰ä¸‹å›è½¦é”®çš„æ—¶å€™ï¼Œ<code>123</code>èµ‹å€¼ç»™äº†<code>num</code>ï¼Œä¸æ­¤åŒæ—¶<code>line</code>æ¥æ”¶åˆ°å›è½¦ç¬¦ï¼Œå› æ­¤è¿˜æ²¡æ¥å¾—åŠè¾“å…¥ä¸€å¥è¯ç¨‹åºå°±ç»“æŸäº†ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨<code>int num = scan.nextInt();</code>åé¢ç´§è·Ÿä¸€ä¸ª<code>scan.nextLine()</code>ï¼ŒæŠŠå›è½¦å¸æ”¶æ‰ã€‚</p><ol start="2" type="1"><li><code>nextInt()</code>ç­‰æ¥æ”¶ç‰¹å®šæ•°æ®ç±»å‹<strong>ä¸èƒ½æ¥æ”¶å…¶ä»–ç±»å‹çš„æ•°æ®</strong>ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¼šæŠ¥å¼‚å¸¸<code>Exception in thread "main" java.util.InputMismatchException</code>ï¼Œæ‰€ä»¥åœ¨æ¥æ”¶æ•°æ®ä¹‹å‰æœ€å¥½ä½¿ç”¨<code>hasNextInt()</code>åˆ¤æ–­è¾“å…¥çš„æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚</li><li><code>nextInt</code>ã€<code>next()</code>ç­‰éƒ½å¯ä»¥æŠŠç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬åœ¨ä¸€è¡Œå†…è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ¯”å¦‚å¯¹äºä¸‹é¢è¿™ç§è¾“å…¥æ ¼å¼</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">3<br>1 4 5 -1<br>1 3 4 -1<br>2 6 -1<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<code>nextInt()</code>å’Œé€‚å½“çš„æ¡ä»¶åˆ¤æ–­å°±èƒ½æå®šã€‚</p><h2 id="æµ‹è¯•ç±»çš„å‘½å">æµ‹è¯•ç±»çš„å‘½å</h2><p>ä½¿ç”¨å•å…ƒæµ‹è¯•JUnitæ—¶ï¼Œå¦‚æœæµ‹è¯•ç±»çš„å‘½åä¸è§„èŒƒï¼Œé‚£ä¹ˆIDEAä¼šæŠ¥è­¦å‘Šï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Test class name &#x27;methodTest&#x27; doesn&#x27;t match regex &#x27;[A-Z][A-Za-z\d]*Test(s|Case)?|Test[A-Z][A-Za-z\d]*|IT(.*)|(.*)IT(Case)?&#x27;<br></code></pre></td></tr></table></figure><p>æŸäº›æµ‹è¯•æ¡†æ¶ï¼ˆå¦‚ Maven Surefireã€JUnitã€IDEæ’ä»¶ï¼‰ä¼šç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è‡ªåŠ¨è¯†åˆ«å“ªäº›ç±»æ˜¯â€œæµ‹è¯•ç±»â€ã€‚</p><p>ä¸Šé¢è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼è§„å®šäº†æµ‹è¯•ç±»å¿…é¡»ç¬¦åˆä»¥ä¸‹æ ¼å¼ä¹‹ä¸€ï¼š</p><ul><li>ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œå¹¶ä»¥ Testã€Tests æˆ– TestCase ç»“å°¾ï¼Œå¦‚ï¼š<ul><li>LoginTest</li><li>CalculatorTests</li><li>NetworkTestCase</li></ul></li><li>æˆ–è€… ä»¥ Test å¼€å¤´ï¼Œå¦‚ï¼š<ul><li>TestLogin</li><li>TestConnectionManager</li></ul></li><li>æˆ–è€…åŒ…å« ITï¼ˆé€šå¸¸ä»£è¡¨é›†æˆæµ‹è¯•ï¼‰ï¼š<ul><li>UserServiceIT</li><li>ITLoginFlow</li></ul></li></ul><h2 id="å®ç”¨æ–¹æ³•">å®ç”¨æ–¹æ³•</h2><h3 id="split">split</h3><p>å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String[] split(String regex) &#123;<br>    <span class="hljs-keyword">return</span> split(regex, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½œç”¨ï¼šæ ¹æ®ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å­—ç¬¦ä¸²ã€‚</p><ul><li><code>å‚æ•°</code>ï¼šå®šç•Œæ­£åˆ™è¡¨è¾¾å¼</li><li><code>è¿”å›å€¼</code>ï¼šæ ¹æ®ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å¾—åˆ°çš„<code>String[]</code>æ•°ç»„</li></ul><p>ä¸¾ä¾‹ï¼šè¾“å…¥ IPåœ°å€å’Œå­ç½‘æ©ç ï¼Œè¾“å‡ºç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ã€‚ç¬¬ä¸€æ­¥ä»ç»™å®šçš„å­—ç¬¦ä¸²ä¸­æå–æ•°å­—çš„è¿‡ç¨‹å¯ä»¥ç”¨<code>split</code>å®Œæˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] parse(String str) &#123;<br>    String[] newStr = str.split(<span class="hljs-string">&quot;\\.&quot;</span>);<br>    <span class="hljs-type">int</span>[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>        result[i] = Integer.parseInt(newStr[i]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;192.168.1.10&quot;</span>;<br>    <span class="hljs-type">int</span>[] result = parse(s);<br>    System.out.println(Arrays.toString(result));<br>    <span class="hljs-comment">// [192, 168, 1, 10]</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯è§åŸå­—ç¬¦ä¸²ä¸­çš„å°æ•°ç‚¹å·²ç»è¢«æˆåŠŸå»æ‰ï¼Œå››ä¸ªæ•°å­—è¢«è½¬æ¢æˆæ•´å‹å˜é‡ä¿å­˜åœ¨äº†æ•°ç»„ä¸­ã€‚</p><p>å°æ•°ç‚¹å±äºæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œ<code>.</code>ç”¨äºåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæƒ³åŒ¹é…å®ƒæœ¬èº«å¿…é¡»åœ¨å‰é¢åŠ ä¸Š<code>\\</code>ã€‚æ‰€ä»¥å¿…é¡»ç”¨<code>"\\."</code>æ¥è¡¨ç¤ºåŒ¹é…å°æ•°ç‚¹ã€‚ç±»ä¼¼çš„ç‰¹æ®Šå­—ç¬¦è¿˜æœ‰ï¼š</p><table><thead><tr><th>å­—ç¬¦</th><th>å«ä¹‰</th><th>åŒ¹é…è‡ªèº«éœ€å†™ä½œ</th></tr></thead><tbody><tr><td><code>.</code></td><td>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆé™¤æ¢è¡Œï¼‰</td><td><code>\\.</code></td></tr><tr><td><code>*</code></td><td>åŒ¹é…å‰é¢çš„å†…å®¹é›¶æ¬¡æˆ–å¤šæ¬¡</td><td><code>\\*</code></td></tr><tr><td><code>+</code></td><td>åŒ¹é…å‰é¢çš„å†…å®¹ä¸€æ¬¡æˆ–å¤šæ¬¡</td><td><code>\\+</code></td></tr><tr><td><code>?</code></td><td>åŒ¹é…å‰é¢çš„å†…å®¹é›¶æ¬¡æˆ–ä¸€æ¬¡</td><td><code>\\?</code></td></tr><tr><td><code>^</code></td><td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´</td><td><code>\\^</code></td></tr><tr><td><code>$</code></td><td>åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾</td><td><code>\\$</code></td></tr><tr><td><code>[</code></td><td>å¼€å§‹ä¸€ä¸ªå­—ç¬¦ç±»</td><td><code>\\[</code></td></tr><tr><td><code>]</code></td><td>ç»“æŸä¸€ä¸ªå­—ç¬¦ç±»</td><td><code>\\]</code></td></tr><tr><td><code>&#123;</code></td><td>æŒ‡å®šåŒ¹é…æ¬¡æ•°ï¼ˆå¦‚ <code>&#123;3&#125;</code>ï¼‰</td><td><code>\\&#123;</code></td></tr><tr><td><code>&#125;</code></td><td>ç»“æŸæŒ‡å®šæ¬¡æ•°</td><td><code>\\&#125;</code></td></tr><tr><td><code>(</code></td><td>å¼€å§‹ä¸€ä¸ªåˆ†ç»„</td><td><code>\\(</code></td></tr><tr><td><code>)</code></td><td>ç»“æŸä¸€ä¸ªåˆ†ç»„</td><td><code>\\)</code></td></tr><tr><td><code>\|</code></td><td>é€»è¾‘â€œæˆ–â€</td><td><code>\\\|</code></td></tr><tr><td><code>\\</code></td><td>è½¬ä¹‰ç¬¦æœ¬èº«</td><td><code>\\\\</code></td></tr></tbody></table><h3 id="replaceall">replaceAll</h3><p>ä½¿ç”¨åœºæ™¯ï¼š<ahref="https://leetcode.cn/problems/serialize-and-deserialize-binary-tree/">äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</a></p><p>åºåˆ—åŒ–ï¼Œä½¿ç”¨<code>StringBuilder</code>å¾—åˆ°ç»“æœä¹‹åï¼Œéœ€è¦åˆ é™¤å°¾éƒ¨å¤šä½™çš„<code>null</code>ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨<code>replaceAll</code></p><p>è¯­æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">newString</span> <span class="hljs-operator">=</span> originalString.replaceAll(String regex, String replacement);<br></code></pre></td></tr></table></figure><ul><li><code>regex</code>ï¼šè¦åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆpatternï¼‰</li><li>`replacementï¼šç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²</li></ul><p>åœ¨è¿™é“ç®—æ³•ä¸­çš„ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> sb.toString();<br><br><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> res.replaceAll(<span class="hljs-string">&quot;(null,)+$&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><br><span class="hljs-keyword">if</span>(result.endsWith(<span class="hljs-string">&quot;,&quot;</span>))<br>    result = result.substring(<span class="hljs-number">0</span>, result.length()-<span class="hljs-number">1</span>);<br><br><span class="hljs-keyword">return</span> result+<span class="hljs-string">&quot;]&quot;</span>;<br></code></pre></td></tr></table></figure><ul><li>æ­£åˆ™è¡¨è¾¾å¼<code>"(null,)+$"</code><ul><li><code>(null,)+</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ª<code>"null,"</code>ã€‚<code>+</code>æ˜¯å®šä½ç¬¦ï¼Œè¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªåŒ¹é…ã€‚</li><li><code>$</code>è¡¨ç¤ºä»æ–‡æœ¬çš„æœ«å°¾ä½ç½®å¼€å§‹åŒ¹é…ã€‚</li></ul></li></ul><p>æ‰€ä»¥è¯¥æ­£åˆ™çš„å«ä¹‰å°±æ˜¯å­—ç¬¦ä¸²æœ«å°¾çš„è¿ç»­å¤šä¸ª<code>null,</code>ã€‚</p><h2 id="substring">substring</h2><p>è¯­æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">substring</span><span class="hljs-params">(<span class="hljs-type">int</span> beginIndex, <span class="hljs-type">int</span> endIndex)</span> &#123;...&#125;<br><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">substring</span><span class="hljs-params">(<span class="hljs-type">int</span> beginIndex)</span> &#123;<br>        <span class="hljs-keyword">return</span> substring(beginIndex, length());<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li><code>beginIndex</code>ï¼šèµ·å§‹ç´¢å¼•ï¼ŒåŒ…å«</li><li><code>endIndex</code>ï¼šç»“æŸç´¢å¼•ï¼Œä¸åŒ…å«ã€‚å¦‚æœæ²¡æœ‰è¯¥å‚æ•°ï¼Œåˆ™ä»èµ·å§‹ç´¢å¼•å¼€å§‹æˆªå–åˆ°æœ«å°¾ï¼ˆæœ¬è´¨ä¸Šè¿˜æ˜¯è°ƒç”¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼‰</li><li>è¿”å›å€¼ï¼šæŒ‡å®šçš„å­å­—ç¬¦ä¸²</li></ul><h2 id="æ ˆåº”è¯¥ç”¨å“ªä¸ªå®ç°ç±»">æ ˆåº”è¯¥ç”¨å“ªä¸ªå®ç°ç±»ï¼Ÿ</h2><h3 id="å…ˆè¯´ç»“è®º">å…ˆè¯´ç»“è®º</h3><p><code>Stack.java</code>çš„æ–‡æ¡£æ³¨é‡Šä¸­æ˜¯è¿™æ ·è§£é‡Šçš„ï¼š</p><div class="note note-secondary">            <p>Stack ç±»è¡¨ç¤ºä¸€ä¸ªåè¿›å…ˆå‡º (LIFO) çš„å¯¹è±¡å †æ ˆã€‚å®ƒæ‰©å±•äº† Vectorç±»ï¼Œå¢åŠ äº†äº”ä¸ªæ“ä½œï¼Œå…è®¸å°†å‘é‡è§†ä¸ºå †æ ˆã€‚å®ƒæä¾›äº†å¸¸è§çš„ push å’Œ popæ“ä½œï¼Œä»¥åŠä¸€ä¸ªç”¨äºæŸ¥çœ‹å †æ ˆé¡¶éƒ¨å…ƒç´ çš„æ–¹æ³•ã€ä¸€ä¸ªç”¨äºæµ‹è¯•å †æ ˆæ˜¯å¦ä¸ºç©ºçš„æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªç”¨äºåœ¨å †æ ˆä¸­æœç´¢å…ƒç´ å¹¶ç¡®å®šå…¶è·ç¦»é¡¶éƒ¨è·ç¦»çš„æ–¹æ³•ã€‚</p><p>å †æ ˆé¦–æ¬¡åˆ›å»ºæ—¶ä¸åŒ…å«ä»»ä½•å…ƒç´ ã€‚</p><p><strong>Deque æ¥å£åŠå…¶å®ç°æä¾›äº†ä¸€å¥—æ›´å®Œæ•´ã€æ›´ä¸€è‡´çš„ LIFOå †æ ˆæ“ä½œï¼Œåº”ä¼˜å…ˆä½¿ç”¨æ­¤ç±»</strong>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Deque&lt;Integer&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;Integer&gt;();<br></code></pre></td></tr></table></figure>          </div><p><code>Deque</code>å³ä¸¤ä¸ªå¸¸ç”¨å®ç°ç±»ï¼š<code>LinkedList</code>å’Œ<code>ArrayDeque</code>ã€‚</p><p>åœ¨<code>ArrayDeque.java</code>çš„å¼€å¤´æ–‡æ¡£æ³¨é‡Šï¼š</p><div class="note note-secondary">            <p>Dequeæ¥å£çš„åŠ¨æ€æ•°ç»„å®ç°ã€‚æ•°ç»„åŒç«¯é˜Ÿåˆ—æ²¡æœ‰å®¹é‡é™åˆ¶ï¼›å®ƒä»¬ä¼šæ ¹æ®éœ€è¦æ‰©å®¹ä»¥æ”¯æŒä½¿ç”¨ã€‚å®ƒä»¬ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›åœ¨æ²¡æœ‰å¤–éƒ¨åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è®¿é—®ã€‚ç¦æ­¢ä½¿ç”¨Null å…ƒç´ ã€‚<strong>æ­¤ç±»ç”¨ä½œå †æ ˆæ—¶å¯èƒ½æ¯” Stack æ›´å¿«ï¼Œç”¨ä½œé˜Ÿåˆ—æ—¶å¯èƒ½æ¯”LinkedList æ›´å¿«</strong>ã€‚</p>          </div><p>æ‰€ä»¥åº”è¯¥ä½¿ç”¨<code>ArrayDeque</code>æ¨¡æ‹Ÿæ ˆå’Œé˜Ÿåˆ—ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä¸ä½¿ç”¨stack">ä¸ºä»€ä¹ˆä¸ä½¿ç”¨Stack</h3><p>Stack çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Vector</span>&lt;E&gt; &#123;...&#125;<br></code></pre></td></tr></table></figure><p><code>Stack</code>ç»§æ‰¿äº†<code>Vector</code>ã€‚<code>Vector</code>æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„åŠ¨æ€æ•°ç»„ï¼Œä½†å®ƒä½¿ç”¨çš„æ˜¯åŒæ­¥æ–¹æ³•ï¼ˆ<code>synchronized</code>ï¼‰ï¼Œè¿™åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹åè€Œé€ æˆäº†ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚æŸ¥çœ‹<code>Vector</code>çš„æºç ä¼šå‘ç°å‡ ä¹æ¯ä¸€ä¸ªæ–¹æ³•è¢«éƒ½åŠ ä¸Šäº†<code>synchronized</code>ä¿®é¥°ï¼Œæ¯”å¦‚æ·»åŠ å’Œåˆ é™¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addElement</span><span class="hljs-params">(E obj)</span> &#123;<br>    modCount++;<br>    add(obj, elementData, elementCount);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeElement</span><span class="hljs-params">(Object obj)</span> &#123;<br>  modCount++;<br>  <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> indexOf(obj);<br>  <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span>) &#123;<br>      removeElementAt(i);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯éå¸¸ç²—æš´ä¸”ä¸åˆç†çš„ã€‚</p><p><code>Stack</code>ä½œä¸ºå®ƒçš„å­ç±»ä¹Ÿå¼ºåˆ¶ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œå°±ç®—æ˜¯æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¿™æ ·ä¼šæ˜æ˜¾é™ä½æ€§èƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆarraydequeæ›´ä¼˜">ä¸ºä»€ä¹ˆArrayDequeæ›´ä¼˜</h3><p><code>ArrayDeque</code>æ˜¯ä¸€ä¸ªåŸºäº<strong>å¾ªç¯æ•°ç»„</strong>å®ç°çš„åŒç«¯é˜Ÿåˆ—ï¼Œè®¿é—®é€Ÿåº¦éå¸¸å¿«ã€‚è€Œ<code>LinkedList</code>æ˜¯é“¾è¡¨ï¼Œæ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½å¿…é¡»ä»å¤´èŠ‚ç‚¹å¼€å§‹å¾€ä¸‹æ‰¾ï¼Œæ˜æ˜¾æ…¢å¾—å¤šã€‚å¦ä¸€æ–¹é¢ï¼Œ<code>ArrayDeque</code>ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œè€Œé“¾è¡¨çš„æ‰©å®¹éœ€è¦é¢‘ç¹åˆ›å»ºæ–°çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶è´Ÿæ‹…å¤§ã€‚</p><h2 id="treesetå’Œtreemap">TreeSetå’ŒTreeMap</h2><p>äºŒå‰æœç´¢æ ‘æ˜¯å¦å¹³è¡¡å¯¹äºŒå‰æœç´¢æ ‘çš„æ—¶é—´æ•ˆç‡è‡³å…³é‡è¦ã€‚Javaæ ¹æ®çº¢é»‘æ ‘è¿™ç§å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘å®ç°TreeSetå’ŒTreeMapä¸¤ç§æ•°æ®ç»“æ„ã€‚</p><p>TreeSetå®ç°äº†æ¥å£Setï¼Œå®ƒå†…éƒ¨çš„å¹³è¡¡äºŒå‰æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹åªåŒ…å«ä¸€ä¸ªå€¼ï¼Œæ ¹æ®è¿™ä¸ªå€¼çš„æŸ¥æ‰¾ã€æ·»åŠ å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<spanclass="math inline">\(O(\log{n})\)</span>ã€‚é™¤äº†Setæ¥å£å®šä¹‰çš„æ–¹æ³•ä»¥å¤–ï¼Œå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åºå·</th><th>å‡½æ•°</th><th>å‡½æ•°åŠŸèƒ½</th></tr></thead><tbody><tr><td>1</td><td>ceiling</td><td>è¿”å›é”®å¤§äºæˆ–ç­‰äºç»™å®šå€¼çš„æœ€å°é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr><tr><td>2</td><td>floor</td><td>è¿”å›é”®å°äºæˆ–ç­‰äºç»™å®šå€¼çš„æœ€å¤§é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr><tr><td>3</td><td>higher</td><td>è¿”å›é”®å¤§äºç»™å®šå€¼çš„æœ€å°é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr><tr><td>4</td><td>lower</td><td>è¿”å›é”®å°äºç»™å®šå€¼çš„æœ€å¤§é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr></tbody></table><p>TreeMap å®ç°äº†æ¥å£Mapã€‚å’ŒTreeSetä¸ä¸€æ ·ï¼ŒTreeMapå†…éƒ¨çš„å¹³è¡¡äºŒå‰æœç´¢æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªåŒ…å«é”®å€¼å’Œå€¼çš„æ˜ å°„ã€‚å¯ä»¥æ ¹æ®é”®å€¼å®ç°æ—¶é—´å¤æ‚åº¦ä¸º<spanclass="math inline">\(O(\log{n})\)</span>çš„æŸ¥æ‰¾ã€æ·»åŠ å’Œåˆ é™¤æ“ä½œã€‚é™¤äº†Mapæ¥å£å®šä¹‰çš„æ–¹æ³•ä»¥å¤–ï¼Œå¸¸ç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åºå·</th><th>å‡½æ•°</th><th>å‡½æ•°åŠŸèƒ½</th></tr></thead><tbody><tr><td>1</td><td>ceilingEntry / ceilingKey</td><td>è¿”å›é”®å¤§äºæˆ–ç­‰äºç»™å®šå€¼çš„æœ€å°æ˜ å°„ / é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr><tr><td>2</td><td>floorEntry / floorKey</td><td>è¿”å›é”®å°äºæˆ–ç­‰äºç»™å®šå€¼çš„æœ€å¤§æ˜ å°„ / é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr><tr><td>3</td><td>higherEntry / higherKey</td><td>è¿”å›é”®å¤§äºç»™å®šå€¼çš„æœ€å°æ˜ å°„ / é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr><tr><td>4</td><td>lowerEntry / lowerKey</td><td>è¿”å›é”®å°äºç»™å®šå€¼çš„æœ€å¤§æ˜ å°„ / é”®ï¼›å¦‚æœæ²¡æœ‰åˆ™è¿”å› null</td></tr></tbody></table><p>å“ˆå¸Œè¡¨çš„å¢åˆ æ”¹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<spanclass="math inline">\(O(1)\)</span>ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯åªèƒ½æ ¹æ®é”®æ¥åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ä»¥åŠè·å–é”®å¯¹åº”çš„å€¼ã€‚å¦‚æœéœ€è¦æ ¹æ®æ•°å€¼çš„å¤§å°æŸ¥æ‰¾ï¼Œå¦‚æŸ¥æ‰¾æ•°æ®é›†åˆä¸­æ¯”æŸä¸ªå€¼å¤§çš„æ‰€æœ‰æ•°å­—ä¸­çš„æœ€å°çš„ä¸€ä¸ªï¼Œå“ˆå¸Œè¡¨å°±æ— èƒ½ä¸ºåŠ›ã€‚</p><p>å¦‚æœåœ¨ä¸€ä¸ªå·²ç»æ’åºçš„åŠ¨æ€æ•°ç»„ä¸­æ ¹æ®æ•°å€¼çš„å¤§å°è¿›è¡ŒæŸ¥æ‰¾ï¼ŒäºŒåˆ†æŸ¥æ‰¾ä¹Ÿå¯ä»¥å®ç°<spanclass="math inline">\(O(\log{n})\)</span>ï¼Œä½†æ˜¯æ’åºçš„åŠ¨æ€æ•°ç»„çš„æ·»åŠ å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<spanclass="math inline">\(O(n)\)</span>ï¼Œä¸å¦‚<code>TreeSet</code>å’Œ<code>TreeMap</code>ã€‚</p><h2 id="copyofå’Œcopyofrange">copyOfå’ŒcopyOfRange</h2><p>copyOf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T[] copyOf(T[] original, <span class="hljs-type">int</span> newLength)<br></code></pre></td></tr></table></figure><ul><li><code>original</code>ï¼šåŸå§‹æ•°ç»„</li><li><code>newLength</code>ï¼šå¤åˆ¶åæ–°çš„æ•°ç»„çš„é•¿åº¦ï¼Œä»0å¼€å§‹å¤åˆ¶ã€‚å¦‚æœnewLength å¤§äºåŸå§‹æ•°ç»„é•¿åº¦ï¼Œå¤šå‡ºæ¥çš„éƒ¨åˆ†ç”¨é»˜è®¤å€¼å¡«å……ã€‚</li></ul><p>copyOfRange</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T[] copyOfRange(T[] original, <span class="hljs-type">int</span> from, <span class="hljs-type">int</span> to)<br></code></pre></td></tr></table></figure><ul><li><code>original</code>: åŸå§‹æ•°ç»„</li><li><code>from</code>: èµ·ç‚¹ï¼ˆåŒ…å«ï¼‰</li><li><code>to</code>ï¼šç»ˆç‚¹ï¼ˆä¸åŒ…å«ï¼‰</li></ul><p>æ–°æ•°ç»„çš„é•¿åº¦ = to -fromã€‚å¦‚æœ<code>to</code>å¤§äºæ•°ç»„çš„é•¿åº¦ï¼Œå¤šå‡ºæ¥çš„éƒ¨åˆ†ç”¨é»˜è®¤å€¼å¡«å……ã€‚</p><h2 id="random">Random</h2><p>åˆ›å»ºéšæœºæ•°å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> random.nextInt(bound);<br></code></pre></td></tr></table></figure></p><ul><li>ç”Ÿæˆä¸€ä¸ªèŒƒå›´åœ¨<code>[0, bound)</code>èŒƒå›´å†…çš„æ•´æ•°</li></ul><p>å‡ºç°ä½ç½®ï¼š<ahref="https://leetcode.cn/problems/insert-delete-getrandom-o1/description/">O(1)æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </a></p><h2id="å¦‚ä½•å°†åˆ—è¡¨è½¬æ¢æˆç‰¹å®šç±»å‹çš„æ•°ç»„">å¦‚ä½•å°†åˆ—è¡¨è½¬æ¢æˆç‰¹å®šç±»å‹çš„æ•°ç»„</h2><h3 id="å¼•å…¥">å¼•å…¥</h3><p>å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;ListNode&gt; TempList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>...<br>ListNode[] lists = TempList.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>[<span class="hljs-number">0</span>]);<br></code></pre></td></tr></table></figure><p><code>lists</code>æ˜¯ä¸€ä¸ªç”¨äºå­˜æ”¾<code>ListNode</code>æ•°æ®çš„æ•°ç»„ï¼Œ<code>Templist</code>æ˜¯ä¸€ä¸ªå­˜æ”¾<code>ListNode</code>å…ƒç´ çš„åˆ—è¡¨ã€‚æœ€åä¸€è¡Œä»£ç å®ç°äº†ä»<code>TempList</code>åˆ—è¡¨å‘æ•°ç»„çš„è½¬åŒ–ã€‚è¿™é‡Œçš„å…³é”®æ˜¯<code>toArray</code>æ–¹æ³•ï¼Œå®é™…ä¸Š<code>List</code>æ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ª<code>toArray</code>æŠ½è±¡æ–¹æ³•ï¼Œä¸€ä¸ªç©ºå‚ä¸€ä¸ªæœ‰å‚ï¼Œå®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Object[] toArray();<br>&lt;T&gt; T[] toArray(T[] a);<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ææ¸…æ¥šè¿™ä¸¤ä¸ªæ–¹æ³•å¦‚ä½•ä½¿ç”¨ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹<code>runtime type</code>ï¼ˆè¿è¡Œæ—¶ç±»å‹ï¼‰å’Œ<code>compile type</code>ï¼ˆç¼–è¯‘æ—¶ç±»å‹ï¼‰ã€‚</p><h3 id="ç¼–è¯‘æ—¶ç±»å‹å’Œè¿è¡Œæ—¶ç±»å‹">ç¼–è¯‘æ—¶ç±»å‹å’Œè¿è¡Œæ—¶ç±»å‹</h3><p>è¿è¡Œæ—¶ç±»å‹ï¼ŒæŒ‡çš„æ˜¯å¯¹è±¡åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­çœŸå®çš„ç±»å‹ã€‚ä¹‹æ‰€ä»¥å¼ºè°ƒâ€œçœŸå®â€ï¼Œæ˜¯å› ä¸ºJavaä¸­çš„å¤šæ€ä½¿å¾—ç¼–è¯‘å™¨è®¤ä¸ºçš„ç±»å‹å’Œç¨‹åºè¿è¡Œæ—¶çš„ç±»å‹å¯èƒ½ä¸ä¸€æ ·ï¼Œä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Animal</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br></code></pre></td></tr></table></figure><p>æ‰€è°“<em>ç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å³è¾¹</em>ï¼Œ<code>a</code>çš„ç¼–è¯‘æ—¶ç±»å‹æ˜¯<code>Animal</code>ï¼Œè¿è¡Œæ—¶ç±»å‹æ˜¯<code>Dog</code>ã€‚</p><h3 id="javaæ ‡å‡†åº“æä¾›çš„æ³¨é‡Š">Javaæ ‡å‡†åº“æä¾›çš„æ³¨é‡Š</h3><p>å…ˆçœ‹ç©ºå‚æ–¹æ³•<code>Object[] toArray();</code>ï¼š</p><blockquote><p>æŒ‰ç…§æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªï¼‰è¿”å›ä¸€ä¸ªåŒ…å«åŸåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚</p><p>è¿”å›çš„æ•°ç»„æ˜¯â€œå®‰å…¨çš„â€ï¼Œæ„æ€å°±æ˜¯è¯´å®ƒä¸åŒ…å«ä»»ä½•å¯¹åŸåˆ—è¡¨çš„å¼•ç”¨ï¼Œæ˜¯å®Œå…¨ç‹¬ç«‹äºåŸåˆ—è¡¨çš„ã€‚ä½ å¯ä»¥æ”¾å¿ƒåœ°ä¿®æ”¹å®ƒï¼Œä¸ç”¨æ‹…å¿ƒä¼šå¯¹åŸåˆ—è¡¨äº§ç”Ÿä»»ä½•å½±å“ã€‚</p><p>è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºæ•°ç»„çš„ API å’ŒåŸºäºé›†åˆçš„ API ä¹‹é—´çš„æ¡¥æ¢ã€‚</p></blockquote><p><code>è¿”å›å€¼</code>:ä¸€ä¸ªä»¥æ­£ç¡®çš„é¡ºåºåŒ…å«åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„<code>Object</code>æ•°ç»„</p><p>è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç±»å‹å›ºå®šä¸º<code>Object[]</code>ï¼Œåœ¨å®é™…åº”ç”¨ä¸­éœ€è¦æ‰‹åŠ¨å¼ºè½¬æˆæˆ‘ä»¬éœ€è¦çš„ç±»å‹ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚äºæ˜¯å°±æœ‰äº†åé¢è¿™ä¸ªå¸¦å‚æ•°çš„æ–¹æ³•</p><hr /><p><code>&lt;T&gt; T[] toArray(T[] a);</code></p><blockquote><p>ç…§æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªï¼‰è¿”å›ä¸€ä¸ªåŒ…å«åŸåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚è¿”å›æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ä¸æŒ‡å®šæ•°ç»„ç›¸åŒã€‚å¦‚æœè¯¥åˆ—è¡¨å¯ä»¥è£…å…¥æŒ‡å®šçš„æ•°ç»„ä¸­ï¼Œåˆ™ç›´æ¥æŠŠå®ƒæ”¾è¿›æ•°ç»„å¹¶è¿”å›ï¼›å¦åˆ™ï¼Œä¼šåˆ†é…ä¸€ä¸ªå…·æœ‰ä¸æŒ‡å®šæ•°ç»„ç›¸åŒè¿è¡Œæ—¶ç±»å‹çš„æ–°æ•°ç»„ï¼Œå…¶å¤§å°ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚</p><p>å¦‚æœæŒ‡å®šçš„æ•°ç»„æ¯”åŸåˆ—è¡¨éœ€è¦çš„ç©ºé—´è¿˜å¤§ï¼Œé‚£ä¹ˆç©ºç¼ºä½ç½®ä¼šè¢«èµ‹å€¼ä¸º<code>null</code>ã€‚ï¼ˆ<em>ä»…å½“</em>è°ƒç”¨è€…ç¡®è®¤åŸåˆ—è¡¨ä¸­ä¸åŒ…å«ä»»ä½•<code>null</code>å…ƒç´ æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§æ‰æœ‰åŠ©äºåˆ¤æ–­åˆ—è¡¨çš„é•¿åº¦ï¼‰</p><p>å°±åƒ<code>toArray()</code>æ–¹æ³•ä¸€æ ·ï¼Œè¯¥æ–¹æ³•æ˜¯åŸºäºæ•°ç»„çš„ APIå’ŒåŸºäºé›†åˆçš„ APIä¹‹é—´çš„æ¡¥æ¢ã€‚æ­¤å¤–ï¼Œè¯¥æ–¹æ³•å…è®¸å¯¹è¾“å‡ºæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹è¿›è¡Œç²¾ç¡®çš„æ§åˆ¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æˆ–è®¸å¯ä»¥èŠ‚çœå†…å­˜å¼€é”€ã€‚</p><p>å‡è®¾<code>x</code>æ˜¯ä¸€ä¸ªå·²çŸ¥åªåŒ…å«å­—ç¬¦ä¸²çš„åˆ—è¡¨ã€‚ä»¥ä¸‹ä»£ç å¯ä»¥ç”¨äºå°†åˆ—è¡¨è½¬å­˜åˆ°æ–°åˆ†é…çš„Stringæ•°ç»„ä¸­ï¼š</p><p><code>String[] y = x.toArray(new String[0]);</code></p><p>æ³¨æ„<code>toArray(new Object[0])</code>ä¸ä¸Šé¢çš„<code>toArray()</code>å®Œå…¨ç›¸åŒã€‚</p></blockquote><p><code>å‚æ•°</code>: <code>a</code>-æŒ‡å®šæ•°ç»„ï¼Œå¦‚æœè¶³å¤Ÿå¤§ï¼ŒåŸåˆ—è¡¨çš„å…ƒç´ å°†è¢«ç›´æ¥å­˜å…¥è¯¥æ•°ç»„ï¼›å¦åˆ™ï¼Œä¼šåˆ†é…ä¸€ä¸ªä¸ä¹‹ç›¸åŒè¿è¡Œç±»å‹çš„æ–°æ•°ç»„ã€‚</p><p><code>è¿”å›å€¼</code>: ä¸€ä¸ªåŒ…å«åˆ—è¡¨å…ƒç´ çš„æ•°ç»„</p><p><code>æŠ›å‡º</code>: <code>ArrayStoreException</code> -å¦‚æœæŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ä¸æ˜¯æ¯ä¸€ä¸ªåˆ—è¡¨å…ƒç´ çš„çˆ¶ç±»å‹<br /><code>NullPointerException</code> - å¦‚æœæŒ‡å®šæ•°ç»„æ˜¯<code>null</code></p><hr /><p>Javaæ ‡å‡†åº“ä¸­ç»™å‡ºçš„è§£é‡Šå·²ç»éå¸¸è¯¦ç»†äº†ã€‚å¯¹äºå¼€å¤´å¤„çš„è¯­å¥<code>ListNode[] lists = TempList.toArray(new ListNode[0]);</code>ï¼Œå½¢å‚<code>new ListNode[0]</code>çš„ä¸»è¦ä½œç”¨æ˜¯<strong>ç¡®å®šè¿”å›æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹</strong>ï¼Œå®ƒä½œä¸ºæˆ‘ä»¬ç»™å‡ºçš„æŒ‡å®šæ•°ç»„ï¼Œå…¶å®¹é‡ä¸º0ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥ä¼šåˆ†é…ä¸€ä¸ªè¿è¡Œæ—¶ç±»å‹ä¸º<code>ListNode[]</code>çš„æ–°æ•°ç»„ï¼Œå…¶å®¹é‡ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚ç„¶åï¼ŒæŠŠè¿”å›çš„æ•°ç»„èµ‹ç»™ç›¸åŒç±»å‹çš„æ•°ç»„<code>lists</code>å°±æ²¡æœ‰ä»»ä½•é—®é¢˜äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Algorithm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>æ•°æ®ç»“æ„ä¸ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLåŸºæœ¬ä½¿ç”¨</title>
    <link href="/2025/05/06/MySQL%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/05/06/MySQL%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®åº“å¸¸è¯†">æ•°æ®åº“å¸¸è¯†</h1><h2 id="æ•°æ®åº“çš„å…³ç³»æ¨¡å‹">æ•°æ®åº“çš„å…³ç³»æ¨¡å‹</h2><p>ä»€ä¹ˆæ˜¯å…³ç³»æ•°æ®åº“ï¼Ÿ</p><blockquote><p>å…³ç³»æ•°æ®åº“æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨ç›¸äº’å…³è”çš„æ•°æ®ç‚¹å¹¶æä¾›æ•°æ®ç‚¹è®¿é—®çš„æ•°æ®åº“ã€‚å®ƒé‡‡ç”¨å…³ç³»æ¨¡å‹ï¼Œç›´æ¥ã€ç›´è§‚åœ°åœ¨è¡¨ä¸­å±•ç¤ºæ•°æ®ã€‚</p><p>åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€æ¡<strong>è®°å½•</strong>ï¼Œæ¯æ¡è®°å½•éƒ½å…·æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDï¼ˆåˆè¢«ç§°ä¸º<strong>é”®</strong>ï¼‰ï¼Œè€Œè¡¨ä¸­çš„åˆ—åˆ™ç”¨äºå­˜å‚¨æ•°æ®çš„<strong>å±æ€§</strong>â€”â€”æ¯æ¡è®°å½•çš„æ¯ä¸€ä¸ªå±æ€§é€šå¸¸éƒ½æœ‰ä¸€ä¸ªå€¼ã€‚ç±æ­¤ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ¨æ•°æ®ç‚¹ä¹‹é—´å»ºç«‹å…³è”ã€‚</p><p>æ•°æ®åº“çš„å…³ç³»æ¨¡å‹ï¼ˆRelational Modelï¼‰æ˜¯å½“å‰æœ€å¹¿æ³›ä½¿ç”¨çš„æ•°æ®æ¨¡å‹ï¼Œå®ƒç”±IBM çš„ E.F. Codd åœ¨ 1970å¹´æå‡ºã€‚è¯¥æ¨¡å‹ä½¿ç”¨<strong>äºŒç»´è¡¨æ ¼</strong>æ¥ç»„ç»‡æ•°æ®ï¼Œå…·æœ‰å¼ºå¤§çš„ç†è®ºåŸºç¡€å’Œè‰¯å¥½çš„å®ç”¨æ€§ã€‚<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://www.oracle.com/cn/database/what-is-a-relational-database/">[1]</span></a></sup></p></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼šè¿™æ˜¯ç”¨æ¥æè¿°å­¦ç”Ÿä¿¡æ¯çš„å…³ç³»è¡¨ï¼š</p><table><thead><tr><th>student_id (PK)</th><th>name</th><th>age</th></tr></thead><tbody><tr><td>1001</td><td>Alice</td><td>20</td></tr><tr><td>1002</td><td>Bob</td><td>21</td></tr><tr><td>1003</td><td>Charlie</td><td>19</td></tr></tbody></table><ul><li><code>student_id</code>æ˜¯å­¦ç”Ÿçš„<strong>é”®</strong></li></ul><p>è¿™æ˜¯å¯é€‰è¯¾ç¨‹è¡¨ï¼š</p><table><thead><tr><th>course_id (PK)</th><th>course_name</th><th>credits</th></tr></thead><tbody><tr><td>C001</td><td>Database Systems</td><td>3</td></tr><tr><td>C002</td><td>Operating Systems</td><td>4</td></tr><tr><td>C003</td><td>Networks</td><td>3</td></tr></tbody></table><ul><li><code>course-id</code>æ˜¯è¯¾ç¨‹çš„<strong>é”®</strong></li></ul><p>ç°åœ¨è¿™äº›å­¦ç”Ÿä»¬éœ€è¦é€‰è¯¾ï¼Œäºæ˜¯å°±æœ‰äº†é€‰è¯¾è¡¨ï¼š</p><table><thead><tr><th>student_id (FK)</th><th>course_id (FK)</th><th>grade</th></tr></thead><tbody><tr><td>1001</td><td>C001</td><td>A</td></tr><tr><td>1001</td><td>C002</td><td>B</td></tr><tr><td>1002</td><td>C001</td><td>A-</td></tr><tr><td>1003</td><td>C003</td><td>B+</td></tr></tbody></table><p>é€šè¿‡ä¸Šè¡¨ï¼Œå€Ÿç”±å­¦ç”Ÿidå°±å¯ä»¥æŸ¥è¯¢åˆ°è¯¾ç¨‹idè¿›è€ŒæŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ï¼Œåˆå¯ä»¥æŸ¥è¯¢åˆ°å­¦ç”Ÿä¿¡æ¯ï¼Œè¿™æ ·å°±å»ºç«‹èµ·äº†ä¸åŒå…³ç³»è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p><h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2><p>å…³ç³»æ•°æ®åº“æ”¯æŒçš„æ•°æ®ç±»å‹ä¸»è¦åŒ…æ‹¬æ•°å€¼ã€å­—ç¬¦ä¸²ã€æ—¥æœŸå’Œæ—¶é—´ã€å¸ƒå°”ã€äºŒè¿›åˆ¶ã€‚</p><blockquote><p>é€šå¸¸æ¥è¯´ï¼ŒBIGINTèƒ½æ»¡è¶³æ•´æ•°å­˜å‚¨çš„éœ€æ±‚ï¼ŒVARCHAR(N)èƒ½æ»¡è¶³å­—ç¬¦ä¸²å­˜å‚¨çš„éœ€æ±‚ï¼Œè¿™ä¸¤ç§ç±»å‹æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ã€‚</p></blockquote><h2 id="sql">SQL</h2><p>SQLï¼ˆStructured QueryLanguageï¼‰ï¼Œå³ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸€ç§ç”¨äº<strong>ç®¡ç†å…³ç³»å‹æ•°æ®åº“</strong>çš„æ ‡å‡†ç¼–ç¨‹è¯­è¨€ã€‚ä¸åŒçš„æ•°æ®åº“éƒ½æ”¯æŒSQLï¼Œæ‰€ä»¥ä½¿ç”¨SQLè¿™ä¸€ç§æ ‡å‡†è¯­è¨€å°±å¯ä»¥æ“ä½œä¸åŒçš„æ•°æ®åº“ã€‚</p><p>é™¤äº† SQL æ ‡å‡†ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ† SQLæ•°æ®åº“ç¨‹åºéƒ½æ‹¥æœ‰å®ƒä»¬è‡ªå·±çš„ç§æœ‰æ‰©å±•ï¼Œè¿™äº›æ‰©å±•ä¸èƒ½ç”¨åœ¨å…¶ä»–çš„æ•°æ®åº“ä¸­ã€‚ä½†æ˜¯å¦‚æœåªä½¿ç”¨SQLçš„æ ¸å¿ƒåŠŸèƒ½çš„è¯ï¼Œé‚£ä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ï¼Œå¸¸ç”¨çš„åŠŸèƒ½æ˜¯ç›¸äº’å…¼å®¹çš„ã€‚</p><p>SQL å®šä¹‰äº†ä»¥ä¸‹äº”ç§è¯­å¥ï¼š</p><table><thead><tr><th>ç±»åˆ«</th><th>å…³é”®ä½œç”¨</th><th>å¸¸è§å…³é”®å­—</th></tr></thead><tbody><tr><td>DDL</td><td>å®šä¹‰ç»“æ„ï¼Œé€šå¸¸ç”±ç®¡ç†å‘˜æ‰§è¡Œ</td><td><code>CREATE</code>, <code>DROP</code>, <code>ALTER</code></td></tr><tr><td>DML</td><td>æ“ä½œæ•°æ®ï¼Œå±äºåº”ç”¨ç¨‹åºçš„æ—¥å¸¸æ“ä½œ</td><td><code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code></td></tr><tr><td>DQL</td><td>æŸ¥è¯¢æ•°æ®ï¼Œä¾›ç”¨æˆ·æŸ¥è¯¢ä½¿ç”¨ï¼Œæœ€ä¸ºé¢‘ç¹</td><td><code>SELECT</code></td></tr><tr><td>DCL</td><td>æ§åˆ¶æƒé™</td><td><code>GRANT</code>, <code>REVOKE</code></td></tr><tr><td>TCL</td><td>ç®¡ç†äº‹åŠ¡</td><td><code>COMMIT</code>, <code>ROLLBACK</code></td></tr></tbody></table><p><img src="https://s21.ax1x.com/2025/05/03/pEbWCOe.png" /></p><p>SQLçš„å…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯å¯¹äºè¡¨åå’Œåˆ—åï¼Œä¸åŒæ•°æ®åº“çš„è§„å®šä¸åŒï¼Œæ‰€ä»¥æœ€å¥½å…³é”®è¯ä¸€å¾‹å¤§å†™ã€‚è¡¨åå’Œåˆ—åä¸€å¾‹å°å†™ã€‚</p><h1 id="å…³ç³»æ¨¡å‹æ„æˆ">å…³ç³»æ¨¡å‹æ„æˆ</h1><p>ç”¨äºå”¯ä¸€åŒºåˆ†ä¸åŒè®°å½•çš„å­—æ®µå°±æ˜¯ä¸»é”®ã€‚ä¸èƒ½ä½¿ç”¨ä¸šåŠ¡ç›¸å…³çš„å­—æ®µä½œä¸ºä¸»é”®ã€‚</p><p>å°†æ•°æ®ä¸å¦ä¸€å¼ è¡¨è”ç³»èµ·æ¥çš„å­—æ®µç§°ä¸ºå¤–é”®ã€‚</p><p>ç´¢å¼•ï¼šåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><blockquote><p>åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œç´¢å¼•æ˜¯ç”¨äºæé«˜æŸ¥è¯¢æ•ˆç‡çš„é‡è¦æ•°æ®ç»“æ„ã€‚ç´¢å¼•å¯ä»¥è®©æ•°æ®åº“åœ¨æŸ¥è¯¢æ—¶ä¸å¿…éå†æ•´ä¸ªè¡¨ï¼Œè€Œæ˜¯å¿«é€Ÿå®šä½åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œä»è€Œæ˜¾è‘—æå‡æ£€ç´¢é€Ÿåº¦ã€‚</p><p>ç„¶è€Œï¼Œç´¢å¼•ä¹Ÿæœ‰å…¶å±€é™æ€§ã€‚ç´¢å¼•çš„ä¸»è¦ç¼ºç‚¹æ˜¯åœ¨æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ï¼Œæ•°æ®åº“éœ€è¦åŒæ—¶è°ƒæ•´æ‰€æœ‰ç›¸å…³çš„ç´¢å¼•ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚ç´¢å¼•æ•°é‡è¶Šå¤šï¼Œæ•°æ®ä¿®æ”¹çš„é€Ÿåº¦å°±è¶Šæ…¢ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡æ•°æ®åº“æ—¶ï¼Œå¿…é¡»åœ¨æŸ¥è¯¢ä¼˜åŒ–å’Œä¿®æ”¹æ€§èƒ½ä¹‹é—´æƒè¡¡ã€‚</p></blockquote><p>æ•°æ®åº“ä¼šè‡ªåŠ¨ä¸ºä¸»é”®åˆ›å»ºç´¢å¼•ï¼Œ<strong>ä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡æœ€é«˜</strong>ï¼Œå› ä¸ºä¸»é”®ä¿è¯æ¯æ¡è®°å½•çš„å”¯ä¸€æ€§ã€‚</p><p>å”¯ä¸€ç´¢å¼•ï¼šå¯ä»¥é€šè¿‡å‘½ä»¤ä¸ºéœ€è¦ç¡®ä¿å”¯ä¸€çš„æ•°æ®åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œæˆ–è€…æ·»åŠ å”¯ä¸€çº¦æŸã€‚</p><h1 id="åŸºæœ¬çš„æŸ¥è¯¢æ“ä½œ">åŸºæœ¬çš„æŸ¥è¯¢æ“ä½œ</h1><h2 id="åŸºæœ¬æŸ¥è¯¢">åŸºæœ¬æŸ¥è¯¢</h2><p><code>SELECT &lt;å®šä¹‰åˆ—çš„åå­—&gt; FROM &lt;è¡¨å&gt;</code></p><p>ä¾‹å¦‚ï¼š<code>SELECT * FROM students;</code>æŸ¥è¯¢<code>students</code>è¡¨ä¸­çš„æ‰€æœ‰åˆ—</p><h2 id="æ¡ä»¶æŸ¥è¯¢">æ¡ä»¶æŸ¥è¯¢</h2><p><code>SELECT * FROM &lt;è¡¨å&gt; WHERE &lt;æ¡ä»¶è¡¨è¾¾å¼&gt;</code></p><p>ä½¿ç”¨<code>WHERE</code>æŒ‡å®šæœç´¢æ¡ä»¶ã€‚æ¡ä»¶è¡¨è¾¾å¼å¯ä»¥ç”¨</p><ul><li><code>&lt;æ¡ä»¶1&gt; AND &lt;æ¡ä»¶2&gt;</code>è¡¨è¾¾æ»¡è¶³æ¡ä»¶1å¹¶ä¸”æ»¡è¶³æ¡ä»¶2</li><li><code>&lt;æ¡ä»¶1&gt; OR &lt;æ¡ä»¶2&gt;</code>è¡¨ç¤ºæ»¡è¶³æ¡ä»¶1æˆ–è€…æ»¡è¶³æ¡ä»¶2ã€‚</li></ul><p>åº”å½“æ³¨æ„ï¼Œ<code>AND</code>æ¯”<code>OR</code>æœ‰æ›´é«˜çš„è¿ç®—ä¼˜å…ˆçº§ï¼ŒæŸäº›æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨åœ†æ‹¬å·<code>()</code>æŒ‡æ˜è¿ç®—å…ˆåé¡ºåºã€‚</p><p><code>BETWEENT AND</code>ï¼šæŸ¥è¯¢ä½äºä¸¤ä¸ªå€¼ä¹‹é—´çš„æ•°æ®ï¼Œä¸¤è¾¹éƒ½æ˜¯é—­åŒºé—´ã€‚</p><p><code>IN</code>æ“ä½œç¬¦ç”¨æ¥æŒ‡å®šæ¡ä»¶èŒƒå›´ï¼ŒèŒƒå›´ä¸­çš„æ¯ä¸ªæ¡ä»¶éƒ½å¯ä»¥è¿›è¡ŒåŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_id, cust_name<br><span class="hljs-keyword">FROM</span> customers<br><span class="hljs-keyword">WHERE</span> cust_id <span class="hljs-keyword">IN</span> (<span class="hljs-number">10001</span>, <span class="hljs-number">10003</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cust_name;<br></code></pre></td></tr></table></figure><p>æŠŠ customers è¡¨ä¸­çš„<code>cust_id</code>ä¸º 10001 <strong>æˆ–</strong>10003çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ã€‚<code>IN</code>çš„ä½œç”¨å®é™…ä¸Šå’Œ<code>OR</code>æ²¡æœ‰å·®åˆ«ï¼Œå®ƒçš„ä¼˜ç‚¹ä½“ç°åœ¨ï¼š</p><ul><li>INæ“ä½œç¬¦çš„è¯­æ³•æ›´æ¸…æ¥šä¸”æ›´ç›´è§‚ï¼›</li><li>åœ¨ä½¿ç”¨INæ—¶ï¼Œè®¡ç®—çš„æ¬¡åºæ›´å®¹æ˜“ç®¡ç†ï¼ˆå› ä¸ºä½¿ç”¨çš„æ“ä½œç¬¦æ›´å°‘ï¼‰ï¼›</li><li>INæ“ä½œç¬¦ä¸€èˆ¬æ¯”ORæ“ä½œç¬¦æ¸…å•æ‰§è¡Œæ›´å¿«ï¼›</li><li>INçš„æœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥åŒ…å«å…¶ä»–SELECTè¯­å¥ï¼Œä½¿å¾—èƒ½å¤Ÿæ›´åŠ¨æ€åœ°å»ºç«‹WHEREå­å¥ã€‚</li></ul><p>è¿˜æœ‰ä¸€ä¸ªå…³é”®å­—æ˜¯<code>NOT</code>ã€‚WHEREå­å¥ä¸­çš„NOTæ“ä½œç¬¦æœ‰ä¸”åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯å¦å®šå®ƒä¹‹åæ‰€è·Ÿçš„ä»»ä½•æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">WHERE</span> vend_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">1002</span>, <span class="hljs-number">1003</span>)<br></code></pre></td></tr></table></figure><p>ç­›é€‰æ‰€æœ‰ vend_id ä¸æ˜¯1002æˆ–1003çš„æ•°æ®ã€‚NOTå®é™…ä¸Šæ˜¯MySQLçš„ç‰¹æ€§ï¼š</p><div class="note note-primary">            <p>MySQLæ”¯æŒä½¿ç”¨NOTå¯¹INã€BETWEENå’ŒEXISTS<strong>å­å¥</strong>å–åï¼Œè¿™ä¸å¤šæ•°å…¶ä»–DBMSå…è®¸ä½¿ç”¨NOTå¯¹å„æ¡ä»¶å–åæœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚</p>          </div><h2 id="æ’åº">æ’åº</h2><p><code>SELECT id, name, gender, score FROM students ORDER BY score DESC, gender;</code></p><p><code>DESC</code>è¡¨ç¤ºå€’åºï¼Œé»˜è®¤ä¸º<code>ASC</code>å³å‡åºã€‚</p><p><code>ORDER BY</code>è¦æ”¾åˆ°<code>WHERE</code>çš„åé¢ã€‚</p><h2 id="åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</h2><p>åœ¨ SQLä¸­ï¼Œåˆ†é¡µæŸ¥è¯¢ç”¨äºä»å¤§å‹æ•°æ®é›†ä¸­æŒ‰é¡µæå–ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºæˆ–ç½‘é¡µä¸Šé€æ­¥æ˜¾ç¤ºã€‚</p><p>åˆ†é¡µå®é™…ä¸Šå°±æ˜¯ä»ç»“æœé›†ä¸­â€œæˆªå–â€å‡ºç¬¬M~Næ¡è®°å½•ã€‚è¿™ä¸ªæŸ¥è¯¢å¯ä»¥é€šè¿‡<code>LIMIT &lt;N-M&gt; OFFSET &lt;M&gt;</code>å­å¥å®ç°ã€‚æˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰å­¦ç”ŸæŒ‰ç…§æˆç»©ä»é«˜åˆ°ä½è¿›è¡Œæ’åºï¼š</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æŸ¥è¯¢ç¬¬1é¡µ:</span><br><span class="hljs-keyword">SELECT</span> id, name, gender, score<br><span class="hljs-keyword">FROM</span> students<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span><br>LIMIT <span class="hljs-number">3</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¯­å¥è¡¨ç¤ºï¼šé€‰å–<code>students</code>ä¸­ id, name, gender,scoreçš„åˆ—ï¼ŒæŒ‰ç…§åˆ†æ•°ä»é«˜åˆ°ä½æ’åºï¼Œ<strong>æœ€å¤šåªå–</strong>å‰3æ¡ï¼ˆç¬¬1é¡µçš„3æ¡è®°å½•ï¼Œä»ç¬¬0æ¡å¼€å§‹ï¼‰ã€‚</p><p>æ‰€ä»¥<code>LIMIT</code>è¯­å¥å…¶å®æ˜¯ä¸€ä¸ª<strong>æˆªå–</strong>çš„è¿‡ç¨‹ï¼Œè¾“å‡ºçš„ç»“æœåœ¨å¤–ç•Œçœ‹æ¥å¥½åƒå®ç°äº†åˆ†é¡µæ•ˆæœã€‚</p><ul><li>LIMITæ€»æ˜¯è®¾å®šä¸ºpageSizeï¼›</li><li>OFFSETè®¡ç®—å…¬å¼ä¸ºpageSize * (pageIndex - 1)ã€‚</li></ul><p>å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œåˆ™ä¼šè¿”å›<code>Empty set</code>ã€‚<code>OFFSET</code>æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸º0ã€‚</p><h2 id="èšåˆæŸ¥è¯¢">èšåˆæŸ¥è¯¢</h2><p>å¯¹äºç»Ÿè®¡æ€»æ•°ã€å¹³å‡æ•°è¿™ç±»è®¡ç®—ï¼ŒSQLæä¾›äº†ä¸“é—¨çš„èšåˆå‡½æ•°ï¼ˆä¹Ÿå«æ•°æ®å¤„ç†å‡½æ•°ï¼‰ï¼Œä½¿ç”¨èšåˆå‡½æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œå°±æ˜¯èšåˆæŸ¥è¯¢ï¼Œå®ƒå¯ä»¥å¿«é€Ÿè·å¾—ç»“æœã€‚</p><h3 id="æ–‡æœ¬å¤„ç†å‡½æ•°">æ–‡æœ¬å¤„ç†å‡½æ•°</h3><ul><li><code>Trim()</code>:å»é™¤æ–‡æœ¬ä¸¤ç«¯çš„ç©ºæ ¼ï¼Œä¹Ÿæœ‰<code>RTrim()</code>å»é™¤å³è¾¹çš„ç©ºæ ¼ï¼Œ<code>LTrim()</code>å»é™¤å·¦è¾¹çš„ç©ºæ ¼ã€‚</li><li><code>Upper()</code>: å°†æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™ã€‚</li><li><code>Left()</code>: è¿”å›ä¸²æœ€å·¦è¾¹çš„å­—ç¬¦</li><li><code>Length()</code>: è¿”å›ä¸²çš„é•¿åº¦</li><li><code>Locate()</code>: æ‰¾å‡ºä¸²çš„ç¬¬ä¸€ä¸ªå­—ä¸²</li><li><code>Lower()</code>: å°†ä¸²è½¬æ¢ä¸ºå°å†™</li><li><code>Ltrim()</code>: å»æ‰ä¸²å·¦è¾¹çš„ç©ºæ ¼</li><li><code>Right()</code>: è¿”å›ä¸²å³è¾¹çš„å­—ç¬¦</li><li><code>Soundex()</code>: è¿”å›ä¸²çš„SOUNDEXå€¼</li><li><code>SubString()</code>: è¿”å›ä¸²çš„å­—ç¬¦</li></ul><h3 id="æ•°æ®å¤„ç†å‡½æ•°">æ•°æ®å¤„ç†å‡½æ•°</h3><p>MySQL ç»™å‡ºäº†5ä¸ªä»¥<code>row</code>ä¸ºå•å…ƒè¿è¡Œçš„èšé›†å‡½æ•°ï¼Œå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>èšåˆå‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>COUNT()</code></td><td>è¿”å›æŒ‡å®šåˆ—çš„è¡Œæ•°</td></tr><tr><td><code>SUM()</code></td><td>è¿”å›æŒ‡å®šåˆ—å€¼ä¹‹å’Œ</td></tr><tr><td><code>AVG()</code></td><td>è¿”å›ç‰¹å®šæ•°å€¼åˆ—çš„å¹³å‡å€¼</td></tr><tr><td><code>MAX()</code></td><td>è¿”å›æŒ‡å®šåˆ—çš„æœ€å¤§å€¼</td></tr><tr><td><code>MIN()</code></td><td>è¿”å›æŒ‡å®šåˆ—çš„æœ€å°å€¼</td></tr></tbody></table><blockquote><p>COUNT æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š - ä½¿ç”¨ COUNT(*)å¯¹è¡¨ä¸­è¡Œçš„æ•°ç›®è¿›è¡Œè®¡æ•°ï¼Œä¸ç®¡è¡¨åˆ—ä¸­åŒ…å«çš„æ˜¯ç©ºå€¼ï¼ˆNULLï¼‰è¿˜æ˜¯éç©ºå€¼ - ä½¿ç”¨COUNT(åˆ—å) å¯¹ç‰¹å®šåˆ—ä¸­å…·æœ‰å€¼çš„è¡Œè¿›è¡Œè®¡æ•°ï¼Œå¿½ç•¥ NULL å€¼ã€‚</p></blockquote><p>ç»å¸¸ä¸ä¹‹ç»“åˆä½¿ç”¨çš„è¿˜æœ‰:</p><ul><li><code>CEILING()</code>: å‘ä¸Šå–æ•´</li><li><code>FLOOR()</code>: å‘ä¸‹å–æ•´</li></ul><p>ä¾‹å¦‚<code>SELECT MAX(score), MIN(score) FROM students;</code>ç”¨äºè®¡ç®—å­¦ç”Ÿçš„æœ€é«˜åˆ†å’Œæœ€ä½åˆ†ã€‚</p><p>ä½¿ç”¨èšåˆæŸ¥è¯¢æ—¶å¯ä»¥ç»™ç»“æœèµ·ä¸€ä¸ªåˆ«åï¼Œä½¿ç”¨<code>AS</code>æ ‡è®°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> num <span class="hljs-keyword">FROM</span> students;<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">+-----+<br>| num |<br>+-----+<br>|  10 |<br>+-----+<br>1 row in set (0.024 sec)<br></code></pre></td></tr></table></figure><p>èšåˆæŸ¥è¯¢è¯­å¥åŒæ ·å¯ä»¥å’Œæ¡ä»¶è¯­å¥ç­‰ä¸€èµ·ä½¿ç”¨ã€‚</p><blockquote><p>è¦ç‰¹åˆ«æ³¨æ„ï¼šå¦‚æœèšåˆæŸ¥è¯¢çš„WHEREæ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è¡Œï¼ŒCOUNT()ä¼šè¿”å›0ï¼Œè€ŒSUM()ã€AVG()ã€MAX()å’ŒMIN()ä¼šè¿”å›NULLï¼š</p></blockquote><p>å¦‚æœåœ¨åˆ—åçš„å‰é¢åŠ ä¸Š<code>DISTINCT</code>å…³é”®å­—ï¼Œé‚£ä¹ˆåªä¼šè®¡ç®—ä¸åŒçš„æ•°æ®ï¼Œç›¸åŒçš„æ•°æ®ä¸ä¼šè¢«é‡å¤è®¡ç®—ã€‚</p><ul><li><code>SELECT COUNT(DISTINCT department_id) FROM employees;</code>ç»Ÿè®¡æœ‰å¤šå°‘ä¸ªä¸åŒçš„<code>department_id</code>ã€‚</li></ul><p>ä½†æ˜¯<code>COUNT(DISTINCT *)</code>æ˜¯éæ³•çš„ï¼Œå› ä¸º<code>COUNT(*)</code>çš„è®¡ç®—ç»“æœå›ºå®šä¸ºæ€»è¡Œæ•°ã€‚</p><h1 id="åˆ†ç»„">åˆ†ç»„</h1><h2 id="group-by">GROUP BY</h2><p>å…³é”®è¯ï¼š<code>GROUP BY</code>ã€‚åˆ†ç»„æ“ä½œå¸¸å¸¸éœ€è¦æŠŠåˆ†ç»„æ ‡å‡†ä¹ŸåŠ å…¥è¡¨ä¸­ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- ç¬¬ä¸€åˆ—æ˜¯æ€§åˆ«ï¼Œç¬¬äºŒåˆ—æ˜¯å¯¹åº”çš„æ•°é‡ï¼Œèµ·ä¸€ä¸ªæ–°åå­—total</span><br><span class="hljs-keyword">SELECT</span> gender, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> total<br><span class="hljs-keyword">FROM</span> students<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> gender;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">+--------+-------+<br>| gender | total |<br>+--------+-------+<br>| M      |     5 |<br>| F      |     5 |<br>+--------+-------+<br>2 rows in set (0.013 sec)<br></code></pre></td></tr></table></figure><p>GROUP BY å­å¥æŒ‡ç¤º MySQLåˆ†ç»„æ•°æ®ï¼Œç„¶åå¯¹æ¯ä¸ªç»„è€Œä¸æ˜¯æ•´ä¸ªç»“æœé›†è¿›è¡Œèšé›†ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>é™¤èšé›†è®¡ç®—è¯­å¥å¤–ï¼ŒSELECT è¯­å¥ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»åœ¨ GROUP BYå­å¥ä¸­ç»™å‡ºã€‚</li><li>GROUP BY å­å¥å¿…é¡»å‡ºç°åœ¨ WHERE å­å¥ä¹‹åï¼ŒORDER BY å­å¥ä¹‹å‰ã€‚</li><li>åœ¨GROUPBYåé¢ç´§æ¥<code>WITH ROLLUP</code>å…³é”®å­—å¯ä»¥åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šåˆè®¡ã€‚</li></ul><h2 id="having">HAVING</h2><p>HAVINGå…³é”®å­—çš„ä½œç”¨æ˜¯<strong>å¯¹åˆ†å¥½çš„ç»„è¿›è¡Œè¿‡æ»¤</strong>ã€‚ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ WHEREå¯¹è¡¨ä¸­çš„è¡Œè¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯WHEREä¸èƒ½ç”¨äºåˆ†ç»„çš„æƒ…å†µï¼Œè¿™æ—¶åº”è¯¥ä½¿ç”¨HAVINGã€‚ä»–ä»¬çš„å”¯ä¸€åŒºåˆ«æ˜¯<strong>WHEREè¿‡æ»¤è¡Œï¼ŒHAVINGè¿‡æ»¤ç»„</strong>ã€‚</p><p>ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> vend_id, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> products <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> vend_id <span class="hljs-keyword">with</span> <span class="hljs-keyword">rollup</span> <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;=</span><span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><p>å°†<code>products</code>è¡¨ä¸­æŒ‰ç…§ vend_idåˆ†ç»„åï¼Œåªä¿ç•™è¡Œæ•°å¤§äºç­‰äº3çš„ç»„åˆ«ã€‚</p><h2 id="select-å­å¥é¡ºåº">SELECT å­å¥é¡ºåº</h2><ol type="1"><li>SELECT</li><li>FROM</li><li>WHERE</li><li>GROUP BY</li><li>HAVING</li><li>ORDER BY</li><li>LIMIT</li></ol><h1 id="å¤šè¡¨æŸ¥è¯¢è”ç»“è¡¨">å¤šè¡¨æŸ¥è¯¢ï¼ˆè”ç»“è¡¨ï¼‰</h1><p>SQLæœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½åœ¨æ•°æ®æ£€ç´¢æŸ¥è¯¢çš„æ‰§è¡Œä¸­è”ç»“ï¼ˆjoinï¼‰è¡¨ã€‚è”ç»“æ˜¯åˆ©ç”¨SQLçš„SELECT èƒ½æ‰§è¡Œçš„æœ€é‡è¦çš„æ“ä½œï¼Œå¾ˆå¥½åœ°ç†è§£è”ç»“åŠå…¶è¯­æ³•æ˜¯å­¦ä¹  SQLçš„ä¸€ä¸ªæä¸ºé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚</p><p>å…³é”®æ˜¯ï¼Œä¸€ä¸ªè¡¨ä¸­çš„ç›¸åŒæ•°æ®å‡ºç°å¤šæ¬¡å†³ä¸æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œæ­¤å› ç´ æ˜¯å…³ç³»æ•°æ®åº“è®¾è®¡çš„åŸºç¡€ã€‚<strong>å…³ç³»è¡¨çš„è®¾è®¡å°±æ˜¯è¦ä¿è¯æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»æ•°æ®ä¸€ä¸ªè¡¨</strong>ã€‚å„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„å€¼ï¼ˆå³å…³ç³»è®¾è®¡ä¸­çš„å…³ç³»ï¼ˆrelationalï¼‰ï¼‰äº’ç›¸å…³è”ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ‰‹ä¸Šæœ‰ä¸¤ä¸ªè¡¨æ ¼ï¼š<strong>ç­çº§è¡¨</strong></p><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>1</td><td>class1</td></tr><tr><td>2</td><td>class2</td></tr><tr><td>3</td><td>class3</td></tr><tr><td>4</td><td>class4</td></tr></tbody></table><p>å’Œ<strong>å­¦ç”Ÿè¡¨</strong></p><table><thead><tr><th>id</th><th>class_id</th><th>name</th><th>gender</th><th>score</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>ming</td><td>M</td><td>90</td></tr><tr><td>2</td><td>1</td><td>hong</td><td>F</td><td>95</td></tr><tr><td>3</td><td>1</td><td>jun</td><td>M</td><td>88</td></tr><tr><td>4</td><td>1</td><td>mi</td><td>F</td><td>73</td></tr><tr><td>5</td><td>2</td><td>bai</td><td>F</td><td>81</td></tr><tr><td>6</td><td>2</td><td>bing</td><td>M</td><td>55</td></tr><tr><td>7</td><td>2</td><td>ling</td><td>M</td><td>85</td></tr><tr><td>8</td><td>3</td><td>xin</td><td>F</td><td>91</td></tr><tr><td>9</td><td>3</td><td>wang</td><td>M</td><td>89</td></tr><tr><td>10</td><td>3</td><td>li</td><td>F</td><td>85</td></tr></tbody></table><p>è¿™é‡Œçš„å¤–é”®æ˜¯<code>class_id</code>ï¼Œå®ƒåŒ…å«äº†ç­çº§è¡¨çš„ä¸»é”®å€¼</p><p>è¿æ¥æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥åœ¨ä¸€æ¡SELECTè¯­å¥ä¸­å…³è”è¡¨ï¼Œå› æ­¤ç§°ä¹‹ä¸ºè¿æ¥(JOIN)ã€‚é‡‡ç”¨è¿æ¥çš„æŸ¥è¯¢ç§°ä¹‹ä¸º<strong>SQLJOINè¿æ¥æŸ¥è¯¢</strong>ã€‚<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://zhuanlan.zhihu.com/p/68136613">[2]</span></a></sup></p><figure><img src="https://s21.ax1x.com/2025/05/04/pEbjEAP.png"alt="è”ç»“çš„åˆ†ç±»" /><figcaption aria-hidden="true">è”ç»“çš„åˆ†ç±»</figcaption></figure><h2 id="ç­‰å€¼è”ç»“">ç­‰å€¼è”ç»“</h2><p>ç­‰å€¼è”ç»“åŸºäºä¸¤ä¸ªè¡¨ä¹‹é—´çš„ç›¸ç­‰æ•°æ®è¿›è¡Œè¿æ¥ã€‚åº”å½“ç¡®ä¿æ‰€æœ‰çš„è”ç»“éƒ½æœ‰WHERE å­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> classes.name, students.name <span class="hljs-keyword">from</span> classes, students <span class="hljs-keyword">where</span> classes.id <span class="hljs-operator">=</span> students.class_id;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s21.ax1x.com/2025/05/17/pEvKwWt.png" /></p><h2 id="inner-join-å†…è¿æ¥">INNER JOIN å†…è¿æ¥</h2><p>å¯¹ä¸Šè¿°sqlè¯­å¥ä½¿ç”¨ä¸åŒçš„è¯­æ³•ï¼Œä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> classes.name, students.name <span class="hljs-keyword">from</span> classes <span class="hljs-keyword">join</span> students <span class="hljs-keyword">on</span> classes.id <span class="hljs-operator">=</span> students.class_id;<br></code></pre></td></tr></table></figure><p>æ­¤è¯­å¥ä¸­çš„SELECTä¸å‰é¢çš„SELECTè¯­å¥ç›¸åŒï¼Œä½†FROMå­å¥ä¸åŒã€‚è¿™é‡Œï¼Œä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»æ˜¯FROMå­å¥çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥INNERJOINæŒ‡å®šã€‚åœ¨ä½¿ç”¨è¿™ç§è¯­æ³•æ—¶ï¼Œè”ç»“æ¡ä»¶ç”¨ç‰¹å®šçš„ONå­å¥è€Œä¸æ˜¯WHEREå­å¥ç»™å‡ºã€‚ä¼ é€’ç»™ONçš„å®é™…æ¡ä»¶ä¸ä¼ é€’ç»™WHEREçš„ç›¸åŒã€‚</p><div class="note note-secondary">            <p>ANSI SQLè§„èŒƒé¦–é€‰INNERJOINè¯­æ³•ã€‚æ­¤å¤–ï¼Œå°½ç®¡ä½¿ç”¨WHEREå­å¥å®šä¹‰è”ç»“çš„ç¡®æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä½¿ç”¨æ˜ç¡®çš„è”ç»“è¯­æ³•èƒ½å¤Ÿç¡®ä¿ä¸ä¼šå¿˜è®°è”ç»“æ¡ä»¶ï¼Œæœ‰æ—¶å€™è¿™æ ·åšä¹Ÿèƒ½å½±å“æ€§èƒ½ã€‚</p>          </div><hr /><p>ä¸‹é¢æ­£å¼ç»™å‡ºå†…è¿æ¥çš„è¯­æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> A.id, A.name, B.name<br><span class="hljs-keyword">FROM</span> classes A<br><span class="hljs-keyword">JOIN</span> students B<br><span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.class_id;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå†…è¿æ¥ä¹Ÿé€‚ç”¨äºåªæœ‰ä¸€ä¸ªè¡¨çš„æƒ…å†µã€‚å‡å¦‚å·²çŸ¥studentsè¡¨ä¸­ä¸€ä¸ªå­¦ç”Ÿçš„åå­—ä¸ºbaiï¼Œç°åœ¨è¦æŸ¥è¯¢å’Œä»–åœ¨åŒä¸€ç­çº§ä¸­çš„å…¶ä»–æ‰€æœ‰å­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹sqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> p1.class_id, p1.name<br><span class="hljs-keyword">from</span> students <span class="hljs-keyword">as</span> p1 <span class="hljs-keyword">join</span> students <span class="hljs-keyword">as</span> p2<br><span class="hljs-keyword">on</span> p1.class_id <span class="hljs-operator">=</span> p2.class_id<br><span class="hljs-keyword">and</span> p2.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;bai&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„è¡¨ï¼Œä½†æ˜¯ä½¿ç”¨äº†åˆ«åã€‚</p><h2 id="outer-join-å¤–éƒ¨è¿æ¥">OUTER JOIN å¤–éƒ¨è¿æ¥</h2><p>å·¦è¿æ¥æ˜¯<strong>å¤–éƒ¨è¿æ¥</strong>çš„ä¸€ç§ï¼Œè€ƒè™‘ä¸‹é¢çš„ä¸šåŠ¡æƒ…æ™¯ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªè¡¨<code>customers</code>ï¼Œå…¶ä¸­å­˜å‚¨äº†æ‰€æœ‰å®¢æˆ·çš„idç­‰åŸºæœ¬ä¿¡æ¯ã€‚ç°åœ¨å¦æœ‰ä¸€ä¸ªè¡¨<code>orders</code>è®°å½•äº†å®¢æˆ·æ‰€ä¸‹çš„è®¢å•ä¿¡æ¯ã€‚ç°åœ¨æˆ‘ä»¬è¦æŸ¥è¯¢å®¢æˆ·çš„ä¸‹å•æƒ…å†µï¼ŒåŒ…æ‹¬æ²¡æœ‰ä¸‹å•çš„å®¢æˆ·ä¹Ÿè¦è®°å½•åœ¨å†…ã€‚</p><p>è¿™æ—¶å¦‚æœä½¿ç”¨å†…è¿æ¥ï¼Œä¼šç›´æ¥å¿½ç•¥æ²¡æœ‰ä¸‹å•çš„ç”¨æˆ·ã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨å¤–éƒ¨è”ç»“ï¼Œä¿ç•™å®¢æˆ·è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œå³ä½¿è®¢å•è¡¨ä¸­æ²¡æœ‰è®°å½•ä¸ä¹‹åŒ¹é…ã€‚</p><p>ä¸å†…éƒ¨è”ç»“å…³è”ä¸¤ä¸ªè¡¨ä¸­çš„è¡Œä¸åŒçš„æ˜¯ï¼Œ<strong>å¤–éƒ¨è¿æ¥è¿˜åŒ…æ‹¬æ²¡æœ‰å…³è”è¡Œçš„è¡Œ</strong>ã€‚åœ¨ä½¿ç”¨OUTERJOINè¯­æ³•æ—¶ï¼Œå¿…é¡»ä½¿ç”¨RIGHTæˆ–LEFTå…³é”®å­—æŒ‡å®šåŒ…æ‹¬å…¶æ‰€æœ‰è¡Œçš„è¡¨ï¼ˆRIGHTæŒ‡å‡ºçš„æ˜¯OUTERJOINå³è¾¹çš„è¡¨ï¼Œè€ŒLEFTæŒ‡å‡ºçš„æ˜¯OUTERJOINå·¦è¾¹çš„è¡¨ï¼‰ã€‚å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€å·®åˆ«æ˜¯æ‰€å…³è”çš„è¡¨çš„é¡ºåºä¸åŒã€‚</p><p>å·¦è¿æ¥ï¼šè·å–å·¦è¡¨ä¸­çš„<strong>æ‰€æœ‰è®°å½•</strong>ï¼Œå³ä½¿åœ¨å³è¡¨æ²¡æœ‰å¯¹åº”åŒ¹é…çš„è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- å·¦è¿æ¥ï¼šæ˜¾ç¤ºAè¡¨æ‰€æœ‰è®°å½•ï¼Œå³ä½¿åœ¨Bè¡¨ä¸­æ²¡æœ‰åŒ¹é…</span><br><span class="hljs-comment">-- æ²¡æœ‰åŒ¹é…çš„é¡¹åˆ™ä»¥NULLå€¼ä»£æ›¿</span><br><span class="hljs-keyword">SELECT</span> A.col1, B.col2<br><span class="hljs-keyword">FROM</span> A<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.a_id;<br></code></pre></td></tr></table></figure><p>ä»¥å­¦ç”Ÿè¡¨å’Œç­çº§è¡¨ä¸¾ä¾‹ï¼šå°†ç­çº§è¡¨ä½œä¸ºå·¦è¡¨ï¼Œå­¦ç”Ÿè¡¨ä½œä¸ºå³è¡¨ï¼Œç»Ÿè®¡æ¯ä¸ªç­ä¸­çš„å­¦ç”Ÿæƒ…å†µã€‚sqlè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> classes.name, students.name<br><span class="hljs-keyword">FROM</span> classes<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> students <span class="hljs-keyword">ON</span> classes.id <span class="hljs-operator">=</span> students.class_id;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">+--------+------+<br>| name   | name |<br>+--------+------+<br>| class1 | mi   |<br>| class1 | jun  |<br>| class1 | hong |<br>| class1 | ming |<br>| class2 | ling |<br>| class2 | bing |<br>| class2 | bai  |<br>| class3 | li   |<br>| class3 | wang |<br>| class3 | xin  |<br>| class4 | NULL |<br>+--------+------+<br></code></pre></td></tr></table></figure><p><code>class4</code>æ²¡æœ‰å­¦ç”Ÿï¼Œä½†æ˜¯å®ƒå·²ç»å‡ºç°åœ¨äº†è¡¨æ ¼ä¸­ã€‚è¿™æ ·èƒ½å¤Ÿæ‰¾åˆ°æ²¡æœ‰å…³è”çš„å­¤å„¿æ•°æ®ã€‚</p><hr /><p>å³è¿æ¥çš„è¯­æ³•å¦‚ä¸‹ï¼Œå’Œå·¦è¿æ¥åŸºæœ¬ç›¸åŒï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- å’Œå·¦è¿æ¥ç›¸åï¼Œè¿”å› B è¡¨æ‰€æœ‰è®°å½•ï¼ŒA è¡¨ä¸åŒ¹é…çš„æ˜¾ç¤º NULLã€‚</span><br><span class="hljs-keyword">SELECT</span> A.col1, B.col2<br><span class="hljs-keyword">FROM</span> A<br><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.a_id;<br></code></pre></td></tr></table></figure><h2 id="cross-join-äº¤å‰è¿æ¥">CROSS JOIN äº¤å‰è¿æ¥</h2><p>æ¯ä¸€æ¡ A è¡¨è®°å½•éƒ½ä¼šå’Œ B è¡¨çš„æ¯ä¸€æ¡ç»„åˆï¼Œç»“æœæ˜¯ A è¡¨è®°å½•æ•° Ã— Bè¡¨è®°å½•æ•°ï¼ˆç¬›å¡å°”ç§¯ï¼‰ï¼Œç”¨å¾—ä¸å¤šã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> A.col1, B.col2<br><span class="hljs-keyword">FROM</span> A<br><span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> B;<br></code></pre></td></tr></table></figure><p><strong>MySQL æ²¡æœ‰å†…å»ºçš„ FULLJOINï¼ˆå…¨è¿æ¥ï¼‰è¯­æ³•å…³é”®è¯</strong>ã€‚æƒ³å®ç°å…¨è¿æ¥ï¼Œè¦ç”¨<code>LEFT JOIN + RIGHT JOIN + UNION</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æ¨¡æ‹Ÿ FULL OUTER JOIN</span><br><span class="hljs-keyword">SELECT</span> A.id, B.id<br><span class="hljs-keyword">FROM</span> A<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.id<br><br><span class="hljs-keyword">UNION</span><br><br><span class="hljs-keyword">SELECT</span> A.id, B.id<br><span class="hljs-keyword">FROM</span> A<br><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.id;<br><br></code></pre></td></tr></table></figure><h1 id="ç»„åˆæŸ¥è¯¢">ç»„åˆæŸ¥è¯¢</h1><p>ç›®çš„ï¼šé€šè¿‡æ“ä½œç¬¦å°†å¤šä¸ª SELECT æŸ¥è¯¢çš„ç»“æœåˆå¹¶åœ¨ä¸€èµ·ã€‚</p><h2 id="union">UNION</h2><p>UNIONçš„ä½œç”¨ç›¸å½“äºåŒ…å«<code>WHERE...OR...</code>çš„è¯­å¥ï¼Œä¸è¿‡åœ¨å¤æ‚çš„æƒ…å†µä¸‹å†™èµ·æ¥æ›´åŠ ç®€æ´ã€‚ä½¿ç”¨UNION æŸ¥è¯¢<code>class_id</code>ä¸º 1 æˆ– 2çš„å­¦ç”Ÿï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹sqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <br><span class="hljs-keyword">where</span> class_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students<br><span class="hljs-keyword">where</span> class_id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒåŒ…å«äº†ä¸¤ä¸ªselectè¯­å¥ï¼Œç¬¬ä¸€ä¸ªæŸ¥è¯¢æ‰€æœ‰<code>class_id</code>ä¸º1çš„å­¦ç”Ÿï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢æ‰€æœ‰ä¸º2çš„å­¦ç”Ÿã€‚<code>union</code>å…³é”®è¯å°†ä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœç›´æ¥åˆå¹¶ï¼ˆå¦‚æœæœ‰é‡å¤çš„æ•°æ®ä¼šè‡ªåŠ¨å»é™¤ï¼‰ã€‚ä¸Šè¿°è¯­å¥ç›¸å½“äºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <br><span class="hljs-keyword">where</span> class_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> class_id <span class="hljs-operator">=</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>UNIONå‡ ä¹æ€»æ˜¯å®Œæˆä¸å¤šä¸ªWHEREæ¡ä»¶ç›¸åŒçš„å·¥ä½œã€‚å®ƒçš„ä¸€ç§å˜ä½“æ˜¯<code>union all</code>ï¼Œä¸union çš„å”¯ä¸€åŒºåˆ«æ˜¯<code>union all</code>ä¸ä¼šè‡ªåŠ¨å»é‡ã€‚</p><p>å¦‚æœç¡®å®éœ€è¦æ¯ä¸ªæ¡ä»¶çš„åŒ¹é…è¡Œå…¨éƒ¨å‡ºç°ï¼ˆåŒ…æ‹¬é‡å¤è¡Œï¼‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨UNIONALLè€Œä¸æ˜¯WHEREã€‚</p><hr /><p><strong>æ€»ç»“</strong>ï¼šåˆ©ç”¨UNIONï¼Œå¯æŠŠå¤šæ¡æŸ¥è¯¢çš„ç»“æœä½œä¸ºä¸€æ¡ç»„åˆæŸ¥è¯¢è¿”å›ï¼Œä¸ç®¡å®ƒä»¬çš„ç»“æœä¸­åŒ…å«è¿˜æ˜¯ä¸åŒ…å«é‡å¤ã€‚ä½¿ç”¨UNIONå¯æå¤§åœ°ç®€åŒ–å¤æ‚çš„WHEREå­å¥ï¼Œç®€åŒ–ä»å¤šä¸ªè¡¨ä¸­æ£€ç´¢æ•°æ®çš„å·¥ä½œã€‚</p><h1 id="é€šé…ç¬¦">é€šé…ç¬¦</h1><p>æŸ¥è¯¢æ“ä½œä¸­çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯é’ˆå¯¹å·²çŸ¥å€¼è¿›è¡Œè¿‡æ»¤çš„ï¼Œæœ‰æ—¶å€™å¹¶ä¸å¥½ç”¨ï¼Œä¾‹å¦‚ï¼Œæ€æ ·æœç´¢äº§å“åä¸­åŒ…å«æ–‡æœ¬anvilçš„æ‰€æœ‰äº§å“ï¼Ÿç”¨ç®€å•çš„æ¯”è¾ƒæ“ä½œç¬¦è‚¯å®šä¸è¡Œï¼Œå¿…é¡»ä½¿ç”¨é€šé…ç¬¦ã€‚</p><div class="note note-info">            <p><strong>é€šé…ç¬¦</strong>ï¼ˆwildcardï¼‰ç”¨æ¥åŒ¹é…å€¼çš„ä¸€éƒ¨åˆ†çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p><strong>æœç´¢æ¨¡å¼</strong>ï¼ˆsearch patternï¼‰ç”±å­—é¢å€¼ã€é€šé…ç¬¦æˆ–ä¸¤è€…ç»„åˆæ„æˆçš„æœç´¢æ¡ä»¶ã€‚</p>          </div><h2 id="likeæ“ä½œç¬¦">LIKEæ“ä½œç¬¦</h2><p>LIKE ç”¨äºå‘Šè¯‰ MySQL æ¥ä¸‹æ¥å°†ä¼šä½¿ç”¨é€šé…ç¬¦è¿›è¡ŒåŒ¹é…ã€‚LIKEä¸€å®šè¦æ­é…é€šé…ç¬¦ä½¿ç”¨ï¼Œ å¦åˆ™ MySQLä¼šè®¤ä¸ºä½¿ç”¨çš„æ˜¯å®Œå…¨åŒ¹é…è€Œéæ¨¡ç³ŠåŒ¹é…ã€‚</p><h3 id="ç™¾åˆ†å·é€šé…ç¬¦">ç™¾åˆ†å·(%)é€šé…ç¬¦</h3><p>ç™¾åˆ†å·ï¼ˆ%ï¼‰é€šé…ç¬¦ ï¼š<strong>ç”¨äºåŒ¹é…å¤šä¸ªå­—ç¬¦</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id, prod_name<br><span class="hljs-keyword">FROM</span> products<br><span class="hljs-keyword">WHERE</span> prod_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;jet%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±æ‰¾å‡ºäº†æ‰¾å‡ºæ‰€æœ‰ä»¥è¯<code>jet</code>èµ·å¤´çš„äº§å“:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">+---------+--------------+<br>| prod_id | prod_name    |<br>+---------+--------------+<br>| JP1000  | JetPack 1000 |<br>| JP2000  | JetPack 2000 |<br>+---------+--------------+<br>2 rows in set (0.017 sec)<br></code></pre></td></tr></table></figure><p><code>'jet%'</code>å¯ä»¥è¿™æ ·ç†è§£ï¼š<code>%</code>ä»£è¡¨çš„å…¶å®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‰©ä½™çš„å…¶ä»–å­—ç¬¦ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²å¿…é¡»ä»¥<code>jet</code>å¼€å¤´ã€‚ç±»ä¼¼åœ°ï¼Œ<code>%jet%</code>ä»£è¡¨çš„æ˜¯åŒ…å«<code>jet</code>çš„å­—ç¬¦ä¸²ï¼Œå› ä¸º<code>jet</code>çš„å‰åéƒ½æœ‰å­—ç¬¦ã€‚æ³¨æ„<code>%</code>åŒ¹é…çš„ä¹Ÿå¯ä»¥æ˜¯ç©ºå­—ç¬¦å’Œç©ºæ ¼ï¼Œä½†æ˜¯ä¸èƒ½åŒ¹é…<code>NULL</code>ã€‚</p><h3 id="ä¸‹åˆ’çº¿_é€šé…ç¬¦">ä¸‹åˆ’çº¿(_)é€šé…ç¬¦</h3><p>ä¸‹åˆ’çº¿çš„ç”¨é€”ä¸%ä¸€æ ·ï¼Œä½†ä¸‹åˆ’çº¿åªåŒ¹é…<strong>å•ä¸ªå­—ç¬¦</strong>è€Œä¸æ˜¯å¤šä¸ªå­—ç¬¦ã€‚</p><hr /><p>é€šé…ç¬¦è™½ç„¶ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†æ˜¯é€šé…ç¬¦æœç´¢çš„é€Ÿåº¦æ¯”ä¸€èˆ¬çš„æ“ä½œç¬¦è¦æ…¢ï¼Œæ‰€ä»¥ä¸å¯ä»¥æ»¥ç”¨é€šé…ç¬¦ã€‚åœ¨èƒ½è¾¾åˆ°ç›¸åŒç›®çš„ç‡æƒ…å†µä¸‹ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨å…¶ä»–æ“ä½œç¬¦ã€‚</p><h1 id="æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼</h1><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”¨æ¥åŒ¹é…æ–‡æœ¬çš„ç‰¹æ®Šçš„ä¸²ï¼ˆå­—ç¬¦é›†åˆï¼‰ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ã€‚ã€‚MySQLç”¨WHEREå­å¥å¯¹æ­£åˆ™è¡¨è¾¾å¼æä¾›äº†åˆæ­¥çš„æ”¯æŒï¼Œåªæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªå¾ˆå°çš„å­é›†ã€‚</p><p><strong>å…³é”®å­—</strong>ï¼š<code>REGEXP</code></p><h2 id="å­—ç¬¦åŒ¹é…">å­—ç¬¦åŒ¹é…</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name<br><span class="hljs-keyword">FROM</span> products<br><span class="hljs-keyword">WHERE</span> prod_name REGEXP <span class="hljs-string">&#x27;.000&#x27;</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_name;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼<code>.000</code>ï¼Œå°æ•°ç‚¹è¡¨ç¤º<em>åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦</em>ï¼Œå› æ­¤1000 å’Œ 2000 éƒ½ä¼šè¢«åŒ¹é…ã€‚</p><p>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™ã€1çš„ï¼Œå¦‚æœéœ€è¦åŒºåˆ†ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¹‹å‰åŠ ä¸Š<code>BINARY</code>ï¼Œä¾‹å¦‚<code>REGEXP BINARY 'JetPack .000'</code>ã€‚</p><h2 id="or-åŒ¹é…">OR åŒ¹é…</h2><p>æœç´¢ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹ä¸€ï¼Œä½¿ç”¨<code>|</code>ã€‚ä¾‹å¦‚ï¼š<code>REGEXP '1000|2000'</code>åŒ¹é…æ‰€æœ‰åŒ…å«1000 æˆ– 2000 çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥è¿ç»­ä½¿ç”¨å¤šä¸ª<code>|</code>ã€‚</p><h2 id="åŒ¹é…å¤šä¸ªå­—ç¬¦ä¹‹ä¸€">åŒ¹é…å¤šä¸ªå­—ç¬¦ä¹‹ä¸€</h2><p><code>[]</code>å¯ä»¥åŒ¹é…ä¸­æ‹¬å·ä¸­å‡ºç°çš„å­—ç¬¦ä¹‹ä¸€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name<br><span class="hljs-keyword">FROM</span> products<br><span class="hljs-keyword">WHERE</span> prod_name REGEXP <span class="hljs-string">&#x27;[123] Ton&#x27;</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_name;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">+-------------+<br>| prod_name   |<br>+-------------+<br>| 1 ton anvil |<br>| 2 ton anvil |<br>+-------------+<br></code></pre></td></tr></table></figure><p>æˆåŠŸåŒ¹é… 1 æˆ– 2 æˆ– 3ã€‚è¿™æ˜¯å¦ä¸€ç§å½¢å¼çš„ ORè¯­å¥ã€‚<code>[^123]</code>å¯ä»¥åŒ¹é…é™¤äº†è¿™ä¸‰ä¸ªå­—ç¬¦ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿ã€‚</p><h2 id="åŒ¹é…èŒƒå›´">åŒ¹é…èŒƒå›´</h2><p>å±äºä¸Šä¸€ä¸ªä¾‹å­çš„åŠ å¼ºç‰ˆï¼š<code>[0-9]</code>åŒ¹é…æ•°å­— 0 åˆ°9ï¼Œä¸å¿…æŠŠæ•°å­—ä¸€ä¸ªä¸€ä¸ªåˆ—ä¸¾å‡ºæ¥äº†ã€‚</p><p><code>[a-z]</code>åŒ¹é…ä»»æ„è‹±æ–‡å­—æ¯ã€‚</p><h2 id="ç‰¹æ®Šå­—ç¬¦">ç‰¹æ®Šå­—ç¬¦</h2><p>åŒ¹é…ä»»æ„å­—ç¬¦å¯ä»¥ç”¨å°æ•°ç‚¹<code>.</code>ï¼Œé‚£åŒ¹é…å°æ•°ç‚¹å‘¢ï¼Ÿ</p><p>å¯¹äºè¿™ç§ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Š<code>\\</code>è½¬ä¹‰(escaping)æ¥åŒ¹é…å®ƒæœ¬èº«ï¼Œå’ŒJavaä¸­çš„å¤„ç†æ–¹æ³•ç›¸åŒã€‚</p><h2 id="å­—ç¬¦ç±»">å­—ç¬¦ç±»</h2><p>æœ‰é¢„å…ˆå®šä¹‰å¾…çš„å­—ç¬¦é›†å¯ä¾›ä½¿ç”¨ï¼š</p><p><img src="https://s21.ax1x.com/2025/05/11/pEXCWg1.png" /></p><h2 id="åŒ¹é…å¤šä¸ªå®ä¾‹">åŒ¹é…å¤šä¸ªå®ä¾‹</h2><p>å¯¹åŒ¹é…çš„æ¬¡æ•°åŠ ä»¥æŒ‡å®šã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>'[[:digit:]]&#123;4&#125;'</code> åŒ¹é…è¿åœ¨ä¸€èµ·çš„ä»»æ„4ä½æ•°å­—ã€‚</li></ul><p><img src="https://s21.ax1x.com/2025/05/11/pEXCIHO.png" /></p><h2 id="å®šä½ç¬¦">å®šä½ç¬¦</h2><p>ç”¨äºåŒ¹é…ç‰¹å®šä½ç½®çš„æ–‡æœ¬ã€‚</p><ul><li>^ æ–‡æœ¬çš„å¼€å§‹</li><li>$ æ–‡æœ¬çš„ç»“å°¾</li><li>[[:&lt;:]] è¯çš„å¼€å§‹</li><li>[[:&gt;:]] è¯çš„ç»“å°¾</li></ul><h1 id="ä¿®æ”¹æ•°æ®">ä¿®æ”¹æ•°æ®</h1><p>CRUDï¼šCreateã€Retrieveã€Updateã€Delete</p><p>å¢ã€åˆ ã€æ”¹ã€æŸ¥</p><p>å‰é¢çš„<code>SELECT</code>ç”¨äºæŸ¥ï¼Œå¢åˆ æ”¹å¯¹åº”çš„æ“ä½œæ˜¯ï¼š</p><ul><li>INSERT</li><li>UPDATE</li><li>DELETE</li></ul><h2 id="insert">INSERT</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> è¡¨å (å­—æ®µ<span class="hljs-number">1</span>, å­—æ®µ<span class="hljs-number">2</span>, ...) <span class="hljs-keyword">VALUES</span> (å€¼<span class="hljs-number">1</span>, å€¼<span class="hljs-number">2</span>, ...);<br></code></pre></td></tr></table></figure><p>æœ‰é»˜è®¤å€¼çš„å­—æ®µåœ¨æ’å…¥çš„æ—¶å€™å¯ä»¥ä¸å±‘ï¼Œè‡ªåŠ¨é™„ä¸Šé»˜è®¤å€¼ï¼Œä½†æ˜¯æ²¡æœ‰é»˜è®¤å€¼çš„è¯å¿…é¡»æ˜¾å¼èµ‹å€¼ã€‚</p><p>å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šæ¡INSERTè¯­å¥ï¼Œè¿™æ—¶ä¸åŒçš„è¯­å¥ä¹‹é—´ç”¨åˆ†å·éš”å¼€ã€‚å¦‚æœæ¯æ¡INSERTè¯­å¥ä¸­çš„<code>è¡¨å(å­—æ®µ1, å­—æ®µ2...)</code>ç›¸åŒï¼Œåªéœ€è¦åœ¨åé¢è¡¥å……<code>VALUES</code>ï¼Œå¹¶ä¸”ç”¨é€—å·éš”å¼€ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•°æ®åº“å¤„ç†çš„æ€§èƒ½ï¼Œå› ä¸ºMySQLç”¨å•æ¡INSERTè¯­å¥å¤„ç†å¤šä¸ªæ’å…¥æ¯”ä½¿ç”¨å¤šæ¡INSERTè¯­å¥å¿«ã€‚</p><h2 id="update">UPDATE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> è¡¨å <span class="hljs-keyword">SET</span> å­—æ®µ<span class="hljs-number">1</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">1</span>, å­—æ®µ<span class="hljs-number">2</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">2</span>, ... <span class="hljs-keyword">WHERE</span> ...;<br></code></pre></td></tr></table></figure><p><code>WHERE</code>å¯ä»¥æ¶µç›–å¤šä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ä¿®æ”¹å¤šä¸ªå¯¹è±¡çš„å€¼ã€‚</p><p>å¦‚æœä¸å†™<code>WHERE</code>æ¡ä»¶ï¼Œæ•´å¼ è¡¨çš„è®°å½•éƒ½ä¼šè¢«ä¿®æ”¹ã€‚</p><h2 id="delete">DELETE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> è¡¨å <span class="hljs-keyword">WHERE</span> ...;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸å†™<code>WHERE</code>æ¡ä»¶ï¼Œæ•´å¼ è¡¨çš„è®°å½•éƒ½ä¼šè¢«åˆ é™¤ã€‚</p><h1 id="mysql-å¼•æ“">MySQL å¼•æ“</h1><ul><li>InnoDBæ˜¯ä¸€ä¸ªå¯é çš„äº‹åŠ¡å¤„ç†å¼•æ“ï¼ˆå‚è§ç¬¬26ç« ï¼‰ï¼Œå®ƒä¸æ”¯æŒå…¨æ–‡æœ¬æœç´¢ï¼Œé»˜è®¤ä½¿ç”¨æ­¤å¼•æ“ï¼›</li><li>MEMORYåœ¨åŠŸèƒ½ç­‰åŒäºMyISAMï¼Œä½†ç”±äºæ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼ˆä¸æ˜¯ç£ç›˜ï¼‰ä¸­ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼ˆç‰¹åˆ«é€‚åˆäºä¸´æ—¶è¡¨ï¼‰ï¼›</li><li>MyISAMæ˜¯ä¸€ä¸ªæ€§èƒ½æé«˜çš„å¼•æ“ï¼Œå®ƒæ”¯æŒå…¨æ–‡æœ¬æœç´¢ï¼ˆå‚è§ç¬¬18ç« ï¼‰ï¼Œä½†ä¸æ”¯æŒäº‹åŠ¡å¤„ç†ã€‚</li></ul><h1 id="è§†å›¾">è§†å›¾</h1><h2 id="ç”¨æ³•">ç”¨æ³•</h2><p>åœ¨ SQLä¸­ï¼Œè§†å›¾ï¼ˆViewï¼‰æ˜¯ä¸€ç§<strong>è™šæ‹Ÿè¡¨</strong>ï¼Œå®ƒå¹¶ä¸å­˜å‚¨å®é™…æ•°æ®ï¼Œè€Œæ˜¯åŸºäºä¸€æ¡SELECTæŸ¥è¯¢è¯­å¥åŠ¨æ€ç”Ÿæˆçš„â€œç»“æœé›†â€ã€‚è§†å›¾å°±æ˜¯<strong>å¯é‡ç”¨</strong>çš„æŸ¥è¯¢è¯­å¥ç»“æœï¼Œå®ƒçœ‹èµ·æ¥åƒè¡¨ï¼Œä½†ä¸çœŸæ­£å­˜å‚¨æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œç°åœ¨æˆ‘ä»¬è¦æŠŠæ¯ä¸ªå­¦ç”Ÿæ‰€åœ¨ç­çº§çš„åå­—å’Œå­¦ç”Ÿçš„å§“åæ”¾åœ¨ä¸€èµ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> c.name, s.name<br><span class="hljs-keyword">from</span> classes <span class="hljs-keyword">as</span> c<br><span class="hljs-keyword">join</span> students <span class="hljs-keyword">as</span> s <span class="hljs-keyword">on</span> c.id <span class="hljs-operator">=</span> s.class_id;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœï¼š</p><table><thead><tr><th>ç­çº§</th><th>å­¦ç”Ÿå</th></tr></thead><tbody><tr><td>class1</td><td>å°æ˜</td></tr><tr><td>class1</td><td>hong</td></tr><tr><td>class1</td><td>jun</td></tr><tr><td>class1</td><td>mi</td></tr><tr><td>class2</td><td>bai</td></tr><tr><td>class2</td><td>bing</td></tr><tr><td>class2</td><td>ling</td></tr><tr><td>class3</td><td>xin</td></tr><tr><td>class3</td><td>wang</td></tr><tr><td>class3</td><td>li</td></tr><tr><td>class4</td><td>Spike</td></tr><tr><td>class4</td><td>Elma</td></tr><tr><td>class4</td><td>Amy</td></tr></tbody></table><p>ç°åœ¨ï¼Œå‡å¦‚ç»å¸¸éœ€è¦è¿™ä¸ªæ ¼å¼çš„ç»“æœã€‚ä¸å¿…åœ¨æ¯æ¬¡éœ€è¦æ—¶æ‰§è¡Œè¿æ¥ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œæ¯æ¬¡éœ€è¦æ—¶ä½¿ç”¨å®ƒå³å¯ã€‚ä¸ºæŠŠæ­¤è¯­å¥è½¬æ¢ä¸ºè§†å›¾ï¼Œå¾ˆç®€å•ï¼Œ</p><ul><li>åœ¨æŸ¥è¯¢è¯­å¥å¼€å¤´åŠ ä¸Š<code>create view è§†å›¾å as</code></li><li>è¿™é‡Œæœ‰ä¸¤ä¸ª name å­—æ®µï¼Œåˆ†åˆ«æ¥è‡ª classes å’Œ students è¡¨ï¼Œä½†åˆ—åéƒ½å«nameã€‚ æ‰€ä»¥è§†å›¾å°±ä¼šæœ‰ä¸¤ä¸ªå« name çš„åˆ—ï¼Œè¿™åœ¨ SQLä¸­æ˜¯ä¸å…è®¸çš„ï¼Œè§£å†³æ–¹æ³•æ˜¯ä¸ºä¸¤ä¸ªå­—æ®µåˆ†åˆ«èµ·ä¸€ä¸ªåˆ«å</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> class_student <span class="hljs-keyword">as</span><br><span class="hljs-keyword">select</span> c.name <span class="hljs-keyword">as</span> class_name, s.name <span class="hljs-keyword">as</span> student_name<br><span class="hljs-keyword">from</span> classes <span class="hljs-keyword">as</span> c<br><span class="hljs-keyword">join</span> students <span class="hljs-keyword">as</span> s <span class="hljs-keyword">on</span> c.id <span class="hljs-operator">=</span> s.class_id;<br></code></pre></td></tr></table></figure><p>ä»¥åè¦æƒ³æŸ¥è¯¢ç­çº§åå’Œå­¦ç”Ÿåæ„æˆçš„è¡¨æ ¼ï¼Œåªéœ€è¦è°ƒç”¨ä»¥ä¸‹è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> class_student;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†å¯¹å›ºå®šè¿æ¥æŸ¥è¯¢ç»“æœçš„å°è£…å’Œé‡ç”¨ã€‚å¯ä»¥çœ‹å‡ºï¼Œè§†å›¾æå¤§åœ°ç®€åŒ–äº†å¤æ‚SQLè¯­å¥çš„ä½¿ç”¨ã€‚åˆ©ç”¨è§†å›¾ï¼Œå¯ä¸€æ¬¡æ€§ç¼–å†™åŸºç¡€çš„SQLï¼Œç„¶åæ ¹æ®éœ€è¦å¤šæ¬¡ä½¿ç”¨ã€‚</p><p>é™¤äº†é‡ç”¨ä»¥å¤–ï¼Œè§†å›¾è¿˜æœ‰ä»¥ä¸‹ä½œç”¨ï¼š</p><ol type="1"><li>ä½¿ç”¨è¡¨çš„ç»„æˆéƒ¨åˆ†è€Œä¸æ˜¯æ•´ä¸ªè¡¨;</li><li>ä¿æŠ¤æ•°æ®ã€‚å¯ä»¥ç»™ç”¨æˆ·æˆäºˆè¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„è®¿é—®æƒé™è€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™;</li><li>æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚è§†å›¾å¯è¿”å›ä¸åº•å±‚è¡¨çš„è¡¨ç¤ºå’Œæ ¼å¼ä¸åŒçš„æ•°æ®ã€‚</li></ol><p>æœ€åä¸€ç‚¹å¯ä»¥ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> concat(name, <span class="hljs-string">&#x27;(&#x27;</span>, gender, <span class="hljs-string">&#x27;)&#x27;</span>) <span class="hljs-keyword">as</span> student<br><span class="hljs-keyword">from</span> students <br><span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;M&#x27;</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> name;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è¯­å¥å°†æ‰€æœ‰çš„ç”·æ€§ä¿¡æ¯æŒ‰ç…§<code>åå­—(æ€§åˆ«)</code>çš„æ ¼å¼é‡å»ºï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>student</th></tr></thead><tbody><tr><td>bing (M)</td></tr><tr><td>jun (M)</td></tr><tr><td>ling (M)</td></tr><tr><td>wang (M)</td></tr><tr><td>xQc (M)</td></tr></tbody></table><p>å¦‚æœéœ€è¦çš„è¯ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªè¡¨æ ¼å°è£…æˆä¸€ä¸ªè§†å›¾ã€‚</p><h2 id="è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶">è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶</h2><ol type="1"><li>è§†å›¾å¿…é¡»å”¯ä¸€å‘½å;</li><li>ä¸ºäº†åˆ›å»ºè§†å›¾ï¼Œå¿…é¡»å…·æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™;</li><li>è§†å›¾å¯ä»¥åµŒå¥—ï¼Œå³å¯ä»¥åˆ©ç”¨ä»å…¶ä»–è§†å›¾ä¸­æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢æ¥æ„é€ ä¸€ä¸ªè§†å›¾;</li><li>ORDER BY å¯ä»¥ç”¨åœ¨è§†å›¾ä¸­ï¼Œä½†å¦‚æœä»è¯¥è§†å›¾æ£€ç´¢æ•°æ® SELECT ä¸­ä¹Ÿå«æœ‰ORDER BY ï¼Œé‚£ä¹ˆè¯¥è§†å›¾ä¸­çš„ ORDER BY å°†è¢«è¦†ç›–ã€‚</li><li>è§†å›¾ä¸èƒ½ç´¢å¼•ï¼Œä¹Ÿä¸èƒ½æœ‰å…³è”çš„è§¦å‘å™¨æˆ–é»˜è®¤å€¼ã€‚</li></ol><h2 id="ç®¡ç†è§†å›¾">ç®¡ç†è§†å›¾</h2><ul><li>æŸ¥çœ‹åˆ›å»ºè§†å›¾çš„è¯­å¥ï¼š<code>show create view è§†å›¾å</code></li><li>åˆ é™¤è§†å›¾ï¼š<code>drop view è§†å›¾å</code></li><li>æ›´æ–°è§†å›¾æ—¶ï¼Œå¯ä»¥å…ˆåˆ é™¤<code>deop</code>å†åˆ›å»º<code>create</code>,ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<code>create or replace view</code></li></ul><h1 id="å­˜å‚¨è¿‡ç¨‹">å­˜å‚¨è¿‡ç¨‹</h1><p>åœ¨ MySQL ä¸­ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯ä¸€ç§é¢„ç¼–è¯‘çš„ SQLè¯­å¥é›†åˆï¼Œå¯ä»¥åƒè°ƒç”¨å‡½æ•°ä¸€æ ·æ‰§è¡Œå®ƒã€‚å®ƒé€šå¸¸ç”¨äºå°è£…é‡å¤æ‰§è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚ä¸€ç»„æŸ¥è¯¢ã€æ›´æ–°æˆ–é€»è¾‘åˆ¤æ–­ç­‰ã€‚</p><p>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æœ‰3ä¸ªä¸»è¦çš„å¥½å¤„ï¼Œå³ç®€å•ã€å®‰å…¨ã€é«˜æ€§èƒ½ã€‚</p><h2 id="åˆ›å»º">åˆ›å»º</h2><p>å¦‚æœä½¿ç”¨çš„æ˜¯MySQLå‘½ä»¤è¡Œï¼Œå…ˆåˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $$<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> GetNameById(<br>  <span class="hljs-keyword">IN</span> custId <span class="hljs-type">INT</span><br>)<br><br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> students <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> custId;<br><span class="hljs-keyword">END</span> $$<br><br></code></pre></td></tr></table></figure><ul><li><code>DELIMITER</code>çš„å­˜åœ¨æ„ä¹‰æ˜¯æ”¹å˜ SQLè¯­å¥çš„â€œè¯­å¥ç»“æŸç¬¦â€ã€‚è€ƒè™‘ä¸ä½¿ç”¨<code>DELIMITER</code>çš„æƒ…å†µï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> demo()<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;hello&#x27;</span>;<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;world&#x27;</span>;<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªè¯­å¥çš„ç»“æŸå¤„éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåˆ†å·ï¼Œå…¶ç»“æœå°±æ˜¯åˆšæ‰§è¡Œå®Œ<code>SELECT 'hello';</code>MySQLå°±è®¤ä¸ºè¯­å¥å·²ç»ç»“æŸäº†ï¼Œä»è€ŒæŠ¥é”™ã€‚è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>DELIMITER</code>æ‰‹åŠ¨ä¿®æ”¹ç»“æŸç¬¦ï¼Œ<code>DELIMITER $$</code>å°†ç»“æŸç¬¦ä¸´æ—¶ä¿®æ”¹æˆ<code>$$</code>ï¼Œæœ€å<code>END $$</code>æŠŠç»“æŸç¬¦æ”¹å›é»˜è®¤çš„åˆ†å·ã€‚</p><p>åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œè¯­å¥<code>call GetNameById(12);</code>ï¼Œå¯ä»¥æ­£ç¡®å¾—åˆ°idä¸º12 çš„å­¦ç”Ÿçš„ä¿¡æ¯ã€‚</p><h2 id="å‚æ•°é—®é¢˜">å‚æ•°é—®é¢˜</h2><p>SQL è¯­å¥æ”¯æŒä¸‰ç§å‚æ•°ç±»å‹ï¼š</p><table><thead><tr><th>å‚æ•°ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>IN</code></td><td>è°ƒç”¨æ—¶ä¼ å…¥çš„åªè¯»å‚æ•°</td></tr><tr><td><code>OUT</code></td><td>å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œåè¿”å›çš„è¾“å‡ºå€¼</td></tr><tr><td><code>INOUT</code></td><td>å¯è¯»å¯å†™ï¼Œè°ƒç”¨æ—¶ä¼ å…¥ï¼Œè¿‡ç¨‹å†…å¯ä»¥æ›´æ”¹ï¼Œå¹¶è¿”å›ç»“æœ</td></tr></tbody></table><p>ä¸ºäº†æ–¹ä¾¿å¯¹å­˜å‚¨è¿‡ç¨‹ä¼ å…¥å‚æ•°æˆ–æ¥æ”¶è¾“å‡ºç»“æœï¼Œå¾€å¾€éœ€è¦å®šä¹‰å˜é‡ã€‚åœ¨MySQLä¸­ï¼Œæ‰€æœ‰çš„å˜é‡å¿…é¡»ä»¥<code>@</code>å¼€å¤´ï¼Œå®šä¹‰å˜é‡ä½¿ç”¨<code>SET</code>å…³é”®å­—ã€‚</p><p>ä¸‹é¢ä¸¾ä¸€ä¸ªä½¿ç”¨äº†å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹çš„ä¾‹å­ï¼šæ ¹æ®ä¼ å…¥çš„<code>id</code>è¾“å‡ºå¯¹åº”å­¦ç”Ÿçš„åå­—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> get_student_by_id (<br><span class="hljs-keyword">in</span> student_id <span class="hljs-type">INT</span>,<br><span class="hljs-keyword">out</span> student_name <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)<br>)<br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">into</span> student_name<br><span class="hljs-keyword">from</span> students<br><span class="hljs-keyword">where</span> students.id <span class="hljs-operator">=</span> student_id;<br><span class="hljs-keyword">end</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨è¯¥å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-variable">@sname</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-keyword">call</span> get_student_by_id(<span class="hljs-number">1</span>, <span class="hljs-variable">@sname</span>);<br><br><span class="hljs-keyword">select</span> <span class="hljs-variable">@sname</span>;<br></code></pre></td></tr></table></figure><h2 id="åˆ é™¤">åˆ é™¤</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> å­˜å‚¨è¿‡ç¨‹å<br></code></pre></td></tr></table></figure><p>å¦‚æœæŒ‡å®šçš„å­˜å‚¨è¿‡ç¨‹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥è¯­å¥ä¼šæŠ¥é”™ã€‚ä¸ºäº†é˜²æ­¢æŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨<code>DROP PROCEDURE IF EXISTS</code></p><h1 id="è§¦å‘å™¨">è§¦å‘å™¨</h1><p>MySQL 5 æ·»åŠ äº†å¯¹è§¦å‘å™¨çš„æ”¯æŒã€‚</p><p>è§¦å‘å™¨æ˜¯MySQLå“åº”ä»¥ä¸‹ä»»æ„è¯­å¥è€Œè‡ªåŠ¨æ‰§è¡Œçš„ä¸€æ¡MySQLè¯­å¥ï¼ˆæˆ–ä½äºBEGINå’ŒENDè¯­å¥ä¹‹é—´çš„ä¸€ç»„è¯­å¥ï¼‰ï¼š</p><ul><li>DELETE</li><li>INSERT</li><li>UPDATE</li></ul><p>å…¶ä»–sqlè¯­å¥éƒ½ä¸æ”¯æŒè§¦å‘å™¨ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</h2><p>åˆ›å»ºè§¦å‘å™¨éœ€è¦ç»™å‡ºå››æ¡ä¿¡æ¯ï¼š</p><ul><li>å”¯ä¸€çš„è§¦å‘å™¨åï¼ˆMySQLè§„å®šæ¯ä¸ªè¡¨ä¸­å”¯ä¸€ï¼Œä½†æ˜¯æ¨èåœ¨æ•´ä¸ªæ•°æ®åº“èŒƒå›´å†…ä½¿ç”¨å”¯ä¸€çš„è§¦å‘å™¨åï¼‰ï¼›</li><li>è§¦å‘å™¨å…³è”çš„è¡¨ï¼›</li><li>è§¦å‘å™¨åº”è¯¥å“åº”çš„äº‹ä»¶ï¼ˆDELETEã€INSERTæˆ–UPDATEï¼‰ï¼›</li><li>è§¦å‘å™¨ä½•æ—¶æ‰§è¡Œï¼ˆå¤„ç†ä¹‹å‰æˆ–ä¹‹åï¼‰ã€‚</li></ul><p>MySQLè§„å®š<strong>è§¦å‘å™¨ä¸­ä¸èƒ½æœ‰ä»»ä½•è¿”å›ç»“æœé›†çš„è¡Œä¸º</strong>ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>SELECT</li><li>CALL å«æœ‰ SELECT çš„å­˜å‚¨è¿‡ç¨‹</li><li>è¿”å›æ¸¸æ ‡</li></ul><p>å…³é”®å­—ï¼š<code>CREATE TRIGGER</code>ã€‚ä¸‹é¢çš„sqlè„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªè§¦å‘å™¨ï¼Œæ¯å½“<code>students</code>è¡¨å‘ç”Ÿæ’å…¥æ“ä½œæ—¶å°±ä¼šæ‰§è¡Œï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯å‘ç”¨äºè®°å½•æ—¥å¿—çš„è¡¨<code>student_insert_log</code>æ’å…¥ä¸€æ¡æ—¥å¿—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> insert_test<br>AFTER <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> students<br><span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span><br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student_insert_log (student_id)<br>    <span class="hljs-keyword">VALUES</span> (NEW.id);<br><span class="hljs-keyword">END</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è§¦å‘å™¨ä¸­è¿˜æœ‰<code>NEW</code>å’Œ<code>OLD</code>è¿™ä¸¤ä¸ªç‰¹æ®Šçš„å…³é”®å­—ï¼š</p><ul><li>åœ¨ INSERTè§¦å‘å™¨ä¸­å¯ä»¥é€šè¿‡<code>NEW</code>è®¿é—®è¢«æ’å…¥çš„è¡Œï¼Œä¾‹å¦‚<code>NEW.id</code>è·å–è¢«æ’å…¥è®°å½•çš„idå€¼ã€‚</li><li>åœ¨ DELETE è§¦å‘å™¨ä»£ç å†…ï¼Œå¯ä»¥å¼•ç”¨<code>OLD</code>è®¿é—®è¢«åˆ é™¤çš„è¡Œ</li><li>åœ¨ UPDATEè§¦å‘å™¨ä»£ç å†…ï¼Œå¯ä»¥å¼•ç”¨<code>OLD</code>å¼•ç”¨åŸæ¥çš„è¡Œï¼Œç”¨<code>NEW</code>å¼•ç”¨æ–°çš„è¡Œ</li></ul><p>BEFORE å’Œ AFTER çš„ä½¿ç”¨åœºæ™¯ï¼šBEFOREç”¨äºå¯¹æ’å…¥æ•°æ®çš„æ•°æ®éªŒè¯ï¼Œç¡®ä¿æ’å…¥/æ›´æ–°/åˆ é™¤æ“ä½œå¤„ç†çš„æ˜¯æ­£ç¡®çš„æ•°æ®ã€‚AFTERç”¨äºåœ¨æ“ä½œå®Œæˆåæ‰§è¡Œæ—¥å¿—è®°å½•ç­‰ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><ul><li>åº”è¯¥ç”¨è§¦å‘å™¨æ¥ä¿è¯<strong>æ•°æ®çš„ä¸€è‡´æ€§</strong>ï¼ˆå¤§å°å†™ã€æ ¼å¼ç­‰ï¼‰ã€‚åœ¨è§¦å‘å™¨ä¸­æ‰§è¡Œè¿™ç§ç±»å‹çš„å¤„ç†çš„ä¼˜ç‚¹æ˜¯å®ƒæ€»æ˜¯è¿›è¡Œè¿™ç§å¤„ç†ï¼Œè€Œä¸”æ˜¯é€æ˜åœ°è¿›è¡Œï¼Œä¸å®¢æˆ·æœºåº”ç”¨æ— å…³ã€‚</li><li>è§¦å‘å™¨çš„ä¸€ç§éå¸¸æœ‰æ„ä¹‰çš„ä½¿ç”¨æ˜¯åˆ›å»º<strong>å®¡è®¡è·Ÿè¸ª</strong>ã€‚ä½¿ç”¨è§¦å‘å™¨ï¼ŒæŠŠæ›´æ”¹ï¼ˆå¦‚æœéœ€è¦ï¼Œç”šè‡³è¿˜æœ‰ä¹‹å‰å’Œä¹‹åçš„çŠ¶æ€ï¼‰è®°å½•åˆ°å¦ä¸€ä¸ªè¡¨éå¸¸å®¹æ˜“ã€‚</li><li>MySQL è§¦å‘å™¨ä¸­<strong>ä¸æ”¯æŒ</strong> CALLè¯­å¥ã€‚è¿™è¡¨ç¤ºä¸èƒ½ä»è§¦å‘å™¨å†…è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚æ‰€éœ€çš„å­˜å‚¨è¿‡ç¨‹ä»£ç éœ€è¦å¤åˆ¶åˆ°è§¦å‘å™¨å†…ã€‚</li></ul><h1 id="äº‹åŠ¡å¤„ç†">äº‹åŠ¡å¤„ç†</h1><h2 id="æ¦‚è¿°">æ¦‚è¿°</h2><p>äº‹åŠ¡å¤„ç†(TransactionProcessing)ä¸€å…±æœ‰ä¸¤ä¸ªæ“ä½œï¼šæäº¤(<strong>COMMIT</strong>)å’Œå›æ»š(<strong>ROLLBACK</strong>)ã€‚å®ƒå¯ä»¥ç”¨æ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§ï¼Œä¿è¯æˆæ‰¹çš„MySQLæ“ä½œè¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨æˆ‘ä»¬ç”¨ä¸€ä¸ª<code>orders</code>è¡¨ç”¨æ¥è®°å½•å®¢æˆ·è®¢å•çš„ç¼–å·å’Œä¸‹å•æ—¥æœŸï¼Œå¦ä¸€ä¸ªè¡¨<code>orders_item</code>ç”¨æ¥è®°å½•æ¯ä¸ªè®¢å•åŒ…å«çš„ç‰©å“ã€æ•°é‡ã€ä»·æ ¼çš„å…·ä½“ç»†èŠ‚ï¼Œè¿™ä¸¤ä¸ªè¡¨é€šè¿‡ä¸»é”®<code>order_num</code>å…³è”ã€‚æ˜¾ç„¶ï¼Œå½“æˆ‘ä»¬æ”¶åˆ°æ–°è®¢å•çš„æ—¶å€™ï¼Œéœ€è¦åŒæ—¶å¾€ä¸¤ä¸ªè¡¨æ·»åŠ è®°å½•ã€‚ä½†æ˜¯å¦‚æœä¸¤æ¬¡æ’å…¥æ“ä½œä¸­æœ‰æŸä¸€ä¸ªå‘ç”Ÿäº†é”™è¯¯ï¼Œå°±ä¼šå¯¼è‡´â€œç©ºè®¢å•â€çš„äº§ç”Ÿï¼Œè¿™æ˜¯ä¸è¢«å…è®¸çš„ã€‚</p><p>è§£å†³æ–¹æ³•æ˜¯å°†ä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œç»Ÿä¸€ç®¡ç†èµ·æ¥ã€‚ä¸Šè¿°æ”¶åˆ°æ–°è®¢å•åæ·»åŠ è®°å½•çš„å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªæ“ä½œï¼šå‘<code>orders</code>æ’å…¥è®¢å•ç¼–å·å’Œæ—¥æœŸï¼Œå‘<code>orders_item</code>æ’å…¥å…¶å®ƒç»†èŠ‚ã€‚</p><p>å¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œå°†æ•´ç»„è¯­å¥æäº¤ç»™ï¼ˆå†™åˆ°ï¼‰æ•°æ®åº“è¡¨ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿›è¡Œå›é€€ï¼ˆæ’¤é”€ï¼‰ä»¥æ¢å¤æ•°æ®åº“åˆ°æŸä¸ªå·²çŸ¥ä¸”å®‰å…¨çš„çŠ¶æ€ã€‚</p><h2 id="å¸¸ç”¨æœ¯è¯­">å¸¸ç”¨æœ¯è¯­</h2><ul><li>äº‹åŠ¡ï¼ˆtransactionï¼‰æŒ‡ä¸€ç»„SQLè¯­å¥ï¼›</li><li>å›æ»šï¼ˆrollbackï¼‰æŒ‡æ’¤é”€æŒ‡å®šSQLè¯­å¥çš„è¿‡ç¨‹ï¼›</li><li>æäº¤ï¼ˆcommitï¼‰æŒ‡å°†æœªå­˜å‚¨çš„SQLè¯­å¥ç»“æœå†™å…¥æ•°æ®åº“è¡¨ï¼›</li><li>ä¿ç•™ç‚¹ï¼ˆsavepointï¼‰æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplace-holderï¼‰ï¼Œä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›æ»šï¼ˆä¸å›é€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚</li></ul><h2 id="æ§åˆ¶äº‹åŠ¡å¤„ç†">æ§åˆ¶äº‹åŠ¡å¤„ç†</h2><p>MySQL ä½¿ç”¨ä»¥ä¸‹è¯­å¥è¡¨æ˜äº‹åŠ¡çš„å¼€å§‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">START</span> TRANSACTION<br></code></pre></td></tr></table></figure><p>å¼€å¯äº‹åŠ¡åï¼Œå¯ä»¥åœ¨äº‹åŠ¡å¤„ç†å†…éƒ¨ä½¿ç”¨ROLLBACKã€‚ROLLBACK å‘½ä»¤ç”¨æ¥æ’¤é”€INSERT, UPDATE, DELETE è¯­å¥ã€‚CREATE å’Œ DROPä¸èƒ½è¢«å›é€€ã€‚</p><p>åœ¨äº‹åŠ¡å¤„ç†ä¸­ï¼Œæäº¤ä¸ä¼šéšå«åœ°è¿›è¡Œï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨COMMITã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼šä»è´¦æˆ· A æ‰£ 100 å…ƒï¼Œç»™è´¦æˆ· B åŠ  100 å…ƒ â€”â€”ä¸­é—´ä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½è¦å›æ»šã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">START</span> TRANSACTION;<br><br><span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">-- Aè´¦æˆ·æ‰£æ¬¾</span><br><span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">-- Bè´¦æˆ·åŠ æ¬¾</span><br><br><span class="hljs-comment">-- æ£€æŸ¥æ˜¯å¦éƒ½æˆåŠŸæ‰§è¡Œ</span><br><span class="hljs-comment">-- å¯åŠ ä¸Šåˆ¤æ–­é€»è¾‘ï¼Œæ¯”å¦‚æ£€æŸ¥ä½™é¢ &gt;= 0ï¼Œå†å†³å®šæ˜¯å¦æäº¤</span><br><br><span class="hljs-keyword">COMMIT</span>;  <span class="hljs-comment">-- æäº¤äº‹åŠ¡</span><br><br><span class="hljs-comment">-- è‹¥å‘ç”Ÿå¼‚å¸¸ï¼Œå¦‚ä½™é¢ä¸è¶³</span><br><span class="hljs-comment">-- ROLLBACK;  -- å›æ»šäº‹åŠ¡</span><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œå¦‚æœç¬¬ä¸€æ¡UPDATEè¯­å¥æˆåŠŸæ‰§è¡Œï¼Œä½†æ˜¯ç¬¬äºŒæ¡å‡ºé”™ï¼Œé‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡ä¹Ÿä¼šè¢«è‡ªåŠ¨æ’¤é”€ã€‚è¿™å°±ä¿è¯äº†æœ€åæäº¤çš„ç»“æœä¸€å®šæ˜¯æ²¡æœ‰é”™è¯¯çš„ã€‚</p><p>å½“COMMITæˆ–ROLLBACKè¯­å¥æ‰§è¡Œåï¼Œäº‹åŠ¡ä¼š<strong>è‡ªåŠ¨å…³é—­</strong>ï¼ˆå°†æ¥çš„æ›´æ”¹ä¼šéšå«æäº¤ï¼‰ã€‚</p><h2 id="ä¿ç•™ç‚¹">ä¿ç•™ç‚¹</h2><p>ä¸Šé¢çš„å›æ»šå’Œæäº¤çš„æ“ä½œéƒ½é’ˆå¯¹æ•´ä¸ªäº‹åŠ¡ã€‚å¯¹äºæ›´å¤æ‚çš„äº‹åŠ¡è€Œè¨€ï¼Œå¯èƒ½éœ€è¦éƒ¨åˆ†æäº¤æˆ–è€…å›æ»šã€‚</p><p>ä¸ºäº†æ”¯æŒå›é€€éƒ¨åˆ†äº‹åŠ¡å¤„ç†ï¼Œå¿…é¡»èƒ½åœ¨äº‹åŠ¡å¤„ç†å—ä¸­åˆé€‚çš„ä½ç½®æ”¾ç½®å ä½ç¬¦ã€‚è¿™æ ·ï¼Œå¦‚æœéœ€è¦å›é€€ï¼Œå¯ä»¥å›é€€åˆ°æŸä¸ªå ä½ç¬¦ã€‚</p><p>ç”¨æ³•ï¼š<code>SAVEPOINT ä¿ç•™ç‚¹çš„åç§°</code></p><p>ä¿ç•™ç‚¹çš„åå­—ä¸å¯ä»¥é‡å¤ï¼Œåœ¨å›æ»šæ—¶ï¼ŒMySQLæ ¹æ®åå­—ç²¾ç¡®åˆ¤æ–­è¯¥å›æ»šåˆ°å“ªä¸ªä½ç½®ã€‚ä¸ºäº†å›æ»šåˆ°å·²çŸ¥çš„ä¿ç•™ç‚¹ï¼Œä½¿ç”¨ä»¥ä¸‹è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> ä¿ç•™ç‚¹çš„åå­—<br></code></pre></td></tr></table></figure><p>ä¿ç•™ç‚¹è®¾ç½®å¾—è¶Šå¤šè¶Šå¥½ï¼Œè¿™æ ·å¯ä»¥å……åˆ†æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è¿›è¡Œå›é€€ã€‚åœ¨äº‹åŠ¡å¤„ç†å®Œæˆä»¥åï¼Œæ‰€æœ‰çš„ä¿ç•™ç‚¹ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</p><h2 id="æ›´æ”¹é»˜è®¤æäº¤è¡Œä¸º">æ›´æ”¹é»˜è®¤æäº¤è¡Œä¸º</h2><p><code>autocommit</code>æ ‡å¿—å†³å®šæ˜¯å¦è‡ªåŠ¨æäº¤æ›´æ”¹ï¼Œ0 ä»£è¡¨æ‰‹åŠ¨æäº¤ï¼Œ1ä»£è¡¨è‡ªåŠ¨æäº¤ã€‚ä½¿ç”¨<code>SET</code>ä¿®æ”¹å³å¯ã€‚è¯¥æ ‡å¿—çš„ä½œç”¨èŒƒå›´æ˜¯ä¸€ä¸ªè¿æ¥å†…ã€‚</p><h1 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://www.oracle.com/cn/database/what-is-a-relational-database/<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:2"class="footnote-text"><span>https://zhuanlan.zhihu.com/p/68136613<a href="#fnref:2" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XMLåŸºç¡€</title>
    <link href="/2025/04/29/XML%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/04/29/XML%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="xml">XML</h1><p>XML è¿˜æ²¡æœ‰è¢«æ·˜æ±°ï¼Œåº”ç”¨çš„åœ°æ–¹è¿˜æœ‰ä¸å°‘ï¼Œæ¯”å¦‚è¯´ Maven çš„ pom.xmlæ–‡ä»¶é‡Œå°±è¿˜åœ¨ç”¨ã€‚ä½†æ˜¯ä½œä¸ºä¸€ç§æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œå®ƒæ­£åœ¨è¢« JSONæ›¿ä»£ã€‚æ‰€ä»¥ä»¥ä¸‹ç®€å•åˆ—ä¸¾ä¸€äº›XMLçš„åŸºç¡€çŸ¥è¯†ï¼Œæ›´æ·±å±‚æ¬¡çš„ç›®å‰æ²¡å¿…è¦å»å­¦ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯xml">ä»€ä¹ˆæ˜¯XML</h2><p>XML(eXtensible MarkupLanguageï¼Œå¯æ‰©å±•æ ‡è®°è¯­è¨€)ï¼Œå…¶è®¾è®¡ç›®çš„å°±æ˜¯å­˜å‚¨å’Œä¼ è¾“æ•°æ®ã€‚XMLä¹Ÿæ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œç±»ä¼¼äºHTMLï¼Œä½†æ˜¯HTMLåªè´Ÿè´£æ˜¾ç¤ºæ•°æ®ï¼Œè€Œä¸”XMLçš„æ ‡ç­¾ä¸åƒHTMLä¸€æ ·é¢„å…ˆè¢«å®šä¹‰ã€‚åœ¨è®¸å¤šHTML åº”ç”¨ç¨‹åºä¸­ï¼ŒXML ç”¨äºå­˜å‚¨æˆ–ä¼ è¾“æ•°æ®ï¼Œè€Œ HTMLç”¨äºæ ¼å¼åŒ–å’Œæ˜¾ç¤ºè¿™äº›æ•°æ®ã€‚</p><p><strong>å¯æ‰©å±•æ€§</strong>å°±ä½“ç°åœ¨ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ä»»ä½•éœ€è¦çš„æ ‡ç­¾ï¼Œè€Œä¸”å³ä½¿æ·»åŠ äº†ï¼ˆæˆ–åˆ é™¤äº†ï¼‰æ–°æ•°æ®ï¼Œå¤§å¤šæ•°XML åº”ç”¨ç¨‹åºä¹Ÿä¼šæŒ‰é¢„æœŸå·¥ä½œï¼Œè¾“å‡ºä¸å—å½±å“ã€‚<strong>XMLçš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œå°±æ˜¯å¯ä»¥ç»å¸¸åœ¨ä¸ä¸­æ–­åº”ç”¨ç¨‹åºçš„æƒ…å†µè¿›è¡Œæ‰©å±•</strong>ã€‚</p><p>å’ŒJSONä¸€æ ·ï¼ŒXMLä»¥çº¯æ–‡æœ¬æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·å°±é¿å…äº†åœ¨ä¸åŒçš„è®¡ç®—æœºç³»ç»Ÿä¸Šäº¤æ¢æ•°æ®æ—¶çš„ä¸å…¼å®¹é—®é¢˜ã€‚</p><p>è¿™æ˜¯åšå®¢çš„ç«™ç‚¹åœ°å›¾æ–‡ä»¶<code>sitemap.xml</code>çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">urlset</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span><br>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://kznep19.blog/2025/04/27/Maven%E7%9A%84%E4%BD%BF%E7%94%A8/<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-04-28<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">changefreq</span>&gt;</span>monthly<span class="hljs-tag">&lt;/<span class="hljs-name">changefreq</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>0.6<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>  <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">urlset</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€è¡Œæ˜¯XMLå£°æ˜</li><li><code>urlset</code>æ˜¯æŒ‡å®šè¯¥æ–‡æ¡£éµå¾ª sitemaps.org çš„ Sitemap 0.9æ ‡å‡†ã€‚ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç½‘å€åˆ—è¡¨ã€‚<code>xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"</code>æŒ‡å®šè¯¥æ–‡æ¡£éµå¾ªsitemaps.org çš„ Sitemap 0.9 æ ‡å‡†ã€‚</li><li><code>&lt;loc&gt;</code>:é¡µé¢URL</li><li><code>&lt;lastmod&gt;</code>:é¡µé¢çš„æœ€åä¿®æ”¹æ—¶é—´</li><li><code>&lt;changefreq&gt;</code>:å»ºè®®æœç´¢å¼•æ“å¤šä¹…æŠ“å–ä¸€æ¬¡</li><li><code>&lt;priority&gt;</code>:é¡µé¢åœ¨ç«™ç‚¹ä¸­çš„ç›¸å¯¹é‡è¦æ€§(0.0â€“1.0)</li></ul><h2 id="xmlæ ‘ç»“æ„">XMLæ ‘ç»“æ„</h2><p>XML ä¸­çš„å…ƒç´ å½¢æˆäº†ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼š</p><p><img src="https://www.w3school.com.cn/i/xml/nodetree.png" /></p><p>ä»æœ€ä¸Šé¢çš„æ ¹å…ƒç´ å¼€å§‹ï¼Œæ‰©å±•åˆ°æå¶ã€‚</p><h2 id="è¯­æ³•">è¯­æ³•</h2><ol type="1"><li>XML æ–‡æ¡£å¿…é¡»åŒ…å«ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œä½œä¸ºå…¶ä»–æ‰€æœ‰å…ƒç´ çš„çˆ¶å…ƒç´ </li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">child</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">subchild</span>&gt;</span>.....<span class="hljs-tag">&lt;/<span class="hljs-name">subchild</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">child</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>XML æ ‡ç­¾åŒºåˆ†å¤§å°å†™</li><li>ä¸€äº›ç¬¦å·ä¸èƒ½ç›´æ¥å†™åœ¨å…ƒç´ ä¸­ï¼Œä½¿ç”¨<strong>å®ä½“å¼•ç”¨</strong></li></ol><table><thead><tr><th>å­—ç¬¦</th><th>æ›¿ä»£å†™æ³•</th></tr></thead><tbody><tr><td><code>&lt;</code></td><td><code>&amp;lt;</code>ï¼ˆless thanï¼‰</td></tr><tr><td><code>&gt;</code></td><td><code>&amp;gt;</code>ï¼ˆgreater thanï¼‰</td></tr><tr><td><code>&amp;</code></td><td><code>&amp;amp;</code>ï¼ˆampersandï¼‰</td></tr><tr><td><code>"</code></td><td><code>&amp;quot;</code>ï¼ˆåŒå¼•å·ï¼‰</td></tr><tr><td><code>'</code></td><td><code>&amp;apos;</code>ï¼ˆå•å¼•å·ï¼‰</td></tr></tbody></table><ol start="4" type="1"><li>å¤šä¸ªè¿ç»­çš„ç©ºæ ¼ä¸ä¼šè¢«è£å‰ª</li></ol><h2 id="å…ƒç´ ">å…ƒç´ </h2><p>ç±»ä¼¼<code>&lt;lastmod&gt;2025-04-28&lt;/lastmod&gt;</code>è¢«ç§°ä¸ºä¸€ä¸ª<strong>å…ƒç´ </strong>ã€‚å…ƒç´ çš„å†…å®¹å¯ä»¥æ˜¯æ–‡æœ¬å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„å­å…ƒç´ ã€‚</p><p><strong>ç©ºå…ƒç´ </strong>ï¼šå½¢å¦‚<code>&lt;element&gt;&lt;/element&gt;</code>ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå…³é—­æ ‡ç­¾è®°ä¸º<code>&lt;element /&gt;</code>ã€‚</p><p>å…ƒç´ çš„å‘½åçº¦å®šï¼š</p><table><thead><tr><th>æ ·å¼</th><th>ä¾‹å­</th><th>æè¿°</th></tr></thead><tbody><tr><td>å°å†™</td><td><code>&lt;firstname&gt;</code></td><td>æ‰€æœ‰å­—æ¯å°å†™</td></tr><tr><td>å¤§å†™</td><td><code>&lt;FIRSTNAME&gt;</code></td><td>æ‰€æœ‰å­—æ¯å¤§å†™</td></tr><tr><td>è›‡å½¢</td><td><code>&lt;first_name&gt;</code></td><td>ä¸‹åˆ’çº¿åˆ†éš”å•è¯ï¼ˆå¸¸ç”¨äº SQL æ•°æ®åº“ï¼‰</td></tr><tr><td>å¸•æ–¯å¡</td><td><code>&lt;FirstName&gt;</code></td><td>æ¯ä¸ªå•è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ï¼ˆC ç¨‹åºå‘˜å¸¸ç”¨ï¼‰</td></tr><tr><td>é©¼å³°</td><td><code>&lt;firstName&gt;</code></td><td>é™¤ç¬¬ä¸€ä¸ªä¹‹å¤–çš„æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ï¼ˆå¸¸ç”¨äº JavaScriptï¼‰</td></tr></tbody></table><h2 id="å±æ€§">å±æ€§</h2><p><strong>Attribute</strong></p><p>XMLå±æ€§å¿…é¡»åŠ å¼•å·ï¼š<code>&lt;person gender="female"&gt;</code>ï¼Œå•åŒéƒ½å¯ã€‚å±æ€§çš„æ‰©å±•æ€§å¾ˆå·®ã€‚</p><p>æ•°æ®æœ¬èº«åº”å½“å­˜å‚¨ä¸ºå…ƒç´ ï¼Œå…ƒæ•°æ®ï¼ˆç”¨äºæè¿°æ•°æ®çš„ä¿¡æ¯ï¼‰åº”å½“å­˜å‚¨ä¸ºå±æ€§ã€‚</p><h2 id="å‘½åç©ºé—´">å‘½åç©ºé—´</h2><p><strong>Namespace</strong></p><p>å½“ä¸¤ä¸ªä¸åŒçš„æ–‡æ¡£ä½¿ç”¨ç›¸åŒçš„å…ƒç´ åç§°æ—¶ï¼Œå°±ä¼šå‘ç”Ÿ<strong>å‘½åå†²çª</strong>ã€‚ä¾‹å¦‚ï¼Œtableæ—¢å¯ä»¥ä½œä¸ºæ¡Œå­çš„åç§°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¡¨æ ¼çš„åç§°ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>æœ¨å¤´é¤æ¡Œ<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>å‘˜å·¥å·¥èµ„è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¾ˆéš¾åŒºåˆ†äº†ã€‚è§£å†³æ–¹æ³•ï¼š<strong>åç§°å‰ç¼€</strong></p><p>åœ¨xmlä¸­ä½¿ç”¨å‰ç¼€ï¼Œå¿…é¡»å®šä¹‰å‘½åç©ºé—´ã€‚å‘½åç©ºé—´å¯ä»¥é€šè¿‡å…ƒç´ å¼€å§‹æ ‡è®°ä¸­çš„<code>xmlns</code>å±æ€§æ¥å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯XML Namespaceã€‚</p><p><strong>è¯­æ³•</strong>ï¼š<code>xmlns:å‰ç¼€="å‘½åç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸€èˆ¬æ˜¯ URLï¼‰"</code></p><p>å…¶ä¸­â€œå‘½åç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦â€å³ä¸º URI ï¼Œæœ€å¸¸è§çš„URIæ˜¯URL(UniformResource Locator)ï¼Œä¹Ÿå°±æ˜¯ç½‘å€ã€‚åŠ ä¸Šåç§°å‰ç¼€ä¹‹åä¸Šé¢çš„ä¾‹å­å˜æˆ:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">a:table</span> <span class="hljs-attr">xmlns:a</span>=<span class="hljs-string">&quot;http://example.com/furniture&quot;</span>&gt;</span>æœ¨å¤´é¤æ¡Œ<span class="hljs-tag">&lt;/<span class="hljs-name">a:table</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">b:table</span> <span class="hljs-attr">xmlns:b</span>=<span class="hljs-string">&quot;http://example.com/database&quot;</span>&gt;</span>å‘˜å·¥å·¥èµ„è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">b:table</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½åŒºåˆ†å¼€æ¥äº†ã€‚</p><p>ç„¶åå›åˆ°å¼€å¤´çš„ä¾‹å­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">urlset</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¼¼ä¹ä¸ç¬¦åˆå‘½åç©ºé—´çš„è¯­æ³•ï¼Œå…¶å®è¿™é‡Œç”¨çš„æ˜¯<strong>é»˜è®¤å‘½åç©ºé—´</strong>ï¼Œæ„æ€æ˜¯ï¼šæ–‡æ¡£ä¸­<strong>æ‰€æœ‰æ²¡æœ‰å‰ç¼€çš„å…ƒç´ </strong>ï¼ˆå¦‚<code>&lt;url&gt;</code>ã€<code>&lt;loc&gt;</code>ï¼‰<strong>éƒ½å±äºè¿™ä¸ªå‘½åç©ºé—´</strong>ã€‚</p><h2 id="xmlhttprequest">XMLHttpRequest</h2><div class="note note-secondary">            <p><code>XMLHttpRequest</code>æ˜¯æµè§ˆå™¨ä¸­çš„ä¸€ä¸ª JavaScriptå¯¹è±¡ï¼Œç”¨äºåœ¨ç½‘é¡µä¸æœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®ï¼Œè€Œæ— éœ€åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚</p>          </div><p><code>XMLHttpRequest</code>æ˜¯ 2000 å¹´ä»£æ—©æœŸçš„APIï¼Œä¸è¿‡ç°åœ¨æœ‰ä½¿ç”¨èµ·æ¥æ›´ç®€æ´æ–¹ä¾¿çš„<code>fetch</code>ã€‚ä½¿ç”¨xhrå‘é€GETè¯·æ±‚çš„å®ä¾‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//åˆ›å»ºè¯·æ±‚å¯¹è±¡</span><br><span class="hljs-keyword">var</span> xhttp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br><br><span class="hljs-comment">//äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¯å½“xhrçš„å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨</span><br>xhttp.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">//è¯·æ±‚å·²å®Œæˆï¼Œä¸”è¿”å›çš„çŠ¶æ€ç ä¸º200</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">readyState</span> == <span class="hljs-number">4</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> == <span class="hljs-number">200</span>) &#123;<br>       <span class="hljs-comment">// æ›´æ–°ç½‘é¡µ</span><br>       <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;demo&quot;</span>).<span class="hljs-property">innerHTML</span> = xhttp.<span class="hljs-property">responseText</span>;<br>    &#125;<br>&#125;;<br><span class="hljs-comment">//è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€ä»¥åŠæ˜¯å¦å¼‚æ­¥</span><br>xhttp.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;filename&quot;</span>, <span class="hljs-literal">true</span>);<br><span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>xhttp.<span class="hljs-title function_">send</span>();<br></code></pre></td></tr></table></figure><p><strong>æ‰§è¡Œé¡ºåº</strong>ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">è¯·æ±‚å·²å‘é€<br>ï¼ˆç¨åï¼‰onreadystatechange è¢«è§¦å‘ï¼Œå½“çŠ¶æ€å˜ä¸º <span class="hljs-number">4</span> ä¸” <span class="hljs-built_in">status</span> ä¸º <span class="hljs-number">200</span> æ—¶æ‰§è¡Œå›è°ƒ<br></code></pre></td></tr></table></figure><p>ç”±äºæ˜¯å¼‚æ­¥æ–¹å¼ï¼Œ<code>xhttp.send();</code>ä¸€å¼€å§‹å°±ä¼šè¢«æ‰§è¡Œï¼Œæµè§ˆå™¨å¼‚æ­¥åœ°ç­‰å¾…å“åº”ï¼ŒæœŸé—´å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ï¼Œå½“xhrçŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šæ›´æ–°ç½‘é¡µã€‚</p><h2 id="xml-è§£æ">XML è§£æ</h2><h3 id="dom">DOM</h3><p>å°† XML æ–‡æ¡£è½¬æ¢ä¸ºXML DOM å¯¹è±¡ - å¯é€šè¿‡ JavaScript æ“ä½œçš„å¯¹è±¡ã€‚</p><p>JSä½¿ç”¨<code>DOMParser</code>è§£æxmlå­—ç¬¦ä¸²å®ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> xmlString = <span class="hljs-string">&quot;&lt;note&gt;&lt;to&gt;Alice&lt;/to&gt;&lt;from&gt;Bob&lt;/from&gt;&lt;/note&gt;&quot;</span>;<br><span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMParser</span>();<br><span class="hljs-keyword">const</span> xmlDoc = parser.<span class="hljs-title function_">parseFromString</span>(xmlString, <span class="hljs-string">&quot;application/xml&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(xmlDoc.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;to&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">textContent</span>); <span class="hljs-comment">// è¾“å‡º &quot;Alice&quot;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å¿…é¡»æ”¾åˆ°æµè§ˆå™¨ä¸­æ‰èƒ½è¿è¡Œã€‚</p><p>ä¸Šé¢ä½¿ç”¨è§£æå™¨å°†XMLæ–‡ä»¶è½¬æ¢ä¸ºXML DOMå¯¹è±¡ï¼Œå¯¹äºXMLDOMå¯¹è±¡ä¹Ÿæœ‰å¯ç”¨çš„è®¿é—®æ–¹æ³•ã€‚ä¾‹å¦‚<code>getElementsByTagName</code>ï¼Œ<code>getElementById</code>ç­‰ã€‚å› ä¸ºXMLDOMå‘ˆç°æ ‘çŠ¶ç»“æ„ï¼Œæˆ‘ä»¬ä»æ ¹å…ƒç´ å‡ºå‘ä¸€å®šå¯ä»¥éå†æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œè·å–è¿™ä¸ªXMLæ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h3 id="sax">SAX</h3><p>DOMæ–¹å¼å›ºç„¶çœäº‹ï¼Œä½†æ˜¯å†…å­˜å¼€é”€å¤ªå¤§ï¼Œå› ä¸ºæ•´ä¸ªXMLæ–‡ä»¶å¿…é¡»åŠ è½½åˆ°å†…å­˜ä¸­ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚SAXæ˜¯å¦ä¸€ç§è§£æXMLçš„æ–¹å¼ï¼Œå³<code>Simple API for XML</code>ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº<strong>äº‹ä»¶æµ</strong>çš„é—´éš™æ–¹å¼ï¼Œè§£ææ—¶é€ä¸ªè¯»å–XMLæ–‡ä»¶çš„å…ƒç´ å¹¶è§¦å‘ç›¸åº”äº‹ä»¶ã€‚ä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¾ç„¶å¾ˆéº»çƒ¦ã€‚</p><h3 id="jackson">Jackson</h3><p>Jacksonæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒä¸»è¦ç”¨äºJavaå¯¹è±¡å’ŒJSONä¹‹é—´çš„è½¬åŒ–ï¼Œä¹Ÿå¯ä»¥å®ç°XMLåˆ°JavaBeançš„è½¬æ¢ã€‚<ahref="https://github.com/FasterXML/jackson">ä»“åº“åœ°å€</a></p>]]></content>
    
    
    <categories>
      
      <category>Web Development</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Mavençš„åŸºæœ¬æ“ä½œ</title>
    <link href="/2025/04/27/Maven%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <url>/2025/04/27/Maven%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°">æ¦‚è¿°</h1><p>Mavenè§£å†³äº†è½¯ä»¶æ„å»ºçš„ä¸¤æ–¹é¢é—®é¢˜ï¼šä¸€æ˜¯è½¯ä»¶æ˜¯å¦‚ä½•æ„å»ºçš„ï¼ŒäºŒæ˜¯è½¯ä»¶çš„ä¾èµ–å…³ç³»ã€‚</p><p>ä¸åŒäºApacheAntç­‰æ—©æœŸå·¥å…·ï¼ŒMavenè®¾å®šäº†æ„å»ºæµç¨‹çš„æ ‡å‡†ï¼Œåœ¨æ­¤ä¹‹å¤–åªéœ€è¦æŒ‡å®šä¾‹å¤–æƒ…å†µã€‚XMLæ–‡ä»¶æè¿°äº†æ­£åœ¨æ„å»ºçš„è½¯ä»¶é¡¹ç›®ã€å®ƒå¯¹å…¶ä»–å¤–éƒ¨æ¨¡å—å’Œç»„ä»¶çš„ä¾èµ–å…³ç³»ã€æ„å»ºé¡ºåºã€ç›®å½•å’Œæ‰€éœ€çš„æ’ä»¶ã€‚è¯¥æ–‡ä»¶é€šå¸¸æœ‰é¢„è®¾çš„ç›®æ ‡ä»»åŠ¡ï¼Œä¾‹å¦‚ä»£ç ç¼–è¯‘å’Œæ‰“åŒ…ã€‚Mavenä»ä¸€ä¸ªæˆ–å¤šä¸ªä»£ç ä»“åº“ï¼ˆä¾‹å¦‚Maven2 CentralRepositoryï¼‰åŠ¨æ€åœ°ä¸‹è½½Javaåº“ä¸Mavenæ’ä»¶ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜åŒºä¸­ã€‚<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://zh.wikipedia.org/wiki/Apache_Maven">[1]</span></a></sup></p><p>GAVPï¼šä¸ºæ¯ä¸ªé¡¹ç›®åœ¨mavenä»“åº“ä¸­åšä¸€ä¸ªæ ‡è¯†ï¼Œç±»ä¼¼äºäººçš„åå­—ã€‚</p><ul><li>Groupidæ˜¯å…¬å¸é¡¹ç›®:å…¬å¸é¡¹ç›®-ä¸šåŠ¡çº¿</li><li>ArtifactID:äº§å“çº¿å-æ¨¡å—å</li><li>Version:ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</li><li>Packaging:æ‰“åŒ…æ–¹å¼ï¼ŒJavaå·¥ç¨‹æ‰“jaråŒ…ï¼ŒWebå·¥ç¨‹æ‰“waråŒ…ï¼Œpomä»£è¡¨ä¸ä¼šæ‰“åŒ…ï¼Œç”¨æ¥åšç»§æ‰¿çš„çˆ¶å·¥ç¨‹</li></ul><p>åˆ›å»º Mavené¡¹ç›®æ—¶ï¼Œjdkç‰ˆæœ¬æœ€å¥½é€‰æ‹©jdk17ã€jdk21è¿™äº›é•¿æœŸç¨³å®šç‰ˆæœ¬ï¼Œä¸è¦ä½¿ç”¨æœ€æ–°ç‰ˆï¼Œå› ä¸ºå¾ˆå¤šæ’ä»¶éƒ½ä¸æ”¯æŒã€‚</p><p>Mavenä¸­çš„æµ‹è¯•ç±»ï¼Œç±»åå¿…é¡»ä»¥testç»“å°¾ï¼Œæµ‹è¯•æ–¹æ³•ä»¥testå¼€å¤´ï¼Œå¦åˆ™æ— æ³•è¢«è¯†åˆ«ã€‚</p><h1 id="ä¸åŒé˜¶æ®µ">ä¸åŒé˜¶æ®µ</h1><table><thead><tr><th>é˜¶æ®µï¼ˆLifecycleï¼‰</th><th>ä½œç”¨</th><th>å¸¸ç”¨å‘½ä»¤</th></tr></thead><tbody><tr><td>clean</td><td>æ¸…ç†ä¹‹å‰çš„æ„å»ºäº§ç‰©ï¼Œæ¯”å¦‚ <code>target/</code> ç›®å½•</td><td>mvn clean</td></tr><tr><td>validate</td><td>éªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ï¼Œå‡†å¤‡ç¼–è¯‘</td><td>mvn validate</td></tr><tr><td>compile</td><td>ç¼–è¯‘ä¸»ä»£ç ï¼ˆsrc/main/javaï¼‰</td><td>mvn compile</td></tr><tr><td>test</td><td>ç¼–è¯‘å¹¶è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆsrc/test/javaï¼‰</td><td>mvn test</td></tr><tr><td>package</td><td>æ‰“åŒ…æˆ jar/war æ–‡ä»¶ï¼Œè¾“å‡ºåˆ° target/</td><td>mvn package</td></tr><tr><td>verify</td><td>éªŒè¯æ‰“åŒ…ç»“æœï¼Œæ¯”å¦‚æ‰§è¡Œé›†æˆæµ‹è¯•</td><td>mvn verify</td></tr><tr><td>install</td><td>å®‰è£…åˆ°æœ¬åœ°ä»“åº“</td><td>mvn install</td></tr><tr><td>site</td><td>ç”Ÿæˆé¡¹ç›®æ–‡æ¡£ç½‘ç«™ï¼ˆé¡¹ç›®ä¾èµ–ã€æµ‹è¯•æŠ¥å‘Šç­‰ï¼‰</td><td>mvn site</td></tr><tr><td>deploy</td><td>éƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“ä¾›åˆ«äººä½¿ç”¨</td><td>mvn deploy</td></tr></tbody></table><p>æ‰‹åŠ¨å¼•å…¥ä¾èµ–çš„æ ¼å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="ä¾èµ–èŒƒå›´">ä¾èµ–èŒƒå›´</h1><p>åœ¨pomæ–‡ä»¶ä¸­ä½¿ç”¨<code>&lt;scope&gt;</code>æ ‡ç­¾ï¼Œè‹±è¯­æ§åˆ¶è¯¥ä¾èµ–èµ·ä½œç”¨çš„é˜¶æ®µã€‚ä¸€å…±æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œã€‚</p><ul><li>compile<ul><li>ç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œé˜¶æ®µéƒ½å¯ç”¨</li><li>é€‚ç”¨äºé¡¹ç›®æœ¬èº«éœ€è¦ç›´æ¥ä½¿ç”¨çš„åº“ï¼Œæ¯”å¦‚<code>Spring Boot</code>ã€<code>Lombok</code></li></ul></li><li>provided<ul><li>ç¼–è¯‘ã€æµ‹è¯•å¯ç”¨ï¼Œä½†æ˜¯è¿è¡Œä¸å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¢«æ‰“åŒ…</li><li>è¿è¡Œæ—¶ç”±æœåŠ¡å™¨ç­‰å¤–éƒ¨ç¯å¢ƒæä¾›ï¼Œå¦‚<code>Servlet API</code>å¯ä»¥ç”±<code>Tomcat</code>æä¾›ï¼Œå› æ­¤å±äºprovided èŒƒå›´</li></ul></li><li>runtime<ul><li>ä»…åœ¨è¿è¡Œå’Œæµ‹è¯•å¯ç”¨ï¼Œç¼–è¯‘ä¸å¯ç”¨</li><li>é€‚ç”¨äºè¿è¡Œæ—¶æ‰€éœ€è¦çš„åº“ï¼Œæ¯”å¦‚æ•°æ®åº“é©±åŠ¨ã€JDBC é€‚é…å™¨ç­‰ã€‚</li><li>ä»£ç ä¸­é€šå¸¸åªä½¿ç”¨æ¥å£ï¼ˆå¦‚<code>java.sql.Connection</code>ï¼‰ï¼Œç¼–è¯‘æ—¶æ— éœ€å…·ä½“çš„JDBC å®ç°ã€‚</li></ul></li><li>test<ul><li>ä»…åœ¨æµ‹è¯•å¯ç”¨ï¼Œä¾‹å¦‚ JUnit ç­‰æµ‹è¯•æ¡†æ¶</li></ul></li><li>system<ul><li>ç±»ä¼¼<code>provided</code>ï¼Œä½†æ˜¯éœ€è¦æœ¬åœ°æ‰‹åŠ¨æä¾›jaråŒ…ï¼Œä¸ä¼šä»Mavenä»“åº“ä¸‹è½½ï¼Œç›¸æ¯”ä¹‹ä¸‹ä¸å¦‚ä½¿ç”¨ç§æœ‰Maven ä»“åº“è¿›è¡Œç®¡ç†ã€‚ä¸æ¨èä½¿ç”¨</li></ul></li><li>import<ul><li>ä»…ç”¨äº<code>dependencyManagement</code>ä¾èµ–ç®¡ç†ï¼Œå¼•å…¥ä¸€ä¸ªå…·ä½“çš„POMä½œä¸ºä¾èµ–ç‰ˆæœ¬ç®¡ç†ã€‚ä¾‹å¦‚ï¼šå¼•å…¥Spring Boot BOM</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="ä¾èµ–ä¸‹è½½å¤±è´¥">ä¾èµ–ä¸‹è½½å¤±è´¥</h1><p>å¦‚æœå¼•å…¥ä¾èµ–åæ²¡æœ‰è”ç½‘ï¼Œä¾èµ–å°†ä¸‹è½½å¤±è´¥ï¼Œå³ä½¿å†æ¬¡è”ç½‘ä¹Ÿä¸ä¼šå¼€å§‹ä¸‹è½½ï¼Œå› ä¸ºæœ¬åœ°ä»“åº“ä¸­å·²ç»å­˜åœ¨äº†<code>.lastUpdated</code>åç¼€çš„æ–‡ä»¶ã€‚Mavenåªè¦æ£€æµ‹åˆ°è¿™ä¸ªæ–‡ä»¶å°±ä¸ä¼šå¼€å§‹ä¸‹è½½ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ã€‚</p><h1 id="buildæ ‡ç­¾">buildæ ‡ç­¾</h1><h2 id="æŒ‡å®šæ‰“åŒ…æ–‡ä»¶">æŒ‡å®šæ‰“åŒ…æ–‡ä»¶</h2><p><code>pom.xml</code>æ–‡ä»¶ä¸­çš„<code>&lt;build&gt;</code>ä¸»è¦ç”¨äºå¯¹æ„å»ºç›¸å…³çš„ä¿¡æ¯è¿›è¡Œé…ç½®ã€‚</p><div class="note note-primary">            <p>é¡¹ç›®æ„å»ºæ˜¯æŒ‡å°†æºä»£ç ã€ä¾èµ–åº“å’Œèµ„æºæ–‡ä»¶ç­‰è½¬æ¢æˆå¯æ‰§è¡Œæˆ–å¯éƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…æ‹¬ç¼–è¯‘æºä»£ç ã€é“¾æ¥ä¾èµ–åº“ã€æ‰“åŒ…å’Œéƒ¨ç½²ç­‰å¤šä¸ªæ­¥éª¤</p>          </div><p>å¦‚æœéœ€è¦åœ¨src/main/javaä¸­æ”¾å…¥éjavaæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚èƒ½å¤Ÿè¢«æ‰“åŒ…ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>      <span class="hljs-comment">&lt;!--è®¾ç½®èµ„æºæ‰€åœ¨ç›®å½•--&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--è®¾ç½®åŒ…å«çš„èµ„æºç±»å‹--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥å°†javaç›®å½•ä¸‹çš„ä»»æ„<code>.xml</code>æ–‡ä»¶æ‰“åŒ…ã€‚</p><h2 id="å¼•å…¥æ’ä»¶">å¼•å…¥æ’ä»¶</h2><p>ä½¿ç”¨æ ‡ç­¾<code>&lt;plugin&gt;</code></p><h1 id="ä¾èµ–ä¼ é€’å’Œä¾èµ–å†²çª">ä¾èµ–ä¼ é€’å’Œä¾èµ–å†²çª</h1><h2 id="ä¼ é€’">ä¼ é€’</h2><p>å¦‚æœAä¾èµ–Bï¼ŒBåˆä¾èµ–Cï¼Œé‚£ä¹ˆAä¹Ÿé—´æ¥ä¾èµ–Cï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œé¡¹ç›®Aæ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠå…¶ä»–ä¸¤ä¸ªé¡¹ç›®ä¸‹è½½å¯¼å…¥åˆ°jaråŒ…æ–‡ä»¶å¤¹ä¸­ã€‚è¿™å°±æ˜¯<strong>ä¾èµ–çš„ä¼ é€’æ€§</strong>ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œä¾èµ–èƒ½å¦æˆåŠŸä¼ é€’è¿˜å–å†³äºä¾èµ–èŒƒå›´ï¼š</p><ul><li><code>&lt;optional&gt;true&lt;/optional&gt;</code>æ‰‹åŠ¨ç»ˆæ­¢ä¾èµ–ä¼ é€’</li><li>écompileèŒƒå›´æ— æ³•è¿›è¡Œä¾èµ–ä¼ é€’</li><li>ä¾èµ–å†²çªï¼ˆä¼ é€’çš„ä¾èµ–å·²ç»å­˜åœ¨ï¼‰</li></ul><h2 id="å†²çª">å†²çª</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">é¡¹ç›®A -&gt; ä¾èµ–Bï¼ˆBä¾èµ–X:1.0ï¼‰<br>    â””â”€â”€&gt; ä¾èµ–Cï¼ˆDä¾èµ–X:2.0ï¼‰<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒBå’ŒCéƒ½ä¾èµ–äº†Xçš„ä¸åŒçš„ç‰ˆæœ¬ï¼Œå‡ºç°ä¾èµ–å†²çªã€‚Mavençš„è‡ªåŠ¨é€‰æ‹©åŸåˆ™å¦‚ä¸‹ï¼š</p><ul><li>çŸ­è·¯ä¼˜å…ˆï¼ˆè·¯å¾„æœ€çŸ­ä¼˜å…ˆï¼‰å“ªä¸ªè¿‘ç”¨å“ªä¸ª</li><li>è·¯å¾„é•¿åº¦ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå£°æ˜ä¼˜å…ˆï¼Œåœ¨<code>&lt;dependencies&gt;</code>ä¸­å…ˆå£°æ˜çš„è¢«ä½¿ç”¨</li></ul><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">A</span><br>â”œâ”€â”€ <span class="hljs-variable">B</span><br>â”‚    â””â”€â”€ <span class="hljs-built_in">C</span><span class="hljs-operator">:</span><span class="hljs-number">1.0</span><br>â””â”€â”€ <span class="hljs-built_in">D</span><br>     â””â”€â”€ <span class="hljs-built_in">C</span><span class="hljs-operator">:</span><span class="hljs-number">2.0</span><br></code></pre></td></tr></table></figure><p>å¦‚æœBåœ¨Då£°æ˜ä¹‹å‰ï¼Œåˆ™ä½¿ç”¨C1.0ã€‚</p><p>ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ’é™¤ä¾èµ–å†²çªï¼š<code>&lt;exclusions&gt;</code></p><h1 id="å·¥ç¨‹ç»§æ‰¿">å·¥ç¨‹ç»§æ‰¿</h1><p>Maven å·¥ç¨‹ç»§æ‰¿æŒ‡çš„æ˜¯åœ¨ Mavené¡¹ç›®ä¸­è®©ä¸€ä¸ªé¡¹ç›®ä»å¦ä¸€ä¸ªé¡¹ç›®ç»§æ‰¿é…ç½®ä¿¡æ¯çš„æœºåˆ¶ã€‚ç»§æ‰¿å¯ä»¥è®©æˆ‘ä»¬åœ¨å¤šä¸ªé¡¹ç›®ä¸­å…±äº«åŒä¸€é…ç½®ä¿¡æ¯ï¼Œç®€åŒ–é¡¹ç›®çš„ç®¡ç†å’Œç»´æŠ¤å·¥ä½œã€‚</p><ul><li>å¯¹ä¸€ä¸ªå¤§å‹çš„é¡¹ç›®è¿›è¡Œäº†æ¨¡å—çš„æ‹†åˆ†</li><li>æ¯ä¸ªé¡¹ç›®ä¸‹é¢åˆå¾ˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸€ä¸ªæ¨¡å—éƒ½éœ€è¦é…ç½®è‡ªå·±çš„ä¾èµ–ä¿¡æ¯ã€‚</li></ul><p>çˆ¶å·¥ç¨‹ä¸»è¦ç”¨æ¥åšä¾èµ–çš„ç®¡ç†æˆ–é…ç½®ä¿¡æ¯çš„ç®¡ç†ï¼Œä¸éœ€è¦å†™æºä»£ç ï¼Œç¼–è¯‘æ—¶çˆ¶å·¥ç¨‹ä¸­çš„ç±»ä¸ä¼šè¢«æ‰“åŒ…ã€‚å¯¹çˆ¶å·¥ç¨‹è¿›è¡Œçš„æ¸…ç†ã€ç¼–è¯‘ç­‰æ“ä½œä¹Ÿä¼šåŒæ­¥è¿›è¡Œåˆ°å­å·¥ç¨‹ä¸­ï¼Œå¯ä»¥ä¸€é”®ç®¡ç†ã€‚</p><p>å­å·¥ç¨‹åº”å½“åœ¨çˆ¶å·¥ç¨‹ç›®å½•ä¸‹è¢«åˆ›å»ºï¼Œå­å·¥ç¨‹çš„é…ç½®æ–‡ä»¶ä¸­ä¼šå‡ºç°</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven_java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¡¨æ˜äº†çˆ¶å·¥ç¨‹çš„åæ ‡ã€‚å­å·¥ç¨‹çš„GroupIdå’Œçˆ¶å·¥ç¨‹è‡ªåŠ¨ä¿æŒä¸€è‡´ã€‚</p><p>çˆ¶å·¥ç¨‹çš„<code>&lt;dependencies&gt;</code>ä¼š<strong>æ— æ¡ä»¶</strong>åœ°è¢«å­å·¥ç¨‹ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨<code>&lt;properties&gt;</code>çš„ä¸‹é¢åŠ ä¸Š<code>&lt;dependencyManagement&gt;</code>ï¼Œç„¶ååœ¨è¿™ä¸ªæ ‡ç­¾å†…éƒ¨å£°æ˜ä¾èµ–ï¼Œè¿™æ ·å­å·¥ç¨‹ä¸ä¼šé»˜è®¤ç»§æ‰¿å®ƒã€‚å¦‚æœéœ€è¦ç»§æ‰¿ï¼Œåœ¨å­å·¥ç¨‹çš„é…ç½®æ–‡ä»¶ä¸­åªéœ€è¦å¤åˆ¶groupIdå’ŒartifactIdå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä¸ç”¨å†™ç‰ˆæœ¬å·ã€‚</p><h1 id="å·¥ç¨‹èšåˆ">å·¥ç¨‹èšåˆ</h1><p>èšåˆæ˜¯æŒ‡<strong>å°†å¤šä¸ªé¡¹ç›®ç»„ç»‡åˆ°ä¸€ä¸ªçˆ¶çº§é¡¹ç›®ä¸­</strong>ï¼Œä»¥ä¾¿ä¸€èµ·æ„å»ºå’Œç®¡ç†çš„æœºåˆ¶ã€‚èšåˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†ä¸€ç»„ç›¸å…³çš„å­é¡¹ç›®ï¼ŒåŒæ—¶ç®€åŒ–å®ƒä»¬çš„æ„å»ºå’Œéƒ¨ç½²çš„è¿‡ç¨‹ã€‚</p><p>ç›®æ ‡ï¼š<strong>ä¸€é”®æ“ä½œã€ä¸€é”®æ„å»º</strong>ã€‚</p><p>è¯­æ³•ï¼šåœ¨GAVPä¹‹ååŠ å…¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>å­å·¥ç¨‹çš„ç›¸å¯¹è·¯å¾„<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœå­å·¥ç¨‹å°±åœ¨çˆ¶å·¥ç¨‹çš„ç›®å½•ä¸‹ï¼Œå¯ä»¥ç›´æ¥å†™<code>maven_son</code></p><h1 id="maven-ç§æœ">Maven ç§æœ</h1><h2 id="ç®€ä»‹">ç®€ä»‹</h2><p>Mavenç§æœæ˜¯ä¸€ç§ç‰¹æ®Šçš„Mavenè¿œç¨‹ä»“åº“ï¼Œå®ƒæ˜¯æ¶è®¾åœ¨<strong>å±€åŸŸç½‘</strong>å†…çš„ä»“åº“æœåŠ¡ï¼Œç”¨æ¥ä»£ç†ä½äºå¤–éƒ¨çš„è¿œç¨‹ä»“åº“ã€‚</p><blockquote><p>å½“ç„¶å¹¶ä¸æ˜¯è¯´ç§æœåªèƒ½å»ºç«‹åœ¨å±€åŸŸç½‘ï¼Œå¾ˆå¤šå…¬å¸ä¼šæŠŠç§æœç›´æ¥éƒ¨ç½²åˆ°å…¬ç½‘ï¼Œæ–¹ä¾¿å‘˜å·¥å±…å®¶åŠå…¬ã€‚</p></blockquote><p>å»ºç«‹äº†Mavenç§æœåï¼Œå½“å±€åŸŸç½‘å†…çš„ç”¨æˆ·éœ€è¦æŸä¸ªæ„å»ºæ—¶ï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºè¿›è¡Œè¯·æ±‚å’Œä¸‹è½½ï¼š</p><ol type="1"><li>è¯·æ±‚æœ¬åœ°ä»“åº“ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸‹ä¸€æ­¥</li><li>è¯·æ±‚Mavenç§æœï¼Œå°†æ‰€éœ€æ„ä»¶ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¸‹ä¸€æ­¥</li><li>è¯·æ±‚å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ï¼Œå°†æ‰€éœ€æ„ä»¶ä¸‹è½½å¹¶ç¼“å­˜åˆ°ç§æœï¼Œè‹¥ä¸å­˜åœ¨åˆ™æŠ¥é”™</li></ol><p>Mavenç”¨æˆ·æ—¢å¯ä»¥ä»ç§æœä¸‹è½½æ„ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ æ„ä»¶ã€‚</p><p><strong>ç§æœçš„ä¼˜åŠ¿</strong>ï¼šé™ä½å¤–ç½‘å¸¦å®½å‹åŠ›ï¼›ä¸‹è½½é€Ÿåº¦æ›´å¿«ï¼›ä¾¿äºéƒ¨ç½²ç¬¬ä¸‰æ–¹æ„ä»¶ï¼ˆæœ‰äº›æ„ä»¶æ— æ³•ä»ç¬¬ä¸‰æ–¹ä»“åº“è·å¾—ï¼‰ï¼›æé«˜é¡¹ç›®çš„ç¨³å®šæ€§ï¼Œå¢å¼ºå¯¹é¡¹ç›®çš„æ§åˆ¶ã€‚</p><h2 id="sonatype-nexus">Sonatype Nexus</h2><p>ä½¿ç”¨æœ€å¹¿æ³›çš„ Maven ç§æœäº§å“æ˜¯<strong>Nexus</strong>ã€‚Nexus RepositoryManagerï¼ˆé€šå¸¸ç®€ç§° Nexusï¼‰æ˜¯ç”±ä¸€å®¶å« Sonatypeçš„å…¬å¸å¼€å‘çš„ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Maven ä»“åº“ç®¡ç†å™¨ã€‚</p><blockquote><p>Sonatype Nexus Repositoryæ˜¯ä¸€æ¬¾è½¯ä»¶ä»“åº“ç®¡ç†å™¨ï¼Œæ—¢æœ‰å¼€æºè®¸å¯ç‰ˆæœ¬ï¼Œä¹Ÿæœ‰å•†ä¸šè®¸å¯ç‰ˆæœ¬ã€‚å®ƒèƒ½å¤Ÿå°†å¤šç§ç¼–ç¨‹è¯­è¨€çš„ä»“åº“æ•´åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡ä¸€ä¸ªæœåŠ¡å™¨ä½œä¸ºæ„å»ºè½¯ä»¶æ—¶çš„ç»Ÿä¸€æ¥æºã€‚å¼€æºç‰ˆä½¿ç”¨çš„æ˜¯H2 æ•°æ®åº“ã€‚<br />TamÃ¡s CservenÃ¡k æœ€åˆåœ¨ 2005å¹´ å¼€å‘äº†Proximityï¼ŒåŸå› æ˜¯ä»–å½“æ—¶ä½¿ç”¨çš„æ˜¯è¾ƒæ…¢çš„ ADSLäº’è”ç½‘è¿æ¥ã€‚ åæ¥ï¼Œä»–è¢«Sonatype å…¬å¸è˜è¯·ï¼Œå¼€å‘äº†ä¸€ä¸ªç±»ä¼¼çš„äº§å“ï¼Œå³Nexusã€‚<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://en.wikipedia.org/wiki/Sonatype_Nexus_Repository">[2]</span></a></sup></p></blockquote><p>å®‰è£…è¿‡ç¨‹æ¯”è¾ƒçƒ¦äººï¼Œå…ˆè¿›å…¥https://www.sonatype.com/nexus-repository-osså¡«å†™ä¿¡æ¯ä¸‹è½½ï¼Œä¸‹è½½å¥½ä¹‹åè§£å‹ã€‚</p><p>æŒ‰ç…§ç½‘ä¸Šçš„æ–¹æ³•è¿›å…¥binç›®å½•è¾“å…¥<code>nexus.exe /run</code>ï¼ŒæŠ¥é”™ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">E:\nexus-<span class="hljs-number">3.79</span>.<span class="hljs-number">1</span>-<span class="hljs-number">04</span>-win-x86_64\nexus-<span class="hljs-number">3.79</span>.<span class="hljs-number">1</span>-<span class="hljs-number">04</span>\bin&gt;nexus<span class="hljs-selector-class">.exe</span> /run<br><span class="hljs-selector-attr">[2025-04-28 15:40:49]</span> <span class="hljs-selector-attr">[error]</span> <span class="hljs-selector-attr">[ 1048]</span> Unrecognized cmd <span class="hljs-selector-tag">option</span> /run<br><span class="hljs-selector-attr">[2025-04-28 15:40:49]</span> <span class="hljs-selector-attr">[error]</span> <span class="hljs-selector-attr">[ 1048]</span> Invalid command <span class="hljs-selector-tag">line</span> arguments.<br><span class="hljs-selector-attr">[2025-04-28 15:40:49]</span> <span class="hljs-selector-attr">[error]</span> <span class="hljs-selector-attr">[ 1048]</span> Apache Commons Daemon procrun failed with exit value: <span class="hljs-number">1</span> (failed to parse command <span class="hljs-selector-tag">line</span> arguments).<br></code></pre></td></tr></table></figure><p>è¯´æ˜ç½‘ä¸Šçš„æ–¹æ³•å¤±æ•ˆäº†ã€‚å†çœ‹ä¸€çœ¼è§£å‹åçš„ç›®å½•</p><p><img src="https://s21.ax1x.com/2025/04/28/pE7iUJ0.png" /></p><p>çœ‹çœ‹ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>å—¯ï¼Ÿæœ‰ç‚¹æ€ªï¼Œè¿™ä¸æ˜¯å®‰è£…è„šæœ¬å˜›ã€‚å†ç¿»ç¿»å®˜æ–¹æ–‡æ¡£<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><spanclass="hint--top hint--rounded"aria-label="https://help.sonatype.com/en/sonatype-nexus-repository.html">[3]</span></a></sup></p><p><img src="https://s21.ax1x.com/2025/04/28/pE7AuJ1.png" /></p><div class="note note-primary">            <p>Nexus Repository åœ¨ 3.78.0 ç‰ˆæœ¬è¿›è¡Œäº†å¤§é‡æ„å»ºæ–¹å¼çš„æ›´æ”¹ã€‚ 3.78.0åŠä»¥åç‰ˆæœ¬ä½¿ç”¨äº†ä¸Šé¢åˆ—å‡ºçš„ //ES//ã€//SS//ã€//DS// è¿™ç§æ–°æ ¼å¼ã€‚</p>          </div><p>æ€»ä¹‹å¾ˆæŠ˜è…¾ï¼Œä¸å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œæœ€å¥½ä½¿ç”¨3.78.0ä¹‹å‰çš„ã€‚</p><p>ä»è¿™ä¸ªé“¾æ¥ä¸‹è½½å†å²ç‰ˆæœ¬ï¼šhttps://help.sonatype.com/en/download-archives---repository-manager-3.html</p><p>ä¸‹è½½ä¹‹å‰è®°å¾—çœ‹ä¸€ä¸‹è‡ªå·±çš„ç”µè„‘ä¸Šæœ‰æ²¡æœ‰å¯¹åº”çš„jdkç‰ˆæœ¬ã€‚</p><p>æˆåŠŸå¯åŠ¨ä¹‹åé€šè¿‡localhost:8081è®¿é—®ã€‚</p><p>åç»­åˆ©ç”¨Nexusæ­å»ºç§æœå’ŒMavenè”åŠ¨çš„å†…å®¹åˆ°äº†åæœŸæ‰ä¼šç”¨åˆ°ï¼Œè¿™é‡Œå…ˆæ­‡ä¸€æ­‡ã€‚</p><p>æ”¾å‡ ä¸ªå‚è€ƒé“¾æ¥ã€‚ä»¥åå†æ¥çœ‹ï¼š</p><p>https://www.easyblog.vip/detail/58</p><p>https://www.bilibili.com/video/BV1854y1F7Lt/?spm_id_from=333.337.search-card.all.click&amp;vd_source=918a6909c997fbaf818d1fbc55d65ca9</p><p>https://wiki.eryajf.net/pages/1815.html#_1-%E5%88%9B%E5%BB%BA-blob-%E5%AD%98%E5%82%A8%E3%80%82</p><p>https://www.hangge.com/blog/cache/detail_2844.html</p><h1 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1"class="footnote-text"><span>https://zh.wikipedia.org/wiki/Apache_Maven<a href="#fnref:1" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:2"class="footnote-text"><span>https://en.wikipedia.org/wiki/Sonatype_Nexus_Repository<a href="#fnref:2" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li><li><span id="fn:3"class="footnote-text"><span>https://help.sonatype.com/en/sonatype-nexus-repository.html<a href="#fnref:3" rev="footnote" class="footnote-backref">â†©ï¸</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Web Development</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo Fluid èƒŒæ™¯å›¾éšæ—¥å¤œæ¨¡å¼åˆ‡æ¢</title>
    <link href="/2025/04/26/%E7%99%BD%E5%A4%A9%E9%BB%91%E5%A4%9C%E8%83%8C%E6%99%AF%E5%9B%BE%E5%88%87%E6%8D%A2/"/>
    <url>/2025/04/26/%E7%99%BD%E5%A4%A9%E9%BB%91%E5%A4%9C%E8%83%8C%E6%99%AF%E5%9B%BE%E5%88%87%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<p>2025/5/24 è¡¥å……ï¼š</p><p>å…³äºè¿™é¡¹åŠŸèƒ½çš„å®ç°ï¼Œ<ahref="https://4rozen.github.io/archives/Hexo/60191.html">è¿™ç¯‡åšå®¢</a>æä¾›äº†æ›´å¥½çš„å®ç°æ€è·¯ï¼Œå¦‚æœä½ æƒ³å®ç°è¯¥åŠŸèƒ½çš„è¯æ¨èä¼˜å…ˆå‚è€ƒè¿™ä¸ªã€‚</p><p>æœ¬æ–‡æä¾›çš„æ˜¯ä¸€ç§æ¯”è¾ƒç®€é™‹çš„å®ç°æ–¹å¼ï¼Œå› ä¸ºæ²¡æœ‰é…ç½®é¢„åŠ è½½åŠŸèƒ½æ‰€ä»¥ç¬¬ä¸€æ¬¡åˆ‡æ¢èƒŒæ™¯æ—¶ä¼šçœ‹åˆ°æ˜æ˜¾çš„é—ªå±ã€‚</p><h1 id="è·å–å½“å‰æ¨¡å¼">1. è·å–å½“å‰æ¨¡å¼</h1><p>è¦è§£å†³çš„ç¬¬ä¸€ä»¶äº‹æ˜¯è·å–å½“å‰é¡µé¢é‡‡ç”¨çš„æ¨¡å¼ã€‚</p><p>æŒ‰F12æ‰“å¼€æ§åˆ¶å°ï¼Œå¾ˆå®¹æ˜“å‘ç°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-link&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_self&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:;&quot;</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;Color Toggle&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont icon-dark&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;color-toggle-icon&quot;</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&quot;light&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li><code>class="iconfont icon-dark"</code>æŒ‡çš„æ˜¯å½“å‰æ˜¾ç¤ºçš„æŒ‰é’®å›¾æ ‡ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨ä¸Šæ–¹æ—¶å°±ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„ä¸æ˜¯è¿™ä¸ª</li><li><code>id="color-toggle-icon"</code>å¯ä»¥é€šè¿‡å”¯ä¸€idè·å–è¿™ä¸ªå¯¹è±¡</li><li><code>data="light"</code>è®°å½•çš„æ˜¯å½“å‰æ‰€åœ¨çš„æ¨¡å¼ï¼Œæ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„</li></ul><p>å› æ­¤ï¼Œè¦è·å–å½“å‰çš„æ¨¡å¼ï¼Œåªéœ€è¦åœ¨è‡ªå®šä¹‰jsæ–‡ä»¶<code>backgroundize.js</code>ä¸­å†™å…¥ä»¥ä¸‹ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#color-toggle-btn&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<br>    <span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> dataValue = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;color-toggle-icon&#x27;</span>).<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;data&#x27;</span>); <span class="hljs-comment">// è·å–dataå±æ€§</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;dataå±æ€§å€¼æ˜¯ï¼š&#x27;</span>, dataValue);<br>    &#125;<br>)<br></code></pre></td></tr></table></figure><p>æ‰“å¼€æ§åˆ¶å°çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="https://s21.ax1x.com/2025/04/26/pETiPpT.png" /></p><p>å‘ç°è·å–çš„dataå€¼å’Œå½“å‰é¡µé¢çš„å®é™…æ¨¡å¼åˆšå¥½ç›¸åï¼Œè¿™ä¸ªé—®é¢˜ä¸å¤§ï¼Œæ¯”è¾ƒçƒ¦äººçš„æ˜¯æ¯ä¸€æ¬¡ç‚¹å‡»æŒ‰é’®æ§åˆ¶å°éƒ½ä¼šæ‰“å°å‡ºä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„å€¼ã€‚é€šè¿‡æ£€æŸ¥æŒ‰é’®çš„å±æ€§ï¼Œå‘ç°è¿™ä¸ªclickäº‹ä»¶è¢«<strong>é‡å¤ç»‘å®š</strong>ä¸¤æ¬¡ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šå®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ä½œä¸ºæ ‡è®°ï¼Œåˆå§‹å€¼ä¸º<code>undefined</code>ï¼Œç»‘å®šä¸€æ¬¡ä¹‹åèµ‹å€¼ä¸º<code>true</code>ï¼Œå› æ­¤ä»¥åä¸ä¼šé‡å¤ç»‘å®šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ç›‘å¬ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentMode</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;color-toggle-icon&#x27;</span>).<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;data&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">_colorToggleInitialized</span>) &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleColorToggle</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getCurrentMode</span>());<br>    &#125;<br><br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#color-toggle-btn&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, handleColorToggle);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">_colorToggleInitialized</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ ‡è®°ä¸ºå·²åˆå§‹åŒ–</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„æ•ˆæœï¼š</p><figure><img src="https://s21.ax1x.com/2025/04/26/pETibU1.png"alt="backgroundize.jsåªè¢«ç»‘å®šä¸€æ¬¡" /><figcaption aria-hidden="true">backgroundize.jsåªè¢«ç»‘å®šä¸€æ¬¡</figcaption></figure><p>å¯ä»¥çœ‹å‡ºéç”¨æˆ·è‡ªå®šä¹‰çš„æ–‡ä»¶ä¹Ÿæœ‰è¢«é‡å¤ç»‘å®šçš„æƒ…å†µï¼ŒåŸå› æš‚æ—¶ä¸å¤ªæ¸…æ¥šã€‚</p><h1 id="æ›¿æ¢èƒŒæ™¯å›¾">2. æ›¿æ¢èƒŒæ™¯å›¾</h1><p>æ–‡ç« é¡µçš„èƒŒæ™¯å›¾ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;web_bg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-image: url(<span class="hljs-symbol">&amp;quot;</span>/img/girl.webp<span class="hljs-symbol">&amp;quot;</span>);position: fixed;width: 100%;height: 100%;z-index: -1;background-size: cover;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¦–é¡µçš„èƒŒæ™¯å›¾ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;web_bg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-image: url(<span class="hljs-symbol">&amp;quot;</span>/img/miku.webp<span class="hljs-symbol">&amp;quot;</span>);position: fixed;width: 100%;height: 100%;z-index: -1;background-size: cover;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ä»…ä»htmlä¸Šå·²ç»æ— æ³•åŒºåˆ†è¿™ä¸¤å¼ å›¾ç‰‡ï¼Œè€Œæˆ‘çš„ç›®æ ‡æ˜¯åªåœ¨æ–‡ç« é¡µçš„æ—¶å€™å¯ç”¨åˆ‡æ¢ã€‚æ³¨æ„åˆ°æ–‡ç« é¡µå’Œé¦–é¡µçš„<code>&lt;head&gt;</code>æ ‡ç­¾</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;og:type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;article&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;og:type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;website&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥ä»è¿™é‡Œä¸‹æ‰‹è¿›è¡ŒåŒºåˆ†ã€‚å®Œæ•´çš„jsä»£ç å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">_colorToggleInitialized</span>) &#123;<br><br>    <span class="hljs-comment">//ä¸ºç‚¹å‡»äº‹ä»¶ç»‘å®šåˆ‡æ¢èƒŒæ™¯çš„åŠŸèƒ½</span><br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#color-toggle-btn&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, setBackgroundImage);<br><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">_colorToggleInitialized</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ ‡è®°ä¸ºå·²åˆå§‹åŒ–</span><br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·å–å½“å‰æ—¥/å¤œæ¨¡å¼</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> light:å¤œï¼Œdark:æ—¥ï¼ˆåˆšå¥½åè¿‡æ¥ï¼‰</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentMode</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;color-toggle-icon&#x27;</span>).<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;data&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¾ç½®èƒŒæ™¯å›¾ç‰‡</span><br><span class="hljs-comment"> * é€šè¿‡Open Graph metaåˆ¤æ–­å½“å‰é¡µé¢æ˜¯ä¸æ˜¯æ–‡ç« é¡µ</span><br><span class="hljs-comment"> * å¦‚æœæ˜¯ï¼Œåˆ™æ ¹æ®å½“å‰çš„æ¨¡å¼æ›¿æ¢èƒŒæ™¯å›¾ç‰‡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">setBackgroundImage</span>(<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-keyword">const</span> ogTypeMeta = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;meta[property=&quot;og:type&quot;]&#x27;</span>);<br>    <span class="hljs-keyword">const</span> isPost = ogTypeMeta &amp;&amp; ogTypeMeta.<span class="hljs-property">content</span> === <span class="hljs-string">&#x27;article&#x27;</span>;<br><br>    <span class="hljs-keyword">if</span> (isPost) &#123;<br>        <span class="hljs-keyword">const</span> bgDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;web_bg&#x27;</span>);<br><br>        <span class="hljs-keyword">if</span> (bgDiv) &#123;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getCurrentMode</span>() === <span class="hljs-string">&#x27;light&#x27;</span>) bgDiv.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundImage</span> = <span class="hljs-string">&#x27;url(&quot;/img/night.webp&quot;)&#x27;</span>;<br><br>            <span class="hljs-keyword">else</span> bgDiv.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundImage</span> = <span class="hljs-string">&#x27;url(&quot;/img/girl.webp&quot;)&#x27;</span>;<br><br>            <span class="hljs-comment">//console.log(&quot;æˆåŠŸæ›¿æ¢&quot;);</span><br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸Šé¢çš„ä»£ç åªæœ‰å½“ç‚¹å‡»æ—¥å¤œåˆ‡æ¢æŒ‰é’®æ—¶æ‰ç”Ÿæ•ˆã€‚</span><br><span class="hljs-comment"> * å¦‚æœåœ¨é¦–é¡µå°±åˆ‡æ¢ä¸ºé»‘å¤œæ¨¡å¼ï¼Œè¿›å…¥æ–‡ç« é¡µåä¼šå‘ç°èƒŒæ™¯ä»ç„¶æ˜¯ç™½è‰²çš„</span><br><span class="hljs-comment"> * æ‰€ä»¥è¿™é‡Œåˆ©ç”¨DOMContentLoadedäº‹ä»¶ï¼Œæ¯å½“ä¸€ä¸ªé¡µé¢çš„HTMLç»“æ„åŠ è½½å®Œæˆæ—¶åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ç« é¡µï¼Œæ˜¯çš„è¯å°±æ ¹æ®æ¨¡å¼æ›¿æ¢èƒŒæ™¯</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// é€šè¿‡ Open Graph åè®®åˆ¤æ–­</span><br>    <span class="hljs-keyword">const</span> ogTypeMeta = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;meta[property=&quot;og:type&quot;]&#x27;</span>);<br>    <span class="hljs-keyword">const</span> isPost = ogTypeMeta &amp;&amp; ogTypeMeta.<span class="hljs-property">content</span> === <span class="hljs-string">&#x27;article&#x27;</span>;<br><br>    <span class="hljs-keyword">if</span> (isPost) &#123; <span class="hljs-comment">// åˆ¤æ–­è¿›å…¥æ–‡ç« é¡µ</span><br><br>        <span class="hljs-keyword">const</span> bgDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;web_bg&#x27;</span>);<br><br>        <span class="hljs-keyword">if</span> (bgDiv) &#123;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getCurrentMode</span>() === <span class="hljs-string">&#x27;light&#x27;</span>) bgDiv.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundImage</span> = <span class="hljs-string">&#x27;url(&quot;/img/night.webp&quot;)&#x27;</span>;<br><br>            <span class="hljs-keyword">else</span> bgDiv.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundImage</span> = <span class="hljs-string">&#x27;url(&quot;/img/girl.webp&quot;)&#x27;</span>;<br><br>            <span class="hljs-comment">//console.log(&quot;æˆåŠŸæ›¿æ¢&quot;);</span><br>        &#125;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åå†åŠ å…¥cssä»£ç </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* æ˜æš—åˆ‡æ¢ */</span><br><span class="hljs-selector-id">#web_bg</span> &#123;<br>    <span class="hljs-attribute">transition</span>: background-image <span class="hljs-number">0.5s</span> ease-in-out <span class="hljs-meta">!important</span>;<br>&#125;<br><br><span class="hljs-comment">/* ç”±é»‘å¤œåˆ‡æ¢ä¸ºç™½å¤©çš„æ—¶é—´ä¼šé•¿ä¸€ç‚¹ */</span><br><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme</span>: dark) &#123;<br>    <span class="hljs-selector-id">#web_bg</span> &#123;<br>        <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">0.8s</span> <span class="hljs-meta">!important</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œé‡‡ç”¨çš„é€»è¾‘æ˜¯åªæœ‰æ£€æµ‹åˆ°åŠ è½½çš„é¡µé¢æ˜¯æ–‡ç« é¡µæ—¶æ‰æ‰§è¡ŒåŒ—äº¬æ›¿æ¢çš„é€»è¾‘ï¼Œæ‰€ä»¥ä½¿ç”¨äº†ä¸¤å¤„æ›¿æ¢èƒŒæ™¯çš„åŠŸèƒ½ï¼šåˆæ¬¡åŠ è½½é¡µé¢æ—¶ã€æŒ‰ä¸‹æ—¥å¤œåˆ‡æ¢æŒ‰é’®æ—¶ã€‚</p><h1 id="é—ç•™é—®é¢˜">é—ç•™é—®é¢˜</h1><p>ä¸Šé¢çš„å®ç°æ–¹å¼æœ‰ä¸€ä¸ªç¼ºé™·ï¼šåˆšè¿›å…¥æ–‡ç« é¡µæ—¶æœ‰æ¦‚ç‡å…ˆæ˜¾ç¤ºå‡º<code>config.fluid.yml</code>ä¸­é…ç½®çš„åŸèƒŒæ™¯å›¾ï¼Œå†æ¸å˜è½¬æ¢æˆé¢„æœŸçš„èƒŒæ™¯å›¾ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒçªå…€ã€‚å› ä¸ºæˆ‘ä¹‹å‰é…ç½®è¿‡é¢„åŠ è½½åŠŸèƒ½ï¼Œæ‰€ä»¥å¹²è„†ç›´æ¥æŠŠåŸèƒŒæ™¯å›¾æ¢æˆå’ŒåŠ è½½é¡µé¢ç›¸åŒåº•è‰²çš„å›¾äº†ã€‚</p><p>å¦å¤–ï¼Œåœ¨æ–‡ç« é¡µå†…ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¥å¤œåˆ‡æ¢æŒ‰é’®æ—¶ï¼Œå› ä¸ºèƒŒæ™¯å›¾åªæœ‰åœ¨éœ€è¦å®ƒçš„æ—¶å€™æ‰ä¼šå¼€å§‹åŠ è½½ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡èƒŒæ™¯ä¼šé—ªçƒä¸€ä¸‹ç„¶åçªç„¶å‡ºç°èƒŒæ™¯å›¾ï¼Œåç»­å†æ¬¡åˆ‡æ¢æ¨¡å¼çš„æ—¶å€™æ‰ä¼šæ­£å¸¸ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜å°±è¦ä½¿ç”¨é¢„åŠ è½½ï¼Œæå‰åŠ è½½èƒŒæ™¯å›¾ç‰‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Theme</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JSåŸºç¡€</title>
    <link href="/2025/04/23/JS%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/04/23/JS%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>JSåŸºç¡€çŸ¥è¯†ï¼Œå…ˆé€Ÿé€šä¸€éï¼Œä»¥åå†æ…¢æ…¢è¡¥å……ç»†èŠ‚</p><span id="more"></span><h1 id="å¼•å…¥æ–¹å¼">å¼•å…¥æ–¹å¼</h1><h2 id="å†…éƒ¨è„šæœ¬">å†…éƒ¨è„šæœ¬</h2><p>å°†JSä»£ç å®šä¹‰åœ¨HTMLä¸­ã€‚å¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ”¾ç½®ä»»æ„æ•°é‡çš„jsï¼Œä½†æ˜¯ä¸€èˆ¬ä¼šæŠŠè„šæœ¬ä½äº<code>&lt;body&gt;</code>å…ƒç´ çš„åº•éƒ¨ï¼Œå¯ä»¥æ”¹å–„æ˜¾ç¤ºé€Ÿåº¦ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Hello JavaScript&quot;</span>)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="å¤–éƒ¨è„šæœ¬">å¤–éƒ¨è„šæœ¬</h2><p>å®šä¹‰åœ¨å¤–éƒ¨jsæ–‡ä»¶ä¸­ï¼ŒHTMLæ–‡æ¡£é€šè¿‡ä»¥ä¸‹æ ¼å¼å¼•ç”¨ï¼Œä¸èƒ½è‡ªé—­åˆã€‚å¤–éƒ¨jsæ–‡ä»¶ä¸éœ€è¦<code>&lt;script&gt;</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/demo.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</h1><ul><li>æ¯è¡Œç»“å°¾çš„åˆ†å·å¯æœ‰å¯æ— ï¼ˆä½†æ˜¯å»ºè®®åŠ ä¸Šï¼‰</li><li>è¾“å‡ºè¯­å¥<ul><li><code>window.alert()</code>å¼¹å‡ºçª—å£ï¼ˆ/É™ËˆlÉœËrt/ æ„æ€æ˜¯è­¦ç¤ºï¼‰</li><li><code>document.write()</code>å†™å…¥HTMLæ–‡æ¡£ï¼ˆå¼€å‘å¾ˆå°‘ç”¨ï¼‰</li><li><code>console.log()</code>è¾“å‡ºåˆ°æ§åˆ¶å°</li></ul></li></ul><h1 id="å˜é‡">å˜é‡</h1><p>åœ¨ JavaScript ä¸­å®šä¹‰å˜é‡çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯</p><ol type="1"><li><code>let</code>ï¼ˆæ¨èï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> name = <span class="hljs-string">&quot;åˆéŸ³ãƒŸã‚¯&quot;</span>;<br></code></pre></td></tr></table></figure><ul><li><code>let</code>å®šä¹‰çš„æ˜¯å¯ä»¥<strong>æ›´æ”¹å€¼</strong>çš„å˜é‡</li><li>ä»£ç å—å†…æœ‰æ•ˆ</li></ul><ol start="2" type="1"><li><code>const</code>ï¼ˆæ¨èï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14159</span>;<br></code></pre></td></tr></table></figure><ul><li><code>const</code>å®šä¹‰çš„æ˜¯<strong>å¸¸é‡</strong>ï¼Œ<strong>ä¸èƒ½é‡æ–°èµ‹å€¼</strong></li><li>ä¸€æ—¦èµ‹å€¼å°±ä¸èƒ½æ”¹å˜</li><li>ä»£ç å—å†…æœ‰æ•ˆ</li></ul><ol start="3" type="1"><li><code>var</code>âš ï¸ï¼ˆä¸æ¨èï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> age = <span class="hljs-number">16</span>;<br></code></pre></td></tr></table></figure><ul><li>æ—§è¯­æ³•ï¼ˆES5ä¹‹å‰ï¼‰ï¼Œå†™è€ä»£ç ã€æˆ–è€…å…¼å®¹æ—§æµè§ˆå™¨æ‰ç”¨</li><li>å…è®¸ä¿®æ”¹</li><li>å˜é‡ä¼šæå‡ï¼ˆhoistingï¼‰ï¼Œä¸”æ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œå®¹æ˜“å‡º bug</li><li>å‡ºä»£ç å—è¿˜å¯ä»¥è®¿é—®ï¼Œå±äºå…¨å±€å˜é‡</li><li>å¯ä»¥é‡å¤å®šä¹‰ï¼Œå‰ä¸¤ä¸ªéƒ½ä¸è¡Œã€‚ä¾‹å¦‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>    <span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">var</span> x = <span class="hljs-string">&#x27;A&#x27;</span>;<br>&#125;<br><span class="hljs-title function_">alert</span>(x);<br></code></pre></td></tr></table></figure><p>ä¸æŠ¥é”™ã€‚</p><h1 id="æ•°æ®ç±»å‹è¿ç®—ç¬¦æµç¨‹æ§åˆ¶è¯­å¥">æ•°æ®ç±»å‹ã€è¿ç®—ç¬¦ã€æµç¨‹æ§åˆ¶è¯­å¥</h1><h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2><ul><li><strong>åŸå§‹ç±»å‹ï¼ˆPrimitive Typesï¼‰</strong></li></ul><p>å¯¹åº”Javaä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä½†æ˜¯åˆ†å¾—æ²¡é‚£ä¹ˆç»†</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>ç¤ºä¾‹å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>number</code></td><td><code>42</code>, <code>3.14</code>, <code>NaN</code>,<code>Infinity</code></td><td>æ•°å­—ç±»å‹ï¼ŒåŒ…å«æ•´æ•°å’Œæµ®ç‚¹æ•°</td></tr><tr><td><code>string</code></td><td><code>"Hello"</code>, <code>'ä¸–ç•Œ'</code></td><td>å­—ç¬¦ä¸²ï¼Œå•åŒå¼•å·éƒ½å¯</td></tr><tr><td><code>boolean</code></td><td><code>true</code>, <code>false</code></td><td>å¸ƒå°”å€¼</td></tr><tr><td><code>undefined</code></td><td><code>let x;</code> â†’ <code>x === undefined</code></td><td>å£°æ˜æœªèµ‹å€¼æ—¶çš„é»˜è®¤å€¼</td></tr><tr><td><code>null</code></td><td><code>let x = null</code></td><td>è¡¨ç¤ºâ€œæ— â€æˆ–â€œç©ºå€¼â€</td></tr><tr><td><code>bigint</code></td><td><code>12345678901234567890n</code></td><td>å¤§æ•´æ•°ç±»å‹ï¼ˆES2020+ï¼‰</td></tr><tr><td><code>symbol</code></td><td><code>Symbol("id")</code></td><td>ç‹¬ä¸€æ— äºŒçš„æ ‡è¯†ç¬¦</td></tr></tbody></table><ul><li><strong>å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰</strong></li></ul><p>å¯¹åº”Javaä¸­çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å°‘å¾—å¤š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>object</code></td><td><code>&#123; name: "Miku", age: 16 &#125;</code></td><td>æ™®é€šå¯¹è±¡ï¼Œé”®å€¼å¯¹ç»“æ„</td></tr><tr><td><code>array</code></td><td><code>[1, 2, 3, "åˆéŸ³"]</code></td><td>æ•°ç»„ï¼ŒJS ä¸­æ˜¯ä¸€ç§å¯¹è±¡ç±»å‹</td></tr><tr><td><code>function</code></td><td><code>function greet() &#123;&#125;</code></td><td>å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡</td></tr><tr><td><code>date</code></td><td><code>new Date()</code></td><td>æ—¥æœŸå¯¹è±¡</td></tr><tr><td><code>regexp</code></td><td><code>/abc/</code>, <code>new RegExp("abc")</code></td><td>æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</td></tr></tbody></table><p>ä½¿ç”¨<code>typeof</code>è¿ç®—ç¬¦å¯ä»¥å¾—åˆ°æ•°æ®ç±»å‹ã€‚</p><h2 id="è¿ç®—ç¬¦">è¿ç®—ç¬¦</h2><p>ç®—æœ¯è¿ç®—ç¬¦ï¼Œé€»è¾‘è¿ç®—ç¬¦åŒJavaã€‚</p><p>æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">==    <span class="hljs-comment">// ç›¸ç­‰ï¼Œä¼šè¿›è¡Œç±»å‹è½¬æ¢</span><br>===   <span class="hljs-comment">// å…¨ç­‰ï¼ˆå€¼å’Œç±»å‹éƒ½ç›¸ç­‰ï¼‰ï¼Œä¸è¿›è¡Œç±»å‹è½¬æ¢âœ…æ¨è</span><br>!=    <span class="hljs-comment">// ä¸ç­‰</span><br>!==   <span class="hljs-comment">// å…¨ä¸ç­‰ï¼ˆå€¼å’Œç±»å‹éƒ½ä¸ç›¸ç­‰ï¼‰</span><br>&lt; &gt; &lt;= &gt;=<br></code></pre></td></tr></table></figure><p>èµ‹å€¼è¿ç®—ç¬¦ï¼š <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">= **<br>+=   -=   *=   /=   %=   **=<br></code></pre></td></tr></table></figure></p><ul><li><code>**</code>ï¼š<strong>æŒ‡æ•°è¿ç®—ç¬¦ExponentiationOperatorï¼‰</strong>ï¼Œä¾‹å¦‚<code>2**3</code>è¡¨ç¤º2çš„ä¸‰æ¬¡æ–¹ã€‚å®ƒæ˜¯<strong>å·¦ç»“åˆ</strong>è¿ç®—ç¬¦ï¼Œæ¯”å¦‚<code>2 ** 3 ** 2</code>çš„è®¡ç®—é¡ºåºæ˜¯<code>2 ** (3 ** 2)</code>ã€‚</li><li><code>**=</code>æ˜¯<strong>æŒ‡æ•°èµ‹å€¼è¿ç®—ç¬¦ï¼ˆExponentiation assignmentoperatorï¼‰</strong>ï¼ŒES7åŠ å…¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼š<code>x **= y</code>ï¼Œæ„æ€å°±æ˜¯<code>x = x ** y;</code>ï¼Œæ„æ€å°±æ˜¯æŠŠxçš„yæ¬¡æ–¹èµ‹ç»™xæœ¬èº«ã€‚ä¾‹å¦‚ï¼š</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> a = <span class="hljs-number">2</span>;<br>a **= <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><p>å°±æ˜¯æŠŠ<code>a</code>çš„3æ¬¡æ–¹èµ‹å€¼ç»™<code>a</code>ï¼Œç»“æœä¸º8ã€‚</p><h3 id="ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</h3><h4 id="è½¬æ¢æˆå­—ç¬¦ä¸²">è½¬æ¢æˆå­—ç¬¦ä¸²</h4><p><code>.toString()</code></p><p>Booleanå€¼ã€æ•°å­—(number)å’Œå­—ç¬¦ä¸²(string)éƒ½æ˜¯<strong>ä¼ªå¯¹è±¡</strong>ï¼Œå®ƒä»¬å®é™…ä¸Šå…·æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œ<code>.toString()</code>å°±æ˜¯å…¶ä¸­ä¸€ç§å¯ä¾›è°ƒç”¨çš„æ–¹æ³•ã€‚</p><p>å¦å¤–numberç±»å‹çš„<code>toString()</code>æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœä¸ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆé‡‡ç”¨çš„æ˜¯<strong>é»˜è®¤æ¨¡å¼</strong>ï¼Œè¿”å›çš„æ˜¯æ•°å­—çš„åè¿›åˆ¶è¡¨ç¤ºã€‚å¦‚æœä¼ å…¥å‚æ•°ï¼Œå³ä¸º<strong>åŸºæ¨¡å¼</strong>ï¼Œå¯ä»¥ç”¨ä¸åŒçš„åŸº(radix)è¾“å‡ºæ•°å­—ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> x = <span class="hljs-number">9</span>;<br><span class="hljs-title function_">alert</span>(x.<span class="hljs-title function_">toString</span>(<span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœä¸º<code>1001</code>ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶æ•°å­—9çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚</p><h4 id="è½¬æ¢æˆæ•°å­—">è½¬æ¢æˆæ•°å­—</h4><p>è½¬æ¢ä¸ºæ•´æ•°ï¼š<code>parseInt</code>è½¬æ¢ä¸ºå°æ•°ï¼š<code>parseFloat()</code></p><p>ä»å¼€å¤´å¼€å§‹ä»å·¦åˆ°å³è¯»å–æ˜¯æ•°å­—çš„éƒ¨åˆ†ã€‚å¦‚æœå¼€å¤´å°±ä¸æ˜¯æ•°å­—ï¼Œåˆ™è½¬æ¢å¤±è´¥ï¼Œè¿”å›<code>NaN</code>(Nota Number)ã€‚</p><p>å­—ç¬¦ä¸²ä¸­åŒ…å«çš„æ•°å­—å­—é¢é‡ä¼šè¢«æ­£ç¡®è½¬æ¢ä¸ºæ•°å­—ï¼Œä¾‹å¦‚"0xA"ä¼šè¢«è½¬æ¢æˆæ•°å­—10ã€‚ä½†æ˜¯"22.5"ä¼šè¢«è½¬æ¢æˆ22ï¼Œå› ä¸ºå°æ•°ç‚¹è¢«å½“æˆæ— æ•ˆå­—ç¬¦å¤„ç†äº†ã€‚<code>parseFloat()</code>ä¼šæŠŠé‡åˆ°çš„ç¬¬ä¸€ä¸ªå°æ•°ç‚¹å½“æˆå°æ•°ç‚¹å¤„ç†ã€‚</p><p><code>parseInt()</code>æ–¹æ³•ä¹Ÿæœ‰åŸºæ¨¡å¼ï¼Œå®šä¹‰ä¸º<code>parseInt(string: string, radix?: number): number</code>ï¼Œä½†æ˜¯<code>parseFloat()</code>æ²¡æœ‰ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒJavaä½¿ç”¨<code>Integer.parseInt()</code><code>Float.parseFloat</code> <code>Double.parseDouble()</code><code>Long.parseLong</code>ç­‰æ–¹æ³•è¿›è¡Œè½¬æ¢ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ä¼šæŠ›å‡º<code>NumberFormatException</code>å¼‚å¸¸ã€‚</p><h3 id="å¼ºåˆ¶ç±»å‹è½¬æ¢">å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><p><strong>type casting</strong></p><p class="note note-info">castæœ‰â€œé“¸é€ â€ä¹‹æ„ï¼Œå¾ˆè´´åˆâ€œå¼ºåˆ¶è½¬æ¢â€çš„æ„æ€</p><p><strong>ECMAScript ä¸­å¯ç”¨çš„3ç§å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ï¼š</p><ul><li>Boolean(value) - æŠŠç»™å®šçš„å€¼è½¬æ¢æˆ Boolean å‹ï¼›ç©ºå­—ç¬¦ä¸²ã€æ•°å­—0ã€undefined æˆ– nullï¼Œè¿”å› falseã€‚</li><li>Number(value) -æŠŠç»™å®šçš„å€¼è½¬æ¢æˆæ•°å­—ï¼ˆå¯ä»¥æ˜¯æ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ï¼›å¤„ç†<strong>æ•´ä¸ªå€¼</strong>ã€‚</li><li>String(value) - æŠŠç»™å®šçš„å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›</li></ul><h1 id="å‡½æ•°">å‡½æ•°</h1><p>ä½¿ç”¨<strong>function</strong>è¿›è¡Œå®šä¹‰ï¼Œè¯­æ³•ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">functionName</span>(<span class="hljs-params">para1, para2,...</span>) &#123;<br>    <span class="hljs-comment">//å‡½æ•°ä½“</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å½¢å‚ä¸éœ€è¦ç±»å‹ï¼Œå› ä¸ºjså¼±ç±»å‹</li><li>è¿”å›å€¼ä¹Ÿä¸éœ€è¦å®šä¹‰ç±»å‹ï¼Œæœ‰returnå°±è¯´æ˜æœ‰è¿”å›å€¼</li><li>è°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¼ é€’ä»»æ„ä¸ªæ•°çš„å‚æ•°</li></ul><p>å‡½æ•°ä½œä¸ºå½¢å‚æ—¶ï¼Œä½¿ç”¨lambdaè¡¨è¾¾å¼ä¼šèˆ’æœå¾ˆå¤šã€‚</p><h2 id="é—­åŒ…closure">*é—­åŒ…(closure)</h2><h3 id="å¼•å…¥">å¼•å…¥</h3><p>JSæ¯”è¾ƒç‹¬ç‰¹çš„ä¸€ä¸ªç‰¹æ€§ã€‚</p><div class="note note-secondary">            <p>JavaScript å˜é‡å±äº æœ¬åœ° æˆ– å…¨å±€ ä½œç”¨åŸŸã€‚ å…¨å±€å˜é‡èƒ½å¤Ÿé€šè¿‡ é—­åŒ…å®ç°å±€éƒ¨ï¼ˆç§æœ‰ï¼‰ã€‚</p>          </div><ul><li>åœ¨ç½‘é¡µä¸­ï¼Œå…¨å±€å˜é‡å±äº<code>window</code>å¯¹è±¡ï¼Œå…¨å±€å˜é‡èƒ½å¤Ÿè¢«é¡µé¢ä¸­ï¼ˆä»¥åŠçª—å£ä¸­ï¼‰çš„æ‰€æœ‰è„šæœ¬ä½¿ç”¨å’Œä¿®æ”¹ã€‚</li><li>è€Œå±€éƒ¨å˜é‡åªèƒ½ç”¨äºå…¶è¢«å®šä¹‰çš„å‡½æ•°å†…éƒ¨ï¼Œå¯¹äºå…¶ä»–å‡½æ•°å’Œè„šæœ¬ä»£ç æ¥è¯´å®ƒæ˜¯ä¸å¯è§çš„ã€‚</li></ul><p>è€ƒè™‘ä¸‹é¢è¿™ç§æƒ…å†µï¼šæˆ‘ä»¬æƒ³åšä¸€ä¸ªè®¡æ•°å™¨ç”¨æ¥è®¡æ•°å‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°ã€‚å¦‚æœä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// åˆå§‹åŒ–è®¡æ•°å™¨</span><br><span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">// é€’å¢è®¡æ•°å™¨çš„å‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;<br>  counter += <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨ä¸‰æ¬¡ add()</span><br><span class="hljs-title function_">add</span>();<br><span class="hljs-title function_">add</span>();<br><span class="hljs-title function_">add</span>();<br><br><span class="hljs-comment">//æ­¤æ—¶è®¡æ•°å™¨ä¸º3</span><br></code></pre></td></tr></table></figure><p>è™½ç„¶èƒ½å®ç°è®¡æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯<strong>ä¸å¤Ÿå®‰å…¨</strong>ï¼Œå› ä¸ºä½œä¸ºå…¨å±€å˜é‡çš„<code>counter</code>å¯ä»¥è¢«ä»»æ„å‡½æ•°éšæ„æ›´æ”¹ã€‚ä¸ºäº†é˜²æ­¢éšæ„æ›´æ”¹ï¼Œè€ƒè™‘æŠŠå®ƒå£°æ˜ä¸ºå±€éƒ¨å˜é‡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">plus</span>(<span class="hljs-params"></span>) &#123;counter += <span class="hljs-number">1</span>;&#125;<br>    <span class="hljs-title function_">plus</span>();     <br>    <span class="hljs-keyword">return</span> counter; <br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶ä»ç„¶å­˜åœ¨é—®é¢˜ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶éƒ½ä¼šç»™<code>counter</code>é‡æ–°èµ‹å€¼ä¸º0ï¼Œä¸èƒ½å®ç°è®¡æ•°çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯åˆå§‹åŒ–å‡½æ•°ä¹‹è¢«è°ƒç”¨ä¸€æ¬¡</p><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æƒé™ä¿®é¥°ç¬¦<code>private</code>å’Œ<code>getter</code>è§£å†³å®‰å…¨æ€§é—®é¢˜ï¼Œä½†æ˜¯JSä¸­æ²¡æœ‰æƒé™ä¿®é¥°ç¬¦ï¼Œæ€ä¹ˆåŠï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿å¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œé‚£å°±æ˜¯é—­åŒ…ã€‚</p><hr /><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> counter += <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> conterFunc = <span class="hljs-title function_">add</span>(); <span class="hljs-comment">// è·å¾—å†…å±‚å‡½æ•°</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">conterFunc</span>());<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">conterFunc</span>());<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">conterFunc</span>());<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">conterFunc</span>());<br><br><span class="hljs-comment">//æ§åˆ¶å°ï¼š 1  2  3  4</span><br></code></pre></td></tr></table></figure><ul><li><code>add</code>æ˜¯å¤–å±‚å‡½æ•°ï¼Œå†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨åŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”<code>add</code>çš„è¿”å›å€¼å°±æ˜¯å†…éƒ¨å‡½æ•°çš„å¼•ç”¨ï¼Œæˆ–è€…è¯´å¥æŸ„ï¼›</li><li><code>const conterFunc = add();</code>è°ƒç”¨äº†ä¸€æ¬¡å¤–å±‚å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ª<code>counter</code>å¹¶åˆå§‹åŒ–ä¸º0ï¼›</li><li>ä¹‹åæ¯æ¬¡è°ƒç”¨<code>conterFunc()</code>å®é™…ä¸Šè°ƒç”¨çš„æ˜¯å†…å±‚å‡½æ•°ï¼Œå› ä¸º<code>counter</code>è¿˜æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºå¥½çš„é‚£ä¸ªï¼Œæ‰€ä»¥å¯ä»¥æ­£å¸¸è®¡æ•°ï¼›</li><li>åˆå› ä¸º<code>counter</code>æ˜¯å‡½æ•°å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥ä¸ä¼šè¢«å¤–ç•Œè®¿é—®åˆ°ï¼Œè¶³å¤Ÿå®‰å…¨ã€‚</li></ul><p><strong>æ³¨æ„</strong>ï¼šæ¯æ¬¡è°ƒç”¨<code>add()</code>ä¼šç”Ÿæˆæ–°çš„ç‹¬ç«‹åŒ…ï¼Œç›¸äº’ç‹¬ç«‹äº’ä¸å½±å“ï¼Œæ‰€ä»¥åªåœ¨å¼€å¤´è°ƒç”¨äº†ä¸€æ¬¡ã€‚</p><p>é—­åŒ…è¿˜å¯ä»¥æŠŠå¤šå‚æ•°çš„å‡½æ•°å˜æˆå•å‚æ•°çš„å‡½æ•°ï¼Œä¾‹å¦‚å¹³æ–¹å’Œç«‹æ–¹çš„è®¡ç®—ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* æŠŠxå’Œnåˆ†é…åˆ°å¤–å±‚å‡½æ•°å’Œå†…å±‚å‡½æ•°å³å¯å®ç° */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">make_pow</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(x, n);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// åˆ›å»ºä¸¤ä¸ªæ–°å‡½æ•°:</span><br><span class="hljs-keyword">let</span> pow2 = <span class="hljs-title function_">make_pow</span>(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">let</span> pow3 = <span class="hljs-title function_">make_pow</span>(<span class="hljs-number">3</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">pow2</span>(<span class="hljs-number">5</span>)); <span class="hljs-comment">// 25</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">pow3</span>(<span class="hljs-number">7</span>)); <span class="hljs-comment">// 343</span><br></code></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå™¨generator">ç”Ÿæˆå™¨(generator)</h2><p>ES6æ ‡å‡†å¼•å…¥çš„æ–°çš„æ•°æ®ç±»å‹ã€‚å¦å¤–ï¼Œ</p><div class="note note-primary">            <p>ç”Ÿæˆå™¨å‡½æ•° æ˜¯ä¸€ç§å¯ä»¥â€œæš‚åœæ‰§è¡Œâ€çš„å‡½æ•°ï¼Œé€šè¿‡ function* å®šä¹‰ï¼Œç”¨ yieldæ§åˆ¶æµç¨‹ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª å¯è¿­ä»£å¯¹è±¡ï¼ˆiteratorï¼‰ã€‚</p>          </div><ul><li><code>yield</code>: è¿”å›ä¸€ä¸ªå€¼ç»™å¤–éƒ¨ï¼ŒåŒæ—¶æš‚åœå‡½æ•°çš„æ‰§è¡Œã€‚</li><li><code>next()</code>: ä¸€æ—¦è°ƒç”¨å°±æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª<code>yield</code></li></ul><p>è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¸ä¼šç›´æ¥æ‰§è¡Œå‡½æ•°ä½“å†…éƒ¨çš„ä»£ç ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª<strong>ç”Ÿæˆå™¨å¯¹è±¡</strong>ï¼ˆgeneratorobjectï¼‰ã€‚æ¯æ¬¡è°ƒç”¨å®ƒéƒ½ä¼šé‡å¼€ä¸€ä¸ªç”Ÿæˆå™¨ã€‚</p><p>ä¸ºäº†è®©ç”Ÿæˆå™¨èƒ½å¾€ä¸‹è·‘ï¼Œéœ€è¦é‡‡ç”¨ç±»ä¼¼é—­åŒ…çš„æ–¹æ³•ï¼šå…ˆè·å–å¥æŸ„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span>* <span class="hljs-title function_">countUp</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-keyword">yield</span> i++; <span class="hljs-comment">// è¿”å›içš„å€¼ï¼Œç„¶åi+1</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">countUp</span>(); <span class="hljs-comment">// å…ˆåˆ›å»ºä¸€ä¸ªâ€œå¯ä»¥æš‚åœçš„æ‰§è¡Œå™¨â€ </span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 0</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 2</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">countUp</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>);<span class="hljs-comment">//0</span><br></code></pre></td></tr></table></figure><h1 id="å¯¹è±¡">å¯¹è±¡</h1><ul><li>Array</li><li>String</li><li>JSON</li><li>BOM(Browser Object Model, æµè§ˆå™¨å¯¹è±¡æ¨¡å‹)</li><li>DOM(Document Object Model, æ–‡æ¡£å¯¹è±¡æ¨¡å‹)</li></ul><h2 id="åŒ…è£…ç±»å¯¹è±¡">åŒ…è£…ç±»å¯¹è±¡</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">123.</span>.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// ä¸æŠ¥é”™</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">123.</span><span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// æŠ¥é”™</span><br></code></pre></td></tr></table></figure><p><strong>åˆ«ç”¨</strong></p><h2 id="date">Date</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2018</span>, <span class="hljs-number">11</span>, <span class="hljs-number">24</span>, <span class="hljs-number">10</span>, <span class="hljs-number">33</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d);<br><span class="hljs-comment">//æ§åˆ¶å°è¾“å‡ºï¼šMon Dec 24 2018 10:33:30 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</span><br></code></pre></td></tr></table></figure><div class="note note-warning">            <p>JavaScript ä» 0 åˆ° 11 è®¡ç®—æœˆä»½ã€‚ ä¸€æœˆæ˜¯ 0ã€‚åäºŒæœˆæ˜¯11ã€‚6ä¸ªæ•°å­—æŒ‡å®šå¹´ã€æœˆã€æ—¥ã€å°æ—¶ã€åˆ†é’Ÿã€ç§’ï¼š</p>          </div><h2 id="array">Array</h2><ul><li><strong>å®šä¹‰</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ä¸€èˆ¬æ–¹å¼</span><br><span class="hljs-keyword">var</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>);<br><span class="hljs-comment">// ç®€åŒ–çš„æ–¹å¼</span><br><span class="hljs-keyword">var</span> cars = [<span class="hljs-string">&quot;Saab&quot;</span>, <span class="hljs-string">&quot;Volvo&quot;</span>, <span class="hljs-string">&quot;BMW&quot;</span>];<br></code></pre></td></tr></table></figure><ul><li><strong>è®¿é—®</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">arr[index] = value;<br></code></pre></td></tr></table></figure><ul><li><strong>éå†</strong>ï¼šæ¨è<code>forEach</code>æ–¹æ³•ï¼ˆç›¸å½“äºJavaä¸­çš„forEach+lambdaè¡¨è¾¾å¼ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];<br><br>arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(element);<br>&#125;);<br></code></pre></td></tr></table></figure><p>JSæ•°ç»„é•¿åº¦å¯å˜ï¼Œç±»å‹å¯å˜ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ã€‚æ²¡æœ‰èµ‹å€¼çš„ä½ç½®è®°ä¸ºundefinedã€‚</p><p><strong>å±æ€§</strong>ï¼š<code>length</code>ï¼Œç”¨æ³•åŒJava</p><p><strong>æ–¹æ³•</strong>ï¼š</p><ul><li><code>forEach</code>:éå†<strong>æœ‰å€¼</strong>çš„å…ƒç´ ï¼Œå¹¶è°ƒç”¨ä¼ å…¥çš„å‡½æ•°</li><li><code>push()</code>:å°†æ–°çš„å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦</li><li><code>splice(start: number, deleteCount?: number): number[]</code>:ä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ ï¼Œå·¦é—­å³å¼€ã€‚é—®å·è¡¨ç¤ºå¯é€‰å‚æ•°</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];<br>arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[i]);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ§åˆ¶å°ï¼š3 4</p><h2 id="string">String</h2><p><strong>åˆ›å»º</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> å˜é‡å = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;...&quot;</span>);<br><span class="hljs-keyword">var</span> å˜é‡å = <span class="hljs-string">&quot;...&quot;</span>;<br></code></pre></td></tr></table></figure><p><strong>å±æ€§</strong>ï¼š<code>length</code></p><p><strong>æ–¹æ³•</strong>ï¼š</p><ul><li><code>charAt(index)</code>:è¿”å›å­—ç¬¦ä¸²ä¸­ æŒ‡å®šä½ç½®çš„å­—ç¬¦ã€‚</li><li><code>indexOf(searchValue, fromIndex?)</code>:ä»fromIndexå¼€å§‹æŸ¥æ‰¾æŸä¸ªå­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œæ‰¾ä¸åˆ°å°±è¿”å›-1ã€‚</li><li><code>trim()</code>:å»é™¤å­—ç¬¦ä¸²ä¸¤è¾¹çš„ç©ºæ ¼ï¼ˆä¸åŒ…æ‹¬ä¸­é—´çš„ç©ºæ ¼ï¼‰ã€‚</li><li><code>substring(startIndex, endIndex?)</code>:æˆªå–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå·¦é—­å³å¼€ã€‚</li></ul><h3 id="å¯¹å­—ç¬¦ä¸²åšä¸€äº›è¡¥å……">å¯¹å­—ç¬¦ä¸²åšä¸€äº›è¡¥å……</h3><ol type="1"><li><strong>å¤šè¡Œå­—ç¬¦ä¸²</strong>ï¼š</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> s = <span class="hljs-string">`è¿™æ˜¯ä¸€ä¸ª</span><br><span class="hljs-string">å¤šè¡Œ</span><br><span class="hljs-string">å­—ç¬¦ä¸²</span><br><span class="hljs-string">`</span>;<br></code></pre></td></tr></table></figure><p>é€šè¿‡åå¼•å·çš„å½¢å¼å£°æ˜å¤šè¡Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥çœå»æ¢è¡Œå­—ç¬¦ã€‚</p><ol start="2" type="1"><li><strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong>ï¼š</li></ol><p>è¦æŠŠå¤šä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œå¯ä»¥ç”¨+å·è¿æ¥ï¼›ES6æ–°å¢äº†ä¸€ç§æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œè¿æ¥å­—ç¬¦ä¸²æ›´æ–¹ä¾¿ï¼šï¼ˆæ³¨æ„ä½¿ç”¨åå¼•å·åŒ…è£¹ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> person = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;sss&quot;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">17</span>,<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åå­—æ˜¯ï¼š<span class="hljs-subst">$&#123;person.name&#125;</span>, å¹´é¾„æ˜¯<span class="hljs-subst">$&#123;person.age&#125;</span>`</span>);<br></code></pre></td></tr></table></figure><h2 id="json">JSON</h2><p>åŸºäº JavaScript è¯­è¨€çš„è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼ˆJavaScript ObjectNotationï¼‰</p><p>æ„ä¹‰ï¼š</p><div class="note note-success">            <p>å½“æ•°æ®åœ¨æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œäº¤æ¢æ—¶ï¼Œè¿™äº›æ•°æ®åªèƒ½æ˜¯æ–‡æœ¬ã€‚</p><p>JSON å±äºæ–‡æœ¬ï¼Œå¹¶ä¸”æˆ‘ä»¬èƒ½å¤ŸæŠŠä»»ä½• JavaScript å¯¹è±¡è½¬æ¢ä¸º JSONï¼Œç„¶åå°†JSON å‘é€åˆ°æœåŠ¡å™¨ã€‚</p><p>æˆ‘ä»¬ä¹Ÿèƒ½æŠŠä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ä»»ä½• JSON è½¬æ¢ä¸º JavaScript å¯¹è±¡ã€‚</p><p>ä»¥è¿™æ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤ŸæŠŠæ•°æ®ä½œä¸º JavaScriptå¯¹è±¡æ¥å¤„ç†ï¼Œæ— éœ€å¤æ‚çš„è§£æå’Œè½¬è¯‘ã€‚</p>          </div><p>è™½ç„¶åå­—é‡Œæœ‰ JavaScriptï¼Œä½†å®ƒæ˜¯è¯­è¨€æ— å…³çš„æ ¼å¼ï¼Œå¯ä»¥è¢«å‡ ä¹æ‰€æœ‰è¯­è¨€ï¼ˆå¦‚Pythonã€Javaã€C#ï¼‰æ”¯æŒã€‚</p><hr /><p>å…ˆè¯´è¯´JSè‡ªå®šä¹‰å¯¹è±¡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> å¯¹è±¡å = &#123;<br>    å±æ€§åï¼šå±æ€§å€¼,<br>    ...<br>    å‡½æ•°å:<span class="hljs-keyword">function</span>(<span class="hljs-params">å½¢å‚åˆ—è¡¨</span>)&#123;æ‰§è¡Œä»£ç &#125;<br>    <span class="hljs-comment">// :function å¯ä»¥çœç•¥</span><br><br>&#125;;<br></code></pre></td></tr></table></figure><hr /><p>å¦‚ä½•å®šä¹‰ä¸€ä¸ªJSONï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HÆ°ng&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;languages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;Vietnamese&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Japanese&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Chinese&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;isStudent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;details&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ho Chi Minh&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;hobbies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;music&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;anime&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;games&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li><strong>æŠŠ JSONå­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡</strong>ï¼š<code>const obj = JSON.parse(jsonStr);</code></li><li><strong>æŠŠå¯¹è±¡è½¬ä¸º JSONå­—ç¬¦ä¸²</strong>ï¼š<code>const jsonStr = JSON.stringify(obj);</code></li></ul><h1 id="é¢å‘å¯¹è±¡ç¼–ç¨‹">é¢å‘å¯¹è±¡ç¼–ç¨‹</h1><p>å‚çœ‹è¿™ä½å¤§ä½¬çš„åšå®¢ï¼š</p><p><ahref="https://www.cnblogs.com/wangfupeng1988/p/3977924.html">æ·±å…¥ç†è§£javascriptåŸå‹å’Œé—­åŒ…</a></p><h1 id="bom">BOM</h1><p>æµè§ˆå™¨å¯¹è±¡æ¨¡å‹å…è®¸ JavaScript ä¸æµè§ˆå™¨å¯¹è¯ã€‚</p><ul><li><code>window</code>:çª—å£å¯¹è±¡ï¼Œå»é™¤å ä½ç¬¦åçš„å‡€å®½é«˜ä¸ºï¼ˆIE&lt;=8ä¸æ”¯æŒï¼‰<ul><li><code>innerWidth</code></li><li><code>innerHeight</code></li></ul></li><li><code>screen</code>:è¡¨ç¤ºå±å¹•çš„ä¿¡æ¯ï¼ˆå®½ï¼Œé«˜ï¼Œä½å®½ï¼‰</li><li><code>location</code>:å½“å‰é¡µé¢çš„URLä¿¡æ¯<ul><li><p><code>location.href</code>:å½“å‰é¡µé¢çš„URL</p></li><li><p><code>setInterval</code>æŒç»­é‡å¤æ‰§è¡Œè¯¥å‡½æ•°ã€‚</p></li><li><p><code>setTimeout</code>åœ¨ç­‰å¾…æŒ‡å®šçš„æ¯«ç§’æ•°åæ‰§è¡Œå‡½æ•°ã€‚</p></li></ul></li></ul><p><strong>Cookie</strong></p><div class="note note-secondary">            <p>æµè§ˆå™¨ç”¨æ¥å­˜å‚¨å°å—æ•°æ®ï¼ˆæœ€å¤šçº¦ 4KBï¼‰çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒå¯ä»¥åœ¨ç”¨æˆ·æµè§ˆç½‘é¡µæ—¶ï¼Œåœ¨æœ¬åœ°ä¿å­˜æ•°æ®ï¼Œå¹¶åœ¨ä¹‹åè®¿é—®æ—¶è‡ªåŠ¨æºå¸¦åˆ°æœåŠ¡å™¨ã€‚</p>          </div><p>æˆ‘ä»¬ç™»å½•äº†ä¸€ä¸ªç½‘ç«™ï¼Œå…³é—­ç½‘é¡µåç¬¬äºŒå¤©å†æ¥ï¼Œä¸ç”¨é‡æ–°ç™»å½•äº†ï¼Œå°±æ˜¯å› ä¸ºCookieã€‚</p><h1 id="dom">DOM</h1><p>å½“ç½‘é¡µè¢«åŠ è½½æ—¶ï¼Œæµè§ˆå™¨ä¼šåˆ›å»ºé¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDocument ObjectModelï¼‰ã€‚</p><p>HTML DOM æ¨¡å‹è¢«ç»“æ„åŒ–ä¸ºå¯¹è±¡æ ‘ï¼š</p><figure><img src="https://www.w3school.com.cn/i/ct_htmltree.gif"alt="https://www.w3school.com.cn/js/js_htmldom.asp" /><figcaptionaria-hidden="true">https://www.w3school.com.cn/js/js_htmldom.asp</figcaption></figure><p>é€šè¿‡<code>document</code>å¯¹è±¡çš„æ–¹æ³•å¯ä»¥æ‰¾åˆ°å¯¹è±¡æ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œå¸¸ç”¨çš„æœ‰ï¼š</p><ul><li><code>getElementById()</code></li><li><code>getElementsByTagName()</code></li></ul><h2 id="æ›´æ–°">æ›´æ–°</h2><p>è·å–å¯¹è±¡åï¼Œå¯ä»¥å¯¹å¯¹è±¡è¿›è¡Œæ“ä½œï¼š</p><ul><li><code>innerHTML</code></li><li><code>innerText</code></li><li><code>textContent</code></li></ul><p>ä¹Ÿå¯ä»¥ä¿®æ”¹cssæ ·å¼ï¼ˆå’Œcssçš„å‘½åæ–¹å¼ä¸ä¸€æ ·ï¼‰</p><ul><li><code>.style.color</code></li><li><code>.style.fontSize</code></li><li><code>.style.paddingTop</code></li></ul><p>æ ¼å¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(id).<span class="hljs-property">style</span>.<span class="hljs-property">property</span> = newstyle<br></code></pre></td></tr></table></figure><h2 id="æ’å…¥">æ’å…¥</h2><ul><li><code>appendChild</code></li><li><code>insertBefore</code> ## åˆ é™¤</li></ul><p>çˆ¶èŠ‚ç‚¹è°ƒç”¨<code>removeChild</code>åˆ é™¤å­èŠ‚ç‚¹</p><h1 id="async">Async</h1><h2 id="å›è°ƒ">å›è°ƒ</h2><p>å›è°ƒå‡½æ•°ï¼ˆCallback Functionï¼‰ï¼Œå°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‚æ•°</p><h1 id="jsäº‹ä»¶">JSäº‹ä»¶</h1><p>äº‹ä»¶ç»‘å®šçš„æ–¹å¼ï¼š</p><ul><li>é€šè¿‡HTMLä¸­çš„äº‹ä»¶å±æ€§ã€‚ä¾‹å¦‚<code>&lt;button onclick="displayDate()"&gt;è¯•ä¸€è¯•&lt;/button&gt;</code></li><li>é€šè¿‡DOMåˆ†é…äº‹ä»¶ï¼Œä¾‹å¦‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;myBtn&quot;</span>).<span class="hljs-property">onclick</span> = displayDate;<br>&lt;/script&gt; <br></code></pre></td></tr></table></figure><h2 id="äº‹ä»¶ç›‘å¬">*äº‹ä»¶ç›‘å¬</h2><div class="note note-secondary">            <p>åœ¨ JavaScript ä¸­ï¼Œäº‹ä»¶ç›‘å¬ï¼ˆEvent Listenerï¼‰ æ˜¯æŒ‡ä½ ä¸ºä¸€ä¸ª HTMLå…ƒç´ ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼ˆç›‘å¬å™¨ï¼‰ï¼Œå½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚ç‚¹å‡»ã€é”®ç›˜è¾“å…¥ã€é¼ æ ‡æ‚¬åœç­‰ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p>          </div><p>è¯­æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">element.<span class="hljs-title function_">addEventListener</span>(event, <span class="hljs-keyword">function</span>, useCapture);<br></code></pre></td></tr></table></figure><ul><li>äº‹ä»¶ç±»å‹</li><li>äº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨çš„å‡½æ•°</li><li>å¸ƒå°”å€¼ï¼ŒæŒ‡å®šäº‹ä»¶æ˜¯ä½¿ç”¨å†’æ³¡è¿˜æ˜¯äº‹ä»¶æ•è·ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤æ˜¯å†’æ³¡é˜¶æ®µï¼ˆç”¨å¾—å¾ˆå°‘ï¼‰</li></ul><p>å¯ä»¥å‘ä¸€ä¸ªå…ƒç´ æ·»åŠ å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web Development</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexo + Fluidåšå®¢ç¾åŒ–è®°å½•</title>
    <link href="/2025/04/20/Fluid%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%962/"/>
    <url>/2025/04/20/Fluid%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%962/</url>
    
    <content type="html"><![CDATA[<p>ç®€å•çš„åšå®¢ç¾åŒ–è®°å½• <span id="more"></span></p><h1 id="ç¾åŒ–æ¸…å•">ç¾åŒ–æ¸…å•</h1><ol type="1"><li><a href="#æ·»åŠ åšå®¢åŠ è½½é¡µé¢">æ·»åŠ åšå®¢åŠ è½½é¡µé¢</a></li><li><a href="#githubçŠ¶æ€å’Œæ´»è·ƒæ›²çº¿">GithubçŠ¶æ€å’Œæ´»è·ƒæ›²çº¿</a></li><li><a href="#macé£æ ¼ä»£ç å—">macé£æ ¼ä»£ç å—</a></li><li><a href="#è‰ºæœ¯å­—ç­¾å">è‰ºæœ¯å­—ç­¾å</a></li><li><a href="#æ›´æ¢å›¾åºŠ">æ›´æ¢å›¾åºŠ</a></li><li><a href="#é—ç•™é—®é¢˜">é—ç•™é—®é¢˜</a></li></ol><h1 id="æ·»åŠ åšå®¢åŠ è½½é¡µé¢">æ·»åŠ åšå®¢åŠ è½½é¡µé¢</h1><p>Fluidä¸»é¢˜æœ¬èº«æ˜¯ä¸æ”¯æŒå›ºå®šèƒŒæ™¯å›¾çš„ï¼Œå¼ºè¡Œå›ºå®šä¼šå¯¼è‡´åŠ è½½é¡µé¢æ—¶æ˜æ˜¾è§‚å¯Ÿåˆ°èƒŒæ™¯å›¾â€œç¬ç§»â€ï¼Œè€Œä¸”ä¸é€‚é…ç§»åŠ¨ç«¯ã€‚</p><p>ç°åœ¨ç§»åŠ¨ç«¯æˆ‘å…ˆä¸ç®¡äº†ï¼Œè¿™é‡Œé€šè¿‡æ·»åŠ åŠ è½½é¡µé¢çš„æ–¹å¼è§„é¿èƒŒæ™¯å›¾ç¬ç§»çš„é—®é¢˜ã€‚</p><p>ä»£ç æºè‡ªè¯¥<ahref="https://www.zywvvd.com/notes/hexo/theme/fluid/fluid-loading/fluid-loading/">å®ä¾‹</a></p><p>å…³äºç¬¬ä¸€æ­¥ï¼Œâ€œåœ¨bodyBeginæ³¨å…¥å…ƒç´ ä»£ç â€ï¼Œå³æŠŠä¸‹é¢è¿™æ®µä»£ç åŠ åˆ°åšå®¢ç›®å½•ä¸‹çš„<code>\Blogs\node_modules\hexo-theme-fluid\layout\layout.ejs</code>çš„<code>&lt;body&gt;</code>å¼€å¤´çš„éƒ¨åˆ†ï¼š</p><p><img src="https://i.imgur.com/SGhKbvj.png" /></p><p>å‰©ä¸‹çš„CSSå’Œjsä»£ç åˆ†åˆ«æ·»åŠ åˆ°è‡ªå®šä¹‰CSSå’Œjsæ–‡ä»¶ä¸­å³å¯ã€‚</p><h1 id="githubçŠ¶æ€å’Œæ´»è·ƒæ›²çº¿">GithubçŠ¶æ€å’Œæ´»è·ƒæ›²çº¿</h1><p>é¡¹ç›®åœ°å€ï¼š</p><ul><li><ahref="https://github.com/anuraghazra/github-readme-stats?tab=readme-ov-file">github-readme-stats</a></li><li><ahref="https://github.com/Ashutosh00710/github-readme-activity-graph">github-readme-activity-graph</a></li></ul><p>å¤åˆ¶ç²˜è´´åˆ°å…³äºé¡µå³å¯ã€‚</p><h1 id="macé£æ ¼ä»£ç å—">macé£æ ¼ä»£ç å—</h1><p>å‚è€ƒï¼š<ahref="https://qingshaner.com/HexoFluid%E4%B8%BB%E9%A2%98%E4%BB%A3%E7%A0%81%E5%9D%97%E6%A0%B7%E5%BC%8F%E4%BF%AE%E6%94%B9/">HexoFluidä¸»é¢˜ä»£ç å—æ ·å¼ä¿®æ”¹</a></p><h1 id="è‰ºæœ¯å­—ç­¾å">è‰ºæœ¯å­—ç­¾å</h1><p>å‚è€ƒé“¾æ¥</p><ul><li><ahref="https://mrna16.github.io/2024/11/14/%E3%80%90Hexo%E3%80%91Fluid%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/#%E6%A0%87%E7%AD%BE%E5%8F%98%E5%8C%96">ã€Hexoã€‘Fluidä¸»é¢˜ç¾åŒ–</a></li><li><a href="https://4rozen.github.io/archives/Hexo/38001.html">ä½¿ç”¨ CSSå’Œ JS å®ç°åšå®¢å¯¼èˆªæ çº¿æ¡åŠ¨ç”»æ•ˆæœ</a>ï¼ˆè¿™ä¸ªçš„è®²è§£æ›´è¯¦ç»†ï¼‰</li></ul><p>ç­¾ååŠ¨ç”»ä¼¼ä¹ä¸åŠ è½½é¡µé¢ä¸å…¼å®¹ï¼Œæˆ‘æ²¡æœ‰çœ‹åˆ°åŠ¨ç”»æ•ˆæœï¼Œæ‰€ä»¥æŠŠåŠ¨ç”»éƒ¨åˆ†çš„ä»£ç å»æ‰äº†ã€‚</p><p>å¯¹<code>sign.css</code>éƒ¨åˆ†:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.svg</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>    <span class="hljs-attribute">height</span>: auto;<br>  &#125;<br>  <br>  <span class="hljs-selector-class">.svg</span> <span class="hljs-selector-tag">path</span> &#123;<br>    <span class="hljs-attribute">stroke</span>: white;<br>    <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">3pt</span>;<br>    <span class="hljs-attribute">stroke-linecap</span>: round;<br>    <span class="hljs-attribute">stroke-dasharray</span>: <span class="hljs-built_in">var</span>(--l);<br>    <span class="hljs-attribute">stroke-dashoffset</span>: <span class="hljs-built_in">var</span>(--l);<br>    <span class="hljs-attribute">fill</span>: none;<br>    <span class="hljs-attribute">fill-rule</span>: nonzero;<br>    <span class="hljs-attribute">animation</span>: stroke <span class="hljs-number">25s</span> forwards;<br>    -webkit-<span class="hljs-attribute">animation</span>: stroke <span class="hljs-number">25s</span> forwards;<br>  &#125;<br>  <br>  <span class="hljs-keyword">@keyframes</span> stroke &#123;<br>    <span class="hljs-selector-tag">to</span> &#123;<br>      <span class="hljs-attribute">stroke-dashoffset</span>: <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p><code>width</code>å’Œ<code>height</code>ä¸¤ä¸ªå±æ€§å¯ä»¥æ”¹ä¸º<code>100%</code>å’Œ<code>auto</code>ï¼Œæˆ‘ç»è¿‡å°è¯•å‘ç°å½±å“ç­¾åå¤§å°çš„ä¸»è¦è¿˜æ˜¯<ahref="https://danmarshall.github.io/google-font-to-svg-path/">GoogleFont to SvgPath</a>çš„Sizeæ•°å€¼ï¼Œæ‰€ä»¥ä¸ç”¨çº ç»“å®½å’Œé«˜åˆ°åº•åº”è¯¥å¡«å¤šå°‘äº†ï¼Œç›´æ¥è‡ªé€‚åº”ã€‚è¿™é‡ŒSizeå–çš„æ˜¯35ã€‚</p><p><code>sign.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span>  navbarBrand  =  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.container a&#x27;</span>);<br><br>navbarBrand.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`</span><br><span class="hljs-string">  &lt;object type=&quot;image/svg+xml&quot; data=&quot;/img/banyee&#x27;s Blog.svg&quot;&gt;&lt;/object&gt;</span><br><span class="hljs-string">`</span>;<br><br><span class="hljs-comment">// const  paths  =  document.querySelector(&#x27;.container .navbar-brand .svg .g path&#x27;)</span><br><br><span class="hljs-comment">// const  len  =  paths.getTotalLength()</span><br><br><span class="hljs-comment">// paths.style.setProperty(&#x27;--l&#x27;, len)</span><br></code></pre></td></tr></table></figure><p>åŠ¨ç”»éƒ¨åˆ†çš„ä»£ç å·²ç»è¢«æ³¨é‡Šã€‚å¦å¤–ï¼Œå¼•å…¥<code>.svg</code>æ–‡ä»¶æ—¶å¯ä»¥ç”¨ä¸Šé¢çš„è¿™ç§æ–¹æ³•ï¼Œå…ˆæŠŠsvgæ–‡ä»¶ä¸‹è½½åˆ°sourceç›®å½•ä¸‹çš„ä¸€ä¸ªimgæ–‡ä»¶å¤¹ä¸­ï¼Œå†å¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥è®©ä»£ç çœ‹èµ·æ¥ç®€æ´ä¸€äº›ã€‚</p><h1 id="æ›´æ¢å›¾åºŠ">æ›´æ¢å›¾åºŠ</h1><p>ä¹‹å‰ç”¨çš„ä¸€ç›´æ˜¯imgurï¼Œå›½å¤–çš„è€ç‰Œå…è´¹å›¾åºŠç½‘ç«™ï¼Œç¨³å®šå®‰å…¨å¯é ã€‚ä½†æ˜¯è¢«å¢™äº†ï¼Œè‡³äºä¸ºä»€ä¹ˆè¢«å¢™å•Šä¿ºä¹Ÿä¸çŸ¥é“</p><p>é‰´äºå›½å†…ç”¨æˆ·æ— æ³•è®¿é—®æ‰˜ç®¡åœ¨imgurä¸Šçš„å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—æ¢ä¸ªå›¾åºŠ</p><p>ä¸€å¼€å§‹æ‰“ç®—æ‰“ç®—ä½¿ç”¨è…¾è®¯COSå­˜å‚¨ï¼Œä¸»è¦æ˜¯å†²ç€è®¿é—®é€Ÿåº¦å¿«+é•¿æœŸç¨³å®šå»çš„ï¼Œè·Ÿç€<ahref="https://cloud.tencent.com/developer/article/1834573">æ•™ç¨‹</a>èµ°äº†å‡ æ­¥ï¼Œåˆ°äº†è¦ç»‘å®šåŸŸåçš„æ—¶å€™</p><p><img src="https://i.imgur.com/5nHrB3T.png" /></p><p>æœ¬æ¥æƒ³ç€æ¥éƒ½æ¥äº†ï¼Œé‚£å°±å¤‡æ¡ˆå•Šï¼Œç„¶åå¤‡æ¡ˆéœ€è¦å®åè®¤è¯ã€‚ã€‚ã€‚</p><p>è¿™æ—¶å€™æˆ‘æ‰æ„è¯†åˆ°è²Œä¼¼å›½å†…çš„åŸŸåéƒ½è¦å¤‡æ¡ˆä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚</p><p>ç„¶åæˆ‘åˆå°è¯•äº†SM.MSå›¾åºŠï¼Œè¿™ä¸ªå›¾åºŠçš„æ¥å†ï¼š</p><figure><img src="https://i.imgur.com/4RJjAug.png"alt="SM.MSè¯ç”Ÿäºäº’è”ç½‘ç²¾ç¥" /><figcaption aria-hidden="true">SM.MSè¯ç”Ÿäºäº’è”ç½‘ç²¾ç¥</figcaption></figure><p>ç„¶åæˆ‘è¯•ç€è®¿é—®äº†ä¸»ç«™</p><p><img src="https://i.imgur.com/BOutTZH.png" /></p><blockquote><p>"Due to network issues, users from China Mainland are unable toaccess SM.MS, we have added an alternate domain name smms.app"</p></blockquote><p>åˆè¢«å¤§é™†å¢™äº†ï¼Œè€Œä¸”è¿™ä¸ªå›¾åºŠå·²ç»å…³é—­äº†æ³¨å†ŒåŠŸèƒ½</p><p>æœ€åæˆ‘è½¬å‘äº†<ahref="https://imgse.com/page/about">è·¯è¿‡å›¾åºŠ</a>ã€‚è¿™ä¸ªå›¾åºŠä¹Ÿæ˜¯è›®å¹½é»˜çš„ï¼Œæ³¨å†Œæ—¶å¦‚æœæŒ‚ç€VPNï¼Œä¼šé©¬ä¸Šè§¦å‘å®‰å…¨æœºåˆ¶ï¼š</p><p><img src="https://i.imgur.com/bfFspUp.png" /></p><p>ä¸è¿‡è¿™ä¸ªå›¾åºŠå·²ç»ç¨³å®šè¿è¡Œäº†14å¹´ï¼Œæœ€å¤§æ”¯æŒ10Mçš„å›¾ç‰‡ï¼ŒåŒæ—¶å…·æœ‰å…¨çƒ CDNåŠ é€Ÿä»¥ç¡®ä¿é«˜é€Ÿã€ç¨³å®šã€‚æš‚æ—¶å°±å…ˆç”¨ç€è¿™ä¸ªå¥½äº†ã€‚</p><p>å‘è·¯è¿‡å›¾åºŠä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™ä¹Ÿè¦æ±‚å…³é—­VPNä»£ç†ï¼Œæ‰€ä»¥æœ€å¥½çš„åŠæ³•å°±æ˜¯ç›´æ¥åœ¨clashæ–°å»ºè§„åˆ™ï¼Œæ£€æµ‹åˆ°imgseå…³é”®è¯å°±èµ°ç›´è¿</p><p><img src="https://s21.ax1x.com/2025/04/21/pE5lxs0.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Theme</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java SE-Stream APIè¯¦è§£</title>
    <link href="/2025/04/18/java11/"/>
    <url>/2025/04/18/java11/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒï¼š<ahref="https://www.bilibili.com/video/BV1Vi421C73n/?spm_id_from=333.1387.list.card_archive.click&amp;vd_source=918a6909c997fbaf818d1fbc55d65ca9">Javaä¸­çš„æµã€å¹¶è¡Œæµ</a></p><p>æœ¬åšæ–‡ä¸ºè§†é¢‘å†…å®¹çš„ç®€å•æ¢³ç†ã€‚</p><h1 id="ç›®å½•">ç›®å½•</h1><h1 id="å¼•å…¥">å¼•å…¥</h1><p>å·²çŸ¥ä¸€ä¸ªåˆ—è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Person&gt; people = List.of(<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">12</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>);<br></code></pre></td></tr></table></figure><p>æ£€æŸ¥æ‰€æœ‰äººçš„ä¿¡æ¯ï¼Œæ‰¾å‡ºå¹´é¾„å¤§äº18å²çš„äººã€‚</p><p><strong>å‘½ä»¤å¼ç¼–ç¨‹</strong>ï¼Œä½¿ç”¨forå¾ªç¯ä¾æ¬¡æ£€æŸ¥æ¯ä¸€ä¸ªäººçš„ä¿¡æ¯ï¼Œå°†å¹´é¾„è¶…è¿‡åå…«å²çš„äººæ·»åŠ åˆ°æ–°çš„åå•ä¸­ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">12</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    <span class="hljs-comment">//åˆ›å»ºæ–°çš„åˆ—è¡¨ç”¨æ¥å­˜æ”¾ç»“æœ</span><br>    List&lt;Person&gt; adults = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span>(Person p : people) &#123;<br>        <span class="hljs-keyword">if</span>(p.getAge() &gt; <span class="hljs-number">18</span>) &#123;<br>            adults.add(p);<br>        &#125;<br>    &#125;<br>    System.out.println(adults);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<strong>Stream API</strong>å¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">12</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    List&lt;Person&gt; adults = people.stream()<br>            .filter(person -&gt; person.getAge() &gt; <span class="hljs-number">18</span>)<br>            .toList();<span class="hljs-comment">//æˆ–è€….collect(Collectors.toList());</span><br>    System.out.println(adults);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç æ›´åŠ ç®€æ´ã€‚</p><p>Streamæœ¬èº«å¹¶ä¸æ˜¯æ•°æ®ç»“æ„ï¼Œä¸ä¼šå¤„ç†æ•°æ®æˆ–æ”¹å˜æ•°æ®æºï¼Œå®ƒä»…å®šä¹‰å¤„ç†æ–¹å¼ã€‚ä¸ä»…èƒ½å¤Ÿæ”¯æŒé¡ºåºå¤„ç†ï¼Œè¿˜èƒ½è¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚</p><p><strong>Javaçš„Streamåªèƒ½ä½¿ç”¨ä¸€æ¬¡</strong>ï¼Œä¸€æ—¦ä½ è°ƒç”¨äº†ç»ˆç»“æ“ä½œï¼ˆæ¯”å¦‚.forEach()ã€.collect() ç­‰ï¼‰ï¼Œè¿™ä¸ªæµå°±è¢«â€œæ¶ˆè´¹æ‰â€äº†ï¼Œä¸èƒ½å†ç”¨ã€‚</p><p><strong>ä¸‰ä¸ªæ­¥éª¤</strong>ï¼š</p><ul><li><strong>åˆ›å»ºæµ</strong> Stream Creation</li><li><strong>ä¸­é—´æ“ä½œ</strong> Intermediate Operations<ul><li>ä¸­é—´æ“ä½œæ˜¯æƒ°æ€§æ‰§è¡Œçš„ï¼Œåªæœ‰é‡åˆ°ç»ˆç«¯æ“ä½œæ‰ä¼šå®é™…æ‰§è¡Œã€‚</li></ul></li><li><strong>ç»ˆç«¯æ“ä½œ</strong> Terminal Operations<ul><li>æ•´ä¸ªæµçš„å®é™…å¤„ç†éƒ¨åˆ†ï¼Œä»–ä¼šè§¦å‘ä¹‹å‰æ‰€æœ‰å®šä¹‰ä¸­çš„ä¸­é—´æ“ä½œï¼Œç”Ÿæˆæœ€ç»ˆç»“æœã€‚</li></ul></li></ul><p><img src="https://i.imgur.com/Pxty23E.png" /></p><p>ä¸‹é¢ä»è¿™ä¸‰ä¸ªæ–¹é¢è¿›è¡Œåˆ†æã€‚</p><h1 id="åˆ›å»ºæµ">åˆ›å»ºæµ</h1><p>å¯¹äºä»»ä½•å®ç°äº†<code>Collection</code>æ¥å£çš„é›†åˆï¼Œå¯ä»¥é€šè¿‡<code>stream()</code>æ–¹æ³•ç›´æ¥åˆ›å»ºæµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">String[] array = &#123;<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>,<span class="hljs-string">&quot;e&quot;</span>,<span class="hljs-string">&quot;f&quot;</span>&#125;;<br>Stream&lt;String&gt; stream = Arrays.stream(array);<br><br>stream.forEach(System.out::println);<br><br>List&lt;String&gt; list = List.of(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);<br>Stream&lt;String&gt; myStream = list.stream();<br>myStream.forEach(System.out::println);<br><br><span class="hljs-comment">//æ›´ç›´æ¥çš„æ–¹æ³•</span><br>Stream&lt;String&gt; stream1 = Stream.of(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>);<br></code></pre></td></tr></table></figure><hr /><p>é‡‡ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºçš„streamå¯¹è±¡è‡ªè¯ç”Ÿä¹‹åˆå°±æ˜¯å†™æ­»çš„ï¼Œæ— æ³•ä¿®æ”¹ã€‚æƒ³è¦<strong>åŠ¨æ€åˆ›å»ºæµ</strong>ï¼Œéœ€è¦ä½¿ç”¨<code>Stream.Builder</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åˆ›å»ºå¯¹è±¡</span><br>Stream.Builder&lt;String&gt; builder = Stream.builder();<br><span class="hljs-comment">//æ·»åŠ å…ƒç´ </span><br><span class="hljs-comment">//æ·»åŠ åæ— æ³•åˆ é™¤</span><br>builder.add(<span class="hljs-string">&quot;a&quot;</span>);<br>builder.add(<span class="hljs-string">&quot;b&quot;</span>);<br><span class="hljs-comment">//ä¹Ÿå¯æ ¹æ®æ¡ä»¶åŠ¨æ€æ·»åŠ </span><br><span class="hljs-keyword">if</span>(Math.random()&lt;<span class="hljs-number">0.5</span>)&#123;<br>    builder.add(<span class="hljs-string">&quot;c&quot;</span>);<br>&#125;<br><span class="hljs-comment">//é€šè¿‡buildæ–¹æ³•æ¥åˆ›å»ºstreamå¯¹è±¡</span><br>Stream&lt;String&gt; stream = builder.build();<br><span class="hljs-comment">//ä¸€æ—¦è°ƒç”¨äº†buildå°±ä¸èƒ½å†æ·»åŠ å…ƒç´ ï¼Œå¦åˆ™æ‰§è¡Œæ—¶æŠ¥é”™</span><br>stream.forEach(System.out::println);<br></code></pre></td></tr></table></figure><hr /><p>ä½¿ç”¨Streamä¹Ÿå¯<strong>ä»æ–‡ä»¶åˆ›å»ºæµ</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">&quot;D:\\develop\\code\\Practice\\chapter0\\hello_copy.txt&quot;</span>);<br>    <span class="hljs-keyword">try</span>(Stream&lt;String&gt; lines = Files.lines(path))&#123;<br>        lines.forEach(System.out::println);<span class="hljs-comment">//è¾“å‡ºåˆ°æ§åˆ¶å°</span><br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li><code>Files.lines(path, StandardCharsets.UTF_8)</code>è¿”å›ä¸€ä¸ªæƒ°æ€§è¯»å–çš„Streamï¼Œå¯ä»¥é€è¡Œè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹ã€‚</li><li><code>try-with-resources</code>ä¿è¯èµ„æºåŠæ—¶å…³é—­</li></ul><hr /><p>StreamAPIä¹Ÿæä¾›äº†<code>IntStream</code>ç­‰ç±»ç”¨æ¥æ–¹ä¾¿åœ°åˆ›å»º<strong>åŸºæœ¬æ•°æ®ç±»å‹çš„æµ</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">IntStream</span> <span class="hljs-variable">intStream</span> <span class="hljs-operator">=</span> IntStream.range(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>);<br><span class="hljs-type">IntStream</span> <span class="hljs-variable">intStream</span> <span class="hljs-operator">=</span> IntStream.of(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br><span class="hljs-comment">//é€šè¿‡boxedå¯ä»¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„æµè½¬æ¢ä¸ºå¯¹è±¡æµï¼š</span><br>Stream&lt;Integer&gt; integerStream = intStream.boxed();<br></code></pre></td></tr></table></figure><hr /><p>Stream.iterateå¯ç”Ÿæˆ<strong>æ— é™æµ</strong>ï¼ˆé€šå¸¸ç”¨limité™åˆ¶ç”Ÿæˆçš„ä¸ªæ•°ï¼‰ï¼š</p><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="hljs-title function_">iterate</span><span class="hljs-params">(<span class="hljs-keyword">final</span> T seed, <span class="hljs-keyword">final</span> UnaryOperator&lt;T&gt; f)</span><br></code></pre></td></tr></table></figure><ul><li><code>seed</code>:åˆå§‹å€¼</li><li><code>f</code>ï¼šä½œç”¨äºåˆå§‹å€¼çš„å‡½æ•°</li><li>è¿”å›å€¼ï¼šä¸€ä¸ªæ–°çš„Streamç±»å‹çš„åºåˆ—</li></ul><p>å¢å¼ºå‹ï¼š<code>public static&lt;T&gt; Stream&lt;T&gt; iterate(T seed, Predicate&lt;? super T&gt; hasNext, UnaryOperator&lt;T&gt; next)</code>ï¼Œå…¶ä¸­<code>hasNext</code>æ˜¯ç»ˆæ­¢æ¡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç”Ÿæˆä¸€ä¸ªç­‰å·®æ•°åˆ—</span><br>   Stream.iterate(<span class="hljs-number">0</span>, i -&gt; i + <span class="hljs-number">1</span>).limit(<span class="hljs-number">5</span>).forEach(System.out::println);<br></code></pre></td></tr></table></figure><hr /><p><strong>å¹¶è¡Œæµ</strong>ï¼šæŠŠæ•°æ®åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶â€œåŒæ—¶â€ç”¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œä»è€ŒåŠ å¿«å¤„ç†é€Ÿåº¦ã€‚</p><ul><li>å¯¹äºé›†åˆï¼Œè°ƒç”¨<code>list.parallelStraem()</code>å¯ä»¥ç›´æ¥å¾—åˆ°ä¸€ä¸ªå¹¶è¡Œæµã€‚ä¾‹å¦‚<code>List.of("a", "b", "c", "d", "e", "f").parallelStream().forEach(System.out::println);</code>ï¼Œè¾“å‡ºæ˜¯<strong>ä¹±åº</strong>çš„</li><li>å¯¹äºå·²æœ‰çš„Streamï¼Œå¯ä»¥è°ƒç”¨<code>.parallel()</code>å¾—åˆ°å¹¶è¡Œæµ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test5</span><span class="hljs-params">()</span> &#123;<br>    Stream&lt;Integer&gt; iterateStream = Stream.iterate(<span class="hljs-number">0</span>, n -&gt; n + <span class="hljs-number">1</span>).limit(<span class="hljs-number">5</span>);<br>    iterateStream.parallel();<br>    iterateStream.forEach(System.out::println);<br>    <span class="hljs-comment">//è¿™æ—¶çš„æ‰“å°é¡ºåºä¹Ÿæ˜¯ä¹±çš„ï¼Œå› ä¸ºforEachæ˜¯å¹¶å‘çš„ã€‚</span><br>    <span class="hljs-comment">//forEachOrderedå¯ä»¥ä¿è¯é¡ºåºã€‚</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä¸­é—´æ“ä½œ">ä¸­é—´æ“ä½œ</h1><p>ä¸­é—´æ“ä½œç”¨äºå¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå¦‚ç­›é€‰ã€æ’åºç­‰ç­‰ã€‚æ ¹æ®æ“ä½œçš„æ€§è´¨å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªç±»åˆ«ï¼š</p><ul><li><strong>ç­›é€‰å’Œåˆ‡ç‰‡</strong>(Filtering andSlicing):è¿‡æ»¤æˆ–ç¼©å‡æµä¸­çš„å…ƒç´ çš„æ•°é‡</li><li><strong>æ˜ å°„</strong>(Mapping):è½¬æ¢æµä¸­çš„å…ƒç´ æˆ–æå–å…ƒç´ çš„ç‰¹å®šå±æ€§</li><li><strong>æ’åº</strong>(Sorting)</li></ul><figure><img src="https://i.imgur.com/naZpiDN.png" alt="ä¸­é—´æ“ä½œå›¾è§£" /><figcaption aria-hidden="true">ä¸­é—´æ“ä½œå›¾è§£</figcaption></figure><h2 id="ç­›é€‰å’Œåˆ‡ç‰‡">ç­›é€‰å’Œåˆ‡ç‰‡</h2><p>ä¾‹å¦‚å¼€å¤´å¤„æåˆ°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Person&gt; adults = people.stream()<br>        .filter(myperson -&gt; myperson.getAge() &gt; <span class="hljs-number">18</span>)<br>        .toList();<span class="hljs-comment">//æˆ–è€….collect(Collectors.toList());</span><br></code></pre></td></tr></table></figure><p><strong>è¿‡æ»¤å™¨å®šä¹‰</strong>:</p><p><code>Stream&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate);</code></p><p>Predicateå³<strong>åˆ¤æ–­æ¡ä»¶å‡½æ•°</strong>ï¼Œç”¨lambdaå†™å‡ºï¼Œè¿”å›å¸ƒå°”å€¼ã€‚æ„æ€æ˜¯:<em>ç»™æˆ‘ä¸€ä¸ªå«myperson çš„å‚æ•°ï¼Œåˆ¤æ–­è¿™ä¸ªäººå¹´é¾„æ˜¯å¦å¤§äº 18ï¼Œè¿”å›ä¸€ä¸ª true/falseç»“æœ</em>ã€‚<code>myperson</code>çš„ç±»å‹ç”±å‰æ–‡è‡ªåŠ¨æ¨æ–­å‡ºï¼Œæ‰€ä»¥çœç•¥ã€‚</p><p>è¿™é‡Œç­‰ä»·äºç”¨æ›´ç®€æ´çš„å½¢å¼å®ç°äº†<code>Predicate</code>æ¥å£çš„æŠ½è±¡æ–¹æ³•<code>boolean test(T t);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Predicate&lt;Person&gt; predicate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Predicate</span>&lt;Person&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Person person)</span> &#123;<br>        <span class="hljs-keyword">return</span> person.getAge() &gt; <span class="hljs-number">18</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><hr /><p>å¯ä»¥ç”¨<code>.distinct()</code>ä¸ºæµä¸­çš„å…ƒç´ <strong>å»é‡</strong>ï¼Œåº•å±‚é€šè¿‡ç»´æŠ¤ä¸€ä¸ªHashSetå®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//</span><br>    Stream.of(<span class="hljs-string">&quot;Origami&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-string">&quot;Kurumi&quot;</span>)<br>            .distinct()<br>            .forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ç±»çš„å¯¹è±¡ï¼Œéœ€è¦ç¡®ä¿æ­£ç¡®åœ°é‡å†™äº†<code>equals()``HashCode</code>æ–¹æ³•ï¼Œå› ä¸ºHashSetå°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•åˆ¤æ–­å…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚</p><hr /><p>Streamç±»ä¸­å®šä¹‰çš„<code>Stream&lt;T&gt; limit(long maxSize);</code>æ–¹æ³•è¿”å›ç”±æ­¤æµçš„å…ƒç´ ç»„æˆçš„æˆªæ–­é•¿åº¦ä¸è¶…è¿‡maxSizeçš„æµã€‚</p><p>åŒæ ·ï¼Œ<code>Stream&lt;T&gt; skip(long n);</code>è·³è¿‡å‰nä¸ªå…ƒç´ ã€‚</p><p>limitå’Œskipåœ¨æœ‰åºçš„å¹¶è¡Œæµä¸­ä½¿ç”¨æ—¶å¯èƒ½ä¼šä½¿æ€§èƒ½å˜å·®ï¼Œæ­¤æ—¶å¯ä»¥ç”¨<code>.unordered()</code> æé«˜æ•ˆç‡ï¼›å¦‚æœé¡ºåºå¿…é¡»ä¿ç•™ï¼Œé‚£æœ€å¥½ä½¿ç”¨é¡ºåºæµ<code>.sequential()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test4</span><span class="hljs-params">()</span> &#123;<br>    Stream&lt;Integer&gt; s1 = Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);<br>    s1.limit(<span class="hljs-number">5</span>).forEach(System.out::print);<br><br>    Stream&lt;Integer&gt; s2 = Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);<br>    s2.skip(<span class="hljs-number">5</span>).forEach(System.out::print);<br>    <span class="hljs-comment">//æ‰“å°ç»“æœï¼š12345678910</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ˜ å°„">æ˜ å°„</h2><p>æ˜ å°„æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®è½¬æ¢çš„è¿‡ç¨‹</p><p><strong>å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;R&gt; Stream&lt;R&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(Function&lt;? <span class="hljs-built_in">super</span> T, ? extends R&gt; mapper)</span>;<br></code></pre></td></tr></table></figure><p><code>T</code>æ˜¯Streamä¸­å…ƒç´ çš„ç±»å‹ï¼Œ<code>R</code>æ–°çš„æµçš„å…ƒç´ ç±»å‹</p><p>mapèƒ½å¤Ÿé€šè¿‡æä¾›çš„å‡½æ•°<code>Function</code>å°†æµä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢æˆæ–°çš„å…ƒç´ ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªæ–°å…ƒç´ æ„æˆçš„æµã€‚</p><p>mapæ¥å—çš„æ˜¯ä¸€ä¸ª<strong>å‡½æ•°å¼æ¥å£</strong>ã€‚</p><figure><img src="https://i.imgur.com/Yk5xhTe.png"alt="åˆ©ç”¨æ˜ å°„å±‚å±‚æå–æ•°æ®çš„è¿‡ç¨‹" /><figcaption aria-hidden="true">åˆ©ç”¨æ˜ å°„å±‚å±‚æå–æ•°æ®çš„è¿‡ç¨‹</figcaption></figure><p>ç¤ºä¾‹ï¼šåˆ©ç”¨æ˜ å°„è·å¾—Personåˆ—è¡¨ä¸­æ‰€æœ‰äººçš„name</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test6</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">12</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br><br>    Stream&lt;Person&gt; peopleStream = people.stream();<br>    <span class="hljs-comment">//peopleStream.map(myperson -&gt; myperson.getName()).forEach(System.out::println);</span><br>    <span class="hljs-comment">//æ–¹æ³•å¼•ç”¨çš„æ ¼å¼ï¼šç±»åæˆ–å¯¹è±¡å::æ–¹æ³•å</span><br>    peopleStream.map(Person::getName).forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">Neo<br>Blu<br>Alex<br>Bob<br>Kurumi<br>Kurumi<br></code></pre></td></tr></table></figure><hr /><p><code>map</code>ç»“æ„é€‚ç”¨äº<strong>å•å±‚ç»“æ„</strong>çš„æµï¼Œè¿›è¡Œå…ƒç´ <strong>ä¸€å¯¹ä¸€</strong>çš„è½¬æ¢ã€‚</p><p>å¯¹äºåµŒå¥—çš„é›†åˆï¼Œæ•°ç»„ç­‰ç­‰ï¼Œé€‚åˆä½¿ç”¨<code>flatMap</code>ã€‚</p><p><img src="https://i.imgur.com/sq8UWmE.png" /></p><p><strong>å®šä¹‰</strong>ï¼š<code>Stream.java</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;R&gt; Stream&lt;R&gt; <span class="hljs-title function_">flatMap</span><span class="hljs-params">(Function&lt;? <span class="hljs-built_in">super</span> T, ? extends Stream&lt;? extends R&gt;&gt; mapper)</span>;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šå°†åµŒå¥—Listè½¬æ¢æˆçš„æµæ‰å¹³åŒ–ä¸ºå•å±‚æµæ‰“å°å‡ºæ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test7</span><span class="hljs-params">()</span> &#123;<br>    List&lt;List&lt;Person&gt;&gt; peopleGroups = List.of(<br>            List.of(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;neo&quot;</span>, <span class="hljs-number">45</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Stan&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&quot;USA&quot;</span>)<br>            ),<br>            List.of(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Grace&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-string">&quot;UK&quot;</span>),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">17</span>, <span class="hljs-string">&quot;UK&quot;</span>)<br>            ),<br>            List.of(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Sebastian&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&quot;FR&quot;</span>)<br>            )<br>    );<br><br>    Stream&lt;List&lt;Person&gt;&gt; peopleGroupStream = peopleGroups.stream();<br>    <span class="hljs-comment">//è½¬æ¢æˆå•å±‚æµ  æ‰å¹³åŒ–  å•ä¸€åŒ–</span><br>    Stream&lt;Person&gt; personStream = peopleGroupStream.flatMap(people -&gt; people.stream());<br>    personStream.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>æµæ“ä½œè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„æµï¼ŒåŸå§‹æµåœ¨ç¬¬ä¸€æ¬¡æ“ä½œåå°±ä¼šè¢«æ ‡è®°ä¸ºå·²æ“ä½œï¼Œä¸èƒ½å†æ¬¡è¿›è¡Œæ“ä½œã€‚å®é™…åº”ç”¨ä¸­é€šå¸¸ä¼šé‡‡ç”¨<strong>é“¾å¼æ“ä½œ</strong>:</p><p><img src="https://i.imgur.com/lZ0Yc3R.png" /></p><p>åµŒå¥—æµ -&gt; å•å±‚æµ -&gt; æå–nameå±æ€§ -&gt; æ‰“å°</p><hr /><p><code>mapToInt</code>å¯ä»¥å°†å¯¹è±¡æµè½¬æ¢ä¸ºåŸºç¡€ç±»å‹çš„æµ<code>IntStream</code>ã€‚</p><hr /><h2 id="æ’åº">æ’åº</h2><p>å½“æµä¸­çš„å…ƒç´ ç±»å‹å®ç°äº†<code>Comparable</code>æ¥å£æ—¶ï¼ˆè‡ªç„¶æ’åºï¼‰ï¼Œå¯ç›´æ¥è°ƒç”¨<code>sorted()</code>ã€‚</p><p>å®šåˆ¶æ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test10</span><span class="hljs-params">()</span> &#123;<br>    Stream.of(<span class="hljs-string">&quot;blueberry&quot;</span>, <span class="hljs-string">&quot;greenberry&quot;</span>, <span class="hljs-string">&quot;redberry&quot;</span>, <span class="hljs-string">&quot;pear&quot;</span>, <span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;orange&quot;</span>)<br>            .sorted(Comparator.comparingInt(String::length).reversed())<br>            .forEach(System.out::println);<br>            <span class="hljs-comment">//å¹´é¾„é™åº</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å…³äº<code>Comparator.comparingInt(String::length).reversed()</code>:</p><ul><li><code>comparingInt</code>æ˜¯Comparatorçš„ä¸€ä¸ªæ–¹æ³•</li><li>ç›¸å½“äº<code>Comparator.comparingInt(p -&gt; p.getAge())</code>ï¼Œå°†Ageä½œä¸ºæ’åºçš„æ ‡å‡†</li><li><code>comparingInt</code>å’Œ<code>reversed()</code>å¹¶åˆ—å®šä¹‰ï¼Œä½†æ˜¯å‰è€…è¿”å›çš„ä»ç„¶æ˜¯ä¸€ä¸ª<code>Comparator&lt;T&gt;</code>å¯¹è±¡ï¼Œåè€…æ˜¯ä¸€ä¸ªComparatorçš„é»˜è®¤æ–¹æ³•ï¼Œåªè¦æ˜¯<code>Comparator&lt;T&gt;</code>çš„å¯¹è±¡å°±å¯ä»¥è°ƒç”¨å®ƒã€‚</li></ul><hr /><p>ä¸­é—´æ“ä½œåªæ˜¯å®šä¹‰äº†æ“ä½œçš„è§„åˆ™ï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œå¸¸å¸¸ç”¨å˜é‡ä¿å­˜å’Œä¼ é€’ã€‚</p><p>ç»¼åˆç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    List&lt;List&lt;Person&gt;&gt; peopleGroups = List.of(<br>            List.of(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;neo&quot;</span>, <span class="hljs-number">45</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Stan&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&quot;USA&quot;</span>)<br>            ),<br>            List.of(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Grace&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-string">&quot;UK&quot;</span>),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&quot;UK&quot;</span>)<br>            ),<br>            List.of(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Sebastian&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&quot;FR&quot;</span>),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Sebastian&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&quot;FR&quot;</span>)<br>            )<br>    );<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰å¹³åŒ–ã€å»é‡ã€å¹´é¾„å¤§äº18ã€æ˜ å°„åˆ°nameã€æŒ‰ç…§åå­—çš„é•¿åº¦æ’åº</span><br><span class="hljs-comment">     */</span><br>    Stream&lt;String&gt; s= peopleGroups.stream()<br>            .flatMap(List::stream)<br>            .distinct()<br>            .filter(person -&gt; person.getAge() &gt; <span class="hljs-number">18</span>)<span class="hljs-comment">//ç­›é€‰</span><br>            .map(Person::getName)<br>            .sorted(Comparator.comparing(String::length));<span class="hljs-comment">//æ˜ å°„ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„åå­—ä¹‹åå†æŒ‰ç…§å­—ç¬¦ä¸²çš„é•¿åº¦æ’åº;</span><br>    <br>    <span class="hljs-comment">//è§¦å‘æ‰§è¡Œæ“ä½œ</span><br>    s.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç»ˆç«¯æ“ä½œ">ç»ˆç«¯æ“ä½œ</h1><p>ç»ˆç«¯æ“ä½œæ˜¯æµå¤„ç†çš„æœ€ç»ˆæ­¥éª¤ï¼Œå®å¼¹å‘ç”Ÿï¼Œæµä¸­çš„å…ƒç´ è¢«æ¶ˆè´¹ï¼Œæµä¸èƒ½å†è¢«ä½¿ç”¨ã€‚</p><p>ç»ˆç«¯æ“ä½œåŒ…æ‹¬æŸ¥æ‰¾ä¸åŒ¹é…ã€èšåˆæ“ä½œã€å½’çº¦æ“ä½œã€æ”¶é›†æ“ä½œã€è¿­ä»£æ“ä½œã€‚</p><p><img src="https://i.imgur.com/mg7OIu4.png" /></p><h2 id="æŸ¥æ‰¾ä¸åŒ¹é…">æŸ¥æ‰¾ä¸åŒ¹é…</h2><p>å±äºçŸ­è·¯æ“ä½œ(Short-circuitingOperations),ä¹Ÿå°±æ˜¯è¯´è¿™äº›æ“ä½œåœ¨æ‰¾åˆ°æ‰€éœ€çš„å…ƒç´ åä¼šç«‹å³è¿”å›ç»“æœ,ä¸ä¼šéå†æ•´ä¸ªæµ.</p><ul><li><code>anyMatch</code>:å¦‚æœæµä¸­ä»»æ„å…ƒç´ æ»¡è¶³ç»™å®šçš„æ¡ä»¶åˆ™è¿”å›true</li><li><code>noneMatch</code>:ä¸å‰è€…ç›¸å</li><li><code>allMatch</code>:æ‰€æœ‰çš„éƒ½æ»¡è¶³æ‰ä¼šè¿”å›true</li></ul><hr /><ul><li><code>Optional&lt;T&gt; findFirst();</code>æ‰¾åˆ°æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ,ç±»å‹ä¸º<code>Optional</code>.å› ä¸ºè¿”å›çš„å…ƒç´ å¯èƒ½ä¸ºç©º,è¿™æ ·åšçš„è¯æ›´åŠ å®‰å…¨.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">12</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    Optional&lt;Person&gt; optionalPerson = people.stream().findFirst();<br>    <span class="hljs-comment">//ifPresent:å¦‚æœå€¼å­˜åœ¨ï¼Œå°±æ‰§è¡Œæ‹¬å·é‡Œçš„æ“ä½œï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åš.</span><br>    optionalPerson.ifPresent(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Person&#123;name=&#x27;Neo&#x27;, age=1, country=&#x27;USA&#x27;&#125;<br></code></pre></td></tr></table></figure><ul><li><code>findAny</code>:è¿”å›ä»»æ„ä¸€ä¸ªå…ƒç´ </li></ul><h2 id="èšåˆæ“ä½œ">èšåˆæ“ä½œ</h2><ul><li><code>long count();</code>:è®¡ç®—å…ƒç´ çš„æ•°é‡</li><li><code>Optional&lt;T&gt; max(Comparator&lt;? super T&gt; comparator);</code>:è¿”å›æµä¸­çš„æœ€å¤§å…ƒç´ ,éœ€è¦æä¾›ä¸€ä¸ªæ¯”è¾ƒå™¨.</li><li>åŒç†è¿˜æœ‰<code>min</code></li></ul><hr /><ul><li><code>sum()</code>ç”¨äºæ±‚å’Œ,åªèƒ½å¤„ç†åŸºæœ¬æ•°æ®ç±»å‹çš„æµ,æ‰€ä»¥ä½¿ç”¨ä¹‹å‰è¦è¿›è¡Œæµç±»å‹çš„è½¬æ¢.</li><li><code>average</code>åŒä¸Š</li></ul><p>æœ¬è´¨ä¸Šèšåˆæ“ä½œæ˜¯å½’çº¦æ“ä½œçš„ä¸€ç§ç‰¹æ®Šå½¢å¼,é€‚åˆå¿«é€Ÿç®€å•çš„ç»Ÿè®¡ä»»åŠ¡.å½’çº¦æ“ä½œreduceæ›´åŠ é€šç”¨.</p><h2 id="å½’çº¦æ“ä½œ">å½’çº¦æ“ä½œ</h2><p>æ•´å‹çš„reduceå®šä¹‰å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-title function_">reduce</span><span class="hljs-params">(<span class="hljs-type">int</span> identity, IntBinaryOperator op)</span>;<br></code></pre></td></tr></table></figure><p>Javaæä¾›çš„æ³¨è§£:</p><blockquote><p>å¯¹è¯¥æµçš„å…ƒç´ æ‰§è¡Œå½’çº¦æ“ä½œï¼Œä½¿ç”¨æä¾›çš„æ ‡è¯†å€¼ï¼ˆidentityï¼‰å’Œä¸€ä¸ªå…³è”çš„ç´¯ç§¯å‡½æ•°ï¼ˆaccumulationfunctionï¼‰ï¼Œå¹¶è¿”å›å½’çº¦åçš„ç»“æœã€‚å…¶ç­‰ä»·äºä»¥ä¸‹ä»£ç ï¼š <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> identity;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> element : <span class="hljs-built_in">this</span> stream)<br>    result = accumulator.applyAsInt(result, element)<br><span class="hljs-keyword">return</span> result;<br></code></pre></td></tr></table></figure>å³,å…ˆæŠŠ identityçš„å€¼èµ‹ç»™ç»“æœ,ç„¶åå†ä½¿ç”¨ç´¯è®¡å‡½æ•°å¯¹ç»“æœå’Œæµä¸­çš„å…ƒç´ è¿›è¡Œè¿ç®—.<br />è¿™ç§å½’çº¦ä¸ä¸€å®šæŒ‰é¡ºåºæ‰§è¡Œï¼ˆå³å®ƒå¯ä»¥å¹¶è¡Œå¤„ç†ï¼‰ã€‚<br />identityå¿…é¡»æ˜¯ä¸€ä¸ª<strong>æ’ç­‰å…ƒ</strong>,ä¹Ÿå°±æ˜¯è¯´ç´¯è®¡å‡½æ•°ä½œç”¨åœ¨å®ƒèº«ä¸Šä¹‹åçš„ç»“æœä»ç„¶ç­‰äºå®ƒæœ¬èº«.ä¾‹å¦‚:<br />åŠ æ³•çš„æ’ç­‰å…ƒæ˜¯0,å› ä¸º 0 + x = x<br />ä¹˜æ³•çš„æ’ç­‰å…ƒæ˜¯1,å› ä¸º1 * x = x<br />æ­¤å¤–ï¼Œç´¯ç§¯å‡½æ•°å¿…é¡»æ˜¯<strong>å¯ç»“åˆçš„</strong>ï¼ˆassociativeï¼‰å‡½æ•°,ä¹Ÿå°±æ˜¯ç¬¦åˆç»“åˆå¾‹,è®¡ç®—é¡ºåºä¸å½±å“ç»“æœ.</p></blockquote><p><strong>å½¢å‚</strong>:</p><ul><li><code>identity</code>:ç´¯ç§¯å‡½æ•°çš„æ’ç­‰å…ƒ</li><li><code>op</code>:ä¸€ä¸ªå¯ç»“åˆçš„,æ— å‰¯ä½œç”¨(å‡½æ•°åœ¨å¤„ç†å€¼æ—¶ä¸åº”è¯¥ä¿®æ”¹å¤–éƒ¨çŠ¶æ€)çš„,æ— çŠ¶æ€çš„å‡½æ•°</li></ul><p><strong>è¿”å›å€¼</strong>:å½’çº¦çš„ç»“æœ</p><p>å¯¹ä¸€ä¸ªæµä¸­çš„æ‰€æœ‰å…ƒç´ æ±‚å’Œ,å¯ä»¥å†™ä¸º<code>int sum = integers.reduce(0, (a, b) -&gt; a+b);</code><br />æˆ–è€…æ›´ç®€æ´ä¸€ç‚¹<code>int sum = integers.reduce(0, Integer::sum);</code></p><p>è™½ç„¶ç›¸æ¯”äºåœ¨å¾ªç¯ä¸­ç›´æ¥ä¿®æ”¹ä¸€ä¸ªè¿è¡Œä¸­çš„æ€»å’Œå˜é‡ï¼Œè¿™ç§æ–¹å¼çœ‹èµ·æ¥æœ‰äº›ç»•è¿œè·¯ï¼Œä½†å½’çº¦ï¼ˆreductionï¼‰æ“ä½œåœ¨å¹¶è¡ŒåŒ–æ—¶è¡¨ç°å¾—æ›´åŠ ä¼˜é›…ï¼Œæ— éœ€é¢å¤–çš„åŒæ­¥ï¼ˆsynchronizationï¼‰ï¼Œå¹¶ä¸”å¤§å¤§é™ä½äº†æ•°æ®ç«äº‰ï¼ˆdataracesï¼‰çš„é£é™©ã€‚</p><hr /><p>ä¾‹:å¯¹æµçš„æ‰€æœ‰å…ƒç´ çš„å¹´é¾„æ±‚å’Œ,ç„¶åè¾“å‡ºæ‰€æœ‰äººåå­—çš„ä¸²æ¥å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">13</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    <span class="hljs-comment">//è®¡ç®—å¹´é¾„çš„å’Œ</span><br>    <span class="hljs-type">IntStream</span> <span class="hljs-variable">doubleStream</span> <span class="hljs-operator">=</span> people.stream().mapToInt(Person::getAge);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> doubleStream.reduce(<span class="hljs-number">0</span>, (a,b) -&gt; (a + b));<br>    System.out.println(sum);<br><br>    <span class="hljs-comment">//å°†æ‰€æœ‰äººçš„åå­—ä¸²æ¥èµ·æ¥</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">joinedName</span> <span class="hljs-operator">=</span> people.stream()<br>            .map(Person::getName)<br>            .reduce(<span class="hljs-string">&quot;&quot;</span>, (a, b) -&gt; a + b);<br>    System.out.println(joinedName);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">86<br>NeoBluAlexBobKurumi<br></code></pre></td></tr></table></figure><h2 id="æ”¶é›†æ“ä½œ">æ”¶é›†æ“ä½œ</h2><p>æŠŠæµå¤„ç†åçš„å…ƒç´ æ±‡é›†åˆ°æ–°çš„æ•°æ®ç»“æ„ä¸­, æ¯”å¦‚åˆ—è¡¨, map, é›†åˆç­‰ç­‰.</p><p><strong>å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;R, A&gt; R <span class="hljs-title function_">collect</span><span class="hljs-params">(Collector&lt;? <span class="hljs-built_in">super</span> T, A, R&gt; collector)</span>;<br></code></pre></td></tr></table></figure><p><code>Collectors.java</code>ä¸­æä¾›äº†ä¸°å¯Œçš„<strong>é™æ€æ–¹æ³•</strong>ç”¨ä½œcollectorå‚æ•°.å¦‚<code>toList</code>,<code>toMap</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ”¶é›†å¹´é¾„å¤§äº18å²çš„äºº</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test4</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">13</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    List&lt;Person&gt; adults = people.stream()<br>            .filter(person -&gt; person.getAge() &gt; <span class="hljs-number">18</span>)<br>            .collect(Collectors.toList());<span class="hljs-comment">//ä½¿ç”¨Collectorsæä¾›çš„æ–¹æ³•</span><br>    System.out.println(adults);<br>&#125;<br></code></pre></td></tr></table></figure><hr /><p><strong>åˆ†ç»„</strong>:<code>Collectors</code>ç±»æä¾›çš„é™æ€æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T, K&gt; Collector&lt;T, ?, Map&lt;K, List&lt;T&gt;&gt;&gt;<br> groupingBy(Function&lt;? <span class="hljs-built_in">super</span> T, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">K</span>&gt; classifier) &#123;<br>     <span class="hljs-keyword">return</span> groupingBy(classifier, toList());<br> &#125;<br></code></pre></td></tr></table></figure><ul><li><code>T</code>:æµä¸­å…ƒç´ çš„ç±»å‹,ä¾‹å¦‚<code>Person</code></li><li><code>K</code>:ç”¨äºåˆ†ç»„çš„é”®çš„ç±»å‹</li><li><strong>å½¢å‚</strong>:<code>classifier</code>,å°†è¾“å…¥å…ƒç´ æ˜ å°„åˆ°é”®çš„åˆ†ç±»å™¨å‡½æ•°</li><li><strong>è¿”å›å€¼</strong>:å®ç°åˆ†ç»„æ“ä½œçš„æ”¶é›†å™¨,å°†<code>Stream&lt;T&gt;</code>æ”¶é›†æˆä¸€ä¸ª<code>Map&lt;K, List&lt;T&gt;&gt;</code>.<ul><li>key:ç”±classifierç”Ÿæˆ</li><li>value:åˆ†åˆ°è¯¥ç»„çš„<code>T</code>å…ƒç´ ç»„æˆçš„åˆ—è¡¨</li></ul></li></ul><p>ç¤ºä¾‹:æ ¹æ®å›½å®¶åˆ†ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test6</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">13</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    Map&lt;String, List&lt;Person&gt;&gt; collect = people.stream()<br>            .collect(Collectors.groupingBy(Person::getCountry));<br>    collect.forEach((k, v) -&gt; System.out.println(k + <span class="hljs-string">&quot; = &quot;</span> + v));<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>T</code>åœ¨è¿™é‡Œå³<code>Person</code></li><li>è¿™é‡Œçš„åˆ†ç±»å™¨æ˜¯<code>(Person::getCountry)</code>,æ‰€ä»¥é”®çš„ç±»å‹æ˜¯<code>String</code></li><li>æœ€ç»ˆå¾—åˆ°çš„Mapæ³›å‹ä¸º<code>Map&lt;String, List&lt;Person&gt;&gt;</code></li></ul><p>æ‰“å°ç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">USA = [Person&#123;name=&#x27;Neo&#x27;, age=1, country=&#x27;USA&#x27;&#125;]<br>Japan = [Person&#123;name=&#x27;Kurumi&#x27;, age=18, country=&#x27;Japan&#x27;&#125;]<br>China = [Person&#123;name=&#x27;Blu&#x27;, age=13, country=&#x27;China&#x27;&#125;]<br>Germany = [Person&#123;name=&#x27;Alex&#x27;, age=29, country=&#x27;Germany&#x27;&#125;, Person&#123;name=&#x27;Bob&#x27;, age=25, country=&#x27;Germany&#x27;&#125;]<br></code></pre></td></tr></table></figure><hr /><p><strong>åˆ†åŒº</strong>åŠŸèƒ½åŒç†,è°ƒç”¨<code>Collectors.partitioningBy</code>å³å¯,ä¸è¿‡è¿™æ—¶ä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­å¼, mapçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå˜æˆäº†booleanå˜é‡.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;Boolean, List&lt;Person&gt;&gt; agePartition = people.stream()<br>                .collect(Collectors.partitioningBy(person -&gt; person.getAge() &gt; <span class="hljs-number">18</span>));<br>        agePartition.forEach((k, v) -&gt; System.out.println(k + <span class="hljs-string">&quot; = &quot;</span> + v));<br></code></pre></td></tr></table></figure><hr /><p><code>Collectors</code>ä¹Ÿæä¾›äº†æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•<code>joining</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">joinedName</span> <span class="hljs-operator">=</span> people.stream()<br>        .map(Person::getName)<br>        .collect(Collectors.joining(<span class="hljs-string">&quot;,&quot;</span>));<br>System.out.println(joinedName);<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Neo,Blu,Alex,Bob,Kurumi<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨<code>Collectors.joining</code>è¿æ¥å­—ç¬¦ä¸².</p><hr /><p>ä½¿ç”¨<code>Collectors.summarizingInt</code>å¯ä»¥<strong>æ±‡æ€»</strong>æŒ‡å®šçš„æ•°æ®,è¿”å›ç±»å‹ä¸º<code>IntSummaryStatistics</code>,ä½¿ç”¨<code>IntSummaryStatistics</code>çš„<code>get</code>æ–¹æ³•å¯ä»¥å¿«é€Ÿè·å–æœ€å¤§å€¼,æœ€å°å€¼, å¹³å‡å€¼ç­‰ç­‰.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test7</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">13</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    <span class="hljs-type">String</span> <span class="hljs-variable">joinedName</span> <span class="hljs-operator">=</span> people.stream()<br>            .map(Person::getName)<br>            .collect(Collectors.joining(<span class="hljs-string">&quot;,&quot;</span>));<span class="hljs-comment">//è¾“å‡ºåˆå¹¶çš„å­—ç¬¦ä¸²</span><br>    System.out.println(joinedName);<br><br>    <span class="hljs-type">IntSummaryStatistics</span> <span class="hljs-variable">collect</span> <span class="hljs-operator">=</span> people.stream()<br>            .collect(Collectors.summarizingInt(Person::getAge));<br>    <span class="hljs-comment">//æ‰“å°collectçš„æ‰€æœ‰å±æ€§(æ•°é‡,å’Œ,æœ€å°å€¼,å¹³å‡å€¼,æœ€å¤§å€¼)</span><br>    System.out.println(collect);<br>    <span class="hljs-comment">//æŒ‡å®šè·å–æœ€å¤§å€¼</span><br>    System.out.println(collect.getMax());<br>    <span class="hljs-comment">//æŒ‡å®šè·å–æœ€å°å€¼</span><br>    System.out.println(collect.getMin());<br>&#125;<br></code></pre></td></tr></table></figure><hr /><p><strong>è‡ªå®šä¹‰æ”¶é›†å™¨</strong></p><p><code>Collector.of(...)</code>çš„äº”ä¸ªå‚æ•°ç»“æ„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Collector.of(<br>    Supplier&lt;R&gt; supplier,                         <span class="hljs-comment">// åˆ›å»ºä¸­é—´ç»“æœå®¹å™¨</span><br>    BiConsumer&lt;R, T&gt; accumulator,                <span class="hljs-comment">// å¦‚ä½•æ·»åŠ å…ƒç´ </span><br>    BinaryOperator&lt;R&gt; combiner,                  <span class="hljs-comment">// åˆå¹¶ä¸¤ä¸ªéƒ¨åˆ†ç»“æœ</span><br>    Function&lt;R, R&gt; finisher,                     <span class="hljs-comment">// æœ€ç»ˆå˜æ¢ç»“æœï¼ˆå¯é€‰ï¼‰</span><br>    Collector.Characteristics... characteristics <span class="hljs-comment">// ç‰¹å¾æ ‡è®°</span><br>)<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">customTest</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Person&gt; people = List.of(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Neo&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;USA&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Blu&quot;</span>, <span class="hljs-number">13</span>, <span class="hljs-string">&quot;China&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alex&quot;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;Germany&quot;</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Kurumi&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;Japan&quot;</span>)<br>    );<br>    ArrayList&lt;Person&gt; collect = people.stream()<span class="hljs-comment">//.parallel()</span><br>            .collect(Collector.of(<br>                    () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(), <span class="hljs-comment">//åˆ›å»ºç©ºå®¹å™¨</span><br>                    (list, person) -&gt; &#123;      <span class="hljs-comment">//ç´¯åŠ å™¨é€»è¾‘æŠŠä¸€ä¸ª person æ·»åŠ åˆ°å½“å‰çº¿ç¨‹ç»´æŠ¤çš„ list é‡Œ</span><br>                        System.out.println(<span class="hljs-string">&quot;Accumulator: &quot;</span> + person);<br>                        list.add(person);<br>                    &#125;,<br>                    (left, right) -&gt; &#123;       <span class="hljs-comment">//åˆå¹¶å¤šä¸ªçº¿ç¨‹çš„ä¸­é—´ç»“æœ,åªåœ¨å¹¶è¡Œæµèµ·ä½œç”¨</span><br>                        System.out.println(<span class="hljs-string">&quot;Combiner: &quot;</span> + left);<br>                        left.addAll(right);<br>                        <span class="hljs-keyword">return</span> left;<br>                    &#125;,<br>                    Collector.Characteristics.IDENTITY_FINISH<span class="hljs-comment">//è¡¨ç¤ºä¸éœ€è¦å˜æ¢,ä¸­é—´æ“ä½œçš„ç»“æœå°±æ˜¯æœ€ç»ˆç»“æœ</span><br>            ));<br>    System.out.println(collect);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">Accumulator: Person&#123;name=&#x27;Neo&#x27;, age=1, country=&#x27;USA&#x27;&#125;<br>Accumulator: Person&#123;name=&#x27;Blu&#x27;, age=13, country=&#x27;China&#x27;&#125;<br>Accumulator: Person&#123;name=&#x27;Alex&#x27;, age=29, country=&#x27;Germany&#x27;&#125;<br>Accumulator: Person&#123;name=&#x27;Bob&#x27;, age=25, country=&#x27;Germany&#x27;&#125;<br>Accumulator: Person&#123;name=&#x27;Kurumi&#x27;, age=18, country=&#x27;Japan&#x27;&#125;<br>[Person&#123;name=&#x27;Neo&#x27;, age=1, country=&#x27;USA&#x27;&#125;, Person&#123;name=&#x27;Blu&#x27;, age=13, country=&#x27;China&#x27;&#125;, Person&#123;name=&#x27;Alex&#x27;, age=29, country=&#x27;Germany&#x27;&#125;, Person&#123;name=&#x27;Bob&#x27;, age=25, country=&#x27;Germany&#x27;&#125;, Person&#123;name=&#x27;Kurumi&#x27;, age=18, country=&#x27;Japan&#x27;&#125;]<br><br></code></pre></td></tr></table></figure><p>ï¼ˆè¿™ä¸€å—æ²¡çœ‹å¤ªæ‡‚ï¼Œå…ˆæ”¾åˆ°è¿™é‡Œä»¥åå†æ¥çœ‹ï¼‰</p><h1 id="å¹¶è¡Œæµ">å¹¶è¡Œæµ</h1><p>Parallel Streams</p><p>èƒ½å¤Ÿå€ŸåŠ©<strong>å¤šæ ¸å¤„ç†å™¨</strong>çš„<strong>å¹¶è¡Œè®¡ç®—èƒ½åŠ›</strong>åŠ é€Ÿæ•°æ®å¤„ç†,ç‰¹åˆ«é€‚åˆå¤§å‹æ•°æ®é›†æˆ–è®¡ç®—å¯†é›†å‹ä»»åŠ¡.</p><h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2><ul><li>å¹¶è¡Œæµåœ¨å¼€å§‹æ—¶, Spliteratoråˆ†å‰²è¿­ä»£å™¨å°†æ•°æ®åˆ†å‰²æˆå¤šä¸ªç‰‡æ®µ,åˆ†å‰²è¿‡ç¨‹é€šå¸¸é‡‡ç”¨é€’å½’çš„æ–¹å¼åŠ¨æ€è¿›è¡Œ, ä»¥æ­¤å¹³è¡¡å­ä»»åŠ¡çš„å·¥ä½œè´Ÿè½½,æé«˜èµ„æºåˆ©ç”¨ç‡.</li><li>ç„¶åFork/Joinæ¡†æ¶å°†è¿™äº›æ•°æ®ç‰‡æ®µåˆ†é…åˆ°å¤šä¸ªçº¿ç¨‹å’Œå¤„ç†å™¨æ ¸å¿ƒä¸Šè¿›è¡Œå¹¶è¡Œå¤„ç†.</li><li>å¤„ç†å®Œæˆå, ç»“æœå°†ä¼šè¢«æ±‡æ€»åˆå¹¶,å…¶æ ¸å¿ƒæ˜¯[ä»»åŠ¡çš„åˆ†è§£Fork]å’Œ[ç»“æœçš„åˆå¹¶Join]</li><li>æ— è®ºæ˜¯å¹¶è¡Œæµè¿˜æ˜¯é¡ºåºæµ.äºŒè€…éƒ½æä¾›ç›¸åŒçš„ä¸­é—´æ“ä½œå’Œç»ˆç«¯æ“ä½œ,ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å‡ ä¹ç›¸åŒçš„æ–¹å¼è¿›è¡Œæ•°æ®å¤„ç†å’Œç»“æœæ”¶é›†</li></ul><figure><img src="https://i.imgur.com/MMyKgBt.png" alt="å¹¶è¡Œæµçš„å·¥ä½œåŸç†" /><figcaption aria-hidden="true">å¹¶è¡Œæµçš„å·¥ä½œåŸç†</figcaption></figure><h2 id="foreach-foreachordered">forEach &amp; forEachOrdered</h2><p>demo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; Example = List.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;G&quot;</span>);<br>    Example.parallelStream()  <span class="hljs-comment">//å¹¶è¡Œæµ</span><br>            .map(String::toLowerCase)  <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>            .forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°å‡ºçš„å­—æ¯æ˜¯ä¹±åºçš„, è€Œä¸”æ¯æ¬¡éƒ½ä¸ä¸€æ ·.</p><p>ä¸åƒé¡ºåºæµçš„æ‰§è¡Œæ˜¯å•çº¿ç¨‹çš„, å¹¶è¡Œæµé‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘å¤„ç†,ä¸ä¿è¯å…ƒç´ çš„å¤„ç†é¡ºåº.ç”¨<code>forEachOrdered</code>å¯ä»¥ä¿è¯å…ƒç´ çš„å‡ºç°é¡ºåº,è¿™å½’åŠŸäºSpliteratorå’ŒFork/Joinæ¡†æ¶çš„åä½œ:</p><ul><li><p>åœ¨å¤„ç†å¹¶è¡Œæµæ—¶, å¯¹äºæœ‰åºçš„æ•°æ®æº,Spliteratorä¼šå¯¹æ•°æ®æºè¿›è¡Œé€’å½’åˆ†å‰², é€šè¿‡åˆ’åˆ†æ•°æ®æºçš„ç´¢å¼•èŒƒå›´æ¥å®ç°.æ¯æ¬¡åˆ†å‰²éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„Spliteratorå®ä¾‹,å…¶å†…éƒ¨ç»´æŠ¤äº†æŒ‡å‘åŸæ•°æ®çš„ç´¢å¼•èŒƒå›´,è¿™ç§åˆ†å‰²æœºåˆ¶å¯ä»¥è®©æ•°æ®çš„å‡ºç°é¡ºåºå¾—ä»¥ä¿æŒ.</p></li><li><p>ç„¶å, Fork/Joinæ¡†æ¶æ¥æ‰‹, å°†åˆ†é…åçš„æ•°æ®å—åˆ†é…ç»™ä¸åŒçš„å­ä»»åŠ¡æ‰§è¡Œ.å¯¹äºforEachOrderedæ“ä½œ,æ¡†æ¶ä¾æ®Spliteratorç»´æŠ¤çš„é¡ºåºä¿¡æ¯æ¥è°ƒåº¦æ–¹æ³•çš„æ‰§è¡Œé¡ºåº. æ‰€ä»¥,å°±ç®—æŸä¸ªå­ä»»åŠ¡æå‰å®Œæˆäº†, å¦‚æœè·Ÿå®ƒå…³è”çš„é¡ºåºè¿˜æ²¡åˆ°æ¥, ç³»ç»Ÿå°†ç¼“å­˜è¯¥é¡ºåº,å¹¶æš‚åœæ‰§è¡Œè¯¥æ–¹æ³•, ç›´åˆ°æ‰€æœ‰å‰åºçš„ä»»åŠ¡éƒ½å·²ç»å®Œæˆ.</p></li><li><p>ä¸Šè¿°æœºåˆ¶ç¡®ä¿äº†å³ä½¿æ˜¯å¹¶è¡Œå¤„ç†ä¹Ÿèƒ½ä¿è¯åŸå§‹çš„å‡ºç°é¡ºåº,ä»£ä»·æ˜¯ç‰ºç‰²äº†ä¸€äº›å¹¶è¡Œæ‰§è¡Œçš„æ•ˆç‡.</p></li><li><p>å¯¹äº<code>forEach</code>,Fork/Joinä¼š<strong>å¿½ç•¥é¡ºåºçš„ä¿¡æ¯</strong>, èƒ½å¤Ÿæé«˜æ‰§è¡Œæ•ˆç‡.</p></li><li><p>forEachä¼šåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šç‹¬ç«‹è¿›è¡Œ, æ‰€ä»¥å¦‚æœæ“ä½œçš„æ˜¯å…±äº«èµ„æº,å¿…é¡»ç¡®ä¿è¿™äº›æ“ä½œæ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„(åŒæ­¥).æ‰€ä»¥<code>forEach</code>æ›´é€‚åˆæ‰§è¡Œæ— çŠ¶æ€æ“ä½œæˆ–èµ„æºç‹¬ç«‹çš„åœºæ™¯.</p></li></ul><p>ä¸€ä¸ªå…³äºå¤šçº¿ç¨‹çš„æµ‹è¯•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * å¹¶è¡Œæµçš„å¤šçº¿ç¨‹</span><br><span class="hljs-comment">  */</span><br> <span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>     List&lt;String&gt; Example = List.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;G&quot;</span>);<br>     Example.parallelStream().forEach(item -&gt; &#123;<br>         <span class="hljs-comment">//æ‰“å°æ­£åœ¨å¤„ç†çš„å…ƒç´ å’Œå¯¹åº”çš„çº¿ç¨‹</span><br>         System.out.println(<span class="hljs-string">&quot;Item: &quot;</span> + item + <span class="hljs-string">&quot;-&gt;&quot;</span> + <span class="hljs-string">&quot;Thread: &quot;</span> + Thread.currentThread().getName());<br>     &#125;);<br> &#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">Item: E-&gt;Thread: main<br>Item: D-&gt;Thread: main<br>Item: G-&gt;Thread: main<br>Item: A-&gt;Thread: main<br>Item: F-&gt;Thread: ForkJoinPool.commonPool-worker-2<br>Item: B-&gt;Thread: ForkJoinPool.commonPool-worker-1<br>Item: C-&gt;Thread: ForkJoinPool.commonPool-worker-2<br></code></pre></td></tr></table></figure><ul><li><code>main</code>:ä¸»çº¿ç¨‹</li><li><code>ForkJoinPool.commonPool-worker-x</code>:åå°çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹</li></ul><h2 id="collectæ”¶é›†">collectæ”¶é›†</h2><p>Listä½¿ç”¨<code>collect</code><strong>æ”¶é›†</strong>è¾“å‡ºç»“æœ,æœ€ç»ˆåˆå¹¶å¾—åˆ°çš„åˆ—è¡¨ä»ä¸º<strong>æœ‰åº</strong>(ä¸ç¬¬ä¸€ä¸ªdemoä¸åŒ)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Listå¹¶è¡Œæµä¸ºæœ‰åº</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; collect = List.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;G&quot;</span>).parallelStream()<br>            .map(String::toLowerCase)     <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>            .collect(Collectors.toList());<span class="hljs-comment">//æ”¶é›†ä¸åŒçº¿ç¨‹çš„ç»“æœ,åˆå¹¶ä¸ºåˆ—è¡¨</span><br>    System.out.println();<br>    System.out.println(collect);<span class="hljs-comment">//è¾“å‡ºä¸º[a, b, c, d, e, f, g]</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<strong>è‡ªå®šä¹‰æ”¶é›†å™¨</strong>æ¼”ç¤ºæœ‰åºåˆ—è¡¨<code>List</code>åœ¨å¹¶è¡Œæµçš„æƒ…å†µä¸‹åˆå¹¶åä»æœ‰åºè¾“å‡ºçš„è¿‡ç¨‹:</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test4</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; collect = List.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;E&quot;</span>).parallelStream()<br>            .map(String::toLowerCase)<br>            .collect(Collector.of(<br>                    () -&gt; &#123;<br>                        System.out.println(<span class="hljs-string">&quot;Supplier: new ArrayList&quot;</span> + <span class="hljs-string">&quot;Thread: &quot;</span> + Thread.currentThread().getName());<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                    &#125;,<br>                    (list,item) -&gt; &#123;<br>                        System.out.println(<span class="hljs-string">&quot;Accumulator: &quot;</span> + item + <span class="hljs-string">&quot; Thread: &quot;</span> + Thread.currentThread().getName());<br>                        list.add(item);<br>                    &#125;,<br>                    (left, right) -&gt; &#123;<span class="hljs-comment">//å¹¶è¡Œæµéœ€è¦æœ‰æ•ˆåœ°åˆå¹¶ä¸åŒçº¿ç¨‹çš„å¤„ç†ç»“æœ</span><br>                        System.out.println(<span class="hljs-string">&quot;Combiner: &quot;</span> + left + <span class="hljs-string">&quot; &quot;</span> + right + <span class="hljs-string">&quot; Thread: &quot;</span> + Thread.currentThread().getName());<br>                        left.addAll(right);<br>                        <span class="hljs-keyword">return</span> left;<br>                    &#125;,<br>                    Collector.Characteristics.IDENTITY_FINISH<br>            ));<br>    System.out.println(collect);<br><br>&#125;<br></code></pre></td></tr></table></figure></p><p>æ‰“å°å†…å®¹:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">Supplier: new ArrayListThread: main<br>Accumulator: c Thread: main<br>Supplier: new ArrayListThread: ForkJoinPool.commonPool-worker-1<br>Accumulator: b Thread: ForkJoinPool.commonPool-worker-1<br>Supplier: new ArrayListThread: ForkJoinPool.commonPool-worker-2<br>Supplier: new ArrayListThread: ForkJoinPool.commonPool-worker-1<br>Accumulator: e Thread: ForkJoinPool.commonPool-worker-2<br>Accumulator: d Thread: ForkJoinPool.commonPool-worker-1<br>Supplier: new ArrayListThread: main<br>Accumulator: a Thread: main<br>Combiner: [d] [e] Thread: ForkJoinPool.commonPool-worker-1<br>Combiner: [a] [b] Thread: main<br>Combiner: [c] [d, e] Thread: ForkJoinPool.commonPool-worker-1<br>Combiner: [a, b] [c, d, e] Thread: ForkJoinPool.commonPool-worker-1<br>[a, b, c, d, e]<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨<code>Set</code>, åˆ™ç»“æœä»ç„¶æ˜¯æ— åºçš„,è¿™æ˜¯ç”±<strong>æ•°æ®ç»“æ„æœ¬èº«</strong>çš„ç‰¹ç‚¹å†³å®šçš„,Spliteratorå’ŒFork/Joinæ¡†æ¶çš„åˆ†å‰²åˆå¹¶ç­–ç•¥å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒ.</p><h2 id="unordered-concurrent">UNORDERED &amp; CONCURRENT</h2><p><strong>UNORDERED</strong></p><p>å³ä¾¿Colectorè¢«æ ‡è®°ä¸º<code>UNORDERED</code>,å¦‚æœæ•°æ®æºæˆ–æµæ“ä½œæœ¬èº«æ˜¯æœ‰åºçš„,ç³»ç»Ÿçš„æ‰§è¡Œç­–ç•¥é€šå¸¸ä»ä¼šä¿æŒè¿™äº›å…ƒç´ çš„å‡ºç°é¡ºåº.åªæœ‰åœ¨ç‰¹å®šåœºæ™¯ä¸‹ç³»ç»Ÿæ‰ä¼šé’ˆå¯¹é‚£äº›è¢«æ ‡è®°ä¸º<code>UNORDERED</code>çš„æµè¿›è¡Œä¼˜åŒ–ä»è€Œæ‰“ç ´é¡ºåºçš„çº¦æŸ.</p><p><strong>CONCURRENT</strong></p><ul><li>åœ¨æ ‡å‡†çš„å¹¶è¡Œæµå¤„ç†ä¸­, æ¯ä¸ªçº¿ç¨‹å¤„ç†æ•°æ®çš„ä¸€ä¸ªå­é›†,ç»´æŠ¤è‡ªå·±çš„å±€éƒ¨ç»“æœå®¹å™¨. åœ¨æ‰€æœ‰çš„æ•°æ®å¤„ç†å®Œæˆå,è¿™äº›å±€éƒ¨ç»“æœä¼šé€šè¿‡Combinerå‡½æ•°åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„ç»“æœ.</li><li>ä½¿ç”¨CONCURRENTç‰¹æ€§å, æ‰€æœ‰çº¿ç¨‹å°†<strong>å…±äº«åŒä¸€ä¸ªç»“æœå®¹å™¨</strong>,è€Œä¸æ˜¯ç»´æŠ¤ç‹¬ç«‹çš„å±€éƒ¨ç»“æœ, ä»è€Œå‡å°‘äº†åˆå¹¶çš„éœ€è¦.è¿™é€šå¸¸ä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„æå‡, ç‰¹åˆ«æ˜¯åˆå¹¶æ“ä½œè¾ƒä¸ºå¤æ‚æ—¶.è¿™æ—¶åªæœ‰ä¸€ä¸ªç»“æœå®¹å™¨,è¿™ä¸ªå®¹å™¨å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„(ä¾‹å¦‚ConcurrentHashMap).</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java SE-FILEç±»ä¸IOæµ</title>
    <link href="/2025/04/13/java10/"/>
    <url>/2025/04/13/java10/</url>
    
    <content type="html"><![CDATA[<h1 id="fileç±»çš„ä½¿ç”¨">Fileç±»çš„ä½¿ç”¨</h1><p><strong>ä½ç½®</strong>ï¼š<code>package java.io</code></p><p><strong>æ„é€ å™¨</strong>ï¼š</p><ul><li><code>public File(String pathname)</code><ul><li><code>pathname</code>å¯ä»¥ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„</li></ul></li><li><code>public File(String parent, String child)</code><ul><li><code>parent</code>:çˆ¶è·¯å¾„åå­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ºnullåˆ™ç­‰æ•ˆäºä¸Šä¸€ç§æ„é€ å™¨</li><li><code>child</code>:å­è·¯å¾„åå­—ç¬¦ä¸²ï¼Œå¦‚æœå®ƒæ˜¯ç»å¯¹è·¯å¾„åˆ™ç›´æ¥å¿½ç•¥çˆ¶è·¯å¾„å</li><li>å¦‚æœäºŒè€…éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™æŠŠ<code>child</code>æ·»åŠ åœ¨<code>parent</code>çš„åé¢</li></ul></li><li><code>public File(File parent, String child)</code></li></ul><h2 id="æ–¹æ³•">æ–¹æ³•</h2><p>è§<code>File.java</code>ï¼ˆå¿«æ·é”®ï¼š<code>Ctrl + N</code>æŸ¥æ‰¾ç±»ï¼Œ<code>Ctrl + F12</code>æŸ¥æ‰¾å½“å‰æ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼‰ã€‚</p><p>ä¾‹ï¼šè¾“å‡ºä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼ˆé€’å½’ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printFileName</span><span class="hljs-params">(File file)</span> &#123;<br>    <span class="hljs-keyword">if</span>(file.isFile()) &#123;<br>        System.out.println(file.getName());<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>        File[] files = file.listFiles();<span class="hljs-comment">//listFiles()è¿”å›å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶+æ–‡ä»¶å¤¹</span><br>        <span class="hljs-keyword">for</span> (File f : files) &#123;<br>            printFileName(f);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ioæµ">IOæµ</h1><p>IOæµå°±æ˜¯Javaä¸­ç”¨æ¥â€œ<strong>è¯»</strong>â€å’Œâ€œ<strong>å†™</strong>â€æ•°æ®çš„é€šé“ã€‚</p><ul><li>æŒ‰æ•°æ®æ–¹å‘åˆ†<ul><li>è¾“å…¥æµï¼šè¯»å–æ•°æ®åˆ°ç¨‹åºä¸­</li><li>è¾“å‡ºæµï¼šå†™æ•°æ®åˆ°å¤–éƒ¨è®¾å¤‡</li></ul></li><li>æŒ‰æ•°æ®ç±»å‹åˆ†ï¼š<ul><li>å­—èŠ‚æµï¼šä»¥å­—èŠ‚ï¼ˆ8bitï¼‰ä¸ºå•ä½ï¼Œå¦‚<code>InputStream</code>ï¼Œ<code>OutputStream</code></li><li>å­—ç¬¦æµï¼šä»¥å­—ç¬¦ï¼ˆé•¿åº¦ä¸å®šï¼‰ä¸ºå•ä½ï¼Œå¦‚<code>Reader</code>ï¼Œ<code>Writer</code></li></ul></li></ul><p><strong>èŠ‚ç‚¹æµ</strong>æ˜¯ç›´æ¥ä¸ <strong>æ•°æ®æº</strong> æˆ–<strong>æ•°æ®ç›®çš„åœ°</strong> æ‰“äº¤é“çš„æµï¼Œå¸¸ç”¨äºæœ€åº•å±‚çš„ I/O æ“ä½œã€‚</p><p><strong>å¤„ç†æµ</strong>æ˜¯â€œå¥—æ¥â€åœ¨å·²æœ‰çš„æµï¼ˆé€šå¸¸æ˜¯èŠ‚ç‚¹æµï¼‰ä¸Šï¼Œå¯¹æ•°æ®è¿›è¡Œ<strong>åŠ å·¥å¤„ç†</strong> çš„æµã€‚</p><p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦æµä¸“é—¨ç”¨äº<strong>å¤„ç†æ–‡æœ¬å†…å®¹</strong>ï¼Œå­—èŠ‚æµç”¨äºå¤„ç†<strong>æ‰€æœ‰ç±»å‹çš„æ•°æ®</strong>ï¼ˆåŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰ã€‚</p><p>æ ¸å¿ƒç±»ç»“æ„å›¾ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs CSS">  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>  â”‚ InputStreamâ”‚ &lt;-------- â”‚ FileInputStream â”‚<br>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â–²<br>        â”‚<br><span class="hljs-selector-attr">[å¤„ç†å­—èŠ‚è¾“å…¥]</span><br><br>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>  â”‚ OutputStreamâ”‚ &lt;--------â”‚ FileOutputStreamâ”‚<br>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â–²<br>        â”‚<br><span class="hljs-selector-attr">[å¤„ç†å­—èŠ‚è¾“å‡º]</span><br><br>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>  â”‚ Reader â”‚ &lt;--------- â”‚ FileReader â”‚<br>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â–²<br><span class="hljs-selector-attr">[å¤„ç†å­—ç¬¦è¾“å…¥]</span><br><br>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>  â”‚ Writer â”‚ &lt;--------- â”‚ FileWriter â”‚<br>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â–²<br><span class="hljs-selector-attr">[å¤„ç†å­—ç¬¦è¾“å‡º]</span><br><br></code></pre></td></tr></table></figure><p>å·¦åˆ—ï¼šæŠ½è±¡åŸºç±»<br />å³åˆ—ï¼šèŠ‚ç‚¹æµï¼ˆæ–‡ä»¶æµï¼‰ï¼Œç›´æ¥è¿æ¥æ•°æ®æºå’Œæ•°æ®ç›®çš„åœ°ã€‚</p><h2 id="filereaderfilewriter">FileReaderã€FileWriter</h2><p>ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol type="1"><li>åˆ›å»ºè¯»å–æˆ–å†™å‡ºçš„Fileç±»å®ä¾‹</li><li>åˆ›å»ºè¾“å…¥æµæˆ–è¾“å‡ºæµ</li><li>å…·ä½“çš„è¯»æˆ–å†™çš„è¿‡ç¨‹<ol type="1"><li>read(char[] cbuffer):int</li><li>write(char[] cbuffer, 0, len):void</li></ol></li><li>å…³é—­æµèµ„æº</li></ol><p>æ³¨æ„ï¼š 1. å¤„ç†å¼‚å¸¸ 2. å¯¹äºè¾“å…¥æµï¼ŒFileç±»çš„å®ä¾‹å¯¹åº”çš„æ–‡ä»¶å¿…é¡»å·²ç»å­˜åœ¨3.å¯¹äºè¾“å‡ºæµï¼Œå¯ä»¥ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå¹¶å†™å…¥æ•°æ®åˆ°æ­¤æ–‡ä»¶ä¸­ï¼›å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™<code>FileWriter(File file, true/false)</code></p><h2id="fileinputstreamfileoutputstream">FileInputStreamã€FileOutputStream</h2><ol type="1"><li>åˆ›å»ºè¯»å–æˆ–å†™å‡ºçš„Fileç±»å¯¹è±¡</li><li>åˆ›å»ºè¾“å…¥æµæˆ–è¾“å‡ºæµ</li><li>å…·ä½“çš„è¯»å…¥æˆ–å†™å‡ºè¿‡ç¨‹ï¼Œä»ç„¶æ˜¯readå’Œwrite</li><li>å…³é—­æµèµ„æº</li></ol><h2 id="ç¼“å†²æµ">ç¼“å†²æµ</h2><p>4ä¸ªå¤„ç†æµï¼š</p><ul><li>BufferedInputStream</li><li>BufferedOutputStream</li><li>BufferedReader</li><li>BufferedWriter</li></ul><p>ç¼“å†²æµçš„ä½œç”¨ï¼š<strong>æå‡æ–‡ä»¶è¯»å†™çš„æ•ˆç‡</strong>ã€‚</p><p>ç›´æ¥ä½¿ç”¨<code>FileInputStream</code>è¯»å–æ–‡ä»¶æ—¶ï¼Œæ¯æ¬¡ .read()éƒ½ä¼šå’Œç£ç›˜æ‰“äº¤é“ï¼Œè¿™æ ·æ•ˆç‡ä¼šéå¸¸ä½ã€‚è€Œ<strong>ç¼“å†²æµä¼šä¸€æ¬¡æ€§ä»åº•å±‚æµä¸­è¯»å–å¤§é‡æ•°æ®å­˜å…¥å†…å­˜ç¼“å†²åŒºï¼Œä¹‹åå°±ä»å†…å­˜ä¸­è¯»å–ï¼Œæé«˜äº†æ•ˆç‡</strong>ã€‚</p><blockquote><p>ç£ç›˜ I/O æ˜¯éå¸¸æ…¢çš„ï¼Œå¦‚æœä½ æ¯æ¬¡éƒ½å»ç£ç›˜è¯» 1 å­—èŠ‚ï¼ŒCPUä¼šä¸€ç›´ç­‰ï¼Œæ•ˆç‡å¾ˆä½ã€‚è€Œä¸€æ¬¡æ€§è¯»å–ä¸€ä¸ª 8KBç¼“å†²åŒºï¼Œå¯ä»¥æå¤§å‡å°‘ç£ç›˜è¯»å–æ¬¡æ•°ï¼Œæé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å°†ä¸€ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°æ–¹</span><br><span class="hljs-comment">//å®é™…å†™çš„æ—¶å€™è®°å¾—ç”¨try-catch</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">src</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;Neuro.png&quot;</span>);<br>        <span class="hljs-type">File</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:\\edge_download\\Neuro.png&quot;</span>);<br><br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(src);<br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(dest);<br><br>        <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">bis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(fis);<br>        <span class="hljs-type">BufferedOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedOutputStream</span>(fos);<br><br>        <span class="hljs-type">int</span> len;<br>        <span class="hljs-comment">//bis.read():</span><br>        <span class="hljs-comment">//å¦‚æœ8KBçš„ç¼“å†²åŒºçš„æ•°æ®è¿˜æ²¡è¯»å®Œï¼šä»ç¼“å†²åŒºä¸­è¯»ä¸€ä¸ªå­—èŠ‚è¿”å›ã€‚</span><br>        <span class="hljs-comment">//å¦‚æœå·²ç»è¯»å®Œäº†ï¼šå°±ä¼šè°ƒç”¨åº•å±‚çš„è¾“å…¥æµï¼ˆä¾‹å¦‚ FileInputStreamï¼‰çš„ read(byte[] buffer) æ–¹æ³•ï¼›</span><br>        <span class="hljs-comment">// ä¸€æ¬¡æ€§ä»ç£ç›˜ä¸­è¯»å¾ˆå¤šå­—èŠ‚ï¼ˆæœ€å¤š8KBï¼‰ï¼Œå­˜å…¥ç¼“å†²åŒºï¼›ç„¶åå†ä»è¿™ä¸ªç¼“å†²åŒºä¸­è¯»ä¸€ä¸ªå­—èŠ‚è¿”å›è¿‡æ¥ã€‚</span><br>        <span class="hljs-comment">//å¦‚æœåº•å±‚è¾“å…¥æµè¿”å› -1ï¼ˆå³æ–‡ä»¶å·²ç»è¯»å®Œäº†ï¼‰ï¼Œåˆ™ bis.read() ä¹Ÿè¿”å› -1 è¡¨ç¤º EOFã€‚</span><br>        <span class="hljs-keyword">while</span>((len = bis.read()) != -<span class="hljs-number">1</span>) &#123;<br>            bos.write(len);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;Done&quot;</span>);<br><br>        <span class="hljs-comment">//å¤–å±‚çš„æµçš„å…³é—­å¯ä»¥è‡ªåŠ¨å…³é—­å†…å±‚çš„æµ</span><br>        bos.close();<br>        bis.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>BufferedInputStream</code><strong>åŸç†</strong>ï¼š</p><ul><li>ä»–æœ‰ä¸€ä¸ªå†…éƒ¨çš„<code>byte[]</code>ç¼“å†²åŒºï¼Œé»˜è®¤å¤§å°8192å­—èŠ‚</li><li>å½“è°ƒç”¨<code>.read()</code>æ—¶ï¼Œ<strong>å¦‚æœç¼“å†²åŒºæœ‰æ•°æ®</strong>ï¼Œå°±ç›´æ¥ä»ç¼“å†²åŒºè¯»ï¼›<strong>å¦‚æœç¼“å†²åŒºç©ºäº†</strong>ï¼Œå°±ä»åº•å±‚æµä¸­<strong>è¯»å–ä¸€å¤§å—</strong>ï¼ˆæ¯”å¦‚8192å­—èŠ‚ï¼‰æ”¾å…¥ç¼“å†²åŒº</li><li>ç±»ä¼¼åœ°ï¼Œ<code>BufferedOutputStream</code>ä¹Ÿæ˜¯æŠŠæ•°æ®å…ˆå†™å…¥ç¼“å†²åŒºï¼Œç­‰ç¼“å†²åŒºæ»¡äº†æˆ–è°ƒç”¨<code>.flush()</code>æ—¶æ‰çœŸæ­£å†™åˆ°æ–‡ä»¶ã€‚</li></ul><hr /><p>ä»æ–‡æœ¬æ–‡ä»¶è¯»å–æ–‡æœ¬åˆ°æ§åˆ¶å°ï¼ˆä¸€æ¬¡è¯»ä¸€è¡Œï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;hello.txt&quot;</span>);<br>    <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//ä¸€æ¬¡æ€§åˆ›å»ºæµ+ç¼“å†²æµ</span><br>        br = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(file));<br>        String Line;<span class="hljs-comment">//ä¸€æ¬¡è¯»å–ä¸€è¡Œï¼Œç›´åˆ°æ–‡ä»¶ç»“æŸ</span><br>        <span class="hljs-keyword">while</span>( (Line = br.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>            System.out.println(Line);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span>(br != <span class="hljs-literal">null</span>) br.close();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è½¬æ¢æµ">è½¬æ¢æµ</h2><p>è½¬æ¢æµï¼ˆConversionStreamsï¼‰æ˜¯è¿æ¥<strong>å­—èŠ‚æµ</strong>å’Œ<strong>å­—ç¬¦æµ</strong>ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ï¼š</p><blockquote><p>å°†â€œå­—èŠ‚â€è½¬æ¢æˆâ€œå­—ç¬¦â€ï¼Œæˆ–ç›¸ååœ°å°†â€œå­—ç¬¦â€è½¬æ¢æˆâ€œå­—èŠ‚â€ã€‚</p></blockquote><p>å¦‚æœèƒ½å¤Ÿç¡®è®¤æ–‡ä»¶çš„ç¼–ç æ ¼å¼ä¸ä½ çš„ç¨‹åºä½¿ç”¨çš„ç¼–ç ä¸€è‡´ï¼Œé‚£ç¡®å®å¯ä»¥ä¸æ˜¾å¼ä½¿ç”¨è½¬æ¢æµï¼ˆInputStreamReader/ OutputStreamWriterï¼‰ï¼Œç›´æ¥ç”¨å­—ç¬¦æµ FileReader /FileWriterä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚</p><table><thead><tr><th>ç±»å</th><th>æ–¹å‘</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>InputStreamReader</td><td>å­—èŠ‚ â†’ å­—ç¬¦</td><td>æŠŠå­—èŠ‚è¾“å…¥æµè½¬æ¢æˆå­—ç¬¦è¾“å…¥æµï¼ˆè¯»æ–‡ä»¶ï¼‰</td></tr><tr><td>OutputStreamWriter</td><td>å­—ç¬¦ â†’ å­—èŠ‚</td><td>æŠŠå­—ç¬¦è¾“å‡ºæµè½¬æ¢æˆå­—èŠ‚è¾“å‡ºæµï¼ˆå†™æ–‡ä»¶ï¼‰</td></tr></tbody></table><p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†gbkæ ¼å¼çš„æ–‡ä»¶è½¬æ¢ä¸ºutf-8æ ¼å¼çš„æ–‡ä»¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;GB18030.txt&quot;</span>);<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;GB18030_to_utf8.txt&quot;</span>);<br><br>    <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file1);<br>    <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">isr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(fis,<span class="hljs-string">&quot;GB18030&quot;</span>);<span class="hljs-comment">//ä½¿ç”¨gbkæ ¼å¼è§£ç </span><br><br>    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file2);<br>    <span class="hljs-type">OutputStreamWriter</span> <span class="hljs-variable">osw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(fos,<span class="hljs-string">&quot;utf-8&quot;</span>);<span class="hljs-comment">//æŠŠè§£ç å¾—åˆ°çš„å­—ç¬¦ä»¥utf8è¾“å‡ºä¸ºå­—èŠ‚</span><br><br>    <span class="hljs-comment">//è¯»å†™è¿‡ç¨‹</span><br>    <span class="hljs-type">char</span>[] cBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">1024</span>];<br>    <span class="hljs-type">int</span> len;<br>    <span class="hljs-keyword">while</span>((len = isr.read(cBuffer)) != -<span class="hljs-number">1</span>)&#123;<br>        osw.write(cBuffer,<span class="hljs-number">0</span>,len);<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;OVER&quot;</span>);<br><br>    isr.close();<br>    osw.close();<span class="hljs-comment">//å…³é—­ç¼“å†²æµåï¼Œç¼“å†²çš„æ•°æ®æ‰ä¼šè¢«çœŸæ­£å†™å…¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>OutputStreamWriter</code><strong>ä¹Ÿæ˜¯å¸¦ç¼“å†²çš„æµ</strong>ï¼Œåªæœ‰å½“ç¼“å†²åŒºæ»¡äº†æˆ–è€…è°ƒç”¨<code>flush()</code>æˆ–è€…å…³é—­æµæ—¶ï¼Œæ‰ä¼šå‘ç¡¬ç›˜ä¸­å†™å…¥æ•°æ®ã€‚<code>.write()</code>æ–¹æ³•åªæ˜¯å†™åˆ°äº†å®ƒçš„ç¼“å†²åŒºä¸­ï¼Œå¹¶ä¸ä¸€å®šå†™åˆ°äº†ç£ç›˜ä¸­ã€‚<code>OutputStreamWriter.close()</code>æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨<code>flush()</code>æ–¹æ³•ï¼Œå¹¶ä¸”å…³é—­åº•å±‚çš„<code>FileOutputStream</code>ã€‚</p><p>ä½†æ˜¯<code>InputStreamReader</code><strong>æœ¬èº«ä¸å¸¦ç¼“å†²åŒº</strong>ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªâ€œç¼–ç è§£ç å™¨â€ï¼Œç”¨æ¥æŠŠå­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµã€‚<code>BufferedReader</code>æ‰å¸¦æœ‰ç¼“å†²è¯»å–åŠŸèƒ½ã€‚å¦‚æœè¦æé«˜è¯»å–çš„æ•ˆç‡ï¼Œåº”è¯¥ç»™è½¬æ¢æµå¤–é¢å¥—ä¸Šä¸€å±‚ç¼“å†²æµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;xxx.txt&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>)<br>);<br></code></pre></td></tr></table></figure><p>è‹±æ–‡å­—ç¬¦ä¸ä¼šå‡ºç°ä¹±ç é—®é¢˜ã€‚</p><hr /><p><strong>åœ¨å†…å­˜ä¸­çš„å­—ç¬¦é—®é¢˜</strong>ï¼šå†…å­˜ä¸­çš„é•¿åº¦ä¸ç¼–ç¨‹è¯­è¨€æœ‰å…³ï¼ŒJavaçš„ä¸€ä¸ª<code>char</code><strong>åœ¨å†…å­˜ä¸­</strong>å ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚åœ¨ç¡¬ç›˜ä¸­å ç”¨å¤šå°‘å­—èŠ‚å–å†³äºç¼–ç æ–¹å¼ã€‚</p><h2 id="å¯¹è±¡æµ">å¯¹è±¡æµ</h2><p>å°†å†…å­˜ä¸­å®šä¹‰çš„å˜é‡ä¿å­˜åœ¨æ–‡ä»¶ä¸­ã€‚</p><p><code>ObjectInputStream</code>ä»å­—èŠ‚æµä¸­ä¸­è¿˜åŸå‡ºå¯¹è±¡</p><p><code>ObjectOutputStream</code>å°†å¯¹è±¡è½¬æ¢æˆå­—èŠ‚æµ</p><ul><li>ObjectOutputStreamå†™å…¥çš„å†…å®¹<strong>ä¸æ˜¯çº¯æ–‡æœ¬æ ¼å¼</strong>ï¼Œè€Œæ˜¯åŒ…å«äº†<strong>Javaåºåˆ—åŒ–å¤´ä¿¡æ¯ + å­—ç¬¦ä¸²å†…å®¹</strong>çš„<strong>äºŒè¿›åˆ¶æ•°æ®</strong>ã€‚</li></ul><h3 id="å¯¹è±¡çš„åºåˆ—åŒ–è¿‡ç¨‹">å¯¹è±¡çš„åºåˆ—åŒ–è¿‡ç¨‹</h3><p>å¯¹è±¡çš„<strong>åºåˆ—åŒ–</strong>æœºåˆ¶ï¼ˆObjectSerializationï¼‰æ˜¯æŒ‡å°†å¯¹è±¡è½¬æ¢æˆä¸€è¿ä¸²å­—èŠ‚çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿ï¼š</p><ol type="1"><li>ä¿å­˜åˆ°ç£ç›˜ï¼ˆä¾‹å¦‚å†™å…¥æ–‡ä»¶ï¼‰ï¼›</li><li>é€šè¿‡ç½‘ç»œä¼ è¾“ï¼›</li><li>ç¼“å­˜ï¼›</li><li>åç»­è¿˜åŸï¼ˆååºåˆ—åŒ–ï¼‰ä¸ºåŸå§‹å¯¹è±¡ã€‚</li></ol><p>åœ¨å†…å­˜ä¸­çš„å¯¹è±¡ä¸èƒ½ç›´æ¥å†™åˆ°ç¡¬ç›˜æˆ–é€šè¿‡ç½‘ç»œå‘é€ï¼Œå¿…é¡»å…ˆè½¬æˆå¯ä¼ è¾“çš„æ ¼å¼ï¼ˆå­—èŠ‚æµï¼‰ï¼Œè¿™å°±æ˜¯åºåˆ—åŒ–çš„ç›®çš„ã€‚</p><p><strong>ååºåˆ—åŒ–</strong>ï¼šå°†å­—èŠ‚æµè¿˜åŸä¸ºå¯¹è±¡</p><hr /><ul><li>åºåˆ—åŒ–çš„å¯¹è±¡çš„ç±»å¿…é¡»å®ç°æ¥å£ã€‚</li><li>è¦æ±‚è‡ªå®šä¹‰ç±»å£°æ˜ä¸€ä¸ªå…¨å±€å¸¸é‡<code>static final long serialVersionUID = xxxxxxL</code>ç”¨æ¥å”¯ä¸€åœ°æ ‡è¯†å½“å‰çš„ç±»;è™½ç„¶ç³»ç»Ÿä¼šè‡ªåŠ¨ç”ŸæˆUIDï¼Œä½†æ˜¯å› ä¸ºå®¹æ˜“å˜åŒ–æ‰€ä»¥ä¸æ¨èã€‚</li><li>è¦æ±‚è‡ªå®šä¹‰ç±»çš„å„ä¸ªå±æ€§ä¹Ÿæ˜¯å¯ä»¥åºåˆ—åŒ–çš„<ul><li>åŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å¯åºåˆ—åŒ–</li><li>å¼•ç”¨æ•°æ®ç±»å‹ä¹Ÿå®ç°äº†æ¥å£Serializable</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    String name;<br>    <span class="hljs-type">int</span> age;<br>&#125;<br></code></pre></td></tr></table></figure><table><thead><tr><th>é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>transient</code>å…³é”®å­—</td><td>ä¿®é¥°çš„å­—æ®µä¸ä¼šè¢«åºåˆ—åŒ–</td></tr><tr><td>é™æ€å­—æ®µ</td><td><code>static</code>ä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–ï¼ˆå®ƒå±äºç±»ï¼Œä¸å±äºå®ä¾‹ï¼‰</td></tr><tr><td>çˆ¶ç±»æœªå®ç°<code>Serializable</code></td><td>åˆ™çˆ¶ç±»çš„å­—æ®µä¸ä¼šè¢«åºåˆ—åŒ–</td></tr><tr><td><code>serialVersionUID</code></td><td>å»ºè®®æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬å·ï¼Œé˜²æ­¢ç±»ç»“æ„å˜åŒ–å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java-ArrayListæºç ç®€æ</title>
    <link href="/2025/04/12/java9/"/>
    <url>/2025/04/12/java9/</url>
    
    <content type="html"><![CDATA[<h1 id="arraylist">ArrayList</h1><p><code>ArrayList</code>æ˜¯ Javaä¸­åŸºäºæ•°ç»„å®ç°çš„ä¸€ä¸ªå¯å˜é•¿åº¦çš„åŠ¨æ€æ•°ç»„ï¼Œå®ƒå®ç°äº†<code>List</code>æ¥å£ã€‚ä½ç½®ï¼š<code>java.util.ArrayList</code></p><p>Java 8åŠä¹‹åçš„ç‰ˆæœ¬ï¼š</p><p><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ï¼š</p><p>åˆ›å»ºä¸€ä¸ªObjectæ•°ç»„ï¼Œé»˜è®¤ä¸ºç©ºæ•°ç»„ï¼ˆæ‡’æ±‰å¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">transient</span> Object[] elementData; <span class="hljs-comment">// å®é™…å­˜å‚¨å…ƒç´ çš„æ•°ç»„</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;               <span class="hljs-comment">// å½“å‰å…ƒç´ ä¸ªæ•°ï¼ˆä¸æ˜¯æ•°ç»„é•¿åº¦ï¼‰</span><br></code></pre></td></tr></table></figure><p><strong>æ„é€ æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é»˜è®¤æ„é€ å‡½æ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArrayList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;<br>&#125;<br><br><span class="hljs-comment">// æŒ‡å®šåˆå§‹å®¹é‡</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArrayList</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span> &#123;<br>    <span class="hljs-keyword">if</span> (initialCapacity &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">this</span>.elementData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[initialCapacity];<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (initialCapacity == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">this</span>.elementData = EMPTY_ELEMENTDATA;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Illegal Capacity: &quot;</span>+<br>                                           initialCapacity);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é»˜è®¤æ„é€ å‡½æ•°ç”¨äºæ‰©å®¹ä¸ºé»˜è®¤å¤§å°10ï¼Œ<strong>åªæœ‰ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶æ‰æ‰©å®¹</strong>ã€‚</li><li>å¸¦å‚çš„æ„é€ å‡½æ•°ç”¨äºè‡ªå·±æŒ‡å®šåˆå§‹å¤§å°ã€‚</li></ul><p><strong>æ·»åŠ å…ƒç´ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> &#123;<br>    ensureCapacityInternal(size + <span class="hljs-number">1</span>); <span class="hljs-comment">// ç¡®ä¿å®¹é‡è¶³å¤Ÿ</span><br>    elementData[size++] = e;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>size</code>è¡¨ç¤ºæ·»åŠ å…ƒç´ ä¹‹å‰å·²æœ‰çš„å…ƒç´ æ•°é‡ï¼Œ<code>size+1</code>å³æ·»åŠ ä¹‹åæ‰€éœ€è¦çš„æœ€å°å®¹é‡</li><li><code>ensureCapacityInternal</code>ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœéœ€è¦æ‰©å®¹ï¼Œé‚£ä¹ˆ<code>elementData</code>æ‰©å®¹ä¸º<code>elementData = Arrays.copyOf(elementData, newCapacity);</code>ï¼Œæ˜¯åŸæ¥çš„1.5å€ï¼Œæ—§æ•°ç»„æ‹·è´åˆ°æ–°æ•°ç»„ã€‚</li></ul><p>æ‰©å®¹æ“ä½œçš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ensureCapacityInternal</span><span class="hljs-params">(<span class="hljs-type">int</span> minCapacity)</span> &#123;<br>    <span class="hljs-comment">//å¦‚æœç¬¬ä¸€æ¬¡æ·»åŠ çš„å…ƒç´ æ•°é‡å’Œé»˜è®¤é•¿åº¦10åšå¯¹æ¯”ï¼Œå–è¾ƒå¤§çš„æ•°</span><br>    <span class="hljs-keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;<br>        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);<br>    &#125;<br>    <span class="hljs-comment">//åç»­æ·»åŠ å…ƒç´ çš„æ—¶å€™ä½¿ç”¨ä¸‹é¢è¿™ä¸ªåˆ¤æ–­</span><br>    ensureExplicitCapacity(minCapacity);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ensureExplicitCapacity</span><span class="hljs-params">(<span class="hljs-type">int</span> minCapacity)</span> &#123;<br>    modCount++;<br>    <span class="hljs-comment">//å¦‚æœæ‰€éœ€æœ€å°å®¹é‡å¤§äºç°æœ‰å®¹é‡ï¼Œåˆ™æ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)<br>        grow(minCapacity);<br>&#125;<br><br><span class="hljs-comment">// æ‰©å®¹é€»è¾‘</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">grow</span><span class="hljs-params">(<span class="hljs-type">int</span> minCapacity)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldCapacity</span> <span class="hljs-operator">=</span> elementData.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>); <span class="hljs-comment">// æ‰©å®¹1.5å€</span><br>    <span class="hljs-keyword">if</span> (newCapacity - minCapacity &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//1.5å€ä»ç„¶ä¸å¤Ÿç”¨çš„è¯å°±ç›´æ¥å–å…ƒç´ çš„é•¿åº¦</span><br>        newCapacity = minCapacity;<br>    <span class="hljs-keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>)<span class="hljs-comment">//æç«¯æƒ…å†µç‰¹æ®Šå¤„ç†</span><br>        newCapacity = hugeCapacity(minCapacity);<br>        <span class="hljs-comment">//æ‹·è´æ—§æ•°ç»„åˆ°åŸæ•°ç»„</span><br>    elementData = Arrays.copyOf(elementData, newCapacity);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤å…ƒç´ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>    Objects.checkIndex(index, size);<span class="hljs-comment">//æ£€æŸ¥indexæ˜¯å¦è¶Šç•Œï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br>    <span class="hljs-keyword">final</span> Object[] es = elementData;<span class="hljs-comment">//ä¸ºäº†å†™æ³•æ›´çŸ­ã€æ€§èƒ½ç¨å¾®å¥½ä¸€ç‚¹</span><br><br>    <span class="hljs-comment">//å¿½ç•¥ç¼–è¯‘å™¨çš„æ³›å‹è½¬æ¢è­¦å‘Šï¼Œå°†eså¼ºè½¬ä¸ºæ³›å‹ç±»å‹E</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="hljs-type">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> (E) es[index];<br>    fastRemove(es, index);<span class="hljs-comment">//å°†index+1åŠå…¶åé¢çš„å…ƒç´ å…¨éƒ¨å‘å‰æŒªåŠ¨ä¸€ä½ï¼Œè¦†ç›–è¦åˆ é™¤çš„å…ƒç´ ï¼Œæœ€åä¸€ä½è®°ä¸ºnull</span><br><br>    <span class="hljs-keyword">return</span> oldValue;<span class="hljs-comment">//è¿”å›oldvalue</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>Eæ˜¯æ³›å‹ç±»å‹å‚æ•°ï¼Œç”¨æ¥è¡¨ç¤º<code>ArrayList</code>ä¸­å­˜å‚¨çš„å…ƒç´ çš„ç±»å‹ã€‚</li></ul><p><strong>ArrayListçš„æŸ¥æ‰¾å’Œï¼ˆå°¾éƒ¨ï¼‰æ·»åŠ å…ƒç´ æ•ˆç‡é«˜ï¼Œåˆ é™¤å’Œæ’å…¥æ“ä½œæ•ˆç‡ä½</strong>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>æºç å‰–æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java SE(8)-æ³›å‹</title>
    <link href="/2025/04/12/java8/"/>
    <url>/2025/04/12/java8/</url>
    
    <content type="html"><![CDATA[<p>ä¿®æ”¹å†å²ï¼š</p><p>2025/4/12 åˆæ¬¡å‘å¸ƒ</p><p>2025/4/22 è¡¥å……é™æ€æ³›å‹æ–¹æ³•ï¼Œå®Œå–„äº†é€šé…ç¬¦éƒ¨åˆ†çš„å†…å®¹</p><h1 id="æ¦‚è¿°">æ¦‚è¿°</h1><p><strong>æ³›å‹</strong>ï¼ˆGenericsï¼‰æ˜¯Javaæä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œ<strong>è®©ç±»ã€æ¥å£ã€æ–¹æ³•åœ¨å®šä¹‰æ—¶å¯ä»¥æŒ‡å®šç±»å‹å‚æ•°</strong>ï¼Œä»è€Œå®ç°ç±»å‹å®‰å…¨å’Œä»£ç å¤ç”¨ã€‚</p><p><code>HashMap&lt;String,Integer&gt; map = new HashMap&lt;&gt;();</code></p><p><code>ArrayList&lt;String&gt; strList = new ArrayList&lt;&gt;();</code></p><p><code>ArrayList&lt;Person&gt; personList = new ArrayList&lt;&gt;();</code></p><p>éƒ½æ˜¯ä½¿ç”¨æ³›å‹çš„ä¾‹å­ã€‚</p><h1 id="é™æ€æ³›å‹æ–¹æ³•">é™æ€æ³›å‹æ–¹æ³•</h1><p>é™æ€æ–¹æ³•çš„æ³›å‹å’Œæ™®é€šæ–¹æ³•çš„æ³›å‹çš„å†™æ³•ä¸åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»ï¼Œè¡¨ç¤ºä¸€å¯¹ç›¸åŒç±»å‹çš„å€¼</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pair</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> T first;<br>    <span class="hljs-keyword">private</span> T last;<br>    <span class="hljs-comment">//æ„é€ å™¨ï¼Œä¼ å…¥ä¸¤ä¸ªç›¸åŒç±»å‹çš„å€¼</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pair</span><span class="hljs-params">(T first, T last)</span> &#123;<br>        <span class="hljs-built_in">this</span>.first = first;<br>        <span class="hljs-built_in">this</span>.last = last;<br>    &#125;<br>    <span class="hljs-comment">//getter and setter</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getFirst</span><span class="hljs-params">()</span> &#123; ... &#125;<br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getLast</span><span class="hljs-params">()</span> &#123; ... &#125;<br><br>    <span class="hljs-comment">// é™æ€æ³›å‹æ–¹æ³•åº”è¯¥ä½¿ç”¨å…¶ä»–ç±»å‹åŒºåˆ†:Kä¸åŒäºT</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;K&gt; Pair&lt;K&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(K first, K last)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pair</span>&lt;K&gt;(first, last);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„æ³›å‹æ–¹æ³•ç”¨å¾—æ³›å‹å‚æ•°æ˜¯<code>K</code>ï¼Œè¿™æ˜¯å› ä¸º<strong>æ³›å‹ç±»å‹å‚æ•°Tæ˜¯åœ¨ç±»å®ä¾‹åŒ–æ—¶æ‰ç¡®å®šçš„ï¼Œè€Œé™æ€æ–¹æ³•å±äºç±»æœ¬èº«ï¼Œä¸ä¾èµ–äºå®ä¾‹åŒ–ï¼Œæ‰€ä»¥å®ƒæ— æ³•è®¿é—®å®ä¾‹ç›¸å…³çš„æ³›å‹ç±»å‹</strong>ã€‚å› æ­¤éœ€è¦å¦å¤–è®¾ä¸€ä¸ªæ³›å‹å‚æ•°<code>K</code>ï¼Œå¯ä»¥æŠŠè¿™ä¸ª<code>K</code>çœ‹æˆæ˜¯é™æ€æ–¹æ³•è‡ªå·±ä¸“ç”¨çš„ç±»å‹å‚æ•°ï¼Œå’Œç±»çš„<code>T</code>æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªæ˜¯åˆšå¥½åšçš„äº‹ç›¸ä¼¼è€Œå·²ã€‚</p><p>è€Œä¸”ï¼Œå¯ä»¥æ³¨æ„åˆ°é™æ€æ–¹æ³•çš„æ³›å‹å‚æ•°<code>K</code>åœ¨å£°æ˜ä¸­å‡ºç°äº†ä¸¤æ¬¡ï¼Œè¿™æ˜¯å› ä¸ºæ™®é€šæ–¹æ³•çš„<code>T</code>åœ¨ç±»çš„å£°æ˜ä¸­å·²ç»å‡ºç°è¿‡ï¼Œç¼–è¯‘å™¨çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼›ä½†æ˜¯é™æ€æ–¹æ³•ä½¿ç”¨çš„<code>K</code><strong>ä»æœªå‡ºç°</strong>ï¼Œæ‰€ä»¥éœ€è¦äº‹å…ˆå£°æ˜ã€‚ç¬¬äºŒæ¬¡å‡ºç°çš„<code>K</code>å°±æ˜¯æ­£å¸¸çš„ä½¿ç”¨äº†ã€‚</p><p>é™æ€æ³›å‹æ–¹æ³•çš„è¿™ç§å†™æ³•åœ¨æ™®é€šæ–¹æ³•ä¸­ä¹Ÿå¯èƒ½å‡ºç°ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªï¼š</p><p><img src="https://s21.ax1x.com/2025/04/21/pE5lfxI.png" /></p><p>è¿™å¥æ–¹æ³•å£°æ˜æ˜¯ Java Stream APIä¸­çš„<code>map</code>æ–¹æ³•ï¼Œç”¨äºå°†ä¸€ä¸ªæµä¸­çš„æ¯ä¸ªå…ƒç´ ã€Œæ˜ å°„ã€æˆå¦ä¸€ä¸ªç±»å‹ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æµã€‚</p><p>å› ä¸ºè¿™é‡Œå‡ºç°<strong>å¦ä¸€ä¸ªç±»å‹</strong>ï¼Œä¸ºäº†è¡¨ç¤ºè¿™ä¸ªç±»å‹ï¼Œéœ€è¦é¢„å…ˆå£°æ˜<code>&lt;R&gt;</code>æ‰è¡Œã€‚</p><p>æ‰€ä»¥è¯´åœ¨æ–¹æ³•åå‰é¢å‡ºç°çš„æ³›å‹å‚æ•°çš„ä½œç”¨å…¶å®å°±æ˜¯<strong>å£°æ˜æ–°å‚æ•°</strong>ï¼Œéœ€è¦æ–°å‚æ•°äº†å°±å†™ä¸€ä¸‹ï¼Œé˜²æ­¢åé¢è°ƒç”¨çš„æ—¶å€™ç¼–è¯‘å™¨ä¸è®¤è¯†å®ƒæŠ¥é”™ï¼Œè¿™åœ¨æ™®é€šæ–¹æ³•å’Œé™æ€æ–¹æ³•ä¸­æ˜¯ä¸€è‡´çš„ã€‚</p><h1 id="æ“¦æ‹­æ³•type-erasure">æ“¦æ‹­æ³•(Type Erasure)</h1><p>è§https://liaoxuefeng.com/books/java/generics/type-erasure/index.html</p><blockquote><p>æ‰€è°“æ“¦æ‹­æ³•æ˜¯æŒ‡ï¼Œè™šæ‹Ÿæœºå¯¹æ³›å‹å…¶å®ä¸€æ— æ‰€çŸ¥ï¼Œæ‰€æœ‰çš„å·¥ä½œéƒ½æ˜¯ç¼–è¯‘å™¨åšçš„ã€‚ç¼–è¯‘å™¨å†…éƒ¨æ°¸è¿œæŠŠæ‰€æœ‰ç±»å‹T è§†ä¸º Object å¤„ç†ï¼Œä½†æ˜¯ï¼Œåœ¨éœ€è¦è½¬å‹çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ® Tçš„ç±»å‹è‡ªåŠ¨ä¸ºæˆ‘ä»¬å®è¡Œ<strong>å®‰å…¨åœ°å¼ºåˆ¶è½¬å‹</strong>ã€‚</p></blockquote><p>åœ¨ä¸ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½¿ç”¨<code>instanceOf</code> +å¼ºåˆ¶è½¬å‹æ¥å¤„ç†ä¸åŒä¼ å…¥å‚æ•°çš„æƒ…å†µï¼Œæ³›å‹ä½¿ç”¨çš„å…¶å®è¿˜æ˜¯è¿™ä¸ªé€»è¾‘ï¼Œåªä¸è¿‡åŒ…è£…äº†ä¸€ä¸‹æ–¹ä¾¿ç”¨æˆ·ç¼–å†™ä»£ç ã€‚</p><h1 id="é€šé…ç¬¦">é€šé…ç¬¦</h1><h2 id="æ¦‚è¿°-1">æ¦‚è¿°</h2><p><strong>Javaæ³›å‹çš„ç±»å‹æ˜¯ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥</strong>ï¼Œå¹¶ä¸å…è®¸ä¸åŒç±»å‹çš„æ³›å‹ç›´æ¥ç›¸äº’èµ‹å€¼ã€‚ä¾‹å¦‚ï¼Œ<code>ArrayList&lt;Object&gt;</code>å’Œ<code>ArrayList&lt;String&gt;</code>æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„æ³›å‹ç±»å‹ï¼Œå³ä½¿Stringæ˜¯Objectçš„å­ç±»ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><ol type="1"><li>ä½¿ç”¨é€šé…ç¬¦(Wildcard):</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨é€šé…ç¬¦?ï¼Œè¡¨ç¤ºå¯ä»¥æ¥å—ä»»ä½•ç±»å‹</span><br>List&lt;?&gt; list = <span class="hljs-literal">null</span>;<br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ³›å‹stringçš„list1</span><br>List&lt;String&gt; list1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br><span class="hljs-comment">//å°†list1ä¼ ç»™list</span><br>list1.add(<span class="hljs-string">&quot;AA&quot;</span>);<br>list = list1;<br><br><span class="hljs-comment">//è¿™æ—¶listæˆåŠŸè·å–äº†list1ä¸­çš„å…ƒç´ </span><br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> list.get(<span class="hljs-number">0</span>);<span class="hljs-comment">//è¯»å–ä½¿ç”¨Object</span><br>System.out.println(obj);<br><br><span class="hljs-comment">//ä½†æ˜¯listä¸èƒ½å†™å…¥æ•°æ®ï¼ˆå› ä¸ºä¸èƒ½ç¡®å®šåˆ°åº•è¯¥æ”¾å“ªä¸ªç±»å‹ï¼‰ï¼Œé™¤äº†null</span><br>list.add(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><p><strong>ä¸Šç•Œé€šé…ç¬¦</strong>(Upper BoundsWildcards)ï¼š<code>List&lt;? extends T&gt; list</code>ï¼Œlistæ˜¯æŸç§<code>T</code>çš„å­ç±»çš„åˆ—è¡¨ã€‚è¿™æ ·ä¼ å…¥çš„å‚æ•°å¯ä»¥æ˜¯Tæˆ–è€…Tçš„å­ç±»ã€‚<strong>å¯ä»¥è¯»ï¼Œä¸èƒ½å†™</strong>ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“listæ˜¯å“ªä¸ªå­ç±»ã€‚<strong>è¯»å–å®‰å…¨ä½†æ˜¯å†™å…¥ä¸å®‰å…¨</strong></p><p><strong>ä¸‹ç•Œé€šé…ç¬¦</strong>ï¼š<code>List&lt;? super T&gt; list</code>ï¼Œlistæ˜¯<code>T</code>çš„æŸä¸ªçˆ¶ç±»çš„åˆ—è¡¨ã€‚æ–¹æ³•å‚æ•°æ¥å—æ‰€æœ‰æ³›å‹ç±»å‹ä¸ºTåŠå…¶çˆ¶ç±»çš„ç±»å‹ã€‚è¯»å‡ºåªèƒ½è¢«è§†ä¸ºä¸ºObjectï¼ˆå› ä¸ºä¸çŸ¥é“å…·ä½“æ˜¯å“ªä¸ªçˆ¶ç±»ï¼‰ï¼Œå¯ä»¥å†™å…¥Tæˆ–å…¶å­ç±»ã€‚å†™å…¥å®‰å…¨ä½†æ˜¯è¯»å–å—é™</p><p>æ€»ä¹‹ï¼š</p><ul><li><code>&lt;? extends T&gt;</code>å…è®¸è°ƒç”¨è¯»æ–¹æ³•<code>T get()</code>è·å–<code>T</code>çš„å¼•ç”¨ï¼Œä½†ä¸å…è®¸è°ƒç”¨å†™æ–¹æ³•<code>set(T)</code>ä¼ å…¥<code>T</code>çš„å¼•ç”¨ï¼ˆä¼ å…¥<code>null</code>é™¤å¤–ï¼‰ï¼›</li><li><code>&lt;? super T&gt;</code>å…è®¸è°ƒç”¨å†™æ–¹æ³•<code>set(T)</code>ä¼ å…¥<code>T</code>çš„å¼•ç”¨ï¼Œä½†ä¸å…è®¸è°ƒç”¨è¯»æ–¹æ³•<code>T get()</code>è·å–<code>T</code>çš„å¼•ç”¨ï¼ˆè·å–<code>Object</code>é™¤å¤–ï¼‰ã€‚</li></ul><p>ä½œä¸ºå¦ä¸€ä¸ªä¾‹å­ï¼Œçœ‹çœ‹<code>Collections</code>å·¥å…·ç±»ä¸­çš„<code>copy</code>æ–¹æ³•æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">copy</span><span class="hljs-params">(List&lt;? <span class="hljs-built_in">super</span> T&gt; dest, List&lt;? extends T&gt; src)</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠsrcåˆ—è¡¨çš„å…ƒç´ å¤åˆ¶åˆ°deståˆ—è¡¨ä¸­ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæºåˆ—è¡¨çš„æ³›å‹æ˜¯ä¸Šç•Œé€šé…ç¬¦ï¼Œå› ä¸ºæˆ‘ä»¬è¦è·å–æºåˆ—è¡¨çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦çš„è¯æºåˆ—è¡¨çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¸å¯èƒ½æ¯”<code>T</code>çš„ç­‰çº§â€œé«˜â€ï¼Œå¯ä»¥å®‰å…¨åœ°åˆ©ç”¨å‘ä¸Šè½¬å‹åŸåˆ™é€šè¿‡<code>T</code>æ¥getå®ƒä»¬ã€‚</p><p>ä¸ä¹‹ç›¸åï¼Œdestç›®æ ‡åˆ—è¡¨ä½¿ç”¨çš„æ˜¯superï¼Œå› ä¸ºæˆ‘ä»¬è¦å¯¹ç›®æ ‡åˆ—è¡¨è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½¿ç”¨superå¯ä»¥ä¿è¯ç›®æ ‡åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¸ä¼šæ¯”<code>T</code>ç­‰çº§ä½ï¼Œè¿™æ ·åªè¦setä¸€ä¸ª<code>T</code>ç±»å‹çš„å…ƒç´ å°±å¯ä»¥ä¿è¯æˆåŠŸå‘ä¸Šè½¬å‹ã€‚</p><h2 id="pecsåŸåˆ™">PECSåŸåˆ™</h2><p><strong>Producer Extends Consumer Super</strong></p><p>ç”Ÿäº§è€…ï¼ˆæºï¼‰ç”¨<code>extends</code>ï¼Œæ¶ˆè´¹è€…ï¼ˆç›®æ ‡ï¼‰ç”¨<code>super</code>ï¼Œå°±æ˜¯ä¸Šè¾¹è¯´è¿‡çš„ä¸œè¥¿</p><h2 id="æ— é™å®šé€šé…ç¬¦">æ— é™å®šé€šé…ç¬¦</h2><p><strong>Unbounded Wildcard Type</strong></p><p><code>&lt;?&gt;</code></p><p>æ—¢æ²¡æœ‰extendsï¼Œä¹Ÿæ²¡æœ‰superï¼Œä¹Ÿå°±æ˜¯è¯´æ—¢ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™ï¼Œå¯ä»¥ç”¨äºé€»è¾‘åˆ¤æ–­ã€‚</p><p><code>&lt;?&gt;</code>æ˜¯ç­‰çº§æœ€é«˜çš„å­˜åœ¨ï¼Œå¯ä»¥ä¿è¯é¡ºåˆ©å‘ä¸Šè½¬å‹ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test4</span><span class="hljs-params">()</span> &#123;<br>    Pair&lt;Integer&gt; p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pair</span>&lt;&gt;(<span class="hljs-number">123</span>, <span class="hljs-number">456</span>);<br>    Pair&lt;?&gt; p2 = p; <span class="hljs-comment">// å®‰å…¨åœ°å‘ä¸Šè½¬å‹</span><br>    System.out.println(p2.getFirst() + <span class="hljs-string">&quot;, &quot;</span> + p2.getLast());<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java SE-é›†åˆæ¡†æ¶çŸ¥è¯†æ¢³ç†</title>
    <link href="/2025/04/10/java7/"/>
    <url>/2025/04/10/java7/</url>
    
    <content type="html"><![CDATA[<p>ä¿®æ”¹å†å²ï¼š</p><ul><li>2025/04/10 åˆæ¬¡å‘å¸ƒ</li><li>2025/04/30 é‡æ–°æ ‘ç«‹äº†ç»“æ„ï¼Œå¢åŠ å¸¸ç”¨æ–¹æ³•æ€»ç»“</li><li>2025/05/03 å¢åŠ â€œå¦‚ä½•å°†åˆ—è¡¨è½¬æ¢æˆç‰¹å®šç±»å‹çš„æ•°ç»„â€éƒ¨åˆ†</li></ul><h1 id="collection">Collection</h1><p><strong>å†…å­˜å±‚é¢</strong>éœ€è¦é’ˆå¯¹å¤šä¸ªæ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œå¯ä»¥è€ƒè™‘çš„<strong>å®¹å™¨</strong>æœ‰ï¼šæ•°ç»„ã€é›†åˆç±»ã€‚</p><p>æ•°ç»„åˆå§‹åŒ–åçš„é•¿åº¦ä¸å¯å˜ï¼Œå­˜å‚¨æ•°æ®ä¸ºå•ä¸€ç±»å‹ï¼Œå¯åŒ…å«é‡å¤å…ƒç´ ï¼Œä¸é€‚ç”¨äºä¸å¯é‡å¤çš„åœºæ™¯ï¼›å¯ç”¨çš„å±æ€§å’Œæ–¹æ³•éƒ½æå°‘ï¼›ä¸ä¾¿åˆ é™¤å’Œæ’å…¥å…ƒç´ ã€‚</p><p>Javaä¸­çš„é›†åˆæ¡†æ¶ï¼ˆJava Collections Frameworkï¼Œç®€ç§°JCFï¼‰æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ¶æ„ï¼Œç”¨äºè¡¨ç¤ºå’Œæ“ä½œä¸€ç»„å¯¹è±¡ã€‚</p><p>Javaé›†åˆæ¡†æ¶ä½“ç³»ï¼š</p><ul><li><code>java.util.Collection</code>:å­˜å‚¨ä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®<ul><li>å­æ¥å£ï¼š<strong>List</strong>ï¼Œå­˜å‚¨<strong>æœ‰åº</strong>çš„ã€<strong>å¯é‡å¤</strong>çš„æ•°æ®ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰<ul><li><code>ArrayList</code>,<code>LinkedList</code>,<code>Vector</code></li></ul></li><li>å­æ¥å£ï¼š<strong>Set</strong>ï¼Œå­˜å‚¨<strong>æ— åº</strong>çš„ã€<strong>ä¸å¯é‡å¤</strong>çš„æ•°æ®ï¼ˆç±»ä¼¼é›†åˆï¼‰<ul><li><code>HashSet</code>,<code>LinkedHashSet</code>,<code>TreeSet</code></li></ul></li></ul></li><li><code>java.util.Map</code>:å­˜å‚¨ä¸€å¯¹ä¸€å¯¹çš„æ•°æ®<ul><li><code>HashMap</code>,<code>LinkedHashMap</code>,<code>TreeMap</code>,<code>Hashtable</code>,<code>Properties</code></li></ul></li></ul><h1 id="liståŠå…¶å®ç°ç±»">ListåŠå…¶å®ç°ç±»</h1><h2 id="å¢å¼ºforå¾ªç¯">å¢å¼ºforå¾ªç¯</h2><p><strong>ä½œç”¨</strong>ï¼šéå†æ•°ç»„ï¼Œé›†åˆ</p><p>é›†åˆï¼šåº•å±‚ä½¿ç”¨è¿­ä»£å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (é›†åˆæˆ–æ•°ç»„çš„ç±»å‹ ä¸´æ—¶å˜é‡ : é›†åˆæˆ–æ•°ç»„å˜é‡) &#123;<br>    æ“ä½œä¸´æ—¶å˜é‡çš„è¾“å‡º;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="liståŠå…¶å®ç°ç±»çš„ç‰¹ç‚¹">ListåŠå…¶å®ç°ç±»çš„ç‰¹ç‚¹</h2><p>Listå­˜å‚¨æœ‰åºçš„å¯é‡å¤çš„æ•°æ®ï¼ŒåŠ¨æ€æ•°ç»„ï¼Œæ¯å¢åŠ ä¸€ä¸ªå¯¹è±¡å®¹é‡å°±è‡ªåŠ¨åŠ ä¸€ã€‚</p><ul><li>ArrayList:Listçš„<strong>ä¸»è¦å®ç°ç±»</strong>ï¼Œåº•å±‚ä½¿ç”¨Object[]æ•°ç»„å­˜å‚¨ï¼Œæ’å…¥å’Œåˆ é™¤æ•°æ®æ—¶æ•ˆç‡ä½</li><li>LinkedList:åº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨çš„æ–¹å¼å­˜å‚¨ï¼Œæ·»åŠ å’ŒæŸ¥æ‰¾æ•°æ®æ—¶æ•ˆç‡è¾ƒä½ã€‚é€‚ç”¨äºå¯¹é›†åˆä¸­çš„æ•°æ®è¿›è¡Œé¢‘ç¹çš„åˆ é™¤å’Œæ’å…¥æ“ä½œ.</li><li>Vector: å¤è€ï¼Œä¸ç”¨</li></ul><h3id="arraylistå’Œæ™®é€šæ•°ç»„çš„å¯¹æ¯”"><code>ArrayList</code>å’Œæ™®é€šæ•°ç»„çš„å¯¹æ¯”</h3><table><thead><tr><th>ç‰¹æ€§</th><th>ArrayList</th><th>æ™®é€šæ•°ç»„ (Array[])</th></tr></thead><tbody><tr><td>é•¿åº¦</td><td>åŠ¨æ€å˜åŒ–ï¼Œå¯è‡ªåŠ¨æ‰©å®¹</td><td>å›ºå®šé•¿åº¦ï¼Œåˆ›å»ºåä¸å¯æ›´æ”¹</td></tr><tr><td>æ·»åŠ å…ƒç´ </td><td>ä½¿ç”¨ <code>add()</code> æ–¹æ³•æ·»åŠ </td><td>éœ€æŒ‡å®šç´¢å¼•æˆ–ä½¿ç”¨å¾ªç¯æ·»åŠ </td></tr><tr><td>åˆ é™¤å…ƒç´ </td><td>ä½¿ç”¨ <code>remove()</code> æ–¹æ³•åˆ é™¤</td><td>ä¸æ”¯æŒç›´æ¥åˆ é™¤ï¼Œéœ€è¦ç§»åŠ¨å…ƒç´ </td></tr><tr><td>æŸ¥æ‰¾å…ƒç´ </td><td>ä½¿ç”¨ <code>get(index)</code> è·å–å…ƒç´ </td><td>ä½¿ç”¨ <code>array[index]</code> è®¿é—®</td></tr><tr><td>æ˜¯å¦æ”¯æŒæ³›å‹</td><td>æ”¯æŒï¼Œä¾‹å¦‚ <code>ArrayList&lt;Integer&gt;</code></td><td>ä¸æ”¯æŒæ³›å‹</td></tr><tr><td>æ˜¯å¦æ”¯æŒåŸºæœ¬ç±»å‹</td><td>ä¸æ”¯æŒï¼Œåªèƒ½å­˜å¯¹è±¡ï¼ˆå¯è£…ç®±ï¼‰</td><td>æ”¯æŒåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹</td></tr><tr><td>æ˜¯å¦çº¿ç¨‹å®‰å…¨</td><td>é»˜è®¤<strong>ä¸æ˜¯</strong>çº¿ç¨‹å®‰å…¨çš„</td><td>ä¸æ˜¯çº¿ç¨‹å®‰å…¨</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å…ƒç´ æ•°é‡ä¸ç¡®å®šã€æ“ä½œçµæ´»</td><td>å…ƒç´ æ•°é‡å›ºå®šã€ç»“æ„ç®€å•</td></tr></tbody></table><hr /><h1id="collectionlistarraylistçš„å¯¹æ¯”">Collectionã€Listã€ArrayListçš„å¯¹æ¯”ï¼š</h1><table><thead><tr><th>ç‰¹æ€§</th><th>Collection</th><th>List</th><th>ArrayList</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ¥å£</td><td>æ¥å£ï¼ˆç»§æ‰¿è‡ª Collectionï¼‰</td><td>ç±»ï¼ˆå®ç°äº† List æ¥å£ï¼‰</td></tr><tr><td>æ˜¯å¦å¯å®ä¾‹åŒ–</td><td>âŒ ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–</td><td>âŒ ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–</td><td>âœ… å¯ä»¥ç›´æ¥å®ä¾‹åŒ–</td></tr><tr><td>é¡ºåºæ€§</td><td>âŒ ä¸ä¿è¯é¡ºåºï¼ˆç”±å­æ¥å£å†³å®šï¼‰</td><td>âœ… ä¿è¯å…ƒç´ é¡ºåº</td><td>âœ… ä¿è¯å…ƒç´ é¡ºåº</td></tr><tr><td>æ˜¯å¦å…è®¸é‡å¤</td><td>â“ ç”±å…·ä½“å®ç°å†³å®š</td><td>âœ… å…è®¸é‡å¤å…ƒç´ </td><td>âœ… å…è®¸é‡å¤å…ƒç´ </td></tr><tr><td>éšæœºè®¿é—®æ•ˆç‡</td><td>âŒ æ— æ­¤åŠŸèƒ½</td><td>âœ… æœ‰ <code>get(int)</code> æ–¹æ³•</td><td>âœ… å¿«é€Ÿéšæœºè®¿é—®ï¼ˆåŸºäºæ•°ç»„ï¼‰</td></tr><tr><td>å¸¸è§å®ç°ç±»</td><td>Listã€Setã€Queue ç­‰</td><td>ArrayListã€LinkedList ç­‰</td><td>è‡ªèº«æ˜¯å®ç°ç±»</td></tr><tr><td>å…¸å‹ä½¿ç”¨åœºæ™¯</td><td>æ“ä½œæ‰€æœ‰é›†åˆçš„é€šç”¨æ–¹æ³•</td><td>æ“ä½œæœ‰åºé›†åˆï¼ˆå¦‚åˆ—è¡¨ï¼‰</td><td>é¢‘ç¹æŸ¥è¯¢ã€éšæœºè®¿é—®</td></tr><tr><td>æ–¹æ³•ç¤ºä¾‹</td><td><code>add()</code>, <code>remove()</code>, <code>size()</code></td><td>åŠ ä¸Š <code>get()</code>, <code>set()</code>,<code>indexOf()</code>ç­‰</td><td>åŒ Listï¼ŒåŒæ—¶è¿˜æœ‰ä¼˜åŒ–çš„å†…éƒ¨å®ç°</td></tr></tbody></table><h1 id="set">Set</h1><h2 id="å®ç°ç±»">å®ç°ç±»</h2><p><code>Set</code>æ¥å£æ˜¯<code>Collection</code>æ¥å£çš„å­æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Set</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Collection</span>&lt;E&gt; <br></code></pre></td></tr></table></figure><p>å®ƒå­˜å‚¨<strong>æ— åºçš„ä¸å¯é‡å¤çš„æ•°æ®</strong>ã€‚å¸¸ç”¨å®ç°ç±»ï¼š</p><ul><li><code>HashSet</code>:<strong>ä¸»è¦å®ç°ç±»</strong>ï¼Œåº•å±‚ä½¿ç”¨<code>HashMap</code>ï¼Œå³æ•°ç»„+å•å‘é“¾è¡¨+çº¢é»‘æ ‘<ul><li><code>LinkedHashSet</code>:<code>HashSet</code>çš„å­ç±»ï¼›åœ¨ç°æœ‰çš„ç»“æ„çš„åŸºç¡€ä¸Šåˆæ·»åŠ äº†ä¸€ç»„åŒå‘é“¾è¡¨ï¼Œç”¨äºè®°å½•æ·»åŠ å…ƒç´ çš„å…ˆåé¡ºåºï¼Œä¾¿äºé¢‘ç¹çš„æŸ¥è¯¢æ“ä½œã€‚</li></ul></li><li><code>TreeSet</code>:åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘å­˜å‚¨ã€‚å¯ä»¥æŒ‰ç…§æ·»åŠ å…ƒç´ çš„æŒ‡å®šçš„å±æ€§å¤§å°é¡ºåºè¿›è¡Œè‡ªåŠ¨æ’åºï¼Œä»è€Œè¿›è¡Œæœ‰åºéå†ã€‚<ul><li>åº•å±‚ï¼šçº¢é»‘æ ‘ã€‚å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„å¤§å°é¡ºåºè‡ªåŠ¨æ’åºã€‚</li><li>è¦æ±‚TreeSetä¸­çš„å…ƒç´ å¿…é¡»æ˜¯<strong>åŒä¸€ä¸ªç±»å‹</strong>ï¼Œå¦åˆ™ç±»å‹è½¬æ¢é”™è¯¯ã€‚</li><li>å¤„ç†å¯¹è±¡æ¯”è¾ƒæ–¹æ³•ï¼Œæ’åºçš„æ ‡å‡†å°±æ˜¯è‡ªç„¶æ’åºæˆ–å®šåˆ¶æ’åºå¯¹åº”æ–¹æ³•çš„è¿”å›å€¼ã€‚å¦‚æœæ˜¯é›¶åˆ™è®¤ä¸ºæ˜¯ç›¸ç­‰ï¼Œä¸æ·»åŠ æ–°å…ƒç´ ã€‚</li><li>ä¸éœ€è¦é‡å†™<code>hashCode()</code>å’Œ<code>equals()</code>æ–¹æ³•ã€‚</li></ul></li></ul><p><strong>å¸¸ç”¨æ–¹æ³•</strong>ï¼š<code>Collection</code>ä¸­å¸¸ç”¨çš„æ–¹æ³•ï¼Œ<strong>æ— æ–°å¢æ–¹æ³•</strong>ã€‚</p><p>ä¸»è¦ä½œç”¨ï¼š<strong>å»é™¤é‡å¤æ•°æ®</strong>ã€‚</p><h2 id="é‡å†™ä¸¤ä¸ªæ–¹æ³•">é‡å†™ä¸¤ä¸ªæ–¹æ³•</h2><p>æ·»åŠ åˆ°HashSet/LinkedHashSetä¸­çš„å…ƒç´ çš„è¦æ±‚ï¼šå…ƒç´ æ‰€åœ¨çš„ç±»è¦é‡å†™ä¸¤ä¸ªæ–¹æ³•ï¼š<code>equal()</code>å’Œ<code>hashCode()</code>ã€‚</p><p><code>hashmap</code>ä¸­ä¾æ®<code>key</code>çš„<code>hash</code>å€¼æ¥ç¡®å®š<code>value</code>å­˜å‚¨ä½ç½®ï¼ˆhashå€¼å°±æ˜¯æ•°ç»„çš„ç´¢å¼•ï¼‰ï¼Œæ‰€ä»¥ä¸€å®šè¦é‡å†™<code>hashCode</code>æ–¹æ³•ï¼›</p><p>è€Œé‡å†™<code>equals</code>æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†è§£å†³<code>hash</code>å†²çªï¼šæˆ‘ä»¬åœ¨é‡å†™<code>hashcode()</code>æ–¹æ³•æ—¶å·²ç»å°½é‡ä¿è¯äº†å“ˆå¸Œå€¼ä¸ä¼šé‡å¤ï¼Œå¦‚æœå‘ç°ä¸¤ä¸ªä¸åŒçš„<code>key</code>çš„<code>hash</code>å€¼ç›¸åŒï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨<code>equals</code>æ–¹æ³•ï¼Œç»§ç»­æ¯”è¾ƒ<code>key</code>å€¼æ˜¯å¦ç›¸åŒã€‚</p><p>åœ¨å­˜å‚¨æ—¶ï¼šå¦‚æœ<code>equals</code>ç»“æœç›¸åŒï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ªé”®ï¼Œé‚£ä¹ˆå°±è¦†ç›–æ›´æ–°<code>value</code>å€¼ï¼›å¦‚æœé”®ä¸åŒï¼Œä½†æ˜¯å“ˆå¸Œå€¼ç›¸åŒï¼Œå°±ç”¨<code>List</code>æŠŠä»–ä»¬éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªä½ç½®ã€‚åœ¨å–å‡ºæ—¶ï¼šå¦‚æœ<code>equals</code>ç»“æœç›¸åŒå°±ç›´æ¥è¿”å›å½“å‰<code>value</code>å€¼ï¼Œå¦‚æœä¸åŒå°±éå†<code>List</code>ä¸­ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å³è¦<code>key</code>ä¸<code>hash</code><strong>åŒæ—¶åŒ¹é…</strong>æ‰ä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ª<code>key</code>ã€‚</p><p>JDKä¸­ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªkeyçš„æºç :<code>if(e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))&#123;ops;&#125;</code></p><h1 id="map">Map</h1><h2 id="mapåŠå…¶å®ç°ç±»å¯¹æ¯”">MapåŠå…¶å®ç°ç±»å¯¹æ¯”</h2><p><code>java.util.Map</code>:å­˜å‚¨ä¸€å¯¹ä¸€å¯¹çš„<strong>é”®å€¼å¯¹</strong>.</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs text">               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>               â”‚   Mapæ¥å£    â”‚<br>               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                     â”‚<br>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>        â”‚                          â”‚<br>  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”<br>  â”‚ HashMap   â”‚              â”‚ SortedMap â”‚ï¼ˆæ¥å£ï¼‰<br>  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<br>        â”‚                          â”‚<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”<br>â”‚ LinkedHashMap  â”‚           â”‚ TreeMap   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ Hashtable    â”‚ï¼ˆå¤è€çš„çº¿ç¨‹å®‰å…¨å®ç°ï¼‰<br>â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>      â”‚<br>â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”<br>â”‚Properties â”‚ï¼ˆå­ç±»ï¼Œä¸“ç”¨äºé…ç½®æ–‡ä»¶ï¼‰<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><table><thead><tr><th>ç‰¹æ€§</th><th>HashMap</th><th>LinkedHashMap</th><th>TreeMap</th><th>Hashtable</th><th>Properties</th></tr></thead><tbody><tr><td>æ‰€å±æ¥å£</td><td>Map</td><td>Map</td><td>Map, SortedMap, NavigableMap</td><td>Map</td><td>Hashtable</td></tr><tr><td>æ˜¯å¦çº¿ç¨‹å®‰å…¨</td><td>å¦</td><td>å¦</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>æ˜¯å¦å…è®¸ null é”®</td><td>æ˜¯ï¼ˆæœ€å¤šä¸€ä¸ªï¼‰</td><td>æ˜¯ï¼ˆæœ€å¤šä¸€ä¸ªï¼‰</td><td>å¦ï¼ˆé”®ä¸èƒ½ä¸º nullï¼‰</td><td>å¦</td><td>å¦</td></tr><tr><td>æ˜¯å¦æœ‰åº</td><td>å¦</td><td>æœ‰æ’å…¥é¡ºåº</td><td>æœ‰è‡ªç„¶é¡ºåºæˆ–æŒ‡å®š Comparator</td><td>å¦</td><td>å¦</td></tr><tr><td>åº•å±‚ç»“æ„</td><td>å“ˆå¸Œè¡¨</td><td>å“ˆå¸Œè¡¨ + åŒå‘é“¾è¡¨</td><td>çº¢é»‘æ ‘</td><td>å“ˆå¸Œè¡¨</td><td>å“ˆå¸Œè¡¨</td></tr><tr><td>æ€§èƒ½</td><td>æŸ¥è¯¢å¿«ï¼Œä¸€èˆ¬æ¨è</td><td>æŸ¥è¯¢å¿«ï¼Œé¡ºåºæ“ä½œæ€§èƒ½ç•¥ä½</td><td>æŸ¥è¯¢è¾ƒæ…¢ï¼Œé€‚åˆæ’åºéœ€æ±‚</td><td>æŸ¥è¯¢å¿«ï¼Œä½†å¹¶å‘æ€§èƒ½ä¸ä½³</td><td>ä¸»è¦ç”¨äºé…ç½®æ–‡ä»¶åŠ è½½</td></tr><tr><td>ç”¨é€”</td><td>é€šç”¨ Map å®¹å™¨</td><td>ä¿ç•™æ’å…¥é¡ºåºçš„ Map</td><td>éœ€è¦æ’åºçš„ Map</td><td>æ—©æœŸçº¿ç¨‹å®‰å…¨ Mapï¼Œå·²è¿‡æ—¶</td><td>å­˜å‚¨é…ç½®ä¿¡æ¯ï¼ˆkey/value å­—ç¬¦ä¸²ï¼‰</td></tr></tbody></table><h2 id="hashmap">HashMap</h2><p><code>HashSet</code>å°±æ˜¯åŸºäº<code>HashMap</code>å®ç°çš„ã€‚ä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th><code>HashSet</code></th><th><code>HashMap</code></th></tr></thead><tbody><tr><td>å­˜å‚¨ç»“æ„</td><td>åªå­˜å‚¨å…ƒç´ ï¼ˆä½œä¸ºé”®ï¼‰</td><td>å­˜å‚¨é”®å€¼å¯¹ï¼ˆkey-valueï¼‰</td></tr><tr><td>æ˜¯å¦å…è®¸é‡å¤</td><td>âŒ ä¸å…è®¸é‡å¤å…ƒç´ </td><td>âœ… é”®ä¸å…è®¸é‡å¤ï¼Œå€¼å¯ä»¥é‡å¤</td></tr><tr><td>å†…éƒ¨å®ç°</td><td>åŸºäº <code>HashMap</code> å®ç°</td><td>ä½¿ç”¨æ•°ç»„+é“¾è¡¨ï¼ˆæˆ–çº¢é»‘æ ‘ï¼‰å®ç°</td></tr><tr><td>æŸ¥æ‰¾æ•ˆç‡</td><td>O(1)</td><td>O(1)</td></tr><tr><td>åº•å±‚ç»“æ„</td><td>å®é™…æ˜¯ <code>HashMap&lt;E, Object&gt;</code></td><td>å®é™…æ˜¯ <code>HashMap&lt;K, V&gt;</code></td></tr></tbody></table><p><code>HashSet</code>ä¸­åªå­˜å‚¨å…ƒç´ ï¼ˆå€¼ï¼‰ï¼Œè€Œä¸æ˜¯é”®å€¼å¯¹ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå®ƒæŠŠå…ƒç´ ä½œä¸º<code>HashMap</code>çš„é”®ï¼Œç”¨ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡ï¼ˆæ¯”å¦‚<code>PRESENT</code>ï¼‰ä½œä¸ºå€¼ã€‚</p><p>æ‰€ä»¥å…¶å®æ¯æ¬¡ä½ å¾€<code>HashSet</code>æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒæ˜¯åœ¨åº•å±‚çš„<code>HashMap</code>ä¸­æ·»åŠ äº†ä¸€æ¡é”®å€¼å¯¹ï¼š<code>map.put(element, PRESENT);</code></p><hr /><ul><li>HashMapä¸­çš„keyç”¨Setæ¥å­˜æ”¾ï¼Œæ— åºè€Œä¸”ä¸å…è®¸é‡å¤ï¼Œæ‰€ä»¥åŒä¸€ä¸ªMapå¯¹è±¡æ‰€å¯¹åº”çš„ç±»<strong>éœ€è¦é‡å†™hashCodeå’Œequals</strong>ã€‚</li><li>HashMapä¸­çš„Valueå¯é‡å¤ã€æ— åºã€‚<strong>ä¸å¼ºåˆ¶é‡å†™ä»»ä½•æ–¹æ³•</strong>ã€‚</li><li>æ¯ä¸€ä¸ªé”®å€¼å¯¹æ„æˆä¸€ä¸ª<strong>entry</strong>ï¼Œæ‰€æœ‰çš„entryæ„æˆäº†ä¸€ä¸ªSeté›†åˆ</li></ul><h2 id="treemap">TreeMap</h2><ul><li>åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘ï¼ŒæŒ‰ç…§<strong>key</strong>æŒ‡å®šçš„å¤§å°é¡ºåºæ’åºã€‚</li><li>éœ€è¦è€ƒè™‘ä½¿ç”¨å¯¹è±¡æ’åº</li><li>å¿…é¡»æ˜¯<strong>åŒä¸€ä¸ªç±»å‹</strong>çš„å¯¹è±¡</li></ul><h2 id="properties">Properties</h2><ul><li>Hashtableçš„å­ç±»</li><li>é”®å’Œå€¼éƒ½æ˜¯Stringç±»å‹ï¼Œç”¨æ¥å¤„ç†å±æ€§æ–‡ä»¶</li></ul><h1 id="queue">Queue</h1><p>é˜Ÿåˆ—(Queue)å®ç°äº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æœ‰åºè¡¨ã€‚Queueåªæœ‰ä¸¤ä¸ªæ“ä½œï¼š</p><ul><li>æŠŠå…ƒç´ æ·»åŠ åˆ°æœ«å°¾</li><li>ä»å¤´éƒ¨å–å‡ºå…ƒç´ </li></ul><p>æ¥å£<code>Queue</code>å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>size(): int</code>:è¿”å›é˜Ÿåˆ—ä¸­çš„å…ƒç´ çš„æ•°é‡</li><li><code>add(E e)</code>:æ·»åŠ å…ƒç´ åˆ°é˜Ÿå°¾ï¼Œæ·»åŠ å¤±è´¥çš„è¯æŠ›å‡º<code>IllegalStateException</code></li><li><code>offer(E e): boolean</code>:æ·»åŠ å…ƒç´ åˆ°é˜Ÿå°¾ï¼Œæ·»åŠ å¤±è´¥è¿”å›<code>false</code>ã€‚<strong>æ›´å®‰å…¨ï¼Œæ¨è</strong></li><li><code>remove(): E</code>:è·å–å¹¶ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºåˆ™æŠ›å¼‚å¸¸<code>NoSuchElementException</code></li><li><code>poll(): E</code>:è·å–å¹¶ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¦‚æœä¸ºç©ºè¿”å›<code>null</code>ã€‚<strong>æ›´å®‰å…¨ï¼Œæ¨è</strong></li><li><code>element(): E</code>:è·å–ä½†ä¸ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œé˜Ÿåˆ—ä¸ºç©ºæŠ›å¼‚å¸¸<code>NoSuchElementException</code></li><li><code>peek(): E</code>:è·å–ä½†ä¸ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œé˜Ÿåˆ—ä¸ºç©ºè¿”å›<code>null</code>ã€‚<strong>æ›´å®‰å…¨ï¼Œæ¨è</strong></li></ul><h2 id="linkedlist">LinkedList</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedList</span>&lt;E&gt;<br>    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractSequentialList</span>&lt;E&gt;<br>    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List</span>&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable<br></code></pre></td></tr></table></figure><p><code>LinkedList</code>æ˜¯æœ€å¸¸ç”¨çš„å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨çš„æ–¹å¼å­˜å‚¨ï¼Œæ·»åŠ å’ŒæŸ¥æ‰¾æ•°æ®æ—¶æ•ˆç‡è¾ƒä½ã€‚é€‚ç”¨äºå¯¹é›†åˆä¸­çš„æ•°æ®è¿›è¡Œé¢‘ç¹çš„åˆ é™¤å’Œæ’å…¥æ“ä½œã€‚</p><p>æ³¨æ„<code>LinkedList</code>åŒæ—¶å®ç°äº†<code>Queue</code>å’Œ<code>List</code>æ¥å£ï¼Œä½¿ç”¨æ—¶è¯¥ç”¨å“ªä¸ªç”¨å“ªä¸ªã€‚</p><h2 id="priorityqueue">PriorityQueue</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityQueue</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueue</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œå…ƒç´ çš„é¡ºåºæŒ‰ç…§<strong>ä¼˜å…ˆçº§çš„å¤§å°</strong>æ’åˆ—ï¼Œå®ƒå¹¶ä¸éµå¾ªä¸¥æ ¼çš„å…ˆè¿›å…ˆå‡ºã€‚æ‰€è°“ä¼˜å…ˆçº§çš„å¤§å°ï¼ŒæŒ‡çš„æ˜¯å®ƒä¼šæ ¹æ®æä¾›çš„æ¯”è¾ƒå™¨å¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œæˆ–è€…ä½¿ç”¨è‡ªç„¶æ’åºï¼ˆç©ºæ„é€ å™¨çš„æƒ…å†µï¼‰ã€‚</p><p>å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Queue&lt;E&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„å£°æ˜ä½¿ç”¨äº†ç©ºçš„æ„é€ å™¨ï¼Œè¿™ç§æƒ…å†µä¸‹é˜Ÿåˆ—ä¸­çš„å…ƒç´ æŒ‰ç…§<strong>è‡ªç„¶æ’åº</strong>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªlambdaè¡¨è¾¾å¼é‡å†™æ¯”è¾ƒæ–¹æ³•å®ç°å®šåˆ¶æ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br><br>    PriorityQueue&lt;Integer&gt; pq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;((a,b) -&gt; b - a);<br><br>    pq.offer(<span class="hljs-number">5</span>);<br>    pq.offer(<span class="hljs-number">1</span>);<br>    pq.offer(<span class="hljs-number">3</span>);<br><br>    <span class="hljs-keyword">while</span> (!pq.isEmpty()) &#123;<br>        System.out.println(pq.poll());  <span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼š5, 3, 1</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="deque">Deque</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Deque</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Queue</span>&lt;E&gt;, SequencedCollection&lt;E&gt;<br></code></pre></td></tr></table></figure><div class="note note-secondary">            <p><code>Deque</code>æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨é˜Ÿåˆ—ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤æ“ä½œçš„çº¿æ€§é›†åˆã€‚å®ƒçš„åå­—"deque"æ˜¯"doubleendedqueue"ï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰çš„ç®€ç§°ã€‚å¤§éƒ¨åˆ†<code>Deque</code>çš„å®ç°å¯¹åŒ…å«çš„å…ƒç´ çš„æ•°é‡æ²¡æœ‰å›ºå®šé™åˆ¶ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£ä¹Ÿæ”¯æŒæœ‰å®¹é‡é™åˆ¶çš„é˜Ÿåˆ—å’Œæ— é™å®¹é‡é˜Ÿåˆ—ã€‚</p>          </div><h3 id="å®ç°ç±»-1">å®ç°ç±»</h3><table><thead><tr><th>å®ç°ç±»åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ArrayDeque</code></td><td>å¸¸ç”¨ï¼ŒåŸºäºæ•°ç»„ï¼Œæ•ˆç‡é«˜ï¼Œé€‚åˆæ ˆ/é˜Ÿåˆ—æ“ä½œ</td></tr><tr><td><code>LinkedList</code></td><td>ä¹Ÿå®ç°äº† <code>Deque</code>ï¼Œä½†æ•ˆç‡ç•¥ä½</td></tr><tr><td><code>LinkedBlockingDeque</code></td><td>çº¿ç¨‹å®‰å…¨ï¼Œå¯è®¾ç½®å®¹é‡é™åˆ¶ï¼ˆåœ¨å¹¶å‘åœºæ™¯ä½¿ç”¨ï¼‰</td></tr></tbody></table><p>è¿™é‡Œåˆå‡ºç°äº†<code>LinkedList</code>ã€‚æ‰€ä»¥è¯´ä½¿ç”¨<code>LinkedList</code>çš„æ—¶å€™æœ€å¥½ä½¿ç”¨å®ƒçš„æ¥å£æ¥å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸æ¨èçš„å†™æ³•:</span><br>LinkedList&lt;String&gt; d1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>d1.offerLast(<span class="hljs-string">&quot;z&quot;</span>);<br><span class="hljs-comment">// æ¨èçš„å†™æ³•ï¼š</span><br>Deque&lt;String&gt; d2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>d2.offerLast(<span class="hljs-string">&quot;z&quot;</span>);<br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•">æ–¹æ³•</h3><p><strong>æ·»åŠ å…ƒç´ çš„æ–¹æ³•</strong>ï¼š</p><table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½</th><th>æŠ›å¼‚å¸¸ç‰ˆæœ¬</th><th>å®‰å…¨è¿”å›ç‰ˆæœ¬</th></tr></thead><tbody><tr><td><code>addFirst(e)</code></td><td>æ·»åŠ åˆ°é˜Ÿå¤´ï¼ˆæ ˆé¡¶ï¼‰</td><td>âœ…</td><td>âŒï¼ˆæ— ï¼‰</td></tr><tr><td><code>offerFirst(e)</code></td><td>æ·»åŠ åˆ°é˜Ÿå¤´ï¼ˆæ ˆé¡¶ï¼‰</td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>addLast(e)</code></td><td>æ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆé˜Ÿåˆ—å°¾éƒ¨ï¼‰</td><td>âœ…</td><td>âŒï¼ˆæ— ï¼‰</td></tr><tr><td><code>offerLast(e)</code></td><td>æ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆé˜Ÿåˆ—å°¾éƒ¨ï¼‰</td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>add(e)</code></td><td>é»˜è®¤æ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆç­‰åŒ <code>addLast</code>ï¼‰</td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>offer(e)</code></td><td>é»˜è®¤æ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆç­‰åŒ <code>offerLast</code>ï¼‰</td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>push(e)</code></td><td><strong>æ ˆæ“ä½œ</strong>ï¼Œæ·»åŠ åˆ°å¤´éƒ¨ï¼ˆç­‰åŒ<code>addFirst</code>ï¼‰</td><td>âœ…</td><td>âŒ</td></tr></tbody></table><p><strong>åˆ é™¤å…ƒç´ çš„æ–¹æ³•</strong></p><table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½</th><th>æŠ›å¼‚å¸¸ç‰ˆæœ¬</th><th>å®‰å…¨è¿”å›ç‰ˆæœ¬</th></tr></thead><tbody><tr><td><code>removeFirst()</code></td><td>åˆ é™¤å¹¶è¿”å›é˜Ÿå¤´å…ƒç´ </td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>pollFirst()</code></td><td>åˆ é™¤å¹¶è¿”å›é˜Ÿå¤´å…ƒç´ </td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>removeLast()</code></td><td>åˆ é™¤å¹¶è¿”å›é˜Ÿå°¾å…ƒç´ </td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>pollLast()</code></td><td>åˆ é™¤å¹¶è¿”å›é˜Ÿå°¾å…ƒç´ </td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>remove()</code></td><td>é»˜è®¤åˆ é™¤é˜Ÿå¤´ï¼ˆç­‰åŒ <code>removeFirst</code>ï¼‰</td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>poll()</code></td><td>é»˜è®¤åˆ é™¤é˜Ÿå¤´ï¼ˆç­‰åŒ <code>pollFirst</code>ï¼‰</td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>pop()</code></td><td><strong>æ ˆæ“ä½œ</strong>ï¼Œåˆ é™¤å¤´éƒ¨ï¼ˆç­‰åŒ<code>removeFirst</code>ï¼‰</td><td>âœ…</td><td>âŒ</td></tr></tbody></table><p><strong>æŸ¥çœ‹å…ƒç´ çš„æ–¹æ³•</strong></p><table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½</th><th>æŠ›å¼‚å¸¸ç‰ˆæœ¬</th><th>å®‰å…¨è¿”å›ç‰ˆæœ¬</th></tr></thead><tbody><tr><td><code>getFirst()</code></td><td>è·å–é˜Ÿå¤´å…ƒç´ </td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>peekFirst()</code></td><td>è·å–é˜Ÿå¤´å…ƒç´ </td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>getLast()</code></td><td>è·å–é˜Ÿå°¾å…ƒç´ </td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>peekLast()</code></td><td>è·å–é˜Ÿå°¾å…ƒç´ </td><td>âŒ</td><td>âœ…</td></tr><tr><td><code>element()</code></td><td>é»˜è®¤è·å–é˜Ÿå¤´ï¼ˆç­‰åŒ <code>getFirst</code>ï¼‰</td><td>âœ…</td><td>âŒ</td></tr><tr><td><code>peek()</code></td><td>é»˜è®¤è·å–é˜Ÿå¤´ï¼ˆç­‰åŒ <code>peekFirst</code>ï¼‰</td><td>âŒ</td><td>âœ…</td></tr></tbody></table><p><strong>å…¶ä»–æ–¹æ³•</strong></p><table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>isEmpty()</code></td><td>åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</td></tr><tr><td><code>size()</code></td><td>è¿”å›å½“å‰å…ƒç´ æ•°é‡</td></tr><tr><td><code>contains(Object)</code></td><td>åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ </td></tr><tr><td><code>clear()</code></td><td>æ¸…ç©ºæ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>iterator()</code></td><td>ä»å¤´åˆ°å°¾éå†</td></tr><tr><td><code>descendingIterator()</code></td><td>ä»å°¾åˆ°å¤´éå†</td></tr></tbody></table><h2 id="stack">Stack</h2><p>Stack(æ ˆ)çš„ç‰¹ç‚¹ï¼šåè¿›å…ˆå‡ºï¼Œç›¸å½“äºæŠŠé˜Ÿåˆ—çš„ä¸€ç«¯å µæ­»ï¼Œåªç•™ä¸€ä¸ªå‡ºå£ã€‚</p><p>ä½¿ç”¨Dequeå¯ä»¥å®ç°åè¿›å…ˆå‡ºçš„æ ˆæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>    Deque&lt;String&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// push â€œå‹å…¥â€ æ ˆæ“ä½œæ·»åŠ åˆ°å¤´éƒ¨</span><br>    stack.push(<span class="hljs-string">&quot;A&quot;</span>);<br>    stack.push(<span class="hljs-string">&quot;B&quot;</span>);<br>    stack.push(<span class="hljs-string">&quot;C&quot;</span>);<br><br>    <span class="hljs-comment">// pop â€œå¼¹å‡ºâ€ æ ˆæ“ä½œåˆ é™¤å¤´éƒ¨</span><br>    <span class="hljs-keyword">while</span> (!stack.isEmpty()) &#123;<br>        System.out.println(stack.pop()); <span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼šC B A</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æŠŠDequeä½œä¸ºStackä½¿ç”¨æ—¶ï¼Œæ³¨æ„åªè°ƒç”¨<code>push()</code>/<code>pop()</code>/<code>peek()</code>æ–¹æ³•ï¼Œä¸è¦è°ƒç”¨<code>addFirst()</code>/<code>removeFirst()</code>/<code>peekFirst()</code>æ–¹æ³•ï¼Œè¿™æ ·ä»£ç æ›´åŠ æ¸…æ™°ã€‚</p><h1 id="iterator">Iterator</h1><p>Iterator,è·å–è¿­ä»£å™¨çš„å¯¹è±¡ï¼š<code>Iterator itr = é›†åˆ.iterator();</code></p><p>éå†é›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼š<code>itr.hasNext()</code>+<code>itr.next()</code></p><figure><img src="https://i.imgur.com/uRaHFI0.png" alt="è¿­ä»£å™¨å›¾è§£" /><figcaption aria-hidden="true">è¿­ä»£å™¨å›¾è§£</figcaption></figure><p>ä½¿ç”¨è¿­ä»£å™¨çš„å¥½å¤„åœ¨äºï¼Œè°ƒç”¨æ–¹æ€»æ˜¯ä»¥ç»Ÿä¸€çš„æ–¹å¼éå†å„ç§<strong>é›†åˆ</strong>ç±»å‹ï¼Œè€Œä¸å¿…å…³å¿ƒå®ƒä»¬å†…éƒ¨çš„å­˜å‚¨ç»“æ„ã€‚</p><h1 id="é›†åˆæ¡†æ¶å¸¸ç”¨æ–¹æ³•æ€»ç»“">é›†åˆæ¡†æ¶å¸¸ç”¨æ–¹æ³•æ€»ç»“</h1><h2 id="collectionæ¥å£">Collectionæ¥å£</h2><p><code>Collection</code>æ¥å£ä½œä¸ºé›†åˆæ¡†æ¶æœ€ä¸Šå±‚çš„æ¥å£ï¼Œæ‰€æœ‰çš„é›†åˆæ•°æ®ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨å…¶ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–¹æ³•ç­¾å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>boolean add(E e)</code></td><td>å‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ </td></tr><tr><td><code>boolean addAll(Collection&lt;? extends E&gt; c)</code></td><td>å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è¿›æ¥</td></tr><tr><td><code>void clear()</code></td><td>æ¸…ç©ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>boolean contains(Object o)</code></td><td>åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ </td></tr><tr><td><code>boolean containsAll(Collection&lt;?&gt; c)</code></td><td>åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«å¦ä¸€ä¸ªé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>boolean isEmpty()</code></td><td>åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º</td></tr><tr><td><code>Iterator&lt;E&gt; iterator()</code></td><td>è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨äºéå†é›†åˆå…ƒç´ </td></tr><tr><td><code>boolean remove(Object o)</code></td><td>åˆ é™¤é›†åˆä¸­é¦–æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ </td></tr><tr><td><code>boolean removeAll(Collection&lt;?&gt; c)</code></td><td>åˆ é™¤é›†åˆä¸­ä¸æŒ‡å®šé›†åˆä¸­ç›¸åŒçš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>boolean retainAll(Collection&lt;?&gt; c)</code></td><td>ä»…ä¿ç•™é›†åˆä¸­ä¹ŸåŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ ï¼ˆäº¤é›†ï¼‰</td></tr><tr><td><code>int size()</code></td><td>è¿”å›é›†åˆä¸­å…ƒç´ çš„æ•°é‡</td></tr><tr><td><code>Object[] toArray()</code></td><td>è¿”å›ä¸€ä¸ªåŒ…å«é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„</td></tr><tr><td><code>&lt;T&gt; T[] toArray(T[] a)</code></td><td>è¿”å›ä¸€ä¸ªåŒ…å«é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„æŒ‡å®šç±»å‹æ•°ç»„</td></tr></tbody></table><h2 id="listæ¥å£">Listæ¥å£</h2><p><img src="https://s21.ax1x.com/2025/04/30/pEHswkT.png" /></p><p><code>List</code>ä½œä¸ºä¸€ä¸ªæ¥å£ï¼Œä¹Ÿæ˜¯Collectionçš„å­æ¥å£ã€‚<code>Collection</code>å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›ç‰¹æœ‰çš„æ–¹æ³•ï¼š</p><table><thead><tr><th>æ–¹æ³•ç­¾å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>void add(int index, E element)</code></td><td>åœ¨æŒ‡å®šç´¢å¼•æ’å…¥å…ƒç´ </td></tr><tr><td><code>E get(int index)</code></td><td>è·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´ </td></tr><tr><td><code>E set(int index, E element)</code></td><td>æ›¿æ¢æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ </td></tr><tr><td><code>E remove(int index)</code></td><td>åˆ é™¤æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ </td></tr><tr><td><code>int indexOf(Object o)</code></td><td>è¿”å›å…ƒç´ é¦–æ¬¡å‡ºç°çš„ç´¢å¼•</td></tr><tr><td><code>int lastIndexOf(Object o)</code></td><td>è¿”å›å…ƒç´ æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•</td></tr><tr><td><code>ListIterator&lt;E&gt; listIterator()</code></td><td>è·å–æ”¯æŒåŒå‘éå†çš„è¿­ä»£å™¨</td></tr><tr><td><code>ListIterator&lt;E&gt; listIterator(int index)</code></td><td>ä»æŒ‡å®šç´¢å¼•å¼€å§‹çš„ ListIterator</td></tr><tr><td><code>List&lt;E&gt; subList(int fromIndex, int toIndex)</code></td><td>è·å–å­åˆ—è¡¨ <code>[from, to)</code></td></tr></tbody></table><h2 id="setæ¥å£">Setæ¥å£</h2><p><code>Set</code>æ¥å£ä¹Ÿæ˜¯<code>Collection</code>çš„å­æ¥å£,ä½†æ˜¯å®ƒ<strong>æ²¡æœ‰é¢å¤–å®šä¹‰æ–°çš„æ–¹æ³•</strong>ã€‚</p><p><img src="https://s21.ax1x.com/2025/04/30/pEHsNmq.png" /></p><h2 id="mapæ¥å£">Mapæ¥å£</h2><p><code>Map</code>ä¸“é—¨ç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼Œå®ƒä¸<code>Collection</code>æ¥å£æ— ç›´æ¥å…³è”ï¼Œå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–¹æ³•ç­¾å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>V put(K key, V value)</code></td><td>å°†æŒ‡å®šçš„é”®å€¼å¯¹æ’å…¥åˆ° Map ä¸­ï¼ˆè‹¥é”®å·²å­˜åœ¨åˆ™æ›´æ–°å€¼ï¼Œè¿”å›æ—§å€¼ï¼‰</td></tr><tr><td><code>V get(Object key)</code></td><td>æ ¹æ®é”®è·å–å¯¹åº”çš„å€¼</td></tr><tr><td><code>V remove(Object key)</code></td><td>æ ¹æ®é”®ç§»é™¤é”®å€¼å¯¹ï¼Œè¿”å›è¢«åˆ é™¤çš„å€¼</td></tr><tr><td><code>boolean containsKey(Object key)</code></td><td>åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šé”®</td></tr><tr><td><code>boolean containsValue(Object value)</code></td><td>åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šå€¼</td></tr><tr><td><code>int size()</code></td><td>è¿”å›é”®å€¼å¯¹æ•°é‡</td></tr><tr><td><code>boolean isEmpty()</code></td><td>åˆ¤æ–­ Map æ˜¯å¦ä¸ºç©º</td></tr><tr><td><code>void clear()</code></td><td>æ¸…ç©º Map ä¸­æ‰€æœ‰å†…å®¹</td></tr><tr><td><code>Set&lt;K&gt; keySet()</code></td><td>è¿”å›æ‰€æœ‰é”®çš„é›†åˆ</td></tr><tr><td><code>Collection&lt;V&gt; values()</code></td><td>è¿”å›æ‰€æœ‰å€¼çš„é›†åˆ</td></tr><tr><td><code>Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet()</code></td><td>è¿”å›æ‰€æœ‰é”®å€¼å¯¹çš„é›†åˆï¼ˆæ¯ä¸ª Entry æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼‰</td></tr><tr><td><code>V putIfAbsent(K key, V value)</code></td><td>å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥é”®å€¼å¯¹ï¼ˆJDK 1.8+ï¼‰</td></tr></tbody></table><h1id="å¦‚ä½•å°†åˆ—è¡¨è½¬æ¢æˆç‰¹å®šç±»å‹çš„æ•°ç»„">å¦‚ä½•å°†åˆ—è¡¨è½¬æ¢æˆç‰¹å®šç±»å‹çš„æ•°ç»„</h1><h2 id="å¼•å…¥">å¼•å…¥</h2><p>å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;ListNode&gt; TempList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>...<br>ListNode[] lists = TempList.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>[<span class="hljs-number">0</span>]);<br></code></pre></td></tr></table></figure><p><code>lists</code>æ˜¯ä¸€ä¸ªç”¨äºå­˜æ”¾<code>ListNode</code>æ•°æ®çš„æ•°ç»„ï¼Œ<code>Templist</code>æ˜¯ä¸€ä¸ªå­˜æ”¾<code>ListNode</code>å…ƒç´ çš„åˆ—è¡¨ã€‚æœ€åä¸€è¡Œä»£ç å®ç°äº†ä»<code>TempList</code>åˆ—è¡¨å‘æ•°ç»„çš„è½¬åŒ–ã€‚è¿™é‡Œçš„å…³é”®æ˜¯<code>toArray</code>æ–¹æ³•ï¼Œå®é™…ä¸Š<code>List</code>æ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ª<code>toArray</code>æŠ½è±¡æ–¹æ³•ï¼Œä¸€ä¸ªç©ºå‚ä¸€ä¸ªæœ‰å‚ï¼Œå®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Object[] toArray();<br>&lt;T&gt; T[] toArray(T[] a);<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ææ¸…æ¥šè¿™ä¸¤ä¸ªæ–¹æ³•å¦‚ä½•ä½¿ç”¨ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹<code>runtime type</code>ï¼ˆè¿è¡Œæ—¶ç±»å‹ï¼‰å’Œ<code>compile type</code>ï¼ˆç¼–è¯‘æ—¶ç±»å‹ï¼‰ã€‚</p><h2 id="ç¼–è¯‘æ—¶ç±»å‹å’Œè¿è¡Œæ—¶ç±»å‹">ç¼–è¯‘æ—¶ç±»å‹å’Œè¿è¡Œæ—¶ç±»å‹</h2><p>è¿è¡Œæ—¶ç±»å‹ï¼ŒæŒ‡çš„æ˜¯å¯¹è±¡åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­çœŸå®çš„ç±»å‹ã€‚ä¹‹æ‰€ä»¥å¼ºè°ƒâ€œçœŸå®â€ï¼Œæ˜¯å› ä¸ºJavaä¸­çš„å¤šæ€ä½¿å¾—ç¼–è¯‘å™¨è®¤ä¸ºçš„ç±»å‹å’Œç¨‹åºè¿è¡Œæ—¶çš„ç±»å‹å¯èƒ½ä¸ä¸€æ ·ï¼Œä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Animal</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br></code></pre></td></tr></table></figure><p>æ‰€è°“<em>ç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å³è¾¹</em>ï¼Œ<code>a</code>çš„ç¼–è¯‘æ—¶ç±»å‹æ˜¯<code>Animal</code>ï¼Œè¿è¡Œæ—¶ç±»å‹æ˜¯<code>Dog</code>ã€‚</p><h2 id="javaæ ‡å‡†åº“æä¾›çš„æ³¨é‡Š">Javaæ ‡å‡†åº“æä¾›çš„æ³¨é‡Š</h2><p>å…ˆçœ‹ç©ºå‚æ–¹æ³•<code>Object[] toArray();</code>ï¼š</p><blockquote><p>æŒ‰ç…§æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªï¼‰è¿”å›ä¸€ä¸ªåŒ…å«åŸåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚</p><p>è¿”å›çš„æ•°ç»„æ˜¯â€œå®‰å…¨çš„â€ï¼Œæ„æ€å°±æ˜¯è¯´å®ƒä¸åŒ…å«ä»»ä½•å¯¹åŸåˆ—è¡¨çš„å¼•ç”¨ï¼Œæ˜¯å®Œå…¨ç‹¬ç«‹äºåŸåˆ—è¡¨çš„ã€‚ä½ å¯ä»¥æ”¾å¿ƒåœ°ä¿®æ”¹å®ƒï¼Œä¸ç”¨æ‹…å¿ƒä¼šå¯¹åŸåˆ—è¡¨äº§ç”Ÿä»»ä½•å½±å“ã€‚</p><p>è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºæ•°ç»„çš„ API å’ŒåŸºäºé›†åˆçš„ API ä¹‹é—´çš„æ¡¥æ¢ã€‚</p></blockquote><p><code>è¿”å›å€¼</code>:ä¸€ä¸ªä»¥æ­£ç¡®çš„é¡ºåºåŒ…å«åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„<code>Object</code>æ•°ç»„</p><p>è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç±»å‹å›ºå®šä¸º<code>Object[]</code>ï¼Œåœ¨å®é™…åº”ç”¨ä¸­éœ€è¦æ‰‹åŠ¨å¼ºè½¬æˆæˆ‘ä»¬éœ€è¦çš„ç±»å‹ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚äºæ˜¯å°±æœ‰äº†åé¢è¿™ä¸ªå¸¦å‚æ•°çš„æ–¹æ³•</p><hr /><p><code>&lt;T&gt; T[] toArray(T[] a);</code></p><blockquote><p>ç…§æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªï¼‰è¿”å›ä¸€ä¸ªåŒ…å«åŸåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚è¿”å›æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ä¸æŒ‡å®šæ•°ç»„ç›¸åŒã€‚å¦‚æœè¯¥åˆ—è¡¨å¯ä»¥è£…å…¥æŒ‡å®šçš„æ•°ç»„ä¸­ï¼Œåˆ™ç›´æ¥æŠŠå®ƒæ”¾è¿›æ•°ç»„å¹¶è¿”å›ï¼›å¦åˆ™ï¼Œä¼šåˆ†é…ä¸€ä¸ªå…·æœ‰ä¸æŒ‡å®šæ•°ç»„ç›¸åŒè¿è¡Œæ—¶ç±»å‹çš„æ–°æ•°ç»„ï¼Œå…¶å¤§å°ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚</p><p>å¦‚æœæŒ‡å®šçš„æ•°ç»„æ¯”åŸåˆ—è¡¨éœ€è¦çš„ç©ºé—´è¿˜å¤§ï¼Œé‚£ä¹ˆç©ºç¼ºä½ç½®ä¼šè¢«èµ‹å€¼ä¸º<code>null</code>ã€‚ï¼ˆ<em>ä»…å½“</em>è°ƒç”¨è€…ç¡®è®¤åŸåˆ—è¡¨ä¸­ä¸åŒ…å«ä»»ä½•<code>null</code>å…ƒç´ æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§æ‰æœ‰åŠ©äºåˆ¤æ–­åˆ—è¡¨çš„é•¿åº¦ï¼‰</p><p>å°±åƒ<code>toArray()</code>æ–¹æ³•ä¸€æ ·ï¼Œè¯¥æ–¹æ³•æ˜¯åŸºäºæ•°ç»„çš„ APIå’ŒåŸºäºé›†åˆçš„ APIä¹‹é—´çš„æ¡¥æ¢ã€‚æ­¤å¤–ï¼Œè¯¥æ–¹æ³•å…è®¸å¯¹è¾“å‡ºæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹è¿›è¡Œç²¾ç¡®çš„æ§åˆ¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æˆ–è®¸å¯ä»¥èŠ‚çœå†…å­˜å¼€é”€ã€‚</p><p>å‡è®¾<code>x</code>æ˜¯ä¸€ä¸ªå·²çŸ¥åªåŒ…å«å­—ç¬¦ä¸²çš„åˆ—è¡¨ã€‚ä»¥ä¸‹ä»£ç å¯ä»¥ç”¨äºå°†åˆ—è¡¨è½¬å­˜åˆ°æ–°åˆ†é…çš„Stringæ•°ç»„ä¸­ï¼š</p><p><code>String[] y = x.toArray(new String[0]);</code></p><p>æ³¨æ„<code>toArray(new Object[0])</code>ä¸ä¸Šé¢çš„<code>toArray()</code>å®Œå…¨ç›¸åŒã€‚</p></blockquote><p><code>å‚æ•°</code>: <code>a</code>-æŒ‡å®šæ•°ç»„ï¼Œå¦‚æœè¶³å¤Ÿå¤§ï¼ŒåŸåˆ—è¡¨çš„å…ƒç´ å°†è¢«ç›´æ¥å­˜å…¥è¯¥æ•°ç»„ï¼›å¦åˆ™ï¼Œä¼šåˆ†é…ä¸€ä¸ªä¸ä¹‹ç›¸åŒè¿è¡Œç±»å‹çš„æ–°æ•°ç»„ã€‚</p><p><code>è¿”å›å€¼</code>: ä¸€ä¸ªåŒ…å«åˆ—è¡¨å…ƒç´ çš„æ•°ç»„</p><p><code>æŠ›å‡º</code>: <code>ArrayStoreException</code> -å¦‚æœæŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ä¸æ˜¯æ¯ä¸€ä¸ªåˆ—è¡¨å…ƒç´ çš„çˆ¶ç±»å‹<br /><code>NullPointerException</code> - å¦‚æœæŒ‡å®šæ•°ç»„æ˜¯<code>null</code></p><hr /><p>Javaæ ‡å‡†åº“ä¸­ç»™å‡ºçš„è§£é‡Šå·²ç»éå¸¸è¯¦ç»†äº†ã€‚å¯¹äºå¼€å¤´å¤„çš„è¯­å¥<code>ListNode[] lists = TempList.toArray(new ListNode[0]);</code>ï¼Œå½¢å‚<code>new ListNode[0]</code>çš„ä¸»è¦ä½œç”¨æ˜¯<strong>ç¡®å®šè¿”å›æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹</strong>ï¼Œå®ƒä½œä¸ºæˆ‘ä»¬ç»™å‡ºçš„æŒ‡å®šæ•°ç»„ï¼Œå…¶å®¹é‡ä¸º0ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥ä¼šåˆ†é…ä¸€ä¸ªè¿è¡Œæ—¶ç±»å‹ä¸º<code>ListNode[]</code>çš„æ–°æ•°ç»„ï¼Œå…¶å®¹é‡ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚ç„¶åï¼ŒæŠŠè¿”å›çš„æ•°ç»„èµ‹ç»™ç›¸åŒç±»å‹çš„æ•°ç»„<code>lists</code>å°±æ²¡æœ‰ä»»ä½•é—®é¢˜äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã‚µãƒãƒ¼ã‚¿ã‚¤ãƒ ãƒ¬ã‚³ãƒ¼ãƒ‰ ã˜ã‚“ã€€æ­Œè©</title>
    <link href="/2025/04/08/summertimerecord/"/>
    <url>/2025/04/08/summertimerecord/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>ã“ã‚Œãå¤</p><p>ä½œè©/ä½œæ›²/ç·¨æ›²/Guitarï¼šã˜ã‚“</p><p>æ˜¨æ—¥ã‚‚ä»Šæ—¥ã‚‚æ™´å¤©ã§<br />å…¥é“é›²ã‚’è¦‹ã¦ã„ãŸ</p><p>æ€ ã„ãã‚‰ã„ã®å¿«æ™´ã <br />å¾ã€…ã«ç›®ã‚’é–‰ã˜ã¦</p><p>ã€Œãã‚Œã€ã¯ã©ã†ã‚‚ç°¡å˜ã«<br />æ€ã„å‡ºã›ã‚„ã—ãªã„æ§˜ã§</p><p>å¹´ã‚’å–ã£ãŸç¾çŠ¶ã«<br />æµ¸ã£ã¦ãŸã‚“ã ã‚ˆ</p><p>å¤§äººã¶ã£ãŸä½œæˆ¦ã§<br />ä¸æ€è­°ãªåˆå›³ç«‹ã¦ã¦</p><p>ã€Œè¡Œã“ã†ã‹ã€ä»Šæ—¥ã‚‚æˆ¦äº‰ã ã€<br />ç«‹ã¡å‘ã‹ã£ã¦ã€€æ‰‹ã‚’å–ã£ãŸ</p><p>ç†ä¸å°½ãªã‚“ã¦å½“ç„¶ã§<br />ä¸€äººã¼ã£ã¡ã€€å¼·ã„ã‚‰ã‚Œã¦</p><p>è¿·ã£ãŸåƒ•ã¯<br />æ†‚é¬±ã«ãªã‚Šãã†ã«ãªã£ã¦ã•</p><p>èƒŒé«˜è‰ã‚’åˆ†ã‘ã¦<br />æ»²ã‚€å¤ªé™½ç¨ã‚“ã§</p><p>å›ã¯ã•ã€ã“ã†è¨€ã£ãŸã‚“ã <br />ã€Œå­¤ç‹¬ã ã‹ã‚‰ã€ãŠã„ã§ã‚ˆã€</p><p>é¨’ãŒã—ã•ãŒãƒãƒƒã‚¯ã—ã¦<br />ç”Ÿã¾ã‚ŒãŸã€€æ„Ÿæƒ…ã•ãˆã‚‚</p><p>é ­ã«æµ®ã‹ã‚“ã§ã¯èã‚“ã </p><p>ã€Œå¹»ãªã®ã‹ãªï¼Ÿã€</p><p>ç§˜å¯†åŸºåœ°ã«é›†ã¾ã£ã¦<br />ã€Œæ¥½ã—ã„ã­ã€ã£ã¦å˜ç´”ã«</p><p>ã‚ã®é ƒã‚’æ€ã„å‡ºã—ã¦<br />è©±ã‚’ã—ã‚ˆã†</p><p>é£›è¡Œæ©Ÿé›²é£›ã‚“ã§è¡Œã£ã¦<br />ã€Œçœ©ã—ã„ã­ã€ã£ã¦æ³£ã„ã¦ã„ãŸ</p><p>å›ã¯ã©ã‚“ãªé¡”ã ã£ã‘</p><p>ãªãœã ã‚ã†</p><p>æ€ã„å‡ºã›ãªã„ãª</p><hr /><p>ç—›ã„ãã‚‰ã„ã«ç¾å®Ÿã¯ã€€è¶³æ—©ã«é§†ã‘æŠœã‘ãŸ</p><p>é¸ã‚“ã ä»Šæ—¥ã¯å¹³å‡¡ã§ã€€å´©ã‚Œãã†ã«ãªã‚‹æ—¥ã€…ã•</p><p>æ˜¨æ—¥ã‚‚ä»Šæ—¥ã‚‚å»¶é•·æˆ¦ã€€å¤§äººã ã£ã¦ã€€è‡†ç—…ã </p><p>ä»Šã«ãªã£ã¦ãªã‚“ã¨ãªãã€€æ°—ä»˜ã‘ãŸã¿ãŸã„ã ã‚ˆ</p><p>å»»ã‚‹ã‚»ã‚«ã‚¤ã®ã‚¤ãƒ‡ã‚¢ã€€æ¯ã‚Œã‚‹å¤ªé™½ã€€ç‚å¤©ä¸‹</p><p>é™½ç‚ãŒæºã‚‰ã„ã ã€€ã€Œå¿˜ã‚Œãªã„ã§ã€ã•ãã€é€²ã‚‚ã†ã€</p><p>ã‚‚ã©ã‹ã—ã•ä½•åº¦ã§ã‚‚ã€€æ˜æ—¥ã‚’å¤¢ã«è¦‹ã¦ã„ãŸ</p><p>æˆ»ã‚‰ãªã„ã€å…ˆã®ã‚ã‚‹ä¸–ç•Œã¸ã€€ã€Œåƒ•ãŸã¡ã§å¤‰ãˆã‚ˆã†ã€ ã€€ã€Œæ€ã„å‡ºã—ã¦ã€çµ‚ã‚ãŸã£ã¦ã€€ç§˜å¯†åŸºåœ°ã‚‚ã€å†’é™ºã‚‚ã€</p><p>ã‚ã®æ—¥ã«è¿·ã„è¾¼ã‚“ã ã€€è©±ã®äº‹ã‚‚</p><p>ä¸€äººã¼ã£ã¡ãŒé›†ã¾ã£ãŸã€€å­ä¾›ãŸã¡ã®ä½œæˆ¦ãŒã€€ã¾ãŸä»Šæ—¥ã‚‚å»»ã‚Šå‡ºã—ãŸ</p><p>ã€Œã¾ãŸã€ä½•å‡¦ã‹ã§ã€‚ã€</p><p>ã€Œæ¶¼ã—ã„ã­ã€ã£ã¦è¨€ã„åˆã£ãŸã€€å¤ç©ºã¯é€æ˜ã </p><p>æ³£ã‹ãªã„æ§˜ã«ã€å¸ã„è¾¼ã‚“ã§ã€€ã€Œã•ã‚ˆã†ãªã‚‰ã€ã—ã‚ˆã†</p><p>ç§˜å¯†åŸºåœ°ã«é›†ã¾ã£ã¦ã€€ç¬‘ã„åˆã£ãŸå¤ã®æ—¥ã«</p><p>ã€Œã¾ãŸä½•å‡¦ã‹ã§æ€ã„å‡ºã—ã¦ã€€å‡ºé€¢ãˆã‚‹ã‹ãªã€ã£ã¦</p><p>ä½•åº¦ã§ã‚‚ã€€æã“ã†</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Java SE-å¸¸ç”¨ç±»ä¸åŸºç¡€API</title>
    <link href="/2025/04/08/java6/"/>
    <url>/2025/04/08/java6/</url>
    
    <content type="html"><![CDATA[<h1 id="string">String</h1><p>ç‰¹æ€§ï¼šä¸å¯å˜ï¼Œåˆ›å»ºåä¸èƒ½æ”¹å˜å†…å®¹ï¼Œä»»ä½•ä¿®æ”¹å…¶å®æ˜¯åˆ›å»ºäº†æ–°å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;hello&quot;</span>);<br></code></pre></td></tr></table></figure><p><code>String s1 = "hello";</code>ä½¿ç”¨<strong>å­—é¢é‡</strong>ï¼Œåœ¨å¸¸é‡æ± é‡Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœæœ‰åŒæ ·çš„å­—é¢é‡ï¼Œä¼šå¤ç”¨ï¼Œæ•ˆç‡æ›´é«˜</p><p><code>String s2 = new String("hello");</code>ä½¿ç”¨newåœ¨å †å†…å­˜é‡Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œ</p><p><code>s1==s2</code>åˆ¤æ–­ä¸º<code>false</code>,<code>s1.equals(s2)</code>åˆ¤æ–­ä¸º<code>true</code></p><h2 id="stringçš„è¿æ¥æ“ä½œ">Stringçš„è¿æ¥æ“ä½œ</h2><p>å¸¸é‡+å¸¸é‡ = å¸¸é‡æ± ä¸­çš„å¸¸é‡</p><p>å¸¸é‡+å˜é‡ = å †ç©ºé—´ä¸­è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„åœ°å€</p><p><code>intern()</code>è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¯¹åº”çš„åœ°å€ã€‚</p><p><code>concat()</code>å¿…ç„¶è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡</p><h2 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</h2><p><code>getBytes()</code>ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆå­—èŠ‚æ•°ç»„ï¼Œå‚¨å­˜çš„æ•°å­—ä¸ç¼–ç æœ‰å…³ï¼Œéœ€è¦æŒ‡å®šç¼–ç æ–¹å¼ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">byte</span>[] bytes = str.getBytes(StandardCharsets.UTF_8);<br></code></pre></td></tr></table></figure><p>utf-8æˆ–gbkéƒ½å‘ä¸‹å…¼å®¹asciiã€‚</p><p><strong>è§£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes, å­—ç¬¦é›†åç§°);<br></code></pre></td></tr></table></figure><hr /><p><code>indexOf</code>:æŸ¥æ‰¾æŸä¸ªå­—ç¬¦æˆ–å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­<strong>ç¬¬ä¸€æ¬¡</strong>å‡ºç°çš„ä½ç½®ã€‚æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›-1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> str.indexOf(String s);<br><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> str.indexOf(<span class="hljs-type">char</span> ch);<br><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> str.indexOf(String s, <span class="hljs-type">int</span> fromIndex);<br><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> str.indexOf(<span class="hljs-type">char</span> ch, <span class="hljs-type">int</span> fromIndex);<br></code></pre></td></tr></table></figure><p>è®°å½•æŸä¸ªå­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°ï¼šï¼ˆå¤æ‚åº¦å¤§ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-title function_">getSubStringCount</span><span class="hljs-params">(String str,String subStr)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> str.indexOf(subStr);<span class="hljs-comment">//ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•</span><br><br>    <span class="hljs-keyword">while</span>(index != -<span class="hljs-number">1</span>) &#123;<br>        count++;<br>        index = str.indexOf(subStr, index+subStr.length());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> count;<br>&#125;<br></code></pre></td></tr></table></figure><h2id="stringstringbufferstringbuilder">String,StringBuffer,StringBuilder</h2><p>String:ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ï¼›</p><p>StringBuffer:å¯å˜çš„å­—ç¬¦åºåˆ—ï¼›çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½</p><p>StringBuilder:å¯å˜çš„å­—ç¬¦åºåˆ—ï¼›çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜</p><p>ä»¥ä¸Šä¸‰è€…åº•å±‚å‡ä¸ºbyte[].</p><p>å¢:append</p><p>åˆ :delete(int start, int end)<br />deleteCharAt(int index)</p><p>æ”¹:replace(int start, int end, String str) setCharAt(int index, charc)</p><p>æŸ¥:charAt(inr index)</p><p>æ’:insert(int index, xx)</p><p>é•¿åº¦:length()</p><h1 id="æ—¥æœŸæ—¶é—´api">æ—¥æœŸæ—¶é—´API</h1><p>æ—§API</p><ol type="1"><li>currentTimeMillis():ä¸1970.1.1æ—¥0æ—¶0åˆ†0ç§’ä¹‹é—´çš„æ¯«ç§’æ•°</li><li>Date()ç±»</li><li>CalendaræŠ½è±¡ç±»</li></ol><p><strong>æ–°API</strong>ï¼š</p><p>æœ€å¸¸ç”¨çš„APIï¼š</p><table><thead><tr><th>ç±»å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>LocalDate</code></td><td>è¡¨ç¤ºæ—¥æœŸï¼ˆå¦‚ï¼š2025-04-09ï¼‰ï¼Œä¸å«æ—¶é—´å’Œæ—¶åŒº</td></tr><tr><td><code>LocalTime</code></td><td>è¡¨ç¤ºæ—¶é—´ï¼ˆå¦‚ï¼š12:30:45ï¼‰ï¼Œä¸å«æ—¥æœŸå’Œæ—¶åŒº</td></tr><tr><td><code>LocalDateTime</code></td><td>è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ï¼ˆå¦‚ï¼š2025-04-09T12:30:45ï¼‰ï¼Œä¸å«æ—¶åŒº</td></tr><tr><td><code>ZonedDateTime</code></td><td>è¡¨ç¤ºå¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆå¦‚ï¼š2025-04-09T12:30:45+09:00[Asia/Tokyo]ï¼‰</td></tr><tr><td><code>Instant</code></td><td>è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œç²¾ç¡®åˆ°çº³ç§’ï¼ˆä»1970-01-01T00:00:00Zå¼€å§‹ï¼‰ï¼ˆé‡å†™ä¸ºISO-8601æ ‡å‡†çš„å­—ç¬¦ä¸²ï¼‰</td></tr><tr><td><code>Duration</code></td><td>è¡¨ç¤ºä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„é—´éš”ï¼ˆå•ä½ï¼šç§’ã€çº³ç§’ï¼‰</td></tr><tr><td><code>Period</code></td><td>è¡¨ç¤ºä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„é—´éš”ï¼ˆå•ä½ï¼šå¹´ã€æœˆã€æ—¥ï¼‰</td></tr><tr><td><code>DateTimeFormatter</code></td><td>ç”¨äºæ ¼å¼åŒ–å’Œè§£ææ—¥æœŸæ—¶é—´</td></tr></tbody></table><h1 id="è‡ªå®šä¹‰ç±»çš„å¯¹è±¡çš„æ’åº">è‡ªå®šä¹‰ç±»çš„å¯¹è±¡çš„æ’åº</h1><h2 id="è‡ªç„¶æ’åºå®ç°comparableæ¥å£">1.è‡ªç„¶æ’åºï¼šå®ç°Comparableæ¥å£</h2><ol type="1"><li>å®šä¹‰ä¸€ä¸ªç±»å®ç°<code>Comparable</code>æ¥å£è¿™ä¸ªæ³›å‹æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›è´Ÿæ•°: å½“å‰å®ä¾‹æ¯”å‚æ•°oå°</span><br><span class="hljs-comment">     * è¿”å›0: å½“å‰å®ä¾‹ä¸å‚æ•°oç›¸ç­‰</span><br><span class="hljs-comment">     * è¿”å›æ­£æ•°: å½“å‰å®ä¾‹æ¯”å‚æ•°oå¤§</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(T o)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>å®ç°<code>public int compareTo(T o);</code>æ–¹æ³•ï¼ŒæŒ‡æ˜æ¯”è¾ƒçš„æ ‡å‡†</li><li>åˆ›å»ºå®ä¾‹ï¼Œè°ƒç”¨<code>Arrays.sort</code>æˆ–<code>compareTo</code>æ¯”è¾ƒå¤§å°ã€‚</li></ol><p>å®ç°compareToæ–¹æ³•ä¹‹åï¼Œ<code>Arrays.sort(arr)</code>çš„æ¯”è¾ƒæ ‡å‡†ä¹Ÿä¼šæ”¹å˜ã€‚</p><blockquote><p><code>Arrays.sort()</code> ä¼šè‡ªåŠ¨ä½¿ç”¨å…ƒç´ ç±»ä¸­å®šä¹‰çš„<code>compareTo()</code>æ–¹æ³•ï¼Œæ‰€ä»¥å½“ä½ é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ’åºé€»è¾‘è‡ªç„¶ä¹Ÿéšä¹‹æ”¹å˜äº†ã€‚</p></blockquote><p>å®ä¾‹ï¼šè®©Personå¯¹è±¡æŒ‰ç…§åå­—æ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// sort</span><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        Person[] ps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>[] &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">61</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">88</span>),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Lily&quot;</span>, <span class="hljs-number">75</span>),<br>        &#125;;<br>        Arrays.sort(ps);<br>        System.out.println(Arrays.toString(ps));<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;Person&gt; &#123;<br>    String name;<br>    <span class="hljs-type">int</span> score;<br>    Person(String name, <span class="hljs-type">int</span> score) &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.score = score;<br>    &#125;<br>    <span class="hljs-comment">//å®ç° compareTo æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Person other)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name.compareTo(other.name);<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot;,&quot;</span> + <span class="hljs-built_in">this</span>.score;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å®šåˆ¶æ’åº">2.å®šåˆ¶æ’åº</h2><p>é€‚ç”¨æƒ…å†µï¼š</p><ul><li>å…ƒç´ ç±»å‹æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œè€Œä¸”ä¸æ–¹ä¾¿ä¿®æ”¹ä»£ç </li><li>å®ç°äº†æ¥å£ï¼Œä½†æ˜¯ä»¥åä¸æƒ³ç”¨è¿™ä¸ªæ¯”è¾ƒæ–¹æ³•ï¼Œåˆä¸èƒ½å½±å“å·²æœ‰çš„ä½¿ç”¨</li></ul><ol type="1"><li>åˆ›å»ºä¸€ä¸ªå®ç°Comparatoræ¥å£çš„å®ç°ç±»A</li><li>ç±»Aè¦é‡å†™compareæ–¹æ³•</li><li>åˆ›å»ºå®ç°ç±»Açš„å®ä¾‹ï¼Œå¹¶ä¼ å…¥<code>Arrays.sort(arr,ç±»Açš„å®ä¾‹)</code></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã‚‚ã†ã˜ãå¤ãŒçµ‚ã‚ã‚‹ã‹ã‚‰ n-buna &amp;åˆéŸ³ãƒŸã‚¯ã€€æ­Œè©</title>
    <link href="/2025/04/07/%E3%82%82%E3%81%86%E3%81%98%E3%81%8D%E5%A4%8F%E3%81%8C%E7%B5%82%E3%82%8F%E3%82%8B%E3%81%8B%E3%82%89/"/>
    <url>/2025/04/07/%E3%82%82%E3%81%86%E3%81%98%E3%81%8D%E5%A4%8F%E3%81%8C%E7%B5%82%E3%82%8F%E3%82%8B%E3%81%8B%E3%82%89/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>ã‚‚ã†ã˜ãå¤ãŒçµ‚ã‚ã‚‹ã‹ã‚‰</p><p>è©ï¼šn-buna</p><p>æ›²ï¼šn-buna</p><p>ç·¨æ›²ï¼šn-buna</p><p>æœã€€å°èª¬ã‚’èª­ã‚“ã </p><p>å›ã‚’å¾…ã£ã¦ã„ãŸ</p><p>å¤œã«ãªã£ã¦æ°—ãŒä»˜ã„ãŸ</p><p>èŠ±ç«ã®éŸ³</p><p>èŠ±æºã‚‰æ­Œã„ä»Šæ—¥è—ã‚’é£›ã°ã›</p><p>è²´æ–¹ã«èã“ãˆãªã„ã‚ˆã†ã«æ¶ˆãˆã¦</p><p>ãã‚Œã‚’è¨€ãˆãªã„åƒ•ã˜ã‚ƒè¨€ãˆãªã„ã‚ˆ</p><p>ä»Šã«å¤ãŒçµ‚ã‚ã£ã¦ãã‹ã‚‰</p><p><ruby>æ˜¼é¡”<rt>ã²ã‚‹ãŒãŠ</rt></ruby>ã€€é³¥å±…ã€€<ruby>é³³ä»™èŠ±<rt>ã»ã†ã›ã‚“ã‹</rt></ruby>ã€€ãƒã‚¹åœ</p><p>é™½ã®è½ã¡ã‚‹è¡—ã‚’æ­©ã„ã¦ã„ãŸ</p><p>ä»Šæ—¥ã‚‚ã¾ãŸ</p><p>æœã€€ãƒ©ã‚¸ã‚ªã‚’èã„ãŸå›ã‚’å¾…ã£ã¦ã„ãŸ</p><p>å¤œã«ãªã£ã¦æ°—ãŒä»˜ã„ãŸã“ã¨ã‚’è¦šãˆã¦ã„ã‚‹</p><p>æ˜¨æ—¥ã‚‚ãƒ”ã‚¢ãƒã‚’å¼¾ã„ãŸ</p><p>æœã‚’å¾…ã£ã¦ã„ã‚‹</p><p>å”„ã‚’æ­Œã£ã¦ã„ã‚‹</p><p>èŠ±è©©ã€€èª“ã„ã€€ä»Šæ—¥è—ã‚’é£›ã°ã›</p><p>è²´æ–¹ã«èã“ãˆãªã„ã‚ˆã†ã«å«ã¹</p><p>å¤¢ã‚’è¦‹ã‚Œãªã„åƒ•èŠ±å’²ã„ãŸ</p><p>çµ‚ã‚ã‚‹å¤ã‚ˆæ­¢ã¾ã£ã¦ã—ã¾ãˆ</p><p>ã‚¢ãƒ™ãƒªã‚¢ã€€å§‹ç™ºã€€çµ‚é›»è»Šã€€<ruby>ç·‘é’<rt>ã‚ãã—ã‚‡ã†</rt></ruby></p><p>è‰ã®é³´ãè¡—ã‚’æ­©ã„ã¦ã„ãŸ</p><p>ä»Šæ—¥ã‚‚ã¾ãŸ</p><p>æœã€ä»Šæ—¥ã‚‚é§…ã®è£</p><p>äººãŒç«‹ã£ã¦ã„ãŸ</p><p>å¤œã®è—ã«èŠ±ãŒå’²ã</p><p>çµµã‚’ãˆãŒã„ã¦ã„ãŸ</p><p>å¸°ã£ã¦ãƒ”ã‚¢ãƒã‚’å¼¾ã„ãŸ</p><p>å¤œã«ãªã£ã¦ã„ãŸ</p><p>å›ã‚’å¾…ã£ã¦ã„ãŸ</p><p>èŠ±è©©ã€€èª“ã„ã€€æ˜æ—¥è—ã‚’é£›ã°ã›</p><p>è²´æ–¹ãŒå±…ãŸããªã„ä»Šæ—¥ã‚’å«ã¹</p><p>å¤¢ãŒè¨€ãˆãªã„ã“ã¨ã«æ°—ãŒã¤ã„ãŸ</p><p>æµ…ã„å¤ã‚ˆã€€çµ‚ã‚ã£ã¦ãã‚Œã‚ˆ</p><p><ruby>æ˜¼é¡”<rt>ã²ã‚‹ãŒãŠ</rt></ruby>ã€€é³¥å±…ã€€<ruby>é³³ä»™èŠ±<rt>ã»ã†ã›ã‚“ã‹</rt></ruby>ã€€ãƒã‚¹åœ</p><p>å¤œãŒæ˜ã‘ãŸè¡—ã‚’æ­©ã„ã¦ã„ãŸ</p><p>ä»Šæ—¥ã‚‚ã¾ãŸ</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Java SE-åŸºæœ¬å¸¸è¯†</title>
    <link href="/2025/03/22/java1/"/>
    <url>/2025/03/22/java1/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ é¡ºåºï¼šjavaseã€mysqlã€jdbcã€javawebã€mybatisã€springmvcã€springï¼Œè¿™å‡ æ ·åŸºæœ¬ä¸Šå°±æ˜¯å­¦ä¹ javaçš„éª¨æ¶äº†ã€‚</p><h1 id="å˜é‡ä¸è¿ç®—ç¬¦">å˜é‡ä¸è¿ç®—ç¬¦</h1><h2 id="æ ‡è¯†ç¬¦çš„å‘½åè§„èŒƒ">æ ‡è¯†ç¬¦çš„å‘½åè§„èŒƒ</h2><ul><li>åŒ…åï¼šå¤šå•è¯ç»„æˆæ—¶æ‰€æœ‰å­—æ¯éƒ½å°å†™ xxxyyyzzz</li><li>ç±»åã€æ¥å£åï¼šå¤šå•è¯ç»„æˆæ—¶ï¼Œæ‰€æœ‰å•è¯çš„é¦–å­—æ¯å¤§å†™ XxxYyyZzz</li><li>å˜é‡åã€æ–¹æ³•åï¼šå¤šå•è¯ç»„æˆæ—¶ï¼Œç¬¬ä¸€ä¸ªå•è¯é¦–å­—æ¯å°å†™ï¼Œç¬¬äºŒä¸ªå•è¯å¼€å§‹æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™age,name,bookName</li><li>å¸¸é‡åï¼šæ‰€æœ‰å­—æ¯éƒ½å¤§å†™ã€‚å¤šå•è¯æ—¶æ¯ä¸ªå•è¯ç”¨ä¸‹åˆ’çº¿è¿æ¥XXX_YYY_ZZZ</li></ul><h2 id="å˜é‡">å˜é‡</h2><p>å˜é‡ï¼ˆvariableï¼‰å®šä¹‰ï¼šå†…å­˜ä¸­çš„ä¸€ä¸ªå­˜å‚¨åŒºåŸŸï¼Œè¯¥åŒºåŸŸçš„æ•°æ®å¯ä»¥åœ¨åŒä¸€ç±»å‹èŒƒå›´å†…ä¸æ–­å˜åŒ–ã€‚</p><p>æ„æˆï¼šæ•°æ®ç±»å‹ å˜é‡å = å˜é‡å€¼ï¼Œä¾‹å¦‚ï¼š<code>int age = 10;</code></p><p>javaçš„å˜é‡æŒ‰ç…§æ•°æ®ç±»å‹åˆ†ä¸ºï¼š</p><pre><code class="hljs">åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ8ç§ï¼‰ï¼š      æ•´å‹ï¼šbyte \ short \ int \ long      æµ®ç‚¹å‹ï¼šfloat \ double      å­—ç¬¦å‹ï¼šchar      å¸ƒå°”å‹ï¼šboolean  å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆ6ç§ï¼‰ï¼š    ç±»ï¼ˆclassï¼‰      æ•°ç»„ï¼ˆarrayï¼‰      æ¥å£ï¼ˆinterfaceï¼‰      æšä¸¾ï¼ˆenumï¼‰      æ³¨è§£ï¼ˆannotationï¼‰      è®°å½•ï¼ˆrecordï¼‰</code></pre><p>å˜é‡éƒ½æœ‰å…¶<strong>ä½œç”¨åŸŸ</strong>ï¼Œåªåœ¨å…¶ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚</p><h3 id="æ•´å‹">æ•´å‹</h3><p>byte Â short Â int Â long åˆ†åˆ«å ç”¨1ï¼Œ2ï¼Œ4ï¼Œ8å­—èŠ‚ï¼ˆæœ‰æ­£è´Ÿï¼‰ã€‚</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>å–å€¼èŒƒå›´</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>byte</code></td><td>1</td><td><code>-128</code> ~ <code>127</code></td><td><code>0</code></td></tr><tr><td><code>short</code></td><td>2</td><td><code>-32,768</code> ~ <code>32,767</code></td><td><code>0</code></td></tr><tr><td><code>int</code></td><td>4</td><td><code>-2,147,483,648</code> ~ <code>2,147,483,647</code></td><td><code>0</code></td></tr><tr><td><code>long</code></td><td>8</td><td><code>-9,223,372,036,854,775,808</code> ~<code>9,223,372,036,854,775,807</code></td><td><code>0L</code></td></tr></tbody></table><ul><li>å®šä¹‰<code>long</code>ç±»å‹çš„å˜é‡ï¼Œèµ‹å€¼æ—¶éœ€è¦ä»¥â€œlâ€æˆ–â€œLâ€ä½œä¸ºåç¼€ã€‚</li><li>Javaç¨‹åºä¸­å˜é‡é€šå¸¸å£°æ˜ä¸º<code>int</code>ã€‚</li><li>æ•´æ•°å¸¸é‡<strong>é»˜è®¤ä¸ºintç±»å‹</strong>ã€‚</li></ul><h3 id="æµ®ç‚¹å‹">æµ®ç‚¹å‹</h3><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>å–å€¼èŒƒå›´</th><th>é»˜è®¤å€¼</th><th>ç²¾åº¦</th></tr></thead><tbody><tr><td><code>float</code></td><td>4</td><td><code>Â±1.4E-45</code> ~ <code>Â±3.4028235E+38</code></td><td><code>0.0f</code></td><td>çº¦ 7 ä½</td></tr><tr><td><code>double</code></td><td>8</td><td><code>Â±4.9E-324</code> ~ <code>Â±1.7976931348623157E+308</code></td><td><code>0.0d</code></td><td>çº¦ 15~16 ä½</td></tr></tbody></table><ul><li>å®šä¹‰<code>float</code>ç±»å‹çš„å˜é‡ï¼Œèµ‹å€¼æ—¶éœ€è¦ä»¥â€œfâ€æˆ–â€œFâ€ä½œä¸ºåç¼€ã€‚</li><li>floatçš„è¡¨ç¤ºèŒƒå›´å¤§äºlongï¼Œä½†æ˜¯ç²¾åº¦ä¸é«˜ã€‚</li><li>Javaçš„æµ®ç‚¹å‹å¸¸é‡<strong>é»˜è®¤ä¸ºdoubleå‹</strong>ã€‚</li><li>floatã€doubleä¸é€‚ç”¨äºä¸å®¹è®¸èˆå…¥è¯¯å·®çš„é‡‘èè®¡ç®—é¢†åŸŸã€‚å¦‚æœéœ€è¦ç²¾ç¡®æ•°å­—è®¡ç®—æˆ–ä¿ç•™ç‰¹å®šä½æ•°çš„ç²¾åº¦ï¼Œéœ€è¦ä½¿ç”¨BigDecimalç±»ã€‚</li><li><code>IEEE 754æ ‡å‡†</code>ä»ç„¶ä¸èƒ½å®ç°â€œæ¯ä¸€ä¸ªåè¿›åˆ¶å°æ•°éƒ½å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶å°æ•°â€ï¼Œ0.1+0.2ä¸ç­‰äº0.3</li></ul><h3 id="å­—ç¬¦å‹">å­—ç¬¦å‹</h3><ul><li>å ç”¨ä¸¤ä¸ªå­—èŠ‚</li></ul><p>å­—ç¬¦å‹å˜é‡çš„ä¸‰ç§è¡¨ç°å½¢å¼ï¼š</p><ol type="1"><li>å•å¼•å·<code>''</code>é€‚ç”¨äº<strong>å•ä¸ªå­—ç¬¦</strong></li><li>ç›´æ¥ä½¿ç”¨Unicodeå€¼è¡¨ç¤ºã€‚ä¾‹å¦‚<code>char c8 = '\u0043';</code></li><li>ä½¿ç”¨è½¬ä¹‰å­—ç¬¦''å°†åé¢çš„å­—ç¬¦è½¬å˜ä¸ºå­—ç¬¦å‹å¸¸é‡ã€‚</li><li>ASCIIç </li></ol><h3 id="å¸ƒå°”å‹">å¸ƒå°”å‹</h3><ul><li>åªæœ‰ä¸¤ä¸ªå€¼ï¼štrueã€falseï¼Œå¸¸å¸¸ç”¨åœ¨æµç¨‹æ§åˆ¶è¯­å¥ã€‚</li><li>å¯ä»¥è®¤ä¸ºå 4ä¸ªå­—èŠ‚ï¼ˆä¸€èˆ¬ä¸è°ˆå¸ƒå°”ç±»å‹å ç”¨çš„ç©ºé—´å¤§å°ï¼‰ã€‚å…·ä½“æ¥è¯´ï¼šç¼–è¯‘æ—¶ä¸è°ˆå‡ ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯JVMç»™booleanç±»å‹åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œbooleanç±»å‹çš„å˜é‡å æ®ä¸€ä¸ªæ§½ä½ï¼ˆslotï¼Œç­‰äº4ä¸ªå­—èŠ‚ï¼‰ã€‚</li></ul><h3 id="åŸºæœ¬æ•°æ®ç±»å‹é—´çš„è¿ç®—è§„åˆ™">åŸºæœ¬æ•°æ®ç±»å‹é—´çš„è¿ç®—è§„åˆ™</h3><ol type="1"><li><strong>è‡ªåŠ¨ç±»å‹æå‡</strong>ï¼š</li></ol><p>è§„åˆ™ï¼šå®¹é‡å°çš„å˜é‡ä¸å®¹é‡å¤§çš„å˜é‡åšè¿ç®—æ—¶ï¼Œç»“æœè‡ªåŠ¨è½¬æ¢ä¸ºå®¹é‡å¤§çš„æ•°æ®ç±»å‹ã€‚å®¹é‡æŒ‡å¯è¡¨ç¤ºæ•°æ®èŒƒå›´çš„å¤§å°ã€‚</p><p>byte---&gt;short---&gt;int---&gt;long---&gt;float---&gt;double</p><ul><li>ç‰¹æ®Šæƒ…å†µ1ï¼šå®¹é‡å°äºintåšè¿ç®—ç»“æœç”¨intç±»å‹ï¼Œå¦åˆ™æŠ¥é”™ï¼Œè€Œä¸”å®é™…çš„å¼€å‘ä¸­ä¹ŸåŸºæœ¬ç”¨ä¸ä¸Šbyteå’Œshortã€‚</li><li>ç‰¹æ®Šæƒ…å†µ2ï¼šcharç±»å‹è¿ç®—ç»“æœä¹Ÿç”¨intç±»å‹ï¼ŒåŒä¸Šã€‚</li></ul><ol start="2" type="1"><li><strong>å¼ºåˆ¶ç±»å‹è½¬æ¢</strong></li></ol><p>è§„åˆ™ï¼šå¤§èŒƒå›´ç±»å‹è½¬æ¢ä¸ºå°èŒƒå›´ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><br><span class="hljs-type">double</span> <span class="hljs-variable">d1</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)d1;<br><br></code></pre></td></tr></table></figure><h3 id="stringç±»">Stringç±»</h3><ol type="1"><li>Stringç±»å±äºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¿—ç§°å­—ç¬¦ä¸²ã€‚</li><li>å¯ä»¥ä½¿ç”¨ä¸€å¯¹åŒå¼•å·è¿›è¡Œèµ‹å€¼ã€‚</li></ol><p>Stringä¸åŸºæœ¬æ•°æ®ç±»å‹é—´çš„è¿ç®—ï¼š</p><ol type="1"><li>è¿™é‡Œå¯ä»¥åŒ…å«å¸ƒå°”å˜é‡åœ¨å†…å…±8ç§ã€‚</li><li>åªèƒ½åšè¿æ¥è¿ç®—ï¼Œç”¨+ã€‚</li></ol><h2 id="è¿ç®—ç¬¦">è¿ç®—ç¬¦</h2><h3 id="é€»è¾‘è¿ç®—ç¬¦">é€»è¾‘è¿ç®—ç¬¦</h3><table><thead><tr><th>é€»è¾‘è¿ç®—ç¬¦</th><th>åç§°</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>&amp;&amp;</code></td><td>é€»è¾‘ä¸ï¼ˆANDï¼‰</td><td>åªæœ‰ä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸º <code>true</code> æ—¶ï¼Œç»“æœæ‰ä¸º<code>true</code></td><td><code>true &amp;&amp; false</code> â†’ <code>false</code></td></tr><tr><td><code>\|\|</code></td><td>é€»è¾‘æˆ–ï¼ˆORï¼‰</td><td>åªè¦æœ‰ä¸€ä¸ªæ“ä½œæ•°ä¸º <code>true</code>ï¼Œç»“æœå°±ä¸º<code>true</code></td><td><code>true \|\| false</code> â†’ <code>true</code></td></tr><tr><td><code>!</code></td><td>é€»è¾‘éï¼ˆNOTï¼‰</td><td>å–åè¿ç®—ï¼Œå°† <code>true</code> å˜ <code>false</code>ï¼Œåä¹‹äº¦ç„¶</td><td><code>!true</code> â†’ <code>false</code></td></tr><tr><td><code>&amp;</code></td><td>æŒ‰ä½ä¸ï¼ˆANDï¼‰</td><td>ä¸ <code>&amp;&amp;</code>ç±»ä¼¼ï¼Œä½†<strong>ä¸ä¼šå‘ç”ŸçŸ­è·¯</strong></td><td><code>true &amp; false</code> â†’ <code>false</code></td></tr><tr><td><code>\|</code></td><td>æŒ‰ä½æˆ–ï¼ˆORï¼‰</td><td>ä¸ <code>\|\|</code> ç±»ä¼¼ï¼Œä½†<strong>ä¸ä¼šå‘ç”ŸçŸ­è·¯</strong></td><td><code>true \| false</code> â†’ <code>true</code></td></tr><tr><td><code>^</code></td><td>é€»è¾‘å¼‚æˆ–ï¼ˆXORï¼‰</td><td>åªæœ‰ä¸¤ä¸ªæ“ä½œæ•°ä¸ç›¸åŒæ—¶ï¼Œç»“æœæ‰ä¸º <code>true</code></td><td><code>true ^ false</code> â†’ <code>true</code></td></tr></tbody></table><ul><li>é€»è¾‘è¿ç®—ç¬¦é’ˆå¯¹çš„æ˜¯å¸ƒå°”å‹å˜é‡ï¼Œç»“æœä¹Ÿæ˜¯å¸ƒå°”å‹ã€‚</li><li><code>&amp;&amp;</code>å’Œ<code>||</code><strong>å…·æœ‰çŸ­è·¯ç‰¹æ€§</strong>ï¼Œå³åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥<strong>æå‰ç¡®å®šæœ€ç»ˆç»“æœ</strong>ï¼Œä»è€Œè·³è¿‡åç»­è¿ç®—ï¼Œæé«˜æ•ˆç‡å¹¶é¿å…ä¸å¿…è¦çš„è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ<code>A &amp;&amp; B</code>åªæœ‰å½“<code>A</code>ä¸º<code>true</code>æ—¶ï¼Œæ‰ä¼šè®¡ç®—<code>B</code>ï¼Œå¦‚æœ<code>A</code>ä¸º<code>false</code>ï¼Œé‚£ä¹ˆç»“æœå¿…ç„¶ä¸º<code>false</code>ï¼Œæ‰€ä»¥<code>B</code>ä¼šè¢«ç›´æ¥è·³è¿‡ã€‚å¯¹äº<code>||</code>åˆ™åè¿‡æ¥ï¼Œå¦‚æœ<code>A</code>ä¸º<code>true</code>ï¼Œé‚£ä¹ˆä¸ä¼šè®¡ç®—<code>B</code>ã€‚</li></ul><h3 id="ä½è¿ç®—ç¬¦">ä½è¿ç®—ç¬¦</h3><p>éš¾ç‚¹ã€éé‡ç‚¹</p><table style="width:100%;"><thead><tr><th>è¿ç®—ç¬¦</th><th>åç§°</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>&amp;</code></td><td>æŒ‰ä½ä¸ï¼ˆANDï¼‰</td><td>ä¸¤ä¸ªä½éƒ½ä¸º <code>1</code>ï¼Œç»“æœæ‰ä¸º <code>1</code></td><td><code>5 &amp; 3</code> â†’ <code>101 &amp; 011 = 001</code> â†’<code>1</code></td></tr><tr><td><code>\|</code></td><td>æŒ‰ä½æˆ–ï¼ˆORï¼‰</td><td>åªè¦æœ‰ä¸€ä¸ªä½ä¸º <code>1</code>ï¼Œç»“æœå°±æ˜¯ <code>1</code></td><td><code>5 \| 3</code> â†’ <code>101 \| 011 = 111</code> â†’<code>7</code></td></tr><tr><td><code>^</code></td><td>æŒ‰ä½å¼‚æˆ–ï¼ˆXORï¼‰</td><td>ä¸¤ä¸ªä½ä¸åŒåˆ™ä¸º <code>1</code>ï¼Œç›¸åŒåˆ™ä¸º <code>0</code></td><td><code>5 ^ 3</code> â†’ <code>101 ^ 011 = 110</code> â†’<code>6</code></td></tr><tr><td><code>~</code></td><td>æŒ‰ä½å–åï¼ˆNOTï¼‰</td><td>0 å˜ 1ï¼Œ1 å˜ 0ï¼ˆå–åè¡¥ç ï¼‰</td><td><code>~5</code> â†’ <code>~00000101</code> â†’ <code>11111010</code>ï¼ˆå³<code>-6</code>ï¼‰</td></tr><tr><td><code>&lt;&lt;</code></td><td>å·¦ç§»ï¼ˆLeft Shiftï¼‰</td><td>å°†äºŒè¿›åˆ¶ä½å·¦ç§» <code>n</code> ä½ï¼Œå³ä¾§è¡¥ <code>0</code></td><td><code>5 &lt;&lt; 2</code> â†’ <code>101</code> â†’ <code>10100</code> â†’<code>20</code></td></tr><tr><td><code>&gt;&gt;</code></td><td>å³ç§»ï¼ˆArithmetic Right Shiftï¼‰</td><td>ä¿æŒç¬¦å·ä½ï¼Œå·¦ä¾§è¡¥ <code>1</code> æˆ– <code>0</code></td><td><code>-5 &gt;&gt; 2</code> â†’ <code>11111011</code> â†’<code>11111110</code> â†’ <code>-2</code></td></tr><tr><td><code>&gt;&gt;&gt;</code></td><td>æ— ç¬¦å·å³ç§»ï¼ˆLogical Right Shiftï¼‰</td><td>å·¦ä¾§ç»Ÿä¸€è¡¥ <code>0</code>ï¼Œä¸ä¿æŒç¬¦å·ä½</td><td><code>-5 &gt;&gt;&gt; 2</code> â†’ <code>11111011</code> â†’<code>00111110</code>ï¼ˆå³ <code>1073741822</code>ï¼‰</td></tr></tbody></table><p><strong>æ¡ˆä¾‹</strong>ï¼šå¦‚ä½•äº¤æ¢ä¸¤ä¸ªintå˜é‡çš„å€¼ï¼ŸStringå‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br><br>        System.out.println(<span class="hljs-string">&quot;m=&quot;</span> + m + <span class="hljs-string">&quot;, n=&quot;</span> + n);<br><br>        <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªä¸´æ—¶å˜é‡</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> m;<br>        m = n;<br>        n = temp;<br><br>        System.out.println(<span class="hljs-string">&quot;m=&quot;</span> + m + <span class="hljs-string">&quot;, n=&quot;</span> + n);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¡ä»¶è¿ç®—ç¬¦">æ¡ä»¶è¿ç®—ç¬¦</h3><p>(æ¡ä»¶è¡¨è¾¾å¼) ? è¡¨è¾¾å¼1 : è¡¨è¾¾å¼2</p><p>æ¡ä»¶è¡¨è¾¾å¼çš„ç»“æœæ˜¯å¸ƒå°”ç±»å‹ã€‚</p><h1 id="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶</h1><h2 id="if-else">if-else</h2><p>ä¸Cè¯­è¨€ç›¸åŒï¼Œä¸èµ˜è¿°ã€‚</p><p>å¦‚ä½•ä»é”®ç›˜è·å–ä¸åŒç±»å‹çš„å˜é‡ï¼šä½¿ç”¨Scannerç±»ã€‚Scannerç±»ä¸­æä¾›äº†è·å–ä¸åŒç±»å‹å˜é‡çš„æ–¹æ³•ï¼Œé™¤äº†charï¼Œéœ€è¦ä½¿ç”¨<code>scan.next().charAt(0)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯¼åŒ…</span><br><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//æä¾›ï¼ˆæˆ–åˆ›å»ºï¼‰ä¸€ä¸ªScannerç±»çš„å®ä¾‹ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªScannerå¯¹è±¡scï¼Œç”¨äºæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥</span><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        <span class="hljs-comment">//è°ƒç”¨Scannerç±»ä¸­çš„æ–¹æ³•ï¼Œè·å–æŒ‡å®šç±»å‹çš„å˜é‡ï¼Œè¿™é‡Œä½¿ç”¨nextLine()è¯»å–æ•´è¡Œæ–‡æœ¬</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> sc.nextLine();<br><br>        System.out.println(<span class="hljs-string">&quot;name=&quot;</span> + s);<br><br>        <span class="hljs-comment">//å…³é—­èµ„æºï¼Œè°ƒç”¨Scannerç±»çš„close()</span><br>        scan.close();<br>    &#125;<br>&#125;    <br><br></code></pre></td></tr></table></figure><h2 id="è·å–éšæœºæ•°">è·å–éšæœºæ•°</h2><p>å¯ä»¥ä½¿ç”¨Javaæä¾›çš„APIï¼šMathç±»çš„random()ï¼ˆä¸ç”¨é¢å¤–å¯¼åŒ…ï¼‰ï¼Œè¿”å›ä¸€ä¸ª[0.0,1.0)èŒƒå›´å†…çš„doubleéšæœºæ•°ã€‚</p><p>è¿›ä¸€æ­¥çš„å¯ä»¥å¾—åˆ°å…¶ä»–èŒƒå›´çš„éšæœºæ•°ï¼Œä¾‹å¦‚[0,100]</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">101</span>);<br></code></pre></td></tr></table></figure><p>è·å–ä¸€ä¸ª[a,b]èŒƒå›´çš„éšæœºæ•°ï¼š<code>(int)(Math.random() * (b - a + 1)) + a;</code></p><h2 id="switch-case">switch-case</h2><p>è¯­æ³•æ ¼å¼ï¼š <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">switch</span>(è¡¨è¾¾å¼)&#123;<br><br>    <span class="hljs-keyword">case</span> å¸¸é‡<span class="hljs-number">1</span>:<br>        <span class="hljs-comment">//æ‰§è¡Œè¯­å¥1</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> å¸¸é‡<span class="hljs-number">2</span>:<br>        <span class="hljs-comment">//æ‰§è¡Œè¯­å¥2</span><br>        <span class="hljs-keyword">break</span>;<br>    ...<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-comment">//æ‰§è¡Œè¯­å¥</span><br>        <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><ul><li>switchä¸­çš„è¡¨è¾¾å¼åªèƒ½æ˜¯ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼šbyte Â short Â char Â intÂ æšä¸¾(JDK5.0æ–°å¢) Â String(JDK7.0æ–°å¢)</li><li>å¼€å‘ä¸­ä½¿ç”¨switch-caseæ—¶ï¼Œé€šå¸¸caseåŒ¹é…çš„æƒ…å†µéƒ½æœ‰é™ã€‚</li><li>defaultçš„ä½ç½®æ˜¯çµæ´»çš„ã€‚</li></ul><h2 id="å¾ªç¯è¯­å¥">å¾ªç¯è¯­å¥</h2><p>å…±ä¸‰ç§ï¼šfor,while,do-while</p><p>å¾ªç¯çš„4ä¸ªè¦ç´ ï¼š</p><ol type="1"><li>åˆå§‹åŒ–æ¡ä»¶</li><li>å¾ªç¯æ¡ä»¶</li><li>å¾ªç¯ä½“</li><li>è¿­ä»£éƒ¨åˆ†</li></ol><h3 id="forå¾ªç¯">forå¾ªç¯</h3><p>for(1;2;4){<br />3<br />}</p><p>è¿­ä»£éƒ¨åˆ†å«æœ‰å¤šæ¡è¯­å¥æ—¶ï¼Œå¯ä»¥ç”¨é€—å·è¿æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        è¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°må’Œnï¼Œæ±‚æœ€å¤§å…¬çº¦æ•°å’Œæœ€å°å…¬å€æ•°ã€‚</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> m&lt;n?m:n;<br><br>        <span class="hljs-comment">//æœ€å¤§å…¬çº¦æ•°</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=min;i&gt;=<span class="hljs-number">1</span>;i--)&#123;<br>            <span class="hljs-keyword">if</span>(n%i==<span class="hljs-number">0</span> &amp;&amp; m%i==<span class="hljs-number">0</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;æœ€å¤§å…¬çº¦æ•°&quot;</span>+i);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//æœ€å°å…¬å€æ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> m&gt;n?m:n;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=max;i&lt;=m*n;i++)&#123;<br>            <span class="hljs-keyword">if</span>(i%m==<span class="hljs-number">0</span> &amp;&amp; i%n==<span class="hljs-number">0</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;æœ€å°å…¬å€æ•°ä¸º&quot;</span> + i);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬å¯ä»¥åœ¨å¾ªç¯ç»“æ„ä¸­ä½¿ç”¨breakï¼Œç”¨äºè·³å‡ºå¾ªç¯ç»“æ„ã€‚</li><li>å¾ªç¯æ¡ä»¶ä¸æ»¡è¶³/å¾ªç¯ä½“ä¸­æ‰§è¡Œäº†break</li></ul><h3 id="whileå¾ªç¯">whileå¾ªç¯</h3><p>1 while(2){<br />3<br />4<br />}</p><p>ç»ƒä¹ ï¼šçŒœæ•°å­—å°æ¸¸æˆ <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        éšæœºç”Ÿæˆä¸€ä¸ª1åˆ°100ä»¥å†…çš„æ•´æ•°ï¼Œç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè®°å½•çŒœäº†å‡ æ¬¡æ‰æ­£ç¡®</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-comment">//ç”Ÿæˆéšæœºæ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">randomNumber</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (Math.random() * <span class="hljs-number">100</span>)+<span class="hljs-number">1</span>;<br>        <span class="hljs-comment">//è®°å½•å°è¯•çš„æ¬¡æ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">guessNumber</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-comment">//åˆ›å»ºå¯¹è±¡sc</span><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-comment">//è¾“å…¥æ•°å­—</span><br>        System.out.println(<span class="hljs-string">&quot;Please enter a number between 1 and 100&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">yourNumber</span> <span class="hljs-operator">=</span> scanner.nextInt();<br>        <span class="hljs-comment">//å¾ªç¯</span><br>        <span class="hljs-keyword">while</span>(yourNumber != randomNumber)&#123;<br>            <span class="hljs-keyword">if</span>(yourNumber &gt; randomNumber)&#123;<br>                System.out.println(<span class="hljs-string">&quot;Your number is greater than random number&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;Your number is less than random number&quot;</span>);<br>            &#125;<br>            guessNumber++;<br>            <span class="hljs-comment">//é‡æ–°è¾“å…¥æ•°å­—</span><br>            System.out.println(<span class="hljs-string">&quot;Please try again&quot;</span>);<br>            yourNumber = scanner.nextInt();<br>        &#125;<br>        <span class="hljs-comment">//ç»“æŸæ¸¸æˆ</span><br>        System.out.println(<span class="hljs-string">&quot;congratulations!you have tried &quot;</span> + guessNumber + <span class="hljs-string">&quot; guesses&quot;</span>);<br>        scanner.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="do-while-å¾ªç¯">do-while å¾ªç¯</h3><p>1<br />do{<br />3<br />4<br />}while(2);</p><p>æ‰§è¡Œè¿‡ç¨‹ï¼š1 - 3 - 4 - 2 - 3 - 4 - Â·Â·Â· - 2</p><p>è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“ï¼Œç”¨å¾—ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå°‘ã€‚</p><h3 id="æ— é™å¾ªç¯ç»“æ„">â€œæ— é™â€å¾ªç¯ç»“æ„</h3><p>æ ¼å¼ï¼š while(true) æˆ– for(;;)ï¼Œä¸­é€”ä½¿ç”¨breakè·³å‡ºå¾ªç¯ã€‚</p><p>ç¤ºä¾‹ï¼šä¹ä¹ä¹˜æ³•è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java">ublic <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        æ¡ˆä¾‹ï¼šä¹ä¹ä¹˜æ³•è¡¨</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">9</span>; i++)&#123;<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= i; j++)&#123;<br>                System.out.print(i + <span class="hljs-string">&quot;*&quot;</span> + j + <span class="hljs-string">&quot;=&quot;</span> + i*j + <span class="hljs-string">&quot;\t&quot;</span>);<br>            &#125;<br>            System.out.println();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        æ¡ˆä¾‹ï¼šæ‰¾å‡º100000ä»¥å†…çš„æ‰€æœ‰è´¨æ•°</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=<span class="hljs-number">100000</span>;i++)&#123;<br><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isFlag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">2</span>;j&lt;Math.sqrt(i);j++)&#123;<br>                <span class="hljs-keyword">if</span>(i%j==<span class="hljs-number">0</span>)&#123;<br>                    isFlag = <span class="hljs-literal">false</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(isFlag)&#123;<br>                System.out.println(i);<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><br>        System.out.println(<span class="hljs-string">&quot;time spend: &quot;</span> + (endTime - startTime));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š<code>time spend: 35</code>ï¼Œæ³¨æ„è¿™é‡Œçš„Math.sqrt(i)å¯ä»¥å¤§å¤§æå‡è¿ç®—é€Ÿåº¦ï¼Œå› ä¸ºä¸€ä¸ªæ•°çš„å› æ•°å…³äºå®ƒçš„ç®—æœ¯å¹³æ–¹æ ¹å¯¹ç§°ã€‚</p><h1 id="æ•°ç»„">æ•°ç»„</h1><h2 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h2><p>å¤šä¸ªç›¸åŒç±»å‹æ•°æ®æŒ‰ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªåå­—å‘½åï¼Œé€šè¿‡ç¼–å·ç»Ÿä¸€ç®¡ç†ã€‚</p><p>Javaä¸­çš„<strong>å®¹å™¨</strong>ï¼šæ•°ç»„ã€é›†åˆæ¡†æ¶ï¼šåœ¨<strong>å†…å­˜</strong>ä¸­å¯¹å¤šä¸ªæ•°æ®çš„å­˜å‚¨ã€‚</p><p>æ•°ç»„å±äº<strong>å¼•ç”¨æ•°æ®ç±»å‹</strong>ï¼Œå£°æ˜æ ¼å¼ï¼š <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//å¦‚æœå·²çŸ¥åˆå§‹å€¼ï¼š</span><br><span class="hljs-type">int</span>[] arr1 = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;;<br><br><span class="hljs-comment">//å¦‚æœæœªçŸ¥åˆå§‹å€¼ï¼Œéœ€è¦åŠ¨æ€åˆ›å»ºï¼š</span><br><span class="hljs-type">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">5</span>];<br><span class="hljs-comment">//åç»­èµ‹å€¼æ—¶ï¼Œç›´æ¥å¼•ç”¨å…ƒç´ ï¼Œä¾‹å¦‚</span><br>arr[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>;<br>arr[<span class="hljs-number">1</span>] = <span class="hljs-number">20</span>;<br>arr[<span class="hljs-number">2</span>] = <span class="hljs-number">30</span>;<br>arr[<span class="hljs-number">3</span>] = <span class="hljs-number">40</span>;<br>arr[<span class="hljs-number">4</span>] = <span class="hljs-number">50</span>;<br><br></code></pre></td></tr></table></figure></p><ul><li>æ•°ç»„ä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå…¶é•¿åº¦ç¡®å®šï¼Œå¹¶ä¸”æ— æ³•æ›´æ”¹ã€‚</li><li>å†…å­˜ä¸­ä¸€æ•´å—è¿ç»­çš„ç©ºé—´ã€‚</li><li>æ•°ç»„é•¿åº¦å¯ä»¥ä½¿ç”¨arr.lengthè·å–</li></ul><p><strong>æ•°ç»„å…ƒç´ çš„é»˜è®¤åˆå§‹åŒ–å€¼</strong></p><ul><li>æ•´å‹ï¼š<code>0</code></li><li>æµ®ç‚¹å‹ï¼š<code>0.0</code></li><li>å­—ç¬¦å‹ï¼š<code>0</code>ï¼ˆå¯¹åº”<code>'\u0000'</code>ï¼‰</li><li>booleanå‹ï¼š<code>false</code></li><li>å¼•ç”¨æ•°æ®ç±»å‹ï¼š<code>null</code></li></ul><h2 id="ç®—æ³•æ¡ˆä¾‹">ç®—æ³•æ¡ˆä¾‹</h2><h3 id="ç”Ÿæˆå›è¡Œæ•°">ç”Ÿæˆå›è¡Œæ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiralMatrix</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—: &quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> scanner.nextInt();<br>        scanner.close();<br>        <br>        <span class="hljs-type">int</span>[][] matrix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n][n];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>, left = <span class="hljs-number">0</span>, right = n - <span class="hljs-number">1</span>, top = <span class="hljs-number">0</span>, bottom = n - <span class="hljs-number">1</span>;<br>        <br>        <span class="hljs-keyword">while</span> (num &lt;= n * n) &#123;<br>            <span class="hljs-comment">// ä»å·¦åˆ°å³</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left; i &lt;= right; i++) matrix[top][i] = num++;<br>            top++;<br>            <br>            <span class="hljs-comment">// ä»ä¸Šåˆ°ä¸‹</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> top; i &lt;= bottom; i++) matrix[i][right] = num++;<br>            right--;<br>            <br>            <span class="hljs-comment">// ä»å³åˆ°å·¦</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> right; i &gt;= left; i--) matrix[bottom][i] = num++;<br>            bottom--;<br>            <br>            <span class="hljs-comment">// ä»ä¸‹åˆ°ä¸Š</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> bottom; i &gt;= top; i--) matrix[i][left] = num++;<br>            left++;<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ‰“å°ç»“æœ</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; n; j++) &#123;<br>                System.out.printf(<span class="hljs-string">&quot;%3d &quot;</span>, matrix[i][j]);<br>            &#125;<br>            System.out.println();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æ•°ç»„çš„æ‰©å®¹">æ•°ç»„çš„æ‰©å®¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Description:</span><br><span class="hljs-comment"> * ç°æœ‰æ•°ç»„ int[] arr = new int []&#123;1,2,3,4,5&#125;</span><br><span class="hljs-comment"> * å°†æ•°ç»„çš„é•¿åº¦æ‰©å®¹1å€ï¼Œå°†10ï¼Œ20ï¼Œ30æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ep19</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2025/3/26 21:52</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">expansion</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span> []&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;;<br><br>        <span class="hljs-comment">//æ‰©å®¹1å€å®¹é‡</span><br>        <span class="hljs-type">int</span>[] newArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span> [arr.length*<span class="hljs-number">2</span>];<br><br>        <span class="hljs-comment">//å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>            newArr[i] = arr[i];<br>        &#125;<br><br>        <span class="hljs-comment">//æ·»åŠ æ–°çš„æ•°å­—</span><br>        newArr[arr.length] = <span class="hljs-number">10</span>;<br>        newArr[arr.length+<span class="hljs-number">1</span>] = <span class="hljs-number">20</span>;<br>        newArr[arr.length+<span class="hljs-number">2</span>] = <span class="hljs-number">30</span>;<br><br>        <span class="hljs-comment">//å°†æ–°çš„æ•°ç»„åœ°å€èµ‹å€¼ç»™åŸæœ‰çš„æ•°ç»„å˜é‡</span><br>        arr = newArr;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; newArr.length; i++) &#123;<br>            System.out.print(newArr[i] + <span class="hljs-string">&quot;\t&quot;</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾">æŸ¥æ‰¾</h3><ol type="1"><li>çº¿æ€§æŸ¥æ‰¾ï¼šéå†æ•°ç»„è¿”å›ç´¢å¼• å¤æ‚åº¦ï¼šO(N)</li><li>äºŒåˆ†æ³•æŸ¥æ‰¾ï¼ˆé€‚ç”¨äº<strong>æœ‰åº</strong>æ•°ç»„ï¼‰å¤æ‚åº¦ï¼šO(logâ‚‚N)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">dichotomy</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">22</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<span class="hljs-comment">//æ˜¯å¦æ‰¾åˆ°äº†</span><br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<span class="hljs-comment">//é»˜è®¤çš„é¦–ç´¢å¼•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> arr.length - <span class="hljs-number">1</span>;<span class="hljs-comment">//é»˜è®¤çš„å°¾ç´¢å¼•</span><br><br>        <span class="hljs-keyword">while</span> (head &lt;= end) &#123;<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> head + (end - head) / <span class="hljs-number">2</span>;<br><br>            <span class="hljs-keyword">if</span>(target == arr[mid]) &#123;<br>                System.out.println(<span class="hljs-string">&quot;found it, the index is &quot;</span> + mid);<br>                flag = <span class="hljs-literal">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target &gt; arr[mid]) &#123;<br>                head = mid + <span class="hljs-number">1</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                end = mid - <span class="hljs-number">1</span>;<br>            &#125;<br><br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!flag) &#123;<br>            System.out.println(<span class="hljs-string">&quot;not found&quot;</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ’åºç®—æ³•">æ’åºç®—æ³•</h3><ol type="1"><li>æ—¶é—´å¤æ‚åº¦ï¼šåˆ†æå…³é”®å­—çš„æ¯”è¾ƒæ¬¡æ•°å’Œè®°å½•ç§»åŠ¨çš„æ¬¡æ•°ï¼Œè®°ä¸º<spanclass="math inline">\(O(n)\)</span></li><li>ç©ºé—´å¤æ‚åº¦ï¼šåˆ†ææ’åºç®—æ³•ä¸­éœ€è¦å¤šå°‘è¾…åŠ©å†…å­˜ï¼Œè®°ä¸º<spanclass="math inline">\(S(n)\)</span></li><li>ç¨³å®šæ€§ï¼šè‹¥ä¸¤ä¸ªå€¼ç›¸ç­‰çš„Aå’ŒBåœ¨æ’åºåçš„å‰åé¡ºåºä¸å˜ï¼Œåˆ™è¿™ç§æ’åºç®—æ³•æ˜¯ç¨³å®šçš„</li></ol><p><strong>å†’æ³¡æ’åº</strong>ï¼š</p><p>æ—¶é—´å¤æ‚åº¦ï¼š<span class="math inline">\(O(n^2)\)</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bubbling</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">33</span>,<span class="hljs-number">55</span>,<span class="hljs-number">43</span>,<span class="hljs-number">22</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>&#125;;<br><br>        <span class="hljs-comment">//æ‰“å°åˆå§‹æ•°ç»„</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k : arr) &#123;<br>            System.out.print(k + <span class="hljs-string">&quot;\t&quot;</span>);<br>        &#125;<br><br>        System.out.println();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; arr.length - <span class="hljs-number">1</span> - i; j++) &#123;<br>                <span class="hljs-keyword">if</span>(arr[j] &gt; arr[j+<span class="hljs-number">1</span>])&#123;<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[j];<br>                    arr[j] = arr[j+<span class="hljs-number">1</span>];<br>                    arr[j+<span class="hljs-number">1</span>] = temp;<br>                &#125;<br>            &#125;<br>            <br>        &#125;<br>        <span class="hljs-comment">//æ‰“å°æ’åºåçš„ç»“æœ</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k : arr) &#123;<br>            System.out.print(k + <span class="hljs-string">&quot;\t&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¿«é€Ÿæ’åº</strong></p><p>æ—¶é—´å¤æ‚åº¦ï¼š <span class="math inline">\(O(n\log(n))\)</span></p><h2 id="arrayså·¥å…·ç±»">Arrayså·¥å…·ç±»</h2><p><strong>åˆ¤æ–­ä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰</strong></p><p>ä½ç½®ï¼šjava.util</p><p>boolean equals(int[] a,int[] b):æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„å…ƒç´ æ˜¯å¦<strong>ä¾æ¬¡ç›¸ç­‰</strong>ã€‚ç›¸ç­‰æ—¶è¿”å›trueã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-type">boolean</span> <span class="hljs-variable">isEquals</span> <span class="hljs-operator">=</span> Arrays.equals(arr1,arr2);<br></code></pre></td></tr></table></figure><p><strong>è¾“å‡ºæ•°ç»„ä¿¡æ¯</strong></p><p><code>System.out.println(Arrays.toString(arr1));</code></p><p><strong>å¡«å……</strong></p><p>å°†æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ å¡«å……ä¸ºæŒ‡å®šçš„æ•°å€¼ï¼Œä¾‹å¦‚ï¼š<code>Arrays.fill(arr1,22);</code></p><p><strong>æ’åº</strong></p><p><code>Arrays.sort(arr3);</code>ï¼Œä½¿ç”¨å¿«é€Ÿæ’åºç®—æ³•</p><p>æ•°ç»„çš„ç´¢å¼•ï¼Œè¡¨ç¤ºæ•°ç»„å…ƒç´ è·ç¦»é¦–åœ°å€çš„åç§»é‡ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ åœ°å€ä¸é¦–åœ°å€ç›¸åŒï¼Œåç§»é‡ä¸º0ï¼Œç´¢å¼•æ˜¯0</p><p>æ¡ˆä¾‹ï¼š</p><blockquote><p>è¾“å…¥ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œæ•°ç»„é‡Œæ—¢æœ‰æ­£æ•°ä¹Ÿæœ‰è´Ÿæ•°ï¼Œæ•°ç»„ä¸­è¿ç»­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ•´æ•°æˆä¸€ä¸ªå­æ•°ç»„ï¼Œæ¯ä¸ªå­æ•°ç»„éƒ½æœ‰ä¸€ä¸ªå’Œï¼Œæ±‚æ‰€æœ‰å­æ•°ç»„çš„å’Œçš„æœ€å¤§å€¼ã€‚è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p></blockquote><p><strong>å¡ä¸¹ç®—æ³•</strong>(Kadane's Algorithm)ï¼Œç”¨<code>currentSum</code>è®°å½•ä»¥å½“å‰ä½ç½®ä¸ºç»“å°¾çš„å­æ•°ç»„çš„æœ€å¤§å’Œï¼Œ<code>maxSum</code>è®°å½•æ‰€æœ‰å­æ•°ç»„ä¸­çš„æœ€å¤§å’Œã€‚éå†æ•°ç»„ï¼Œå¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæœ€å¤§å­æ•°ç»„å’Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼š</p><ol type="1"><li><code>nums[i]</code>è‡ªå·±æ„æˆä¸€ä¸ªå­æ•°ç»„ï¼Œæœ€å¤§å­æ•°ç»„å’Œå°±æ˜¯å®ƒè‡ªå·±</li><li><code>nums[i]</code>ä¸å‰é¢çš„æœ€å¤§å­æ•°ç»„å’Œç›¸åŠ ä¹‹åï¼Œå¾—åˆ°çš„ç»“æœæ‰æ˜¯æœ€å¤§å­æ•°ç»„å’Œ</li></ol><p>æ‰€ä»¥ï¼Œ<code>currentSum</code>æ¯æ¬¡éƒ½å–ä»¥ä¸Šä¸¤ç§æƒ…å†µä¸­æœ€å¤§çš„ä¸€ä¸ªã€‚ä¹‹åï¼Œæ›´æ–°<code>maxSum</code>ï¼Œè®°å½•ä¸‹è¿™ä¸ªæœ€å¤§å€¼å³å¯ã€‚å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Description:</span><br><span class="hljs-comment"> * è¾“å…¥ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œæ•°ç»„é‡Œæ—¢æœ‰æ­£æ•°ä¹Ÿæœ‰è´Ÿæ•°ï¼Œæ•°ç»„ä¸­è¿ç»­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ•´æ•°æˆä¸€ä¸ªå­æ•°ç»„ï¼Œæ¯ä¸ªå­æ•°ç»„éƒ½æœ‰ä¸€ä¸ªå’Œï¼Œ</span><br><span class="hljs-comment"> * æ±‚æ‰€æœ‰å­æ•°ç»„çš„å’Œçš„æœ€å¤§å€¼ã€‚è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ep19</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2025/3/27 21:31</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">sum</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//åˆ›å»ºæ•°ç»„</span><br>        <span class="hljs-type">int</span>[] nums = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>,-<span class="hljs-number">3</span>,-<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxSum</span> <span class="hljs-operator">=</span> nums[<span class="hljs-number">0</span>];<span class="hljs-comment">//å­æ•°ç»„å’Œçš„æœ€å¤§å€¼</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">currentSum</span> <span class="hljs-operator">=</span> nums[<span class="hljs-number">0</span>];<span class="hljs-comment">//å½“å‰çš„å­æ•°ç»„çš„å’Œ</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; nums.length; i++) &#123;<span class="hljs-comment">//æ³¨æ„iä»1å¼€å§‹è®¡æ•°ï¼Œè€Œä¸æ˜¯0</span><br>            currentSum  = Math.max(currentSum + nums[i], nums[i]);<br>            maxSum = Math.max(maxSum, currentSum);<br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;maxSum is &quot;</span> + maxSum);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¡ä¸¹ç®—æ³•åªéœ€è¦å¯¹æ•°ç»„è¿›è¡Œä¸€æ¬¡éå†ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯<spanclass="math inline">\(O(n)\)</span>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java SE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºHexoåšå®¢ç»‘å®šåŸŸåå‡ºç°ERR_SSL_UNRECOGNIZED_NAME_ALERTué”™è¯¯</title>
    <link href="/2025/01/17/%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/"/>
    <url>/2025/01/17/%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘ä¸ºè¿™ä¸ªåšå®¢ç½‘ç«™æ–°ç»‘å®šäº†ä¸€ä¸ªåŸŸåã€‚å› ä¸ºæˆ‘å…ˆå‰æ²¡æœ‰å­¦è¿‡è®¡ç®—æœºç½‘ç»œç›¸å…³çš„çŸ¥è¯†ï¼Œé‡åˆ°ERR_SSL_UNRECOGNIZED_NAME_ALERTuçš„æŠ¥é”™çš„æ—¶å€™ååº”äº†åŠå¤©æ‰æ˜ç™½è¦å»ç”³è¯·ä¸€ä¸ªSSLè¯ä¹¦ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹è¿™æ¬¡ç»‘å®šåŸŸåçš„æ“ä½œæµç¨‹ã€‚</p><h1 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h1><p>1.<ahref="https://cps.ninja/2016/10/09/customize-your-blog-domain/">ä¸ºGithub ä¸Šçš„ Hexo åšå®¢ç»‘å®šä¸ªæ€§åŸŸå</a></p><p>2.<ahref="https://www.littlelittleblack.com/Hexo/20200508-self-server-url.html">åœ¨è‡ªæ¶æœåŠ¡å™¨ä¸Šæ­å»ºHexoåšå®¢å¹¶ç»‘å®šåŸŸå</a></p><h1 id="æ“ä½œæµç¨‹">æ“ä½œæµç¨‹</h1><p>æˆ‘æœ€å¼€å§‹çœ‹çš„æ˜¯ç¬¬ä¸€ä¸ªé“¾æ¥ï¼Œåœ¨namesiloä¸Šè´­ä¹°ä¸€ä¸ªåŸŸåï¼Œç„¶åç›´æ¥ä½¿ç”¨namesiloè¿›è¡ŒDNSè§£æã€‚ç¬¬ä¸€ä¸ªé“¾æ¥é‡Œæœ‰ä¸€ç‚¹æ²¡æœ‰è¯´æ¸…æ¥šï¼šAè®°å½•çš„IPåœ°å€åº”å½“æ˜¯<code>username.github.io</code>çš„IPåœ°å€ï¼Œè€Œä¸æ˜¯githubçš„åœ°å€ã€‚å¯¹æ­¤ï¼Œgithubçš„<ahref="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site">å®˜æ–¹æ–‡æ¡£</a>ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜ï¼š</p><p><img src="https://i.imgur.com/ZMUsLHh.png" /></p><p>å‘DNSè§£æä¸­åŠ å…¥4ä¸ªAè®°å½•å³å¯ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡pingçš„æ–¹å¼è·å–IPåœ°å€ã€‚æŒ‰<code>win</code>+<code>R</code>è¾“å…¥<code>cmd</code>ï¼Œå†è¾“å…¥<code>ping username.github.io</code>ï¼Œçœ‹ä¸€ä¸‹è¿”å›çš„IPå³å¯ï¼š</p><p><img src="https://i.imgur.com/OEH8zEM.png" /></p><p>è¿™æ¬¡è¿”å›çš„æ˜¯<code>185.199.109.153</code>.</p><h1 id="è¸©å‘">è¸©å‘</h1><p>æˆ‘æŒ‰ç…§é“¾æ¥1çš„æ­¥éª¤æ“ä½œå®Œæˆä¹‹åï¼Œå‘ç°æ–°ç»‘å®šåŸŸååçš„åšå®¢ä»æ— æ³•æ‰“å¼€ï¼ŒæŠ¥é”™ï¼š</p><p><strong>å—¯â€¦ æ— æ³•è®¿é—®æ­¤é¡µé¢ https://kznep19.blog/ä¸Šçš„ç½‘é¡µä¼¼ä¹æœ‰é—®é¢˜ï¼Œæˆ–è€…å¯èƒ½å·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°çš„ Web åœ°å€ã€‚ERR_SSL_UNRECOGNIZED_NAME_ALERTu</strong></p><p>å‘æµè§ˆå™¨ä¸­è¾“å…¥<code>username.github.io</code>ï¼Œå‘ç°åŸæ¥çš„åœ°å€ä¹Ÿæ— æ³•è®¿é—®äº†ã€‚èµ·åˆæˆ‘ä»¥ä¸ºæ˜¯namesiloè‡ªå¸¦çš„DNSè§£æåŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼ˆå› ä¸ºnamesiloçš„åå£°ä¼¼ä¹ä¸æ˜¯å¾ˆå¥½ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¿ç…§é“¾æ¥2å°†NDSè§£æè½¬ç§»åˆ°å›½å†…çš„DNSPodç½‘ç«™ä¸Šï¼Œå‘ç°ä»ç„¶æ˜¯åŒæ ·çš„æŠ¥é”™ï¼Œè¯´æ˜é—®é¢˜ä¸åœ¨è¿™é‡Œã€‚</p><p>æ³¨æ„<code>ERR_SSL_UNRECOGNIZED_NAME_ALERTu</code>ï¼Œå¯¹æ­¤ChatGPTçš„å›ç­”å¦‚ä¸‹ï¼š</p><blockquote><p>ERR_SSL_UNRECOGNIZED_NAME_ALERT æ˜¯ä¸€ä¸ªä¸ SSL/TLSè¿æ¥ç›¸å…³çš„é”™è¯¯ï¼Œé€šå¸¸å‡ºç°åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›è¡ŒåŠ å¯†é€šä¿¡æ—¶ã€‚è¿™ç§é”™è¯¯è¡¨ç¤ºå®¢æˆ·ç«¯åœ¨è¯·æ±‚æ—¶æä¾›çš„ä¸»æœºåï¼ˆå¦‚ç½‘å€ï¼‰æ²¡æœ‰åœ¨æœåŠ¡å™¨çš„è¯ä¹¦ä¸­æ­£ç¡®åŒ¹é…ï¼Œæˆ–è€…æœåŠ¡å™¨æ²¡æœ‰æ­£ç¡®é…ç½®SSL/TLS è¯ä¹¦ã€‚</p></blockquote><p>â€œæ²¡æœ‰æ­£ç¡®é…ç½® SSL/TLSè¯ä¹¦â€ï¼Œæˆ‘æŸ¥æ‰¾èµ„æ–™çš„è¿‡ç¨‹ä¸­æ²¡æœ‰è§åˆ°è¯´ç»‘å®šåŸŸåéœ€è¦å•ç‹¬é…ç½®SSLè¯ä¹¦çš„æ•™ç¨‹ã€‚ç›´åˆ°æˆ‘çœ‹åˆ°äº†<ahref="https://github.com/lss233/chatgpt-mirai-qq-bot/issues/1146">è¿™ä¸ªç½‘ç«™</a>ï¼Œé‡Œé¢æåˆ°</p><blockquote><p>æµè§ˆå™¨æŠ¥é”™ ERR_SSL_UNRECOGNIZED_NAME_ALERT<br />å…¶æ„ä¸º â€œé”™è¯¯ SSL æ— æ³•è¯†åˆ«çš„åç§°è­¦æŠ¥"ã€‚åº”è¯¥å› ä¸ºä½ è¿˜æœªéƒ¨ç½²SSLè¯ä¹¦ğŸ’¦ã€‚SSLè¯ä¹¦æ˜¯æ­¤æœåŠ¡å¿…é¡»çš„ï¼Œå»ç”³è¯·ä¸€ä¸ªå³å¯ ğŸ™ã€‚</p></blockquote><p>äºæ˜¯æˆ‘åœ¨<ahref="https://ohttps.com/monitor/dashboard">OHTTPS</a>ä¸­ä¸ºè¿™ä¸ªåŸŸåå…è´¹ç”³è¯·äº†ä¸€ä¸ªSSLè¯ä¹¦ï¼Œå¾ˆå¿«ç½‘ç«™å°±èƒ½æ­£å¸¸è®¿é—®äº†ï¼Œè‡³æ­¤é—®é¢˜ç»ˆäºå¾—åˆ°è§£å†³ã€‚</p><p>å¦å¤–ï¼Œä¸ç®¡æ˜¯OHTTPSè¿˜æ˜¯DNSPodæä¾›çš„SSLè¯ä¹¦å‘æ”¾æœåŠ¡ï¼Œå…¶å…è´¹è¯ä¹¦çš„æœ‰æ•ˆæœŸéƒ½åªæœ‰ä¸‰ä¸ªæœˆï¼Œå¿«åˆ°æœŸçš„æ—¶å€™è¦ä¸è¦å¿˜äº†æ›´æ¢è¯ä¹¦ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã‚¨ãƒ«ãƒ-ãƒ¨ãƒ«ã‚·ã‚«</title>
    <link href="/2025/01/07/Elma/"/>
    <url>/2025/01/07/Elma/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>é›¨ã¨ã‚«ãƒ—ãƒãƒ¼ãƒ - ãƒ¨ãƒ«ã‚·ã‚«</p><p>è©ï¼šn-buna</p><p>æ›²ï¼šn-buna</p><p>ç·¨æ›²ï¼šn-buna</p><hr /><p>å™“ã¤ããªã‚“ã¦ã€€ã‚ã‹ã£ã¦ã€€è§¦ã‚Œã¦</p><p>ã‚¨ãƒ«ãƒã€€ã¾ã ã€€ã¾ã ç—›ã„ã‚ˆ</p><p>ã‚‚ã†ã•ã‚ˆãªã‚‰ã ã£ã¦æ­Œã£ã¦</p><p>æš®ã‚Œã¦å¤œãŒæ¥ã‚‹ã¾ã§</p><hr /><p>æœæ—¥ã®å·®ã™æœ¨æ¼ã‚Œæ—¥ã€€åƒ•ã¨ã‚¨ãƒ«ãƒ</p><p>ã¾ã ã€€ã¾ã çœ ã„ã‹ã„</p><p>åˆå¤ã®åˆã‚è¿‘ã¥ãäº”æœˆã®æ£®</p><hr /><p>æ­©ãã ã—ãŸé¡”ã«ã¯èŠ±ã®é›«</p><p>ã»ã‚‰ã€€æ¶™ã¿ãŸã„ã </p><p>ã“ã®ã¾ã¾æ¬ ä¼¸ã‚’ã—ã‚ˆã†</p><p>ãªã‚“ãªã‚‰ã¾ãŸæ¤…å­ã«ã§ã‚‚åº§ã‚ã†</p><hr /><p>è¨±ã›ãªã„ã“ã¨ãªã‚“ã¦ãªã„ã‚“ã ã‚ˆ</p><p>å›ã¯å„ªã—ããªã‚“ã¦ãªã‚Œã‚‹</p><hr /><p>ã“ã®ã¾ã¾ä½•å‡¦ã‹ã®é ã„å›½ã§</p><p>æµ…ã„å¤ã®éš™é–“ã«å¯ãã¹ã£ãŸã¾ã¾</p><p>æ¶™ã‚‚è¨€è‘‰ã‚‚å‡ºãªã„ã¾ã¾ã§</p><p>ãŸã å¤œã®æ·±ã•ã‚‚çŸ¥ã‚‰ãªã„ã¾ã¾ã§</p><hr /><p>å™“ã¤ããªã‚“ã¦ã€€ã‚ã‹ã£ã¦ã€€è§¦ã‚Œã¦</p><p>ã‚¨ãƒ«ãƒã€€ã¾ã ã€€ã¾ã ç—›ã„ã‚ˆ</p><p>ã‚‚ã†ã•ã‚ˆãªã‚‰ã ã£ã¦æ­Œã£ã¦</p><p>æš®ã‚Œã¦å¤œãŒæ¥ã‚‹ã¾ã§</p><hr /><p>è¾›ã„ã“ã¨ã‚‚è‹¦ã—ã„ã“ã¨ã‚‚ä½•ã‚‚è¦‹ãˆãªã„ãªã‚‰ã‚ã‹ã‚‰ãªã„ã—</p><p>å¡ã„ã ç›®é–‰ã˜ãŸã¾ã¾ã§é€ƒã’ãŸ</p><p>æœˆæ˜ã‹ã‚Šã®é“ã‚’æ­©ã</p><hr /><p>ç‹­ã„éƒ¨å±‹ã‚‚å†·ãŸã„å¤œã‚‚</p><p>çœ ã„æ˜¼ã‚‚ã€€å¯‚ã—ã„æœã‚‚</p><p>ã•ã‚ˆãªã‚‰ã®è¨€è‘‰è¶Šã—ã«å›ã®é¡”ã‚’è¦‹ã¦ã‚‹</p><hr /><p>ã“ã®ã¾ã¾ä½•å‡¦ã‹ã®é ã„å›½ã§</p><p>æµ…ã„å¤ã®éš™é–“ã«å¯ãã¹ã£ãŸã¾ã¾</p><p>æ¶™ã‚‚è¨€è‘‰ã‚‚å‡ºãªã„ã¾ã¾ã§</p><p>ãŸã ç©ºã®é’ã•ã ã‘è¦‹ãŸã¾ã¾ã§</p><hr /><p>ãŸã å›ã¨çµ‚ã‚ã‚Šã‚‚çŸ¥ã‚‰ãªã„ã¾ã¾ã§</p><hr /><p>å™“ã¤ããªã‚“ã¦ã€€ã‚ã‹ã£ã¦ã€€è§¦ã‚Œã¦</p><p>ã‚¨ãƒ«ãƒã€€ã¾ã ã€€ã¾ã ç—›ã„ã‚ˆ</p><p>ã‚‚ã†ã•ã‚ˆãªã‚‰ã ã£ã¦æ­Œã£ã¦</p><p>æš®ã‚Œã¦å¤œãŒæ¥ã‚‹ã¾ã§</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å°‘å¥³A</title>
    <link href="/2025/01/05/%E5%B0%91%E5%A5%B3A/"/>
    <url>/2025/01/05/%E5%B0%91%E5%A5%B3A/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>ç¥æ§˜ã®ãƒ€ãƒ³ã‚¹ - ãƒ¨ãƒ«ã‚·ã‚«</p><p>ä½œè©ï¼šæ¤åã‚‚ãŸï¼ˆã½ã‚ã½ã‚Pï¼‰</p><p>ä½œæ›²ï¼šæ¤åã‚‚ãŸï¼ˆã½ã‚ã½ã‚Pï¼‰</p><p>å”„ï¼šé¡éŸ³ãƒªãƒ³</p><p>ä¸­æ–‡ç¿»è­¯ï¼šhttps://home.gamer.com.tw/artwork.php?sn=5816671</p><hr /><p>åƒ•ã®å‘½ã£ã¦ã£ãŸã£ã¦ã€€èª°ã®å‘½ã£ã¤ã£ãŸã£ã¦</p><p>å³ä½¿èªªé€™æ˜¯æˆ‘çš„ç”Ÿå‘½ã€€å³ä½¿èªªé€™æ˜¯ä»–äººçš„ç”Ÿå‘½</p><p>æ™‚ã€…ã€€å…¬å¹³ã«ã€€è£ã‹ã‚Œã‚‹ã‚‚ã‚“ãªã‚“ã§ã—ã‚‡</p><p>å¶çˆ¾ã€€ä¹Ÿæœƒè¢«å…¬å¹³åœ°ã€€å—åˆ°è£æ±ºå°å§</p><p>æš—ã„ç©ºã«ã‚„ã£ã¦ããŸã€€é¬±ã‚’é€£ã‚Œã¦ã‚„ã£ã¦ããŸ</p><p>æˆ‘æŠµé”äº†æ¼†é»‘çš„å¤©ç©ºã€€ä¸¦å¸¶ä¾†äº†æ†‚æ„</p><p>æ™‚ã€…é›¨ã€€ç·è¨ˆã«ã€€é ¼ã‚Šåˆ‡ã‚Šã ã€€ã©ã†ã—ã‚ˆã†</p><p>å¶çˆ¾ä¸‹èµ·äº†é›¨ã€€æˆ‘ç¸½æ˜¯ã€€ä¾è³´è‘—å®ƒã€€è©²æ€éº¼è¾¦å‘¢</p><p>æœ½ã¡ã‚‹ã¾ã§ã®æ„›æ†ã‚’ã€€æœ½ã¡ã‚‹ã¾ã§ã®æ„›æ†ã‚’</p><p>æ¥å—æ¯æœ½ä¹‹å‰çš„æ„›æ†ã€€æ¯æœ½ä¹‹å‰çš„æ„›æ†çš„ä½ </p><p>é£²ã¿è¾¼ã‚€å›ã€€ç°¡å˜ã«ã€€å¾®ç¬‘ã‚€å›ã€€ã©ã†ã—ã¦</p><p>ç°¡å–®åœ°ã€€éœ²å‡ºå¾®ç¬‘çš„ä½ ã€€ç‚ºä»€éº¼</p><p>è¨€è‘‰ã‚’æ›¸ãã€€æ›–æ˜§ã«ã€€è¨€è‘‰ã‚’æ›¸ãã€€æ›–æ˜§ã«</p><p>æ›–æ˜§åœ°ã€€æ›¸å¯«è‘—è©±èªã€€æ›–æ˜§åœ°ã€€æ›¸å¯«è‘—è©±èª</p><p>ä¼ã‚ã‚Šãã‚‰ã‚“ãªã„ã‹ã‚‰ã€€å›ã ã‘ã‚’ã•ã€€ä¿¡ã˜ã¦</p><p>å› ç‚ºæ ¹æœ¬ç„¡æ³•å…¨æ•¸å‚³é”å‡ºå»å•Šã€€æ‰€ä»¥æˆ‘åªã€€ç›¸ä¿¡ä½ ä¸€äºº</p><p>æ¨ã¦ã¦ããŸå¤¢ã‚’ã‚ã¤ã‚ã¦</p><p>æˆ‘é–‹å§‹æ”¶é›†èµ·ä¹‹å‰æˆ‘æ‰€æ¨æ£„çš„å¤¢æƒ³</p><p>ã¡ã‚‡ã£ã¨ã€€ã¡ã‚‡ã£ã¨ã€€é–“é•ãˆãŸã‹ã‚‰</p><p>å› ç‚ºé€™å…¶ä¸­æœ‰äº›ã€€æœ‰äº›ã€€éŒ¯èª¤å•Š</p><p>ã‚ã‚ã€€ã€Œæ™‚ã«ã€€æ™‚ã«ã€€èº“ã„ãŸã£ã¦ã€ã€</p><p>å•Šå•Šã€€ã€Œå³ä½¿å¶çˆ¾ã€€å¶çˆ¾ã€€å—åˆ°æŒ«æŠ˜ã€ã€ã€€ä¹Ÿé‚„æ˜¯</p><p>å¯’ã„å¯’ã„å¯’ã„å¯’ã„å¯’ã„</p><p>å¥½å†·å¥½å†·å¥½å†·å¥½å†·å¥½å†·</p><p>å¯’ã„å¯’ã„å¯’ã„å¯’ã„å¯’ã„</p><p>å¥½å†·å¥½å†·å¥½å†·å¥½å†·å¥½å†·</p><p>å¯’ã„å¯’ã„å¯’ã„å¯’ã„ã€€è¨€ã„å¯„ã‚‰ãªã„ã§</p><p>å¥½å†·å¥½å†·å¥½å†·å¥½å†·ã€€åˆ¥å¦‚æ­¤æ±‚æ„›å•Š</p><p>ã‚ã‚ã€€å›ã®å›ã®å›ã®å£°ãŒ</p><p>å•Šå•Šã€€ä½ çš„ä½ çš„ä½ çš„è²éŸ³ååˆ†</p><p>é ã„é ã„é ã„é ã„é ã„</p><p>é™é é™é é™é é™é é™é </p><p>é ã„é ã„é ã„é ã„é ã„</p><p>é™é é™é é™é é™é é™é </p><p>é ã„é ã„é ã„é ã„ã€€å‚·ã¤ã‘ãªã„ã§</p><p>é™é é™é é™é é™é ã€€åˆ¥å‚·å®³æˆ‘å•Š</p><p>ä½•ç•ªç›®ã§ã‚‚ã€€ä½•ç•ªç›®ã§ã‚‚</p><p>ä¸ç®¡æ˜¯ç¬¬å¹¾å€‹ã€€ä¸ç®¡æ˜¯ç¬¬å¹¾å€‹</p><p>åƒ•ãŒåƒ•ã§ã‚ã‚‹ãŸã‚ã«ï¼Ÿ</p><p>æˆ‘ä¹Ÿå¸Œæœ›æˆ‘èƒ½ä¿æœ‰è‡ªæˆ‘ï¼Ÿ</p><p>å¥‘ã‚Šé›†ã‚æŒã£ã¦ããŸã€€å¥‘ã‚Šé›†ã‚æŒã£ã¦ããŸ</p><p>æˆ‘æ”¶é›†èµ·ä¾†å„ç¨®ç´„å®šã€€æˆ‘æ”¶é›†èµ·ä¾†å„ç¨®ç´„å®š</p><p>ã‚ã®æ—¥ã®é–“é•ã„ã‚’ã€€é£²ã¿è¾¼ã‚€ã®ãŒè‹¦ã‚‹ã—ãã¦</p><p>è¦ç†è§£é‚£ä¸€å¤©çš„èª¤æœƒã€€å¯¦åœ¨æ˜¯éæ–¼ç—›è‹¦</p><p>æœ½ã¡ã‚‹ã¾ã§ã®æ„›æ†ã‚’ã€€æœ½ã¡ã‚‹ã¾ã§ã®æ„›æ†ã‚’</p><p>æ¥å—æ¯æœ½ä¹‹å‰çš„æ„›æ†ã€€æ¯æœ½ä¹‹å‰çš„æ„›æ†çš„ä½ </p><p>é£²ã¿è¾¼ã‚€å›ã€€ç°¡å˜ã«ã€€å¾®ç¬‘ã‚€å›ã€€ã©ã†ã—ã¦</p><p>ç°¡å–®åœ°ã€€éœ²å‡ºå¾®ç¬‘çš„ä½ ã€€ç‚ºä»€éº¼</p><p>ã€Œå­ä¾›ã ã¾ã—ã®èŠ±ãµãŸã¤ã€ã€</p><p>ã€Œæ¬ºé¨™å°å­©çš„å…©æŸèŠ±ã€ã€</p><p>ãã£ã¨ã€€ãã£ã¨ã€€è«¦ã‚ãŸã‹ã‚‰ï¼Ÿ</p><p>ä¸€å®šã€€ä¸€å®šæ˜¯å› ç‚ºã€€æˆ‘æ”¾æ£„äº†ï¼Ÿ</p><p>ã‚ã‚ã€€é ã„å¤¢ã‚’è¿½ã„ã‹ã‘ã¦ã•</p><p>å•Šå•Šã€€æˆ‘è¿½è¶•è‘—é™é çš„å¤¢æƒ³ã€€ä½†å¤¢æƒ³å»ååˆ†</p><p>æ—©ã„æ—©ã„æ—©ã„æ—©ã„æ—©ã„</p><p>å¿«é€Ÿå¿«é€Ÿå¿«é€Ÿå¿«é€Ÿå¿«é€Ÿ</p><p>æ—©ã„æ—©ã„æ—©ã„æ—©ã„æ—©ã„</p><p>å¿«é€Ÿå¿«é€Ÿå¿«é€Ÿå¿«é€Ÿå¿«é€Ÿ</p><p>æ—©ã„æ—©ã„æ—©ã„æ—©ã„ã€€è¿½ã„ã¤ã‘ãªã„ã‚ˆ</p><p>å¿«é€Ÿå¿«é€Ÿå¿«é€Ÿå¿«é€Ÿã€€æˆ‘æ ¹æœ¬ç„¡æ³•è¿½ä¸Šå•Š</p><p>æ¨ã¦ãã‚Œãšæ®‹ã—ãŸæ€ã„ãŒ</p><p>æˆ‘ç„¡æ³•å®Œå…¨æ¨æ£„ä¸¦éºç•™ä¸‹ä¾†çš„æ„Ÿå—è®“äººååˆ†</p><p>æ†ã„æ†ã„æ†ã„æ†ã„æ†ã„</p><p>æ†æ¨æ†æ¨æ†æ¨æ†æ¨æ†æ¨</p><p>æ†ã„æ†ã„æ†ã„æ†ã„æ†ã„</p><p>æ†æ¨æ†æ¨æ†æ¨æ†æ¨æ†æ¨</p><p>æ†ã„æ†ã„æ†ã„æ†ã„ã€€è¨±ã•ã‚Œãªã„ã®ï¼Ÿ</p><p>æ†æ¨æ†æ¨æ†æ¨æ†æ¨ã€€ä¸è¢«ä»–äººåŸè«’å—ï¼Ÿ</p><p>ã‚ã‚ã€€å¤¢ã‚’å¤¢ã‚’è¦‹ã¦ãŸã¯ãšãŒ</p><p>å•Šå•Šã€€æˆ‘æœ¬æ‡‰è©²æ­£åœ¨åšå¤¢ã€€ä½†å»æ„Ÿåˆ°äº†</p><p>æ€–ã„æ€–ã„æ€–ã„æ€–ã„æ€–ã„</p><p>ææ‡¼ææ‡¼ææ‡¼ææ‡¼ææ‡¼</p><p>æ€–ã„æ€–ã„æ€–ã„æ€–ã„æ€–ã„</p><p>ææ‡¼ææ‡¼ææ‡¼ææ‡¼ææ‡¼</p><p>æ€–ã„æ€–ã„æ€–ã„æ€–ã„ã€€è¿‘ã¥ã‹ãªã„ã§</p><p>ææ‡¼ææ‡¼ææ‡¼ææ‡¼ã€€åˆ¥é è¿‘æˆ‘å•Š</p><p>åˆè¨€è‘‰ã‚’ç¹°ã‚Šè¿”ã™ã ã‘</p><p>æˆ‘åªæ˜¯ä¸æ–·é‡è¤‡è‘—æš—èªè€Œå·²</p><p>å¯’ã„å¯’ã„å¯’ã„å¯’ã„å¯’ã„</p><p>å¥½å†·å¥½å†·å¥½å†·å¥½å†·å¥½å†·</p><p>å¯’ã„å¯’ã„å¯’ã„å¯’ã„å¯’ã„</p><p>å¥½å†·å¥½å†·å¥½å†·å¥½å†·å¥½å†·</p><p>å¯’ã„å¯’ã„å¯’ã„å¯’ã„ã€€ãŠé¡˜ã„ã ã‹ã‚‰</p><p>å¥½å†·å¥½å†·å¥½å†·å¥½å†·ã€€æ‹œè¨—ä½ </p><p>ä½•ç•ªç›®ã§ã‚‚ã€€ä½•ç•ªç›®ã§ã‚‚</p><p>ä¸ç®¡æ˜¯ç¬¬å¹¾å€‹ã€€ä¸ç®¡æ˜¯ç¬¬å¹¾å€‹</p><p>åƒ•ãŒåƒ•ã§ã‚ã‚‹ãŸã‚ã«â€¦</p><p>æˆ‘ä¹Ÿå¸Œæœ›æˆ‘èƒ½ä¿æœ‰è‡ªæˆ‘â€¦</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é›¨ã¨ã‚«ãƒ—ãƒãƒ¼ãƒ - ãƒ¨ãƒ«ã‚·ã‚«</title>
    <link href="/2024/12/30/%E9%9B%A8%E3%81%A8%E3%82%AB%E3%83%97%E3%83%81%E3%83%BC%E3%83%8E%20-%20%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB/"/>
    <url>/2024/12/30/%E9%9B%A8%E3%81%A8%E3%82%AB%E3%83%97%E3%83%81%E3%83%BC%E3%83%8E%20-%20%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>é›¨ã¨ã‚«ãƒ—ãƒãƒ¼ãƒ - ãƒ¨ãƒ«ã‚·ã‚«</p><p>è©ï¼šn-buna</p><p>æ›²ï¼šn-buna</p><p>ç·¨æ›²ï¼šn-buna</p><hr /><p>ç°è‰²ã«ç™½ã‚“ã è¨€è‘‰ã¯ã‚«ãƒ—ãƒãƒ¼ãƒã¿ãŸã„ãªè‰²ã—ã¦ã‚‹</p><p>è¨€ã„è¨³ã¯ã„ã„ã‚ˆã€€çª“è¾ºã«ç½®ã„ã¦ãã¦</p><p>æ•°ãˆåˆ‡ã‚Œãªã„ã‚ˆ</p><hr /><p>ç°è‰²ã«ç™½ã‚“ã å¿ƒã¯ã‚«ãƒ—ãƒãƒ¼ãƒã¿ãŸã„ãªè‰²ã‚’ã—ã¦ã‚‹</p><p>è¨€ã„è¨³ã¯ã„ã„ã‚ˆã€€<ruby>å‘·<rt>ã‚ãŠ</rt></ruby>ã‚ã†ã‚«ãƒ—ãƒãƒ¼ãƒ</p><p><ruby>æˆ¯<rt>ãŠã©</rt></ruby>ã‘ãŸæŒ¯ã‚Šã‚’ã—ã¦</p><hr /><p>ã•ã<ruby>æºè•©<rt>ãŸã‚†ãŸ</rt></ruby>ã†ã‚ˆã†ã«é›¨æµã‚Œ</p><p>åƒ•ã‚‰ã«<ruby>åµ<rt>ã‚ã‚‰</rt></ruby>ã™èŠ±ã«æººã‚Œ</p><p>å›ãŒ<ruby>è¤ª<rt>ã‚</rt></ruby>ã›ãªã„ã‚ˆã†ãªæ€ã„å‡ºã‚’</p><p>ã©ã†ã‹ã€ã©ã†ã‹ã€ã©ã†ã‹å›ãŒæº¢ã‚Œãªã„ã‚ˆã†ã«</p><hr /><p><ruby>æ³¢<rt>ãªã¿</rt></ruby>å¾…ã¤æµ·å²¸ã€€<ruby>ç´…<rt>ãã‚Œãªã„</rt></ruby>å¤•å·®ã™æ—¥</p><p>çª“ã«åå°„ã—ã¦</p><p>å…«æœˆã®ãƒ´ã‚£ã‚¹ãƒ“ãƒ¼ã€€<ruby>æ½®é¨’<rt>ã—ãŠã•ã„</rt></ruby></p><p>å¾…ã¡ã¼ã†ã‘ã€€æµ·é¢¨ä¸€ã¤ã§</p><hr /><p>å¤æ³³ã„ã èŠ±ã®ç™½ã•ã€<ruby>å®µ<rt>ã‚ˆã„</rt></ruby>ã®é›¨</p><p>æµã‚Œã‚‹å¤œã«æººã‚Œ</p><p>èª°ã‚‚è¤ªã›ãªã„ã‚ˆã†ãªèŠ±ä¸€ã¤</p><p>ã©ã†ã‹ã€ã©ã†ã‹ã€ã©ã†ã‹èƒ¸ã®å†…å´ã«æŒ¿ã—ã¦</p><hr /><p>ãšã£ã¨ãŠã‹ã—ã„ã‚“ã </p><p>ç”Ÿãæ–¹ä¸€ã¤ã‚’æ•™ãˆã¦ã»ã—ã„ã ã‘</p><p>æ‰•ãˆã‚‹ã‚‚ã®ãªã‚“ã¦åƒ•ã«ã¯ã‚‚ã†ãªã„ã‘ã©</p><p>ä½•ã‚‚ç­”ãˆã‚‰ã‚Œãªã„ãªã‚‰è¨€è‘‰ä¸€ã¤ã§ã‚‚ã„ã„ã‚ˆ</p><p>ã‚ã‹ã‚‰ãªã„ã‚ˆ</p><p>æœ¬å½“ã«ã‚ã‹ã‚‰ãªã„ã‚“ã ã‚ˆ</p><hr /><p>ã•ã<ruby>æºè•©<rt>ãŸã‚†ãŸ</rt></ruby>ã†ã‚ˆã†ã«é›¨æµã‚Œ</p><p>åƒ•ã‚‰ã«<ruby>åµ<rt>ã‚ã‚‰</rt></ruby>ã™èŠ±ã«æººã‚Œ</p><p>å›ãŒ<ruby>è¤ª<rt>ã‚</rt></ruby>ã›ãªã„ã‚ˆã†ã«æ›¸ãè©©ã‚’</p><p>ã©ã†ã‹ã€ã©ã†ã‹ã€ã©ã†ã‹ä»Šã‚‚å¿˜ã‚Œãªã„ã‚ˆã†ã«</p><p>ã¾ãŸä¸€ã¤å¤ãŒçµ‚ã‚ã£ã¦ã€èŠ±ä¸€ã¤ã‚’èƒ¸ã«æŠ±ã„ã¦ã€</p><p>æµã‚Œã‚‹<ruby>ç›®è“‹<rt>ã¾ã¶ãŸ</rt></ruby>ã®è£ã§</p><p>å›ãŒ<ruby>è¤ª<rt>ã‚</rt></ruby>ã›ãªã„ã‚ˆã†ã«ã“ã®è©©ã‚’</p><p>ã©ã†ã‹ã€ã©ã†ã‹å›ãŒæº¢ã‚Œãªã„ã‚ˆã†ã«</p><hr />]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç¥æ§˜ã®ãƒ€ãƒ³ã‚¹ - ãƒ¨ãƒ«ã‚·ã‚«</title>
    <link href="/2024/12/27/%E7%A5%9E%E6%A7%98%E3%81%AE%E3%83%80%E3%83%B3%E3%82%B9%20-%20%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB/"/>
    <url>/2024/12/27/%E7%A5%9E%E6%A7%98%E3%81%AE%E3%83%80%E3%83%B3%E3%82%B9%20-%20%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>ç¥æ§˜ã®ãƒ€ãƒ³ã‚¹ - ãƒ¨ãƒ«ã‚·ã‚«</p><p>è©ï¼šn-buna</p><p>æ›²ï¼šn-buna</p><p>ç·¨æ›²ï¼šn-buna</p><hr /><p>å¿˜ã‚Œã‚‹ãªã‚“ã¦é…·ã„ã ã‚</p><p>å¹¸ã›ã«ãªã‚“ã¦ãªã‚‹ã‚‚ã®ã‹</p><p>è‰²ã®ãªã„ä½•ã‹ãŒå’²ã„ãŸ</p><p>å›ã®ã„ãªã„å¤ã«å’²ã„ãŸ</p><hr /><p>äººã«ç¬‘ã‚ã‚ŒãŸããªã„ã‹ã‚‰</p><p>æ€¯ãˆã‚‹ã‚ˆã†ã«ä¸‹ã‚’å‘ã</p><p>å¿ƒã‚ˆã‚Šå¤§äº‹ãªä½•ã‹ãŒ</p><p>ã‚ã£ã¦ãŸã¾ã‚‹ã‚‚ã®ã‹</p><hr /><p>æš®ã‚Œãªã„å¤•ã«èŒœè¿½ã„ä»˜ã„ã¦</p><p>å›ã‚’æŸ“ã‚æŠœã„ãŸ</p><p>è¦‹ãˆãªã„ã‚ˆã†ã«åƒ•ã‚’è¿½ã„è¶Šã—ã¦</p><p>è¡Œã‹ãªã„ã§</p><hr /><p>åƒ•ãŸã¡ç¥æ§˜ãªã‚“ã¦çŸ¥ã‚‰ã‚“é¡”</p><p>ã©ã“ã¾ã§ã ã£ã¦è¡Œã‘ã‚‹</p><p>ãªãã€å¿ƒã¾ã§é†œã„åƒ•ã‚‰ã </p><p>ä¸–ç•Œã¯åƒ•ã‚‰ã®ã‚‚ã®ã </p><hr /><p>éŸ³æ¥½ã ã‘ã§ã„ã„ã‚“ã ã‚</p><p>ä»–äººã«åˆã‚ã›ã¦æ­©ããªã‚ˆ</p><p>æ•™ãˆã¦ãã‚ŒãŸã®ã¯ã‚ã‚“ãŸã˜ã‚ƒãªã„ã‹</p><hr /><p>ã©ã†ã ã£ã¦ã„ã„ã‚ˆã€ã“ã®ã¾ã¾é ãã¸</p><p>èª°ã‚‚çŸ¥ã‚‰ãªã„å ´æ‰€ã§æœˆæ˜ã‹ã‚Šã‚’æ¢ã™ã®ã </p><hr /><p>åã‚‚ãªã„èŠ±ãŒç¶ºéº—ã®ã </p><p>ã©ã†ã§ã‚‚ã„ã„ã“ã¨ã°ã£ã‹ã </p><p>å›ã®å£ç™–ãŒæ„ŸæŸ“ã£ã¦ã‚‹</p><p>å–‰ã®çœŸä¸‹ã«ã¯å›ãŒã„ã‚‹</p><hr /><p>è¨€è‘‰ã‚‚ç”Ÿæ´»ã‚‚æ„›æƒ³ã‚‚</p><p>å…¨ã¦æ¨ã¦ã¦ã“ãéŸ³æ¥½ã </p><p>ãã®ä¾¡å€¤ã‚‚çŸ¥ã‚‰ãªã„ã‚ã‚“ãŸã«</p><p>ã‚ã‹ã£ã¦å ªã‚‹ã‚‚ã®ã‹</p><hr /><p>æš®ã‚Œãªã„å¤•ã«èŒœè¿½ã„ä»˜ã„ã¦</p><p>åƒ•ã‚’æŸ“ã‚æŠœã„ãŸ</p><p>ã„ã¤ã‹æ™‚é–“ãŒå…¨ã¦è¿½ã„æŠœã„ã¦</p><p>æ¶ˆãˆãªã„ã§</p><hr /><p>åƒ•ãŸã¡ç¥æ§˜ãªã‚“ã¦çŸ¥ã‚‰ã‚“é¡”</p><p>ä¸–ç•Œã®å…¨éƒ¨ãŒæ¬²ã—ã„</p><p>ãªãå¿ƒã¾ã§é†œã„ã‚ã‚“ãŸã®ã€æƒ³ã„å‡ºå…¨éƒ¨ã‚’ãã‚Œã‚ˆ</p><p>ä¾¡å€¤è¦³ã ã£ã¦è‡ªç”±ãªã‚‰</p><p>äººã‚’å‚·ä»˜ã‘ã¦ã„ã„ã ã‚</p><p>æ•™ãˆãªã‹ã£ãŸã®ã¯ã‚ã‚“ãŸã˜ã‚ƒãªã„ã‹</p><hr /><p>ã©ã†ã ã£ã¦ã„ã„ã‚ˆã€ã“ã®ã¾ã¾é ãã¸</p><p>èª°ã‚‚è¦‹ã¦ãªã„å ´æ‰€ã§ç”Ÿãã‚‹çœŸä¼¼ã‚’ã—ã¦ã‚‹ã®ã•</p><p>é…·ã„é¡”ã§è¸Šã‚‹ã®ã•</p><p>èƒ¸ã‚‚ç—›ã„ã¾ã¾ã§</p><hr /><p>ç¥æ§˜åƒ•ãŸã¡ãªã‚“ã¦çŸ¥ã‚‰ã‚“é¡”</p><p>ã©ã“ã¾ã§ã ã£ã¦è¡Œã‘ã‚‹</p><p>ãªãã€è¨€è‘‰ãŒä¸–ç•Œã ã¨äº‘ã†ãªã‚‰ã€ä¸–ç•Œã¯åƒ•ã‚‰ã®ã‚‚ã®ã </p><p>å¿˜ã‚Œã‚‹ãªã‚“ã¦é…·ã„ã ã‚</p><p>å¹¸ã›ã«ãªã‚“ã¦ãªã‚Œã‚‹ã‹ã‚ˆ</p><p>åƒ•ã‚’æ­ªã‚ãŸã®ã¯ã‚ã‚“ãŸã˜ã‚ƒãªã„ã‹</p><hr /><p>ãã†ã ã£ãŸã€åƒ•ã¯ã“ã®ã¾ã¾é ãã¸</p><p>èª°ã‚‚çŸ¥ã‚‰ãªã„å ´æ‰€ã§æœˆæ˜ã‹ã‚Šã‚’æ¢ã™ã®ã </p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ãƒ¬ãƒ—ãƒªã‚«ãƒ³ãƒˆ - ãƒ¨ãƒ«ã‚·ã‚«</title>
    <link href="/2024/11/25/%E3%83%AC%E3%83%97%E3%83%AA%E3%82%AB%E3%83%B3%E3%83%88%20-%20%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB/"/>
    <url>/2024/11/25/%E3%83%AC%E3%83%97%E3%83%AA%E3%82%AB%E3%83%B3%E3%83%88%20-%20%E3%83%A8%E3%83%AB%E3%82%B7%E3%82%AB/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>ãƒ¬ãƒ—ãƒªã‚«ãƒ³ãƒˆ - ãƒ¨ãƒ«ã‚·ã‚«</p><p>è©ï¼šn-buna</p><p>æ›²ï¼šn-buna</p><p>ç·¨æ›²ï¼šn-buna</p><p>å›ã¯æ˜ ç”»ã‚’ãšã£ã¨è¦³ã¦ã„ã‚‹<br />åœ¨ç©ºæ— ä¸€äººçš„åŠ‡å ´ä¹‹ä¸­</p><p>èª°ä¸€äººã‚‚ãªã„åŠ‡å ´ã§<br />ä½ ä¸€ä¸ªäººç‹¬è‡ªçœ‹ç€é›»å½±</p><p>ä»Šæ€ãˆã°ãƒãƒ¼ãƒ—ãªã‚»ãƒƒãƒˆã§<br />é‚£æ˜¯éƒ¨ç¾åœ¨çœ‹æ¥å¸ƒæ™¯å»‰ä»·</p><p>äººã®ã‚ˆãæ­»ã¬SFæ˜ ç”»<br />å¸¸æœ‰äººæ­»å»çš„ç§‘å¹»é›»å½±</p><p>ã„ã¤ã‹ä¸–ç•ŒãŒçœŸé¢ã«ãªã£ã¦<br />å¦‚æœå°†æ¥ä¸–ç•Œèƒ½è®Šå¾—ç©æ¥µç¾å¥½</p><p>äººã®å¯¿å‘½ã•ãˆéšåˆ†ä¼¸ã³ã¦<br />äººçš„å¯¿å‘½ä¹Ÿæ— é™å»¶é•·</p><p>æ­»ã­ãªã„ä¸–ç•Œã«ãªã‚Œã°ã„ã„ã®ã«ã­<br />å¯ä»¥ä¸ç”¨ç¶“æ­·æ­»äº¡å°±å¥½äº†</p><p>ãã—ãŸã‚‰å¿ƒä»¥å¤–ã¯å½ç‰©ã <br />é€™æ¨£ä¸€æ¥ é™¤äº†çœŸå¿ƒå…¶ä½™çš†æ˜¯è™šå‡çš„</p><p>è¨€è‘‰ä»¥å¤–ã¯å½ç‰©ã <br />é™¤äº†è©±èªå…¶ä½™çš†æ˜¯è™šå‡çš„</p><p>ç¥æ§˜ã ã£ã¦ä½œå“ãªã‚“ã ã‹ã‚‰<br />å› ç‚ºç¥æ˜ä¹Ÿä¸éæ˜¯ä¸ªä½œå“ç½·äº†</p><p>åƒ•ã‚‰çš†ãƒ¬ãƒ—ãƒªã‚«ã <br />æˆ‘å€‘å…¨éƒ½æ˜¯è¤‡è£½å“</p><p>ã„ã¤ã‹å­£ç¯€ãŒéãå»ã£ã¦<br />çµ‚æœ‰ä¸€å¤©å­£ç¯€ä¼šæµé€è€Œé</p><p>å†·ãŸããªã£ã¦å¹´è€ã„ã¦<br />å¤©æ°”è½‰å†· å¹´è¯é€å»</p><p>ãã®æ™‚ã«<br />å±Šæ™‚</p><hr /><p>åƒ•ã¯æ˜ ç”»ã‚’ãšã£ã¨è¦³ã¦ã„ã‚‹<br />æˆ‘ä¸€ç›´åœ¨çœ‹ç€ä¸€éƒ¨é›»å½±</p><p>ã¤ã¾ã‚‰ãªã„ã»ã©ã«è–„ã„æ˜ ç”»<br />ä¸€éƒ¨åº¸ä¿—åˆ°æ— èŠçš„é›»å½±</p><p>å¸­ã‚’ç«‹ã£ã¦ã‹ã‚‰ã‚„ã£ã¨æ°—ä»˜ã<br />èµ·èº«ç¦»å¸­æ™‚æˆ‘æ‰çµ‚äºç™¼ç¾</p><p>ã“ã‚Œã¯åƒ•ã‚’æã„ãŸãƒ‰ãƒ©ãƒã <br />åŠ‡æƒ…æ‰€è¬›è¿°çš„æ­£æ˜¯æˆ‘è‡ªå·±çš„æ•…äº‹å•Š</p><p>ã„ã¤ã‹åƒ•ã‚‰ã¯å¤§äººã«ãªã£ã¦<br />æˆ‘å€‘çµ‚å°†é•·å¤§æˆäºº</p><p>æ‰‹ã«å…¥ã‚Œã‚‹ã‚‚ã®ã‚‚å¤§ãããªã£ãŸ<br />æ‰€ç²ä¹‹ç‰©ä¹Ÿæ—¥ç›Šé‡å¤§</p><p>æ¬¡ã¯æ„›ã§ã‚‚è²·ãˆã‚Œã°ã„ã„ã®ã«ã­<br />æ¥ä¸‹æ¥è¦æ˜¯é€£æ„›ä¹Ÿèƒ½è²·åˆ°å°±å¥½äº†å‘¢</p><p>ã‚ã‚“ãŸã®ä¾¡å€¤è¦³ãªã‚“ã¦å½ç‰©ã <br />ä½ çš„ä¾¡å€¤è¦³å…¨éƒ½æ˜¯è™šå‡çš„</p><p>æ€ã„å‡ºã ã£ã¦å½ç‰©ã <br />é€£å›æ†¶ä¹Ÿå…¨éƒ½æ˜¯è™šå‡çš„</p><p>å¿ƒã¯è…¦ã®ä¿¡å·ãªã‚“ã ã‹ã‚‰<br />å› ç‚ºå¿ƒæ€ä¸éæ˜¯å¤§è…¦å‚³è¼¸çš„ä¿¡å·ç½·äº†</p><p>æ„›ã‚‚çš†ãƒ¬ãƒ—ãƒªã‚«ã <br />æ‰€æœ‰çš„æ„›ä¹Ÿå…¨éƒ½æ˜¯è¤‡è£½å“</p><p>ã„ã¤ã‹å­£ç¯€ãŒéãå»ã£ã¦<br />çµ‚æœ‰ä¸€å¤©å­£ç¯€ä¼šæµé€è€Œé</p><p>æ€ã„å‡ºã°ã‹ã‚ŠãŒå‹Ÿã£ã¦<br />åªæœ‰å›æ†¶éœéœå †ç©</p><p>ãã®æ™‚ã«<br />å±Šæ™‚</p><hr /><p>æº€ãŸã•ã‚Œã‚‹ãªã‚‰ãã‚Œã§è‰¯ã‹ã£ãŸ<br />åªè¦èƒ½æ„Ÿåˆ°æ»¿è¶³å°±å¥½</p><p>æ­Œã‚’æ­Œã†ã®ã«ç†ç”±ã‚‚ç„¡ã„ã¯<br />æ­Œå”±å¹¶ä¸éœ€è¦ç†ç”±</p><p>ä»–äººã®ç‚ºã«ç”Ÿãã‚‰ã‚Œãªã„<br />æˆ‘ä¸ä¼šç‚ºä»–äººè€Œæ´»</p><p>ã•ã‚ˆãªã‚‰ä»¥å¤–å…¨éƒ¨å¡µ<br />ç¦»åˆ«ä»¥å¤– å…¨éƒ¨å¦‚å¡µ</p><p>äººã‚’å‘ªã†æ­Œã‚’æããŸã„<br />æƒ³è­œå¯«å‡ºè©›å’’ä»–äººçš„æ­Œ</p><p>ãã‚Œã§èª°ã‹ã‚’æ®ºã›ã‚Œã°ã„ã„ãœ<br />è‹¥æ˜¯èƒ½å€Ÿæ­¤å–äººæ€§å‘½å°±å¥½äº†</p><p>å¤ã®åŒ‚ã„ã«èƒ¸ãŒè©°ã¾ã£ã¦ã„ãŸ<br />å¤æ—¥çš„æ°”æ¯éƒçµæ»¿æ‡·</p><p>åƒ•ã‚‰ã®å¿ƒä»¥å¤–ã¯å½ç‰©ã <br />é™¤äº†æˆ‘å€‘çš„å¿ƒå…¶ä½™çš†æ˜¯è™šå‡çš„</p><p>è¨€è‘‰ä»¥å¤–ã¯å½ç‰©ã <br />é™¤äº†è©±èªå…¶ä½™çš†æ˜¯è™šå‡çš„</p><p>ã“ã®ä¸–ã®å…¨éƒ¨ã¯ä¸»è¦³ãªã‚“ã ã‹ã‚‰<br />å› ç‚ºä¸–ç•Œå…¨å‡­ä¸»è§€è€Œå­˜åœ¨å•Š</p><p>å›ã‚‚çš†ãƒ¬ãƒ—ãƒªã‚«ã <br />ä½ ä¹ŸåŒæ¨£æ˜¯è¤‡è£½å“</p><p>ã•ã‚ˆãªã‚‰ã ã£ã¦æŠ•ã’å‡ºã—ã¦<br />è±å‡ºä¸€åˆ‡é“åˆ«ç¦»å¼€</p><p>ã“ã®ã¾ã¾é ãé€ƒã’å‡ºã—ã¦<br />å°±é€™æ¨£é€ƒå‘é æ–¹</p><p>è¨€è‘‰ã§å…¨éƒ¨è¡¨ã—ã¦<br />ç”¨èªè¨€æ¥è¡¨è¿°ä¸€åˆ‡</p><p>å¿ƒã‚‚æ„›ã‚‚æ›¸ãè¶³ã—ã¦<br />æ·»æ³¨ä¸ŠçœŸå¿ƒä¸æ„›</p><p>ãã‚Œã§ã‚‚ç©ºã¯é…·ãé’ã„ã‚“ã ã‹ã‚‰<br />å› ç‚ºå³ä¾¿å¦‚æ­¤ å¤©ç©ºä»æ˜¯æ— å¯æ¯”æ“¬çš„è”šè—</p><p>ãã‚Œã¯ãã£ã¨é­”æ³•ã ã‹ã‚‰<br />é‚£ä¸€å®šæ˜¯é­”æ³•</p><p>ã„ã¤ã‹å­£ç¯€ãŒéãå»ã£ã¦<br />çµ‚æœ‰ä¸€å¤©å­£ç¯€ä¼šæµé€è€Œé</p><p>å†·ãŸããªã£ã¦å¹´è€ã„ã¦<br />å¤©æ°”è½‰å†· å¹´è¯é€å»</p><p>ãã®æ™‚ã«ã‚„ã£ã¨ã‚ã‹ã‚‹<br />å±Šæ™‚æ‰çµ‚äºæ˜ç™½</p><p>åƒ•ã‚‚ãã®é’ã•ãŒã‚ã‹ã‚‹<br />æˆ‘ä¹Ÿæ‡‚å¾—é‚£ä»½è”šè—</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é”ç›¸ç¯CD4046ä½¿ç”¨å¿ƒå¾—</title>
    <link href="/2024/11/23/%E9%94%81%E7%9B%B8%E7%8E%AFCD4046%E7%9A%84%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/"/>
    <url>/2024/11/23/%E9%94%81%E7%9B%B8%E7%8E%AFCD4046%E7%9A%84%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/</url>
    
    <content type="html"><![CDATA[<figure><img src="https://i.imgur.com/ZpUo6qu.jpg" alt="æˆå“" /><figcaption aria-hidden="true">æˆå“</figcaption></figure><h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘åœ¨å¿™ç€åšæ ¡é˜Ÿæ‹›æ–°çš„é¢˜ç›®ï¼Œè¦æ±‚æ˜¯ç”¨é”ç›¸ç¯CD4046Båšä¸€ä¸ªå€é¢‘å™¨ï¼Œå€é¢‘ç³»æ•°ä¸º1ï¼Œ2ï¼Œ4ï¼Œ8ï¼Œ16ï¼Œ32ï¼Œ64ã€‚è¿™ä¸ªé¢˜æœ€çƒ¦äººçš„åœ°æ–¹åœ¨äºè¦†ç›–çš„é¢‘ç‡èŒƒå›´å¾ˆå¤§ï¼Œè¾“å…¥ä¿¡å·èŒƒå›´æ˜¯1kHz~100kHzï¼Œè¿™æ ·æ¥ç®—è¾“å‡ºæœ€å¤§è¦è¾¾åˆ°6.4MHzï¼Œç„¶è€Œä»¥CD4046Bæ¥è¯´è¿™æ ¹æœ¬ä¸å¯èƒ½ï¼Œå› ä¸ºè¿™æ¬¾é”ç›¸ç¯ä¸Šé›†æˆçš„VCOçš„è¾“å‡ºé¢‘ç‡æœ€å¤§ä¹Ÿå°±1MHzå·¦å³ï¼š</p><p><img src="https://i.imgur.com/51pBwa3.png" /></p><p>å¦‚ä½ æ‰€è§ï¼Œè¾“å‡ºæœ€å¤§é¢‘ç‡çš„å…¸å‹å€¼ä¸º<strong>1.4MHz</strong>ï¼Œè¿™ä¹ŸåŸºæœ¬ç¬¦åˆæˆ‘å®æµ‹çš„ç»“æœã€‚æ€»ä¹‹è¿™é¢˜åšæ»¡100kHzçš„64å€é¢‘åŸºæœ¬æ˜¯æ²¡æˆäº†ï¼Œä½†æ˜¯å¬è¯´æœ‰ä¸ªç»„åšåˆ°äº†7MHzï¼Ÿæä¸æ‡‚æ˜¯ä»€ä¹ˆæƒ…å†µã€‚ï¼ˆå†åæ§½ä¸€å¥ï¼ŒTIçš„CD4046Bçš„æ•°æ®æ‰‹å†ŒçœŸçš„å¤ªå¤è€äº†å•Šï¼Œèµ¶ç´§æ›´æ–°ä¸€ä¸‹å§ï¼‰</p><h1 id="å¼•è„šè¯´æ˜">å¼•è„šè¯´æ˜</h1><p><img src="https://i.imgur.com/Z91APjn.png" /></p><p>è§ä¸Šå›¾ã€‚</p><ul><li>3ï¼›é‰´ç›¸å™¨è¾“å…¥</li><li>4ï¼šVCOè¾“å‡º</li><li>6ã€7ä¹‹é—´çš„<spanclass="math inline">\(C_1\)</span>æ˜¯VCOçš„èµ·æŒ¯ç”µå®¹</li><li>12è„š<spanclass="math inline">\(R_2\)</span>å†³å®šäº†è¾“å‡ºé¢‘ç‡æ˜¯å¦å åŠ ä¸€ä¸ªåç½®ã€‚å¦‚æœä¸æ¥ï¼Œé‚£ä¹ˆè¾“å‡ºæ— åç½®ï¼Œé¢‘ç‡å°±å¯ä»¥è¾¾åˆ°æ¯”è¾ƒä½çš„èŒƒå›´ï¼›å¦‚æœæ¥ä¸Šç”µé˜»ï¼Œé¢‘ç‡èŒƒå›´æ•´ä½“ä¼šå¾€ä¸Šç§»åŠ¨ã€‚</li><li>11è„š<spanclass="math inline">\(R_1\)</span>ä¹Ÿå½±å“äº†è¾“å‡ºé¢‘ç‡Â·èŒƒå›´ï¼ŒR1è¶Šå°è¾“å‡ºé¢‘ç‡è¶Šå¤§ï¼Œæˆ‘è¿™é‡Œå–çš„æ˜¯10kæ¬§ã€‚</li><li>5è„šç¦æ­¢ç«¯ï¼Œä½ç”µå¹³ä½¿èƒ½å™¨ä»¶ã€‚</li><li>13ï¼Œé‰´ç›¸å™¨2çš„è¾“å‡ºï¼Œå®ƒæ¥å…¥ç¯è·¯æ»¤æ³¢å™¨çš„è¾“å…¥ç«¯ã€‚</li><li>9ï¼ŒVCOçš„è¾“å…¥ï¼Œè¿™ä¸ªè¾“å…¥ç”µå‹åº”å½“å°½å¯èƒ½å¹³ç¨³ï¼Œè¿™æ ·VCOæ‰ä¼šæœ‰ç¨³å®šçš„è¾“å‡ºã€‚</li></ul><p>æˆ‘è¿™æ¬¡åœ¨è°ƒè¯•ç”µè·¯è¿‡ç¨‹ä¸­åŠ¨çš„æœ€å¤šçš„å°±æ˜¯C1å’Œå¼•è„šï¼Œ4ã€‚é€šè¿‡è°ƒæ•´C1çš„å€¼æ¥è·å¾—ä¸åŒçš„é¢‘ç‡è¾“å‡ºèŒƒå›´ï¼›å°†3ã€4ç›´æ¥è¿æ¥æ¥æµ‹è¯•é”ç›¸ç¯çš„åŠŸèƒ½ï¼›ç¡®å®šé”ç›¸ç¯èƒ½æ­£å¸¸å·¥ä½œåå†æŠŠ3ã€4æ–­å¼€ï¼Œæ¥å…¥åˆ†é¢‘å™¨ã€‚</p><h1 id="é¢‘ç‡èŒƒå›´">é¢‘ç‡èŒƒå›´</h1><p>CD4046Bçš„è¾“å‡ºé¢‘ç‡ä¸ä¾›ç”µç”µå‹æœ‰å…³ï¼Œä¾›ç”µç”µå‹è¶Šå¤§ï¼Œèƒ½å¤Ÿè¾“å‡ºçš„é¢‘ç‡ä¹Ÿè¶Šå¤§ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡15Vã€‚æ ¹æ®æˆ‘çš„æµ‹è¯•ï¼Œåœ¨5Vä¾›ç”µï¼ŒR2ä¸æ¥ï¼ŒR1=10kæ¬§ï¼ŒC1=100pFçš„æƒ…å†µä¸‹ï¼ŒVCOçš„è¾“å‡ºé¢‘ç‡æœ€å¤šåªæœ‰å¤§çº¦700kHZã€‚æƒ³è¾¾åˆ°1MHzä»¥ä¸Šçš„é¢‘ç‡å¿…é¡»å¢å¤§ç”µå‹åˆ°10Vï¼Œä½†æ˜¯è¿™åˆä¼šäº§ç”Ÿä¸€é—®é¢˜ï¼šé”ç›¸ç¯æ˜¯10Vç”µå¹³è¾“å…¥è¾“å‡ºï¼Œè€Œåˆ†é¢‘å™¨æ˜¯5Vç”µå¹³ï¼Œä¸¤ç§ç”µå¹³å¹¶ä¸äº’å®¹ï¼Œå¿…é¡»è¿›è¡Œ<strong>ç”µå¹³è½¬æ¢</strong>ã€‚è¿™æ˜¯æˆ‘ä»¬ç»„åœ¨æ˜¨å¤©å¾—åˆ°çš„ç»“è®ºï¼Œç„¶åä»Šå¤©æˆ‘è‡ªå·±èŠ±äº†åŠä¸ªä¸Šåˆçš„æ—¶é—´æ‰æ€»ç®—æ˜¯è°ƒå¥½äº†ã€‚ä¸ºäº†èƒ½å¤Ÿè¦†ç›–ä»1kHz~1MHzçš„é¢‘ç‡èŒƒå›´ï¼Œæˆ‘åˆ‡æ¢äº†ä¸‰ä¸ªç”µå®¹ï¼š</p><table><thead><tr><th>100pF</th><th>4.7nF</th><th>3.3nF</th></tr></thead><tbody><tr><td>41k~1.2M</td><td>2k~40k</td><td>1k~29k</td></tr></tbody></table><p>æ³¨æ„è¿™é‡Œçš„é¢‘ç‡åº”å½“æ˜¯<strong>å€é¢‘åæœ€ç»ˆè¾“å‡ºçš„é¢‘ç‡</strong>ã€‚</p><h1 id="ç”µå¹³è½¬æ¢">ç”µå¹³è½¬æ¢</h1><p>è¿™é‡Œçš„ç”µå¹³è½¬æ¢ï¼Œå…·ä½“æ¥è¯´ï¼š</p><ul><li>é”ç›¸ç¯VCOè¾“å‡ºçš„10Væ–¹æ³¢è¦è¢«è½¬æ¢ä¸º5Væ–¹æ³¢</li><li>åˆ†é¢‘å™¨è¾“å‡ºçš„5Væ–¹æ³¢è¦è¢«è½¬æ¢ä¸º10Væ–¹æ³¢</li></ul><p>LTspiceä»¿çœŸç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/3vQpjKX.png" /></p><p>é«˜ç”µå¹³è½¬ä½ç”µå¹³ç”¨çš„æ˜¯å·¦è¾¹é‚£ä¸ªç”µè·¯ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåç›¸å™¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šæ‹‰ç”µé˜»R1ä¸è¦å–å¾—å¤ªå¤§ï¼Œä¸ç„¶ä¸Šå‡æ²¿è¿‡äºç¼“æ…¢ï¼Œé€‚åº”ä¸äº†1MHzã€‚è€Œä¸”è¿™ä¸ªç”µè·¯å®é™…æµ‹è¯•çš„æ—¶å€™è¾“å‡ºåœ¨ä¸‹é™æ²¿çš„æŒ¯é“ƒéå¸¸å¤§ï¼Œå¤§æ¦‚æ˜¯æ‚æ•£ç”µå®¹å’Œå¯„ç”Ÿç”µæ„Ÿçš„å½±å“ï¼ˆæ¯•ç«Ÿæ˜¯ç„Šæ¥åˆ°æ´æ´æ¿ä¸Šçš„ï¼‰ã€‚</p><p>ä½ç”µå¹³è½¬é«˜ç”µå¹³ç”¨çš„æ˜¯å³è¾¹çš„ç”µè·¯ï¼Œå› ä¸ºå·¦è¾¹çš„ç”µè·¯è¿™æ—¶å€™å°±ä¸èƒ½ç”¨äº†ã€‚</p><h1 id="ç¯è·¯æ»¤æ³¢å™¨">ç¯è·¯æ»¤æ³¢å™¨</h1><p>è¿™æ˜¯é”ç›¸ç¯ç›¸å½“é‡è¦çš„ä¸€ç¯ã€‚ç¯è·¯æ»¤æ³¢å™¨çš„èŒè´£å°±æ˜¯å°†é‰´ç›¸å™¨è¾“å‡ºçš„é«˜é¢‘åˆ†é‡å°½å¯èƒ½åœ°æ»¤å¹²å‡€ã€‚ç½‘ä¸Šå…³äºç¯è·¯æ»¤æ³¢å™¨çš„è®¾è®¡æ–¹æ³•èµ„æ–™å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œå¯ä»¥å‚è§è¯¥åšå®¢ï¼š<ahref="https://www.cnblogs.com/qm1412/p/18222379">é”ç›¸ç¯å­¦ä¹ ---CD4046</a></p><p>ç¯è·¯æ»¤æ³¢å™¨æœ‰ä¸“ç”¨çš„è®¾è®¡è½¯ä»¶ï¼Œä½†æ˜¯éå¸¸å¤è€ï¼Œå¿…é¡»å†ä¸‹è½½ä¸€ä¸ªXPç³»ç»Ÿçš„è™šæ‹Ÿæœºï¼Œéå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘å°±ç›´æ¥ä½¿ç”¨åšå®¢é‡Œè®¾è®¡å¥½çš„ç”µè·¯äº†ï¼š</p><p><img src="https://i.imgur.com/yCQpeqy.jpg" /></p><p>LTspiceä»¿çœŸå¾—åˆ°å…¶å¹…é¢‘å“åº”å’Œç›¸é¢‘å“åº”å¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/LWBPZIo.png" /></p><p>å®æµ‹è¿™ä¸ªæ»¤æ³¢å™¨å¯ä»¥ç”¨äº1kHz~1MHzçš„èŒƒå›´ã€‚</p><h1 id="å¯¹vcoè¾“å‡ºè¿›è¡Œæ•´å½¢">å¯¹VCOè¾“å‡ºè¿›è¡Œæ•´å½¢</h1><p>è¿™ä¸€æ­¥å…¶å®å¹¶ä¸æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä½¿ç”¨å‘Šè¯‰æ¯”è¾ƒå™¨æŠŠè¾“å‡ºæ³¢å½¢æ•´æˆå¥½çœ‹ä¸€ç‚¹çš„æ–¹æ³¢ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºæˆ‘æ‰€ç”¨çš„10Vè½¬5Vçš„ç”µå¹³è½¬æ¢ç”µè·¯ä¸Šå‡æ²¿éå¸¸æ…¢ï¼Œä»¥è‡³äºæ–¹æ³¢å‡ ä¹å·²ç»å˜æˆé”¯é½¿æ³¢äº†ï¼Œéå¸¸éš¾å—ã€‚</p><p><img src="https://i.imgur.com/NrkVsnV.png" /></p><p>æ³¨æ„æˆ‘æœ€ç»ˆç”µè·¯ä¸­VINæ˜¯ç»è¿‡ç”µå®¹ä¹‹åæ‰é€å…¥æ¯”è¾ƒå™¨ï¼Œè¿™æ ·éš”ç¦»ç›´æµåˆ†é‡ï¼Œæ¯”è¾ƒå™¨å®¹æ˜“äº§ç”Ÿæ­£ç¡®çš„ç»“æœã€‚å¦å¤–R1å¯ä»¥ç¨å¾®å–å¾—å¤§ä¸€äº›ï¼Œæ¯”å¦‚500æ¬§ï¼Œå¯¹å™ªå£°çš„æŠ‘åˆ¶èƒ½åŠ›ä¹Ÿä¼šå¼ºä¸€äº›ã€‚è¿™ä¸ªæ¯”è¾ƒå™¨çš„è¾“å‡ºä¸º3.3Vã€0Vï¼Œå¯ä»¥ç›´æ¥é€å…¥å•ç‰‡æœºçš„å¤–éƒ¨æ—¶é’Ÿè¾“å…¥å¼•è„šç”¨æ¥æµ‹é‡é¢‘ç‡ã€‚</p><h1 id="æ€»ç»“">æ€»ç»“</h1><p>æœ€åå®ç°çš„æ•ˆæœå¦‚å›¾ï¼ˆè¾“å…¥ä¿¡å·ä¸è¾“å‡ºä¿¡å·ç¨³å®šåŒé¢‘æ˜¾ç¤ºä¸æ¼‚ç§»ï¼‰åªæ‹äº†N=1çš„æƒ…å†µï¼ŒN=64ä¹Ÿèƒ½éå¸¸ç¨³</p><p><img src="https://i.imgur.com/PvEWWA3.jpg" /></p><p>è¿™æ¬¡ä¸é”ç›¸ç¯æœ‰å…³çš„ç”µè·¯åŸºæœ¬éƒ½æ˜¯æˆ‘è´Ÿè´£çš„ï¼Œç„Šæ¥åœ¨ä¸€å¤§å—æ´æ´æ¿ä¸Šï¼Œç„Šé”¡ä¸çš„åŠ©ç„Šå‰‚å¿«ç†æ­»æˆ‘äº†ã€‚ã€‚ã€‚ä¸è¿‡å¥½åœ¨æœ€åçš„æˆå“è¡¨ç°éå¸¸ä¸é”™ï¼Œæœ€å¤§èƒ½é”å®šåˆ°1.2MHzçš„é¢‘ç‡ï¼Œå·²ç»æ¥è¿‘CD4046Bçš„æé™äº†ã€‚å¦å¤–é˜Ÿå‹ä¹Ÿä¹°äº†ä¸€å¤§å †CD4046Bï¼Œè¿‡å‡ å¤©æˆ‘æƒ³ç”¨è¿™äº›å¤šä½™çš„èŠ¯ç‰‡æµ‹è¯•ä¸€ä¸‹é”ç›¸ç¯çš„FMè§£è°ƒåŠŸèƒ½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç”µå­è®¾è®¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¡¬ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ—¥èªä¸­çš„ã€Œãã®å­—ç‚¹ã€</title>
    <link href="/2024/10/30/%E6%97%A5%E8%AA%9E%E4%B8%AD%E7%9A%84%E3%80%8C%E3%81%8F%E3%81%AE%E5%AD%97%E7%82%B9%E3%80%8D/"/>
    <url>/2024/10/30/%E6%97%A5%E8%AA%9E%E4%B8%AD%E7%9A%84%E3%80%8C%E3%81%8F%E3%81%AE%E5%AD%97%E7%82%B9%E3%80%8D/</url>
    
    <content type="html"><![CDATA[<style>p { font: 12pt Yu Mincho !important; }</style><p>æœ€è¿‘åœ¨é’ç©ºæ–‡åº«ä¸Šé–²è®€æ—¥èªåœ–æ›¸çš„æ™‚å€™ç™¼ç¾äº†é€™æ¨£ä¸€æ®µæ–‡å­—ï¼š</p><blockquote><p>è¡¨è¨˜ã«ã¤ã„ã¦<br />ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ W3C å‹§å‘Š XHTML1.1 ã«ãã£ãŸå½¢å¼ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚<br />ã€Œãã®å­—ç‚¹ã€ã¯ã€Œï¼ï¼¼ã€ã§è¡¨ã—ã¾ã—ãŸã€‚</p></blockquote><p>å³ï¼šæ­¤æ–‡ä»¶æ˜¯æ ¹æ®W3Cæ¨èçš„XHTML1.1æ ¼å¼åˆ¶ä½œçš„ã€‚'ãã®å­—ç‚¹'ç”¨'ï¼ï¼¼'è¡¨ç¤ºã€‚</p><p>ã€Œãã®å­—ç‚¹ã€æ˜¯ä»€éº½ï¼Ÿ</p><p>æˆ‘æ‰¾åˆ°äº†é€™æ¨£ä¸€ç¯‡è§£é‡‹æ–‡ç« ï¼š<ahref="https://www.canon-its.co.jp/files/topics/2560_ext_06_0.pdf">https://www.canon-its.co.jp/files/topics/2560_ext_06_0.pdf</a></p><p>æ‰€è¬‚'ãã®å­—ç‚¹'ï¼Œå°±æ˜¯åœ¨é‡å¤ä¸¤ä¸ªå­—ä»¥ä¸Šçš„å‡åï¼Œæˆ–æ¼¢å­—ä¸å‡åæ™‚ä½¿ç”¨çš„æ¨™è¨˜ç¬¦è™Ÿã€‚å¦‚æœåœ¨é‡è¤‡æ™‚æ¼¢å­—çš„è®€éŸ³è®Šçˆ²æ¿éŸ³ï¼Œé‚£éº½ãã®å­—ç‚¹ä¹Ÿè¦ç›¸æ‡‰åœ°åŠ ä¸Šæ¿éŸ³ç¬¦è™Ÿã€‚ä¸€å€‹ãã®å­—ç‚¹è¦å ç”¨å…©å€‹å­—ç¯€çš„ä½ç½®ã€‚ä»¥ä¸‹åœ–çˆ²ä¾‹ï¼š</p><p><img src="https://i.imgur.com/7NyGuQV.png" /></p><p>ã¾ã‚ã¾ã‚ãƒ¼ï¼ã¾ã‚ï¼ï¼¼ å¤§è‡´ï¼Œé‚„ç®—éå¾—å»<br />ã—ã‹ã˜ã‹ãƒ¼ï¼ã—ã‹ï¼"ï¼¼ã€€äº‘äº‘ï¼Œç­‰ç­‰<br />è¦‹ã‚‹è¦‹ã‚‹ãƒ¼ï¼è¦‹ã‚‹ï¼ï¼¼ã€€çœ¼çœ‹è‘—ï¼Œè½‰çœ¼é–“<br />é›¢ã‚Œé›¢ã‚Œãƒ¼ï¼é›¢ã‚Œï¼ï¼¼ã€€å¤±æ•£</p><p>ç”±æ–¼æ—¥èªæ–‡ç« ç¶“å¸¸æŒ‰ç…§ç¸±å‘æ’åˆ—ï¼Œå› æ­¤é’ç©ºæ–‡åº«å°±ä½¿ç”¨â€œï¼ï¼¼â€ä¾†ä»£æ›¿é€™å€‹ç¬¦è™Ÿäº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥è¯­</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>LTspiceä¸­SWå…ƒä»¶çš„ä½¿ç”¨</title>
    <link href="/2024/10/14/LTspice%E4%B8%ADSW%E5%85%83%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/10/14/LTspice%E4%B8%ADSW%E5%85%83%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>LTspiceä¸åƒMultisimé‚£æ ·æœ‰ç°æˆçš„æ‰‹åŠ¨å¼€å…³ã€‚å¼€å…³åŠŸèƒ½å¯ä»¥ç”¨<strong>S.Voltage Controlled Switch</strong>ï¼ˆå‹æ§å¼€å…³ï¼‰å®ç°ã€‚</p><p><img src="https://i.imgur.com/1EAGN5i.png" /></p><ol type="1"><li>æŒ‰Pé”®æ‰“å¼€å…ƒä»¶åº“ï¼Œæœç´¢"SW"ï¼Œæ”¾ç½®åœ¨å›¾çº¸ä¸­</li><li>æ’å…¥æŒ‡ä»¤å®šä¹‰SWå…ƒä»¶çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š<code>.model MYSW SW(Ron=1 Roff=1Meg Vt=.5 Vh=-.4)</code>ï¼Œå…¶ä¸­<code>Ron</code>æ˜¯å¯¼é€šç”µé˜»ï¼ˆ<strong>å¯¼é€šç”µé˜»ä¸èƒ½ä¸º0ï¼</strong>ï¼‰ï¼Œ<code>Roff</code>ä¸ºæ–­å¼€ç”µé˜»ï¼ŒVtå’ŒVhå†³å®šäº†å¼€å…³çš„é˜ˆå€¼ç”µå‹ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º0.9Vå’Œ0.1V</li><li>å°†å¼€å…³æ¨¡å‹çš„åç§°æ”¹æˆMYSW</li><li>æ”¾ç½®ä¸€ä¸ªç”µå‹æºç”¨æ¥æ§åˆ¶å¼€å…³ï¼Œè¿™é‡Œç”¨çš„æ˜¯Pulseï¼Œå¼€å…³åœ¨é—­åˆ1såä¿æŒå…³æ–­çŠ¶æ€ã€‚</li></ol><p>SWç›¸å…³çš„æ‰€æœ‰å‚æ•°å¦‚ä¸‹è¡¨æ ¼ï¼š</p><table><thead><tr><th style="text-align: center;">Name</th><th style="text-align: center;">Description</th><th style="text-align: center;">Units</th><th style="text-align: center;">default</th></tr></thead><tbody><tr><td style="text-align: center;">Vt</td><td style="text-align: center;">é˜ˆå€¼ç”µå‹</td><td style="text-align: center;">V</td><td style="text-align: center;">0.0</td></tr><tr><td style="text-align: center;">Vh</td><td style="text-align: center;">æ»åç”µå‹</td><td style="text-align: center;">V</td><td style="text-align: center;">0.0</td></tr><tr><td style="text-align: center;">Ron</td><td style="text-align: center;">å¯¼é€šç”µé˜»</td><td style="text-align: center;">Î©</td><td style="text-align: center;">1.0</td></tr><tr><td style="text-align: center;">Roff</td><td style="text-align: center;">å…³æ–­ç”µé˜»</td><td style="text-align: center;">Î©</td><td style="text-align: center;">1/Gmin</td></tr><tr><td style="text-align: center;">Lser</td><td style="text-align: center;">ä¸²è”ç”µæ„Ÿ</td><td style="text-align: center;">H</td><td style="text-align: center;">0.0</td></tr><tr><td style="text-align: center;">Vser</td><td style="text-align: center;">ä¸²è”ç”µå‹</td><td style="text-align: center;">V</td><td style="text-align: center;">0.0</td></tr><tr><td style="text-align: center;">Ilimit</td><td style="text-align: center;">é™åˆ¶ç”µæµ</td><td style="text-align: center;">A</td><td style="text-align: center;">Infin.</td></tr></tbody></table><p><strong>è¯¥å¼€å…³æ ¹æ®æ»å›ç”µå‹ Vhçš„å€¼ï¼Œå…·æœ‰ä¸‰ç§ä¸åŒçš„ç”µå‹æ§åˆ¶æ¨¡å¼:</strong></p><ul><li>å¦‚æœ Vhä¸ºé›¶ï¼Œå¼€å…³å°†å§‹ç»ˆå®Œå…¨å¯¼é€šæˆ–å…³æ–­ï¼Œå…·ä½“å–å†³äºè¾“å…¥ç”µå‹æ˜¯å¦è¶…è¿‡é˜ˆå€¼ç”µå‹ã€‚</li><li>å¦‚æœ Vhä¸ºæ­£å€¼ï¼Œå¼€å…³å°†è¡¨ç°å‡ºæ»å›ç°è±¡ï¼Œå°±åƒé€šè¿‡æ–½å¯†ç‰¹è§¦å‘å™¨æ§åˆ¶ä¸€æ ·ï¼Œè§¦å‘ç‚¹ä¸º Vt- Vh å’Œ Vt + Vhã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒVhæ˜¯è§¦å‘ç‚¹ä¹‹é—´ç”µå‹çš„ä¸€åŠï¼Œè¿™ä¸å¸¸è§çš„å®éªŒå®¤æœ¯è¯­æœ‰æ‰€ä¸åŒã€‚</li><li>å¦‚æœ Vhä¸ºè´Ÿå€¼ï¼Œå¼€å…³å°†åœ¨å¯¼é€šå’Œå…³æ–­é˜»æŠ—ä¹‹é—´å¹³æ»‘è¿‡æ¸¡ã€‚è¿‡æ¸¡å‘ç”Ÿåœ¨æ§åˆ¶ç”µå‹ Vt - Vhå’Œ Vt + Vh ä¹‹é—´ï¼Œä¸”å¹³æ»‘è¿‡æ¸¡éµå¾ªå¼€å…³å¯¼é€šè¡Œä¸ºçš„å¯¹æ•°çš„ä½é˜¶å¤šé¡¹å¼æ‹Ÿåˆã€‚</li></ul><p>å¹³æ—¶è®¾Vhä¸ºè´Ÿå€¼å°±å¥½ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<br /><ahref="https://www.analog.com/cn/resources/technical-articles/ltspiceiv-voltage-controlled-switches.html#:~:text=To%20insert%20and%20configure%20a%20switch%20in%20LTspice%E2%80%A6,this%20example%3A.model%20MYSW%20SW%20%28Ron%3D1%20Roff%3D1Meg%20Vt%3D.5%20Vh%3D-.4%29">LTspice:Voltage Controlled Switches</a></p>]]></content>
    
    
    <categories>
      
      <category>EE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¡¬ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºFluidä¸»é¢˜é¦–é¡µçš„å‰¯æ ‡é¢˜æ·»åŠ æ·¡å…¥æ•ˆæœ</title>
    <link href="/2024/10/04/%E4%B8%BAFluid%E4%B8%BB%E9%A2%98%E9%A6%96%E9%A1%B5%E7%9A%84%E5%89%AF%E6%A0%87%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%B7%A1%E5%85%A5%E6%95%88%E6%9E%9C/"/>
    <url>/2024/10/04/%E4%B8%BAFluid%E4%B8%BB%E9%A2%98%E9%A6%96%E9%A1%B5%E7%9A%84%E5%89%AF%E6%A0%87%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%B7%A1%E5%85%A5%E6%95%88%E6%9E%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘åˆæŠ˜è…¾äº†ä¸€ä¸‹åšå®¢çš„ç¾åŒ–ã€‚é»˜è®¤Fluidä¸»é¢˜çš„é¦–é¡µå‰¯æ ‡é¢˜ç”¨çš„æ˜¯æ‰“å­—æœºç‰¹æ•ˆï¼Œä¸è¿‡æˆ‘ä¸å¤ªå–œæ¬¢ï¼Œäºæ˜¯ç¢ç£¨äº†ä¸€ä¸‹æ·¡å…¥æ•ˆæœã€‚æˆ‘å¹¶æ²¡æœ‰å­¦è¿‡å‰ç«¯ï¼Œä¸€ä¸‹ä»£ç ä¸»è¦é chatgptå’Œå…¶ä»–ç½‘å‹å¾—åˆ°ã€‚</p><h1 id="è¿‡ç¨‹">è¿‡ç¨‹</h1><p>ä½¿ç”¨F12æ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼Œå®šä½å‰¯æ ‡é¢˜ï¼š<br /><img src="https://i.imgur.com/mgjRfJ2.jpg" alt="Imgur" />ç›®æ ‡å¯¹åº”çš„å…ƒç´ ä¸º<code>.h2 #subtitle</code>ï¼Œåœ¨å¤–éƒ¨CSSæ–‡ä»¶ä¸­åŠ å…¥ä¸‹åˆ—ä»£ç ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs css">    <span class="hljs-keyword">@font-face</span> &#123;<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;Si Yuan&quot;</span>;<br>    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&quot;../fonts/Si Yuan.otf&quot;</span>) <span class="hljs-built_in">format</span>(<span class="hljs-string">&quot;truetype&quot;</span>);<br>    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;<br>  &#125;<br><br><span class="hljs-selector-class">.h2</span> <span class="hljs-selector-id">#subtitle</span> &#123;<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Si Yuan&#x27;</span>, sans-serif; <span class="hljs-comment">/* æ›¿æ¢ä¸ºä½ æƒ³è¦çš„å­—ä½“ */</span><br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">32px</span>; <span class="hljs-comment">/* è°ƒæ•´å­—ä½“å¤§å° */</span><br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffffff</span>; <span class="hljs-comment">/* è®¾ç½®å­—ä½“é¢œè‰² */</span><br>    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* åˆå§‹é€æ˜åº¦ä¸º0ï¼Œéšè— */</span><br>    <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">1.5s</span> linear; <span class="hljs-comment">/* è®¾ç½®è¿‡æ¸¡æ•ˆæœ */</span><br>  &#125;<br><br><span class="hljs-selector-class">.h2</span> <span class="hljs-selector-id">#subtitle</span><span class="hljs-selector-class">.visible</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-comment">/* å®Œå…¨å¯è§ */</span><br>  &#125;<br></code></pre></td></tr></table></figure><p>ç”±äºè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯æ€æºå®‹ä½“ï¼Œå¹¶éç³»ç»Ÿè‡ªå¸¦çš„å­—ä½“ï¼Œå› æ­¤é¢å¤–ä½¿ç”¨<code>@font-face</code>å¼•å…¥å¤–æ¥å­—ä½“ã€‚</p><p>å¦å¤–ï¼Œæ³¨æ„æ–‡ç« é¡µçš„æ ‡é¢˜å’Œé¦–é¡µçš„æ ‡é¢˜ç”¨çš„æ˜¯åŒä¸€ä¸ªå…ƒç´ ï¼ŒäºŒè€…ä¼šåŒæ—¶å‘ç”Ÿå˜æ›´ã€‚</p><p>å†å‘å¤–éƒ¨jsæ–‡ä»¶ä¸­åŠ å…¥ä¸‹åˆ—ä»£ç ï¼š <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> subtitle = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;subtitle&#x27;</span>);<br>    subtitle.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;visible&#x27;</span>); <span class="hljs-comment">// é¡µé¢åŠ è½½åæ·»åŠ  visible ç±»</span><br>&#125;);<br></code></pre></td></tr></table></figure> å®Œæˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Theme</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ˜è…¾è®°å½•</tag>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é›ªé…·å­—å¹•ç»„çš„ç‰¹æ•ˆæ³¨é‡Šå­—å¹•åˆ†æ</title>
    <link href="/2024/10/02/%E9%9B%AA%E9%85%B7%E5%AD%97%E5%B9%95%E7%BB%84%E7%9A%84%E7%89%B9%E6%95%88%E6%B3%A8%E9%87%8A%E5%AD%97%E5%B9%95%E5%88%86%E6%9E%90/"/>
    <url>/2024/10/02/%E9%9B%AA%E9%85%B7%E5%AD%97%E5%B9%95%E7%BB%84%E7%9A%84%E7%89%B9%E6%95%88%E6%B3%A8%E9%87%8A%E5%AD%97%E5%B9%95%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>é›ªé…·å­—å¹•ç»„åœ¨2011è‡³2012å¹´æœŸé—´ä¸æ›™å…‰å­—å¹•ç»„åˆä½œå®Œæˆäº†ã€Šå‘½è¿çŸ³ä¹‹é—¨ã€‹çš„ç¿»è¯‘å·¥ä½œï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æœ€æ—©çœ‹çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œç¿»è¯‘éå¸¸è´´åˆ‡è‡ªç„¶ï¼Œå¹¶ä¸”åŠ¨æ¼«ä¸­å‡ºç°çš„æµè¡Œè¯æ±‡ä¹Ÿéƒ½é™„ä¸Šäº†è¯¦å°½çš„æ³¨é‡Šã€‚å¯æƒœåœ¨2014å¹´ä¹‹åé›ªé…·å­—å¹•ç»„å°±çªç„¶å¤±è¸ªäº†â€¦â€¦è¿™é‡Œæˆ‘æƒ³åˆ†æä¸€ä¸‹ä»–ä»¬åœ¨ä¸ºã€Šå‘½è¿çŸ³ä¹‹é—¨ã€‹åšå­—å¹•æ³¨é‡Šæ—¶ç”¨åˆ°çš„ç‰¹æ•ˆæ–¹æ¡ˆï¼Œä»ä¸­çª¥è§†é‚£ä¸ªæ—¶ä»£çš„å­—å¹•ç»„å¯¹å¾…å­—å¹•å·¥ä½œæ˜¯ä½•ç­‰æ•¬ä¸šã€‚</p><span id="more"></span><p>ä»¥ç¹ä½“ç‰ˆç¬¬10é›†3:46å¤„çš„æ³¨é‡Šä¸ºä¾‹ï¼Œassæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="hljs">3:46.19~3:51.20     &#123;\move(15,20,15,10,0,200)\pos(15,10)\fad(300, 300)&#125;Blood Tune3:45.90~3:51.41   &#123;\fscx0\pos(15,20)\t(0,200,1,\fscx100)\t(5300,0,1,\fscx0)&#125;â€”â€”â€”â€”3:46.19~3:51.20   &#123;\move(15,20,15,50,0,200)\pos(15,50)\fad(300, 300)&#125;ï¼ˆæ¶ç©ºï¼‰ï¼´ï¼¶å‹•ç•«ã€BLOOD TUNE THE ANIMATIONã€ã€‚\NåŸä½œæ˜¯æ¼«ç•«ï¼Œéš¨è‘—å¤šå…ƒåª’é«”åŒ–çš„é¢¨æ½®çµ‚æ–¼åœ¨å»å¹´å‹•ç•«åŒ–ã€‚\Nä½œå“è¢«è£½ä½œæˆç‚ºå…¨ï¼’ï¼–è©±çš„ä½œå“ï¼Œå—åˆ°äº†å‹•æ¼«æ„›å¥½è€…å€‘çš„å»£æ³›é—œæ³¨ï¼Œ\Nç‰¹åˆ¥æ˜¯å¥³ä¸»è§’ã€æ˜Ÿä¾†Orujeruã€çš„PVCæ¨¡å‹æ“æœ‰ç›¸ç•¶é«˜çš„äººæ°£ã€‚</code></pre><p>ä¸Šé¢ä¸€å…±ç”¨äº†ä¸‰æ®µå­—å¹•æ¥å®Œæˆå¯¹ã€BloodTuneã€‘çš„æ³¨é‡Šã€‚è€Œä¸”ï¼Œä¸‰æ®µå­—å¹•åˆ†åˆ«ä½¿ç”¨äº†ä¸‰ç§ä¸åŒå¤§å°çš„å­—ä½“ï¼ˆåœ¨1080pæ¸…æ™°åº¦ä¸‹ï¼‰ï¼š</p><ol type="1"><li>neta1-å¾®è½¯é›…é»‘ï¼Œç”¨äºæ³¨é‡Šå¯¹è±¡çš„åç§°ï¼Œå­—å·26ï¼Œè¾¹æ¡†2ï¼Œé˜´å½±0</li><li>neta2-å¾®è½¯é›…é»‘ï¼Œç”¨äºåˆ›é€ åˆ†ç•Œçº¿ï¼Œå­—å·40ï¼Œè¾¹æ¡†2ï¼Œé˜´å½±0</li><li>neta3-å¾®è½¯é›…é»‘ï¼Œç”¨äºæ³¨é‡Šçš„å…·ä½“å†…å®¹ï¼Œå­—å·28ï¼Œè¾¹æ¡†2ï¼Œé˜´å½±0</li></ol><p>å®ç°çš„æ•ˆæœå¦‚å›¾ <imgsrc="https://media.giphy.com/media/EuIDh9scyssnZXBT39/giphy.gif" /></p><p>ä¸‹é¢å¯¹è¿™ä¸‰æ®µä»£ç è¿›è¡Œé€è¡Œåˆ†æã€‚</p><h1 id="å¹³æ»‘çš„æ–‡æœ¬å±•ç¤ºæ•ˆæœ">å¹³æ»‘çš„æ–‡æœ¬å±•ç¤ºæ•ˆæœ</h1><p><code>\move</code>ç”¨äºè®¾ç½®æ–‡æœ¬çš„<strong>ç§»åŠ¨è½¨è¿¹</strong>ï¼Œå…¶åŸºæœ¬è¯­æ³•æ˜¯<code>\move(x1,y1,x2,y2,start_time,end_time)</code>ï¼Œå…¶ä¸­<code>(x1,y1)</code>æ˜¯èµ·å§‹ä½ç½®ï¼Œ<code>(x2,y2)</code>æ˜¯ç»“æŸä½ç½®ï¼Œ<code>start_time</code>å’Œ<code>end_time</code>å®šä¹‰åŠ¨ç”»çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ã€‚</p><p><code>\pos</code>ç”¨äºè®¾ç½®æ–‡æœ¬çš„<strong>ç»å¯¹ä½ç½®</strong>ï¼Œå…¶è¯­æ³•æ˜¯(x,y)ï¼Œå…¶ä¸­ x å’Œ yæ˜¯å±å¹•åæ ‡ã€‚è¿™ä¸ªå‘½ä»¤å°†æ–‡æœ¬å›ºå®šåœ¨æŒ‡å®šçš„ä½ç½®ï¼Œä¸éšæ—¶é—´å˜åŒ–ã€‚</p><p><code>\fad</code>ç”¨äºè®¾ç½®æ–‡æœ¬çš„<strong>æ·¡å…¥æ·¡å‡º</strong>æ•ˆæœï¼Œå…¶åŸºæœ¬è¯­æ³•æ˜¯<code>\fad(fade_in_time, fade_out_time)</code>ï¼Œå…¶ä¸­<code>fade_in_time</code>æ˜¯æ·¡å…¥æŒç»­çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ<code>fade_out_time</code>æ˜¯æ·¡å‡ºæŒç»­çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</p><p><code>&#123;\move(15,20,15,10,0,200)\pos(15,10)\fad(300, 300)&#125;Blood Tune</code>æ˜¯ä¸€ä¸²å¤åˆä»£ç ï¼Œç»¼åˆä»¥ä¸Šä¸‰ç‚¹ï¼Œå…¶ä½œç”¨ä¸ºï¼š- æ–‡æœ¬ä»å±å¹•åæ ‡<code>(15, 20)</code>ç§»åŠ¨åˆ°<code>(15, 10)</code>ï¼Œåœ¨ 0æ¯«ç§’æ—¶å¼€å§‹ï¼Œ200 æ¯«ç§’æ—¶ç»“æŸã€‚ -æ–‡æœ¬è¿åŠ¨åˆ°<code>(15,10)</code>åä¼šè¢«å›ºå®šåˆ°è¿™ä¸ªä½ç½®ã€‚ -åœ¨æ–‡æœ¬å¼€å§‹ç§»åŠ¨çš„åŒæ—¶ï¼Œä¼šé™„åŠ ä¸€ä¸ª300æ¯«ç§’çš„æ·¡å…¥æ•ˆæœï¼Œåœ¨æ–‡æœ¬æ¶ˆå¤±æ—¶åˆ™æœ‰300æ¯«ç§’çš„æ·¡å‡ºæ•ˆæœã€‚</p><h1 id="åŠ¨æ€çš„åˆ†ç•Œçº¿">åŠ¨æ€çš„åˆ†ç•Œçº¿</h1><p><code>\fscx</code>ç”¨äºè®¾ç½®æ–‡æœ¬çš„<strong>æ°´å¹³ç¼©æ”¾</strong>(<strong>f</strong>ront<strong>sc</strong>ale<strong>x</strong>)ï¼Œå…¶åŸºæœ¬è¯­æ³•æ˜¯<code>\fscx&lt;value&gt;</code>ï¼Œå…¶ä¸­<code>&lt;value&gt;</code>æ˜¯ç¼©æ”¾çš„ç™¾åˆ†æ¯”å€¼ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>\fscx100</code>è¡¨ç¤ºæ­£å¸¸å¤§å°</li><li><code>\fscx50</code>è¡¨ç¤ºæ­£å¸¸å¤§å°çš„ä¸€åŠ</li></ul><p><code>\t</code>ç”¨äºåˆ›å»º<strong>åŠ¨ç”»æ•ˆæœ</strong>ï¼ˆtransformationï¼‰ï¼Œä»ä¸€ä¸ªæ ·å¼åŠ¨ç”»æ¸å˜åˆ°å¦å¤–ä¸€ä¸ªã€‚Aegisubæ‰‹å†Œç»™å‡ºçš„è¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code class="hljs">\t(&lt;style modifiers&gt;)\t(&lt;accel&gt;,&lt;style modifiers&gt;)\t(&lt;t1&gt;,&lt;t2&gt;,&lt;style modifiers&gt;)\t(&lt;t1&gt;,&lt;t2&gt;,&lt;accel&gt;,&lt;style modifiers&gt;)</code></pre><p>æœ¬ä¾‹ä½¿ç”¨çš„æ˜¯ç¬¬å››ä¸ªã€‚å…¶ä¸­<code>&lt;style modifiers&gt;</code>å‚æ•°æ˜¯ç‰¹æ•ˆæ ‡ç­¾ï¼Œ<code>accel</code>å‚æ•°å¯ä»¥è®©åŠ¨ç”»æ•ˆæœä¸å†æ˜¯åŒ€é€Ÿçš„ï¼Œè€Œæ˜¯æ»¡è¶³ä¸€æ¡æŒ‡æ•°æ›²çº¿ã€‚è¯¥å‚æ•°ä¸º1æ—¶ï¼Œè¿åŠ¨é€Ÿåº¦æ˜¯æ’å®šçš„ã€‚å‚æ•°åœ¨0å’Œ1ä¹‹é—´æ—¶ï¼Œè¿åŠ¨é€Ÿåº¦é€æ¸å˜æ…¢ã€‚å‚æ•°å¤§äº1æ—¶ï¼Œè¿åŠ¨é€Ÿåº¦è¶Šæ¥è¶Šå¿«ã€‚</p><p>æ•´ä¸ªä»£ç çš„è¿è¡Œé€»è¾‘å¯ä»¥ç”¨ä¸‹å›¾æ¦‚æ‹¬ï¼š<br /><img src="https://i.imgur.com/r6Rsdn7.png" /></p>]]></content>
    
    
    <categories>
      
      <category>å­—å¹•</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexo Fluidä¸»é¢˜æ¸²æŸ“LaTeXæ•°å­¦å…¬å¼çš„é—®é¢˜æ€»ç»“</title>
    <link href="/2024/09/15/Hexo%20Fluid%E4%B8%BB%E9%A2%98%E6%B8%B2%E6%9F%93LaTeX%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/"/>
    <url>/2024/09/15/Hexo%20Fluid%E4%B8%BB%E9%A2%98%E6%B8%B2%E6%9F%93LaTeX%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Fluidçš„<ahref="https://hexo.fluid-dev.com/docs/guide/#latex-%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">å®˜æ–¹æŒ‡å—æ–‡æ¡£</a>ä¸­å·²ç»åšäº†è¯¦å°½çš„è¯´æ˜ï¼Œä¸€æ­¥ä¸€æ­¥è·Ÿç€åšå°±æ²¡é—®é¢˜ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸»é¢˜é…ç½®çš„ä»£ç </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">post:</span><br><span class="hljs-attr">math:</span><br><span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">engine:</span> <span class="hljs-string">mathjax</span><br></code></pre></td></tr></table></figure><p>ä¸­ï¼Œè¦æƒ³ä½¿ç”¨æ•°å­¦å…¬å¼ï¼Œ<code>enable</code>ä¸€é¡¹å¿…é¡»æ˜¯<code>true</code>æ‰è¡Œï¼Œå¦åˆ™ä¼šå‡ºç°æ¸²æŸ“é”™è¯¯.</p><p>å¦å¤–ï¼ŒHexoä¸­æ— æ³•ä½¿ç”¨æ¢è¡Œç¬¦<code>\\</code>ï¼ŒåŸå› æ˜¯<code>\</code>åœ¨Markdownå±äºç‰¹æ®Šå­—ç¬¦ï¼Œç”¨äºå­—ç¬¦è½¬ä¹‰ï¼Œæ‰€ä»¥ä¸¤ä¸ª<code>\</code>ç»è¿‡Markdownå¼•æ“å¤„ç†ä¸ºhtmlåï¼Œåªå‰©ä¸‹ä¸€ä¸ªï¼Œç­‰åˆ°LaTexæ¸²æŸ“å¼•æ“å¤„ç†æ—¶ï¼Œå®é™…ä¸Šåªçœ‹åˆ°ä¸€ä¸ª<code>\</code>ï¼Œæ¸²æŸ“å¼•æ“æŠŠå®ƒå½“ä½œLaTeX ä¸­çš„ç©ºæ ¼ã€‚</p><p>åœ¨ä¸æ”¹åŠ¨ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ç›´æ¥æ”¹å˜å…¬å¼çš„å†™æ³•ã€‚æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªå…¬å¼</p><pre><code class="hljs">$$a_11=b_11 \\a_22=b_22+c_22$$</code></pre><p>æ”¹ä¸º</p><pre><code class="hljs">$$\begin&#123;aligned&#125;a_&#123;11&#125;&amp; =b_&#123;11&#125;\\a_&#123;22&#125;&amp; =b_&#123;22&#125;+c_&#123;22&#125;\end&#123;aligned&#125;$$</code></pre><p>æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š <span class="math display">\[\begin{aligned}a_{11}&amp; =b_{11}\\a_{22}&amp; =b_{22}+c_{22}\end{aligned}\]</span> æ›´å¤æ‚çš„å…¬å¼åŒç†ï¼š <span class="math display">\[\begin{aligned}    F_x&#39;&amp;=\gamma\{q[\frac{-i\gamma}{c}(u_t&#39;+i\betau_x&#39;)E_x+u_y&#39;B_z-u_z&#39;B_y]    +i\beta\frac{iq}{c}[\gamma(u_x&#39;-i\betau_t&#39;)E_x+u_y&#39;E_y+u_z&#39;E_z] \}\\    &amp;=\frac{-iq\gamma^2}{c}(1-\beta^2)E_xu_t&#39;-q\gamma(B_y+\frac{\beta}{c}E_z)u_z&#39;+q\gamma(B_z-\frac{\beta}{c}E_y)u_y&#39;\end{aligned}\]</span></p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åºç« -æ–°åšå®¢çš„è¯ç”Ÿ</title>
    <link href="/2024/09/13/hello-world/"/>
    <url>/2024/09/13/hello-world/</url>
    
    <content type="html"><![CDATA[<p>æ–°åšå®¢å»ºæˆç¥è´ºï¼ <span id="more"></span>ç»è¿‡ä¸¤å¤©çš„é…ç½®ï¼Œç»ˆäºæˆåŠŸç”¨GithubæŠŠåšå®¢æ­å»ºå‡ºæ¥äº†ï¼</p><p>å…¶å®ä¹‹å‰æˆ‘ä¸€ç›´æ˜¯åœ¨åšå®¢å›­ä¸Šé¢å†™åšå®¢çš„ï¼ˆè™½ç„¶ä¹Ÿæ‰åˆšå†™äº†å‡ ä¸ªæœˆï¼‰ï¼Œä½†æ˜¯æœ€è¿‘åšå®¢å›­çš„è¿è¥æƒ…å†µä»¤äººå ªå¿§ï¼Œå¯èƒ½å†è¿‡å‡ ä¸ªæœˆå°±è¦è¢«æ”¶è´­äº†ï¼Œå˜›è¿™æ ·çš„è¯åˆ°æ—¶å€™åšå®¢å›­å¤§æ¦‚ç‡è¦æ¤å…¥å¹¿å‘Šäº†ï¼Œæ‰€ä»¥ç´¢æ€§è‡ªå·±åˆ›å»ºä¸€ä¸ªåšå®¢å¥½äº†ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘å†™åšå®¢çš„ç›®çš„æ˜¯æŠŠè‡ªå·±çš„æƒ³æ³•è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…åˆ†äº«è‡ªå·±çš„çŸ¥è¯†ï¼Œæ‰€ä»¥åšå®¢å›­é‚£ç§ç±»ä¼¼äºè®ºå›å¼çš„æ¨¡å¼å…¶å®å¹¶ä¸æ˜¯å¾ˆé€‚åˆæˆ‘ã€‚åªè¦æŠŠåšæ–‡å‘å‡ºæ¥ï¼Œæˆ‘å°±è¾¾åˆ°ç›®çš„äº†ï¼Œå°±ç®—æ²¡æœ‰äººçœ‹ä¹Ÿæ²¡å…³ç³»ã€‚</p><p>ä¸å‡ºæ„å¤–çš„è¯è¿™ä¸ªåšå®¢åº”è¯¥ä¼šé•¿æœŸæ›´æ–°ä¸‹å»ã€‚æ¯•ç«Ÿæ˜¯è‡ªå·±è´¹äº†å¥½å¤§çš„åŠŸå¤«æ‰å»ºå‡ºæ¥çš„å˜›ï¼ˆç¬‘ï¼‰<!-- æˆ‘åœ¨ç”Ÿæ´»ä¸­å¹¶ä¸å–œæ¬¢å’Œåˆ«äººäº¤æµï¼Œå‘¨å›´èƒ½å’Œæˆ‘ä¸€èµ·äº¤æµå–œæ¬¢çš„äº‹ç‰©çš„äººå‡ ä¹æ²¡æœ‰ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¸Œæœ›æŠŠè‡ªå·±æ€è€ƒçš„ä¸œè¥¿åˆ†äº«å‡ºæ¥ã€‚é‚£å¹²è„†å°±å€ŸåŠ©åšå®¢å¥½äº†ã€‚ -->ä»¥åè¿™ä¸ªåšå®¢ä¸Šä¼šå‘å¸ƒå„ç§æˆ‘æ„Ÿå…´è¶£çš„å†…å®¹ã€‚</p><p>æ€»ä¹‹ï¼Œæˆ‘å®£å¸ƒï¼ŒBanyee's Blogä»ä»Šå¤©å¼€å§‹æ­£å¼æˆç«‹äº†ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>åˆæ¬¡è§é¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
