

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/tree.png">
  <link rel="icon" href="/img/tree.png">
  
    <link rel="canonical" href="https://kznleaf.top/2026/02/17/k8s学习1/"/>
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="kznLeaf">
  <meta name="keywords" content="">
  
    <meta name="description" content="基本概念Kubernetes 协调着一个高可用的计算机集群，这些计算机被连接在一起作为一个整体工作。Kubernetes 的抽象机制允许你将容器化应用部署到集群中，而无需将其专门绑定到具体的单台机器上。 为了利用这种全新的部署模型，应用需要以一种与具体主机解耦的方式进行打包：即容器化。相比于过去将应用作为软件包深度集成到特定主机上的部署模式，容器化应用更加灵活，也具有更高的可用性。 Kuberne">
<meta property="og:type" content="article">
<meta property="og:title" content="kubernetes基础知识梳理">
<meta property="og:url" content="https://kznleaf.top/2026/02/17/k8s%E5%AD%A6%E4%B9%A01/index.html">
<meta property="og:site_name" content="絆叶の片隅">
<meta property="og:description" content="基本概念Kubernetes 协调着一个高可用的计算机集群，这些计算机被连接在一起作为一个整体工作。Kubernetes 的抽象机制允许你将容器化应用部署到集群中，而无需将其专门绑定到具体的单台机器上。 为了利用这种全新的部署模型，应用需要以一种与具体主机解耦的方式进行打包：即容器化。相比于过去将应用作为软件包深度集成到特定主机上的部署模式，容器化应用更加灵活，也具有更高的可用性。 Kuberne">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s41.ax1x.com/2026/02/17/pZOrx3t.png">
<meta property="article:published_time" content="2026-02-17T13:42:36.000Z">
<meta property="article:modified_time" content="2026-02-20T13:06:34.912Z">
<meta property="article:author" content="kznLeaf">
<meta property="article:tag" content="kubernetes">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s41.ax1x.com/2026/02/17/pZOrx3t.png">
  
  
  
  <title>kubernetes基础知识梳理 - 絆叶の片隅</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">
<link rel="stylesheet" href="/css/macBorder.css">
<link rel="stylesheet" href="/css/sign.css">
<link rel="stylesheet" href="/css/backgroundize.css">
<link rel="stylesheet" href="/css/iconfont.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"kznleaf.top","root":"/","version":"1.9.8","typing":{"enable":false,"typeSpeed":70,"cursorChar":"","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":false,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"Rs1qykYBxQwdjhZkWVB3fq7t-MdYXbMMI","app_key":"i1fqxvrusqbCUHDrnC4iGszb","server_url":"https://rs1qykyb.api.lncldglobal.com","path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->

  <div id="Loadanimation" style="z-index:999999;">
    <div id="Loadanimation-center">
       <div id="Loadanimation-center-absolute">
           <div class="xccx_object" id="xccx_four"></div>
           <div class="xccx_object" id="xccx_three"></div>
           <div class="xccx_object" id="xccx_two"></div>
           <div class="xccx_object" id="xccx_one"></div>
       </div>
    </div>
    </div>

  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>banyee&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background.webp') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">kubernetes基础知识梳理</span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2026-02-17 21:42" pubdate>
          February 17, 2026 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.4k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          37 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> views
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">kubernetes基础知识梳理</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>Kubernetes 协调着一个<strong>高可用的计算机集群</strong>，这些计算机被连接在一起作为一个整体工作。Kubernetes 的抽象机制允许你<strong>将容器化应用部署到集群中</strong>，而无需将其专门绑定到具体的单台机器上。</p>
<p>为了利用这种全新的部署模型，应用需要以一种与具体主机解耦的方式进行打包：即容器化。相比于过去将应用作为软件包深度集成到特定主机上的部署模式，容器化应用更加灵活，也具有更高的可用性。</p>
<p>Kubernetes 以更高效的方式，<strong>跨集群自动完成应用容器的分发与调度</strong>。Kubernetes 是一个开源平台，且已达到生产就绪级别。</p>
<hr>
<p>一个 Kubernetes 集群由两种类型的资源组成：</p>
<ul>
<li><strong>控制平面</strong> (Control Plane)：负责协调整个集群。</li>
<li><strong>节点</strong> (Nodes)：负责运行应用的“工人”（工作负载）。应用程序托管在节点中。</li>
</ul>
<p><strong>节点（Node） 是 Kubernetes 集群中的工作机器，可以是一台虚拟机，也可以是一台物理计算机</strong>。</p>
<p>每个节点都运行着一个 <strong>Kubelet</strong>，它是负责管理该节点并与 Kubernetes 控制平面进行通信的代理程序。</p>
<p>此外，节点还应具备<strong>操作容器的工具</strong>，例如 containerd 或 CRI-O。<strong>一个处理生产环境流量的 Kubernetes 集群至少应包含三个节点</strong>。这是因为如果其中一个节点宕机，将会同时损失一个 etcd 成员和一个控制平面实例，从而损害系统的冗余性。你可以通过增加更多的控制平面节点来降低这种风险。</p>
<blockquote>
<p>etcd是k8s集群的后端存储，是一个键值对数据库</p>
</blockquote>
<p>当你向 Kubernetes 部署应用时，你需要告诉控制平面，让它启动应用的容器。控制平面随后会调度这些容器在集群的节点上运行。节点组件（如 Kubelet）通过控制平面暴露的<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/kubernetes-api/">Kubernetes API</a>与控制平面进行通信。终端用户也可以直接利用 Kubernetes API 与集群进行交互。</p>
<blockquote>
<p>Kubernetes API 允许您查询和操作 Kubernetes 中对象的状态。Kubernetes 控制平面的核心是 <strong>API 服务器</strong>及其公开的 <strong>HTTP API</strong>。用户、集群的不同部分、外部组件都通过 API 服务器相互通信。</p>
</blockquote>
<p>Kubernetes 集群既可以部署在物理机上，也可以部署在虚拟机上。对于刚开始接触 Kubernetes 开发的用户，可以使用 Minikube。Minikube 是一种轻量级的 Kubernetes 实现，它会在你的本地机器上<strong>创建一个虚拟机</strong>，并部署一个<strong>仅包含单个节点</strong>的简单集群。Minikube 支持 Linux、macOS 和 Windows 系统。其命令行工具（CLI）提供了操作集群的基础引导功能，包括启动（start）、停止（stop）、查看状态（status）以及删除（delete）。</p>
<p>另一个选择是kind，直接将本机的Docker daemon作为容器运行时，好处是节点拉不动的镜像可以手动拉取再加载到集群中，绕过GFW问题。我用的是这个。</p>
<h2 id="集群结构"><a href="#集群结构" class="headerlink" title="集群结构"></a>集群结构</h2><p>如前所述，集群中包含两种资源，如下图所示：</p>
<p><img src="https://i.imgur.com/hblYYLX.png" srcset="/img/loading.gif" lazyload></p>
<p>这里出现了一些新的组件：</p>
<ul>
<li><code>kube-proxy</code>：是运行在集群中每个节点上的网络代理，旨在实现 Kubernetes Service 的功能，也就是负责把发送给这个节点代表的服务的请求<strong>负载均衡</strong>到不同的Pod上。</li>
<li><code>kube-scheduler</code> 属于控制平面的组件，负责监视新创建的、未指定运行节点的 Pod，并选择节点来让 Pod 在上面运行。</li>
<li><code>kubelet</code>负责 <strong>Kubernetes 控制面和节点之间通信</strong>的进程；它管理节点上运行的 Pod 和容器。</li>
<li><strong>容器运行时CRI</strong>（如 Docker）：负责<strong>从镜像仓库中拉取容器镜像、解压缩容器以及运行应用</strong>。常见的容器运行环境包括 containerd、 CRI-O。</li>
<li><strong>Pod</strong>：是一个或者多个紧密耦合的应用容器的组合，他们共享存储、IP地址、每个容器的运行信息。<strong>只有容器紧耦合并且需要共享磁盘等资源时，才应将其编排在一个 Pod 中。</strong></li>
</ul>
<p>Pod示意图如下：</p>
<p><img src="https://s41.ax1x.com/2026/02/14/pZqzRtH.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><strong>节点</strong>：Pod所处的工作机器，可以是虚拟机，也可以是物理机。Node由控制平面管理。一个节点至少要有kubelet和容器运行时。</li>
</ul>
<p>节点的示意图如下：</p>
<p><img src="https://s41.ax1x.com/2026/02/14/pZqzzj0.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>最后，API Server是控制平面的前端，暴露了HTTP API。它的主要实现是<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver</a>。kube-apiserver支持水平扩展，即可以同时运行多个实例。</li>
</ul>
<h3 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h3><p>etcd是k8s集群的后端存储，是一个键值数据库，包含了所有的k8s状态和关键信息。</p>
<p>etcd以包含奇数个节点的集群的形式存在。生产环境强烈推荐部署5个节点，不能多也不能少。</p>
<h4 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h4><p>既然存储了所有的k8s对象，就有必要进行<strong>数据备份</strong>，即创建快照文件，</p>
<p>etcd 的快照机制利用了 <strong>MVCC</strong>（多版本并发控制）的后端存储特性，在备份时不会阻塞当前的读写操作。所以<strong>创建快照对性能无影响</strong>。</p>
<p>备份etcd有两种方式：<strong>内置快照，卷快照</strong>。<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster">原文地址</a></p>
<p>内置快照：推荐使用<code>etcdctl</code>直接进行在线备份，不需要停机；离线备份可以直接拷贝<code>member/snap/db</code>，但是需要停机在线备份的例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ETCDCTL_API=3 etcdctl --endpoints <span class="hljs-variable">$ENDPOINT</span> snapshot save snapshot.db<br></code></pre></td></tr></table></figure>

<ul>
<li><code>ETCDCTL_API=3</code>：这是一个环境变量设置。它明确告诉系统使用 v3 版本的 API 来执行命令。由于 etcd 的 v2 和 v3 版本架构完全不同，如果不加这个前缀，命令可能无法识别或无法正确操作 K8s 集群的数据库。</li>
<li><code>$ENDPOINT</code>等于etcd服务的IP地址和端口。生成的备份文件名是<code>snapshot.db</code></li>
</ul>
<p>卷快照：如果 etcd 运行在支持备份的存储卷（如 Amazon Elastic Block 存储）上，则可以通过创建存储卷的快照来备份 etcd 数据。</p>
<h4 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h4><p>在 etcd 中，增加节点并不像增加 Web 服务器那样能提升处理速度。<strong>相反，由于 etcd 使用 Raft 一致性算法，节点越多，达成共识所需的网络通信和同步开销就越大，写性能反而会下降。</strong></p>
<p>基本原则：</p>
<ul>
<li>不要随意对etcd集群扩容或者缩容</li>
<li>不要为etcd配置任何自动扩展组</li>
<li>对于任何官方支持规模的生产级 Kubernetes 集群，强烈建议始终运行一个静态的<strong>五成员</strong> etcd 集群。</li>
<li>etcd 使用的是 <strong>Raft 共识算法</strong>，其核心原则是：<strong>必须有超过半数的节点存活，集群才能正常工作</strong>。所以至少应该3个节点集群（允许一个故障），可以考虑把3节点集群升级成5节点集群（允许两个故障），节点个数始终是奇数</li>
</ul>
<p>etcd的更多资料，参考这里：<a target="_blank" rel="noopener" href="https://etcd.io/docs/v3.6/learning/">https://etcd.io/docs/v3.6/learning/</a></p>
<h4 id="操作etcd集群的方法"><a href="#操作etcd集群的方法" class="headerlink" title="操作etcd集群的方法"></a>操作etcd集群的方法</h4><p>见<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/">https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/</a></p>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>插件提供<strong>集群层面</strong>的功能，插件中命名空间域的资源属于 kube-system 命名空间。</p>
<h2 id="Service深入探讨"><a href="#Service深入探讨" class="headerlink" title="Service深入探讨"></a>Service深入探讨</h2><p>Service实现了不同Pod之间的<strong>解耦</strong>——如果运行后端服务的Pod为前端服务的Pod题僧俗能，那么我们希望前端能自动发现后端服务的位置，不必去关心调用哪个后端实例，即使后端应用发生了变动，也不会对前端产生影响。</p>
<blockquote>
<p><strong>Kubernetes 的 Service 是一个抽象层，它所定义的是 Pod 的一个逻辑集合，并为这些 Pod 支持外部流量公开、负载平衡和服务发现。</strong></p>
</blockquote>
<p><code>kube-proxy</code>实现了Service的功能。</p>
<p>Service 对象的名称必须是有效的 RFC 1035 标签名称：</p>
<pre><code class="hljs">最多 63 个字符
只能包含小写字母、数字，以及 &#39;-&#39;
必须以字母开头
必须以字母数字结尾
</code></pre>
<p>k8s会为Service对象分配一个虚拟IP,称为集群IP，供虚拟IP机制使用。虚拟IP机制见：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/networking/virtual-ips/">https://kubernetes.io/zh-cn/docs/reference/networking/virtual-ips/</a></p>
<p><img src="https://s41.ax1x.com/2026/02/14/pZqxFqU.png" srcset="/img/loading.gif" lazyload></p>
<p><code>kube-proxy</code>捕获流向Service地址的流量，并且把这些流量重定向到某个Pod。</p>
<p>流量能正确地从Service对应到具体的Pod,靠的是EndpointSlice。<code>EndpointSlice </code>维护了从<code>Service</code>到其匹配的Pod地址的映射关系：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Service</span> (web) → EndpointSlice → 后端 Pod 列表<br>                     ↓<br>              <span class="hljs-number">10.244.0.5:3000</span><br>              <span class="hljs-number">10.244.0.6:3000</span><br></code></pre></td></tr></table></figure>

<p>EndpointSlice 把端点分片存储，每100个端点作为一个 EndpointSlice 分片，例如10000个Pod会分成100个EndpointSlice，这样一来更新时只改动对应的那一个切片即可，其他的切片不受影响。</p>
<p>EndpointSlice的创建和管理由控制平面中的端点切片控制器负责。</p>
<h3 id="Service分类"><a href="#Service分类" class="headerlink" title="Service分类"></a>Service分类</h3><p>通过在 Service 的 spec 中指定 type，可以以不同的方式公开 Service：</p>
<ul>
<li><code>ClusterIP</code>（默认）给Service分配一个集群内部的虚拟IP，只有<strong>集群内</strong>的Pod和节点才能访问它。适合后端服务和数据库，这种不需要对外暴露的组件。</li>
<li><code>NodePort</code>，在ClusterIP的基础上，在每个节点上开放一个静态端口（30000–32767）。外部请求向<code>NodeIP:NodePort</code>访问 Service。适合开发测试环境。外部请求 → <code>节点IP:NodePort</code> → ClusterIP → Pod</li>
<li><code>LoadBalancer</code>在上面的基础上，<strong>对接云平台的负载均衡器</strong>，并为 Service 分配一个固定的外部 IP。外部流量从这个IP进入集群。适合场景：生产环境中需要对外提供服务，且运行在支持 LoadBalancer 的云平台上。外部请求 → 云负载均衡器(外部IP) → <code>节点IP:NodePort</code> → ClusterIP → Pod</li>
<li><code>ExternalName</code>与以上三种类型无关。创建一条CNAME,将 Service 映射到一个外部域名。 Pod 访问 my-service → DNS 返回 CNAME → <code>api.foo.bar.example</code>。适合场景：将集群外部的服务（如第三方 API、外部数据库）以统一的 Service 名称引入集群，方便后续迁移时只改 DNS 映射，而不需要修改应用代码。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>举一个例子，下面配置了一个LoadBalancer Service和对应的2副本Deployment：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Kubernetes 清单文件（Manifest）</span><br><span class="hljs-comment"># 定义了要部署到 Kubernetes 集群中的资源配置情况</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-comment"># 资源名称：service/web | Service 是负载均衡器，可以自动转发请求到后面的所有 Pod；配置为 Service 才能被外界访问</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>  <br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">web</span> <span class="hljs-comment"># service 名称，必须唯一</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">3000</span> <span class="hljs-comment">#  Service 的虚拟 IP (ClusterIP) 上监听的端口</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">web</span> <span class="hljs-comment"># 选择器，所有带有 app: web 标签的 Pod 都会被这个 Service 选中并转发请求到它们</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span> <span class="hljs-comment"># Deployment 是 Pod 的管理器，负责创建和管理 Pod 的生命周期，比如在容器终止时立即重启</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">web</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># number of pod replicas，保持2个pod实例运行</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">web</span> <span class="hljs-comment"># 给 Pod 打上的标签 app: web，用于被 Service 和 Deployment 识别。</span><br>  <span class="hljs-attr">template:</span> <span class="hljs-comment"># Pod 模板，定义了如果要创建一个新的 Pod 应该是什么样子的</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">web</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span> <span class="hljs-comment"># 定义了 Pod 中运行的容器</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">web</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">skaffold-buildpacks-node</span><br>        <span class="hljs-attr">ports:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3000</span> <span class="hljs-comment"># 容器内部监听的端口，IP是Pod的IP地址</span><br></code></pre></td></tr></table></figure>

<p>外部请求抵达pod的流程如下：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scss">外部请求 → LoadBalancer (公网IP:<span class="hljs-number">3000</span>)<br>         ↓<br>      Service (ClusterIP:<span class="hljs-number">3000</span>) <br>         ↓<br>      通过 selector (app: web) 选择 Pod<br>         ↓<br>      Pod <span class="hljs-number">1</span> (<span class="hljs-number">10.244</span>.<span class="hljs-number">0.5</span>:<span class="hljs-number">3000</span>) ← 容器内应用监听<br>      Pod <span class="hljs-number">2</span> (<span class="hljs-number">10.244</span>.<span class="hljs-number">0.6</span>:<span class="hljs-number">3000</span>) ← 容器内应用监听<br></code></pre></td></tr></table></figure>

<p>端点切片的工作流程：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 创建 Deployment (replicas: 2)<br>   ↓<br><span class="hljs-bullet">2.</span> Kubernetes 创建 2 个 Pod<br>   ↓<br><span class="hljs-bullet">3.</span> 创建 Service (selector: app=web)<br>   ↓<br><span class="hljs-bullet">4.</span> EndpointSlice Controller 自动创建 EndpointSlice<br>   ↓<br><span class="hljs-bullet">5.</span> EndpointSlice 记录 2 个 Pod 的 IP:Port<br>   ↓<br><span class="hljs-bullet">6.</span> kube-proxy 读取 EndpointSlice<br>   ↓<br><span class="hljs-bullet">7.</span> 配置 iptables/IPVS 规则<br>   ↓<br><span class="hljs-bullet">8.</span> 流量可以正确转发到 Pod<br></code></pre></td></tr></table></figure>

<p>注意Service能把入站的Port映射到任意<code>targetPort</code>，比如改成下面这样</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>        <span class="hljs-comment"># Service 对外暴露 80 端口</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">3000</span> <span class="hljs-comment"># 转发到 Pod 的 3000 端口</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3000</span>  <span class="hljs-comment"># 容器监听 3000</span><br></code></pre></td></tr></table></figure>

<p>不过一般不会这样做，大部分情况下会让这两个port相同，不做区分。</p>
<h3 id="服务发现"><a href="#服务发现" class="headerlink" title="*服务发现"></a>*服务发现</h3><p>k8s支持两种服务发现模式：</p>
<ul>
<li>环境变量</li>
<li>DNS</li>
</ul>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>当 Pod 运行在某 Node 上时，kubelet 会在其中为每个活跃的 Service 添加一组环境变量： <code>&#123;SVCNAME&#125;_SERVICE_HOST</code> 和 <code>&#123;SVCNAME&#125;_SERVICE_PORT</code>。这里 Service 的名称被自动转为大写字母，横线被转换成下划线。</p>
<p>例如，用下面的命令来查看<code>my-nginx</code>服务的环境变量，该服务的地址是<code>10.96.117.113:80</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">exec</span> my-nginx-7dd9d8c7bd-gpn9z -- <span class="hljs-built_in">printenv</span> | grep SERVICE<br>KUBERNETES_SERVICE_PORT=443<br>KUBERNETES_SERVICE_PORT_HTTPS=443<br>KUBERNETES_SERVICE_HOST=10.96.0.1<br>MY_NGINX_SERVICE_HOST=10.96.117.113<br>MY_NGINX_SERVICE_PORT=80<br></code></pre></td></tr></table></figure>

<p><strong>使用环境变量的方法来让客户端Pod访问Service的话，必须在客户端Pod出现之前就创建好Service，否则不会出现Service相关的环境变量</strong>。结果像下面这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">KUBERNETES_SERVICE_HOST=10.0.0.1<br>KUBERNETES_SERVICE_PORT=443<br>KUBERNETES_SERVICE_PORT_HTTPS=443<br></code></pre></td></tr></table></figure>

<p>最后两个变量消失了。</p>
<p>因为这些环境变量是隐式引入的，可能会带来含糊不清的地方，所以可以在k8s清单文件里面明确配置出来，像下面这样：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">frontend</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">frontend</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">frontend</span><br>      <span class="hljs-comment"># annotations:</span><br>      <span class="hljs-comment">#   sidecar.istio.io/rewriteAppHTTPProbers: &quot;true&quot;</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">frontend</span><br>      <span class="hljs-attr">securityContext:</span><br>        <span class="hljs-attr">fsGroup:</span> <span class="hljs-number">1000</span><br>        <span class="hljs-attr">runAsGroup:</span> <span class="hljs-number">1000</span><br>        <span class="hljs-attr">runAsNonRoot:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">1000</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br>          <span class="hljs-attr">securityContext:</span><br>            <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-attr">capabilities:</span><br>              <span class="hljs-attr">drop:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">ALL</span><br>            <span class="hljs-attr">privileged:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-attr">readOnlyRootFilesystem:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">frontend</span><br>          <span class="hljs-attr">ports:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/_healthz&quot;</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>              <span class="hljs-attr">httpHeaders:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Cookie&quot;</span><br>                <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;shop_session-id=x-readiness-probe&quot;</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/_healthz&quot;</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>              <span class="hljs-attr">httpHeaders:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Cookie&quot;</span><br>                <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;shop_session-id=x-liveness-probe&quot;</span><br>          <span class="hljs-attr">env:</span> <span class="hljs-comment"># 下面显式定义了环境变量</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PORT</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;8080&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PRODUCT_CATALOG_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;productcatalogservice:3550&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CURRENCY_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;currencyservice:7000&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CART_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;cartservice:7070&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">RECOMMENDATION_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;recommendationservice:8080&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SHIPPING_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;shippingservice:50051&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CHECKOUT_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;checkoutservice:5050&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">AD_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;adservice:9555&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SHOPPING_ASSISTANT_SERVICE_ADDR</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;shoppingassistantservice:80&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ENABLE_PROFILER</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;0&quot;</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">64Mi</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">200m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br></code></pre></td></tr></table></figure>

<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>这种服务发现模式要使用DNS插件，例如<strong>CoreDNS</strong>，它可以监视每个Service, 并且为它创建DNS记录。然后所有的Pod都可以通过 DNS 获取 Service 地址。</p>
<p><code>kind</code>默认自带CoreDNS，比如切换集群上下文的时候可以看到下面的信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl cluster-info --context kind-ltest<br>Kubernetes control plane is running at https://127.0.0.1:40619<br>CoreDNS is running at https://127.0.0.1:40619/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy<br><br>To further debug and diagnose cluster problems, use <span class="hljs-string">&#x27;kubectl cluster-info dump&#x27;</span>.<br></code></pre></td></tr></table></figure>

<p>也可以用下面的命令来检查是否在工作，其实就是看一下<code>kube-system</code>空间中有没有服务。因为插件的资源都是在这里被分配的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl get services kube-dns --namespace=kube-system<br>NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE<br>kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   76m<br></code></pre></td></tr></table></figure>

<p>可以看到CoreDNS插件的服务名称是<code>kube-dns</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl get services -n kube-system<br>NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE<br>kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   80m<br></code></pre></td></tr></table></figure>

<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><p>名字空间(namespace)将同一集群中的资源划分为相互隔离的组。<strong>适用于存在很多跨多个团队或项目的用户的场景</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl get namespaces<br>NAME                 STATUS   AGE<br>default              Active   22d<br>kube-node-lease      Active   22d<br>kube-public          Active   22d<br>kube-system          Active   22d<br>local-path-storage   Active   22d<br></code></pre></td></tr></table></figure>

<p>解释一下这里的几个命名空间：</p>
<ul>
<li>default: 不明确指定的情况下，资源都会创建在这里</li>
<li>kube-system：存放核心组件，系统pod</li>
<li>kube-public：所有的客户端（包括未经身份验证的客户端）都可以读取该名字空间。该名字空间主要预留为集群使用，以便某些资源需要在整个集群中可见可读。该名字空间的公共属性只是一种约定而非要求。</li>
<li>kube-node-lease：该名字空间包含用于与各个节点关联的 Lease（租约）对象。节点租约允许 kubelet 发送<strong>心跳</strong>，由此控制面能够检测到节点故障。存放节点的心跳信息，每个节点定期更新自己的Lease对象，证明节点还活着</li>
<li>local-path-storage：这是 kind 集群特有的命名空间，用于本地存储支持</li>
</ul>
<blockquote>
<p><strong>节点健康检查流程</strong>：</p>
<ol>
<li>节点每 10 秒更新一次 Lease</li>
<li>如果 40 秒没更新，控制平面认为节点可能故障</li>
<li>开始标记节点为 NotReady</li>
<li>可能触发 Pod 驱逐</li>
</ol>
</blockquote>
<p>大多数 kubernetes 资源（例如 Pod、Service、副本控制器等）都位于某些名字空间中。<strong>但是名字空间资源本身并不在名字空间中。而且底层资源，例如节点和持久化卷不属于任何名字空间。</strong></p>
<h2 id="在集群内部测试DNS解析"><a href="#在集群内部测试DNS解析" class="headerlink" title="在集群内部测试DNS解析"></a>在集群内部测试DNS解析</h2><p>前面讲过了CoreDNS,下面不妨就在具体的集群中手动查询一下DNS。方法是利用<code>busybox</code>，在集群内的节点上运行<code>nslookup</code>命令。</p>
<p>先把 busybox 镜像加载到集群内，加载后用<code>docker exec -it ltest-control-plane crictl images</code>查看是否已经加载好。（能拉得动镜像的话可以省略）</p>
<p>然后运行下面的命令，这个命令会在 Kubernetes 集群中创建一个临时的交互式 Pod。然后在打开的命令行中调用<code>nslookup</code>调用CoreDNS服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl run busybox --image=docker.io/library/busybox:latest --image-pull-policy=IfNotPresent -i --<span class="hljs-built_in">tty</span> --<span class="hljs-built_in">rm</span> -- sh<br>All commands and output from this session will be recorded <span class="hljs-keyword">in</span> container logs, including credentials and sensitive information passed through the <span class="hljs-built_in">command</span> prompt.<br>If you don<span class="hljs-string">&#x27;t see a command prompt, try pressing enter.</span><br><span class="hljs-string">/ # nslookup my-nginx</span><br><span class="hljs-string">Server:		10.96.0.10</span><br><span class="hljs-string">Address:	10.96.0.10:53</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">** server can&#x27;</span>t find my-nginx.svc.cluster.local: NXDOMAIN<br><br>** server can<span class="hljs-string">&#x27;t find my-nginx.svc.cluster.local: NXDOMAIN</span><br><span class="hljs-string"></span><br><span class="hljs-string">** server can&#x27;</span>t find my-nginx.cluster.local: NXDOMAIN<br><br>Name:	my-nginx.default.svc.cluster.local<br>Address: 10.96.117.113<br><br>** server can<span class="hljs-string">&#x27;t find my-nginx.cluster.local: NXDOMAIN</span><br><span class="hljs-string"></span><br><span class="hljs-string">** server can&#x27;</span>t find my-nginx.tail28fab9.ts.net: NXDOMAIN<br><br>** server can<span class="hljs-string">&#x27;t find my-nginx.tail28fab9.ts.net: NXDOMAIN</span><br></code></pre></td></tr></table></figure>

<p>然后退出命令行，这个pod会被自动删除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">/ <span class="hljs-comment"># exit</span><br>Session ended, resume using <span class="hljs-string">&#x27;kubectl attach busybox -c busybox -i -t&#x27;</span> <span class="hljs-built_in">command</span> when the pod is running<br>pod <span class="hljs-string">&quot;busybox&quot;</span> deleted from default namespace<br></code></pre></td></tr></table></figure>

<p>查询CoreDNS服务的信息，发现确实就是上面所用到的DNS服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl get svc -n kube-system<br>NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE<br>kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   107m<br></code></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li>CoreDNS是节点内部<code>nslookup</code>使用的DNS服务器</li>
<li>DNS客户端会<strong>把所有的搜索域补全到域名后面</strong>再去询问DNS服务器</li>
<li>补全<code>my-nginx</code>的命名空间default之后：<code>my-nginx.default.svc.cluster.local</code>是正确的域名，查询成功</li>
<li>k8s继承了宿主机的搜索域，所以才会出现<code>tail28fab9.ts.net</code>，这是我安装的tailscale在<code>/etc/resolv.conf</code>添加的信息。</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/cloud-native/" class="category-chain-item">cloud-native</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/kubernetes/" class="print-no-link">#kubernetes</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>kubernetes基础知识梳理</div>
      <div>https://kznleaf.top/2026/02/17/k8s学习1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>kznLeaf</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>February 17, 2026</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - Non-commercial">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - Share-alike">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/23/kind-metrics-server-solved-md/" title="kind+metrics-server性能分析插件在中国大陆环境的安装方法">
                        <span class="hidden-mobile">kind+metrics-server性能分析插件在中国大陆环境的安装方法</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'kznLeaf/kznLeaf.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'Comment');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/vvd_js/duration.js"></script> </div> 
    </div>
  
  
  
</div>
  </footer>

  <!-- Scripts -->
  

<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/custom.js"></script>
<script src="/js/sign.js"></script>
<script src="/js/backgroundize.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script><!-- hexo injector body_end end --></body>
</html>
